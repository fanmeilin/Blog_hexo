{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/fluid2/source/css/gitalk.css","path":"css/gitalk.css","modified":0,"renderable":1},{"_id":"themes/fluid2/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/fluid2/source/img/default.png","path":"img/default.png","modified":0,"renderable":1},{"_id":"themes/fluid2/source/img/avatar.png","path":"img/avatar.png","modified":0,"renderable":1},{"_id":"themes/fluid2/source/img/loading.gif","path":"img/loading.gif","modified":0,"renderable":1},{"_id":"themes/fluid2/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/fluid2/source/img/police_beian.png","path":"img/police_beian.png","modified":0,"renderable":1},{"_id":"themes/fluid2/source/img/test.jpg","path":"img/test.jpg","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/boot.js","path":"js/boot.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/color-schema.js","path":"js/color-schema.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/events.js","path":"js/events.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/img-lazyload.js","path":"js/img-lazyload.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/deployggb.js","path":"js/deployggb.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/jquery.js","path":"js/jquery.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/plugins.js","path":"js/plugins.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/local-search.js","path":"js/local-search.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/leancloud.js","path":"js/leancloud.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/video_url.json","path":"js/video_url.json","modified":0,"renderable":1},{"_id":"themes/fluid2/source/xml/local-search.xml","path":"xml/local-search.xml","modified":0,"renderable":1},{"_id":"themes/fluid2/source/lib/hint/hint.min.css","path":"lib/hint/hint.min.css","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/18EBAFF235EE31DFDA1EE52C35151A34.cache.js","path":"js/5.0/web3d/18EBAFF235EE31DFDA1EE52C35151A34.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/clear.cache.gif","path":"js/5.0/web3d/clear.cache.gif","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/sworker.js","path":"js/5.0/web3d/sworker.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/web3d.nocache.js","path":"js/5.0/web3d/web3d.nocache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/sworker-locked.js","path":"js/5.0/web3d/sworker-locked.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/html/ggtcallback.html","path":"js/5.0/web3d/html/ggtcallback.html","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/html/skydriveproxy.php","path":"js/5.0/web3d/html/skydriveproxy.php","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/html/opener.html","path":"js/5.0/web3d/html/opener.html","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/html/windowslive.html","path":"js/5.0/web3d/html/windowslive.html","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/gl-matrix-min.js","path":"js/5.0/web3d/js/gl-matrix-min.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_am.js","path":"js/5.0/web3d/js/properties_keys_am.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_af.js","path":"js/5.0/web3d/js/properties_keys_af.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ar-MA.js","path":"js/5.0/web3d/js/properties_keys_ar-MA.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ar-TN.js","path":"js/5.0/web3d/js/properties_keys_ar-TN.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ar.js","path":"js/5.0/web3d/js/properties_keys_ar.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_az.js","path":"js/5.0/web3d/js/properties_keys_az.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_bn.js","path":"js/5.0/web3d/js/properties_keys_bn.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_bg.js","path":"js/5.0/web3d/js/properties_keys_bg.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ca.js","path":"js/5.0/web3d/js/properties_keys_ca.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ca-XV.js","path":"js/5.0/web3d/js/properties_keys_ca-XV.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_cs.js","path":"js/5.0/web3d/js/properties_keys_cs.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_bs.js","path":"js/5.0/web3d/js/properties_keys_bs.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_cy.js","path":"js/5.0/web3d/js/properties_keys_cy.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_da.js","path":"js/5.0/web3d/js/properties_keys_da.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_de-AT.js","path":"js/5.0/web3d/js/properties_keys_de-AT.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_de.js","path":"js/5.0/web3d/js/properties_keys_de.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_el.js","path":"js/5.0/web3d/js/properties_keys_el.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_en-AU.js","path":"js/5.0/web3d/js/properties_keys_en-AU.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_en-GB.js","path":"js/5.0/web3d/js/properties_keys_en-GB.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_en.js","path":"js/5.0/web3d/js/properties_keys_en.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_eo.js","path":"js/5.0/web3d/js/properties_keys_eo.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_es-UY.js","path":"js/5.0/web3d/js/properties_keys_es-UY.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_es.js","path":"js/5.0/web3d/js/properties_keys_es.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_es-ES.js","path":"js/5.0/web3d/js/properties_keys_es-ES.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_eu.js","path":"js/5.0/web3d/js/properties_keys_eu.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_et.js","path":"js/5.0/web3d/js/properties_keys_et.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_fi.js","path":"js/5.0/web3d/js/properties_keys_fi.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_fa.js","path":"js/5.0/web3d/js/properties_keys_fa.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_fil.js","path":"js/5.0/web3d/js/properties_keys_fil.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_he.js","path":"js/5.0/web3d/js/properties_keys_he.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_gl.js","path":"js/5.0/web3d/js/properties_keys_gl.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_fr.js","path":"js/5.0/web3d/js/properties_keys_fr.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_hr.js","path":"js/5.0/web3d/js/properties_keys_hr.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_hu.js","path":"js/5.0/web3d/js/properties_keys_hu.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_hi.js","path":"js/5.0/web3d/js/properties_keys_hi.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_hy.js","path":"js/5.0/web3d/js/properties_keys_hy.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_id.js","path":"js/5.0/web3d/js/properties_keys_id.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_is.js","path":"js/5.0/web3d/js/properties_keys_is.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_it.js","path":"js/5.0/web3d/js/properties_keys_it.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ja.js","path":"js/5.0/web3d/js/properties_keys_ja.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_km.js","path":"js/5.0/web3d/js/properties_keys_km.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ka.js","path":"js/5.0/web3d/js/properties_keys_ka.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_kn.js","path":"js/5.0/web3d/js/properties_keys_kn.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_kk.js","path":"js/5.0/web3d/js/properties_keys_kk.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_lt.js","path":"js/5.0/web3d/js/properties_keys_lt.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_mk.js","path":"js/5.0/web3d/js/properties_keys_mk.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ko.js","path":"js/5.0/web3d/js/properties_keys_ko.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_lv.js","path":"js/5.0/web3d/js/properties_keys_lv.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ml.js","path":"js/5.0/web3d/js/properties_keys_ml.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_mn.js","path":"js/5.0/web3d/js/properties_keys_mn.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_mr.js","path":"js/5.0/web3d/js/properties_keys_mr.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ms.js","path":"js/5.0/web3d/js/properties_keys_ms.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_nl-NL.js","path":"js/5.0/web3d/js/properties_keys_nl-NL.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_nb.js","path":"js/5.0/web3d/js/properties_keys_nb.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_nl.js","path":"js/5.0/web3d/js/properties_keys_nl.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ne.js","path":"js/5.0/web3d/js/properties_keys_ne.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_nn.js","path":"js/5.0/web3d/js/properties_keys_nn.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_pt.js","path":"js/5.0/web3d/js/properties_keys_pt.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_pt-PT.js","path":"js/5.0/web3d/js/properties_keys_pt-PT.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_pl.js","path":"js/5.0/web3d/js/properties_keys_pl.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ro.js","path":"js/5.0/web3d/js/properties_keys_ro.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_sk.js","path":"js/5.0/web3d/js/properties_keys_sk.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ru.js","path":"js/5.0/web3d/js/properties_keys_ru.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_si.js","path":"js/5.0/web3d/js/properties_keys_si.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_sl.js","path":"js/5.0/web3d/js/properties_keys_sl.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_sq.js","path":"js/5.0/web3d/js/properties_keys_sq.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_sr.js","path":"js/5.0/web3d/js/properties_keys_sr.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_sv.js","path":"js/5.0/web3d/js/properties_keys_sv.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_th.js","path":"js/5.0/web3d/js/properties_keys_th.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_tg.js","path":"js/5.0/web3d/js/properties_keys_tg.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ta.js","path":"js/5.0/web3d/js/properties_keys_ta.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_tr.js","path":"js/5.0/web3d/js/properties_keys_tr.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_uz.js","path":"js/5.0/web3d/js/properties_keys_uz.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ug.js","path":"js/5.0/web3d/js/properties_keys_ug.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_vi.js","path":"js/5.0/web3d/js/properties_keys_vi.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_uk.js","path":"js/5.0/web3d/js/properties_keys_uk.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_yi.js","path":"js/5.0/web3d/js/properties_keys_yi.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_xh.js","path":"js/5.0/web3d/js/properties_keys_xh.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_zh-CN.js","path":"js/5.0/web3d/js/properties_keys_zh-CN.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_zh-TW.js","path":"js/5.0/web3d/js/properties_keys_zh-TW.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/webfont.js","path":"js/5.0/web3d/js/webfont.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/workercheck.js","path":"js/5.0/web3d/js/workercheck.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/zSpace.js","path":"js/5.0/web3d/js/zSpace.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/base/jlm_cmmib10.js","path":"js/5.0/web3d/fonts/base/jlm_cmmib10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/base/jlm_cmmi10.js","path":"js/5.0/web3d/fonts/base/jlm_cmmi10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/1.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/1.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/10.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/10.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/11.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/11.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/13.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/13.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/12.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/12.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/14.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/14.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/2.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/2.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/3.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/3.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/4.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/4.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/5.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/5.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/6.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/6.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/9.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/9.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnbx10.js","path":"js/5.0/web3d/fonts/cyrillic/jlm_wnbx10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/8.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/8.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/7.cache.js","path":"js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/7.cache.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnbxti10.js","path":"js/5.0/web3d/fonts/cyrillic/jlm_wnbxti10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnr10.js","path":"js/5.0/web3d/fonts/cyrillic/jlm_wnr10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnssbx10.js","path":"js/5.0/web3d/fonts/cyrillic/jlm_wnssbx10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnss10.js","path":"js/5.0/web3d/fonts/cyrillic/jlm_wnss10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnssi10.js","path":"js/5.0/web3d/fonts/cyrillic/jlm_wnssi10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnti10.js","path":"js/5.0/web3d/fonts/cyrillic/jlm_wnti10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wntt10.js","path":"js/5.0/web3d/fonts/cyrillic/jlm_wntt10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/euler/jlm_eufb10.js","path":"js/5.0/web3d/fonts/euler/jlm_eufb10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/euler/jlm_eufm10.js","path":"js/5.0/web3d/fonts/euler/jlm_eufm10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_cmr10.js","path":"js/5.0/web3d/fonts/latin/jlm_cmr10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmbi10.js","path":"js/5.0/web3d/fonts/latin/jlm_jlmbi10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmi10.js","path":"js/5.0/web3d/fonts/latin/jlm_jlmi10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmbx10.js","path":"js/5.0/web3d/fonts/latin/jlm_jlmbx10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmr10.js","path":"js/5.0/web3d/fonts/latin/jlm_jlmr10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmsb10.js","path":"js/5.0/web3d/fonts/latin/jlm_jlmsb10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmsbi10.js","path":"js/5.0/web3d/fonts/latin/jlm_jlmsbi10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmsi10.js","path":"js/5.0/web3d/fonts/latin/jlm_jlmsi10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmtt10.js","path":"js/5.0/web3d/fonts/latin/jlm_jlmtt10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmss10.js","path":"js/5.0/web3d/fonts/latin/jlm_jlmss10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcmbipg.js","path":"js/5.0/web3d/fonts/greek/jlm_fcmbipg.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcmbpg.js","path":"js/5.0/web3d/fonts/greek/jlm_fcmbpg.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcmripg.js","path":"js/5.0/web3d/fonts/greek/jlm_fcmripg.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcmrpg.js","path":"js/5.0/web3d/fonts/greek/jlm_fcmrpg.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcsbpg.js","path":"js/5.0/web3d/fonts/greek/jlm_fcsbpg.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcsropg.js","path":"js/5.0/web3d/fonts/greek/jlm_fcsropg.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcsrpg.js","path":"js/5.0/web3d/fonts/greek/jlm_fcsrpg.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_cmbsy10.js","path":"js/5.0/web3d/fonts/maths/jlm_cmbsy10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fctrpg.js","path":"js/5.0/web3d/fonts/greek/jlm_fctrpg.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_msam10.js","path":"js/5.0/web3d/fonts/maths/jlm_msam10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_msbm10.js","path":"js/5.0/web3d/fonts/maths/jlm_msbm10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_rsfs10.js","path":"js/5.0/web3d/fonts/maths/jlm_rsfs10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_special.js","path":"js/5.0/web3d/fonts/maths/jlm_special.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_stmary10.js","path":"js/5.0/web3d/fonts/maths/jlm_stmary10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/licences/Knuth_License.txt","path":"js/5.0/web3d/fonts/licences/Knuth_License.txt","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/licences/License_for_dsrom.txt","path":"js/5.0/web3d/fonts/licences/License_for_dsrom.txt","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/licences/OFL.txt","path":"js/5.0/web3d/fonts/licences/OFL.txt","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/zipjs/codecs.js","path":"js/5.0/web3d/js/zipjs/codecs.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/zipjs/pako1.0.6_min.js","path":"js/5.0/web3d/js/zipjs/pako1.0.6_min.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/js/zipjs/z-worker.js","path":"js/5.0/web3d/js/zipjs/z-worker.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmbx10.js","path":"js/5.0/web3d/fonts/latin/optional/jlm_cmbx10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmbxti10.js","path":"js/5.0/web3d/fonts/latin/optional/jlm_cmbxti10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmssbx10.js","path":"js/5.0/web3d/fonts/latin/optional/jlm_cmssbx10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmtt10.js","path":"js/5.0/web3d/fonts/latin/optional/jlm_cmtt10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmti10.js","path":"js/5.0/web3d/fonts/latin/optional/jlm_cmti10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmssi10.js","path":"js/5.0/web3d/fonts/latin/optional/jlm_cmssi10.js","modified":0,"renderable":1},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/optional/jlm_dsrom10.js","path":"js/5.0/web3d/fonts/maths/optional/jlm_dsrom10.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/404/index.md","hash":"06571ce4e8c46dc5e1840c263ede31b161e0ba48","modified":1642493417040},{"_id":"source/CNAME","hash":"f5776ace0c267af3c5acde0ed1be1754175ad6ff","modified":1642493417041},{"_id":"source/_drafts/yolov3.md","hash":"c4eee42b3b06ae7ad4a8cb0fc2937be46d6a8d49","modified":1642493417042},{"_id":"source/contact/index.md","hash":"5338b9905b34f130024df1f88eda24376c2171d8","modified":1642493417121},{"_id":"source/categories/index.md","hash":"5f895e23001662266e0acf292b24397e1ab7b062","modified":1642493417120},{"_id":"source/about/index.md","hash":"c1ce75fe83ce1d6febfc458749550fba05ac5302","modified":1642493417119},{"_id":"source/friends/index.md","hash":"3adac5d2ccf78e8f846c10ce4b1398716eb92eae","modified":1642493417122},{"_id":"source/tags/index.md","hash":"b83bfcf1ca00f582682619d8e647667bfc3c6e4d","modified":1642493417122},{"_id":"source/_data/friends.json","hash":"519916312399331fdcee1d72ee4cef6b284908fb","modified":1642493417041},{"_id":"source/_posts/config/hexo-math-config.md","hash":"9385cc40c0183e448647f8d1e1cf2e090f29aabe","modified":1642493417045},{"_id":"source/_posts/config/git-submodule.md","hash":"6f56833ecadcdbbb57da76149270ec50921359fc","modified":1642493417044},{"_id":"source/_posts/config/pdf-config.md","hash":"143559a4376e111cc45077eb30b6887551a186ec","modified":1642493417046},{"_id":"source/_posts/config/hexo-emoji.md","hash":"1b086c40e9d0cccfc48ea0fb8f5aa92c08cca4c6","modified":1642493417044},{"_id":"source/_posts/docker/docker-intro.md","hash":"c2d5f980278840ad6a70fddd7e9efdcfd4ce1f26","modified":1642493417053},{"_id":"source/_posts/deep_learning/KnowledgeDistillation.md","hash":"4bed53a679368a5a414bbc3ae490d1a12377cdc3","modified":1642493417047},{"_id":"source/_posts/docker/docker-ssh.md","hash":"eaf4644a46bc1432d3549dcf7d3d360bc8ca8873","modified":1642493417053},{"_id":"source/_posts/deep_learning/conv3d.md","hash":"e8fe49f03173247146b626d33cf3a43ea63d389c","modified":1642493417047},{"_id":"source/_posts/deep_learning/dsconv.md","hash":"b2bcae1d1b2a2769ec8b04163e4e6d606a546fea","modified":1642493417048},{"_id":"source/_posts/deep_learning/gradient-clip.md","hash":"53f0b8854ee28f133c58176cf5ae90590846e197","modified":1642493417049},{"_id":"source/_posts/deep_learning/fine-tuning.md","hash":"85db08bb3661978d7ffe97901f5771e7f2faa5dd","modified":1642493417049},{"_id":"source/_posts/deep_learning/gradient-exp.md","hash":"42254e6910d5908f293d97889090d8bf1b523bac","modified":1642493417050},{"_id":"source/_posts/deep_learning/swin.md","hash":"db2b78490a11338d98e6ceeb7968209989fb4011","modified":1642493417051},{"_id":"source/_posts/deep_learning/yolov1.md","hash":"eda2a42e31d3f6e9ed383c818df548e369d028cc","modified":1642493417051},{"_id":"source/_posts/deep_learning/yolov2.md","hash":"5ddeeffb117c589acc5ffc6b3feec2bc523d6473","modified":1642493417052},{"_id":"source/_posts/dvc/dvc-config.md","hash":"58510cbcb31c5f1c44cbe66ab0a745f12d90d71e","modified":1642493417054},{"_id":"source/_posts/english/self-aware.md","hash":"5a66388b144f72eca4d7d972dabeeb26800f58de","modified":1642493417055},{"_id":"source/_posts/img_process/laplace.md","hash":"d78cee9179a6c64de58c98e1ad4d6ba3042200d7","modified":1642493417056},{"_id":"source/_posts/img_process/getAngle.md","hash":"9e8c447df03f5dc5aee0056f9129e86f642b2c10","modified":1642493417055},{"_id":"source/_posts/img_process/sobel.md","hash":"a3798e9dc80c1102fae0b6a9ed4b824cfa950022","modified":1642493417058},{"_id":"source/_posts/kaggle/kaggle-data-intro.md","hash":"845e79286229557fd96998764141d5019ef7fc75","modified":1642493417059},{"_id":"source/_posts/kaggle/kaggle-intro.md","hash":"5bb1319a4dc6c215c35c1bd110d305a55831e92c","modified":1642493417059},{"_id":"source/_posts/leetcode/leetcode-offer03.md","hash":"5f0e70b2e68bac9467279bb80b68651ce5c9415c","modified":1642493417061},{"_id":"source/_posts/leetcode/leetcode-21.md","hash":"6a57602d230a9f70a1502a6b992fc8eab4db29ca","modified":1642493417060},{"_id":"source/_posts/leetcode/leetcode-offer04.md","hash":"49124cf10c863e2533361f5c2edf76d6cd2dbc51","modified":1642493417061},{"_id":"source/_posts/leetcode/leetcode-offer05.md","hash":"bfa4d4f363bac19939f94774ba708d9339e9b117","modified":1642493417062},{"_id":"source/_posts/leetcode/leetcode-offer06.md","hash":"e805c6ac4b19202ab3ef1c68d9cb632fb19a97a0","modified":1642493417062},{"_id":"source/_posts/leetcode/leetcode-offer09.md","hash":"8ec70b605674b8bae3ec4e666e146bea01fe1479","modified":1642493417063},{"_id":"source/_posts/leetcode/leetcode-offer07.md","hash":"66221f23066e7e2d7585ea50829cff97e9209dca","modified":1642493417063},{"_id":"source/_posts/leetcode/leetcode-offer10-1.md","hash":"d00e7c41cc9790400a0d0f3b2a5afda3c04051f0","modified":1642493417064},{"_id":"source/_posts/leetcode/leetcode-offer11.md","hash":"e648448f83ea138d610fd5135bdbf5c39b8ef7b9","modified":1642493417065},{"_id":"source/_posts/leetcode/leetcode-offer10-2.md","hash":"68046e0a4388af72a2a3d6e0e78ffefd198375ae","modified":1642493417064},{"_id":"source/_posts/leetcode/leetcode-offer12.md","hash":"51c380259a8468c424dafc564a4d091af94bdf90","modified":1642493417066},{"_id":"source/_posts/leetcode/leetcode-offer14-1.md","hash":"d8bdff12095b5c39e846f9e0caac98d7093855b7","modified":1642493417068},{"_id":"source/_posts/leetcode/leetcode-offer13.md","hash":"1dc7e6fe4e5be453a74daefed6d1bbbffbdd3946","modified":1642493417067},{"_id":"source/_posts/leetcode/leetcode-offer14-2.md","hash":"f30e85ecf1054edd495888d695b3eadf9a7b9e03","modified":1642493417068},{"_id":"source/_posts/leetcode/leetcode-offer15.md","hash":"b51917945ec5099269c19e2412e0e05736274541","modified":1642493417069},{"_id":"source/_posts/leetcode/leetcode-offer17.md","hash":"fe6741f2207f54b8d52805e142d92f73efba2762","modified":1642493417070},{"_id":"source/_posts/leetcode/leetcode-offer19.md","hash":"59d061fe272ea88c5085fbe72b6dd04bb107b259","modified":1642493417075},{"_id":"source/_posts/leetcode/leetcode-offer16.md","hash":"24fc9b5646dfb2b545c4fd769a1eff33d2ec04b6","modified":1642493417069},{"_id":"source/_posts/leetcode/leetcode-offer18.md","hash":"8df23e0bcd69375f169fafe408463f310c8a3fc9","modified":1642493417071},{"_id":"source/_posts/leetcode/leetcode-offer2-085.md","hash":"8d312d471914e73a0fd0e480d644139603bcdd37","modified":1642493417075},{"_id":"source/_posts/leetcode/leetcode-offer21.md","hash":"a72b880c7021ab88111f6a56f9aeea2b5884e606","modified":1642493417076},{"_id":"source/_posts/leetcode/leetcode-offer20.md","hash":"c9af24ac63f214ecac9b4b9923369d38a321ec97","modified":1642493417076},{"_id":"source/_posts/leetcode/leetcode-offer22.md","hash":"b3d8daf5f993ac1b8116ee89234acf0623a51473","modified":1642493417077},{"_id":"source/_posts/leetcode/leetcode-offer24.md","hash":"0f4c0667f267630b173a28ce26c3034b4dd7e994","modified":1642493417078},{"_id":"source/_posts/leetcode/leetcode-offer26.md","hash":"d5648be2a0690f46f7d486520c57723622a226d8","modified":1642493417079},{"_id":"source/_posts/leetcode/leetcode-offer25.md","hash":"13cf99f3174d7ecc0c76b9d656a1429e932611c3","modified":1642493417078},{"_id":"source/_posts/leetcode/leetcode-offer27.md","hash":"50ed7f7a4ee3502b16747b89e20e2c8d008507c1","modified":1642493417080},{"_id":"source/_posts/leetcode/leetcode-offer29.md","hash":"a2083f235040015566ef297b6e47c9595b34298d","modified":1642493417081},{"_id":"source/_posts/leetcode/leetcode-offer30.md","hash":"22c4a4eafd32769ced859779c6bff061862a5e22","modified":1642493417082},{"_id":"source/_posts/leetcode/leetcode-offer28.md","hash":"9a040fa204bd72dcc3ae6c0451dc500ca482da05","modified":1642493417081},{"_id":"source/_posts/leetcode/leetcode-offer31.md","hash":"99b52d54ff58a48e321bf73c365c3e31af77b5a0","modified":1642493417083},{"_id":"source/_posts/leetcode/leetcode-offer32-1.md","hash":"3dfc86e237a847240edb185a6ec5c34883c5b39c","modified":1642493417083},{"_id":"source/_posts/leetcode/leetcode-offer32-3.md","hash":"fd3d917f157ddbb639aa959505fe4a6df31e0f06","modified":1642493417084},{"_id":"source/_posts/leetcode/leetcode-offer32.md","hash":"51153d33c206ac85fdd9ba2ac681fb389d3d3eb4","modified":1642493417084},{"_id":"source/_posts/leetcode/leetcode-offer33.md","hash":"608d473eb5723e8c8138d1372c7c08a83cb37efa","modified":1642493417085},{"_id":"source/_posts/leetcode/leetcode-offer34.md","hash":"4211ad0382bf6ed17cd7827c69bd8e19a82045e4","modified":1642493417086},{"_id":"source/_posts/leetcode/leetcode-offer35.md","hash":"1d9525e46921c88680702623f24bd7971b9d4554","modified":1642493417086},{"_id":"source/_posts/leetcode/leetcode-offer36.md","hash":"60354808fdde23bf46e7ea549f36853a672d29c6","modified":1642493417087},{"_id":"source/_posts/leetcode/leetcode-offer372.md","hash":"fcb464130d903d232de2e13730ba3d10bd17e0c9","modified":1642493417088},{"_id":"source/_posts/leetcode/leetcode-offer38.md","hash":"3f2c41da6a182c34bd97171367e2f5eac93b2f8d","modified":1642493417088},{"_id":"source/_posts/leetcode/leetcode-offer39.md","hash":"a700a3f4260ff8e57583e33cc948656ef3343b8e","modified":1642493417089},{"_id":"source/_posts/leetcode/leetcode-offer42.md","hash":"5d1042f497d0e12280ffa9540207c2c65e66ddf8","modified":1642493417090},{"_id":"source/_posts/leetcode/leetcode-offer40.md","hash":"92e4f7dd60193149683eadc1578f060ab2bb5bc2","modified":1642493417089},{"_id":"source/_posts/leetcode/leetcode-offer45.md","hash":"2cfac54821e197cbcc82769e2d72e0fe2b60e20c","modified":1642493417090},{"_id":"source/_posts/leetcode/leetcode-offer50.md","hash":"aa45f3fd7db6a3db15d9efb35641995b5130b9d1","modified":1642493417091},{"_id":"source/_posts/leetcode/leetcode-offer53-1.md","hash":"b9e929237b7f0704f7217c5cdef1f68b3eaf484c","modified":1642493417091},{"_id":"source/_posts/leetcode/leetcode-offer55-1.md","hash":"88560a31452238b6c81c516ef40430798e3f452c","modified":1642493417092},{"_id":"source/_posts/leetcode/leetcode-offer56-2.md","hash":"06b5234deb0fdefd801ec7d39d1c8bb896e4745c","modified":1642493417093},{"_id":"source/_posts/leetcode/leetcode-offer563.md","hash":"20d2c63a3720e53896aa3ba00d789fd7424b3a03","modified":1642493417093},{"_id":"source/_posts/leetcode/leetcode-offer57-2.md","hash":"a8e2a49154e59e9d6144368b6953825c943d5f09","modified":1642493417093},{"_id":"source/_posts/leetcode/leetcode-offer57.md","hash":"366c45ca9256692da5a268cbc2b464a2c03d033d","modified":1642493417094},{"_id":"source/_posts/leetcode/leetcode-offer859.md","hash":"9bfd4d63ae477507ea7578c3468a5b6321dc6f10","modified":1642493417095},{"_id":"source/_posts/leetcode/leetcode-offer58-1.md","hash":"6da3c461aec1d94542965cfdaf7a27804dce3b29","modified":1642493417095},{"_id":"source/_posts/leetcode/leetcode14.md","hash":"afbdad5780fcfcb1b6d03b53508bc75d1dc1b993","modified":1642493417096},{"_id":"source/_posts/math/Eckark-young.md","hash":"ebe2bacfd7eb37772eb75d9af7fa07c65037da52","modified":1642493417099},{"_id":"source/_posts/leetcode/leetcode20.md","hash":"c5e155b04f96b5cf33134ffd78025071878f6e76","modified":1642493417098},{"_id":"source/_posts/leetcode/leetcode17.md","hash":"2c0d206bba26f00e2d7814752e941dd4c105d65a","modified":1642493417098},{"_id":"source/_posts/math/low-rank-app.md","hash":"d051470567717c15be4f279d18149d327acc57ba","modified":1642493417101},{"_id":"source/_posts/math/Mahalanobis-distance.md","hash":"f9ffe062b853e5047e158b4c9707362f2017c58e","modified":1642493417099},{"_id":"source/_posts/package_usage/random-summarize.md","hash":"7ec91b23e3c85270284da878351e8af132ffef37","modified":1642493417102},{"_id":"source/_posts/math/covariance-matrix.md","hash":"7b635657c580949e3d183871a06eb35c3e2e3e76","modified":1642493417100},{"_id":"source/_posts/project_summary/footprint-summary.md","hash":"b262593ce7ac27b5b7f12f76349d805aa568e5cb","modified":1642493417103},{"_id":"source/_posts/project_tool/pyinstaller-spec-problem.md","hash":"1219554528481a564901ad9389d13fbb59362c8b","modified":1642493417105},{"_id":"source/_posts/project_tool/pipenv.md","hash":"184a4e0620220aa292433d7d4cfc5bce76278516","modified":1642493417104},{"_id":"source/_posts/project_tool/quat.md","hash":"e2bcee22b26d99b1cf902483a409c82a0ffc1431","modified":1642505825448},{"_id":"source/_posts/project_tool/pyinstaller.md","hash":"bb66e4a3d5e62e79bb89e3d7355b7204089d3020","modified":1642493417105},{"_id":"source/_posts/project_tool/spec.md","hash":"0ac19555e22d8b0a8993c412ba6a566eb463a35d","modified":1642493417106},{"_id":"source/_posts/python/file/delete-file.md","hash":"be6bf1dc86c71115927e293c95c914e53477f8e0","modified":1642493417107},{"_id":"source/_posts/project_tool/usePyembeded.md","hash":"0961587006b387d646be3815dc2372a86a1f2efd","modified":1642493417106},{"_id":"source/_posts/python/getppi.md","hash":"1a81d882bef367dbc199219fae31af1cc780a5d6","modified":1642493417109},{"_id":"source/_posts/python/file/fileprocess.md","hash":"f7f746a0087a8f6ac8507287586617e78ee04584","modified":1642493417108},{"_id":"source/_posts/python/func/squeeze.md","hash":"332dfc031a10ad3e71f220973043a3a83bc4e564","modified":1642493417109},{"_id":"source/_posts/python/file/split-filename.md","hash":"808dae5e4ade3b0a1e0bbe0d9d00cac9b604b22c","modified":1642493417108},{"_id":"source/_posts/python/img/FPDF.md","hash":"c9ea7612fb9c4e0b6f57c6256da3e67b5a35ae16","modified":1642493417110},{"_id":"source/_posts/python/img/cvread.md","hash":"e85d9a6558355c76dcb1d23c6c918d85721e9ca1","modified":1642493417110},{"_id":"source/_posts/python/img/dcm2nii.md","hash":"9d721a3be87986f58304b1d7de0b6e8a45991b4e","modified":1642493417110},{"_id":"source/_posts/python/img/imageTodocx.md","hash":"4bfcbcbb409fc4a98009a71f5ff2d066344918e3","modified":1642493417111},{"_id":"source/_posts/python/img/pic2video.md","hash":"a14e6c16ddc4e4173c23db01eee62fc1d72732d4","modified":1642493417112},{"_id":"source/_posts/python/pyqt/pyqt-grabwindow.md","hash":"525c137915841b5347542beba74ece4b3e5334e7","modified":1642493417112},{"_id":"source/_posts/python/pyqt/pyqtimg.md","hash":"8d442aaaab8fcd4c2afba94079ad087f9d293431","modified":1642493417113},{"_id":"source/_posts/python/re/re-bracket.md","hash":"33e4174d445ae149db16dc254271da8a3006bdd4","modified":1642493417113},{"_id":"source/_posts/学习笔记/paper/paper-gan.md","hash":"93aa351f4e0737b02e4c9fd2b9ae41c8742c1c5c","modified":1642493417115},{"_id":"source/_posts/学习笔记/paper/paper-site.md","hash":"a3728e53daee32c0a42c66c7888cb18ad8b291c4","modified":1642493417116},{"_id":"source/_posts/学习笔记/paper/brain-pet-paper1.md","hash":"4d2dd8fb5f76b4c5fd71eb01de68e28336bf9af6","modified":1642493417115},{"_id":"source/_posts/学习笔记/实用机器学习/PracticeML2-1.md","hash":"071d529e21afe8416968b5fea968297d66358ebf","modified":1642493417117},{"_id":"source/_posts/学习笔记/实用机器学习/PracticeML2-2.md","hash":"768122f3ea1f04c01e81c26a2f0da1c9680678d7","modified":1642493417117},{"_id":"source/_posts/学习笔记/实用机器学习/PracticeML4.md","hash":"729449239323cc55fcaf14c8e2513faed27aef2c","modified":1642505158365},{"_id":"source/_posts/学习笔记/实用机器学习/PracticeML3.md","hash":"27df1a1565c1c40ca726e297d564d8233b548e05","modified":1642493417118},{"_id":"source/_posts/学习笔记/实用机器学习/praticalML1.md","hash":"c24264c83b24f2d21b15a6e52d46ba16fb82d998","modified":1642493417118},{"_id":"themes/fluid2/source/css/_pages/_category/category.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1642493494279},{"_id":"themes/fluid2/source/css/_pages/_tag/tag.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1642493494282},{"_id":"themes/fluid2/.editorconfig","hash":"b595159772f3ee1ef5e6780ce307270e741cb309","modified":1642493494231},{"_id":"themes/fluid2/.gitignore","hash":"5d7e78749ba0a1efcf61253d4a9e50fc6ce0b4bc","modified":1642493494236},{"_id":"themes/fluid2/.gitattributes","hash":"3e00e1fb043438cd820d94ee3dc9ffb6718996f3","modified":1642493494232},{"_id":"themes/fluid2/README.md","hash":"ed4749a88de9e54fce5bd00e8ac7b3d35969c615","modified":1642493494237},{"_id":"themes/fluid2/_config.yml","hash":"0960c399086a0cbb889dd8666b6c2789aa1a914b","modified":1642493494238},{"_id":"themes/fluid2/LICENSE","hash":"694fb3659a4331dd752bd92e4248623bff8617cd","modified":1642493494237},{"_id":"themes/fluid2/.eslintrc","hash":"3df89453e1f63051fafc90f16a8d83951050e316","modified":1642493494232},{"_id":"themes/fluid2/package.json","hash":"8b6640fe2d7e71900bf708b977074f621b2e7a8a","modified":1642493494258},{"_id":"themes/fluid2/README_en.md","hash":"2b47ed68ec888dcc34fa6aad9ce95aeba6744fec","modified":1642493494237},{"_id":"themes/fluid2/languages/en.yml","hash":"31f2867619a768606166778d4ee51f3d00ac33a0","modified":1642493494240},{"_id":"themes/fluid2/languages/de.yml","hash":"288f649c2c2314eb610693b18853ee74f0541e87","modified":1642493494239},{"_id":"themes/fluid2/languages/eo.yml","hash":"2c1c481d9af116e79fe55a0aa0bdbb143a97f559","modified":1642493494240},{"_id":"themes/fluid2/languages/ja.yml","hash":"dc43be11a300893ebef47283c22f2f946ca21260","modified":1642493494240},{"_id":"themes/fluid2/languages/zh-CN.yml","hash":"3b92f4428d66c31610f6cde13b82ee723aff00d2","modified":1642493494241},{"_id":"themes/fluid2/languages/zh-TW.yml","hash":"de9b7e729d72eee9327671c3d5df0a607c4c3257","modified":1642493494241},{"_id":"themes/fluid2/layout/archive.ejs","hash":"7a1e19dec37804927f0d331d7e6c80ed03becd61","modified":1642493494254},{"_id":"themes/fluid2/layout/404.ejs","hash":"79a598e43c40d48b23076361720f1e77df466e41","modified":1642493494242},{"_id":"themes/fluid2/gulpfile.js","hash":"93e2bd4a4f1902e7a4c99ae3ebfa6420fd906c1b","modified":1642493494239},{"_id":"themes/fluid2/layout/category.ejs","hash":"dd2bd15cbd811d6ea973b6e6a17d99e36151e274","modified":1642493494254},{"_id":"themes/fluid2/layout/index.ejs","hash":"32a6c84b4690ecf8505ca786bc80aa90530b1534","modified":1642493494255},{"_id":"themes/fluid2/layout/about.ejs","hash":"5b6de01c82b14834ab1e67f0a803612f5855f064","modified":1642493494253},{"_id":"themes/fluid2/layout/layout.ejs","hash":"75ee5038231b6b61cc6bcbd8baaea7150475d140","modified":1642493494256},{"_id":"themes/fluid2/layout/categories.ejs","hash":"4255c27c8f31fbcc12ec3a973fe73b7a3a35782f","modified":1642493494254},{"_id":"themes/fluid2/layout/tag.ejs","hash":"3a9296eb7181e8b3fb0cdc60cbafc815b98d6f51","modified":1642493494258},{"_id":"themes/fluid2/layout/links.ejs","hash":"b282e8888cd844bb24b31677a32feb444ecc4144","modified":1642493494256},{"_id":"themes/fluid2/layout/page.ejs","hash":"f867e69e563b8ad83054714f73d9173ea050d93b","modified":1642493494257},{"_id":"themes/fluid2/layout/tags.ejs","hash":"b7c1a6d8fc1097fc16d2300260297013cb692153","modified":1642493494258},{"_id":"themes/fluid2/layout/post.ejs","hash":"edfeb655895027d15334d009324d27a29926cc94","modified":1642493494257},{"_id":"themes/fluid2/.github/ISSUE_TEMPLATE/bug_report.md","hash":"beb3474d6f65c1e56700ba872c6a0d0836d4168e","modified":1642493494233},{"_id":"themes/fluid2/.github/ISSUE_TEMPLATE/bug_report_zh.md","hash":"78ce211415d502c5a4398d786d5c697d34d868b9","modified":1642493494233},{"_id":"themes/fluid2/.github/ISSUE_TEMPLATE/feature_request.md","hash":"5cc30e7b6e7b77c8b40b182ba02a5d93d37d2fc2","modified":1642493494234},{"_id":"themes/fluid2/.github/ISSUE_TEMPLATE/question.md","hash":"102213e5d6790d060c0e26b4a3a7ec744d753c52","modified":1642493494235},{"_id":"themes/fluid2/.github/ISSUE_TEMPLATE/question_zh.md","hash":"18381d03518526d7cefd024a0bdd8d9e7c6440f5","modified":1642493494235},{"_id":"themes/fluid2/.github/workflows/limit.yaml","hash":"bdbdb66da69ab7353b546f02150a6792f4787975","modified":1642493494236},{"_id":"themes/fluid2/.github/ISSUE_TEMPLATE/feature_request_zh.md","hash":"7db378613df2b7d13e8c428c006399a879a4a852","modified":1642493494234},{"_id":"themes/fluid2/layout/_partial/archive-list.ejs","hash":"7d780309e12c437c2f8a246dd2fd0c272b8636ce","modified":1642493494242},{"_id":"themes/fluid2/layout/_partial/beian.ejs","hash":"53d9f79b4a3b71d2e89872fa138bc09611862ee4","modified":1642493494243},{"_id":"themes/fluid2/.github/workflows/lint.yaml","hash":"4c04caa5ca20bbcbf0934bb7adba4d2cd8a26da2","modified":1642493494236},{"_id":"themes/fluid2/layout/_partial/head.ejs","hash":"8e29e7ddbda1555c0f9d0d4b5d4550975fec7537","modified":1642493494248},{"_id":"themes/fluid2/layout/_partial/footer.ejs","hash":"585bb98a23ced3cfbbff6d73d48fdbcd4a87577a","modified":1642493494248},{"_id":"themes/fluid2/layout/_partial/paginator.ejs","hash":"0d443f23c459787338917900f50fec1c8b3b3bdd","modified":1642493494249},{"_id":"themes/fluid2/layout/_partial/nav.ejs","hash":"48944e12d95dc46137f9f270629296cfd2a8dd22","modified":1642493494249},{"_id":"themes/fluid2/layout/_partial/css.ejs","hash":"04957fcd5c9025da54d593652b51939e54056827","modified":1642493494248},{"_id":"themes/fluid2/layout/_partial/search.ejs","hash":"bea21f1b5de61badd6c068080315c201fc80bc36","modified":1642493494252},{"_id":"themes/fluid2/scripts/events/index.js","hash":"91defe82d50a317903411f0b260da0f140f43dc4","modified":1642493494259},{"_id":"themes/fluid2/layout/_partial/toc.ejs","hash":"76e6bc368cf46d4103ea9514699e10ec0b9a4b56","modified":1642493494253},{"_id":"themes/fluid2/layout/_partial/post-meta.ejs","hash":"3f16de8c40d87c7d23eba121dd8061757c3f9a58","modified":1642493494251},{"_id":"themes/fluid2/layout/_partial/scripts.ejs","hash":"1d8349b7d26271e08cee592aa66f9c79ec41c3c0","modified":1642493494252},{"_id":"themes/fluid2/scripts/filters/post-filter.js","hash":"cb72e5acfba882a6eacd6cae8db3238bb078737a","modified":1642493494263},{"_id":"themes/fluid2/scripts/generators/pages.js","hash":"a2a15ea722863aba09dcad578558432682a3b6b3","modified":1642493494264},{"_id":"themes/fluid2/scripts/generators/local-search.js","hash":"bda7fbe58082a2a02c0db066794b791b14462271","modified":1642493494264},{"_id":"themes/fluid2/scripts/tags/button.js","hash":"e1d0caed12e7cd9a35cf64272c41854b2901a58f","modified":1642493494267},{"_id":"themes/fluid2/scripts/tags/checkbox.js","hash":"dac0e08eaa3614a6fd9ddbdfb4584094b1bdb30a","modified":1642493494267},{"_id":"themes/fluid2/scripts/filters/locals.js","hash":"2340a576635b16fd2456b3494f5afe89cd7764db","modified":1642493494263},{"_id":"themes/fluid2/scripts/tags/label.js","hash":"6c5916d86c63795c7e910bf614b0e7ece5073702","modified":1642493494268},{"_id":"themes/fluid2/scripts/tags/group-image.js","hash":"cc176cc1d7e7cc28cedf8397ae748c691d140be2","modified":1642493494268},{"_id":"themes/fluid2/scripts/tags/mermaid.js","hash":"dbfe59fde77d87b1d7d0c46480a2a729010988eb","modified":1642493494268},{"_id":"themes/fluid2/scripts/utils/object.js","hash":"d798779ec79a53ce04b8ac79efd5d064981d95bd","modified":1642493494270},{"_id":"themes/fluid2/scripts/utils/join-path.js","hash":"ec068c699155565aea4aa4ab55d8a10b2947a114","modified":1642493494269},{"_id":"themes/fluid2/scripts/tags/note.js","hash":"8020acc2c4bb3a2054e3cb349fac7cd10b79a0be","modified":1642493494269},{"_id":"themes/fluid2/scripts/helpers/page.js","hash":"49b2c6449d7be35739c6cfea3cab4e790580983a","modified":1642493494265},{"_id":"themes/fluid2/scripts/helpers/export-config.js","hash":"c72a7373c19b730e926b476eb528f651617ac4f2","modified":1642493494265},{"_id":"themes/fluid2/scripts/helpers/url.js","hash":"1664f8faa028898bd6f91d6db61c7dbf7463ee01","modified":1642493494266},{"_id":"themes/fluid2/scripts/helpers/utils.js","hash":"4acb213f90f1e7ba3696ef08d894a2a84807b669","modified":1642493494266},{"_id":"themes/fluid2/layout/_partial/statistics.ejs","hash":"a70c26e415a27f07f38b9384e7eb48d1f2b30328","modified":1642493494253},{"_id":"themes/fluid2/scripts/helpers/wordcount.js","hash":"da6144ee040fed0a9b9f45da3478bc33087b5ac9","modified":1642493494266},{"_id":"themes/fluid2/source/css/main.styl","hash":"bf536db598434c36cc0c752196bfde46e584a92e","modified":1642493494284},{"_id":"themes/fluid2/source/img/avatar.png","hash":"fe739a158cc128f70f780eb5fa96f388b81d478f","modified":1642493494285},{"_id":"themes/fluid2/source/css/gitalk.css","hash":"1fe60b2ab1d704f5a4f55e700dca5b8785fb390e","modified":1642493494284},{"_id":"themes/fluid2/source/img/default.png","hash":"7bb2b8ee07db305bcadee2985b81b942027ae940","modified":1642493494285},{"_id":"themes/fluid2/source/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1642493494286},{"_id":"themes/fluid2/source/img/favicon.png","hash":"64b215db2cb3af98fe639e94537cb5209f959c78","modified":1642493494286},{"_id":"themes/fluid2/source/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1642493494287},{"_id":"themes/fluid2/source/js/boot.js","hash":"5264c0d2eb73b4948ee6bcb1bd847a924d906088","modified":1642493494883},{"_id":"themes/fluid2/source/js/img-lazyload.js","hash":"67f6250f98b36a6599ea982d11cbb060c5ffb92a","modified":1642493494887},{"_id":"themes/fluid2/source/js/events.js","hash":"2c40be98f3471427626b9130fd231bc7e9a66d03","modified":1642493494886},{"_id":"themes/fluid2/source/js/color-schema.js","hash":"2840108a36b1e9a02cd2ed25adcffde08c42e1cc","modified":1642493494884},{"_id":"themes/fluid2/source/js/utils.js","hash":"f20aa828122fce9a76c03b07c7da142704edc8c0","modified":1642493494891},{"_id":"themes/fluid2/source/js/plugins.js","hash":"1afcd1ca415edc994ae813d6f5d54dd3d1888bc4","modified":1642493494891},{"_id":"themes/fluid2/source/js/local-search.js","hash":"3b9322b6b669c870360db468446b00f53bd1b44c","modified":1642493494890},{"_id":"themes/fluid2/layout/_partial/comments/changyan.ejs","hash":"b13e69e555ddec2a71710e07178793e7e13319e7","modified":1642493494243},{"_id":"themes/fluid2/source/js/video_url.json","hash":"883f7f2c9305278df8e682f0732c4237fb46956c","modified":1642493494892},{"_id":"themes/fluid2/source/xml/local-search.xml","hash":"85fcc23b4db654a7f91fc55b6fb0442bb3ed3a9a","modified":1642493494895},{"_id":"themes/fluid2/layout/_partial/comments/livere.ejs","hash":"bcceafab01fe695c59951d939f7cef502f3d7b48","modified":1642493494245},{"_id":"themes/fluid2/source/js/leancloud.js","hash":"ca82e71e31d3d5ef7fe9487756af06d4e27d9b53","modified":1642493494889},{"_id":"themes/fluid2/layout/_partial/comments/gitalk.ejs","hash":"7f04e5c22821bb94da791973d9c6692b03bac81d","modified":1642493494245},{"_id":"themes/fluid2/layout/_partial/comments/remark42.ejs","hash":"45c879768b40ba56af62e18ad54bffbf73a6f3a1","modified":1642493494245},{"_id":"themes/fluid2/layout/_partial/comments/cusdis.ejs","hash":"1e93ca89777e4beb0f0e5cb70e03aab48e958542","modified":1642493494244},{"_id":"themes/fluid2/layout/_partial/comments/disqus.ejs","hash":"7a35381478328b65c9d81827504c4e031bc76a86","modified":1642493494244},{"_id":"themes/fluid2/layout/_partial/comments/twikoo.ejs","hash":"c3297931cf5d3d1bc53d988b74cbc54dd06ebbd7","modified":1642493494246},{"_id":"themes/fluid2/layout/_partial/comments/waline.ejs","hash":"d6f6620fbc6cf3df5a52322378c0d703b7e1fcf9","modified":1642493494247},{"_id":"themes/fluid2/layout/_partial/comments/valine.ejs","hash":"caae3f692523275b8ca1c56c009a6aeb9c7fdc03","modified":1642493494247},{"_id":"themes/fluid2/layout/_partial/plugins/nprogress.ejs","hash":"47c1df255aa552ad71ef3e57deca46530a8f2802","modified":1642493494251},{"_id":"themes/fluid2/layout/_partial/plugins/mermaid.ejs","hash":"fd1f78287c868ccab78b6244b66e3f9b0968c4a8","modified":1642493494250},{"_id":"themes/fluid2/layout/_partial/comments/utterances.ejs","hash":"d1e86754c9560f7346200b2aa9a7f715a3fac82b","modified":1642493494246},{"_id":"themes/fluid2/scripts/events/lib/compatible-configs.js","hash":"c0da20f9adca2761d370cc6dda013ec1ecbb7710","modified":1642493494260},{"_id":"themes/fluid2/scripts/events/lib/footnote.js","hash":"13d8466cd4c98367131b5f3d6a30b3d4ce8de26f","modified":1642493494261},{"_id":"themes/fluid2/scripts/events/lib/hello.js","hash":"1a262c15896663dba773a1796f637f6484f3e524","modified":1642493494261},{"_id":"themes/fluid2/scripts/events/lib/highlight.js","hash":"5eec946182fd537a4d75f15bdf7a09453cc00d83","modified":1642493494261},{"_id":"themes/fluid2/layout/_partial/plugins/math.ejs","hash":"a49a0064b55cf6d8f2a61abfecd41f0083757e04","modified":1642493494250},{"_id":"themes/fluid2/scripts/events/lib/merge-configs.js","hash":"3f2dba4959b27466521de97eff692815650c02b7","modified":1642493494262},{"_id":"themes/fluid2/scripts/events/lib/lazyload.js","hash":"00a4876e9c37b77fed619138b8bd9ad88ea1e9f3","modified":1642493494262},{"_id":"themes/fluid2/source/css/_pages/pages.styl","hash":"92c062cf55457b6549497244d09ec34e9c0c95c2","modified":1642493494283},{"_id":"themes/fluid2/layout/_partial/plugins/analytics.ejs","hash":"d20f54bf2fd5cd274b4b9c5542eafbfec5120838","modified":1642493494250},{"_id":"themes/fluid2/source/css/_functions/base.styl","hash":"171697018fd384fce0834875ca94b91f16564cac","modified":1642493494271},{"_id":"themes/fluid2/source/css/_variables/base.styl","hash":"d555a4c9df7b49250c1747c2fbd8353f2d822775","modified":1642493494283},{"_id":"themes/fluid2/source/css/_pages/_archive/archive.styl","hash":"86926a80bf6f39a7f47789b1a8f44b5984b4683f","modified":1642493494272},{"_id":"themes/fluid2/layout/_partial/plugins/typed.ejs","hash":"c57817ceaee868d416558e56d2a8d0d418c64a2d","modified":1642493494251},{"_id":"themes/fluid2/source/lib/hint/hint.min.css","hash":"64fa8c328dc93432ec822de2818aef21a4f63b29","modified":1642493494894},{"_id":"themes/fluid2/source/css/_mixins/base.styl","hash":"046979dbd8cdabd21d89f9c1d8f1bb3f2fd06d6f","modified":1642493494271},{"_id":"themes/fluid2/source/css/_pages/_about/about.styl","hash":"47235d222812e2f829e9bde039fa719bbced9325","modified":1642493494272},{"_id":"themes/fluid2/source/css/_pages/_base/keyframes.styl","hash":"58a7f8f2baea2d58cf5f7edfc91314ee5d7156ca","modified":1642493494278},{"_id":"themes/fluid2/source/css/_pages/_base/inline.styl","hash":"6f2a3b8af2793dd831f661c6db0ccbe0a62ccc48","modified":1642493494278},{"_id":"themes/fluid2/source/css/_pages/_base/base.styl","hash":"33d237014f22324a034ae463857ce2af72a0d65e","modified":1642493494277},{"_id":"themes/fluid2/source/css/_pages/_base/color-schema.styl","hash":"2dd6f1a8470f5bd10ed53cfcba6811197c79d487","modified":1642493494277},{"_id":"themes/fluid2/source/css/_pages/_base/rewrite.styl","hash":"c628894ec5afab5b3e6f4633390f2b403bf6678f","modified":1642493494278},{"_id":"themes/fluid2/source/css/_pages/_category/categories.styl","hash":"0924e35eff2ec84e2d9e4772abccda452d9463ef","modified":1642493494279},{"_id":"themes/fluid2/source/css/_pages/_links/links.styl","hash":"83694b28209c548ef38bee78e473b02e90cbcf9f","modified":1642493494281},{"_id":"themes/fluid2/source/css/_pages/_index/index.styl","hash":"5775fd234c62a2f3520b34b2a66fe181cc2d4ea3","modified":1642493494280},{"_id":"themes/fluid2/source/css/_pages/_tag/tags.styl","hash":"29e9b72cfda2f2baf9cf2597fcd7f9e66303a9bd","modified":1642493494282},{"_id":"themes/fluid2/source/js/5.0/web3d/clear.cache.gif","hash":"b80b11203d97fe01c5597ca3be70406ea48f5709","modified":1642493494361},{"_id":"themes/fluid2/source/css/_pages/_post/post.styl","hash":"c189a52dbc6eb554d1da3f2636920813b3b7e4fb","modified":1642493494281},{"_id":"themes/fluid2/source/css/_pages/_post/tag_plugin.styl","hash":"88939a09d1ab73a2b96a6b8b08c96ad03d402728","modified":1642493494282},{"_id":"themes/fluid2/source/js/5.0/web3d/sworker.js","hash":"8c8a6e175629f92f1565bc99ff416e553d9c61c8","modified":1642493494882},{"_id":"themes/fluid2/source/js/5.0/web3d/web3d.nocache.js","hash":"16f7ee902d87482fedb41c9ad1d4cd33ed6a477c","modified":1642493494882},{"_id":"themes/fluid2/source/js/5.0/web3d/sworker-locked.js","hash":"442e8de1f4591455368b3fdf6fd349851e89c50f","modified":1642493494880},{"_id":"themes/fluid2/source/css/_pages/_base/_widget/board.styl","hash":"bb9cdde191b9b1287ba19414bab862f30be6a8a0","modified":1642493494274},{"_id":"themes/fluid2/source/css/_pages/_base/_widget/qrcode.styl","hash":"d29064ed8bdf62d5cf4eac32ebdb5d0c7075ebbd","modified":1642493494276},{"_id":"themes/fluid2/source/css/_pages/_base/_widget/footnote.styl","hash":"41935973a66c14ab2bea0539d4b1f15c62534fa4","modified":1642493494275},{"_id":"themes/fluid2/source/css/_pages/_base/_widget/header.styl","hash":"f770c5c3ee89421e9e3f1313ca5bd07a2448f400","modified":1642493494275},{"_id":"themes/fluid2/source/css/_pages/_base/_widget/banner.styl","hash":"da823846f0896f16b21c7430f047f7222a89cd10","modified":1642493494273},{"_id":"themes/fluid2/source/css/_pages/_base/_widget/footer.styl","hash":"dbd0a3518e5bfca92851490b34654f46bb5cfc76","modified":1642493494275},{"_id":"themes/fluid2/source/css/_pages/_base/_widget/copy-btn.styl","hash":"c398892fba1494dd6fd417415076458ed321d34d","modified":1642493494274},{"_id":"themes/fluid2/source/css/_pages/_base/_widget/scroll-btn.styl","hash":"e568f308df26465e0432197e8b57384707470f54","modified":1642493494276},{"_id":"themes/fluid2/source/css/_pages/_base/_widget/search.styl","hash":"1f4e678d7219815ab62de1b92ec75e021247f90b","modified":1642493494276},{"_id":"themes/fluid2/source/js/5.0/web3d/html/opener.html","hash":"3f01511be9da5df96d7cba53b04cf301a3ead5c0","modified":1642493494602},{"_id":"themes/fluid2/source/js/5.0/web3d/html/ggtcallback.html","hash":"8cb0ab174f8e888d0deb336cef2c0826ef0ce6a1","modified":1642493494601},{"_id":"themes/fluid2/source/js/5.0/web3d/html/skydriveproxy.php","hash":"8252ff9eae5ccc8b8568bed79f3c2ca290b63921","modified":1642493494602},{"_id":"themes/fluid2/source/js/5.0/web3d/html/windowslive.html","hash":"88c6f4a605962d7a839b5afdb359bcb9f80724e5","modified":1642493494602},{"_id":"themes/fluid2/source/js/5.0/web3d/js/gl-matrix-min.js","hash":"866e8cada09cb002ce43303d2802312cc45f6248","modified":1642493494603},{"_id":"themes/fluid2/source/js/5.0/web3d/js/workercheck.js","hash":"d745965e9a81fb7a35f11695f5ecc00bbe089995","modified":1642493494870},{"_id":"themes/fluid2/source/js/5.0/web3d/js/webfont.js","hash":"721539eaac2ebd488a80a6e4b8d472fafd520e2b","modified":1642493494869},{"_id":"themes/fluid2/source/js/5.0/web3d/js/zSpace.js","hash":"1a96254f17b7ecdb4f5e6506666fa0cf8141488a","modified":1642493494870},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/10.cache.js","hash":"6e5194198927f8f747ffd26ec1d2a159c8f24ebf","modified":1642493494364},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/14.cache.js","hash":"081fe7b879b22e50cd0a9b122e1b9739427e1b5d","modified":1642493494551},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/4.cache.js","hash":"c3de3e02b11d3e25583d9cd6b097a2782ef81d28","modified":1642493494556},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/6.cache.js","hash":"57ca64ce315abc907e6f480355011c8432baf35f","modified":1642493494558},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnss10.js","hash":"07a1ce77f22a2563e586900b6e8caca766978aa0","modified":1642493494570},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/euler/jlm_eufm10.js","hash":"4b5ae0e5e1da729b0859e9a7224bbefa9fb5cbcf","modified":1642493494576},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/euler/jlm_eufb10.js","hash":"1d3c3c567457a150f27f8c2bea6f2c6a99c6fa2a","modified":1642493494575},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmbi10.js","hash":"ed885eca2df1a7dd206829563efce81cc84afa48","modified":1642493494586},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmi10.js","hash":"731d0e8e9d6ddb21fbdc935b6a0e50a39ad9b249","modified":1642493494587},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmbx10.js","hash":"8f1109703b7a681323ecca9940373b1c476732b3","modified":1642493494587},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_cmr10.js","hash":"077dac4ac5f0511034c9ba7e9d51862c8a8bd58a","modified":1642493494586},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmr10.js","hash":"b5f7a0e6f58a77d87fb14b936edd70ed2bb43f75","modified":1642493494587},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmsb10.js","hash":"9b194e98611a290144d1fa19e6508fa3ae805a74","modified":1642493494588},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmsi10.js","hash":"9b0b8870e74abb4da139d403704e9b3f39f1e062","modified":1642493494588},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmsbi10.js","hash":"21f4825489fedb466ca194f6dc16031ee76c896d","modified":1642493494588},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmtt10.js","hash":"7116f20b590a0435fa1232a3532b6771d36e1079","modified":1642493494589},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/jlm_jlmss10.js","hash":"44199254053d1763e9c15df658050532b2269862","modified":1642493494589},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_cmbsy10.js","hash":"2520d7ccfb0cd61d10d634f97ff9303786ff63a3","modified":1642493494597},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_msam10.js","hash":"011f9f9f7bd9d578bdd2723b7daf97089a12f7c2","modified":1642493494597},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_rsfs10.js","hash":"ada13973e6e968c9bc34651edd29bffc55b22dbb","modified":1642493494599},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/licences/License_for_dsrom.txt","hash":"88bd1ecb66367f374e0373c6daf8bb51108b46ed","modified":1642493494595},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/licences/Knuth_License.txt","hash":"105c0c89c5cbea0a2f4a84551b2959ed08575a17","modified":1642493494595},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_special.js","hash":"04b260a0de703f2813d402b60216b2dd9e8f129a","modified":1642493494599},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_stmary10.js","hash":"dc979dd704addbc796ca198dadf874c023b7f989","modified":1642493494600},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/licences/OFL.txt","hash":"023d12270653afe0d8706a063bfc47c1db8059f6","modified":1642493494595},{"_id":"themes/fluid2/source/js/5.0/web3d/js/zipjs/codecs.js","hash":"f8f8e7c547e2b097d43a9e8c5bad02b8f7c8c54c","modified":1642493494872},{"_id":"themes/fluid2/source/js/5.0/web3d/js/zipjs/pako1.0.6_min.js","hash":"ee0538024b2dcc7670909693ec3cd3543dcfaf69","modified":1642493494877},{"_id":"themes/fluid2/source/js/5.0/web3d/js/zipjs/z-worker.js","hash":"127c5a3479f70f5ca07996d2cd195d6bbcb401f5","modified":1642493494879},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmbx10.js","hash":"a0e89ebb45a12f9233883b8a737c9a4a24c633dc","modified":1642493494590},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmssbx10.js","hash":"f2999dc67503d4d6892fcf60f108c631991a3700","modified":1642493494592},{"_id":"themes/fluid2/source/js/deployggb.js","hash":"d518621cf4b141eee075d9b398abf0f130c44d1d","modified":1642493494885},{"_id":"themes/fluid2/source/js/jquery.js","hash":"29fa5ad995e9ec866ece1d3d0b698fc556580eee","modified":1642493494888},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmssi10.js","hash":"3e300470950026f5763ae50e4c3fa8698378655e","modified":1642493494592},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/optional/jlm_dsrom10.js","hash":"afa082c6fb7042909663d89d6206d2350fd8974c","modified":1642493494601},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/base/jlm_cmmi10.js","hash":"05b260820869b1d18f6c61509f59123764acd092","modified":1642493494565},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/base/jlm_cmmib10.js","hash":"2e4455930cfba2c7bb99ac7f8fa5f326d09de514","modified":1642493494566},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnbx10.js","hash":"da6f0f87603d713cee58242e60c4ac91b7cbbc5b","modified":1642493494567},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnr10.js","hash":"88446b429371e7eee03852efe0c9fae5b8176566","modified":1642493494570},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnssi10.js","hash":"1ca4e11415505e21fc38f5c17dc0978e846167a0","modified":1642493494572},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnssbx10.js","hash":"a5bf88d9813b83ea2834d93a80fd4244a4032f73","modified":1642493494571},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wntt10.js","hash":"9d7229b45e02f659596c831ec3cac9666ab8bb42","modified":1642493494574},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/maths/jlm_msbm10.js","hash":"2f2fff6b5f6ff1fce31edbc8dc22ed26c55b9911","modified":1642493494598},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmtt10.js","hash":"c3fbab7f56b27ab40dc615210fb8d087e98660b9","modified":1642493494594},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmbxti10.js","hash":"5f842daf04d00c1789e332b64d41de51f76e3387","modified":1642493494591},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/latin/optional/jlm_cmti10.js","hash":"95339af0bc2b62348cbb98e8b796981309a71980","modified":1642493494593},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_am.js","hash":"f6e9e7a7fc15f6ce0c669154684262c661779f05","modified":1642493494606},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ar-MA.js","hash":"166dad5b40dca8cf8cca649d8bf206682d95a9db","modified":1642493494608},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ar-TN.js","hash":"8806d01286ab3085789338156977734e04ca1743","modified":1642493494609},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ar.js","hash":"886f615e9eccc0d051e2738c2b739877f8f1979a","modified":1642493494611},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_az.js","hash":"93526a888c0812eda3f9b98a9d5ee9529ad98de4","modified":1642493494612},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_bn.js","hash":"9c2cb08fe7c8e0556203a9ba89e89fe86970886c","modified":1642493494616},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ca.js","hash":"f7cfc6a968e87a53cb16a7c9d142b2d9a3059f9c","modified":1642493494620},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ca-XV.js","hash":"fda9e3063c5e5334a101d3864b3a33bad03efbda","modified":1642493494620},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_cs.js","hash":"941da981453596efbc166119f81c7c0c72417cd6","modified":1642493494622},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_bs.js","hash":"c50f8486f047a00510fcbe1ebb8e55c859820b50","modified":1642493494618},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_cy.js","hash":"692bdf24cabb67d90bc22a885db2ac830b2616c8","modified":1642493494624},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_da.js","hash":"69e9225f535c8f5a1e08890793ce27d580e823d0","modified":1642493494625},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_de-AT.js","hash":"40ac135b5d0d1c5b35d64e0b4688fd16686f9ffa","modified":1642493494627},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_de.js","hash":"3b4b531bc42a7d6ddd8a5566206ab0e9695b487c","modified":1642493494629},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_en-AU.js","hash":"83fba757db880b5014064f9cf62abf5fdf5a6a8b","modified":1642493494633},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_en-GB.js","hash":"ee0243a40a741b8ff2444a5e8cce46a83ca84acc","modified":1642493494634},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_en.js","hash":"7f1840dcc6009eddc1f3703825bd3acacdd50bd5","modified":1642493494635},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_eo.js","hash":"2ec0867650108eb5d29548ee1c5e79064abcbd64","modified":1642493494636},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_es-UY.js","hash":"aea291dba0012ba0a1a3f15d0977d8796328cf57","modified":1642493494639},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_es.js","hash":"3c4f411ba0c6cda16bc3a136f30ddba60022235f","modified":1642493494641},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_es-ES.js","hash":"19cf2225e03dc4645d8b428aa1fc6696ab8957e7","modified":1642493494638},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_et.js","hash":"a05db12d7f2c46751929f6303aaf2cc2fa2e23ac","modified":1642493494643},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_eu.js","hash":"daa1f345d53e80ae64286d3684f99bf8d3366f29","modified":1642493494644},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_fi.js","hash":"490cda1008d6b9edfcf0746e179cf2402dd1349f","modified":1642493494648},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_fa.js","hash":"41ec0f05ce51a582fb9035eba9434a3d5d2bb68b","modified":1642493494646},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_fil.js","hash":"2aef4b985e47fcca035d7d57d75c214f2c8b898c","modified":1642493494650},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_he.js","hash":"b627ac36425f5f28b56b78408d88df36e4037369","modified":1642493494655},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_gl.js","hash":"b437ac7246de7439c4a4e77640c6804dd0c383c4","modified":1642493494653},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_fr.js","hash":"e6e1ce60e6b859557bef70dd9e62a59fa6ca660f","modified":1642493494651},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_hr.js","hash":"5e3dc314e8634d31cc9891a457c66dfe9abf58c7","modified":1642493494659},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_hu.js","hash":"189642d62216579b734850ae0fa1ee563e503d06","modified":1642493494662},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_is.js","hash":"65ad4b02985d2f3dbd793a6bb4209d486d750ef6","modified":1642493494669},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_id.js","hash":"4251bd250ede2c2f17cb638472a86205153b10a8","modified":1642493494667},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_it.js","hash":"4a7a099ac38cf6d4292e0f2e7e2a455a9f4282f9","modified":1642493494670},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ja.js","hash":"0789288569ed7a2c1fd64c7b246c6ce1a1511eec","modified":1642493494672},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_km.js","hash":"aa44350f130e0714beb4047df4219b689098bcb0","modified":1642493494676},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_lt.js","hash":"f60b9179a920892938b95fe4397470fb7ff5add0","modified":1642493494683},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ko.js","hash":"67433c0023afdc32f187fa8ae8cd261dc14ecbba","modified":1642493494681},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_lv.js","hash":"2ad082b399af3897dca56747deb638bee7a81834","modified":1642493494686},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ml.js","hash":"61c06cb43ef349fea863c8489b66acec03dffe84","modified":1642493494690},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_mr.js","hash":"5379c7cbe0fa2bc39c58b7cfb018d87c55de383d","modified":1642493494695},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ms.js","hash":"e56a7cac61240eb5b4df1111170252a178e4ca1f","modified":1642493494697},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_nl-NL.js","hash":"189dd1de885a1f483aef887f11e26ba21e9039e1","modified":1642493494703},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_nb.js","hash":"012689dce5efb43bbbef386f091745103b029c54","modified":1642493494699},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_nl.js","hash":"e35d4ca5c28bb286c57aac4f24fa85cdb9cb15d2","modified":1642493494704},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_nn.js","hash":"1c6b8fa792b5642598cac77cf347765882b05182","modified":1642493494707},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_pt.js","hash":"bdf27a59b921b245907a51819d7b1eb03e56d474","modified":1642493494713},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_pt-PT.js","hash":"74b7d32a3a144c5a09714a232ce35713fa956540","modified":1642493494711},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ro.js","hash":"bc7dba2881a68df810dbf13a1e979e0978ae8507","modified":1642493494715},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_pl.js","hash":"387b308ab2e07aac9915d83ea067c8d730be958d","modified":1642493494709},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_sk.js","hash":"65822513376d69d2068bd88fd174460812de646e","modified":1642493494721},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_sl.js","hash":"e22e366bb7830bb18b1837ced295fab121f4b4c6","modified":1642493494723},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_sr.js","hash":"b936050fb908e52c28d091f4b83c5f4b4cd7df13","modified":1642493494727},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_sq.js","hash":"5cf5edcbc12a6593d5016123e5469127aeea4603","modified":1642493494725},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_sv.js","hash":"85f8ff1e85d929f2955daa91cd179974ae3970d6","modified":1642493494730},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_tg.js","hash":"80caab4970d2ab418edd115315903a54ab2a6292","modified":1642493494740},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_uz.js","hash":"878595399f2a88805819df01d80d877074a63968","modified":1642493494786},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_tr.js","hash":"e4b497b3b94ad0957a198601ce2b6c1a21b80193","modified":1642493494747},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_yi.js","hash":"8ce39b2e1ca422c52a4ca2240887796187322382","modified":1642493494864},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_vi.js","hash":"d62dd87fd1fded522202e8ffbc6d93405999d636","modified":1642493494857},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_xh.js","hash":"7cb84d5b17aab6f0f24ea734adf3c036aaf169e6","modified":1642493494862},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_zh-CN.js","hash":"f6e2eb6332efdb8b53f7d7a51898b475d8319476","modified":1642493494867},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_zh-TW.js","hash":"f597199b838c6986e9267c73ced422b56e9afbac","modified":1642493494868},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/2.cache.js","hash":"d5f1d97021fe50b6e55b7437ffa4b45d750c4822","modified":1642493494552},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/5.cache.js","hash":"c20a87816b343d449e7dc21b00702fdad41edddc","modified":1642493494557},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/9.cache.js","hash":"35db8427e8226fb183f7b856545a1f58460cbd21","modified":1642493494564},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/8.cache.js","hash":"a547af7af40e5b123797d702fa4636cb41d6d49e","modified":1642493494562},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/7.cache.js","hash":"3c19456df0f15acfaa831d7df64f70a4196f7140","modified":1642493494560},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnti10.js","hash":"66da069276b8a75d6db83d61032474616f81e054","modified":1642493494573},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcmbipg.js","hash":"9a2d9698df3b1ccb2120f1bd65db31b4390f145f","modified":1642493494577},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcmbpg.js","hash":"b12e48b042c80d5f6f379e1d8abbc5950d6295f7","modified":1642493494578},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcsrpg.js","hash":"d639e486892af309e8f53f7cfea0e97095d774aa","modified":1642493494584},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_af.js","hash":"d498a7f286145d07f917e7c8b472531cff02ff76","modified":1642493494604},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_bg.js","hash":"c283208e01623dbe78768003cc7bcdb3897f0f1b","modified":1642493494615},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_el.js","hash":"048d6f9571a4210a14cbe2d38d6f5bbfe60c42c5","modified":1642493494631},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_hi.js","hash":"6f7e26bac41db803ee3bff2bc01443aaa9f1da4f","modified":1642493494657},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_hy.js","hash":"a41a9672ecf6dc755ea7954c2f03352a4527a084","modified":1642493494664},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_kk.js","hash":"3e9ba0fdd9a1b6c6e2be0d93006a2a11561da672","modified":1642493494676},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_kn.js","hash":"9c73006a01b7499e0b40be1b6abb41ca13342d7d","modified":1642493494679},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_mk.js","hash":"ec0d2848665337c28a5ba87686a50a739f7d40f8","modified":1642493494688},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_mn.js","hash":"7b0038110e346faf975205046720a9d4a835d825","modified":1642493494692},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ne.js","hash":"c0b913c294ad220c87f46d4eb7db896d8d37e1bc","modified":1642493494701},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ru.js","hash":"8abba2d4a7209f32e08848ef82b544abef957767","modified":1642493494717},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ta.js","hash":"0710cb3992c162a91925d08505ac572e192ff54b","modified":1642493494734},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ug.js","hash":"74e1f2912d3503181197eba0081037cc9ad47de0","modified":1642493494761},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/cyrillic/jlm_wnbxti10.js","hash":"329db1d249f54083f42bf9312e098687127f29fb","modified":1642493494569},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcmripg.js","hash":"7b4738526fa5c6efb98e58db276e8a957814f8c4","modified":1642493494580},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcmrpg.js","hash":"0b3c611253a7c6b04d51edb3943e4b2357474b0d","modified":1642493494581},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcsbpg.js","hash":"8aff085490b314c5e8004addf71534b1c5fbf2fa","modified":1642493494582},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fcsropg.js","hash":"fedd13adb544ab5f100bec147e46e53d495c90bd","modified":1642493494583},{"_id":"themes/fluid2/source/js/5.0/web3d/fonts/greek/jlm_fctrpg.js","hash":"58843194ff1fae4c6a122e1aa2b10bc1880fb609","modified":1642493494585},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_ka.js","hash":"4feff31ead6176a5d67b14c116d64721da95bc35","modified":1642493494674},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_si.js","hash":"bfe548e1b966695fddbe4fff2826af16792e8848","modified":1642493494719},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_uk.js","hash":"ef3343f3a29a9ae544da5c885547441cadffbd56","modified":1642493494783},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/1.cache.js","hash":"348bb593857af480df2434e00a131841c149d542","modified":1642493494363},{"_id":"themes/fluid2/source/js/5.0/web3d/js/properties_keys_th.js","hash":"df4713647267da3b6fc341e77bb7473ca195d320","modified":1642493494745},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/3.cache.js","hash":"7e650db0fda0f9947c25bbae3cb5e968a48cc97d","modified":1642493494555},{"_id":"themes/fluid2/source/img/test.jpg","hash":"6bdc058ef177dd8521b85e19d4e805d5b8f94cad","modified":1642493494295},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/11.cache.js","hash":"6244586110ca219c7cce15b9df65bc7715da7aad","modified":1642493494378},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/12.cache.js","hash":"c1ea01817d7e80feccc6ce88a12c66c6d40a3497","modified":1642493494446},{"_id":"themes/fluid2/source/js/5.0/web3d/18EBAFF235EE31DFDA1EE52C35151A34.cache.js","hash":"4e632d3dcadaead30f3e2452dce11fc7ce9010b6","modified":1642493494359},{"_id":"themes/fluid2/source/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/13.cache.js","hash":"31fe6e57055c821afdcbbdd5ed01d18c27cba6f0","modified":1642493494549},{"_id":"public/search.xml","hash":"b9c135e74a87effe005ea6e705ae5d5fb79999b4","modified":1642506048799},{"_id":"public/local-search.xml","hash":"c35eb31fc91bc54c5b392fccf42a3dae59c1dd6d","modified":1642506048799},{"_id":"public/contact/index.html","hash":"ee45b568fde0ff40124a108c66b25b0318db34f0","modified":1642506048799},{"_id":"public/friends/index.html","hash":"995143f9174cbdb4059b3cc39c0dece8d3b3d552","modified":1642506048799},{"_id":"public/404/index.html","hash":"30ba9d20e2e01fafe01d1a20ecbf5e59b58bc035","modified":1642506048799},{"_id":"public/about/index.html","hash":"b515364a5db1cdc29b422ef4662cdf22ca487b17","modified":1642506048799},{"_id":"public/archives/index.html","hash":"ee0a13e378b6f7f9316ec33b53129803473d5109","modified":1642506048799},{"_id":"public/archives/page/2/index.html","hash":"2841ca8865bcc3787d34cfedf7e38d6e94d2ffa1","modified":1642506048799},{"_id":"public/archives/page/3/index.html","hash":"599c2013091daf6e42bce80a26c0a6cccd84f95e","modified":1642506048799},{"_id":"public/archives/page/4/index.html","hash":"29b42ba4e200c9041965d9ee92e83950fe2cf0e7","modified":1642506048799},{"_id":"public/archives/page/5/index.html","hash":"1dedf92209fb2293787ec39f9da83892cb6213d5","modified":1642506048799},{"_id":"public/archives/page/6/index.html","hash":"12ec0f3d516118303a3bebc5c90174e053a127ed","modified":1642506048799},{"_id":"public/archives/page/7/index.html","hash":"c469879362d9001ee2b1af6bbbac40b89c2eff30","modified":1642506048799},{"_id":"public/archives/page/8/index.html","hash":"ea10eb30857dba6515e60fbefab56fe4ff969608","modified":1642506048799},{"_id":"public/archives/page/9/index.html","hash":"c66128aa1830d1a0898a35dcf2479825ffbfd38f","modified":1642506048799},{"_id":"public/archives/page/10/index.html","hash":"155a51768cc833ddbbd5fc195f02c5fb9512cbad","modified":1642506048799},{"_id":"public/archives/2021/index.html","hash":"c4261ee7771332cb870a0ee916c98d4f8e7605a9","modified":1642506048799},{"_id":"public/archives/2021/page/2/index.html","hash":"d388b4d9bfd5dc7197585364cfd6be8d1684afe5","modified":1642506048799},{"_id":"public/archives/2021/page/3/index.html","hash":"5005039115eaf1e1a103f86a74494e6ca967ce65","modified":1642506048799},{"_id":"public/archives/2021/page/4/index.html","hash":"78af2ec17a30e8f166139bd963679c7ceb80973d","modified":1642506048799},{"_id":"public/archives/2021/page/5/index.html","hash":"8e9de58d0319a6cfac818414f9f40ee327a6e740","modified":1642506048799},{"_id":"public/archives/2021/page/6/index.html","hash":"032950b9b7a7813b39190ed9e0659ab182b3be58","modified":1642506048799},{"_id":"public/archives/2021/page/7/index.html","hash":"304fa3806a0b6703e7fee729e94d00bc9ae08c7f","modified":1642506048799},{"_id":"public/archives/2021/page/8/index.html","hash":"fb16f579f01b25129bdd362ee71673c5b24d6f03","modified":1642506048799},{"_id":"public/archives/2021/page/9/index.html","hash":"59370aa757990a5d2dd0534f1fc368fd7dc4ec5e","modified":1642506048799},{"_id":"public/archives/2021/08/index.html","hash":"135a68da0be5eacb3185d851b3d24d4333bcf45a","modified":1642506048799},{"_id":"public/archives/2021/08/page/2/index.html","hash":"4b81da06901df4ea7ef342dc422f54597ae51676","modified":1642506048799},{"_id":"public/archives/2021/08/page/3/index.html","hash":"c549721d4bab0bc9046ab2c726f87f88f0f6be2c","modified":1642506048799},{"_id":"public/archives/2021/08/page/4/index.html","hash":"99ae46a9f7de043101438dbd3a8e98fb3afd694c","modified":1642506048799},{"_id":"public/archives/2021/08/page/5/index.html","hash":"7d687cfc26904126acb295e7596ed15aae90feeb","modified":1642506048799},{"_id":"public/archives/2021/09/index.html","hash":"918b5ac6f42879f24b013980c60ef3216226a63a","modified":1642506048799},{"_id":"public/archives/2021/10/index.html","hash":"02647b385e73b320140ab7e208a23c7d583a9d15","modified":1642506048799},{"_id":"public/archives/2021/10/page/2/index.html","hash":"74f4735d6287cdcdf8707bf10abc39326e1381b3","modified":1642506048799},{"_id":"public/archives/2021/11/index.html","hash":"9831e9eeb54ee60fdc4d1e47f1fc91a85d562686","modified":1642506048799},{"_id":"public/archives/2021/11/page/2/index.html","hash":"3a12c6396982a60a146a9521ce806736fde99b86","modified":1642506048799},{"_id":"public/archives/2021/12/index.html","hash":"49c14ee81fd9ff1b7e8a6580913d8d6582a9c1e2","modified":1642506048799},{"_id":"public/archives/2021/12/page/2/index.html","hash":"298fe040a89f24c7411f17b7499f59baca996423","modified":1642506048799},{"_id":"public/archives/2022/index.html","hash":"2954708278dc6a189dc482af9bf8e64c04cbec79","modified":1642506048799},{"_id":"public/archives/2022/01/index.html","hash":"2954708278dc6a189dc482af9bf8e64c04cbec79","modified":1642506048799},{"_id":"public/page/12/index.html","hash":"c9c6bc1f05312c70ae7bb4d08febf13fd0b2545c","modified":1642506048799},{"_id":"public/categories/git/index.html","hash":"7f8228a22dec26f2455f20aa2599e09ae6aaf7db","modified":1642506048799},{"_id":"public/categories/配置/index.html","hash":"e7cec44da4ec2a7f3f3bd18203d1277d0c446913","modified":1642506048799},{"_id":"public/categories/docker/index.html","hash":"9f90a278fe229a3f5800f68a271ccfee56654462","modified":1642506048799},{"_id":"public/categories/配置/hexo/index.html","hash":"bb629a50529f7d796b9f4c788c5ed7bd5d5dd6f1","modified":1642506048799},{"_id":"public/categories/深度学习/index.html","hash":"49e03779b97b1fd09cd6113dae64ffe75d00058c","modified":1642506048799},{"_id":"public/categories/dvc/index.html","hash":"df38ca0a4142e121e82db050cbb784a586d78fb4","modified":1642506048799},{"_id":"public/categories/英语/index.html","hash":"c8cebf9a4a341efbfbe48389b2697420576226e0","modified":1642506048799},{"_id":"public/categories/图像处理/index.html","hash":"6525a18d8b95504f2fcd693628d70b5dd21accb3","modified":1642506048799},{"_id":"public/categories/kaggle/index.html","hash":"a523766a4e1762aefcfa790804613d0202dbd512","modified":1642506048799},{"_id":"public/categories/剑指/index.html","hash":"aa1ae9f741524cd35eb6ba850a4fb78e994a61b3","modified":1642506048799},{"_id":"public/categories/剑指/page/2/index.html","hash":"ae00b26f68e9041c68bea7e649b18c167095d05e","modified":1642506048799},{"_id":"public/categories/剑指/page/3/index.html","hash":"4ce416558f5d452fce285697ad27d3ea0aee3ff5","modified":1642506048799},{"_id":"public/categories/剑指/page/4/index.html","hash":"b96c717cb3dfc0a1697bf48f637c6086a2879e5b","modified":1642506048799},{"_id":"public/categories/剑指/page/5/index.html","hash":"ffb28ae2261ab01839e5515043ab5db81f3f88de","modified":1642506048799},{"_id":"public/categories/深度学习/MobileNet/index.html","hash":"7d551a885ab05c4d502db015f693c26387e7197b","modified":1642506048799},{"_id":"public/categories/深度学习/目标检测/index.html","hash":"02a307adb83cd8f234ca68b839bfd221b04f854a","modified":1642506048799},{"_id":"public/categories/剑指/树/index.html","hash":"e785366a210d5dfdf9075ef4d62796cbe5b947c8","modified":1642506048799},{"_id":"public/categories/剑指/排序/index.html","hash":"844d6453414ea131afc020f61f73aac4a76677f4","modified":1642506048799},{"_id":"public/categories/剑指/栈/index.html","hash":"debc6edd55104bf0e2862f2ba3fbf6aab14a15c9","modified":1642506048799},{"_id":"public/categories/剑指/数组/index.html","hash":"173f4ebd751ca41ffe732a510e28c9479e08a9b1","modified":1642506048799},{"_id":"public/categories/剑指/队列/index.html","hash":"daee110c5c247ad9c3c9a3d5336baa870725d997","modified":1642506048799},{"_id":"public/categories/剑指/字符串/index.html","hash":"305d7e3b53352e3a85458d20d3788d5e112c970a","modified":1642506048799},{"_id":"public/categories/剑指/链表/index.html","hash":"eaae6fcce222bab1861a5672462e974b116047c3","modified":1642506048799},{"_id":"public/categories/剑指/递归/index.html","hash":"624a29ae4e4132ef18bf4c3594f4fa5cbe9cd2c4","modified":1642506048799},{"_id":"public/categories/剑指/字典/index.html","hash":"bc86d544f64624f7a9cec5d453063da397f117e4","modified":1642506048799},{"_id":"public/categories/剑指/快速排序/index.html","hash":"abd43cd41185b137aca43550db2ba77f5a25cc68","modified":1642506048799},{"_id":"public/categories/剑指/动态规划/index.html","hash":"5345e668a384a52c14fd2af96e910bb8a7670fe8","modified":1642506048799},{"_id":"public/categories/剑指/哈希表/index.html","hash":"c762236081fc5c721fb7786a5cdb8727421ef237","modified":1642506048799},{"_id":"public/categories/剑指/滑动窗口/index.html","hash":"93fcbeffe5bc2b2b50d489bf9872ea270a1d9682","modified":1642506048799},{"_id":"public/categories/剑指/双指针/index.html","hash":"e69303fd7237496d0b92a24645cdb5041dca4bbb","modified":1642506048799},{"_id":"public/categories/剑指/DFS/index.html","hash":"7ee11285d6fa5886a392cb3fb68664107b657c33","modified":1642506048799},{"_id":"public/categories/math/index.html","hash":"495d852c09d31f97cfc2f12381679aa964fabb65","modified":1642506048799},{"_id":"public/categories/包的使用/index.html","hash":"1334251727d2a4c8feb3fd8c22e68853abb4e7f2","modified":1642506048799},{"_id":"public/categories/项目/index.html","hash":"4e497862475ea2429ab3671965e2b762f68964fe","modified":1642506048799},{"_id":"public/categories/剑指/变量/index.html","hash":"e2cc11caf190e0f45280d9341bd453e55df38f35","modified":1642506048799},{"_id":"public/categories/工具/index.html","hash":"e8734fe0d198251584b66ed2035f854585edd783","modified":1642506048799},{"_id":"public/categories/剑指/快速幂/index.html","hash":"9280207e2f3413ae580312f0576b6533b5b626bb","modified":1642506048799},{"_id":"public/categories/python/index.html","hash":"d1555af4385cf8bcc42e4e080bec2afaf830612b","modified":1642506048799},{"_id":"public/categories/剑指/大数/index.html","hash":"c09648f58ce3ec23c1faa522972858bf5b6ef01f","modified":1642506048799},{"_id":"public/categories/python/page/2/index.html","hash":"348535794c8448eee8e9b6b2c0ef3a97aef8df2a","modified":1642506048799},{"_id":"public/categories/剑指/有限状态机/index.html","hash":"e577a7905e7681ada52e3696c2935a574e8d8665","modified":1642506048799},{"_id":"public/categories/学习笔记/index.html","hash":"17fc6dbb1021bd07791b925f88af6157aefdea7b","modified":1642506048799},{"_id":"public/categories/文献/index.html","hash":"20a921c1457e0986233dba51a9ae97f3c3265af0","modified":1642506048799},{"_id":"public/categories/学习笔记，机器学习/index.html","hash":"5ab4b8583247d0177ff8d83a51941fb05a5f6b90","modified":1642506048799},{"_id":"public/categories/math/线性代数/index.html","hash":"af753df98cfe44dfd576b50d3aea877a04e77996","modified":1642506048799},{"_id":"public/categories/math/概率论/index.html","hash":"d252df79ddb70162897614fe9bb80f2bf8298520","modified":1642506048799},{"_id":"public/categories/工具/pyinstaller/index.html","hash":"469626b0c31d53ec8a18eb606179c0f7d65d040e","modified":1642506048799},{"_id":"public/categories/工具/python-embeded/index.html","hash":"9b66c1bd2d50ca7717612a282fc885e1604f3ebf","modified":1642506048799},{"_id":"public/categories/python/文件/index.html","hash":"761ef38066716e645e4c93c67f299e427f2cfbbb","modified":1642506048799},{"_id":"public/categories/python/图像/index.html","hash":"c6c04353e72ca7381ef5d9b273cc01a843c0fa1c","modified":1642506048799},{"_id":"public/categories/python/pyqt/index.html","hash":"df0a37590eb76d0e6f37b0606add999fffbdc553","modified":1642506048799},{"_id":"public/categories/python/re/index.html","hash":"546a3cf6bba0f010446491311222a9c2d369ad73","modified":1642506048799},{"_id":"public/categories/学习笔记/paper/index.html","hash":"8c4cc37648b21847a2528d6114cdc8c8e64dc765","modified":1642506048799},{"_id":"public/categories/学习笔记/机器学习/index.html","hash":"bfbcf3c98cb698fa17e5c7a4048401b148769442","modified":1642506048799},{"_id":"public/categories/学习笔记/深度学习/index.html","hash":"5259f4846fb33f83567d2cd85020dbf5a249c506","modified":1642506048799},{"_id":"public/categories/深度学习/网络架构/index.html","hash":"2a3a314d888079e7bcb78f89971af16c3614fb1e","modified":1642506048799},{"_id":"public/categories/文献/pet/index.html","hash":"339f3d76e390f7e4f5bd98cb7160d55d0931620f","modified":1642506048799},{"_id":"public/tags/git/index.html","hash":"57c9875df60f98c7584f87729d98dfa9819a5a8d","modified":1642506048799},{"_id":"public/tags/hexo/index.html","hash":"f34235dd1ae6f2247faa3abb0bdd3eaa31c3b501","modified":1642506048799},{"_id":"public/tags/fluid/index.html","hash":"51e9145d039609342cc6d0f4eea3492068de1c38","modified":1642506048799},{"_id":"public/tags/配置/index.html","hash":"1e0045d88cf696258c7b15a6946500002893558a","modified":1642506048799},{"_id":"public/tags/emoji/index.html","hash":"345b1a44305358ed32534df084fe903f13714e55","modified":1642506048799},{"_id":"public/tags/pdf/index.html","hash":"dc305af539d84667d2be4c95707fdfea088d79d3","modified":1642506048799},{"_id":"public/tags/docker/index.html","hash":"8fe966cd39814f199ab3172de51e7e8f81a83225","modified":1642506048799},{"_id":"public/tags/远程配置/index.html","hash":"e2cda20f28a28131f8c1184d0523e4ba32e740e2","modified":1642506048799},{"_id":"public/tags/ssh/index.html","hash":"21684016fe87d1e4c4c8c4032347c69ba2a1f744","modified":1642506048799},{"_id":"public/tags/深度学习/index.html","hash":"22de5c6666431e766c1deb17f70d6862a97ebab5","modified":1642506048799},{"_id":"public/tags/MobileNet/index.html","hash":"52ce2a9266791921b3052039b24206b01e7c2ff6","modified":1642506048799},{"_id":"public/tags/微调/index.html","hash":"33af7da110f284400fcfcc4ba9c76e3ffc64284b","modified":1642506048799},{"_id":"public/tags/深度学习，梯度/index.html","hash":"3ddaed8a075b2a641b4f5ff39d2d1a322fa5f404","modified":1642506048799},{"_id":"public/tags/目标检测/index.html","hash":"2eb3291fcce7363f61fda744e0938cd447858394","modified":1642506048799},{"_id":"public/tags/yolo/index.html","hash":"766bf5f47a31d61fe9a6572af9a5151b38ac27d7","modified":1642506048799},{"_id":"public/tags/dvc/index.html","hash":"32aeb04534b93176dfaab2213a4bf1261f4d0e20","modified":1642506048799},{"_id":"public/tags/英语/index.html","hash":"93ffc437b22fbd70947929c0acd0d56f4373ee6c","modified":1642506048799},{"_id":"public/tags/图像处理/index.html","hash":"f7c94eb6f90ef31388b374db710a47aa00b5e869","modified":1642506048799},{"_id":"public/tags/图像处理，角度/index.html","hash":"638a4677dca317510520fe4d76e7137b824cf2c5","modified":1642506048799},{"_id":"public/tags/kaggle/index.html","hash":"d8fcd0965b29e3950838a46c7e9c559094945e0b","modified":1642506048799},{"_id":"public/tags/剑指/index.html","hash":"4730391ad8744ea3ee1bb4a80fc567d23ec01af0","modified":1642506048799},{"_id":"public/tags/剑指/page/2/index.html","hash":"7058e961582ea9c9f46af4a861a99c656fd20f8d","modified":1642506048799},{"_id":"public/tags/剑指/page/3/index.html","hash":"99118044d117512d30b33050e18d94b1213f90b1","modified":1642506048799},{"_id":"public/tags/剑指/page/4/index.html","hash":"8ed85367fbc83c7c161a14bc9cae9d3a288f3495","modified":1642506048799},{"_id":"public/tags/剑指/page/5/index.html","hash":"ac083775dc8087ab95a229dfb690620267012338","modified":1642506048799},{"_id":"public/tags/排序/index.html","hash":"020d8f419a8400d8cc0f07c904bfb39f3307b652","modified":1642506048799},{"_id":"public/tags/数组/index.html","hash":"63ba3b7ef2ae8ae249dcf049912ff69a687c5e6b","modified":1642506048799},{"_id":"public/tags/idea/index.html","hash":"c8ea374a7af82999533a28600c287d23e4b60fc1","modified":1642506048799},{"_id":"public/tags/数组查找/index.html","hash":"1350c67f4bd1d65d19aa38bdf38a29bbeb306ed7","modified":1642506048799},{"_id":"public/tags/字符串/index.html","hash":"99353a7e4086328785d536009a56c71ddc0848c9","modified":1642506048799},{"_id":"public/tags/树/index.html","hash":"b97e3c30225efc0e5cff5f350820d5dd51caf467","modified":1642506048799},{"_id":"public/tags/链表/index.html","hash":"0c6b16a657b5cb82e8ff1584c18cd4c775a95a92","modified":1642506048799},{"_id":"public/tags/栈/index.html","hash":"6ec0ffd9908bc1998e0f04220647391f490f93b7","modified":1642506048799},{"_id":"public/tags/斐波那契/index.html","hash":"b57dfa09fb18085fd274f4f0223c3f9c215616ae","modified":1642506048799},{"_id":"public/tags/动态规划/index.html","hash":"e036fe1fc7603dda13f9488643efe66918e68e42","modified":1642506048799},{"_id":"public/tags/DFS/index.html","hash":"affa0eab87717f7d2ac3b5b0f880807f981afe04","modified":1642506048799},{"_id":"public/tags/变量/index.html","hash":"06910b3c440410dfb20703e57c4947710ca20cd4","modified":1642506048799},{"_id":"public/tags/快速幂/index.html","hash":"bf1f79388f9c28cc63e1ef7019afa08518374afd","modified":1642506048799},{"_id":"public/tags/大数/index.html","hash":"01fb6d1c5b1bfb428ac446bb453fbd34d7de744b","modified":1642506048799},{"_id":"public/tags/有限状态机/index.html","hash":"e555877489db53e07fb434af6f9c364ad18fb102","modified":1642506048799},{"_id":"public/tags/队列/index.html","hash":"8b0a0a9eba462cf0ad9d52e844abb424a5950f75","modified":1642506048799},{"_id":"public/tags/递归/index.html","hash":"0b88fa23802b19b6ea97138527d10c53ab63b414","modified":1642506048799},{"_id":"public/tags/快速排序/index.html","hash":"3524659cccb5c82f986b05b08980cd1590bcfce2","modified":1642506048799},{"_id":"public/tags/字典/index.html","hash":"651678d5f0dd8b32f991ec7465f91a9c667e26e8","modified":1642506048799},{"_id":"public/tags/哈希表/index.html","hash":"8674e7b85bd5efb6073beb7c003c230f6b1a2066","modified":1642506048799},{"_id":"public/tags/滑动窗口/index.html","hash":"6804e2b4c032dcf6177b97116dc4fb55063ce4e5","modified":1642506048799},{"_id":"public/tags/双指针/index.html","hash":"5a72839eef00170b095952852f8d448d9e04bf8b","modified":1642506048799},{"_id":"public/tags/math/index.html","hash":"c90115cbfb8487e24013f60f14bde550988c43bf","modified":1642506048799},{"_id":"public/tags/线性代数/index.html","hash":"36872b7513fe7de259c5dc08770fd01f33b7b27a","modified":1642506048799},{"_id":"public/tags/概率论/index.html","hash":"b1ce360e83bb78870b3b5f9b1622ef16aa0ac96f","modified":1642506048799},{"_id":"public/tags/马氏距离/index.html","hash":"44965cd4bc001b095502cbdc1e7468ad587d0024","modified":1642506048799},{"_id":"public/tags/numpy/index.html","hash":"59db577e28820f010fa82046afa62d4c8cc29e84","modified":1642506048799},{"_id":"public/tags/项目/index.html","hash":"2ea3a1b85179878c10246f04f8e2375735b93e93","modified":1642506048799},{"_id":"public/tags/项目打包/index.html","hash":"1d0c83e1e861b3027cc91b3f23d0656c178bcce7","modified":1642506048799},{"_id":"public/tags/python/index.html","hash":"9f4d3272e00b96e1717e88601caa3aeed96b99d2","modified":1642506048799},{"_id":"public/tags/python/page/2/index.html","hash":"f2e16f719025e74376a9d6e6613c2520012eb60b","modified":1642506048799},{"_id":"public/tags/Latex/index.html","hash":"25d7c70a9024d1e28f9f28ece13f73cf1b875395","modified":1642506048799},{"_id":"public/tags/文件/index.html","hash":"2ac88bef4a868af2bb19af64b6f80d62237b5c42","modified":1642506048799},{"_id":"public/tags/图像/index.html","hash":"4df2225932cf78edc073834bff83e9eb4b013564","modified":1642506048799},{"_id":"public/tags/pyqt/index.html","hash":"97af83de23ba58d24b0656517df2cca37c060805","modified":1642506048799},{"_id":"public/tags/re/index.html","hash":"23c24c99d51260995831ec93549c4544abfae5a1","modified":1642506048799},{"_id":"public/tags/学习笔记/index.html","hash":"0d6bceacc96b8e811547ba3a7737351b1895b5e4","modified":1642506048799},{"_id":"public/tags/paper/index.html","hash":"255a7d6db1f5973518fd39fd75c3a58cebb1a735","modified":1642506048799},{"_id":"public/tags/文献/index.html","hash":"77a479cff39bc6c5c46c5ea93608137bb0b978c2","modified":1642506048799},{"_id":"public/tags/李沐/index.html","hash":"149734d0bd06aa54ed219a6124bbd768f09c977b","modified":1642506048799},{"_id":"public/tags/机器学习/index.html","hash":"8abe6b5f62ef08932b6f6c4f87044a5e6d2d3b34","modified":1642506048799},{"_id":"public/tags/李宏毅/index.html","hash":"15ed15f13a88bcffa585b1fc013f42d4bd35629c","modified":1642506048799},{"_id":"public/tags/知识蒸馏/index.html","hash":"eb7b8e18ad649c24ccbf52b016103a9907bc6774","modified":1642506048799},{"_id":"public/tags/swin/index.html","hash":"e3f25a9d5ee16b21cf4d696b8dd04f32a02fa329","modified":1642506048799},{"_id":"public/404.html","hash":"f6a7b730be5989a08da18c697b68cba759646fe0","modified":1642506048799},{"_id":"public/links/index.html","hash":"c8670ceea73f96f3cbaae379f46f4dafbf27325e","modified":1642506048799},{"_id":"public/categories/index.html","hash":"e3d380fd94f78d2422369ae8c5a1e1a93cfcba0e","modified":1642506048799},{"_id":"public/tags/index.html","hash":"f922f02a2ac8cef1b7aa6ae1ae043fbe1b283a02","modified":1642506048799},{"_id":"public/2022/01/18/project_tool/quat/index.html","hash":"52cdf3ec246b5330c56d456d1ff870dfa0089087","modified":1642506048799},{"_id":"public/2022/01/17/学习笔记/实用机器学习/PracticeML4/index.html","hash":"72423d01cf55b4c35188190baad6a8554d8e613a","modified":1642506048799},{"_id":"public/2022/01/11/deep_learning/conv3d/index.html","hash":"37d9f2ca6415554fc60106a9bd71ecaf3f367fc0","modified":1642506048799},{"_id":"public/2022/01/10/学习笔记/实用机器学习/PracticeML3/index.html","hash":"e2b5b1692881b5d992ed53cf4be99675550a536d","modified":1642506048799},{"_id":"public/2022/01/06/deep_learning/dsconv/index.html","hash":"a893f85c1f14c7db1f86d2899b9ba14d1eda43d8","modified":1642506048799},{"_id":"public/2022/01/05/deep_learning/KnowledgeDistillation/index.html","hash":"0eef3c174d0f3fafa87d3040433e594a6cb5ff99","modified":1642506048799},{"_id":"public/2022/01/05/leetcode/leetcode17/index.html","hash":"f417f3082344d4b2517abe2cfb2f97a70e6e3165","modified":1642506048799},{"_id":"public/2022/01/04/学习笔记/paper/paper-gan/index.html","hash":"62db35b94ed8cfb73004d7e28d1493476f895a97","modified":1642506048799},{"_id":"public/2022/01/04/leetcode/leetcode-offer58-1/index.html","hash":"c7f680c320d8b2699671875a6557a8b812c5857d","modified":1642506048799},{"_id":"public/2022/01/02/学习笔记/实用机器学习/PracticeML2-2/index.html","hash":"a0eb825afd0375a3d5a3f75937dc4587fbfb0d92","modified":1642506048799},{"_id":"public/2022/01/02/学习笔记/实用机器学习/PracticeML2-1/index.html","hash":"2149156ecf75405d26bd331d823a53de6b4ad857","modified":1642506048799},{"_id":"public/2021/12/30/学习笔记/实用机器学习/praticalML1/index.html","hash":"e21eef1fb79da00114b3ba1cf17e3078f298eb67","modified":1642506048799},{"_id":"public/2021/12/30/leetcode/leetcode-offer57-2/index.html","hash":"70198b9e00ca835eaa5cdfe0e8a5880b6aecb1b9","modified":1642506048799},{"_id":"public/2021/12/29/project_summary/footprint-summary/index.html","hash":"81f420e62772294a31183038d5fa4e947316e0c1","modified":1642506048799},{"_id":"public/2021/12/29/project_tool/usePyembeded/index.html","hash":"625a69c6da2fd10a6d6ab0c875f1b7346ea24177","modified":1642506048799},{"_id":"public/2021/12/28/leetcode/leetcode-offer45/index.html","hash":"ab2c7b23604ac093420745f6681acbeb78064f51","modified":1642506048799},{"_id":"public/2021/12/26/leetcode/leetcode14/index.html","hash":"bfe9707d6a43b5597b1203de9b10d470967cf4f7","modified":1642506048799},{"_id":"public/2021/12/23/leetcode/leetcode-21/index.html","hash":"e13b9440a867b9f854d70accd95f97e7fbebef8f","modified":1642506048799},{"_id":"public/2021/12/16/python/pyqt/pyqt-grabwindow/index.html","hash":"d914d32e9154e281838ce29c406edf8998bd2cd1","modified":1642506048799},{"_id":"public/2021/12/15/python/re/re-bracket/index.html","hash":"fd3df25d480497b4f1b3081d6460005d02f8d749","modified":1642506048799},{"_id":"public/2021/12/10/python/img/imageTodocx/index.html","hash":"412caec439c290b056721380276521b0bfae6305","modified":1642506048799},{"_id":"public/2021/12/09/leetcode/leetcode-offer2-085/index.html","hash":"d5822c100374b44fba21341020b9185a8b02cdb4","modified":1642506048799},{"_id":"public/2021/12/08/leetcode/leetcode-offer56-2/index.html","hash":"d7ba079cebe5e94b8308cdedf42de4608b627e77","modified":1642506048799},{"_id":"public/2021/12/07/leetcode/leetcode-offer53-1/index.html","hash":"beb93af6ae5cac9c416efc6150570e6caeca0be7","modified":1642506048799},{"_id":"public/2021/12/06/leetcode/leetcode-offer34/index.html","hash":"45de6bd19340c3c85f41335a88fa5ddd64bd5a95","modified":1642506048799},{"_id":"public/2021/12/05/leetcode/leetcode-offer372/index.html","hash":"8d4ee7d89b067bc222d63e48dfa73b5575174e7e","modified":1642506048799},{"_id":"public/2021/12/04/leetcode/leetcode-offer33/index.html","hash":"4e88eeb675b1060f3240e7098a4511712786ac07","modified":1642506048799},{"_id":"public/2021/11/26/python/img/dcm2nii/index.html","hash":"60c73d5d77acc4a9c74ea51e46831f289c9b5fe9","modified":1642506048799},{"_id":"public/2021/11/25/python/file/fileprocess/index.html","hash":"9a761bdc8152cd5ee62ce78fa20f87fbdb66117f","modified":1642506048799},{"_id":"public/2021/11/24/leetcode/leetcode20/index.html","hash":"33e66ab189f3410296bbcee6a57ef39f2dae8a15","modified":1642506048799},{"_id":"public/2021/11/23/leetcode/leetcode-offer859/index.html","hash":"ba3676fecd73504977b8c015a0928808d4b86cc7","modified":1642506048799},{"_id":"public/2021/11/22/leetcode/leetcode-offer32-3/index.html","hash":"6c62476b723c8659a97917cbf195637e0652dc8b","modified":1642506048799},{"_id":"public/2021/11/21/leetcode/leetcode-offer32-1/index.html","hash":"0dc5da5e1916c2fa8828d5423b7ca63ee33faad1","modified":1642506048799},{"_id":"public/2021/11/20/leetcode/leetcode-offer38/index.html","hash":"792bcdb7acdd1a1de133273391768b958ba7a2b4","modified":1642506048799},{"_id":"public/2021/11/19/leetcode/leetcode-offer31/index.html","hash":"96686fb45dffbe93a4ebdd8377180111060d713f","modified":1642506048799},{"_id":"public/2021/11/18/leetcode/leetcode-offer563/index.html","hash":"dbe46c04384033281715699f6fabaa132c59e2ac","modified":1642506048799},{"_id":"public/2021/11/17/leetcode/leetcode-offer57/index.html","hash":"a4509bfc6010f9e09d1365e9ff830ffad7de90f8","modified":1642506048799},{"_id":"public/2021/11/16/leetcode/leetcode-offer55-1/index.html","hash":"74afffd7bff48e6cc4c97ef877100d6d9d726d87","modified":1642506048799},{"_id":"public/2021/11/15/leetcode/leetcode-offer50/index.html","hash":"66277f1572e9108d56d607e365cfdd84cd94ebae","modified":1642506048799},{"_id":"public/2021/11/12/leetcode/leetcode-offer32/index.html","hash":"78d29304cc45011e643dfeba68e0327bd8106958","modified":1642506048799},{"_id":"public/2021/11/04/leetcode/leetcode-offer39/index.html","hash":"c125c158991e918c0990cb6eb18fd36683932e41","modified":1642506048799},{"_id":"public/2021/11/03/学习笔记/paper/brain-pet-paper1/index.html","hash":"ab90f418a93fadea4587915a2613152f3b455fc2","modified":1642506048799},{"_id":"public/2021/10/30/python/img/pic2video/index.html","hash":"3d5c960b4aa412e93ff7fd91ece4c70309e3c86c","modified":1642506048799},{"_id":"public/2021/10/29/python/func/squeeze/index.html","hash":"3c7bf6eca50ff9c91825289a75b6b16c13748516","modified":1642506048799},{"_id":"public/2021/10/26/python/getppi/index.html","hash":"557bfbf5cb3f390d56476fcfce2ebfed1818ef48","modified":1642506048799},{"_id":"public/2021/10/21/kaggle/kaggle-data-intro/index.html","hash":"f70ea59fbaa88f482d57b1412dc7a435d9c3b43f","modified":1642506048799},{"_id":"public/2021/10/21/kaggle/kaggle-intro/index.html","hash":"5b5690a2c22fba996717f3df177bb5578b4171c8","modified":1642506048799},{"_id":"public/2021/10/21/python/pyqt/pyqtimg/index.html","hash":"2290252c1a10117ed317a46d31cbcc4d7fa8c568","modified":1642506048799},{"_id":"public/2021/10/20/python/img/cvread/index.html","hash":"b2587f0c1288e115d23cd8d42cf5d00d26b59249","modified":1642506048799},{"_id":"public/2021/10/08/leetcode/leetcode-offer36/index.html","hash":"d66ef4af9e7c2166ec97c0ea82e430e362f789ed","modified":1642506048799},{"_id":"public/2021/10/08/project_tool/pipenv/index.html","hash":"863222e089102730e282afe36c40876908d50f5a","modified":1642506048799},{"_id":"public/2021/10/07/python/file/split-filename/index.html","hash":"7f09d00f246f4a79f5e1ad002f88897bdbca9437","modified":1642506048799},{"_id":"public/2021/10/06/python/file/delete-file/index.html","hash":"3f7be5ebcc23c6f30f52c590e4cf5128eb0962b5","modified":1642506048799},{"_id":"public/2021/10/06/leetcode/leetcode-offer42/index.html","hash":"efce1c9034f3c22e8c4d919b0ab4c7b3520f291b","modified":1642506048799},{"_id":"public/2021/10/06/python/img/FPDF/index.html","hash":"495889a847b44174af66504166335a7862e17425","modified":1642506048799},{"_id":"public/2021/09/29/project_tool/pyinstaller-spec-problem/index.html","hash":"175ac82b2eeddc8f59459a710982e910ee1d8893","modified":1642506048799},{"_id":"public/2021/09/28/project_tool/spec/index.html","hash":"f526707389943c2f5d1a0595e487fccc59e7002f","modified":1642506048799},{"_id":"public/2021/09/26/project_tool/pyinstaller/index.html","hash":"a6fc545c4d0effd1c25ef648dca0beeeef789c69","modified":1642506048799},{"_id":"public/2021/09/17/leetcode/leetcode-offer30/index.html","hash":"2f27d32c3622e47332f8de9684cc0731ced57b22","modified":1642506048799},{"_id":"public/2021/09/16/leetcode/leetcode-offer35/index.html","hash":"873a8d6dc0b7e7a9ba1159781aa04592203f98a3","modified":1642506048799},{"_id":"public/2021/09/09/package_usage/random-summarize/index.html","hash":"2141a8b28c4f88e18aba2ed76cda788ff8ce9929","modified":1642506048799},{"_id":"public/2021/09/08/img_process/getAngle/index.html","hash":"0b445c5ec5755bedef292443a6ba4349dce1b421","modified":1642506048799},{"_id":"public/2021/08/27/deep_learning/yolov2/index.html","hash":"ef24cab81edd435bd1c7e456643b939907f47e69","modified":1642506048799},{"_id":"public/2021/08/25/config/pdf-config/index.html","hash":"6e8fd9d9e6ee093f51449066e1f92761a0d0fd7f","modified":1642506048799},{"_id":"public/2021/08/25/deep_learning/swin/index.html","hash":"a9a37944b10fad25ebffd60829be923e3bc7a3ea","modified":1642506048799},{"_id":"public/2021/08/24/leetcode/leetcode-offer40/index.html","hash":"9d678097479975d67ba2735f03887fd87c13fb96","modified":1642506048799},{"_id":"public/2021/08/24/config/hexo-emoji/index.html","hash":"235a2e390fabe78a95cfd50d6f31b656c14770f0","modified":1642506048799},{"_id":"public/2021/08/21/deep_learning/yolov1/index.html","hash":"e42f21cda011ccb2e08e5e8d12bb032c56b926d7","modified":1642506048799},{"_id":"public/2021/08/21/leetcode/leetcode-offer19/index.html","hash":"6776457baf2bf68681a704b42f4d41b2573d7e0d","modified":1642506048799},{"_id":"public/2021/08/21/leetcode/leetcode-offer18/index.html","hash":"2abcf26a72a138efce7cdbff7e317e7ffabe007a","modified":1642506048799},{"_id":"public/2021/08/21/leetcode/leetcode-offer24/index.html","hash":"904b644d4d093965045ffbdb76085cdbe4e5362f","modified":1642506048799},{"_id":"public/2021/08/21/leetcode/leetcode-offer16/index.html","hash":"42d7f52b23f887b3e6c2773cca369876d80c3919","modified":1642506048799},{"_id":"public/2021/08/20/leetcode/leetcode-offer17/index.html","hash":"32783337c401d35f21001d8190f62135a1e41083","modified":1642506048799},{"_id":"public/2021/08/20/img_process/laplace/index.html","hash":"018fad1fa8e88df68cbf5623aa89209b13f8e53d","modified":1642506048799},{"_id":"public/2021/08/20/leetcode/leetcode-offer22/index.html","hash":"0994c13d01d56134e218bf15d0af99e214584d4c","modified":1642506048799},{"_id":"public/2021/08/19/english/self-aware/index.html","hash":"3192a4f9d6856ae0f8a6aa29da157a6dd6e2b5be","modified":1642506048799},{"_id":"public/2021/08/19/leetcode/leetcode-offer29/index.html","hash":"599c56884b66c15aa557adb01eb0ebfcd6eb8904","modified":1642506048799},{"_id":"public/2021/08/19/leetcode/leetcode-offer15/index.html","hash":"100f54586a5e6e0443392eb8919d8bc3800f02fb","modified":1642506048799},{"_id":"public/2021/08/19/leetcode/leetcode-offer20/index.html","hash":"7e3b2d926febd1a10b3021eb19fb85b2209f7311","modified":1642506048799},{"_id":"public/2021/08/18/leetcode/leetcode-offer21/index.html","hash":"6b0be93d1dcce1d8e36f63988271b84804e2e7a3","modified":1642506048799},{"_id":"public/2021/08/18/leetcode/leetcode-offer28/index.html","hash":"1fc82752121df76fc70dceefb35b6fda32d8fc70","modified":1642506048799},{"_id":"public/2021/08/18/leetcode/leetcode-offer26/index.html","hash":"f18ae40e8cf8dc916529462f87c3db2826c1ab8c","modified":1642506048799},{"_id":"public/2021/08/18/leetcode/leetcode-offer14-2/index.html","hash":"21eee09e28449eed8abfe1e5f79c948bb9cc6056","modified":1642506048799},{"_id":"public/2021/08/17/leetcode/leetcode-offer14-1/index.html","hash":"a0fa0ebdcac94c71a1ac8414cab20ba215bd1356","modified":1642506048799},{"_id":"public/2021/08/17/leetcode/leetcode-offer07/index.html","hash":"12f740f42c715537d22cd3748103ffb7080b38e2","modified":1642506048799},{"_id":"public/2021/08/17/deep_learning/gradient-exp/index.html","hash":"a91ef328a5a3dd715c8dd497b4ce99d5b5fd4607","modified":1642506048799},{"_id":"public/2021/08/16/leetcode/leetcode-offer27/index.html","hash":"663c3df3fdd13f9a7fa29445cf68e633b2440503","modified":1642506048799},{"_id":"public/2021/08/16/leetcode/leetcode-offer25/index.html","hash":"910e147fdb5ae96a9411ef826239b955e2891ac6","modified":1642506048799},{"_id":"public/2021/08/14/leetcode/leetcode-offer13/index.html","hash":"b59205d6eb2d823f398ab0a4a4f6baee37c34e07","modified":1642506048799},{"_id":"public/2021/08/14/img_process/sobel/index.html","hash":"6fb541fd612fef602e87968410405f8a7253997f","modified":1642506048799},{"_id":"public/2021/08/14/leetcode/leetcode-offer06/index.html","hash":"f925a28ed3c64d3026ec550b1341743a614e9c8e","modified":1642506048799},{"_id":"public/2021/08/14/leetcode/leetcode-offer12/index.html","hash":"5a421750674e7214f7f56be917b7a60003fb6c39","modified":1642506048799},{"_id":"public/2021/08/13/leetcode/leetcode-offer11/index.html","hash":"f0444829c858e159081309a36d3cf702f8913df3","modified":1642506048799},{"_id":"public/2021/08/13/学习笔记/paper/paper-site/index.html","hash":"ef75bd7bbdf3ac55f7b099374316f584f7ca2a5f","modified":1642506048799},{"_id":"public/2021/08/13/deep_learning/fine-tuning/index.html","hash":"3a78406ce515963676f778a7ce6c042cfb0a5d39","modified":1642506048799},{"_id":"public/2021/08/12/deep_learning/gradient-clip/index.html","hash":"241e0455a2c198883a15617c89b3518c6853c6a1","modified":1642506048799},{"_id":"public/2021/08/11/leetcode/leetcode-offer05/index.html","hash":"60b096ad410975b6da3af996e75356b0a470ca9b","modified":1642506048799},{"_id":"public/2021/08/11/leetcode/leetcode-offer04/index.html","hash":"67dd5f30187c044544af86c6fb215fe2c5a018b8","modified":1642506048799},{"_id":"public/2021/08/11/leetcode/leetcode-offer03/index.html","hash":"fb672117803fbfdd47fb808e15f8c41fbffc00a1","modified":1642506048799},{"_id":"public/2021/08/10/dvc/dvc-config/index.html","hash":"da6a2ec6df5b6393579fbcf6a6bc0a9afd8974d7","modified":1642506048799},{"_id":"public/2021/08/10/docker/docker-ssh/index.html","hash":"c4886ab562918ee4c20bd6b26ec85568ccdd7944","modified":1642506048799},{"_id":"public/2021/08/10/docker/docker-intro/index.html","hash":"39188d9079d6bc89392da1703743b2a0c1d12e7f","modified":1642506048799},{"_id":"public/2021/08/10/leetcode/leetcode-offer10-2/index.html","hash":"7ae6a2306bd2c1acd771bf11c77845d0594afafa","modified":1642506048799},{"_id":"public/2021/08/10/leetcode/leetcode-offer10-1/index.html","hash":"0a4fdcf22b4b22dae28c143f41fca68bda7fea22","modified":1642506048799},{"_id":"public/2021/08/10/leetcode/leetcode-offer09/index.html","hash":"a5dc03969d4848b9c40565edb89a9d40c0a95aca","modified":1642506048799},{"_id":"public/2021/08/09/math/Mahalanobis-distance/index.html","hash":"6b5264af19e249bda739d8c0e346cdc9c070efca","modified":1642506048799},{"_id":"public/2021/08/09/math/Eckark-young/index.html","hash":"824cd34cdbfc8ddd7f52b136112d6431f9f63746","modified":1642506048799},{"_id":"public/2021/08/06/math/low-rank-app/index.html","hash":"52bedf9d5ce8e83f0d4f84ea9e38e9e1e64e7c43","modified":1642506048799},{"_id":"public/2021/08/06/config/git-submodule/index.html","hash":"d64cb11f40106d1b626cf72af19c3c4998411bbf","modified":1642506048799},{"_id":"public/2021/08/05/config/hexo-math-config/index.html","hash":"dccaf675c294f7f1df528530b88b4bbfad8c285e","modified":1642506048799},{"_id":"public/2021/08/05/math/covariance-matrix/index.html","hash":"a778f1da330c828d38f4736e788f7e1fc66c4eba","modified":1642506048799},{"_id":"public/index.html","hash":"3297cfc6a7ba123a870f4ed9bab3e7acaab71eea","modified":1642506048799},{"_id":"public/page/2/index.html","hash":"2f368f870d6464737261f96be589cdc6f80a69ba","modified":1642506048799},{"_id":"public/page/3/index.html","hash":"134e5939ed52876ef2c15c9320ef5c5f20e7337e","modified":1642506048799},{"_id":"public/page/4/index.html","hash":"e17267250db0148fb4865e2a3301a3e2ec7f3d75","modified":1642506048799},{"_id":"public/page/5/index.html","hash":"28c6cf532a96c5463f11689bbccb40ae83d162cb","modified":1642506048799},{"_id":"public/page/6/index.html","hash":"7bc8a47b8dcab2311d24cd3977927a78cf0a5aeb","modified":1642506048799},{"_id":"public/page/7/index.html","hash":"af35fa6f8195116a1e772724c04ddec761ca839d","modified":1642506048799},{"_id":"public/page/8/index.html","hash":"ab5b6407068ba989c8fab8e68c0b4916b6fb5c92","modified":1642506048799},{"_id":"public/page/9/index.html","hash":"24084bd84a2f46cd54fc8e103e11e750e1b712a9","modified":1642506048799},{"_id":"public/page/10/index.html","hash":"dfabe258bb315c320df17ee7a1d1a6c3517b3434","modified":1642506048799},{"_id":"public/page/11/index.html","hash":"70ad80f7e3a3a5dc39e1c10e4caa7dac003a339b","modified":1642506048799},{"_id":"public/CNAME","hash":"f5776ace0c267af3c5acde0ed1be1754175ad6ff","modified":1642506048799},{"_id":"public/img/default.png","hash":"7bb2b8ee07db305bcadee2985b81b942027ae940","modified":1642506048799},{"_id":"public/img/avatar.png","hash":"fe739a158cc128f70f780eb5fa96f388b81d478f","modified":1642506048799},{"_id":"public/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1642506048799},{"_id":"public/img/favicon.png","hash":"64b215db2cb3af98fe639e94537cb5209f959c78","modified":1642506048799},{"_id":"public/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1642506048799},{"_id":"public/xml/local-search.xml","hash":"85fcc23b4db654a7f91fc55b6fb0442bb3ed3a9a","modified":1642506048799},{"_id":"public/js/5.0/web3d/clear.cache.gif","hash":"b80b11203d97fe01c5597ca3be70406ea48f5709","modified":1642506048799},{"_id":"public/js/5.0/web3d/html/skydriveproxy.php","hash":"8252ff9eae5ccc8b8568bed79f3c2ca290b63921","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/licences/License_for_dsrom.txt","hash":"88bd1ecb66367f374e0373c6daf8bb51108b46ed","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/licences/Knuth_License.txt","hash":"105c0c89c5cbea0a2f4a84551b2959ed08575a17","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/licences/OFL.txt","hash":"023d12270653afe0d8706a063bfc47c1db8059f6","modified":1642506048799},{"_id":"public/live2dw/assets/mtn/01.mtn","hash":"fb550833ae22c9954c3e01df37ed29b2d61700f2","modified":1642506048799},{"_id":"public/live2dw/assets/mtn/00_idle.mtn","hash":"b224c60e463b9f71ddbfc0c720e430496c175f4f","modified":1642506048799},{"_id":"public/live2dw/assets/mtn/02.mtn","hash":"7eafc52edc73b7cb80ae70d34b43c6ac778fa47b","modified":1642506048799},{"_id":"public/live2dw/assets/mtn/03.mtn","hash":"f900737c7a98441cbb2e05255427e6260e19ae68","modified":1642506048799},{"_id":"public/live2dw/assets/mtn/04.mtn","hash":"c7a25d3c5d783639bae18db2f3cd284b819c3c85","modified":1642506048799},{"_id":"public/live2dw/assets/mtn/05.mtn","hash":"dd20ad24b5d1830a5d44b9bccb28f922eea5e0e5","modified":1642506048799},{"_id":"public/live2dw/assets/tororo.model.json","hash":"3b96ea33460642d288c98327444966d93a0c11ba","modified":1642506048799},{"_id":"public/live2dw/assets/mtn/06.mtn","hash":"ad404bd852d276cdd3d054c953e23f90e4e45ae1","modified":1642506048799},{"_id":"public/live2dw/assets/tororo.pose.json","hash":"81438bf69b32c7c11e311b4fe043730cdc7b7ec2","modified":1642506048799},{"_id":"public/live2dw/lib/L2Dwidget.min.js","hash":"77b9cffc61987bd179b7ba289eb1e5296d8ef345","modified":1642506048799},{"_id":"public/live2dw/assets/mtn/07.mtn","hash":"b7f2e3a9fa4f3ffbb6e64a08f8d9f45ca1868ffb","modified":1642506048799},{"_id":"public/live2dw/assets/mtn/08.mtn","hash":"4411c7651ff65195b113d95e7d5ebef8a59a37d9","modified":1642506048799},{"_id":"public/live2dw/lib/L2Dwidget.min.js.map","hash":"3290fe2df45f065b51a1cd7b24ec325cbf9bb5ce","modified":1642506048799},{"_id":"public/css/main.css","hash":"bf7b61acb0f60f43cf343fed01575b3ce40b2138","modified":1642506048799},{"_id":"public/live2dw/assets/moc/tororo.moc","hash":"44289e62545a7046e0f5231103a851750b78524e","modified":1642506048799},{"_id":"public/live2dw/lib/L2Dwidget.0.min.js","hash":"94121cfcd4d0911a8314ab98efa7440dbabafe37","modified":1642506048799},{"_id":"public/css/gitalk.css","hash":"a57b3cc8e04a0a4a27aefa07facf5b5e7bca0e76","modified":1642506048799},{"_id":"public/js/boot.js","hash":"3de344ee619da989f6dccf7c2ae459fe91075983","modified":1642506048799},{"_id":"public/js/events.js","hash":"4b9d2676c9544db9cc40a8c7d18456792299ba86","modified":1642506048799},{"_id":"public/js/color-schema.js","hash":"cc712fc71bf33d561e1ba74fe1d52d2353092171","modified":1642506048799},{"_id":"public/js/img-lazyload.js","hash":"cbdeca434ec4da51f488c821d51b4d23c73294af","modified":1642506048799},{"_id":"public/js/plugins.js","hash":"342b1fbc30d1465687ce389a4e07f967266d5d86","modified":1642506048799},{"_id":"public/js/utils.js","hash":"9d492fab9c26311ad0ab553c890e09b9575a76f2","modified":1642506048799},{"_id":"public/js/local-search.js","hash":"bf00f5786bb8de7241f635455b67243d26656222","modified":1642506048799},{"_id":"public/js/video_url.json","hash":"75bdab914a95afb7f10d786b26fe7b5be30355c5","modified":1642506048799},{"_id":"public/js/leancloud.js","hash":"b7985ac3cff9ee2722db43ee6b32b5484c43f5f2","modified":1642506048799},{"_id":"public/lib/hint/hint.min.css","hash":"b38df228460ebfb4c0b6085336ee2878fe85aafe","modified":1642506048799},{"_id":"public/js/5.0/web3d/sworker.js","hash":"8c8a6e175629f92f1565bc99ff416e553d9c61c8","modified":1642506048799},{"_id":"public/js/5.0/web3d/web3d.nocache.js","hash":"fd06fb4ba3f37e7b3fd4fd6854a770d3b32edba2","modified":1642506048799},{"_id":"public/js/5.0/web3d/sworker-locked.js","hash":"442e8de1f4591455368b3fdf6fd349851e89c50f","modified":1642506048799},{"_id":"public/js/5.0/web3d/html/ggtcallback.html","hash":"21a2e9ace6f47d8900b95f774910b9e57778cbd2","modified":1642506048799},{"_id":"public/js/5.0/web3d/html/opener.html","hash":"a8844181acd2930d92fd1548cc6f954cc3f23642","modified":1642506048799},{"_id":"public/js/5.0/web3d/html/windowslive.html","hash":"db5dcdc1f7ac9b1a1cd692badd9384f7c194c107","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/workercheck.js","hash":"d745965e9a81fb7a35f11695f5ecc00bbe089995","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/14.cache.js","hash":"aa631dedd1388bef750012e41b3a99d844dc4c23","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/jlm_jlmbi10.js","hash":"ed885eca2df1a7dd206829563efce81cc84afa48","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/jlm_jlmi10.js","hash":"731d0e8e9d6ddb21fbdc935b6a0e50a39ad9b249","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/jlm_jlmbx10.js","hash":"8f1109703b7a681323ecca9940373b1c476732b3","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/jlm_jlmr10.js","hash":"b5f7a0e6f58a77d87fb14b936edd70ed2bb43f75","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/jlm_jlmsbi10.js","hash":"21f4825489fedb466ca194f6dc16031ee76c896d","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/jlm_jlmss10.js","hash":"44199254053d1763e9c15df658050532b2269862","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/jlm_jlmtt10.js","hash":"7116f20b590a0435fa1232a3532b6771d36e1079","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/jlm_jlmsb10.js","hash":"9b194e98611a290144d1fa19e6508fa3ae805a74","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/jlm_jlmsi10.js","hash":"9b0b8870e74abb4da139d403704e9b3f39f1e062","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/maths/jlm_special.js","hash":"04b260a0de703f2813d402b60216b2dd9e8f129a","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/zipjs/codecs.js","hash":"f8f8e7c547e2b097d43a9e8c5bad02b8f7c8c54c","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/zipjs/z-worker.js","hash":"127c5a3479f70f5ca07996d2cd195d6bbcb401f5","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/webfont.js","hash":"721539eaac2ebd488a80a6e4b8d472fafd520e2b","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/10.cache.js","hash":"278456389654606e2b610244dd40430f057c34a8","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/zSpace.js","hash":"1a96254f17b7ecdb4f5e6506666fa0cf8141488a","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/maths/jlm_rsfs10.js","hash":"ada13973e6e968c9bc34651edd29bffc55b22dbb","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/maths/optional/jlm_dsrom10.js","hash":"afa082c6fb7042909663d89d6206d2350fd8974c","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/zipjs/pako1.0.6_min.js","hash":"ee0538024b2dcc7670909693ec3cd3543dcfaf69","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/optional/jlm_cmssi10.js","hash":"3e300470950026f5763ae50e4c3fa8698378655e","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/gl-matrix-min.js","hash":"866e8cada09cb002ce43303d2802312cc45f6248","modified":1642506048799},{"_id":"public/live2dw/assets/moc/tororo.2048/texture_00.png","hash":"98af764b541083e87fc2f8e85f02d2db38c898cc","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/4.cache.js","hash":"5ed2b2a63d0896bef4004419a28555a14c2feebd","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/6.cache.js","hash":"af61d1b6297f3f4a112561ebf6b4e7b35fcaec67","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/cyrillic/jlm_wnss10.js","hash":"07a1ce77f22a2563e586900b6e8caca766978aa0","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/jlm_cmr10.js","hash":"077dac4ac5f0511034c9ba7e9d51862c8a8bd58a","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/maths/jlm_cmbsy10.js","hash":"2520d7ccfb0cd61d10d634f97ff9303786ff63a3","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/euler/jlm_eufm10.js","hash":"4b5ae0e5e1da729b0859e9a7224bbefa9fb5cbcf","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/euler/jlm_eufb10.js","hash":"1d3c3c567457a150f27f8c2bea6f2c6a99c6fa2a","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/maths/jlm_msam10.js","hash":"011f9f9f7bd9d578bdd2723b7daf97089a12f7c2","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/maths/jlm_stmary10.js","hash":"dc979dd704addbc796ca198dadf874c023b7f989","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/optional/jlm_cmbx10.js","hash":"a0e89ebb45a12f9233883b8a737c9a4a24c633dc","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/optional/jlm_cmssbx10.js","hash":"f2999dc67503d4d6892fcf60f108c631991a3700","modified":1642506048799},{"_id":"public/js/deployggb.js","hash":"fe4ff1e4b14177d3b675a01fe4fef4fcd9cf9322","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/base/jlm_cmmi10.js","hash":"05b260820869b1d18f6c61509f59123764acd092","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/cyrillic/jlm_wnssi10.js","hash":"1ca4e11415505e21fc38f5c17dc0978e846167a0","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/maths/jlm_msbm10.js","hash":"2f2fff6b5f6ff1fce31edbc8dc22ed26c55b9911","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/optional/jlm_cmtt10.js","hash":"c3fbab7f56b27ab40dc615210fb8d087e98660b9","modified":1642506048799},{"_id":"public/js/jquery.js","hash":"d2cc8d43ce1c854b1172e42b1209502ad563db83","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/base/jlm_cmmib10.js","hash":"2e4455930cfba2c7bb99ac7f8fa5f326d09de514","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/cyrillic/jlm_wnssbx10.js","hash":"a5bf88d9813b83ea2834d93a80fd4244a4032f73","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/cyrillic/jlm_wnbx10.js","hash":"da6f0f87603d713cee58242e60c4ac91b7cbbc5b","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/cyrillic/jlm_wntt10.js","hash":"9d7229b45e02f659596c831ec3cac9666ab8bb42","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/optional/jlm_cmti10.js","hash":"95339af0bc2b62348cbb98e8b796981309a71980","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/latin/optional/jlm_cmbxti10.js","hash":"5f842daf04d00c1789e332b64d41de51f76e3387","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/cyrillic/jlm_wnr10.js","hash":"88446b429371e7eee03852efe0c9fae5b8176566","modified":1642506048799},{"_id":"public/live2dw/lib/L2Dwidget.0.min.js.map","hash":"35e71cc2a130199efb167b9a06939576602f0d75","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_af.js","hash":"d498a7f286145d07f917e7c8b472531cff02ff76","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_en-AU.js","hash":"83fba757db880b5014064f9cf62abf5fdf5a6a8b","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_en.js","hash":"7f1840dcc6009eddc1f3703825bd3acacdd50bd5","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_en-GB.js","hash":"ee0243a40a741b8ff2444a5e8cce46a83ca84acc","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_eo.js","hash":"2ec0867650108eb5d29548ee1c5e79064abcbd64","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_zh-TW.js","hash":"f597199b838c6986e9267c73ced422b56e9afbac","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/2.cache.js","hash":"5a481031daf899e04806fad2229f53912c6394fd","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/5.cache.js","hash":"c623f80692ab4b6e7419ecca36259f24c664d395","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/7.cache.js","hash":"e111a411de07019e4815de95fd28c296a38e1ec9","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/greek/jlm_fcsrpg.js","hash":"d639e486892af309e8f53f7cfea0e97095d774aa","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/greek/jlm_fcsbpg.js","hash":"8aff085490b314c5e8004addf71534b1c5fbf2fa","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ca.js","hash":"f7cfc6a968e87a53cb16a7c9d142b2d9a3059f9c","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_az.js","hash":"93526a888c0812eda3f9b98a9d5ee9529ad98de4","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_bn.js","hash":"9c2cb08fe7c8e0556203a9ba89e89fe86970886c","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ca-XV.js","hash":"fda9e3063c5e5334a101d3864b3a33bad03efbda","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_cy.js","hash":"692bdf24cabb67d90bc22a885db2ac830b2616c8","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_cs.js","hash":"941da981453596efbc166119f81c7c0c72417cd6","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_da.js","hash":"69e9225f535c8f5a1e08890793ce27d580e823d0","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_bs.js","hash":"c50f8486f047a00510fcbe1ebb8e55c859820b50","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_de.js","hash":"3b4b531bc42a7d6ddd8a5566206ab0e9695b487c","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_de-AT.js","hash":"40ac135b5d0d1c5b35d64e0b4688fd16686f9ffa","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_es-ES.js","hash":"19cf2225e03dc4645d8b428aa1fc6696ab8957e7","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_es-UY.js","hash":"aea291dba0012ba0a1a3f15d0977d8796328cf57","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_et.js","hash":"a05db12d7f2c46751929f6303aaf2cc2fa2e23ac","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_fil.js","hash":"2aef4b985e47fcca035d7d57d75c214f2c8b898c","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_fi.js","hash":"490cda1008d6b9edfcf0746e179cf2402dd1349f","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_eu.js","hash":"daa1f345d53e80ae64286d3684f99bf8d3366f29","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_gl.js","hash":"b437ac7246de7439c4a4e77640c6804dd0c383c4","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_fr.js","hash":"e6e1ce60e6b859557bef70dd9e62a59fa6ca660f","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_es.js","hash":"3c4f411ba0c6cda16bc3a136f30ddba60022235f","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_hu.js","hash":"189642d62216579b734850ae0fa1ee563e503d06","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ja.js","hash":"0789288569ed7a2c1fd64c7b246c6ce1a1511eec","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_km.js","hash":"aa44350f130e0714beb4047df4219b689098bcb0","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_hr.js","hash":"5e3dc314e8634d31cc9891a457c66dfe9abf58c7","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_it.js","hash":"4a7a099ac38cf6d4292e0f2e7e2a455a9f4282f9","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_id.js","hash":"4251bd250ede2c2f17cb638472a86205153b10a8","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_is.js","hash":"65ad4b02985d2f3dbd793a6bb4209d486d750ef6","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_lt.js","hash":"f60b9179a920892938b95fe4397470fb7ff5add0","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ml.js","hash":"61c06cb43ef349fea863c8489b66acec03dffe84","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ko.js","hash":"67433c0023afdc32f187fa8ae8cd261dc14ecbba","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ms.js","hash":"e56a7cac61240eb5b4df1111170252a178e4ca1f","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_lv.js","hash":"2ad082b399af3897dca56747deb638bee7a81834","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_nl.js","hash":"e35d4ca5c28bb286c57aac4f24fa85cdb9cb15d2","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_nb.js","hash":"012689dce5efb43bbbef386f091745103b029c54","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_nl-NL.js","hash":"189dd1de885a1f483aef887f11e26ba21e9039e1","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_pt.js","hash":"bdf27a59b921b245907a51819d7b1eb03e56d474","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_nn.js","hash":"1c6b8fa792b5642598cac77cf347765882b05182","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ro.js","hash":"bc7dba2881a68df810dbf13a1e979e0978ae8507","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_sk.js","hash":"65822513376d69d2068bd88fd174460812de646e","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_sq.js","hash":"5cf5edcbc12a6593d5016123e5469127aeea4603","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_pt-PT.js","hash":"74b7d32a3a144c5a09714a232ce35713fa956540","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_pl.js","hash":"387b308ab2e07aac9915d83ea067c8d730be958d","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_sl.js","hash":"e22e366bb7830bb18b1837ced295fab121f4b4c6","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_sr.js","hash":"b936050fb908e52c28d091f4b83c5f4b4cd7df13","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_sv.js","hash":"85f8ff1e85d929f2955daa91cd179974ae3970d6","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_tg.js","hash":"80caab4970d2ab418edd115315903a54ab2a6292","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_tr.js","hash":"e4b497b3b94ad0957a198601ce2b6c1a21b80193","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_uz.js","hash":"878595399f2a88805819df01d80d877074a63968","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_zh-CN.js","hash":"f6e2eb6332efdb8b53f7d7a51898b475d8319476","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_xh.js","hash":"7cb84d5b17aab6f0f24ea734adf3c036aaf169e6","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/cyrillic/jlm_wnbxti10.js","hash":"329db1d249f54083f42bf9312e098687127f29fb","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/cyrillic/jlm_wnti10.js","hash":"66da069276b8a75d6db83d61032474616f81e054","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/greek/jlm_fcsropg.js","hash":"fedd13adb544ab5f100bec147e46e53d495c90bd","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_am.js","hash":"f6e9e7a7fc15f6ce0c669154684262c661779f05","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ar-MA.js","hash":"166dad5b40dca8cf8cca649d8bf206682d95a9db","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ar.js","hash":"886f615e9eccc0d051e2738c2b739877f8f1979a","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ar-TN.js","hash":"8806d01286ab3085789338156977734e04ca1743","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_fa.js","hash":"41ec0f05ce51a582fb9035eba9434a3d5d2bb68b","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_he.js","hash":"b627ac36425f5f28b56b78408d88df36e4037369","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_mr.js","hash":"5379c7cbe0fa2bc39c58b7cfb018d87c55de383d","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_vi.js","hash":"d62dd87fd1fded522202e8ffbc6d93405999d636","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/9.cache.js","hash":"a5a10d642fe8c429d5f80adc7988e888aea071df","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/8.cache.js","hash":"c39a285af7fa1ff060b648096c7edf3c1c734eae","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/greek/jlm_fctrpg.js","hash":"58843194ff1fae4c6a122e1aa2b10bc1880fb609","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_yi.js","hash":"8ce39b2e1ca422c52a4ca2240887796187322382","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/greek/jlm_fcmbipg.js","hash":"9a2d9698df3b1ccb2120f1bd65db31b4390f145f","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/greek/jlm_fcmbpg.js","hash":"b12e48b042c80d5f6f379e1d8abbc5950d6295f7","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/greek/jlm_fcmrpg.js","hash":"0b3c611253a7c6b04d51edb3943e4b2357474b0d","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_hy.js","hash":"a41a9672ecf6dc755ea7954c2f03352a4527a084","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_kk.js","hash":"3e9ba0fdd9a1b6c6e2be0d93006a2a11561da672","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_mk.js","hash":"ec0d2848665337c28a5ba87686a50a739f7d40f8","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ru.js","hash":"8abba2d4a7209f32e08848ef82b544abef957767","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_si.js","hash":"bfe548e1b966695fddbe4fff2826af16792e8848","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ta.js","hash":"0710cb3992c162a91925d08505ac572e192ff54b","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_uk.js","hash":"ef3343f3a29a9ae544da5c885547441cadffbd56","modified":1642506048799},{"_id":"public/js/5.0/web3d/fonts/greek/jlm_fcmripg.js","hash":"7b4738526fa5c6efb98e58db276e8a957814f8c4","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_bg.js","hash":"c283208e01623dbe78768003cc7bcdb3897f0f1b","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_el.js","hash":"048d6f9571a4210a14cbe2d38d6f5bbfe60c42c5","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_kn.js","hash":"9c73006a01b7499e0b40be1b6abb41ca13342d7d","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_mn.js","hash":"7b0038110e346faf975205046720a9d4a835d825","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ne.js","hash":"c0b913c294ad220c87f46d4eb7db896d8d37e1bc","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ug.js","hash":"74e1f2912d3503181197eba0081037cc9ad47de0","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_hi.js","hash":"6f7e26bac41db803ee3bff2bc01443aaa9f1da4f","modified":1642506048799},{"_id":"public/img/test.jpg","hash":"6bdc058ef177dd8521b85e19d4e805d5b8f94cad","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_th.js","hash":"df4713647267da3b6fc341e77bb7473ca195d320","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/1.cache.js","hash":"9b363a0e1476027b80ba8c525f58e5df67470ef5","modified":1642506048799},{"_id":"public/js/5.0/web3d/js/properties_keys_ka.js","hash":"4feff31ead6176a5d67b14c116d64721da95bc35","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/3.cache.js","hash":"29266c1c6d6b5285abc91c3e0b8f8ca5d32cee10","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/11.cache.js","hash":"f805327b99d8da194944daf1772da0151a297e99","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/12.cache.js","hash":"e367d315d54764835418fb66aaaf48e51dd7777b","modified":1642506048799},{"_id":"public/js/5.0/web3d/18EBAFF235EE31DFDA1EE52C35151A34.cache.js","hash":"9321184d1ade1f26d8b3720b4b18f22cf9750c8a","modified":1642506048799},{"_id":"public/js/5.0/web3d/deferredjs/18EBAFF235EE31DFDA1EE52C35151A34/13.cache.js","hash":"70a70ad83dff7b2dfd0b850d6b75f6d39b962e75","modified":1642506048799}],"Category":[{"name":"git","_id":"ckyk1p0600009ast9hin55zzn"},{"name":"配置","_id":"ckyk1p068000east9b15ke2bv"},{"name":"docker","_id":"ckyk1p078000sast935nn0ud0"},{"name":"hexo","parent":"ckyk1p068000east9b15ke2bv","_id":"ckyk1p07l0014ast99jnmcilm"},{"name":"深度学习","_id":"ckyk1p07s001bast98h7n8hny"},{"name":"dvc","_id":"ckyk1p08x002iast9fi7h2oxv"},{"name":"英语","_id":"ckyk1p096002tast9aktrdtq8"},{"name":"图像处理","_id":"ckyk1p099002zast99trjaqr0"},{"name":"kaggle","_id":"ckyk1p09h003aast925fv19fk"},{"name":"剑指","_id":"ckyk1p09m003jast9hcprfhm3"},{"name":"MobileNet","parent":"ckyk1p07s001bast98h7n8hny","_id":"ckyk1p09q003oast9fldi8yg9"},{"name":"目标检测","parent":"ckyk1p07s001bast98h7n8hny","_id":"ckyk1p0bb005kast9ehhj7i8l"},{"name":"树","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0cx007xast9do8q9r3y"},{"name":"排序","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0cz0081ast90si08enu"},{"name":"栈","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0d00084ast92vd17iex"},{"name":"数组","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0d1008aast9h00fdp0y"},{"name":"队列","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0dc0093ast9emub1xah"},{"name":"字符串","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0dh009fast9924dghsh"},{"name":"链表","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0dx00a2ast9beg18el7"},{"name":"递归","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0e300a9ast936xu46jx"},{"name":"字典","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0e600aeast94n4039hm"},{"name":"快速排序","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0ef00aoast9dw6m4ndh"},{"name":"动态规划","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0ei00auast9eodv7360"},{"name":"哈希表","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0eo00b8ast95o5df7qk"},{"name":"滑动窗口","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0f400c7ast94yfzc05w"},{"name":"双指针","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0f600cdast9c8d1cii6"},{"name":"DFS","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0fa00ciast9ad8o3pg9"},{"name":"math","_id":"ckyk1p0fp00dbast9akjxb5ka"},{"name":"包的使用","_id":"ckyk1p0fw00drast98q84b6iv"},{"name":"项目","_id":"ckyk1p0g300e5ast94rx55bye"},{"name":"变量","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0g500e9ast991xtfgwq"},{"name":"工具","_id":"ckyk1p0g700ecast94fqjekkc"},{"name":"快速幂","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0gb00emast98nkre4av"},{"name":"python","_id":"ckyk1p0gf00etast962qifrco"},{"name":"大数","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0gq00fbast9c8eze7vh"},{"name":"有限状态机","parent":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0h800gbast9f88j622v"},{"name":"学习笔记","_id":"ckyk1p0hn00h1ast9gznyeytz"},{"name":"文献","_id":"ckyk1p0hp00h5ast96gbh8p54"},{"name":"学习笔记，机器学习","_id":"ckyk1p0i600hzast987tydhiz"},{"name":"线性代数","parent":"ckyk1p0fp00dbast9akjxb5ka","_id":"ckyk1p0i700i3ast99goq7ffr"},{"name":"概率论","parent":"ckyk1p0fp00dbast9akjxb5ka","_id":"ckyk1p0ia00i8ast91ppqbxcm"},{"name":"pyinstaller","parent":"ckyk1p0g700ecast94fqjekkc","_id":"ckyk1p0ih00ilast9dz4gfubh"},{"name":"python-embeded","parent":"ckyk1p0g700ecast94fqjekkc","_id":"ckyk1p0ir00j2ast9epwjey7p"},{"name":"文件","parent":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0iv00j7ast9a878bf55"},{"name":"图像","parent":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0j200joast93ffz8ztp"},{"name":"pyqt","parent":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0jd00kcast969qe2490"},{"name":"re","parent":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0je00khast9b5dwdk7e"},{"name":"paper","parent":"ckyk1p0hn00h1ast9gznyeytz","_id":"ckyk1p0jh00knast9hq6v0ub0"},{"name":"机器学习","parent":"ckyk1p0hn00h1ast9gznyeytz","_id":"ckyk1p0jj00krast95dcgalgo"},{"name":"深度学习","parent":"ckyk1p0hn00h1ast9gznyeytz","_id":"ckyk1p0l900ntast96r44bzn9"},{"name":"网络架构","parent":"ckyk1p07s001bast98h7n8hny","_id":"ckyk1p0lg00o8ast9bzlseldv"},{"name":"pet","parent":"ckyk1p0hp00h5ast96gbh8p54","_id":"ckyk1p0lh00oaast9djo0bdwp"}],"Data":[{"_id":"friends","data":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}],"Page":[{"title":"文章类别","date":"2021-08-03T11:38:47.000Z","type":"categories","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 文章类别\ndate: 2021-08-03 19:38:47\ntype: \"categories\"\nlayout: \"categories\"\n---\n","updated":"2022-01-18T08:10:17.120Z","path":"categories/index.html","comments":1,"_id":"ckyk1p04o0000ast91dcz0qru","content":"","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":""},{"title":"contact","date":"2021-08-04T07:52:31.000Z","type":"contact","layout":"contact","_content":"","source":"contact/index.md","raw":"---\ntitle: contact\ndate: 2021-08-04 15:52:31\ntype: \"contact\"\nlayout: \"contact\"\n---\n","updated":"2022-01-18T08:10:17.121Z","path":"contact/index.html","comments":1,"_id":"ckyk1p04t0001ast9fdtq9rq2","content":"","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":""},{"title":"404","date":"2021-08-04T07:56:32.000Z","type":"404","layout":"404","description":"Oops～，我崩溃了！找不到你想要的页面 :(","_content":"","source":"404/index.md","raw":"---\ntitle: 404\ndate: 2021-08-04 15:56:32\ntype: \"404\"\nlayout: \"404\"\ndescription: \"Oops～，我崩溃了！找不到你想要的页面 :(\"\n---\n","updated":"2022-01-18T08:10:17.040Z","path":"404/index.html","comments":1,"_id":"ckyk1p04u0002ast9373b2xgl","content":"","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":""},{"title":"小站自述","date":"2021-08-03T11:39:55.000Z","type":"about","layout":"about","_content":"","source":"about/index.md","raw":"---\ntitle: 小站自述\ndate: 2021-08-03 19:39:55\ntype: \"about\"\nlayout: \"about\"\n---\n","updated":"2022-01-18T08:10:17.119Z","path":"about/index.html","comments":1,"_id":"ckyk1p05q0003ast953ao0iq3","content":"","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":""},{"title":"friends","date":"2021-08-04T07:59:30.000Z","type":"friends","layout":"friends","_content":"\n","source":"friends/index.md","raw":"---\ntitle: friends\ndate: 2021-08-04 15:59:30\ntype: \"friends\"\nlayout: \"friends\"\n---\n\n","updated":"2022-01-18T08:10:17.122Z","path":"friends/index.html","comments":1,"_id":"ckyk1p05u0005ast9h0vu7boh","content":"","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":""},{"title":"article","date":"2021-08-03T11:33:47.000Z","type":"tags","layout":"tags","_content":"\n","source":"tags/index.md","raw":"---\ntitle: article\ndate: 2021-08-03 19:33:47\ntype: \"tags\"\nlayout: \"tags\"\n---\n\n","updated":"2022-01-18T08:10:17.122Z","path":"tags/index.html","comments":1,"_id":"ckyk1p05x0007ast9dg5ihuqc","content":"","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":""}],"Post":[{"title":"yolov3","date":"2021-09-08T09:04:15.000Z","_content":"\n## 概述\n\n> 本文。\n\n<!--more-->\n\n## 正文","source":"_drafts/yolov3.md","raw":"---\ntitle: yolov3\ndate: 2021-09-08 17:04:15\ntags:\ncategories:\n---\n\n## 概述\n\n> 本文。\n\n<!--more-->\n\n## 正文","slug":"yolov3","published":0,"updated":"2022-01-18T08:10:17.042Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p05q0004ast9aodncxjq","content":"<h2 id=\"概述\">概述</h2>\n<blockquote>\n<p>本文。</p>\n</blockquote>\n<span id=\"more\"></span>\n<h2 id=\"正文\">正文</h2>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"<h2 id=\"概述\">概述</h2>\n<blockquote>\n<p>本文。</p>\n</blockquote>","more":"<h2 id=\"正文\">正文</h2>"},{"title":"子模块为空的解决方案","date":"2021-08-05T18:09:00.000Z","_content":"\n> 针对子模块文件夹为空的情况，采取下列解决方案。\n>\n> 当一个 git 项目包含子模块（submodule) 时，直接克隆下来的子模块目录里面是空的。\n\n**有两种方法解决**：\n\n### 方法一\n\n如果项目已经克隆到了本地，执行下面的步骤：\n\n1. 初始化本地子模块配置文件\n\n   ```\n   git submodule init\n   ```\n   \n2. 更新项目，抓取子模块内容。\n\n   ```\n   git submodule update\n   ```\n\n3. 进入对应子模块目录，执行\n\n   ```\n   git submodule update --init --recursive\n   ```\n\n### 方法二\n\n另外一种更简单的方法，就是在执行 `git clone` 时加上 `--recursive` 参数。它会自动初始化并更新每一个子模块。例如：\n\n```\ngit clone --recursive https://github.com/example/example.git\n```\n\n","source":"_posts/config/git-submodule.md","raw":"---\ntitle: 子模块为空的解决方案\ndate: 2021-08-06 02:09:00\ntags: git\ncategories: git\n---\n\n> 针对子模块文件夹为空的情况，采取下列解决方案。\n>\n> 当一个 git 项目包含子模块（submodule) 时，直接克隆下来的子模块目录里面是空的。\n\n**有两种方法解决**：\n\n### 方法一\n\n如果项目已经克隆到了本地，执行下面的步骤：\n\n1. 初始化本地子模块配置文件\n\n   ```\n   git submodule init\n   ```\n   \n2. 更新项目，抓取子模块内容。\n\n   ```\n   git submodule update\n   ```\n\n3. 进入对应子模块目录，执行\n\n   ```\n   git submodule update --init --recursive\n   ```\n\n### 方法二\n\n另外一种更简单的方法，就是在执行 `git clone` 时加上 `--recursive` 参数。它会自动初始化并更新每一个子模块。例如：\n\n```\ngit clone --recursive https://github.com/example/example.git\n```\n\n","slug":"config/git-submodule","published":1,"updated":"2022-01-18T08:10:17.044Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p05v0006ast99rmbh8yi","content":"<blockquote>\n<p>针对子模块文件夹为空的情况，采取下列解决方案。</p>\n<p>当一个 git 项目包含子模块（submodule) 时，直接克隆下来的子模块目录里面是空的。</p>\n</blockquote>\n<p><strong>有两种方法解决</strong>：</p>\n<h3 id=\"方法一\">方法一</h3>\n<p>如果项目已经克隆到了本地，执行下面的步骤：</p>\n<ol>\n<li>\n<p>初始化本地子模块配置文件</p>\n<figure class=\"highlight csharp\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs csharp\">git submodule <span class=\"hljs-keyword\">init</span><br></code></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>更新项目，抓取子模块内容。</p>\n<figure class=\"highlight ebnf\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ebnf\"><span class=\"hljs-attribute\">git submodule update</span><br></code></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>进入对应子模块目录，执行</p>\n<figure class=\"highlight brainfuck\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs brainfuck\"><span class=\"hljs-comment\">git</span> <span class=\"hljs-comment\">submodule</span> <span class=\"hljs-comment\">update</span> --<span class=\"hljs-comment\">init</span> --<span class=\"hljs-comment\">recursive</span><br></code></pre></td></tr></tbody></table></figure>\n</li>\n</ol>\n<h3 id=\"方法二\">方法二</h3>\n<p>另外一种更简单的方法，就是在执行 <code>git clone</code> 时加上 <code>--recursive</code> 参数。它会自动初始化并更新每一个子模块。例如：</p>\n<figure class=\"highlight awk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\">git clone --recursive https:<span class=\"hljs-regexp\">//gi</span>thub.com<span class=\"hljs-regexp\">/example/</span>example.git<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>针对子模块文件夹为空的情况，采取下列解决方案。</p>\n<p>当一个 git 项目包含子模块（submodule) 时，直接克隆下来的子模块目录里面是空的。</p>\n</blockquote>\n<p><strong>有两种方法解决</strong>：</p>\n<h3 id=\"方法一\">方法一</h3>\n<p>如果项目已经克隆到了本地，执行下面的步骤：</p>\n<ol>\n<li>\n<p>初始化本地子模块配置文件</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs csharp\">git submodule <span class=\"hljs-keyword\">init</span><br></code></pre></td></tr></table></figure>\n</li>\n<li>\n<p>更新项目，抓取子模块内容。</p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ebnf\"><span class=\"hljs-attribute\">git submodule update</span><br></code></pre></td></tr></table></figure>\n</li>\n<li>\n<p>进入对应子模块目录，执行</p>\n<figure class=\"highlight brainfuck\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs brainfuck\"><span class=\"hljs-comment\">git</span> <span class=\"hljs-comment\">submodule</span> <span class=\"hljs-comment\">update</span> --<span class=\"hljs-comment\">init</span> --<span class=\"hljs-comment\">recursive</span><br></code></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"方法二\">方法二</h3>\n<p>另外一种更简单的方法，就是在执行 <code>git clone</code> 时加上 <code>--recursive</code> 参数。它会自动初始化并更新每一个子模块。例如：</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\">git clone --recursive https:<span class=\"hljs-regexp\">//gi</span>thub.com<span class=\"hljs-regexp\">/example/</span>example.git<br></code></pre></td></tr></table></figure>\n"},{"title":"hexo中公式显示","date":"2021-08-05T12:38:51.000Z","math":true,"_content":"\n> 公式的显示问题。Hexo中Mathjax是用于显示公式的插件，但是多行显示会出现问题，有时还会出现乱码的情况。\n\n### 配置\n\n在根目录下的config\\_fluid.yml​文件中打开math的相关配置。\n\n```yaml\n  # 数学公式，开启之前需要更换 Markdown 渲染器，否则复杂公式会有兼容问题，具体请见：https://hexo.fluid-dev.com/docs/guide/##latex-数学公式\n  # Mathematical formula. If enable, you need to change the Markdown renderer, see: https://hexo.fluid-dev.com/docs/en/guide/#math\n  math:\n    # 开启后文章默认可用，自定义页面如需使用，需在 Front-matter 中指定 `math: true`\n    # If you want to use math on the custom page, you need to set `math: true` in Front-matter\n    enable: true\n\n    # 开启后，只有在文章 Front-matter 里指定 `math: true` 才会在文章页启动公式转换，以便在页面不包含公式时提高加载速度\n    # If true, only set `math: true` in Front-matter will enable math, to load faster when the page does not contain math\n    specific: true\n\n    # Options: mathjax | katex\n    engine: mathjax\n\n```\n\n### 出现的问题\n\n#### 问题1\n\n- 由于hexo解码时关注{{，}}，%% 等连续字符，会将这部分代码解读为其他带有特殊含义的内容\n- 如果公式中恰巧出现了此类字符，会报出上述错误\n\n#### 问题2\n\n- 由于hexo在公式中的`\\\\`错会成了转义符，也就是说他只看见了一个反斜杠，不会执行换行命令，导致公式堆成一行\n\n### 解决方案\n\n#### 临时方案\n\n##### 针对问题1\n\n- 可以在连续的 `{` `}` `%`中间插入空格，分开就没事了\n\n##### 针对问题2\n\n- 可以将`\\\\`换成`\\\\\\\\`，可以实现公式的多行正确显示\n\n#### 终极方案\n\n- 在官方文档中提到了可以为hexo提供标记，阻止其按照自己的规则解释我们的字符串，显示其原本的含义\n\n- 标记为\n\n  ```\n  {% raw %}\n  $$\n  ...\n  $$\n  {% endraw %}\n  ```\n\n### 多行显示和对齐\n- 默认是显示为一行要实现公式多行和对齐可以使用{aligned}模式，使用\"&\"来标记对齐位置。\"\\\\\\\\\"表示换行\n\n    ```\n    $$\n    \\begin{aligned}\n    \\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\t&=\\boldsymbol{x}^{\\mathrm{T}}\\mathrm{E}\\left[\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\right]\\boldsymbol{x} \t\n    \\\\&=\\mathrm{E}\\left[\\boldsymbol{x}^{\\mathrm{T}}\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right] \t\\\\&=\\mathrm{E}\\left[\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)^{\\mathrm{T}}\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)\\right] \t\n    \\\\&=\\mathrm{E}\\left(\\left\\Vert \\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right\\Vert ^{2}\\right) \t\n    \\\\&=\\sigma_{X}^{2}\n    \\end{aligned}\n    $$\n    ```\n\n- 显示为\n\n{% raw %}\n$$\n\\begin{aligned}\n\\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\t&=\\boldsymbol{x}^{\\mathrm{T}}\\mathrm{E}\\left[\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\right]\\boldsymbol{x} \t\n\\\\&=\\mathrm{E}\\left[\\boldsymbol{x}^{\\mathrm{T}}\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right] \t\\\\&=\\mathrm{E}\\left[\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)^{\\mathrm{T}}\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)\\right] \t\n\\\\&=\\mathrm{E}\\left(\\left\\Vert \\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right\\Vert ^{2}\\right) \t\n\\\\&=\\sigma_{X}^{2}\n\\end{aligned}\n$$\n{% endraw %}\n\n","source":"_posts/config/hexo-math-config.md","raw":"---\ntitle: hexo中公式显示\ndate: 2021-08-05 20:38:51\ntags: [hexo,fluid,配置]\ncategories: [配置,hexo]\nmath: true\n---\n\n> 公式的显示问题。Hexo中Mathjax是用于显示公式的插件，但是多行显示会出现问题，有时还会出现乱码的情况。\n\n### 配置\n\n在根目录下的config\\_fluid.yml​文件中打开math的相关配置。\n\n```yaml\n  # 数学公式，开启之前需要更换 Markdown 渲染器，否则复杂公式会有兼容问题，具体请见：https://hexo.fluid-dev.com/docs/guide/##latex-数学公式\n  # Mathematical formula. If enable, you need to change the Markdown renderer, see: https://hexo.fluid-dev.com/docs/en/guide/#math\n  math:\n    # 开启后文章默认可用，自定义页面如需使用，需在 Front-matter 中指定 `math: true`\n    # If you want to use math on the custom page, you need to set `math: true` in Front-matter\n    enable: true\n\n    # 开启后，只有在文章 Front-matter 里指定 `math: true` 才会在文章页启动公式转换，以便在页面不包含公式时提高加载速度\n    # If true, only set `math: true` in Front-matter will enable math, to load faster when the page does not contain math\n    specific: true\n\n    # Options: mathjax | katex\n    engine: mathjax\n\n```\n\n### 出现的问题\n\n#### 问题1\n\n- 由于hexo解码时关注{{，}}，%% 等连续字符，会将这部分代码解读为其他带有特殊含义的内容\n- 如果公式中恰巧出现了此类字符，会报出上述错误\n\n#### 问题2\n\n- 由于hexo在公式中的`\\\\`错会成了转义符，也就是说他只看见了一个反斜杠，不会执行换行命令，导致公式堆成一行\n\n### 解决方案\n\n#### 临时方案\n\n##### 针对问题1\n\n- 可以在连续的 `{` `}` `%`中间插入空格，分开就没事了\n\n##### 针对问题2\n\n- 可以将`\\\\`换成`\\\\\\\\`，可以实现公式的多行正确显示\n\n#### 终极方案\n\n- 在官方文档中提到了可以为hexo提供标记，阻止其按照自己的规则解释我们的字符串，显示其原本的含义\n\n- 标记为\n\n  ```\n  {% raw %}\n  $$\n  ...\n  $$\n  {% endraw %}\n  ```\n\n### 多行显示和对齐\n- 默认是显示为一行要实现公式多行和对齐可以使用{aligned}模式，使用\"&\"来标记对齐位置。\"\\\\\\\\\"表示换行\n\n    ```\n    $$\n    \\begin{aligned}\n    \\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\t&=\\boldsymbol{x}^{\\mathrm{T}}\\mathrm{E}\\left[\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\right]\\boldsymbol{x} \t\n    \\\\&=\\mathrm{E}\\left[\\boldsymbol{x}^{\\mathrm{T}}\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right] \t\\\\&=\\mathrm{E}\\left[\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)^{\\mathrm{T}}\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)\\right] \t\n    \\\\&=\\mathrm{E}\\left(\\left\\Vert \\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right\\Vert ^{2}\\right) \t\n    \\\\&=\\sigma_{X}^{2}\n    \\end{aligned}\n    $$\n    ```\n\n- 显示为\n\n{% raw %}\n$$\n\\begin{aligned}\n\\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\t&=\\boldsymbol{x}^{\\mathrm{T}}\\mathrm{E}\\left[\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\right]\\boldsymbol{x} \t\n\\\\&=\\mathrm{E}\\left[\\boldsymbol{x}^{\\mathrm{T}}\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right] \t\\\\&=\\mathrm{E}\\left[\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)^{\\mathrm{T}}\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)\\right] \t\n\\\\&=\\mathrm{E}\\left(\\left\\Vert \\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right\\Vert ^{2}\\right) \t\n\\\\&=\\sigma_{X}^{2}\n\\end{aligned}\n$$\n{% endraw %}\n\n","slug":"config/hexo-math-config","published":1,"updated":"2022-01-18T08:10:17.045Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p05y0008ast905bx0ybk","content":"<blockquote>\n<p>公式的显示问题。Hexo中Mathjax是用于显示公式的插件，但是多行显示会出现问题，有时还会出现乱码的情况。</p>\n</blockquote>\n<h3 id=\"配置\">配置</h3>\n<p>在根目录下的config_fluid.yml​文件中打开math的相关配置。</p>\n<figure class=\"highlight yaml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-comment\"># 数学公式，开启之前需要更换 Markdown 渲染器，否则复杂公式会有兼容问题，具体请见：https://hexo.fluid-dev.com/docs/guide/##latex-数学公式</span><br><span class=\"hljs-comment\"># Mathematical formula. If enable, you need to change the Markdown renderer, see: https://hexo.fluid-dev.com/docs/en/guide/#math</span><br><span class=\"hljs-attr\">math:</span><br>  <span class=\"hljs-comment\"># 开启后文章默认可用，自定义页面如需使用，需在 Front-matter 中指定 `math: true`</span><br>  <span class=\"hljs-comment\"># If you want to use math on the custom page, you need to set `math: true` in Front-matter</span><br>  <span class=\"hljs-attr\">enable:</span> <span class=\"hljs-literal\">true</span><br><br>  <span class=\"hljs-comment\"># 开启后，只有在文章 Front-matter 里指定 `math: true` 才会在文章页启动公式转换，以便在页面不包含公式时提高加载速度</span><br>  <span class=\"hljs-comment\"># If true, only set `math: true` in Front-matter will enable math, to load faster when the page does not contain math</span><br>  <span class=\"hljs-attr\">specific:</span> <span class=\"hljs-literal\">true</span><br><br>  <span class=\"hljs-comment\"># Options: mathjax | katex</span><br>  <span class=\"hljs-attr\">engine:</span> <span class=\"hljs-string\">mathjax</span><br><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"出现的问题\">出现的问题</h3>\n<h4 id=\"问题1\">问题1</h4>\n<ul>\n<li>由于hexo解码时关注，%% 等连续字符，会将这部分代码解读为其他带有特殊含义的内容</li>\n<li>如果公式中恰巧出现了此类字符，会报出上述错误</li>\n</ul>\n<h4 id=\"问题2\">问题2</h4>\n<ul>\n<li>由于hexo在公式中的<code>\\\\</code>错会成了转义符，也就是说他只看见了一个反斜杠，不会执行换行命令，导致公式堆成一行</li>\n</ul>\n<h3 id=\"解决方案\">解决方案</h3>\n<h4 id=\"临时方案\">临时方案</h4>\n<h5 id=\"针对问题1\">针对问题1</h5>\n<ul>\n<li>可以在连续的 <code>{</code> <code>}</code> <code>%</code>中间插入空格，分开就没事了</li>\n</ul>\n<h5 id=\"针对问题2\">针对问题2</h5>\n<ul>\n<li>可以将<code>\\\\</code>换成<code>\\\\\\\\</code>，可以实现公式的多行正确显示</li>\n</ul>\n<h4 id=\"终极方案\">终极方案</h4>\n<ul>\n<li>\n<p>在官方文档中提到了可以为hexo提供标记，阻止其按照自己的规则解释我们的字符串，显示其原本的含义</p>\n</li>\n<li>\n<p>标记为</p>\n<figure class=\"highlight django\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs django\"><span class=\"hljs-template-tag\">{% <span class=\"hljs-name\">raw</span> %}</span><span class=\"xml\"></span><br><span class=\"xml\">$$</span><br><span class=\"xml\">...</span><br><span class=\"xml\">$$</span><br><span class=\"xml\"></span><span class=\"hljs-template-tag\">{% <span class=\"hljs-name\">endraw</span> %}</span><br></code></pre></td></tr></tbody></table></figure>\n</li>\n</ul>\n<h3 id=\"多行显示和对齐\">多行显示和对齐</h3>\n<ul>\n<li>\n<p>默认是显示为一行要实现公式多行和对齐可以使用{aligned}模式，使用\"&amp;“来标记对齐位置。”\\\\\"表示换行</p>\n  <figure class=\"highlight taggerscript\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs taggerscript\">$$<br><span class=\"hljs-symbol\">\\b</span>egin{aligned}<br><span class=\"hljs-symbol\">\\b</span>oldsymbol{x}^{<span class=\"hljs-symbol\">\\m</span>athrm{T}}C<span class=\"hljs-symbol\">\\b</span>oldsymbol{x}\t&amp;=<span class=\"hljs-symbol\">\\b</span>oldsymbol{x}^{<span class=\"hljs-symbol\">\\m</span>athrm{T}}<span class=\"hljs-symbol\">\\m</span>athrm{E}<span class=\"hljs-symbol\">\\l</span>eft[<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)^{<span class=\"hljs-symbol\">\\m</span>athrm{T}}<span class=\"hljs-symbol\">\\r</span>ight]<span class=\"hljs-symbol\">\\b</span>oldsymbol{x} \t<br><span class=\"hljs-symbol\">\\\\</span>&amp;=<span class=\"hljs-symbol\">\\m</span>athrm{E}<span class=\"hljs-symbol\">\\l</span>eft[<span class=\"hljs-symbol\">\\b</span>oldsymbol{x}^{<span class=\"hljs-symbol\">\\m</span>athrm{T}}<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)^{<span class=\"hljs-symbol\">\\m</span>athrm{T}}<span class=\"hljs-symbol\">\\b</span>oldsymbol{x}<span class=\"hljs-symbol\">\\r</span>ight] \t<span class=\"hljs-symbol\">\\\\</span>&amp;=<span class=\"hljs-symbol\">\\m</span>athrm{E}<span class=\"hljs-symbol\">\\l</span>eft[<span class=\"hljs-symbol\">\\l</span>eft(<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)^{<span class=\"hljs-symbol\">\\m</span>athrm{T}}<span class=\"hljs-symbol\">\\b</span>oldsymbol{x}<span class=\"hljs-symbol\">\\r</span>ight)^{<span class=\"hljs-symbol\">\\m</span>athrm{T}}<span class=\"hljs-symbol\">\\l</span>eft(<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)^{<span class=\"hljs-symbol\">\\m</span>athrm{T}}<span class=\"hljs-symbol\">\\b</span>oldsymbol{x}<span class=\"hljs-symbol\">\\r</span>ight)<span class=\"hljs-symbol\">\\r</span>ight] \t<br><span class=\"hljs-symbol\">\\\\</span>&amp;=<span class=\"hljs-symbol\">\\m</span>athrm{E}<span class=\"hljs-symbol\">\\l</span>eft(<span class=\"hljs-symbol\">\\l</span>eft<span class=\"hljs-symbol\">\\V</span>ert <span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)^{<span class=\"hljs-symbol\">\\m</span>athrm{T}}<span class=\"hljs-symbol\">\\b</span>oldsymbol{x}<span class=\"hljs-symbol\">\\r</span>ight<span class=\"hljs-symbol\">\\V</span>ert ^{2}<span class=\"hljs-symbol\">\\r</span>ight) \t<br><span class=\"hljs-symbol\">\\\\</span>&amp;=<span class=\"hljs-symbol\">\\s</span>igma_{X}^{2}<br><span class=\"hljs-symbol\">\\e</span>nd{aligned}<br>$$<br></code></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>显示为</p>\n</li>\n</ul>\n\n$$\n\\begin{aligned}\n\\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\t&amp;=\\boldsymbol{x}^{\\mathrm{T}}\\mathrm{E}\\left[\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\right]\\boldsymbol{x} \t\n\\\\&amp;=\\mathrm{E}\\left[\\boldsymbol{x}^{\\mathrm{T}}\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right] \t\\\\&amp;=\\mathrm{E}\\left[\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)^{\\mathrm{T}}\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)\\right] \t\n\\\\&amp;=\\mathrm{E}\\left(\\left\\Vert \\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right\\Vert ^{2}\\right) \t\n\\\\&amp;=\\sigma_{X}^{2}\n\\end{aligned}\n$$\n\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>公式的显示问题。Hexo中Mathjax是用于显示公式的插件，但是多行显示会出现问题，有时还会出现乱码的情况。</p>\n</blockquote>\n<h3 id=\"配置\">配置</h3>\n<p>在根目录下的config_fluid.yml​文件中打开math的相关配置。</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-comment\"># 数学公式，开启之前需要更换 Markdown 渲染器，否则复杂公式会有兼容问题，具体请见：https://hexo.fluid-dev.com/docs/guide/##latex-数学公式</span><br><span class=\"hljs-comment\"># Mathematical formula. If enable, you need to change the Markdown renderer, see: https://hexo.fluid-dev.com/docs/en/guide/#math</span><br><span class=\"hljs-attr\">math:</span><br>  <span class=\"hljs-comment\"># 开启后文章默认可用，自定义页面如需使用，需在 Front-matter 中指定 `math: true`</span><br>  <span class=\"hljs-comment\"># If you want to use math on the custom page, you need to set `math: true` in Front-matter</span><br>  <span class=\"hljs-attr\">enable:</span> <span class=\"hljs-literal\">true</span><br><br>  <span class=\"hljs-comment\"># 开启后，只有在文章 Front-matter 里指定 `math: true` 才会在文章页启动公式转换，以便在页面不包含公式时提高加载速度</span><br>  <span class=\"hljs-comment\"># If true, only set `math: true` in Front-matter will enable math, to load faster when the page does not contain math</span><br>  <span class=\"hljs-attr\">specific:</span> <span class=\"hljs-literal\">true</span><br><br>  <span class=\"hljs-comment\"># Options: mathjax | katex</span><br>  <span class=\"hljs-attr\">engine:</span> <span class=\"hljs-string\">mathjax</span><br><br></code></pre></td></tr></table></figure>\n<h3 id=\"出现的问题\">出现的问题</h3>\n<h4 id=\"问题1\">问题1</h4>\n<ul>\n<li>由于hexo解码时关注，%% 等连续字符，会将这部分代码解读为其他带有特殊含义的内容</li>\n<li>如果公式中恰巧出现了此类字符，会报出上述错误</li>\n</ul>\n<h4 id=\"问题2\">问题2</h4>\n<ul>\n<li>由于hexo在公式中的<code>\\\\</code>错会成了转义符，也就是说他只看见了一个反斜杠，不会执行换行命令，导致公式堆成一行</li>\n</ul>\n<h3 id=\"解决方案\">解决方案</h3>\n<h4 id=\"临时方案\">临时方案</h4>\n<h5 id=\"针对问题1\">针对问题1</h5>\n<ul>\n<li>可以在连续的 <code>&#123;</code> <code>&#125;</code> <code>%</code>中间插入空格，分开就没事了</li>\n</ul>\n<h5 id=\"针对问题2\">针对问题2</h5>\n<ul>\n<li>可以将<code>\\\\</code>换成<code>\\\\\\\\</code>，可以实现公式的多行正确显示</li>\n</ul>\n<h4 id=\"终极方案\">终极方案</h4>\n<ul>\n<li>\n<p>在官方文档中提到了可以为hexo提供标记，阻止其按照自己的规则解释我们的字符串，显示其原本的含义</p>\n</li>\n<li>\n<p>标记为</p>\n<figure class=\"highlight django\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs django\"><span class=\"hljs-template-tag\">&#123;% <span class=\"hljs-name\">raw</span> %&#125;</span><span class=\"xml\"></span><br><span class=\"xml\">$$</span><br><span class=\"xml\">...</span><br><span class=\"xml\">$$</span><br><span class=\"xml\"></span><span class=\"hljs-template-tag\">&#123;% <span class=\"hljs-name\">endraw</span> %&#125;</span><br></code></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"多行显示和对齐\">多行显示和对齐</h3>\n<ul>\n<li>\n<p>默认是显示为一行要实现公式多行和对齐可以使用{aligned}模式，使用&quot;&amp;“来标记对齐位置。”\\\\&quot;表示换行</p>\n  <figure class=\"highlight taggerscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs taggerscript\">$$<br><span class=\"hljs-symbol\">\\b</span>egin&#123;aligned&#125;<br><span class=\"hljs-symbol\">\\b</span>oldsymbol&#123;x&#125;^&#123;<span class=\"hljs-symbol\">\\m</span>athrm&#123;T&#125;&#125;C<span class=\"hljs-symbol\">\\b</span>oldsymbol&#123;x&#125;\t&amp;=<span class=\"hljs-symbol\">\\b</span>oldsymbol&#123;x&#125;^&#123;<span class=\"hljs-symbol\">\\m</span>athrm&#123;T&#125;&#125;<span class=\"hljs-symbol\">\\m</span>athrm&#123;E&#125;<span class=\"hljs-symbol\">\\l</span>eft[<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)^&#123;<span class=\"hljs-symbol\">\\m</span>athrm&#123;T&#125;&#125;<span class=\"hljs-symbol\">\\r</span>ight]<span class=\"hljs-symbol\">\\b</span>oldsymbol&#123;x&#125; \t<br><span class=\"hljs-symbol\">\\\\</span>&amp;=<span class=\"hljs-symbol\">\\m</span>athrm&#123;E&#125;<span class=\"hljs-symbol\">\\l</span>eft[<span class=\"hljs-symbol\">\\b</span>oldsymbol&#123;x&#125;^&#123;<span class=\"hljs-symbol\">\\m</span>athrm&#123;T&#125;&#125;<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)^&#123;<span class=\"hljs-symbol\">\\m</span>athrm&#123;T&#125;&#125;<span class=\"hljs-symbol\">\\b</span>oldsymbol&#123;x&#125;<span class=\"hljs-symbol\">\\r</span>ight] \t<span class=\"hljs-symbol\">\\\\</span>&amp;=<span class=\"hljs-symbol\">\\m</span>athrm&#123;E&#125;<span class=\"hljs-symbol\">\\l</span>eft[<span class=\"hljs-symbol\">\\l</span>eft(<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)^&#123;<span class=\"hljs-symbol\">\\m</span>athrm&#123;T&#125;&#125;<span class=\"hljs-symbol\">\\b</span>oldsymbol&#123;x&#125;<span class=\"hljs-symbol\">\\r</span>ight)^&#123;<span class=\"hljs-symbol\">\\m</span>athrm&#123;T&#125;&#125;<span class=\"hljs-symbol\">\\l</span>eft(<span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)^&#123;<span class=\"hljs-symbol\">\\m</span>athrm&#123;T&#125;&#125;<span class=\"hljs-symbol\">\\b</span>oldsymbol&#123;x&#125;<span class=\"hljs-symbol\">\\r</span>ight)<span class=\"hljs-symbol\">\\r</span>ight] \t<br><span class=\"hljs-symbol\">\\\\</span>&amp;=<span class=\"hljs-symbol\">\\m</span>athrm&#123;E&#125;<span class=\"hljs-symbol\">\\l</span>eft(<span class=\"hljs-symbol\">\\l</span>eft<span class=\"hljs-symbol\">\\V</span>ert <span class=\"hljs-symbol\">\\l</span>eft(X-<span class=\"hljs-symbol\">\\m</span>u<span class=\"hljs-symbol\">\\r</span>ight)^&#123;<span class=\"hljs-symbol\">\\m</span>athrm&#123;T&#125;&#125;<span class=\"hljs-symbol\">\\b</span>oldsymbol&#123;x&#125;<span class=\"hljs-symbol\">\\r</span>ight<span class=\"hljs-symbol\">\\V</span>ert ^&#123;2&#125;<span class=\"hljs-symbol\">\\r</span>ight) \t<br><span class=\"hljs-symbol\">\\\\</span>&amp;=<span class=\"hljs-symbol\">\\s</span>igma_&#123;X&#125;^&#123;2&#125;<br><span class=\"hljs-symbol\">\\e</span>nd&#123;aligned&#125;<br>$$<br></code></pre></td></tr></table></figure>\n</li>\n<li>\n<p>显示为</p>\n</li>\n</ul>\n\n$$\n\\begin{aligned}\n\\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\t&=\\boldsymbol{x}^{\\mathrm{T}}\\mathrm{E}\\left[\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\right]\\boldsymbol{x} \t\n\\\\&=\\mathrm{E}\\left[\\boldsymbol{x}^{\\mathrm{T}}\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right] \t\\\\&=\\mathrm{E}\\left[\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)^{\\mathrm{T}}\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)\\right] \t\n\\\\&=\\mathrm{E}\\left(\\left\\Vert \\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right\\Vert ^{2}\\right) \t\n\\\\&=\\sigma_{X}^{2}\n\\end{aligned}\n$$\n\n"},{"title":"博客中的emoji","date":"2021-08-24T07:00:26.000Z","_content":"\n> 在博客中使用emoji，可可爱爱小表情:heart_eyes:\n\n> 相关配置参见这个博客哟 [Hexo -19- 添加emoji表情](https://www.zywvvd.com/2021/08/23/hexo/19%20hexo-emoji/hexo-emoji/)\n> 可以在这两个网站看看有哪些小表情\n> https://www.webfx.com/tools/emoji-cheat-sheet/\n> https://www.zywvvd.com/2021/08/13/git/git-emoji/git-emoji/\n\n## 安装渲染器\n\n```\nnpm un hexo-renderer-marked --save\nnpm i hexo-renderer-markdown-it --save\n```\n\n## 修改配置文件\n\n在_config.yml文件尾部添加下段代码\n\n```\n# Markdown-it config\n## Docs: https://github.com/celsomiranda/hexo-renderer-markdown-it/wiki\nmarkdown:\n  render:\n    html: true\n    xhtmlOut: false\n    breaks: true\n    linkify: true\n    typographer: true\n    quotes: '“”‘’'\n  plugins:\n    - markdown-it-abbr\n    - markdown-it-footnote\n    - markdown-it-ins\n    - markdown-it-sub\n    - markdown-it-sup\n    - markdown-it-emoji  # add emoji\n```\n\n使用的时候就直接在md文件中用两个引号中间填写emoji的名称即可啦 :happy:\n\n","source":"_posts/config/hexo-emoji.md","raw":"---\ntitle: 博客中的emoji\ntags: emoji\ncategories: [配置,hexo]\ndate: 2021-08-24 15:00:26\n---\n\n> 在博客中使用emoji，可可爱爱小表情:heart_eyes:\n\n> 相关配置参见这个博客哟 [Hexo -19- 添加emoji表情](https://www.zywvvd.com/2021/08/23/hexo/19%20hexo-emoji/hexo-emoji/)\n> 可以在这两个网站看看有哪些小表情\n> https://www.webfx.com/tools/emoji-cheat-sheet/\n> https://www.zywvvd.com/2021/08/13/git/git-emoji/git-emoji/\n\n## 安装渲染器\n\n```\nnpm un hexo-renderer-marked --save\nnpm i hexo-renderer-markdown-it --save\n```\n\n## 修改配置文件\n\n在_config.yml文件尾部添加下段代码\n\n```\n# Markdown-it config\n## Docs: https://github.com/celsomiranda/hexo-renderer-markdown-it/wiki\nmarkdown:\n  render:\n    html: true\n    xhtmlOut: false\n    breaks: true\n    linkify: true\n    typographer: true\n    quotes: '“”‘’'\n  plugins:\n    - markdown-it-abbr\n    - markdown-it-footnote\n    - markdown-it-ins\n    - markdown-it-sub\n    - markdown-it-sup\n    - markdown-it-emoji  # add emoji\n```\n\n使用的时候就直接在md文件中用两个引号中间填写emoji的名称即可啦 :happy:\n\n","slug":"config/hexo-emoji","published":1,"updated":"2022-01-18T08:10:17.044Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p063000bast945zr4pvf","content":"<blockquote>\n<p>在博客中使用emoji，可可爱爱小表情😍</p>\n</blockquote>\n<blockquote>\n<p>相关配置参见这个博客哟 <a href=\"https://www.zywvvd.com/2021/08/23/hexo/19%20hexo-emoji/hexo-emoji/\">Hexo -19- 添加emoji表情</a><br>\n可以在这两个网站看看有哪些小表情<br>\n<a href=\"https://www.webfx.com/tools/emoji-cheat-sheet/\">https://www.webfx.com/tools/emoji-cheat-sheet/</a><br>\n<a href=\"https://www.zywvvd.com/2021/08/13/git/git-emoji/git-emoji/\">https://www.zywvvd.com/2021/08/13/git/git-emoji/git-emoji/</a></p>\n</blockquote>\n<h2 id=\"安装渲染器\">安装渲染器</h2>\n<figure class=\"highlight applescript\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs applescript\">npm un hexo-renderer-marked <span class=\"hljs-comment\">--save</span><br>npm i hexo-renderer-markdown-<span class=\"hljs-keyword\">it</span> <span class=\"hljs-comment\">--save</span><br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"修改配置文件\">修改配置文件</h2>\n<p>在_config.yml文件尾部添加下段代码</p>\n<figure class=\"highlight yaml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-comment\"># Markdown-it config</span><br><span class=\"hljs-comment\">## Docs: https://github.com/celsomiranda/hexo-renderer-markdown-it/wiki</span><br><span class=\"hljs-attr\">markdown:</span><br>  <span class=\"hljs-attr\">render:</span><br>    <span class=\"hljs-attr\">html:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-attr\">xhtmlOut:</span> <span class=\"hljs-literal\">false</span><br>    <span class=\"hljs-attr\">breaks:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-attr\">linkify:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-attr\">typographer:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-attr\">quotes:</span> <span class=\"hljs-string\">'“”‘’'</span><br>  <span class=\"hljs-attr\">plugins:</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-abbr</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-footnote</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-ins</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-sub</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-sup</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-emoji</span>  <span class=\"hljs-comment\"># add emoji</span><br></code></pre></td></tr></tbody></table></figure>\n<p>使用的时候就直接在md文件中用两个引号中间填写emoji的名称即可啦 :happy:</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>在博客中使用emoji，可可爱爱小表情😍</p>\n</blockquote>\n<blockquote>\n<p>相关配置参见这个博客哟 <a href=\"https://www.zywvvd.com/2021/08/23/hexo/19%20hexo-emoji/hexo-emoji/\">Hexo -19- 添加emoji表情</a><br>\n可以在这两个网站看看有哪些小表情<br>\n<a href=\"https://www.webfx.com/tools/emoji-cheat-sheet/\">https://www.webfx.com/tools/emoji-cheat-sheet/</a><br>\n<a href=\"https://www.zywvvd.com/2021/08/13/git/git-emoji/git-emoji/\">https://www.zywvvd.com/2021/08/13/git/git-emoji/git-emoji/</a></p>\n</blockquote>\n<h2 id=\"安装渲染器\">安装渲染器</h2>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs applescript\">npm un hexo-renderer-marked <span class=\"hljs-comment\">--save</span><br>npm i hexo-renderer-markdown-<span class=\"hljs-keyword\">it</span> <span class=\"hljs-comment\">--save</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"修改配置文件\">修改配置文件</h2>\n<p>在_config.yml文件尾部添加下段代码</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-comment\"># Markdown-it config</span><br><span class=\"hljs-comment\">## Docs: https://github.com/celsomiranda/hexo-renderer-markdown-it/wiki</span><br><span class=\"hljs-attr\">markdown:</span><br>  <span class=\"hljs-attr\">render:</span><br>    <span class=\"hljs-attr\">html:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-attr\">xhtmlOut:</span> <span class=\"hljs-literal\">false</span><br>    <span class=\"hljs-attr\">breaks:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-attr\">linkify:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-attr\">typographer:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-attr\">quotes:</span> <span class=\"hljs-string\">&#x27;“”‘’&#x27;</span><br>  <span class=\"hljs-attr\">plugins:</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-abbr</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-footnote</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-ins</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-sub</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-sup</span><br>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">markdown-it-emoji</span>  <span class=\"hljs-comment\"># add emoji</span><br></code></pre></td></tr></table></figure>\n<p>使用的时候就直接在md文件中用两个引号中间填写emoji的名称即可啦 :happy:</p>\n"},{"title":"在博客中显示pdf&折叠","date":"2021-08-25T08:29:58.000Z","_content":"\n> 参考师兄的方法配置\n> https://www.zywvvd.com/2021/08/15/hexo-theme/fluid/fluid-pdf/fluid-pdf/\n\n## 配置\n\npdf.js 是用于解析和呈现 PDF 的基于 Web 标准平台的通用解决方案，功能强大。\n\n官方网站：https://mozilla.github.io/pdf.js/\n\n由于我的浏览器的版本可能不高，考虑到兼容性下载旧版的文件。然后按师兄的步骤配置即可。\n\n## 使用\n\n```\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf' width=100% height=450></iframe>\n```\n\nfile设置为文件的地址，宽高可以自己设置。\n\n## 效果\n\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf' width=100% height=450></iframe>\n\n\n\n## 折叠\n\n通过html的details元素可以折叠隐藏的内容。\n\n```\n使用 <details> </details> 标签包裹需要隐藏的内容\n在其中使用<summary> </summary>标签包裹需要隐藏内容的标题\n```\n\n这样如果需要阅读pdf就可以展开，不需要就隐藏，真是炒鸡便利！:wink:\n\n<details>\n<summary>展开pdf</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf' width=100% height=650></iframe>\n</details>\n","source":"_posts/config/pdf-config.md","raw":"---\ntitle: 在博客中显示pdf&折叠\ntags: [配置,pdf]\ncategories: [配置]\ndate: 2021-08-25 16:29:58\n---\n\n> 参考师兄的方法配置\n> https://www.zywvvd.com/2021/08/15/hexo-theme/fluid/fluid-pdf/fluid-pdf/\n\n## 配置\n\npdf.js 是用于解析和呈现 PDF 的基于 Web 标准平台的通用解决方案，功能强大。\n\n官方网站：https://mozilla.github.io/pdf.js/\n\n由于我的浏览器的版本可能不高，考虑到兼容性下载旧版的文件。然后按师兄的步骤配置即可。\n\n## 使用\n\n```\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf' width=100% height=450></iframe>\n```\n\nfile设置为文件的地址，宽高可以自己设置。\n\n## 效果\n\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf' width=100% height=450></iframe>\n\n\n\n## 折叠\n\n通过html的details元素可以折叠隐藏的内容。\n\n```\n使用 <details> </details> 标签包裹需要隐藏的内容\n在其中使用<summary> </summary>标签包裹需要隐藏内容的标题\n```\n\n这样如果需要阅读pdf就可以展开，不需要就隐藏，真是炒鸡便利！:wink:\n\n<details>\n<summary>展开pdf</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf' width=100% height=650></iframe>\n</details>\n","slug":"config/pdf-config","published":1,"updated":"2022-01-18T08:10:17.046Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p065000cast93xeu4bda","content":"<blockquote>\n<p>参考师兄的方法配置<br>\n<a href=\"https://www.zywvvd.com/2021/08/15/hexo-theme/fluid/fluid-pdf/fluid-pdf/\">https://www.zywvvd.com/2021/08/15/hexo-theme/fluid/fluid-pdf/fluid-pdf/</a></p>\n</blockquote>\n<h2 id=\"配置\">配置</h2>\n<p>pdf.js 是用于解析和呈现 PDF 的基于 Web 标准平台的通用解决方案，功能强大。</p>\n<p>官方网站：<a href=\"https://mozilla.github.io/pdf.js/\">https://mozilla.github.io/pdf.js/</a></p>\n<p>由于我的浏览器的版本可能不高，考虑到兼容性下载旧版的文件。然后按师兄的步骤配置即可。</p>\n<h2 id=\"使用\">使用</h2>\n<figure class=\"highlight llvm\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs llvm\">&lt;iframe src<span class=\"hljs-operator\">=</span>'/js/pdfjs_old/web/viewer.html?file<span class=\"hljs-operator\">=</span>https://paper.mulindya.com/An<span class=\"hljs-variable\">%20</span>Isotropic<span class=\"hljs-variable\">%203</span><span class=\"hljs-keyword\">x</span><span class=\"hljs-number\">3</span><span class=\"hljs-variable\">%20</span>Image<span class=\"hljs-variable\">%20</span>Gradient<span class=\"hljs-variable\">%20</span>Operator.pdf' width<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">100</span>% height<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">450</span>&gt;&lt;/iframe&gt;<br></code></pre></td></tr></tbody></table></figure>\n<p>file设置为文件的地址，宽高可以自己设置。</p>\n<h2 id=\"效果\">效果</h2>\n<iframe src=\"/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf\" width=\"100%\" height=\"450\"></iframe>\n<h2 id=\"折叠\">折叠</h2>\n<p>通过html的details元素可以折叠隐藏的内容。</p>\n<figure class=\"highlight xml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">使用 <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">details</span>&gt;</span> <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">details</span>&gt;</span> 标签包裹需要隐藏的内容<br>在其中使用<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">summary</span>&gt;</span> <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">summary</span>&gt;</span>标签包裹需要隐藏内容的标题<br></code></pre></td></tr></tbody></table></figure>\n<p>这样如果需要阅读pdf就可以展开，不需要就隐藏，真是炒鸡便利！😉</p>\n<details>\n<summary>展开pdf</summary>\n<iframe src=\"/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf\" width=\"100%\" height=\"650\"></iframe>\n</details>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>参考师兄的方法配置<br>\n<a href=\"https://www.zywvvd.com/2021/08/15/hexo-theme/fluid/fluid-pdf/fluid-pdf/\">https://www.zywvvd.com/2021/08/15/hexo-theme/fluid/fluid-pdf/fluid-pdf/</a></p>\n</blockquote>\n<h2 id=\"配置\">配置</h2>\n<p>pdf.js 是用于解析和呈现 PDF 的基于 Web 标准平台的通用解决方案，功能强大。</p>\n<p>官方网站：<a href=\"https://mozilla.github.io/pdf.js/\">https://mozilla.github.io/pdf.js/</a></p>\n<p>由于我的浏览器的版本可能不高，考虑到兼容性下载旧版的文件。然后按师兄的步骤配置即可。</p>\n<h2 id=\"使用\">使用</h2>\n<figure class=\"highlight llvm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs llvm\">&lt;iframe src<span class=\"hljs-operator\">=</span>&#x27;/js/pdfjs_old/web/viewer.html?file<span class=\"hljs-operator\">=</span>https://paper.mulindya.com/An<span class=\"hljs-variable\">%20</span>Isotropic<span class=\"hljs-variable\">%203</span><span class=\"hljs-keyword\">x</span><span class=\"hljs-number\">3</span><span class=\"hljs-variable\">%20</span>Image<span class=\"hljs-variable\">%20</span>Gradient<span class=\"hljs-variable\">%20</span>Operator.pdf&#x27; width<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">100</span>% height<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">450</span>&gt;&lt;/iframe&gt;<br></code></pre></td></tr></table></figure>\n<p>file设置为文件的地址，宽高可以自己设置。</p>\n<h2 id=\"效果\">效果</h2>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf' width=100% height=450></iframe>\n<h2 id=\"折叠\">折叠</h2>\n<p>通过html的details元素可以折叠隐藏的内容。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">使用 <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">details</span>&gt;</span> <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">details</span>&gt;</span> 标签包裹需要隐藏的内容<br>在其中使用<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">summary</span>&gt;</span> <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">summary</span>&gt;</span>标签包裹需要隐藏内容的标题<br></code></pre></td></tr></table></figure>\n<p>这样如果需要阅读pdf就可以展开，不需要就隐藏，真是炒鸡便利！😉</p>\n<details>\n<summary>展开pdf</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf' width=100% height=650></iframe>\n</details>\n"},{"title":"docker相关命令","date":"2021-08-10T07:15:16.000Z","_content":"\n>简要介绍Docker，记录Docker常用命令使用方法。\n>\n>搬运自师兄的博客 又见苍岚 ：https://www.zywvvd.com/2020/05/06/docker/docker_usage/\n\n### Docker 简介\n\n> **Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。**Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker，就不用担心环境问题。\n\n### Docker 使用流程\n\n- [安装docker](https://docs.docker.com/desktop/)\n- 创建Image\n- 从Image创建Container\n- 在Container中工作\n- 将在Container中做的修改提交给Image\n- 销毁Container\n\n### 命令介绍\n\n- 拉取 image\n\n```\ndocker image pull [docker-url]\n```\n\n- 获取docker images 列表\n\n```\ndocker images\n或\ndocker image ls\n```\n\n- 建立container （nvidia docker)\n\n```\nNV_GPU=[gpu_num] nvidia-docker run -it --name [container_name] --shm-size=[shm_size] --rm -v [current_dir]:[container_dir] -p [current_port]:[container_port] [image_name]:[image_tag]  [command] \n```\n实例：\n```\nnvidia-docker run -it --name mlfan --shm-size=10g -v /disk/fanmeilin:/workspace/fanmeilin -p 12345:22 -p 12346:8080 -p 12347:5678 tf-1.14-2.0-2.1:1.0 bash\n```\n<font color=SlateBlue size=4>注意不要加 --rm  否则载在container stop之后会自动删除此容器</font>\n\n> NV_GPU: container中可见的GPU，如果不设置可见所有GPU\n>\n> -it: 将容器的 Shell 映射到当前的 Shell，然后你在本机窗口输入的命令，就会传入容器\n>\n> –name: 容器名称，如果不设置会随机分配一个名字\n>\n> –shm-size: 容器共享内存大小设置。如果不设置默认大小64M，对于需要使用共享内存的情况往往是不够用的，如果设置为10g，这样配置： `--ssh-size=\"10g\"`\n>\n> –rm: 容器关闭后自动删除，如果不设置容器不会自动删除\n>\n> -v: 驱动器映射，将本机的目录映射到容器的指定文件夹中；需要说明的是，在主机文件夹中的挂载目录在容器中是可见的；需要再说明的是容器启动时主机挂载的目录容器是见不到的；最后说明，容器关闭再打开就可以看到主机挂载的所有文件夹了。\n>\n> -p: 暴漏容器的端口到本机的端口上，例如用于ssh连接容器时需要将容器的22端口暴露到主机的端口上(比如3721)，则可以设置 `-p 3721:22`\n>\n> image_name, image_tag: 这是docker镜像的名称与标记，如果使用本机镜像可以在docker images列表中查询到\n>\n> command: 启动容器后内部执行的第一个命令，一般为 `/bin/bash`\n\n- 查询container列表\n\n```\ndocker container ls --all\n```\n\n> –all: 加上该参数会显示没有在运行的容器，不加的话仅显示运行中的容器\n\n- 停止指定的容器运行\n\n```\ndocker container kill [containerID]\ndocker stop [containerID]\n```\n\n> `docker container kill`命令终止容器运行，相当于向容器里面的主进程发出 SIGKILL 信号。`docker container stop`命令相当于向容器里面的主进程发出 SIGTERM 信号，然后过一段时间再发出 SIGKILL 信号。\n\n- 启动停止的容器\n\n```\ndocker start [containerID]\n```\n\n- 重启运行的容器\n\n```\ndocker restart [containerID]\n```\n\n- 删除指定的容器文件（仅在停止运行时可用）\n\n```\ndocker container rm [containerID]\n```\n\n- 查看容器输出\n\n```\ndocker container logs [containerID]\n```\n\n- 启动容器的一个终端\n\n```\ndocker exec -it [containerID] /bin/bash\n```\n\n> 此种方法启动的终端，即使退出也不会关闭容器\n>\n> 相反 - 如果直接通过端口映射连接 docker 建立的ssh链接，窗口退出后该终端的工作也会一同停止\n\n- 进入容器的主终端\n\n```\ndocker attach [containerID]\n```\n\n> 连接到容器的主终端，该终端退出后容器关闭。\n>\n> 如果不希望退出后关闭，可以加入选项 `--sig-proxy=false`\n\n- 退出终端\n\n```\nctrl p + ctrl q\n```\n\n> 可以在退出终端的同时保持终端继续工作\n\n- 退出容器\n\n```\nexit\n```\n\n> 在容器中运行此命令\n\n- 拷贝容器里的文件到本机\n\n```\ndocker container cp [containerID]:[/path/to/file]\n```\n\n- 提交容器修改到镜像\n\n```\ndocker commit -a [name] -m [comments] -p  [containerID[:TAG]]\n```\n\n> -a: 提交的镜像作者\n>\n> -m: 提交时的说明文字\n>\n> -p: 在commit时，将容器暂停\n\n- 删除镜像\n\n```\ndocker rmi [image]\n```\n\n> 或\n\n```\ndocker image rm [image]\n```\n\n> 支持的子命令如下：\n\n- `-f, -force`: 强制删除镜像，即便有容器引用该镜像；\n- `-no-prune`: 不要删除未带标签的父镜像；\n\n### 参考资料\n\n- http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html\n- https://www.runoob.com/docker/docker-tutorial.html\n","source":"_posts/docker/docker-intro.md","raw":"---\ntitle: docker相关命令\ndate: 2021-08-10 15:15:16\ntags: [docker,远程配置]\ncategories: docker\n---\n\n>简要介绍Docker，记录Docker常用命令使用方法。\n>\n>搬运自师兄的博客 又见苍岚 ：https://www.zywvvd.com/2020/05/06/docker/docker_usage/\n\n### Docker 简介\n\n> **Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。**Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker，就不用担心环境问题。\n\n### Docker 使用流程\n\n- [安装docker](https://docs.docker.com/desktop/)\n- 创建Image\n- 从Image创建Container\n- 在Container中工作\n- 将在Container中做的修改提交给Image\n- 销毁Container\n\n### 命令介绍\n\n- 拉取 image\n\n```\ndocker image pull [docker-url]\n```\n\n- 获取docker images 列表\n\n```\ndocker images\n或\ndocker image ls\n```\n\n- 建立container （nvidia docker)\n\n```\nNV_GPU=[gpu_num] nvidia-docker run -it --name [container_name] --shm-size=[shm_size] --rm -v [current_dir]:[container_dir] -p [current_port]:[container_port] [image_name]:[image_tag]  [command] \n```\n实例：\n```\nnvidia-docker run -it --name mlfan --shm-size=10g -v /disk/fanmeilin:/workspace/fanmeilin -p 12345:22 -p 12346:8080 -p 12347:5678 tf-1.14-2.0-2.1:1.0 bash\n```\n<font color=SlateBlue size=4>注意不要加 --rm  否则载在container stop之后会自动删除此容器</font>\n\n> NV_GPU: container中可见的GPU，如果不设置可见所有GPU\n>\n> -it: 将容器的 Shell 映射到当前的 Shell，然后你在本机窗口输入的命令，就会传入容器\n>\n> –name: 容器名称，如果不设置会随机分配一个名字\n>\n> –shm-size: 容器共享内存大小设置。如果不设置默认大小64M，对于需要使用共享内存的情况往往是不够用的，如果设置为10g，这样配置： `--ssh-size=\"10g\"`\n>\n> –rm: 容器关闭后自动删除，如果不设置容器不会自动删除\n>\n> -v: 驱动器映射，将本机的目录映射到容器的指定文件夹中；需要说明的是，在主机文件夹中的挂载目录在容器中是可见的；需要再说明的是容器启动时主机挂载的目录容器是见不到的；最后说明，容器关闭再打开就可以看到主机挂载的所有文件夹了。\n>\n> -p: 暴漏容器的端口到本机的端口上，例如用于ssh连接容器时需要将容器的22端口暴露到主机的端口上(比如3721)，则可以设置 `-p 3721:22`\n>\n> image_name, image_tag: 这是docker镜像的名称与标记，如果使用本机镜像可以在docker images列表中查询到\n>\n> command: 启动容器后内部执行的第一个命令，一般为 `/bin/bash`\n\n- 查询container列表\n\n```\ndocker container ls --all\n```\n\n> –all: 加上该参数会显示没有在运行的容器，不加的话仅显示运行中的容器\n\n- 停止指定的容器运行\n\n```\ndocker container kill [containerID]\ndocker stop [containerID]\n```\n\n> `docker container kill`命令终止容器运行，相当于向容器里面的主进程发出 SIGKILL 信号。`docker container stop`命令相当于向容器里面的主进程发出 SIGTERM 信号，然后过一段时间再发出 SIGKILL 信号。\n\n- 启动停止的容器\n\n```\ndocker start [containerID]\n```\n\n- 重启运行的容器\n\n```\ndocker restart [containerID]\n```\n\n- 删除指定的容器文件（仅在停止运行时可用）\n\n```\ndocker container rm [containerID]\n```\n\n- 查看容器输出\n\n```\ndocker container logs [containerID]\n```\n\n- 启动容器的一个终端\n\n```\ndocker exec -it [containerID] /bin/bash\n```\n\n> 此种方法启动的终端，即使退出也不会关闭容器\n>\n> 相反 - 如果直接通过端口映射连接 docker 建立的ssh链接，窗口退出后该终端的工作也会一同停止\n\n- 进入容器的主终端\n\n```\ndocker attach [containerID]\n```\n\n> 连接到容器的主终端，该终端退出后容器关闭。\n>\n> 如果不希望退出后关闭，可以加入选项 `--sig-proxy=false`\n\n- 退出终端\n\n```\nctrl p + ctrl q\n```\n\n> 可以在退出终端的同时保持终端继续工作\n\n- 退出容器\n\n```\nexit\n```\n\n> 在容器中运行此命令\n\n- 拷贝容器里的文件到本机\n\n```\ndocker container cp [containerID]:[/path/to/file]\n```\n\n- 提交容器修改到镜像\n\n```\ndocker commit -a [name] -m [comments] -p  [containerID[:TAG]]\n```\n\n> -a: 提交的镜像作者\n>\n> -m: 提交时的说明文字\n>\n> -p: 在commit时，将容器暂停\n\n- 删除镜像\n\n```\ndocker rmi [image]\n```\n\n> 或\n\n```\ndocker image rm [image]\n```\n\n> 支持的子命令如下：\n\n- `-f, -force`: 强制删除镜像，即便有容器引用该镜像；\n- `-no-prune`: 不要删除未带标签的父镜像；\n\n### 参考资料\n\n- http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html\n- https://www.runoob.com/docker/docker-tutorial.html\n","slug":"docker/docker-intro","published":1,"updated":"2022-01-18T08:10:17.053Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p067000dast96wy6gwqe","content":"<blockquote>\n<p>简要介绍Docker，记录Docker常用命令使用方法。</p>\n<p>搬运自师兄的博客 又见苍岚 ：<a href=\"https://www.zywvvd.com/2020/05/06/docker/docker_usage/\">https://www.zywvvd.com/2020/05/06/docker/docker_usage/</a></p>\n</blockquote>\n<h3 id=\"Docker-简介\">Docker 简介</h3>\n<blockquote>\n<p>**Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。**Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker，就不用担心环境问题。</p>\n</blockquote>\n<h3 id=\"Docker-使用流程\">Docker 使用流程</h3>\n<ul>\n<li><a href=\"https://docs.docker.com/desktop/\">安装docker</a></li>\n<li>创建Image</li>\n<li>从Image创建Container</li>\n<li>在Container中工作</li>\n<li>将在Container中做的修改提交给Image</li>\n<li>销毁Container</li>\n</ul>\n<h3 id=\"命令介绍\">命令介绍</h3>\n<ul>\n<li>拉取 image</li>\n</ul>\n<figure class=\"highlight apache\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">docker</span> image pull<span class=\"hljs-meta\"> [docker-url]</span><br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>获取docker images 列表</li>\n</ul>\n<figure class=\"highlight mel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs mel\">docker images<br>或<br>docker <span class=\"hljs-keyword\">image</span> <span class=\"hljs-keyword\">ls</span><br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>建立container （nvidia docker)</li>\n</ul>\n<figure class=\"highlight stylus\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">NV_GPU=<span class=\"hljs-selector-attr\">[gpu_num]</span> nvidia-docker run -it --name <span class=\"hljs-selector-attr\">[container_name]</span> --shm-size=<span class=\"hljs-selector-attr\">[shm_size]</span> --rm -v <span class=\"hljs-selector-attr\">[current_dir]</span>:<span class=\"hljs-selector-attr\">[container_dir]</span> -<span class=\"hljs-selector-tag\">p</span> <span class=\"hljs-selector-attr\">[current_port]</span>:<span class=\"hljs-selector-attr\">[container_port]</span> <span class=\"hljs-selector-attr\">[image_name]</span>:<span class=\"hljs-selector-attr\">[image_tag]</span>  <span class=\"hljs-selector-attr\">[command]</span> <br></code></pre></td></tr></tbody></table></figure>\n<p>实例：</p>\n<figure class=\"highlight apache\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">nvidia</span>-docker run -it --name mlfan --shm-size=<span class=\"hljs-number\">10</span>g -v /disk/fanmeilin:/workspace/fanmeilin -p <span class=\"hljs-number\">12345</span>:<span class=\"hljs-number\">22</span> -p <span class=\"hljs-number\">12346</span>:<span class=\"hljs-number\">8080</span> -p <span class=\"hljs-number\">12347</span>:<span class=\"hljs-number\">5678</span> tf-<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">14</span>-<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">0</span>-<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">1</span>:<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">0</span> bash<br></code></pre></td></tr></tbody></table></figure>\n<p><font color=\"SlateBlue\" size=\"4\">注意不要加 --rm&nbsp; 否则载在container stop之后会自动删除此容器</font></p>\n<blockquote>\n<p>NV_GPU: container中可见的GPU，如果不设置可见所有GPU</p>\n<p>-it: 将容器的 Shell 映射到当前的 Shell，然后你在本机窗口输入的命令，就会传入容器</p>\n<p>–name: 容器名称，如果不设置会随机分配一个名字</p>\n<p>–shm-size: 容器共享内存大小设置。如果不设置默认大小64M，对于需要使用共享内存的情况往往是不够用的，如果设置为10g，这样配置： <code>--ssh-size=\"10g\"</code></p>\n<p>–rm: 容器关闭后自动删除，如果不设置容器不会自动删除</p>\n<p>-v: 驱动器映射，将本机的目录映射到容器的指定文件夹中；需要说明的是，在主机文件夹中的挂载目录在容器中是可见的；需要再说明的是容器启动时主机挂载的目录容器是见不到的；最后说明，容器关闭再打开就可以看到主机挂载的所有文件夹了。</p>\n<p>-p: 暴漏容器的端口到本机的端口上，例如用于ssh连接容器时需要将容器的22端口暴露到主机的端口上(比如3721)，则可以设置 <code>-p 3721:22</code></p>\n<p>image_name, image_tag: 这是docker镜像的名称与标记，如果使用本机镜像可以在docker images列表中查询到</p>\n<p>command: 启动容器后内部执行的第一个命令，一般为 <code>/bin/bash</code></p>\n</blockquote>\n<ul>\n<li>查询container列表</li>\n</ul>\n<figure class=\"highlight jboss-cli\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jboss-cli\">docker container <span class=\"hljs-keyword\">ls</span> <span class=\"hljs-params\">--all</span><br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>–all: 加上该参数会显示没有在运行的容器，不加的话仅显示运行中的容器</p>\n</blockquote>\n<ul>\n<li>停止指定的容器运行</li>\n</ul>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">docker <span class=\"hljs-keyword\">container</span> kill <span class=\"hljs-comment\">[containerID]</span><br>docker stop <span class=\"hljs-comment\">[containerID]</span><br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p><code>docker container kill</code>命令终止容器运行，相当于向容器里面的主进程发出 SIGKILL 信号。<code>docker container stop</code>命令相当于向容器里面的主进程发出 SIGTERM 信号，然后过一段时间再发出 SIGKILL 信号。</p>\n</blockquote>\n<ul>\n<li>启动停止的容器</li>\n</ul>\n<figure class=\"highlight apache\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">docker</span> start<span class=\"hljs-meta\"> [containerID]</span><br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>重启运行的容器</li>\n</ul>\n<figure class=\"highlight apache\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">docker</span> restart<span class=\"hljs-meta\"> [containerID]</span><br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>删除指定的容器文件（仅在停止运行时可用）</li>\n</ul>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">docker <span class=\"hljs-keyword\">container</span> rm <span class=\"hljs-comment\">[containerID]</span><br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>查看容器输出</li>\n</ul>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">docker <span class=\"hljs-keyword\">container</span> logs <span class=\"hljs-comment\">[containerID]</span><br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>启动容器的一个终端</li>\n</ul>\n<figure class=\"highlight awk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\">docker exec -it [containerID] <span class=\"hljs-regexp\">/bin/</span>bash<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>此种方法启动的终端，即使退出也不会关闭容器</p>\n<p>相反 - 如果直接通过端口映射连接 docker 建立的ssh链接，窗口退出后该终端的工作也会一同停止</p>\n</blockquote>\n<ul>\n<li>进入容器的主终端</li>\n</ul>\n<figure class=\"highlight apache\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">docker</span> attach<span class=\"hljs-meta\"> [containerID]</span><br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>连接到容器的主终端，该终端退出后容器关闭。</p>\n<p>如果不希望退出后关闭，可以加入选项 <code>--sig-proxy=false</code></p>\n</blockquote>\n<ul>\n<li>退出终端</li>\n</ul>\n<figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">ctrl <span class=\"hljs-selector-tag\">p</span> + ctrl <span class=\"hljs-selector-tag\">q</span><br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>可以在退出终端的同时保持终端继续工作</p>\n</blockquote>\n<ul>\n<li>退出容器</li>\n</ul>\n<figure class=\"highlight awk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\"><span class=\"hljs-keyword\">exit</span><br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>在容器中运行此命令</p>\n</blockquote>\n<ul>\n<li>拷贝容器里的文件到本机</li>\n</ul>\n<figure class=\"highlight gradle\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs gradle\">docker container cp [containerID]:[<span class=\"hljs-regexp\">/path/</span>to/<span class=\"hljs-keyword\">file</span>]<br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>提交容器修改到镜像</li>\n</ul>\n<figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">docker commit -<span class=\"hljs-selector-tag\">a</span> <span class=\"hljs-selector-attr\">[name]</span> -m <span class=\"hljs-selector-attr\">[comments]</span> -<span class=\"hljs-selector-tag\">p</span>  <span class=\"hljs-selector-attr\">[containerID[:TAG]</span>]<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>-a: 提交的镜像作者</p>\n<p>-m: 提交时的说明文字</p>\n<p>-p: 在commit时，将容器暂停</p>\n</blockquote>\n<ul>\n<li>删除镜像</li>\n</ul>\n<figure class=\"highlight apache\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">docker</span> rmi<span class=\"hljs-meta\"> [image]</span><br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>或</p>\n</blockquote>\n<figure class=\"highlight arduino\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs arduino\">docker image rm [image]<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>支持的子命令如下：</p>\n</blockquote>\n<ul>\n<li><code>-f, -force</code>: 强制删除镜像，即便有容器引用该镜像；</li>\n<li><code>-no-prune</code>: 不要删除未带标签的父镜像；</li>\n</ul>\n<h3 id=\"参考资料\">参考资料</h3>\n<ul>\n<li><a href=\"http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html\">http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-tutorial.html\">https://www.runoob.com/docker/docker-tutorial.html</a></li>\n</ul>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>简要介绍Docker，记录Docker常用命令使用方法。</p>\n<p>搬运自师兄的博客 又见苍岚 ：<a href=\"https://www.zywvvd.com/2020/05/06/docker/docker_usage/\">https://www.zywvvd.com/2020/05/06/docker/docker_usage/</a></p>\n</blockquote>\n<h3 id=\"Docker-简介\">Docker 简介</h3>\n<blockquote>\n<p>**Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。**Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker，就不用担心环境问题。</p>\n</blockquote>\n<h3 id=\"Docker-使用流程\">Docker 使用流程</h3>\n<ul>\n<li><a href=\"https://docs.docker.com/desktop/\">安装docker</a></li>\n<li>创建Image</li>\n<li>从Image创建Container</li>\n<li>在Container中工作</li>\n<li>将在Container中做的修改提交给Image</li>\n<li>销毁Container</li>\n</ul>\n<h3 id=\"命令介绍\">命令介绍</h3>\n<ul>\n<li>拉取 image</li>\n</ul>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">docker</span> image pull<span class=\"hljs-meta\"> [docker-url]</span><br></code></pre></td></tr></table></figure>\n<ul>\n<li>获取docker images 列表</li>\n</ul>\n<figure class=\"highlight mel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs mel\">docker images<br>或<br>docker <span class=\"hljs-keyword\">image</span> <span class=\"hljs-keyword\">ls</span><br></code></pre></td></tr></table></figure>\n<ul>\n<li>建立container （nvidia docker)</li>\n</ul>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">NV_GPU=<span class=\"hljs-selector-attr\">[gpu_num]</span> nvidia-docker run -it --name <span class=\"hljs-selector-attr\">[container_name]</span> --shm-size=<span class=\"hljs-selector-attr\">[shm_size]</span> --rm -v <span class=\"hljs-selector-attr\">[current_dir]</span>:<span class=\"hljs-selector-attr\">[container_dir]</span> -<span class=\"hljs-selector-tag\">p</span> <span class=\"hljs-selector-attr\">[current_port]</span>:<span class=\"hljs-selector-attr\">[container_port]</span> <span class=\"hljs-selector-attr\">[image_name]</span>:<span class=\"hljs-selector-attr\">[image_tag]</span>  <span class=\"hljs-selector-attr\">[command]</span> <br></code></pre></td></tr></table></figure>\n<p>实例：</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">nvidia</span>-docker run -it --name mlfan --shm-size=<span class=\"hljs-number\">10</span>g -v /disk/fanmeilin:/workspace/fanmeilin -p <span class=\"hljs-number\">12345</span>:<span class=\"hljs-number\">22</span> -p <span class=\"hljs-number\">12346</span>:<span class=\"hljs-number\">8080</span> -p <span class=\"hljs-number\">12347</span>:<span class=\"hljs-number\">5678</span> tf-<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">14</span>-<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">0</span>-<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">1</span>:<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">0</span> bash<br></code></pre></td></tr></table></figure>\n<p><font color=SlateBlue size=4>注意不要加 --rm  否则载在container stop之后会自动删除此容器</font></p>\n<blockquote>\n<p>NV_GPU: container中可见的GPU，如果不设置可见所有GPU</p>\n<p>-it: 将容器的 Shell 映射到当前的 Shell，然后你在本机窗口输入的命令，就会传入容器</p>\n<p>–name: 容器名称，如果不设置会随机分配一个名字</p>\n<p>–shm-size: 容器共享内存大小设置。如果不设置默认大小64M，对于需要使用共享内存的情况往往是不够用的，如果设置为10g，这样配置： <code>--ssh-size=&quot;10g&quot;</code></p>\n<p>–rm: 容器关闭后自动删除，如果不设置容器不会自动删除</p>\n<p>-v: 驱动器映射，将本机的目录映射到容器的指定文件夹中；需要说明的是，在主机文件夹中的挂载目录在容器中是可见的；需要再说明的是容器启动时主机挂载的目录容器是见不到的；最后说明，容器关闭再打开就可以看到主机挂载的所有文件夹了。</p>\n<p>-p: 暴漏容器的端口到本机的端口上，例如用于ssh连接容器时需要将容器的22端口暴露到主机的端口上(比如3721)，则可以设置 <code>-p 3721:22</code></p>\n<p>image_name, image_tag: 这是docker镜像的名称与标记，如果使用本机镜像可以在docker images列表中查询到</p>\n<p>command: 启动容器后内部执行的第一个命令，一般为 <code>/bin/bash</code></p>\n</blockquote>\n<ul>\n<li>查询container列表</li>\n</ul>\n<figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jboss-cli\">docker container <span class=\"hljs-keyword\">ls</span> <span class=\"hljs-params\">--all</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>–all: 加上该参数会显示没有在运行的容器，不加的话仅显示运行中的容器</p>\n</blockquote>\n<ul>\n<li>停止指定的容器运行</li>\n</ul>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">docker <span class=\"hljs-keyword\">container</span> kill <span class=\"hljs-comment\">[containerID]</span><br>docker stop <span class=\"hljs-comment\">[containerID]</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p><code>docker container kill</code>命令终止容器运行，相当于向容器里面的主进程发出 SIGKILL 信号。<code>docker container stop</code>命令相当于向容器里面的主进程发出 SIGTERM 信号，然后过一段时间再发出 SIGKILL 信号。</p>\n</blockquote>\n<ul>\n<li>启动停止的容器</li>\n</ul>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">docker</span> start<span class=\"hljs-meta\"> [containerID]</span><br></code></pre></td></tr></table></figure>\n<ul>\n<li>重启运行的容器</li>\n</ul>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">docker</span> restart<span class=\"hljs-meta\"> [containerID]</span><br></code></pre></td></tr></table></figure>\n<ul>\n<li>删除指定的容器文件（仅在停止运行时可用）</li>\n</ul>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">docker <span class=\"hljs-keyword\">container</span> rm <span class=\"hljs-comment\">[containerID]</span><br></code></pre></td></tr></table></figure>\n<ul>\n<li>查看容器输出</li>\n</ul>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">docker <span class=\"hljs-keyword\">container</span> logs <span class=\"hljs-comment\">[containerID]</span><br></code></pre></td></tr></table></figure>\n<ul>\n<li>启动容器的一个终端</li>\n</ul>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\">docker exec -it [containerID] <span class=\"hljs-regexp\">/bin/</span>bash<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>此种方法启动的终端，即使退出也不会关闭容器</p>\n<p>相反 - 如果直接通过端口映射连接 docker 建立的ssh链接，窗口退出后该终端的工作也会一同停止</p>\n</blockquote>\n<ul>\n<li>进入容器的主终端</li>\n</ul>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">docker</span> attach<span class=\"hljs-meta\"> [containerID]</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>连接到容器的主终端，该终端退出后容器关闭。</p>\n<p>如果不希望退出后关闭，可以加入选项 <code>--sig-proxy=false</code></p>\n</blockquote>\n<ul>\n<li>退出终端</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">ctrl <span class=\"hljs-selector-tag\">p</span> + ctrl <span class=\"hljs-selector-tag\">q</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>可以在退出终端的同时保持终端继续工作</p>\n</blockquote>\n<ul>\n<li>退出容器</li>\n</ul>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\"><span class=\"hljs-keyword\">exit</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>在容器中运行此命令</p>\n</blockquote>\n<ul>\n<li>拷贝容器里的文件到本机</li>\n</ul>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs gradle\">docker container cp [containerID]:[<span class=\"hljs-regexp\">/path/</span>to/<span class=\"hljs-keyword\">file</span>]<br></code></pre></td></tr></table></figure>\n<ul>\n<li>提交容器修改到镜像</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\">docker commit -<span class=\"hljs-selector-tag\">a</span> <span class=\"hljs-selector-attr\">[name]</span> -m <span class=\"hljs-selector-attr\">[comments]</span> -<span class=\"hljs-selector-tag\">p</span>  <span class=\"hljs-selector-attr\">[containerID[:TAG]</span>]<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>-a: 提交的镜像作者</p>\n<p>-m: 提交时的说明文字</p>\n<p>-p: 在commit时，将容器暂停</p>\n</blockquote>\n<ul>\n<li>删除镜像</li>\n</ul>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">docker</span> rmi<span class=\"hljs-meta\"> [image]</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>或</p>\n</blockquote>\n<figure class=\"highlight arduino\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs arduino\">docker image rm [image]<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>支持的子命令如下：</p>\n</blockquote>\n<ul>\n<li><code>-f, -force</code>: 强制删除镜像，即便有容器引用该镜像；</li>\n<li><code>-no-prune</code>: 不要删除未带标签的父镜像；</li>\n</ul>\n<h3 id=\"参考资料\">参考资料</h3>\n<ul>\n<li><a href=\"http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html\">http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-tutorial.html\">https://www.runoob.com/docker/docker-tutorial.html</a></li>\n</ul>\n"},{"title":"docker的ssh相关配置","date":"2021-08-10T09:07:14.000Z","_content":"\n>参考师兄博客：https://www.zywvvd.com/2020/11/02/windows/win_ssh_linux_docker/win_ssh_linux_docker/\n\n> ssh是较可靠，专为远程登录会话和其他网络服务提供安全性的协议，广泛用于远程登录的场景，也是远程调试代码的神兵利器。在开发中经常会在服务器启动自己的 docker 容器进行开发，又需要调试代码，vim的调试环境配置起来门槛又太高。于是就有了使用Windows直接ssh打通docker进行调试的需求。本文记录Windows远程登录Linux服务器docker容器的方法。\n\n## 环境说明\n\n- 登录主机操作系统 Win 10\n- 被登录主机操作系统 docker container in Linux\n- 主机与被登录主机（此处指服务器，不是docker）网络联通，IP在同一网段\n- 服务器与docker的IP在同一网段\n\n## 配置方法\n\n### 建立docker与Linux服务器的端口映射\n\n> ssh协议链接时默认使用22端口，Windows与docker的端口往往不能直接进行映射（很可能不在一个网段），因此需要将docker的22端口映射到Linux服务器的某个端口，此时需要在建立docker容器时进行[配置](https://www.zywvvd.com/2020/05/14/coding/environment/wingide-remote-docker/wingide-remote-docker/#docker配置)：\n\n```\n$ docker run -it --name vvd -p 3721:22 -v /root/tmp:/root/tmp my_docker bash\n```\n\n- 其中 `-p` 的部分表示将本机（服务器）的3721端口映射到容器的22端口。\n\n### 容器内部安装ssh服务\n\n> 需要在被登录的容器内部建立并启动ssh服务。\n\n- 首先需要安装：\n\n```\napt-get update\napt-get install openssh-server\napt-get install openssh-client\n```\n\n- 安装完成后需要容器每次启动时自动运行相关服务，可以在 `~/.bashrc`中加入：\n\n```\n/etc/init.d/ssh start\n```\n\n> 这样就保证了docker容器自动启动该服务。\n\n- 查看ssh运行状态\n\n```\n/etc/init.d/ssh status\n```\n\n> 如果是 `* sshd is running` 说明ssh正常运行\n\n### 修改容器内root用户登录设置\n\n> 有的容器默认不支持root用户远程使用ssh协议进行密码登录的，此时需要更改设置。\n\n- 打开 `/etc/ssh/sshd_config`文件：\n\n```\n# PermitRootLogin prohibit-password # 默认打开 禁止root用户使用密码登陆，需要将其注释\nRSAAuthentication yes #启用 RSA 认证\nPubkeyAuthentication yes #启用公钥私钥配对认证方式\nPermitRootLogin yes #允许root用户使用ssh登录\n```\n\n- 将 `PermitRootLogin` 设置为 yes\n\n### 修改root密码\n\n> 远程登录时需要使用系统的用户密码，我们就直接使用root用户登录好了，需要设置新建容器的密码：\n\n```\npasswd root\n```\n\n### 设置SSH\n\n- [本地生成ssh key](https://www.zywvvd.com/2020/02/23/git/link_github/Git-connect-remote-pos/#创建SSH密钥)\n- 将.pub 内容复制粘贴加入到远程 ~/.ssh/authorized_keys\n\n### SSH连接服务器\n\n> 需要用户名（被登录端用户）与被登录的主机ip和端口号\n>\n> 例如： 用户名- root ip：192.168.10.12 端口映射为 3721\n\n- linux\n\n```\nssh root@192.168.10.12:3721\n```\n\n- Windows\n\n```\nssh -p 3721 root@192.168.10.12\n```\n\n![](https://photos.zywvvd.com/images_matrixtime/20201102200256.png)\n\n- 如果不清楚Linux系统端口映射配置情况：\n\n```\niptables -t nat -L -n\n```\n\n### X-shell配置\n\n> 命令行ssh登录成功后就可以在X-shell中建立配置信息方便地连接了。\n\n- 新建会话，填写名称、IP、端口号（我们刚刚配置过的）：\n\n![](https://photos.zywvvd.com/images_matrixtime/20201102200522.png)\n\n- 用户身份认证，填入用户名密码（刚刚配置过的）：\n\n![](https://photos.zywvvd.com/images_matrixtime/20201102200640.png)\n\n- 随后就可以使用该会话直接登录docker容器了，为远程调试打下了坚实的基础：\n\n![](https://photos.zywvvd.com/images_matrixtime/20201102200804.png)\n\n### 填坑\n\n- ssh: Could not resolve hostname 192.168.10.12:3721: Name or service not known\n\n  > 这是在Windows中使用了Linux格式的SSH登录命令导致的解析错误\n  >\n  > 将命令语法更换为Windows的格式即可\n\n- root 用户无论如何密码不被接受\n\n  > 需要在被登录主机 /etc/ssh/sshd_config 中设置：\n  >\n  > ```\n  > # PermitRootLogin prohibit-password # 默认打开 禁止root用户使用密码登陆，需要将其注释\n  > RSAAuthentication yes #启用 RSA 认证\n  > PubkeyAuthentication yes #启用公钥私钥配对认证方式\n  > PermitRootLogin yes #允许root用户使用ssh登录\n  > ```\n  >\n  > - 重点：**PermitRootLogin yes**\n\n- Connection to 192.168.10.12 closed.\n\n- 或\n\n- Connection closed by foreign host.\n\n  > 意思是 断开主机链接了，出现这种问题，跟你的IPTABLES，防火墙什么的都没关系。\n  >\n  > 造成这个原 因是因为原来连接到SSHD服务器进程的22端口，当你的客户端突然断开时，服务器端的TCP连接就处于一个半打开状态。当下一次同一客户机再次建立 TCP连接时，服务器检测到这个半打开的TCP连接，并向客户机回传一个置位RST的TCP报文，客户机就会显示connection closed by foreign host。\n  > 这是TCP协议本身的一个保护措施，并不是什么错误，你只要再重新连接服务器就能连上。\n  >\n  > ——— http://www.pooy.net/connection-closed-foreign-host.html\n  >\n  > 总结一下解决方案： **关机重启**\n\n### 关于ssh的相关配置\n\n#### 修改配置文件\n\n```\ncd /etc/ssh\nvi ssh_config #可设置ssh的默认端口（22）\nvi sshd_config\n```\n\nssh_config和sshd_config都是ssh服务器的配置文件，二者区别在于，前者是针对客户端的配置文件，后者则是针对服务端的配置文件。两个配置文件都允许你通过设置不同的选项来改变客户端程序的运行方式。\n\n#### 重启ssh服务\n\n```\nservice sshd restart\n```\n\n如果报错 sshd: unrecognized service 则需要开启ssh服务。\n\n```\n/etc/init.d/ssh start\n```\n\n## vscode连接远程服务器\n\n- 正确的ssh服务\n\n- 密码设置完成（passwd root）\n\n### 安装插件\n\n- 安装 Remote Development 插件\n\n  > 会自动安装 Remote-WSL / Containers / SSH 等插件。\n\n![](https://photos.zywvvd.com/images_matrixtime/20201028143530.png)\n\n### 配置主机信息\n\n> ctrl + shift + p\n\n![](https://photos.zywvvd.com/images_matrixtime/20201028174129.png)\n\n![](https://photos.zywvvd.com/images_matrixtime/20201028175152.png)\n\n```\nHost Enter\n  HostName 192.168.10.15\n  Port 12345\n  User root\n  IdentityFile ~\\.ssh\\id_rsa\n  IdentitiesOnly yes\n```\n\n### vs code 连接远程主机\n\n![](https://photos.zywvvd.com/images_matrixtime/20201028175324.png)\n\n> 之后选择目标主机的操作系统。\n\n- 成功连接到远程主机：\n\n- 打开文件夹运行程序时，选择使用的Python环境：\n\n#### 相对路径的设置\n\n在读取文件时，可能使用相对路径出现错误。\n\n> python 插件设置中没有设置`终端执行命令时使用文件的路径代替现在打开的目录`。\n\n### 解决方案\n\n- 搜索配置 `execute in file`：\n\n![](https://photos.zywvvd.com/win11-mt/20210717114300.png)\n","source":"_posts/docker/docker-ssh.md","raw":"---\ntitle: docker的ssh相关配置\ntags: [docker,远程配置,ssh]\ncategories: docker\ndate: 2021-08-10 17:07:14\n---\n\n>参考师兄博客：https://www.zywvvd.com/2020/11/02/windows/win_ssh_linux_docker/win_ssh_linux_docker/\n\n> ssh是较可靠，专为远程登录会话和其他网络服务提供安全性的协议，广泛用于远程登录的场景，也是远程调试代码的神兵利器。在开发中经常会在服务器启动自己的 docker 容器进行开发，又需要调试代码，vim的调试环境配置起来门槛又太高。于是就有了使用Windows直接ssh打通docker进行调试的需求。本文记录Windows远程登录Linux服务器docker容器的方法。\n\n## 环境说明\n\n- 登录主机操作系统 Win 10\n- 被登录主机操作系统 docker container in Linux\n- 主机与被登录主机（此处指服务器，不是docker）网络联通，IP在同一网段\n- 服务器与docker的IP在同一网段\n\n## 配置方法\n\n### 建立docker与Linux服务器的端口映射\n\n> ssh协议链接时默认使用22端口，Windows与docker的端口往往不能直接进行映射（很可能不在一个网段），因此需要将docker的22端口映射到Linux服务器的某个端口，此时需要在建立docker容器时进行[配置](https://www.zywvvd.com/2020/05/14/coding/environment/wingide-remote-docker/wingide-remote-docker/#docker配置)：\n\n```\n$ docker run -it --name vvd -p 3721:22 -v /root/tmp:/root/tmp my_docker bash\n```\n\n- 其中 `-p` 的部分表示将本机（服务器）的3721端口映射到容器的22端口。\n\n### 容器内部安装ssh服务\n\n> 需要在被登录的容器内部建立并启动ssh服务。\n\n- 首先需要安装：\n\n```\napt-get update\napt-get install openssh-server\napt-get install openssh-client\n```\n\n- 安装完成后需要容器每次启动时自动运行相关服务，可以在 `~/.bashrc`中加入：\n\n```\n/etc/init.d/ssh start\n```\n\n> 这样就保证了docker容器自动启动该服务。\n\n- 查看ssh运行状态\n\n```\n/etc/init.d/ssh status\n```\n\n> 如果是 `* sshd is running` 说明ssh正常运行\n\n### 修改容器内root用户登录设置\n\n> 有的容器默认不支持root用户远程使用ssh协议进行密码登录的，此时需要更改设置。\n\n- 打开 `/etc/ssh/sshd_config`文件：\n\n```\n# PermitRootLogin prohibit-password # 默认打开 禁止root用户使用密码登陆，需要将其注释\nRSAAuthentication yes #启用 RSA 认证\nPubkeyAuthentication yes #启用公钥私钥配对认证方式\nPermitRootLogin yes #允许root用户使用ssh登录\n```\n\n- 将 `PermitRootLogin` 设置为 yes\n\n### 修改root密码\n\n> 远程登录时需要使用系统的用户密码，我们就直接使用root用户登录好了，需要设置新建容器的密码：\n\n```\npasswd root\n```\n\n### 设置SSH\n\n- [本地生成ssh key](https://www.zywvvd.com/2020/02/23/git/link_github/Git-connect-remote-pos/#创建SSH密钥)\n- 将.pub 内容复制粘贴加入到远程 ~/.ssh/authorized_keys\n\n### SSH连接服务器\n\n> 需要用户名（被登录端用户）与被登录的主机ip和端口号\n>\n> 例如： 用户名- root ip：192.168.10.12 端口映射为 3721\n\n- linux\n\n```\nssh root@192.168.10.12:3721\n```\n\n- Windows\n\n```\nssh -p 3721 root@192.168.10.12\n```\n\n![](https://photos.zywvvd.com/images_matrixtime/20201102200256.png)\n\n- 如果不清楚Linux系统端口映射配置情况：\n\n```\niptables -t nat -L -n\n```\n\n### X-shell配置\n\n> 命令行ssh登录成功后就可以在X-shell中建立配置信息方便地连接了。\n\n- 新建会话，填写名称、IP、端口号（我们刚刚配置过的）：\n\n![](https://photos.zywvvd.com/images_matrixtime/20201102200522.png)\n\n- 用户身份认证，填入用户名密码（刚刚配置过的）：\n\n![](https://photos.zywvvd.com/images_matrixtime/20201102200640.png)\n\n- 随后就可以使用该会话直接登录docker容器了，为远程调试打下了坚实的基础：\n\n![](https://photos.zywvvd.com/images_matrixtime/20201102200804.png)\n\n### 填坑\n\n- ssh: Could not resolve hostname 192.168.10.12:3721: Name or service not known\n\n  > 这是在Windows中使用了Linux格式的SSH登录命令导致的解析错误\n  >\n  > 将命令语法更换为Windows的格式即可\n\n- root 用户无论如何密码不被接受\n\n  > 需要在被登录主机 /etc/ssh/sshd_config 中设置：\n  >\n  > ```\n  > # PermitRootLogin prohibit-password # 默认打开 禁止root用户使用密码登陆，需要将其注释\n  > RSAAuthentication yes #启用 RSA 认证\n  > PubkeyAuthentication yes #启用公钥私钥配对认证方式\n  > PermitRootLogin yes #允许root用户使用ssh登录\n  > ```\n  >\n  > - 重点：**PermitRootLogin yes**\n\n- Connection to 192.168.10.12 closed.\n\n- 或\n\n- Connection closed by foreign host.\n\n  > 意思是 断开主机链接了，出现这种问题，跟你的IPTABLES，防火墙什么的都没关系。\n  >\n  > 造成这个原 因是因为原来连接到SSHD服务器进程的22端口，当你的客户端突然断开时，服务器端的TCP连接就处于一个半打开状态。当下一次同一客户机再次建立 TCP连接时，服务器检测到这个半打开的TCP连接，并向客户机回传一个置位RST的TCP报文，客户机就会显示connection closed by foreign host。\n  > 这是TCP协议本身的一个保护措施，并不是什么错误，你只要再重新连接服务器就能连上。\n  >\n  > ——— http://www.pooy.net/connection-closed-foreign-host.html\n  >\n  > 总结一下解决方案： **关机重启**\n\n### 关于ssh的相关配置\n\n#### 修改配置文件\n\n```\ncd /etc/ssh\nvi ssh_config #可设置ssh的默认端口（22）\nvi sshd_config\n```\n\nssh_config和sshd_config都是ssh服务器的配置文件，二者区别在于，前者是针对客户端的配置文件，后者则是针对服务端的配置文件。两个配置文件都允许你通过设置不同的选项来改变客户端程序的运行方式。\n\n#### 重启ssh服务\n\n```\nservice sshd restart\n```\n\n如果报错 sshd: unrecognized service 则需要开启ssh服务。\n\n```\n/etc/init.d/ssh start\n```\n\n## vscode连接远程服务器\n\n- 正确的ssh服务\n\n- 密码设置完成（passwd root）\n\n### 安装插件\n\n- 安装 Remote Development 插件\n\n  > 会自动安装 Remote-WSL / Containers / SSH 等插件。\n\n![](https://photos.zywvvd.com/images_matrixtime/20201028143530.png)\n\n### 配置主机信息\n\n> ctrl + shift + p\n\n![](https://photos.zywvvd.com/images_matrixtime/20201028174129.png)\n\n![](https://photos.zywvvd.com/images_matrixtime/20201028175152.png)\n\n```\nHost Enter\n  HostName 192.168.10.15\n  Port 12345\n  User root\n  IdentityFile ~\\.ssh\\id_rsa\n  IdentitiesOnly yes\n```\n\n### vs code 连接远程主机\n\n![](https://photos.zywvvd.com/images_matrixtime/20201028175324.png)\n\n> 之后选择目标主机的操作系统。\n\n- 成功连接到远程主机：\n\n- 打开文件夹运行程序时，选择使用的Python环境：\n\n#### 相对路径的设置\n\n在读取文件时，可能使用相对路径出现错误。\n\n> python 插件设置中没有设置`终端执行命令时使用文件的路径代替现在打开的目录`。\n\n### 解决方案\n\n- 搜索配置 `execute in file`：\n\n![](https://photos.zywvvd.com/win11-mt/20210717114300.png)\n","slug":"docker/docker-ssh","published":1,"updated":"2022-01-18T08:10:17.053Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p069000hast90e7r9ws8","content":"<blockquote>\n<p>参考师兄博客：<a href=\"https://www.zywvvd.com/2020/11/02/windows/win_ssh_linux_docker/win_ssh_linux_docker/\">https://www.zywvvd.com/2020/11/02/windows/win_ssh_linux_docker/win_ssh_linux_docker/</a></p>\n</blockquote>\n<blockquote>\n<p>ssh是较可靠，专为远程登录会话和其他网络服务提供安全性的协议，广泛用于远程登录的场景，也是远程调试代码的神兵利器。在开发中经常会在服务器启动自己的 docker 容器进行开发，又需要调试代码，vim的调试环境配置起来门槛又太高。于是就有了使用Windows直接ssh打通docker进行调试的需求。本文记录Windows远程登录Linux服务器docker容器的方法。</p>\n</blockquote>\n<h2 id=\"环境说明\">环境说明</h2>\n<ul>\n<li>登录主机操作系统 Win 10</li>\n<li>被登录主机操作系统 docker container in Linux</li>\n<li>主机与被登录主机（此处指服务器，不是docker）网络联通，IP在同一网段</li>\n<li>服务器与docker的IP在同一网段</li>\n</ul>\n<h2 id=\"配置方法\">配置方法</h2>\n<h3 id=\"建立docker与Linux服务器的端口映射\">建立docker与Linux服务器的端口映射</h3>\n<blockquote>\n<p>ssh协议链接时默认使用22端口，Windows与docker的端口往往不能直接进行映射（很可能不在一个网段），因此需要将docker的22端口映射到Linux服务器的某个端口，此时需要在建立docker容器时进行<a href=\"https://www.zywvvd.com/2020/05/14/coding/environment/wingide-remote-docker/wingide-remote-docker/#docker%E9%85%8D%E7%BD%AE\">配置</a>：</p>\n</blockquote>\n<figure class=\"highlight awk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\">$ docker run -it --name vvd -p <span class=\"hljs-number\">3721</span>:<span class=\"hljs-number\">22</span> -v <span class=\"hljs-regexp\">/root/</span>tmp:<span class=\"hljs-regexp\">/root/</span>tmp my_docker bash<br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>其中 <code>-p</code> 的部分表示将本机（服务器）的3721端口映射到容器的22端口。</li>\n</ul>\n<h3 id=\"容器内部安装ssh服务\">容器内部安装ssh服务</h3>\n<blockquote>\n<p>需要在被登录的容器内部建立并启动ssh服务。</p>\n</blockquote>\n<ul>\n<li>首先需要安装：</li>\n</ul>\n<figure class=\"highlight routeros\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs routeros\">apt-<span class=\"hljs-builtin-name\">get</span> update<br>apt-<span class=\"hljs-builtin-name\">get</span> install openssh-server<br>apt-<span class=\"hljs-builtin-name\">get</span> install openssh-client<br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>安装完成后需要容器每次启动时自动运行相关服务，可以在 <code>~/.bashrc</code>中加入：</li>\n</ul>\n<figure class=\"highlight awk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\"><span class=\"hljs-regexp\">/etc/i</span>nit.d/ssh start<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>这样就保证了docker容器自动启动该服务。</p>\n</blockquote>\n<ul>\n<li>查看ssh运行状态</li>\n</ul>\n<figure class=\"highlight awk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\"><span class=\"hljs-regexp\">/etc/i</span>nit.d/ssh status<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>如果是 <code>* sshd is running</code> 说明ssh正常运行</p>\n</blockquote>\n<h3 id=\"修改容器内root用户登录设置\">修改容器内root用户登录设置</h3>\n<blockquote>\n<p>有的容器默认不支持root用户远程使用ssh协议进行密码登录的，此时需要更改设置。</p>\n</blockquote>\n<ul>\n<li>打开 <code>/etc/ssh/sshd_config</code>文件：</li>\n</ul>\n<figure class=\"highlight nginx\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-comment\"># PermitRootLogin prohibit-password # 默认打开 禁止root用户使用密码登陆，需要将其注释</span><br><span class=\"hljs-attribute\">RSAAuthentication</span> <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#启用 RSA 认证</span><br>PubkeyAuthentication <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#启用公钥私钥配对认证方式</span><br>PermitRootLogin <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#允许root用户使用ssh登录</span><br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>将 <code>PermitRootLogin</code> 设置为 yes</li>\n</ul>\n<h3 id=\"修改root密码\">修改root密码</h3>\n<blockquote>\n<p>远程登录时需要使用系统的用户密码，我们就直接使用root用户登录好了，需要设置新建容器的密码：</p>\n</blockquote>\n<figure class=\"highlight ebnf\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ebnf\"><span class=\"hljs-attribute\">passwd root</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"设置SSH\">设置SSH</h3>\n<ul>\n<li><a href=\"https://www.zywvvd.com/2020/02/23/git/link_github/Git-connect-remote-pos/#%E5%88%9B%E5%BB%BASSH%E5%AF%86%E9%92%A5\">本地生成ssh key</a></li>\n<li>将.pub 内容复制粘贴加入到远程 ~/.ssh/authorized_keys</li>\n</ul>\n<h3 id=\"SSH连接服务器\">SSH连接服务器</h3>\n<blockquote>\n<p>需要用户名（被登录端用户）与被登录的主机ip和端口号</p>\n<p>例如： 用户名- root ip：192.168.10.12 端口映射为 3721</p>\n</blockquote>\n<ul>\n<li>linux</li>\n</ul>\n<figure class=\"highlight nginx\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-attribute\">ssh</span> root@<span class=\"hljs-number\">192.168.10.12:3721</span><br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>Windows</li>\n</ul>\n<figure class=\"highlight apache\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">ssh</span> -p <span class=\"hljs-number\">3721</span> root@<span class=\"hljs-number\">192.168.10.12</span><br></code></pre></td></tr></tbody></table></figure>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201102200256.png\" alt=\"\"></p>\n<ul>\n<li>如果不清楚Linux系统端口映射配置情况：</li>\n</ul>\n<figure class=\"highlight excel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">iptables -<span class=\"hljs-built_in\">t</span> nat -L -<span class=\"hljs-built_in\">n</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"X-shell配置\">X-shell配置</h3>\n<blockquote>\n<p>命令行ssh登录成功后就可以在X-shell中建立配置信息方便地连接了。</p>\n</blockquote>\n<ul>\n<li>新建会话，填写名称、IP、端口号（我们刚刚配置过的）：</li>\n</ul>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201102200522.png\" alt=\"\"></p>\n<ul>\n<li>用户身份认证，填入用户名密码（刚刚配置过的）：</li>\n</ul>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201102200640.png\" alt=\"\"></p>\n<ul>\n<li>随后就可以使用该会话直接登录docker容器了，为远程调试打下了坚实的基础：</li>\n</ul>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201102200804.png\" alt=\"\"></p>\n<h3 id=\"填坑\">填坑</h3>\n<ul>\n<li>\n<p>ssh: Could not resolve hostname 192.168.10.12:3721: Name or service not known</p>\n<blockquote>\n<p>这是在Windows中使用了Linux格式的SSH登录命令导致的解析错误</p>\n<p>将命令语法更换为Windows的格式即可</p>\n</blockquote>\n</li>\n<li>\n<p>root 用户无论如何密码不被接受</p>\n<blockquote>\n<p>需要在被登录主机 /etc/ssh/sshd_config 中设置：</p>\n<figure class=\"highlight nginx\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-comment\"># PermitRootLogin prohibit-password # 默认打开 禁止root用户使用密码登陆，需要将其注释</span><br><span class=\"hljs-attribute\">RSAAuthentication</span> <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#启用 RSA 认证</span><br>PubkeyAuthentication <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#启用公钥私钥配对认证方式</span><br>PermitRootLogin <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#允许root用户使用ssh登录</span><br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>重点：<strong>PermitRootLogin yes</strong></li>\n</ul>\n</blockquote>\n</li>\n<li>\n<p>Connection to 192.168.10.12 closed.</p>\n</li>\n<li>\n<p>或</p>\n</li>\n<li>\n<p>Connection closed by foreign host.</p>\n<blockquote>\n<p>意思是 断开主机链接了，出现这种问题，跟你的IPTABLES，防火墙什么的都没关系。</p>\n<p>造成这个原 因是因为原来连接到SSHD服务器进程的22端口，当你的客户端突然断开时，服务器端的TCP连接就处于一个半打开状态。当下一次同一客户机再次建立 TCP连接时，服务器检测到这个半打开的TCP连接，并向客户机回传一个置位RST的TCP报文，客户机就会显示connection closed by foreign host。<br>\n这是TCP协议本身的一个保护措施，并不是什么错误，你只要再重新连接服务器就能连上。</p>\n<p>——— <a href=\"http://www.pooy.net/connection-closed-foreign-host.html\">http://www.pooy.net/connection-closed-foreign-host.html</a></p>\n<p>总结一下解决方案： <strong>关机重启</strong></p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"关于ssh的相关配置\">关于ssh的相关配置</h3>\n<h4 id=\"修改配置文件\">修改配置文件</h4>\n<figure class=\"highlight awk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\">cd <span class=\"hljs-regexp\">/etc/</span>ssh<br>vi ssh_config <span class=\"hljs-comment\">#可设置ssh的默认端口（22）</span><br>vi sshd_config<br></code></pre></td></tr></tbody></table></figure>\n<p>ssh_config和sshd_config都是ssh服务器的配置文件，二者区别在于，前者是针对客户端的配置文件，后者则是针对服务端的配置文件。两个配置文件都允许你通过设置不同的选项来改变客户端程序的运行方式。</p>\n<h4 id=\"重启ssh服务\">重启ssh服务</h4>\n<figure class=\"highlight ebnf\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ebnf\"><span class=\"hljs-attribute\">service sshd restart</span><br></code></pre></td></tr></tbody></table></figure>\n<p>如果报错 sshd: unrecognized service 则需要开启ssh服务。</p>\n<figure class=\"highlight awk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\"><span class=\"hljs-regexp\">/etc/i</span>nit.d/ssh start<br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"vscode连接远程服务器\">vscode连接远程服务器</h2>\n<ul>\n<li>\n<p>正确的ssh服务</p>\n</li>\n<li>\n<p>密码设置完成（passwd root）</p>\n</li>\n</ul>\n<h3 id=\"安装插件\">安装插件</h3>\n<ul>\n<li>\n<p>安装 Remote Development 插件</p>\n<blockquote>\n<p>会自动安装 Remote-WSL / Containers / SSH 等插件。</p>\n</blockquote>\n</li>\n</ul>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201028143530.png\" alt=\"\"></p>\n<h3 id=\"配置主机信息\">配置主机信息</h3>\n<blockquote>\n<p>ctrl + shift + p</p>\n</blockquote>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201028174129.png\" alt=\"\"></p>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201028175152.png\" alt=\"\"></p>\n<figure class=\"highlight crmsh\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs crmsh\">Host Enter<br>  HostName <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">10.15</span><br>  Port <span class=\"hljs-number\">12345</span><br>  <span class=\"hljs-keyword\">User</span> <span class=\"hljs-title\">root</span><br>  IdentityFile ~\\.ssh\\id_rsa<br>  IdentitiesOnly yes<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"vs-code-连接远程主机\">vs code 连接远程主机</h3>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201028175324.png\" alt=\"\"></p>\n<blockquote>\n<p>之后选择目标主机的操作系统。</p>\n</blockquote>\n<ul>\n<li>\n<p>成功连接到远程主机：</p>\n</li>\n<li>\n<p>打开文件夹运行程序时，选择使用的Python环境：</p>\n</li>\n</ul>\n<h4 id=\"相对路径的设置\">相对路径的设置</h4>\n<p>在读取文件时，可能使用相对路径出现错误。</p>\n<blockquote>\n<p>python 插件设置中没有设置<code>终端执行命令时使用文件的路径代替现在打开的目录</code>。</p>\n</blockquote>\n<h3 id=\"解决方案\">解决方案</h3>\n<ul>\n<li>搜索配置 <code>execute in file</code>：</li>\n</ul>\n<p><img src=\"https://photos.zywvvd.com/win11-mt/20210717114300.png\" alt=\"\"></p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>参考师兄博客：<a href=\"https://www.zywvvd.com/2020/11/02/windows/win_ssh_linux_docker/win_ssh_linux_docker/\">https://www.zywvvd.com/2020/11/02/windows/win_ssh_linux_docker/win_ssh_linux_docker/</a></p>\n</blockquote>\n<blockquote>\n<p>ssh是较可靠，专为远程登录会话和其他网络服务提供安全性的协议，广泛用于远程登录的场景，也是远程调试代码的神兵利器。在开发中经常会在服务器启动自己的 docker 容器进行开发，又需要调试代码，vim的调试环境配置起来门槛又太高。于是就有了使用Windows直接ssh打通docker进行调试的需求。本文记录Windows远程登录Linux服务器docker容器的方法。</p>\n</blockquote>\n<h2 id=\"环境说明\">环境说明</h2>\n<ul>\n<li>登录主机操作系统 Win 10</li>\n<li>被登录主机操作系统 docker container in Linux</li>\n<li>主机与被登录主机（此处指服务器，不是docker）网络联通，IP在同一网段</li>\n<li>服务器与docker的IP在同一网段</li>\n</ul>\n<h2 id=\"配置方法\">配置方法</h2>\n<h3 id=\"建立docker与Linux服务器的端口映射\">建立docker与Linux服务器的端口映射</h3>\n<blockquote>\n<p>ssh协议链接时默认使用22端口，Windows与docker的端口往往不能直接进行映射（很可能不在一个网段），因此需要将docker的22端口映射到Linux服务器的某个端口，此时需要在建立docker容器时进行<a href=\"https://www.zywvvd.com/2020/05/14/coding/environment/wingide-remote-docker/wingide-remote-docker/#docker%E9%85%8D%E7%BD%AE\">配置</a>：</p>\n</blockquote>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\">$ docker run -it --name vvd -p <span class=\"hljs-number\">3721</span>:<span class=\"hljs-number\">22</span> -v <span class=\"hljs-regexp\">/root/</span>tmp:<span class=\"hljs-regexp\">/root/</span>tmp my_docker bash<br></code></pre></td></tr></table></figure>\n<ul>\n<li>其中 <code>-p</code> 的部分表示将本机（服务器）的3721端口映射到容器的22端口。</li>\n</ul>\n<h3 id=\"容器内部安装ssh服务\">容器内部安装ssh服务</h3>\n<blockquote>\n<p>需要在被登录的容器内部建立并启动ssh服务。</p>\n</blockquote>\n<ul>\n<li>首先需要安装：</li>\n</ul>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs routeros\">apt-<span class=\"hljs-builtin-name\">get</span> update<br>apt-<span class=\"hljs-builtin-name\">get</span> install openssh-server<br>apt-<span class=\"hljs-builtin-name\">get</span> install openssh-client<br></code></pre></td></tr></table></figure>\n<ul>\n<li>安装完成后需要容器每次启动时自动运行相关服务，可以在 <code>~/.bashrc</code>中加入：</li>\n</ul>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\"><span class=\"hljs-regexp\">/etc/i</span>nit.d/ssh start<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>这样就保证了docker容器自动启动该服务。</p>\n</blockquote>\n<ul>\n<li>查看ssh运行状态</li>\n</ul>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\"><span class=\"hljs-regexp\">/etc/i</span>nit.d/ssh status<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>如果是 <code>* sshd is running</code> 说明ssh正常运行</p>\n</blockquote>\n<h3 id=\"修改容器内root用户登录设置\">修改容器内root用户登录设置</h3>\n<blockquote>\n<p>有的容器默认不支持root用户远程使用ssh协议进行密码登录的，此时需要更改设置。</p>\n</blockquote>\n<ul>\n<li>打开 <code>/etc/ssh/sshd_config</code>文件：</li>\n</ul>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-comment\"># PermitRootLogin prohibit-password # 默认打开 禁止root用户使用密码登陆，需要将其注释</span><br><span class=\"hljs-attribute\">RSAAuthentication</span> <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#启用 RSA 认证</span><br>PubkeyAuthentication <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#启用公钥私钥配对认证方式</span><br>PermitRootLogin <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#允许root用户使用ssh登录</span><br></code></pre></td></tr></table></figure>\n<ul>\n<li>将 <code>PermitRootLogin</code> 设置为 yes</li>\n</ul>\n<h3 id=\"修改root密码\">修改root密码</h3>\n<blockquote>\n<p>远程登录时需要使用系统的用户密码，我们就直接使用root用户登录好了，需要设置新建容器的密码：</p>\n</blockquote>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ebnf\"><span class=\"hljs-attribute\">passwd root</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"设置SSH\">设置SSH</h3>\n<ul>\n<li><a href=\"https://www.zywvvd.com/2020/02/23/git/link_github/Git-connect-remote-pos/#%E5%88%9B%E5%BB%BASSH%E5%AF%86%E9%92%A5\">本地生成ssh key</a></li>\n<li>将.pub 内容复制粘贴加入到远程 ~/.ssh/authorized_keys</li>\n</ul>\n<h3 id=\"SSH连接服务器\">SSH连接服务器</h3>\n<blockquote>\n<p>需要用户名（被登录端用户）与被登录的主机ip和端口号</p>\n<p>例如： 用户名- root ip：192.168.10.12 端口映射为 3721</p>\n</blockquote>\n<ul>\n<li>linux</li>\n</ul>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-attribute\">ssh</span> root@<span class=\"hljs-number\">192.168.10.12:3721</span><br></code></pre></td></tr></table></figure>\n<ul>\n<li>Windows</li>\n</ul>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">ssh</span> -p <span class=\"hljs-number\">3721</span> root@<span class=\"hljs-number\">192.168.10.12</span><br></code></pre></td></tr></table></figure>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201102200256.png\" alt=\"\"></p>\n<ul>\n<li>如果不清楚Linux系统端口映射配置情况：</li>\n</ul>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">iptables -<span class=\"hljs-built_in\">t</span> nat -L -<span class=\"hljs-built_in\">n</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"X-shell配置\">X-shell配置</h3>\n<blockquote>\n<p>命令行ssh登录成功后就可以在X-shell中建立配置信息方便地连接了。</p>\n</blockquote>\n<ul>\n<li>新建会话，填写名称、IP、端口号（我们刚刚配置过的）：</li>\n</ul>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201102200522.png\" alt=\"\"></p>\n<ul>\n<li>用户身份认证，填入用户名密码（刚刚配置过的）：</li>\n</ul>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201102200640.png\" alt=\"\"></p>\n<ul>\n<li>随后就可以使用该会话直接登录docker容器了，为远程调试打下了坚实的基础：</li>\n</ul>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201102200804.png\" alt=\"\"></p>\n<h3 id=\"填坑\">填坑</h3>\n<ul>\n<li>\n<p>ssh: Could not resolve hostname 192.168.10.12:3721: Name or service not known</p>\n<blockquote>\n<p>这是在Windows中使用了Linux格式的SSH登录命令导致的解析错误</p>\n<p>将命令语法更换为Windows的格式即可</p>\n</blockquote>\n</li>\n<li>\n<p>root 用户无论如何密码不被接受</p>\n<blockquote>\n<p>需要在被登录主机 /etc/ssh/sshd_config 中设置：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-comment\"># PermitRootLogin prohibit-password # 默认打开 禁止root用户使用密码登陆，需要将其注释</span><br><span class=\"hljs-attribute\">RSAAuthentication</span> <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#启用 RSA 认证</span><br>PubkeyAuthentication <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#启用公钥私钥配对认证方式</span><br>PermitRootLogin <span class=\"hljs-literal\">yes</span> <span class=\"hljs-comment\">#允许root用户使用ssh登录</span><br></code></pre></td></tr></table></figure>\n<ul>\n<li>重点：<strong>PermitRootLogin yes</strong></li>\n</ul>\n</blockquote>\n</li>\n<li>\n<p>Connection to 192.168.10.12 closed.</p>\n</li>\n<li>\n<p>或</p>\n</li>\n<li>\n<p>Connection closed by foreign host.</p>\n<blockquote>\n<p>意思是 断开主机链接了，出现这种问题，跟你的IPTABLES，防火墙什么的都没关系。</p>\n<p>造成这个原 因是因为原来连接到SSHD服务器进程的22端口，当你的客户端突然断开时，服务器端的TCP连接就处于一个半打开状态。当下一次同一客户机再次建立 TCP连接时，服务器检测到这个半打开的TCP连接，并向客户机回传一个置位RST的TCP报文，客户机就会显示connection closed by foreign host。<br>\n这是TCP协议本身的一个保护措施，并不是什么错误，你只要再重新连接服务器就能连上。</p>\n<p>——— <a href=\"http://www.pooy.net/connection-closed-foreign-host.html\">http://www.pooy.net/connection-closed-foreign-host.html</a></p>\n<p>总结一下解决方案： <strong>关机重启</strong></p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"关于ssh的相关配置\">关于ssh的相关配置</h3>\n<h4 id=\"修改配置文件\">修改配置文件</h4>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\">cd <span class=\"hljs-regexp\">/etc/</span>ssh<br>vi ssh_config <span class=\"hljs-comment\">#可设置ssh的默认端口（22）</span><br>vi sshd_config<br></code></pre></td></tr></table></figure>\n<p>ssh_config和sshd_config都是ssh服务器的配置文件，二者区别在于，前者是针对客户端的配置文件，后者则是针对服务端的配置文件。两个配置文件都允许你通过设置不同的选项来改变客户端程序的运行方式。</p>\n<h4 id=\"重启ssh服务\">重启ssh服务</h4>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ebnf\"><span class=\"hljs-attribute\">service sshd restart</span><br></code></pre></td></tr></table></figure>\n<p>如果报错 sshd: unrecognized service 则需要开启ssh服务。</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs awk\"><span class=\"hljs-regexp\">/etc/i</span>nit.d/ssh start<br></code></pre></td></tr></table></figure>\n<h2 id=\"vscode连接远程服务器\">vscode连接远程服务器</h2>\n<ul>\n<li>\n<p>正确的ssh服务</p>\n</li>\n<li>\n<p>密码设置完成（passwd root）</p>\n</li>\n</ul>\n<h3 id=\"安装插件\">安装插件</h3>\n<ul>\n<li>\n<p>安装 Remote Development 插件</p>\n<blockquote>\n<p>会自动安装 Remote-WSL / Containers / SSH 等插件。</p>\n</blockquote>\n</li>\n</ul>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201028143530.png\" alt=\"\"></p>\n<h3 id=\"配置主机信息\">配置主机信息</h3>\n<blockquote>\n<p>ctrl + shift + p</p>\n</blockquote>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201028174129.png\" alt=\"\"></p>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201028175152.png\" alt=\"\"></p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs crmsh\">Host Enter<br>  HostName <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">10.15</span><br>  Port <span class=\"hljs-number\">12345</span><br>  <span class=\"hljs-keyword\">User</span> <span class=\"hljs-title\">root</span><br>  IdentityFile ~\\.ssh\\id_rsa<br>  IdentitiesOnly yes<br></code></pre></td></tr></table></figure>\n<h3 id=\"vs-code-连接远程主机\">vs code 连接远程主机</h3>\n<p><img src=\"https://photos.zywvvd.com/images_matrixtime/20201028175324.png\" alt=\"\"></p>\n<blockquote>\n<p>之后选择目标主机的操作系统。</p>\n</blockquote>\n<ul>\n<li>\n<p>成功连接到远程主机：</p>\n</li>\n<li>\n<p>打开文件夹运行程序时，选择使用的Python环境：</p>\n</li>\n</ul>\n<h4 id=\"相对路径的设置\">相对路径的设置</h4>\n<p>在读取文件时，可能使用相对路径出现错误。</p>\n<blockquote>\n<p>python 插件设置中没有设置<code>终端执行命令时使用文件的路径代替现在打开的目录</code>。</p>\n</blockquote>\n<h3 id=\"解决方案\">解决方案</h3>\n<ul>\n<li>搜索配置 <code>execute in file</code>：</li>\n</ul>\n<p><img src=\"https://photos.zywvvd.com/win11-mt/20210717114300.png\" alt=\"\"></p>\n"},{"title":"Depthwise Separable Convolution","date":"2022-01-06T02:20:25.000Z","_content":"\n# Depthwise Separable Convolution\n\n> 在Mobilenet中使用DSconv，通过改进架构减少参数量的方法，所以也顺势记录一下Depthwise Separable卷积的原理。笔记来源于李宏毅的课程。:cry:\n\n## 传统的卷积过程\n\n![](https://picture.mulindya.com/kDistillation-3.png)\n\n\n\n## Depthwise Convolution\n\n第一个步骤，每一个filter只作用到一个Chanel，这里input和output的channel是相同的。\n\n![](https://picture.mulindya.com/kDistillation-4.png)\n\n\n\n## Pointwise Convolution\n\n跨channel操作是通过Pointwise Convolution来得到Feature map，这里是1*1的大小filter 因为只用考虑不同channel之间的关系即可。前面的Depthwise Convolution是已经考虑Channel内部的关系。\n\n![](https://picture.mulindya.com/kDistillation-5.png)\n\n\n\n\n\n![](https://picture.mulindya.com/kDistillation-6.png)\n\n所以参数量会减少K*K倍。\n\n## 原理\n\n### Low rank approximation\n\n![](https://picture.mulindya.com/kDistillation-7.png)\n\n这样可以减少参数。从W到U+V的参数规模，但是这样的变换会导致某些限制，减少w的可能性，因为使用U*V的秩是小于等于W的秩，所以映射的空间会减小。\n\n![](https://picture.mulindya.com/kDistillation-8.png)\n\n就可以对比传统的卷积和Depthwise卷积的原理就相当于W和UV的关系，把一层的映射拆成两次，所以参数量减少了，模型表示减小。\n\n## 相关网络\n\n使用Depthwise Conv的网络架构\n\n•SqueezeNet\n• https://arxiv.org/abs/1602.07360\n•MobileNet\n• https://arxiv.org/abs/1704.04861\n•ShuffleNet\n• https://arxiv.org/abs/1707.01083\n•Xception\n• https://arxiv.org/abs/1610.02357\n•GhostNet\n• https://arxiv.org/abs/1911.11907\n","source":"_posts/deep_learning/dsconv.md","raw":"---\ntitle: Depthwise Separable Convolution \ntags: [深度学习,MobileNet]\ncategories: [深度学习,MobileNet]\ndate: 2022-01-06 10:20:25\n---\n\n# Depthwise Separable Convolution\n\n> 在Mobilenet中使用DSconv，通过改进架构减少参数量的方法，所以也顺势记录一下Depthwise Separable卷积的原理。笔记来源于李宏毅的课程。:cry:\n\n## 传统的卷积过程\n\n![](https://picture.mulindya.com/kDistillation-3.png)\n\n\n\n## Depthwise Convolution\n\n第一个步骤，每一个filter只作用到一个Chanel，这里input和output的channel是相同的。\n\n![](https://picture.mulindya.com/kDistillation-4.png)\n\n\n\n## Pointwise Convolution\n\n跨channel操作是通过Pointwise Convolution来得到Feature map，这里是1*1的大小filter 因为只用考虑不同channel之间的关系即可。前面的Depthwise Convolution是已经考虑Channel内部的关系。\n\n![](https://picture.mulindya.com/kDistillation-5.png)\n\n\n\n\n\n![](https://picture.mulindya.com/kDistillation-6.png)\n\n所以参数量会减少K*K倍。\n\n## 原理\n\n### Low rank approximation\n\n![](https://picture.mulindya.com/kDistillation-7.png)\n\n这样可以减少参数。从W到U+V的参数规模，但是这样的变换会导致某些限制，减少w的可能性，因为使用U*V的秩是小于等于W的秩，所以映射的空间会减小。\n\n![](https://picture.mulindya.com/kDistillation-8.png)\n\n就可以对比传统的卷积和Depthwise卷积的原理就相当于W和UV的关系，把一层的映射拆成两次，所以参数量减少了，模型表示减小。\n\n## 相关网络\n\n使用Depthwise Conv的网络架构\n\n•SqueezeNet\n• https://arxiv.org/abs/1602.07360\n•MobileNet\n• https://arxiv.org/abs/1704.04861\n•ShuffleNet\n• https://arxiv.org/abs/1707.01083\n•Xception\n• https://arxiv.org/abs/1610.02357\n•GhostNet\n• https://arxiv.org/abs/1911.11907\n","slug":"deep_learning/dsconv","published":1,"updated":"2022-01-18T08:10:17.048Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p06b000iast9ghy2d78o","content":"<h1>Depthwise Separable Convolution</h1>\n<blockquote>\n<p>在Mobilenet中使用DSconv，通过改进架构减少参数量的方法，所以也顺势记录一下Depthwise Separable卷积的原理。笔记来源于李宏毅的课程。😢</p>\n</blockquote>\n<h2 id=\"传统的卷积过程\">传统的卷积过程</h2>\n<p><img src=\"https://picture.mulindya.com/kDistillation-3.png\" alt=\"\"></p>\n<h2 id=\"Depthwise-Convolution\">Depthwise Convolution</h2>\n<p>第一个步骤，每一个filter只作用到一个Chanel，这里input和output的channel是相同的。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-4.png\" alt=\"\"></p>\n<h2 id=\"Pointwise-Convolution\">Pointwise Convolution</h2>\n<p>跨channel操作是通过Pointwise Convolution来得到Feature map，这里是1*1的大小filter 因为只用考虑不同channel之间的关系即可。前面的Depthwise Convolution是已经考虑Channel内部的关系。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-5.png\" alt=\"\"></p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-6.png\" alt=\"\"></p>\n<p>所以参数量会减少K*K倍。</p>\n<h2 id=\"原理\">原理</h2>\n<h3 id=\"Low-rank-approximation\">Low rank approximation</h3>\n<p><img src=\"https://picture.mulindya.com/kDistillation-7.png\" alt=\"\"></p>\n<p>这样可以减少参数。从W到U+V的参数规模，但是这样的变换会导致某些限制，减少w的可能性，因为使用U*V的秩是小于等于W的秩，所以映射的空间会减小。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-8.png\" alt=\"\"></p>\n<p>就可以对比传统的卷积和Depthwise卷积的原理就相当于W和UV的关系，把一层的映射拆成两次，所以参数量减少了，模型表示减小。</p>\n<h2 id=\"相关网络\">相关网络</h2>\n<p>使用Depthwise Conv的网络架构</p>\n<p>•SqueezeNet<br>\n• <a href=\"https://arxiv.org/abs/1602.07360\">https://arxiv.org/abs/1602.07360</a><br>\n•MobileNet<br>\n• <a href=\"https://arxiv.org/abs/1704.04861\">https://arxiv.org/abs/1704.04861</a><br>\n•ShuffleNet<br>\n• <a href=\"https://arxiv.org/abs/1707.01083\">https://arxiv.org/abs/1707.01083</a><br>\n•Xception<br>\n• <a href=\"https://arxiv.org/abs/1610.02357\">https://arxiv.org/abs/1610.02357</a><br>\n•GhostNet<br>\n• <a href=\"https://arxiv.org/abs/1911.11907\">https://arxiv.org/abs/1911.11907</a></p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<h1>Depthwise Separable Convolution</h1>\n<blockquote>\n<p>在Mobilenet中使用DSconv，通过改进架构减少参数量的方法，所以也顺势记录一下Depthwise Separable卷积的原理。笔记来源于李宏毅的课程。😢</p>\n</blockquote>\n<h2 id=\"传统的卷积过程\">传统的卷积过程</h2>\n<p><img src=\"https://picture.mulindya.com/kDistillation-3.png\" alt=\"\"></p>\n<h2 id=\"Depthwise-Convolution\">Depthwise Convolution</h2>\n<p>第一个步骤，每一个filter只作用到一个Chanel，这里input和output的channel是相同的。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-4.png\" alt=\"\"></p>\n<h2 id=\"Pointwise-Convolution\">Pointwise Convolution</h2>\n<p>跨channel操作是通过Pointwise Convolution来得到Feature map，这里是1*1的大小filter 因为只用考虑不同channel之间的关系即可。前面的Depthwise Convolution是已经考虑Channel内部的关系。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-5.png\" alt=\"\"></p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-6.png\" alt=\"\"></p>\n<p>所以参数量会减少K*K倍。</p>\n<h2 id=\"原理\">原理</h2>\n<h3 id=\"Low-rank-approximation\">Low rank approximation</h3>\n<p><img src=\"https://picture.mulindya.com/kDistillation-7.png\" alt=\"\"></p>\n<p>这样可以减少参数。从W到U+V的参数规模，但是这样的变换会导致某些限制，减少w的可能性，因为使用U*V的秩是小于等于W的秩，所以映射的空间会减小。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-8.png\" alt=\"\"></p>\n<p>就可以对比传统的卷积和Depthwise卷积的原理就相当于W和UV的关系，把一层的映射拆成两次，所以参数量减少了，模型表示减小。</p>\n<h2 id=\"相关网络\">相关网络</h2>\n<p>使用Depthwise Conv的网络架构</p>\n<p>•SqueezeNet<br>\n• <a href=\"https://arxiv.org/abs/1602.07360\">https://arxiv.org/abs/1602.07360</a><br>\n•MobileNet<br>\n• <a href=\"https://arxiv.org/abs/1704.04861\">https://arxiv.org/abs/1704.04861</a><br>\n•ShuffleNet<br>\n• <a href=\"https://arxiv.org/abs/1707.01083\">https://arxiv.org/abs/1707.01083</a><br>\n•Xception<br>\n• <a href=\"https://arxiv.org/abs/1610.02357\">https://arxiv.org/abs/1610.02357</a><br>\n•GhostNet<br>\n• <a href=\"https://arxiv.org/abs/1911.11907\">https://arxiv.org/abs/1911.11907</a></p>\n"},{"title":"深度理解3D卷积","date":"2022-01-11T02:59:03.000Z","math":true,"_content":"\n> 在帕金森数据中涉及三维数据的训练和预测，用到了conv3但是对其背后的原理还有一些模糊的地方，conv2d与多通道的conv2d的区别在哪里？conv3d的思想理论是什么？对此进行探究和记录...... :flushed:\n\n> 首先要明确多通道的2d卷积和3d卷积是不一样的，3d是可以在通道中移动的，2d达咩！\n\n## 卷积核的维度\n\n卷积核的维度指的的进行滑窗操作的维度，而滑窗操作不在channel维度上进行，不管有几个channel，它们都共享同一个滑窗位置（虽然2D多channel卷积的时候每个channel上的卷积核权重是独立的，但滑窗位置是共享的）。所以在讨论卷积核维度的时候，是不把channel维加进去的。\n\n<font color=purple> **2D conv的卷积核就是$(c, k_h, k_w)$，因此，对于RGB图像做2D卷积，卷积核可以是conv2D(3,3) 而不该是conv3D(3,3,3)；**</font>\n\n<font color=green> **3D conv的卷积核就是$(c, k_d, k_h, k_w)$，其中k_d就是多出来的第三维，根据具体应用，在视频中就是时间维，在CT图像中就是层数维.**  </font>\n\n\n## 2D卷积\n\n### 单通道\n\n首先了解什么是卷积核，卷积核(filter)是由一组参数构成的张量，卷积核相当于权值，图像相当于输入量，卷积的操作就是根据卷积核对这些输入量进行加权求和。我们通常用卷积来提取图像的特征。\n\n直观理解如下：下图使用的是 3x3卷积核(height x width,简写$ H \\times W$) 的卷积，padding为1(周围的虚线部分，卷积时为了使卷积后的图像大小与原来一致，会对原图像进行填充)，两个维度上的strides均为1(滑动步长，这里体现为每次滑动几个小方格)。\n\n![](https://picture.mulindya.com/2dconv.gif)\n\n针对单通道，输入图像的channel为1，即输入大小为$(1, height, weight)$，卷积核尺寸为 $(1, k_h, k_w)$，卷积核在输入图像上的的空间维度（即(height, width)两维）上进行进行滑窗操作，每次滑窗和 $(k_h, k_w)$ 窗口内的values进行卷积操作（现在都用相关操作取代），得到输出图像中的一个value。\n\n上图是通道数为1的2维图像的卷积操作，静态表示为：\n\n![](https://picture.mulindya.com/conv3d-1.png)\n\n### 多通道\n\n了解了单通道图像的卷积之后，再来看多通道图像的卷积，我们知道灰度图像只有一个通道，而 RGB 图像有R、G、B三个通道。\n多通道图像的一次卷积要对所有通道上同一位置的元素做加权和，因此卷积核的shape变成了 $H \\times W \\times channels$，没有错卷积核变成了3维，但这不是3维卷积，因为我们区分几维卷积看的是卷积核可以在几个维度上的滑动，卷积核是不能在 channels上滑动的，因为上面提到每次卷积都要关联所有通道上同一位置上的元素。\n3通道的卷积表示如下：是对每个通道进行2d卷积操作然后把最后的值相加的到右侧的小方块。\n\n![](https://picture.mulindya.com/conv3d-2.png)\n\n上图将3个通道分开表示，卷积核也分开表示，filter1、filter2、filter3均为二维卷积核，堆叠在一起便形成了$ H \\times W \\times 3$的卷积核，同样的我们将3个通道也堆叠在一起;\n\n针对多通道，假定输入图像的channel为c，即输入大小为$(c, height, weight)$，卷积核尺寸为 $(c, k_h, k_w)$， 卷积核在输入图像的空间维度即$(height, width)$两维上进行滑窗操作（在channel这一维度没有滑动只有相加），每次滑窗与c个channels上的$ (k_h, k_w)$ 窗口内的所有的values进行相关操作，得到输出图像中的一个value（多通道的信息被完全压缩了)\n\n于是形成了下面的3维表示图：\n![](https://picture.mulindya.com/conv3d-3.png)\n\n虽然是一个卷积核，但是每个filter的权重值是不一样的哦~\n\n如下如所示：在卷积核的每个通道上的权重是不一定相同的，`这里的6=4+0+1+偏移1`\n\n![](https://picture.mulindya.com/conv3d-6.png)\n\n\n\n### 代码\n\n```python\ntorch.nn.Conv2d(in_channels, out_channels, kernel_size, stride=1, padding=0, dilation=1, groups=1, bias=True, padding_mode='zeros', device=None, dtype=None)\n```\n\n- **in_channels** ([*int*](https://docs.python.org/3/library/functions.html#int)) – Number of channels in the input image\n- **out_channels** ([*int*](https://docs.python.org/3/library/functions.html#int)) – Number of channels produced by the convolution\n- **kernel_size** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)) – Size of the convolving kernel\n- **stride** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)*,* *optional*) – Stride of the convolution. Default: 1\n- **padding** ([*int*](https://docs.python.org/3/library/functions.html#int)*,* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple) *or* [*str*](https://docs.python.org/3/library/stdtypes.html#str)*,* *optional*) – Padding added to all four sides of the input. Default: 0\n- **padding_mode** (*string**,* *optional*) – `'zeros'`, `'reflect'`, `'replicate'` or `'circular'`. Default: `'zeros'`\n- **dilation** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)*,* *optional*) – Spacing between kernel elements. Default: 1\n- **groups** ([*int*](https://docs.python.org/3/library/functions.html#int)*,* *optional*) – Number of blocked connections from input channels to output channels. Default: 1\n- **bias** ([*bool*](https://docs.python.org/3/library/functions.html#bool)*,* *optional*) – If `True`, adds a learnable bias to the output. Default: `True`\n\nApplies a 2D convolution over an input signal composed of several input planes.\n\nIn the simplest case, the output value of the layer with input size $(N, C_{\\text{in}}, H, W)$and output $(N, C_{\\text{out}}, H_{\\text{out}}, W_{\\text{out}})$ can be precisely described as:\n\n{% raw %}\n$$\n\\text{out}(N_i, C_{\\text{out}_j}) = \\text{bias}(C_{\\text{out}_j}) + \\sum_{k = 0}^{C_{\\text{in}} - 1} \\text{weight}(C_{\\text{out}_j}, k) \\star \\text{input}(N_i, k)\n$$\n{% endraw %}\n\nwhere ⋆ is the valid 2D [cross-correlation](https://en.wikipedia.org/wiki/Cross-correlation) operator, N*N* is a batch size, C*C* denotes a number of channels, H*H* is a height of input planes in pixels, and W*W* is width in pixels.\n\nThis module supports [TensorFloat32](https://pytorch.org/docs/stable/notes/cuda.html#tf32-on-ampere).\n\n- `stride` controls the stride for the cross-correlation, a single number or a tuple.\n\n- `padding` controls the amount of padding applied to the input. It can be either a string {‘valid’, ‘same’} or a tuple of ints giving the amount of implicit padding applied on both sides.\n\n- `dilation` controls the spacing between the kernel points; also known as the à trous algorithm. It is harder to describe, but this [link](https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md) has a nice visualization of what `dilation` does.\n\n- `groups` controls the connections between inputs and outputs. `in_channels` and `out_channels` must both be divisible by `groups`. For example,\n\n  > - At groups=1, all inputs are convolved to all outputs.\n  > - At groups=2, the operation becomes equivalent to having two conv layers side by side, each seeing half the input channels and producing half the output channels, and both subsequently concatenated.\n  > - At groups= `in_channels`, each input channel is convolved with its own set of filters (of size $\\frac{\\text{out\\_channels}}{\\text{in\\_channels}}$ ).\n\nThe parameters `kernel_size`, `stride`, `padding`, `dilation` can either be:\n\n> - a single `int` – in which case the same value is used for the height and width dimension\n> - a `tuple` of two ints – in which case, the first int is used for the height dimension, and the second int for the width dimension\n\n#### example\n\n```python\n# With square kernels and equal stride\nm = nn.Conv2d(16, 33, 3, stride=2)\n# non-square kernels and unequal stride and with padding\nm = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2))\n# non-square kernels and unequal stride and with padding and dilation\nm = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2), dilation=(3, 1))\ninput = torch.randn(20, 16, 50, 100)\noutput = m(input)\n```\n\n#### 2d卷积操作后变化\n\n![](https://picture.mulindya.com/conv3d-7.png)\n\n## 3D卷积\n\n### 单通道\n\n用类似的方法我们先分析单通道图像的3D卷积，3D卷积的对象是三维图像，因此卷积核变成了$depth \\times height \\times width $简写为$D \\times H \\times W $。单通道的`3D卷积`动态图如下：\n![](https://picture.mulindya.com/conv3d.gif)\n\n\n\n\n\n针对单通道，与2D卷积不同之处在于，**输入图像多了一个 depth 维度**，故输入大小为$(1, depth, height, width)$，卷积核也多了一个$k_d$维度，因此卷积核在输入3D图像的空间维度$(depth,height,width)$上均进行滑窗操作，每次滑窗与$ (k_d, k_h, k_w) $窗口内的values进行相关操作，得到输出3D图像中的一个value，最终输出一个3D的特征图。\n\n这里的3D不是通道导致的，而是深度（多层切片，多帧视频），因此，虽然输入和卷积核和输出都是3D的，但都可以是单通道的。\n\n将上述静态表示成：\n\n![](https://picture.mulindya.com/conv3d-4.png)\n\n### 多通道\n\n![](https://picture.mulindya.com/conv3d-5.png)\n\n然后将filter1、filter2、filter3堆叠在一起形成一个4维卷积核$ D \\times H \\times W \\times 3$，同理将各通道堆叠在一起就形成了多通道的3D卷积输入图像。\n\n针对多通道,比如c个通道，输入大小为$(c, depth, height, width)$，与2D多通道卷积的操作类似，对于每次滑窗，卷积核同时与c个channels上的 $(k_d, k_h, k_w)$ 窗口内的所有values进行相关操作，得到输出3D图像中的一个value。\n由于3D卷积中的卷积核是3D的，因此在每个channel下使用的是同样的参数，权重共享。不同于2D多通道下的卷积核，后者在每一个channel使用的权重是一样的，不同的通道权重可能不一样。\n\n#### 代码\n\n\n```python\ntorch.nn.Conv3d(in_channels, out_channels, kernel_size, stride=1, padding=0, dilation=1, groups=1, bias=True, padding_mode='zeros', device=None, dtype=None)\n```\n\n- **in_channels** ([*int*](https://docs.python.org/3/library/functions.html#int)) – Number of channels in the input image\n- **out_channels** ([*int*](https://docs.python.org/3/library/functions.html#int)) – Number of channels produced by the convolution\n- **kernel_size** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)) – Size of the convolving kernel\n- **stride** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)*,* *optional*) – Stride of the convolution. Default: 1\n- **padding** ([*int*](https://docs.python.org/3/library/functions.html#int)*,* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple) *or* [*str*](https://docs.python.org/3/library/stdtypes.html#str)*,* *optional*) – Padding added to all six sides of the input. Default: 0\n- **padding_mode** (*string**,* *optional*) – `'zeros'`, `'reflect'`, `'replicate'` or `'circular'`. Default: `'zeros'`\n- **dilation** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)*,* *optional*) – Spacing between kernel elements. Default: 1\n- **groups** ([*int*](https://docs.python.org/3/library/functions.html#int)*,* *optional*) – Number of blocked connections from input channels to output channels. Default: 1\n- **bias** ([*bool*](https://docs.python.org/3/library/functions.html#bool)*,* *optional*) – If `True`, adds a learnable bias to the output. Default: `True`\n\n<font color=red>**和2D卷积函数基本上是一样的，只是维度和内部的工作机制不太一样。**</font>\n\nApplies a 3D convolution over an input signal composed of several input planes.\n\nIn the simplest case, the output value of the layer with input size$ (N, C_{in}, D, H, W)$  and output $(N, C_{out}, D_{out}, H_{out}, W_{out})$ can be precisely described as:\n\n{% raw %}\n$$\nout(N_i, C_{out_j}) = bias(C_{out_j}) + \\sum_{k = 0}^{C_{in} - 1} weight(C_{out_j}, k) \\star input(N_i, k)\n$$\n{% endraw %}\n\nwhere ⋆ is the valid 3D [cross-correlation](https://en.wikipedia.org/wiki/Cross-correlation) operator\n\nThis module supports [TensorFloat32](https://pytorch.org/docs/stable/notes/cuda.html#tf32-on-ampere).\n\n- `stride` controls the stride for the cross-correlation.\n\n- `padding` controls the amount of padding applied to the input. It can be either a string {‘valid’, ‘same’} or a tuple of ints giving the amount of implicit padding applied on both sides.\n\n- `dilation` controls the spacing between the kernel points; also known as the à trous algorithm. It is harder to describe, but this [link](https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md) has a nice visualization of what `dilation` does.\n\n- `groups` controls the connections between inputs and outputs. `in_channels` and `out_channels` must both be divisible by `groups`. For example,\n\n  > - At groups=1, all inputs are convolved to all outputs.\n  > - At groups=2, the operation becomes equivalent to having two conv layers side by side, each seeing half the input channels and producing half the output channels, and both subsequently concatenated.\n  > - At groups= `in_channels`, each input channel is convolved with its own set of filters (of size $\\frac{\\text{out\\_channels}}{\\text{in\\_channels}}$).\n\nThe parameters `kernel_size`, `stride`, `padding`, `dilation` can either be:\n\n> - a single `int` – in which case the same value is used for the depth, height and width dimension\n> - a `tuple` of three ints – in which case, the first int is used for the depth dimension, the second int for the height dimension and the third int for the width dimension\n\n![](https://picture.mulindya.com/conv3d-8.png)\n","source":"_posts/deep_learning/conv3d.md","raw":"---\ntitle: 深度理解3D卷积\ntags: [深度学习]\ncategories: 深度学习\ndate: 2022-01-11 10:59:03\nmath: true\n---\n\n> 在帕金森数据中涉及三维数据的训练和预测，用到了conv3但是对其背后的原理还有一些模糊的地方，conv2d与多通道的conv2d的区别在哪里？conv3d的思想理论是什么？对此进行探究和记录...... :flushed:\n\n> 首先要明确多通道的2d卷积和3d卷积是不一样的，3d是可以在通道中移动的，2d达咩！\n\n## 卷积核的维度\n\n卷积核的维度指的的进行滑窗操作的维度，而滑窗操作不在channel维度上进行，不管有几个channel，它们都共享同一个滑窗位置（虽然2D多channel卷积的时候每个channel上的卷积核权重是独立的，但滑窗位置是共享的）。所以在讨论卷积核维度的时候，是不把channel维加进去的。\n\n<font color=purple> **2D conv的卷积核就是$(c, k_h, k_w)$，因此，对于RGB图像做2D卷积，卷积核可以是conv2D(3,3) 而不该是conv3D(3,3,3)；**</font>\n\n<font color=green> **3D conv的卷积核就是$(c, k_d, k_h, k_w)$，其中k_d就是多出来的第三维，根据具体应用，在视频中就是时间维，在CT图像中就是层数维.**  </font>\n\n\n## 2D卷积\n\n### 单通道\n\n首先了解什么是卷积核，卷积核(filter)是由一组参数构成的张量，卷积核相当于权值，图像相当于输入量，卷积的操作就是根据卷积核对这些输入量进行加权求和。我们通常用卷积来提取图像的特征。\n\n直观理解如下：下图使用的是 3x3卷积核(height x width,简写$ H \\times W$) 的卷积，padding为1(周围的虚线部分，卷积时为了使卷积后的图像大小与原来一致，会对原图像进行填充)，两个维度上的strides均为1(滑动步长，这里体现为每次滑动几个小方格)。\n\n![](https://picture.mulindya.com/2dconv.gif)\n\n针对单通道，输入图像的channel为1，即输入大小为$(1, height, weight)$，卷积核尺寸为 $(1, k_h, k_w)$，卷积核在输入图像上的的空间维度（即(height, width)两维）上进行进行滑窗操作，每次滑窗和 $(k_h, k_w)$ 窗口内的values进行卷积操作（现在都用相关操作取代），得到输出图像中的一个value。\n\n上图是通道数为1的2维图像的卷积操作，静态表示为：\n\n![](https://picture.mulindya.com/conv3d-1.png)\n\n### 多通道\n\n了解了单通道图像的卷积之后，再来看多通道图像的卷积，我们知道灰度图像只有一个通道，而 RGB 图像有R、G、B三个通道。\n多通道图像的一次卷积要对所有通道上同一位置的元素做加权和，因此卷积核的shape变成了 $H \\times W \\times channels$，没有错卷积核变成了3维，但这不是3维卷积，因为我们区分几维卷积看的是卷积核可以在几个维度上的滑动，卷积核是不能在 channels上滑动的，因为上面提到每次卷积都要关联所有通道上同一位置上的元素。\n3通道的卷积表示如下：是对每个通道进行2d卷积操作然后把最后的值相加的到右侧的小方块。\n\n![](https://picture.mulindya.com/conv3d-2.png)\n\n上图将3个通道分开表示，卷积核也分开表示，filter1、filter2、filter3均为二维卷积核，堆叠在一起便形成了$ H \\times W \\times 3$的卷积核，同样的我们将3个通道也堆叠在一起;\n\n针对多通道，假定输入图像的channel为c，即输入大小为$(c, height, weight)$，卷积核尺寸为 $(c, k_h, k_w)$， 卷积核在输入图像的空间维度即$(height, width)$两维上进行滑窗操作（在channel这一维度没有滑动只有相加），每次滑窗与c个channels上的$ (k_h, k_w)$ 窗口内的所有的values进行相关操作，得到输出图像中的一个value（多通道的信息被完全压缩了)\n\n于是形成了下面的3维表示图：\n![](https://picture.mulindya.com/conv3d-3.png)\n\n虽然是一个卷积核，但是每个filter的权重值是不一样的哦~\n\n如下如所示：在卷积核的每个通道上的权重是不一定相同的，`这里的6=4+0+1+偏移1`\n\n![](https://picture.mulindya.com/conv3d-6.png)\n\n\n\n### 代码\n\n```python\ntorch.nn.Conv2d(in_channels, out_channels, kernel_size, stride=1, padding=0, dilation=1, groups=1, bias=True, padding_mode='zeros', device=None, dtype=None)\n```\n\n- **in_channels** ([*int*](https://docs.python.org/3/library/functions.html#int)) – Number of channels in the input image\n- **out_channels** ([*int*](https://docs.python.org/3/library/functions.html#int)) – Number of channels produced by the convolution\n- **kernel_size** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)) – Size of the convolving kernel\n- **stride** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)*,* *optional*) – Stride of the convolution. Default: 1\n- **padding** ([*int*](https://docs.python.org/3/library/functions.html#int)*,* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple) *or* [*str*](https://docs.python.org/3/library/stdtypes.html#str)*,* *optional*) – Padding added to all four sides of the input. Default: 0\n- **padding_mode** (*string**,* *optional*) – `'zeros'`, `'reflect'`, `'replicate'` or `'circular'`. Default: `'zeros'`\n- **dilation** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)*,* *optional*) – Spacing between kernel elements. Default: 1\n- **groups** ([*int*](https://docs.python.org/3/library/functions.html#int)*,* *optional*) – Number of blocked connections from input channels to output channels. Default: 1\n- **bias** ([*bool*](https://docs.python.org/3/library/functions.html#bool)*,* *optional*) – If `True`, adds a learnable bias to the output. Default: `True`\n\nApplies a 2D convolution over an input signal composed of several input planes.\n\nIn the simplest case, the output value of the layer with input size $(N, C_{\\text{in}}, H, W)$and output $(N, C_{\\text{out}}, H_{\\text{out}}, W_{\\text{out}})$ can be precisely described as:\n\n{% raw %}\n$$\n\\text{out}(N_i, C_{\\text{out}_j}) = \\text{bias}(C_{\\text{out}_j}) + \\sum_{k = 0}^{C_{\\text{in}} - 1} \\text{weight}(C_{\\text{out}_j}, k) \\star \\text{input}(N_i, k)\n$$\n{% endraw %}\n\nwhere ⋆ is the valid 2D [cross-correlation](https://en.wikipedia.org/wiki/Cross-correlation) operator, N*N* is a batch size, C*C* denotes a number of channels, H*H* is a height of input planes in pixels, and W*W* is width in pixels.\n\nThis module supports [TensorFloat32](https://pytorch.org/docs/stable/notes/cuda.html#tf32-on-ampere).\n\n- `stride` controls the stride for the cross-correlation, a single number or a tuple.\n\n- `padding` controls the amount of padding applied to the input. It can be either a string {‘valid’, ‘same’} or a tuple of ints giving the amount of implicit padding applied on both sides.\n\n- `dilation` controls the spacing between the kernel points; also known as the à trous algorithm. It is harder to describe, but this [link](https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md) has a nice visualization of what `dilation` does.\n\n- `groups` controls the connections between inputs and outputs. `in_channels` and `out_channels` must both be divisible by `groups`. For example,\n\n  > - At groups=1, all inputs are convolved to all outputs.\n  > - At groups=2, the operation becomes equivalent to having two conv layers side by side, each seeing half the input channels and producing half the output channels, and both subsequently concatenated.\n  > - At groups= `in_channels`, each input channel is convolved with its own set of filters (of size $\\frac{\\text{out\\_channels}}{\\text{in\\_channels}}$ ).\n\nThe parameters `kernel_size`, `stride`, `padding`, `dilation` can either be:\n\n> - a single `int` – in which case the same value is used for the height and width dimension\n> - a `tuple` of two ints – in which case, the first int is used for the height dimension, and the second int for the width dimension\n\n#### example\n\n```python\n# With square kernels and equal stride\nm = nn.Conv2d(16, 33, 3, stride=2)\n# non-square kernels and unequal stride and with padding\nm = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2))\n# non-square kernels and unequal stride and with padding and dilation\nm = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2), dilation=(3, 1))\ninput = torch.randn(20, 16, 50, 100)\noutput = m(input)\n```\n\n#### 2d卷积操作后变化\n\n![](https://picture.mulindya.com/conv3d-7.png)\n\n## 3D卷积\n\n### 单通道\n\n用类似的方法我们先分析单通道图像的3D卷积，3D卷积的对象是三维图像，因此卷积核变成了$depth \\times height \\times width $简写为$D \\times H \\times W $。单通道的`3D卷积`动态图如下：\n![](https://picture.mulindya.com/conv3d.gif)\n\n\n\n\n\n针对单通道，与2D卷积不同之处在于，**输入图像多了一个 depth 维度**，故输入大小为$(1, depth, height, width)$，卷积核也多了一个$k_d$维度，因此卷积核在输入3D图像的空间维度$(depth,height,width)$上均进行滑窗操作，每次滑窗与$ (k_d, k_h, k_w) $窗口内的values进行相关操作，得到输出3D图像中的一个value，最终输出一个3D的特征图。\n\n这里的3D不是通道导致的，而是深度（多层切片，多帧视频），因此，虽然输入和卷积核和输出都是3D的，但都可以是单通道的。\n\n将上述静态表示成：\n\n![](https://picture.mulindya.com/conv3d-4.png)\n\n### 多通道\n\n![](https://picture.mulindya.com/conv3d-5.png)\n\n然后将filter1、filter2、filter3堆叠在一起形成一个4维卷积核$ D \\times H \\times W \\times 3$，同理将各通道堆叠在一起就形成了多通道的3D卷积输入图像。\n\n针对多通道,比如c个通道，输入大小为$(c, depth, height, width)$，与2D多通道卷积的操作类似，对于每次滑窗，卷积核同时与c个channels上的 $(k_d, k_h, k_w)$ 窗口内的所有values进行相关操作，得到输出3D图像中的一个value。\n由于3D卷积中的卷积核是3D的，因此在每个channel下使用的是同样的参数，权重共享。不同于2D多通道下的卷积核，后者在每一个channel使用的权重是一样的，不同的通道权重可能不一样。\n\n#### 代码\n\n\n```python\ntorch.nn.Conv3d(in_channels, out_channels, kernel_size, stride=1, padding=0, dilation=1, groups=1, bias=True, padding_mode='zeros', device=None, dtype=None)\n```\n\n- **in_channels** ([*int*](https://docs.python.org/3/library/functions.html#int)) – Number of channels in the input image\n- **out_channels** ([*int*](https://docs.python.org/3/library/functions.html#int)) – Number of channels produced by the convolution\n- **kernel_size** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)) – Size of the convolving kernel\n- **stride** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)*,* *optional*) – Stride of the convolution. Default: 1\n- **padding** ([*int*](https://docs.python.org/3/library/functions.html#int)*,* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple) *or* [*str*](https://docs.python.org/3/library/stdtypes.html#str)*,* *optional*) – Padding added to all six sides of the input. Default: 0\n- **padding_mode** (*string**,* *optional*) – `'zeros'`, `'reflect'`, `'replicate'` or `'circular'`. Default: `'zeros'`\n- **dilation** ([*int*](https://docs.python.org/3/library/functions.html#int) *or* [*tuple*](https://docs.python.org/3/library/stdtypes.html#tuple)*,* *optional*) – Spacing between kernel elements. Default: 1\n- **groups** ([*int*](https://docs.python.org/3/library/functions.html#int)*,* *optional*) – Number of blocked connections from input channels to output channels. Default: 1\n- **bias** ([*bool*](https://docs.python.org/3/library/functions.html#bool)*,* *optional*) – If `True`, adds a learnable bias to the output. Default: `True`\n\n<font color=red>**和2D卷积函数基本上是一样的，只是维度和内部的工作机制不太一样。**</font>\n\nApplies a 3D convolution over an input signal composed of several input planes.\n\nIn the simplest case, the output value of the layer with input size$ (N, C_{in}, D, H, W)$  and output $(N, C_{out}, D_{out}, H_{out}, W_{out})$ can be precisely described as:\n\n{% raw %}\n$$\nout(N_i, C_{out_j}) = bias(C_{out_j}) + \\sum_{k = 0}^{C_{in} - 1} weight(C_{out_j}, k) \\star input(N_i, k)\n$$\n{% endraw %}\n\nwhere ⋆ is the valid 3D [cross-correlation](https://en.wikipedia.org/wiki/Cross-correlation) operator\n\nThis module supports [TensorFloat32](https://pytorch.org/docs/stable/notes/cuda.html#tf32-on-ampere).\n\n- `stride` controls the stride for the cross-correlation.\n\n- `padding` controls the amount of padding applied to the input. It can be either a string {‘valid’, ‘same’} or a tuple of ints giving the amount of implicit padding applied on both sides.\n\n- `dilation` controls the spacing between the kernel points; also known as the à trous algorithm. It is harder to describe, but this [link](https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md) has a nice visualization of what `dilation` does.\n\n- `groups` controls the connections between inputs and outputs. `in_channels` and `out_channels` must both be divisible by `groups`. For example,\n\n  > - At groups=1, all inputs are convolved to all outputs.\n  > - At groups=2, the operation becomes equivalent to having two conv layers side by side, each seeing half the input channels and producing half the output channels, and both subsequently concatenated.\n  > - At groups= `in_channels`, each input channel is convolved with its own set of filters (of size $\\frac{\\text{out\\_channels}}{\\text{in\\_channels}}$).\n\nThe parameters `kernel_size`, `stride`, `padding`, `dilation` can either be:\n\n> - a single `int` – in which case the same value is used for the depth, height and width dimension\n> - a `tuple` of three ints – in which case, the first int is used for the depth dimension, the second int for the height dimension and the third int for the width dimension\n\n![](https://picture.mulindya.com/conv3d-8.png)\n","slug":"deep_learning/conv3d","published":1,"updated":"2022-01-18T08:10:17.047Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p06n000mast97b69h4c3","content":"<blockquote>\n<p>在帕金森数据中涉及三维数据的训练和预测，用到了conv3但是对其背后的原理还有一些模糊的地方，conv2d与多通道的conv2d的区别在哪里？conv3d的思想理论是什么？对此进行探究和记录… 😳</p>\n</blockquote>\n<blockquote>\n<p>首先要明确多通道的2d卷积和3d卷积是不一样的，3d是可以在通道中移动的，2d达咩！</p>\n</blockquote>\n<h2 id=\"卷积核的维度\">卷积核的维度</h2>\n<p>卷积核的维度指的的进行滑窗操作的维度，而滑窗操作不在channel维度上进行，不管有几个channel，它们都共享同一个滑窗位置（虽然2D多channel卷积的时候每个channel上的卷积核权重是独立的，但滑窗位置是共享的）。所以在讨论卷积核维度的时候，是不把channel维加进去的。</p>\n<p><font color=\"purple\"> <strong>2D conv的卷积核就是$(c, k_h, k_w)$，因此，对于RGB图像做2D卷积，卷积核可以是conv2D(3,3) 而不该是conv3D(3,3,3)；</strong></font></p>\n<p><font color=\"green\"> <strong>3D conv的卷积核就是$(c, k_d, k_h, k_w)$，其中k_d就是多出来的第三维，根据具体应用，在视频中就是时间维，在CT图像中就是层数维.</strong>  </font></p>\n<h2 id=\"2D卷积\">2D卷积</h2>\n<h3 id=\"单通道\">单通道</h3>\n<p>首先了解什么是卷积核，卷积核(filter)是由一组参数构成的张量，卷积核相当于权值，图像相当于输入量，卷积的操作就是根据卷积核对这些输入量进行加权求和。我们通常用卷积来提取图像的特征。</p>\n<p>直观理解如下：下图使用的是 3x3卷积核(height x width,简写$ H \\times W$) 的卷积，padding为1(周围的虚线部分，卷积时为了使卷积后的图像大小与原来一致，会对原图像进行填充)，两个维度上的strides均为1(滑动步长，这里体现为每次滑动几个小方格)。</p>\n<p><img src=\"https://picture.mulindya.com/2dconv.gif\" alt=\"\"></p>\n<p>针对单通道，输入图像的channel为1，即输入大小为$(1, height, weight)$，卷积核尺寸为 $(1, k_h, k_w)$，卷积核在输入图像上的的空间维度（即(height, width)两维）上进行进行滑窗操作，每次滑窗和 $(k_h, k_w)$ 窗口内的values进行卷积操作（现在都用相关操作取代），得到输出图像中的一个value。</p>\n<p>上图是通道数为1的2维图像的卷积操作，静态表示为：</p>\n<p><img src=\"https://picture.mulindya.com/conv3d-1.png\" alt=\"\"></p>\n<h3 id=\"多通道\">多通道</h3>\n<p>了解了单通道图像的卷积之后，再来看多通道图像的卷积，我们知道灰度图像只有一个通道，而 RGB 图像有R、G、B三个通道。<br>\n多通道图像的一次卷积要对所有通道上同一位置的元素做加权和，因此卷积核的shape变成了 $H \\times W \\times channels$，没有错卷积核变成了3维，但这不是3维卷积，因为我们区分几维卷积看的是卷积核可以在几个维度上的滑动，卷积核是不能在 channels上滑动的，因为上面提到每次卷积都要关联所有通道上同一位置上的元素。<br>\n3通道的卷积表示如下：是对每个通道进行2d卷积操作然后把最后的值相加的到右侧的小方块。</p>\n<p><img src=\"https://picture.mulindya.com/conv3d-2.png\" alt=\"\"></p>\n<p>上图将3个通道分开表示，卷积核也分开表示，filter1、filter2、filter3均为二维卷积核，堆叠在一起便形成了$ H \\times W \\times 3$的卷积核，同样的我们将3个通道也堆叠在一起;</p>\n<p>针对多通道，假定输入图像的channel为c，即输入大小为$(c, height, weight)$，卷积核尺寸为 $(c, k_h, k_w)$， 卷积核在输入图像的空间维度即$(height, width)$两维上进行滑窗操作（在channel这一维度没有滑动只有相加），每次滑窗与c个channels上的$ (k_h, k_w)$ 窗口内的所有的values进行相关操作，得到输出图像中的一个value（多通道的信息被完全压缩了)</p>\n<p>于是形成了下面的3维表示图：<br>\n<img src=\"https://picture.mulindya.com/conv3d-3.png\" alt=\"\"></p>\n<p>虽然是一个卷积核，但是每个filter的权重值是不一样的哦~</p>\n<p>如下如所示：在卷积核的每个通道上的权重是不一定相同的，<code>这里的6=4+0+1+偏移1</code></p>\n<p><img src=\"https://picture.mulindya.com/conv3d-6.png\" alt=\"\"></p>\n<h3 id=\"代码\">代码</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">torch.nn.Conv2d(in_channels, out_channels, kernel_size, stride=<span class=\"hljs-number\">1</span>, padding=<span class=\"hljs-number\">0</span>, dilation=<span class=\"hljs-number\">1</span>, groups=<span class=\"hljs-number\">1</span>, bias=<span class=\"hljs-literal\">True</span>, padding_mode=<span class=\"hljs-string\">'zeros'</span>, device=<span class=\"hljs-literal\">None</span>, dtype=<span class=\"hljs-literal\">None</span>)<br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li><strong>in_channels</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a>) – Number of channels in the input image</li>\n<li><strong>out_channels</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a>) – Number of channels produced by the convolution</li>\n<li><strong>kernel_size</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a>) – Size of the convolving kernel</li>\n<li><strong>stride</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a><em>,</em> <em>optional</em>) – Stride of the convolution. Default: 1</li>\n<li><strong>padding</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a><em>,</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#str\"><em>str</em></a><em>,</em> <em>optional</em>) – Padding added to all four sides of the input. Default: 0</li>\n<li><strong>padding_mode</strong> (<em>string</em>*,* <em>optional</em>) – <code>'zeros'</code>, <code>'reflect'</code>, <code>'replicate'</code> or <code>'circular'</code>. Default: <code>'zeros'</code></li>\n<li><strong>dilation</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a><em>,</em> <em>optional</em>) – Spacing between kernel elements. Default: 1</li>\n<li><strong>groups</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a><em>,</em> <em>optional</em>) – Number of blocked connections from input channels to output channels. Default: 1</li>\n<li><strong>bias</strong> (<a href=\"https://docs.python.org/3/library/functions.html#bool\"><em>bool</em></a><em>,</em> <em>optional</em>) – If <code>True</code>, adds a learnable bias to the output. Default: <code>True</code></li>\n</ul>\n<p>Applies a 2D convolution over an input signal composed of several input planes.</p>\n<p>In the simplest case, the output value of the layer with input size $(N, C_{\\text{in}}, H, W)$and output $(N, C_{\\text{out}}, H_{\\text{out}}, W_{\\text{out}})$ can be precisely described as:</p>\n\n$$\n\\text{out}(N_i, C_{\\text{out}_j}) = \\text{bias}(C_{\\text{out}_j}) + \\sum_{k = 0}^{C_{\\text{in}} - 1} \\text{weight}(C_{\\text{out}_j}, k) \\star \\text{input}(N_i, k)\n$$\n\n<p>where ⋆ is the valid 2D <a href=\"https://en.wikipedia.org/wiki/Cross-correlation\">cross-correlation</a> operator, N<em>N</em> is a batch size, C<em>C</em> denotes a number of channels, H<em>H</em> is a height of input planes in pixels, and W<em>W</em> is width in pixels.</p>\n<p>This module supports <a href=\"https://pytorch.org/docs/stable/notes/cuda.html#tf32-on-ampere\">TensorFloat32</a>.</p>\n<ul>\n<li>\n<p><code>stride</code> controls the stride for the cross-correlation, a single number or a tuple.</p>\n</li>\n<li>\n<p><code>padding</code> controls the amount of padding applied to the input. It can be either a string {‘valid’, ‘same’} or a tuple of ints giving the amount of implicit padding applied on both sides.</p>\n</li>\n<li>\n<p><code>dilation</code> controls the spacing between the kernel points; also known as the à trous algorithm. It is harder to describe, but this <a href=\"https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md\">link</a> has a nice visualization of what <code>dilation</code> does.</p>\n</li>\n<li>\n<p><code>groups</code> controls the connections between inputs and outputs. <code>in_channels</code> and <code>out_channels</code> must both be divisible by <code>groups</code>. For example,</p>\n<blockquote>\n<ul>\n<li>At groups=1, all inputs are convolved to all outputs.</li>\n<li>At groups=2, the operation becomes equivalent to having two conv layers side by side, each seeing half the input channels and producing half the output channels, and both subsequently concatenated.</li>\n<li>At groups= <code>in_channels</code>, each input channel is convolved with its own set of filters (of size $\\frac{\\text{out_channels}}{\\text{in_channels}}$ ).</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<p>The parameters <code>kernel_size</code>, <code>stride</code>, <code>padding</code>, <code>dilation</code> can either be:</p>\n<blockquote>\n<ul>\n<li>a single <code>int</code> – in which case the same value is used for the height and width dimension</li>\n<li>a <code>tuple</code> of two ints – in which case, the first int is used for the height dimension, and the second int for the width dimension</li>\n</ul>\n</blockquote>\n<h4 id=\"example\">example</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># With square kernels and equal stride</span><br>m = nn.Conv2d(<span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">33</span>, <span class=\"hljs-number\">3</span>, stride=<span class=\"hljs-number\">2</span>)<br><span class=\"hljs-comment\"># non-square kernels and unequal stride and with padding</span><br>m = nn.Conv2d(<span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">33</span>, (<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">5</span>), stride=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">1</span>), padding=(<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">2</span>))<br><span class=\"hljs-comment\"># non-square kernels and unequal stride and with padding and dilation</span><br>m = nn.Conv2d(<span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">33</span>, (<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">5</span>), stride=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">1</span>), padding=(<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">2</span>), dilation=(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>))<br><span class=\"hljs-built_in\">input</span> = torch.randn(<span class=\"hljs-number\">20</span>, <span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">50</span>, <span class=\"hljs-number\">100</span>)<br>output = m(<span class=\"hljs-built_in\">input</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"2d卷积操作后变化\">2d卷积操作后变化</h4>\n<p><img src=\"https://picture.mulindya.com/conv3d-7.png\" alt=\"\"></p>\n<h2 id=\"3D卷积\">3D卷积</h2>\n<h3 id=\"单通道-2\">单通道</h3>\n<p>用类似的方法我们先分析单通道图像的3D卷积，3D卷积的对象是三维图像，因此卷积核变成了$depth \\times height \\times width $简写为$D \\times H \\times W $。单通道的<code>3D卷积</code>动态图如下：<br>\n<img src=\"https://picture.mulindya.com/conv3d.gif\" alt=\"\"></p>\n<p>针对单通道，与2D卷积不同之处在于，<strong>输入图像多了一个 depth 维度</strong>，故输入大小为$(1, depth, height, width)$，卷积核也多了一个$k_d$维度，因此卷积核在输入3D图像的空间维度$(depth,height,width)$上均进行滑窗操作，每次滑窗与$ (k_d, k_h, k_w) $窗口内的values进行相关操作，得到输出3D图像中的一个value，最终输出一个3D的特征图。</p>\n<p>这里的3D不是通道导致的，而是深度（多层切片，多帧视频），因此，虽然输入和卷积核和输出都是3D的，但都可以是单通道的。</p>\n<p>将上述静态表示成：</p>\n<p><img src=\"https://picture.mulindya.com/conv3d-4.png\" alt=\"\"></p>\n<h3 id=\"多通道-2\">多通道</h3>\n<p><img src=\"https://picture.mulindya.com/conv3d-5.png\" alt=\"\"></p>\n<p>然后将filter1、filter2、filter3堆叠在一起形成一个4维卷积核$ D \\times H \\times W \\times 3$，同理将各通道堆叠在一起就形成了多通道的3D卷积输入图像。</p>\n<p>针对多通道,比如c个通道，输入大小为$(c, depth, height, width)$，与2D多通道卷积的操作类似，对于每次滑窗，卷积核同时与c个channels上的 $(k_d, k_h, k_w)$ 窗口内的所有values进行相关操作，得到输出3D图像中的一个value。<br>\n由于3D卷积中的卷积核是3D的，因此在每个channel下使用的是同样的参数，权重共享。不同于2D多通道下的卷积核，后者在每一个channel使用的权重是一样的，不同的通道权重可能不一样。</p>\n<h4 id=\"代码-2\">代码</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">torch.nn.Conv3d(in_channels, out_channels, kernel_size, stride=<span class=\"hljs-number\">1</span>, padding=<span class=\"hljs-number\">0</span>, dilation=<span class=\"hljs-number\">1</span>, groups=<span class=\"hljs-number\">1</span>, bias=<span class=\"hljs-literal\">True</span>, padding_mode=<span class=\"hljs-string\">'zeros'</span>, device=<span class=\"hljs-literal\">None</span>, dtype=<span class=\"hljs-literal\">None</span>)<br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li><strong>in_channels</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a>) – Number of channels in the input image</li>\n<li><strong>out_channels</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a>) – Number of channels produced by the convolution</li>\n<li><strong>kernel_size</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a>) – Size of the convolving kernel</li>\n<li><strong>stride</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a><em>,</em> <em>optional</em>) – Stride of the convolution. Default: 1</li>\n<li><strong>padding</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a><em>,</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#str\"><em>str</em></a><em>,</em> <em>optional</em>) – Padding added to all six sides of the input. Default: 0</li>\n<li><strong>padding_mode</strong> (<em>string</em>*,* <em>optional</em>) – <code>'zeros'</code>, <code>'reflect'</code>, <code>'replicate'</code> or <code>'circular'</code>. Default: <code>'zeros'</code></li>\n<li><strong>dilation</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a><em>,</em> <em>optional</em>) – Spacing between kernel elements. Default: 1</li>\n<li><strong>groups</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a><em>,</em> <em>optional</em>) – Number of blocked connections from input channels to output channels. Default: 1</li>\n<li><strong>bias</strong> (<a href=\"https://docs.python.org/3/library/functions.html#bool\"><em>bool</em></a><em>,</em> <em>optional</em>) – If <code>True</code>, adds a learnable bias to the output. Default: <code>True</code></li>\n</ul>\n<p><font color=\"red\"><strong>和2D卷积函数基本上是一样的，只是维度和内部的工作机制不太一样。</strong></font></p>\n<p>Applies a 3D convolution over an input signal composed of several input planes.</p>\n<p>In the simplest case, the output value of the layer with input size$ (N, C_{in}, D, H, W)$  and output $(N, C_{out}, D_{out}, H_{out}, W_{out})$ can be precisely described as:</p>\n\n$$\nout(N_i, C_{out_j}) = bias(C_{out_j}) + \\sum_{k = 0}^{C_{in} - 1} weight(C_{out_j}, k) \\star input(N_i, k)\n$$\n\n<p>where ⋆ is the valid 3D <a href=\"https://en.wikipedia.org/wiki/Cross-correlation\">cross-correlation</a> operator</p>\n<p>This module supports <a href=\"https://pytorch.org/docs/stable/notes/cuda.html#tf32-on-ampere\">TensorFloat32</a>.</p>\n<ul>\n<li>\n<p><code>stride</code> controls the stride for the cross-correlation.</p>\n</li>\n<li>\n<p><code>padding</code> controls the amount of padding applied to the input. It can be either a string {‘valid’, ‘same’} or a tuple of ints giving the amount of implicit padding applied on both sides.</p>\n</li>\n<li>\n<p><code>dilation</code> controls the spacing between the kernel points; also known as the à trous algorithm. It is harder to describe, but this <a href=\"https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md\">link</a> has a nice visualization of what <code>dilation</code> does.</p>\n</li>\n<li>\n<p><code>groups</code> controls the connections between inputs and outputs. <code>in_channels</code> and <code>out_channels</code> must both be divisible by <code>groups</code>. For example,</p>\n<blockquote>\n<ul>\n<li>At groups=1, all inputs are convolved to all outputs.</li>\n<li>At groups=2, the operation becomes equivalent to having two conv layers side by side, each seeing half the input channels and producing half the output channels, and both subsequently concatenated.</li>\n<li>At groups= <code>in_channels</code>, each input channel is convolved with its own set of filters (of size $\\frac{\\text{out_channels}}{\\text{in_channels}}$).</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<p>The parameters <code>kernel_size</code>, <code>stride</code>, <code>padding</code>, <code>dilation</code> can either be:</p>\n<blockquote>\n<ul>\n<li>a single <code>int</code> – in which case the same value is used for the depth, height and width dimension</li>\n<li>a <code>tuple</code> of three ints – in which case, the first int is used for the depth dimension, the second int for the height dimension and the third int for the width dimension</li>\n</ul>\n</blockquote>\n<p><img src=\"https://picture.mulindya.com/conv3d-8.png\" alt=\"\"></p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>在帕金森数据中涉及三维数据的训练和预测，用到了conv3但是对其背后的原理还有一些模糊的地方，conv2d与多通道的conv2d的区别在哪里？conv3d的思想理论是什么？对此进行探究和记录… 😳</p>\n</blockquote>\n<blockquote>\n<p>首先要明确多通道的2d卷积和3d卷积是不一样的，3d是可以在通道中移动的，2d达咩！</p>\n</blockquote>\n<h2 id=\"卷积核的维度\">卷积核的维度</h2>\n<p>卷积核的维度指的的进行滑窗操作的维度，而滑窗操作不在channel维度上进行，不管有几个channel，它们都共享同一个滑窗位置（虽然2D多channel卷积的时候每个channel上的卷积核权重是独立的，但滑窗位置是共享的）。所以在讨论卷积核维度的时候，是不把channel维加进去的。</p>\n<p><font color=purple> <strong>2D conv的卷积核就是$(c, k_h, k_w)$，因此，对于RGB图像做2D卷积，卷积核可以是conv2D(3,3) 而不该是conv3D(3,3,3)；</strong></font></p>\n<p><font color=green> <strong>3D conv的卷积核就是$(c, k_d, k_h, k_w)$，其中k_d就是多出来的第三维，根据具体应用，在视频中就是时间维，在CT图像中就是层数维.</strong>  </font></p>\n<h2 id=\"2D卷积\">2D卷积</h2>\n<h3 id=\"单通道\">单通道</h3>\n<p>首先了解什么是卷积核，卷积核(filter)是由一组参数构成的张量，卷积核相当于权值，图像相当于输入量，卷积的操作就是根据卷积核对这些输入量进行加权求和。我们通常用卷积来提取图像的特征。</p>\n<p>直观理解如下：下图使用的是 3x3卷积核(height x width,简写$ H \\times W$) 的卷积，padding为1(周围的虚线部分，卷积时为了使卷积后的图像大小与原来一致，会对原图像进行填充)，两个维度上的strides均为1(滑动步长，这里体现为每次滑动几个小方格)。</p>\n<p><img src=\"https://picture.mulindya.com/2dconv.gif\" alt=\"\"></p>\n<p>针对单通道，输入图像的channel为1，即输入大小为$(1, height, weight)$，卷积核尺寸为 $(1, k_h, k_w)$，卷积核在输入图像上的的空间维度（即(height, width)两维）上进行进行滑窗操作，每次滑窗和 $(k_h, k_w)$ 窗口内的values进行卷积操作（现在都用相关操作取代），得到输出图像中的一个value。</p>\n<p>上图是通道数为1的2维图像的卷积操作，静态表示为：</p>\n<p><img src=\"https://picture.mulindya.com/conv3d-1.png\" alt=\"\"></p>\n<h3 id=\"多通道\">多通道</h3>\n<p>了解了单通道图像的卷积之后，再来看多通道图像的卷积，我们知道灰度图像只有一个通道，而 RGB 图像有R、G、B三个通道。<br>\n多通道图像的一次卷积要对所有通道上同一位置的元素做加权和，因此卷积核的shape变成了 $H \\times W \\times channels$，没有错卷积核变成了3维，但这不是3维卷积，因为我们区分几维卷积看的是卷积核可以在几个维度上的滑动，卷积核是不能在 channels上滑动的，因为上面提到每次卷积都要关联所有通道上同一位置上的元素。<br>\n3通道的卷积表示如下：是对每个通道进行2d卷积操作然后把最后的值相加的到右侧的小方块。</p>\n<p><img src=\"https://picture.mulindya.com/conv3d-2.png\" alt=\"\"></p>\n<p>上图将3个通道分开表示，卷积核也分开表示，filter1、filter2、filter3均为二维卷积核，堆叠在一起便形成了$ H \\times W \\times 3$的卷积核，同样的我们将3个通道也堆叠在一起;</p>\n<p>针对多通道，假定输入图像的channel为c，即输入大小为$(c, height, weight)$，卷积核尺寸为 $(c, k_h, k_w)$， 卷积核在输入图像的空间维度即$(height, width)$两维上进行滑窗操作（在channel这一维度没有滑动只有相加），每次滑窗与c个channels上的$ (k_h, k_w)$ 窗口内的所有的values进行相关操作，得到输出图像中的一个value（多通道的信息被完全压缩了)</p>\n<p>于是形成了下面的3维表示图：<br>\n<img src=\"https://picture.mulindya.com/conv3d-3.png\" alt=\"\"></p>\n<p>虽然是一个卷积核，但是每个filter的权重值是不一样的哦~</p>\n<p>如下如所示：在卷积核的每个通道上的权重是不一定相同的，<code>这里的6=4+0+1+偏移1</code></p>\n<p><img src=\"https://picture.mulindya.com/conv3d-6.png\" alt=\"\"></p>\n<h3 id=\"代码\">代码</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">torch.nn.Conv2d(in_channels, out_channels, kernel_size, stride=<span class=\"hljs-number\">1</span>, padding=<span class=\"hljs-number\">0</span>, dilation=<span class=\"hljs-number\">1</span>, groups=<span class=\"hljs-number\">1</span>, bias=<span class=\"hljs-literal\">True</span>, padding_mode=<span class=\"hljs-string\">&#x27;zeros&#x27;</span>, device=<span class=\"hljs-literal\">None</span>, dtype=<span class=\"hljs-literal\">None</span>)<br></code></pre></td></tr></table></figure>\n<ul>\n<li><strong>in_channels</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a>) – Number of channels in the input image</li>\n<li><strong>out_channels</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a>) – Number of channels produced by the convolution</li>\n<li><strong>kernel_size</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a>) – Size of the convolving kernel</li>\n<li><strong>stride</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a><em>,</em> <em>optional</em>) – Stride of the convolution. Default: 1</li>\n<li><strong>padding</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a><em>,</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#str\"><em>str</em></a><em>,</em> <em>optional</em>) – Padding added to all four sides of the input. Default: 0</li>\n<li><strong>padding_mode</strong> (<em>string</em>*,* <em>optional</em>) – <code>'zeros'</code>, <code>'reflect'</code>, <code>'replicate'</code> or <code>'circular'</code>. Default: <code>'zeros'</code></li>\n<li><strong>dilation</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a><em>,</em> <em>optional</em>) – Spacing between kernel elements. Default: 1</li>\n<li><strong>groups</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a><em>,</em> <em>optional</em>) – Number of blocked connections from input channels to output channels. Default: 1</li>\n<li><strong>bias</strong> (<a href=\"https://docs.python.org/3/library/functions.html#bool\"><em>bool</em></a><em>,</em> <em>optional</em>) – If <code>True</code>, adds a learnable bias to the output. Default: <code>True</code></li>\n</ul>\n<p>Applies a 2D convolution over an input signal composed of several input planes.</p>\n<p>In the simplest case, the output value of the layer with input size $(N, C_{\\text{in}}, H, W)$and output $(N, C_{\\text{out}}, H_{\\text{out}}, W_{\\text{out}})$ can be precisely described as:</p>\n\n$$\n\\text{out}(N_i, C_{\\text{out}_j}) = \\text{bias}(C_{\\text{out}_j}) + \\sum_{k = 0}^{C_{\\text{in}} - 1} \\text{weight}(C_{\\text{out}_j}, k) \\star \\text{input}(N_i, k)\n$$\n\n<p>where ⋆ is the valid 2D <a href=\"https://en.wikipedia.org/wiki/Cross-correlation\">cross-correlation</a> operator, N<em>N</em> is a batch size, C<em>C</em> denotes a number of channels, H<em>H</em> is a height of input planes in pixels, and W<em>W</em> is width in pixels.</p>\n<p>This module supports <a href=\"https://pytorch.org/docs/stable/notes/cuda.html#tf32-on-ampere\">TensorFloat32</a>.</p>\n<ul>\n<li>\n<p><code>stride</code> controls the stride for the cross-correlation, a single number or a tuple.</p>\n</li>\n<li>\n<p><code>padding</code> controls the amount of padding applied to the input. It can be either a string {‘valid’, ‘same’} or a tuple of ints giving the amount of implicit padding applied on both sides.</p>\n</li>\n<li>\n<p><code>dilation</code> controls the spacing between the kernel points; also known as the à trous algorithm. It is harder to describe, but this <a href=\"https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md\">link</a> has a nice visualization of what <code>dilation</code> does.</p>\n</li>\n<li>\n<p><code>groups</code> controls the connections between inputs and outputs. <code>in_channels</code> and <code>out_channels</code> must both be divisible by <code>groups</code>. For example,</p>\n<blockquote>\n<ul>\n<li>At groups=1, all inputs are convolved to all outputs.</li>\n<li>At groups=2, the operation becomes equivalent to having two conv layers side by side, each seeing half the input channels and producing half the output channels, and both subsequently concatenated.</li>\n<li>At groups= <code>in_channels</code>, each input channel is convolved with its own set of filters (of size $\\frac{\\text{out_channels}}{\\text{in_channels}}$ ).</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<p>The parameters <code>kernel_size</code>, <code>stride</code>, <code>padding</code>, <code>dilation</code> can either be:</p>\n<blockquote>\n<ul>\n<li>a single <code>int</code> – in which case the same value is used for the height and width dimension</li>\n<li>a <code>tuple</code> of two ints – in which case, the first int is used for the height dimension, and the second int for the width dimension</li>\n</ul>\n</blockquote>\n<h4 id=\"example\">example</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># With square kernels and equal stride</span><br>m = nn.Conv2d(<span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">33</span>, <span class=\"hljs-number\">3</span>, stride=<span class=\"hljs-number\">2</span>)<br><span class=\"hljs-comment\"># non-square kernels and unequal stride and with padding</span><br>m = nn.Conv2d(<span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">33</span>, (<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">5</span>), stride=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">1</span>), padding=(<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">2</span>))<br><span class=\"hljs-comment\"># non-square kernels and unequal stride and with padding and dilation</span><br>m = nn.Conv2d(<span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">33</span>, (<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">5</span>), stride=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">1</span>), padding=(<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">2</span>), dilation=(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>))<br><span class=\"hljs-built_in\">input</span> = torch.randn(<span class=\"hljs-number\">20</span>, <span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">50</span>, <span class=\"hljs-number\">100</span>)<br>output = m(<span class=\"hljs-built_in\">input</span>)<br></code></pre></td></tr></table></figure>\n<h4 id=\"2d卷积操作后变化\">2d卷积操作后变化</h4>\n<p><img src=\"https://picture.mulindya.com/conv3d-7.png\" alt=\"\"></p>\n<h2 id=\"3D卷积\">3D卷积</h2>\n<h3 id=\"单通道-2\">单通道</h3>\n<p>用类似的方法我们先分析单通道图像的3D卷积，3D卷积的对象是三维图像，因此卷积核变成了$depth \\times height \\times width $简写为$D \\times H \\times W $。单通道的<code>3D卷积</code>动态图如下：<br>\n<img src=\"https://picture.mulindya.com/conv3d.gif\" alt=\"\"></p>\n<p>针对单通道，与2D卷积不同之处在于，<strong>输入图像多了一个 depth 维度</strong>，故输入大小为$(1, depth, height, width)$，卷积核也多了一个$k_d$维度，因此卷积核在输入3D图像的空间维度$(depth,height,width)$上均进行滑窗操作，每次滑窗与$ (k_d, k_h, k_w) $窗口内的values进行相关操作，得到输出3D图像中的一个value，最终输出一个3D的特征图。</p>\n<p>这里的3D不是通道导致的，而是深度（多层切片，多帧视频），因此，虽然输入和卷积核和输出都是3D的，但都可以是单通道的。</p>\n<p>将上述静态表示成：</p>\n<p><img src=\"https://picture.mulindya.com/conv3d-4.png\" alt=\"\"></p>\n<h3 id=\"多通道-2\">多通道</h3>\n<p><img src=\"https://picture.mulindya.com/conv3d-5.png\" alt=\"\"></p>\n<p>然后将filter1、filter2、filter3堆叠在一起形成一个4维卷积核$ D \\times H \\times W \\times 3$，同理将各通道堆叠在一起就形成了多通道的3D卷积输入图像。</p>\n<p>针对多通道,比如c个通道，输入大小为$(c, depth, height, width)$，与2D多通道卷积的操作类似，对于每次滑窗，卷积核同时与c个channels上的 $(k_d, k_h, k_w)$ 窗口内的所有values进行相关操作，得到输出3D图像中的一个value。<br>\n由于3D卷积中的卷积核是3D的，因此在每个channel下使用的是同样的参数，权重共享。不同于2D多通道下的卷积核，后者在每一个channel使用的权重是一样的，不同的通道权重可能不一样。</p>\n<h4 id=\"代码-2\">代码</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">torch.nn.Conv3d(in_channels, out_channels, kernel_size, stride=<span class=\"hljs-number\">1</span>, padding=<span class=\"hljs-number\">0</span>, dilation=<span class=\"hljs-number\">1</span>, groups=<span class=\"hljs-number\">1</span>, bias=<span class=\"hljs-literal\">True</span>, padding_mode=<span class=\"hljs-string\">&#x27;zeros&#x27;</span>, device=<span class=\"hljs-literal\">None</span>, dtype=<span class=\"hljs-literal\">None</span>)<br></code></pre></td></tr></table></figure>\n<ul>\n<li><strong>in_channels</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a>) – Number of channels in the input image</li>\n<li><strong>out_channels</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a>) – Number of channels produced by the convolution</li>\n<li><strong>kernel_size</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a>) – Size of the convolving kernel</li>\n<li><strong>stride</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a><em>,</em> <em>optional</em>) – Stride of the convolution. Default: 1</li>\n<li><strong>padding</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a><em>,</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#str\"><em>str</em></a><em>,</em> <em>optional</em>) – Padding added to all six sides of the input. Default: 0</li>\n<li><strong>padding_mode</strong> (<em>string</em>*,* <em>optional</em>) – <code>'zeros'</code>, <code>'reflect'</code>, <code>'replicate'</code> or <code>'circular'</code>. Default: <code>'zeros'</code></li>\n<li><strong>dilation</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a> <em>or</em> <a href=\"https://docs.python.org/3/library/stdtypes.html#tuple\"><em>tuple</em></a><em>,</em> <em>optional</em>) – Spacing between kernel elements. Default: 1</li>\n<li><strong>groups</strong> (<a href=\"https://docs.python.org/3/library/functions.html#int\"><em>int</em></a><em>,</em> <em>optional</em>) – Number of blocked connections from input channels to output channels. Default: 1</li>\n<li><strong>bias</strong> (<a href=\"https://docs.python.org/3/library/functions.html#bool\"><em>bool</em></a><em>,</em> <em>optional</em>) – If <code>True</code>, adds a learnable bias to the output. Default: <code>True</code></li>\n</ul>\n<p><font color=red><strong>和2D卷积函数基本上是一样的，只是维度和内部的工作机制不太一样。</strong></font></p>\n<p>Applies a 3D convolution over an input signal composed of several input planes.</p>\n<p>In the simplest case, the output value of the layer with input size$ (N, C_{in}, D, H, W)$  and output $(N, C_{out}, D_{out}, H_{out}, W_{out})$ can be precisely described as:</p>\n\n$$\nout(N_i, C_{out_j}) = bias(C_{out_j}) + \\sum_{k = 0}^{C_{in} - 1} weight(C_{out_j}, k) \\star input(N_i, k)\n$$\n\n<p>where ⋆ is the valid 3D <a href=\"https://en.wikipedia.org/wiki/Cross-correlation\">cross-correlation</a> operator</p>\n<p>This module supports <a href=\"https://pytorch.org/docs/stable/notes/cuda.html#tf32-on-ampere\">TensorFloat32</a>.</p>\n<ul>\n<li>\n<p><code>stride</code> controls the stride for the cross-correlation.</p>\n</li>\n<li>\n<p><code>padding</code> controls the amount of padding applied to the input. It can be either a string {‘valid’, ‘same’} or a tuple of ints giving the amount of implicit padding applied on both sides.</p>\n</li>\n<li>\n<p><code>dilation</code> controls the spacing between the kernel points; also known as the à trous algorithm. It is harder to describe, but this <a href=\"https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md\">link</a> has a nice visualization of what <code>dilation</code> does.</p>\n</li>\n<li>\n<p><code>groups</code> controls the connections between inputs and outputs. <code>in_channels</code> and <code>out_channels</code> must both be divisible by <code>groups</code>. For example,</p>\n<blockquote>\n<ul>\n<li>At groups=1, all inputs are convolved to all outputs.</li>\n<li>At groups=2, the operation becomes equivalent to having two conv layers side by side, each seeing half the input channels and producing half the output channels, and both subsequently concatenated.</li>\n<li>At groups= <code>in_channels</code>, each input channel is convolved with its own set of filters (of size $\\frac{\\text{out_channels}}{\\text{in_channels}}$).</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<p>The parameters <code>kernel_size</code>, <code>stride</code>, <code>padding</code>, <code>dilation</code> can either be:</p>\n<blockquote>\n<ul>\n<li>a single <code>int</code> – in which case the same value is used for the depth, height and width dimension</li>\n<li>a <code>tuple</code> of three ints – in which case, the first int is used for the depth dimension, the second int for the height dimension and the third int for the width dimension</li>\n</ul>\n</blockquote>\n<p><img src=\"https://picture.mulindya.com/conv3d-8.png\" alt=\"\"></p>\n"},{"title":"fine-tuning的方法","date":"2021-08-13T06:28:24.000Z","_content":"\n>收集关于深度学习的调参的相关笔记，主要用于网络训练的微调。\n\n### **训练技巧**\n\n1.要做**梯度归一化**,即算出来的梯度除以minibatch size\n\n2.clip c(梯度裁剪): 限制最大梯度,其实是value = sqrt(w1^2 +w2^2….),如果value超过了阈值,就算一个衰减系数,让value的值等于阈值: 5,10,15\n\n**3.防止过拟合**\n\n​\t一般常用的防止过拟合方法有使用**L1正则项、L2正则项、dropout、提前终止、数据集扩充等**。如果模型在训练集上表现比较好但在测试集上表现欠佳可以选择增大L1或L2正则的惩罚力度（**L2正则经验上首选1.0**，超过10很少见），或**增大dropout的随机失活概率**（经验首选0.5）；或者当随着训练的持续在测试集上不增反降时，使用提前终止训练的方法。当然**最有效的还是增大训练集的规模**，实在难以获得新数据也可以使用数据集增强的方法，比如CV任务可以对数据集进行裁剪、翻转、平移等方法进行数据集增强，这种方法往往都会提高最后模型的测试精度。\n \tdropout对小数据防止过拟合有很好的效果,值一般设为0.5,小数据上dropout+sgd。在大部分实验中，效果提升都非常明显.**建议尝试**。 dropout的位置比较有讲究, 对于RNN,建议放到输入->RNN与RNN->输出的位置.关于RNN如何用dropout,可以参考:[http://arxiv.org/abs/1409.2329](https://link.zhihu.com/?target=http%3A//arxiv.org/abs/1409.2329)(Captain Jack令言:(不仅仅可以防止过拟合, 其实这相当于做人力成本最低的Ensemble, 当然, 训练起来会比没有Dropout的要慢一点, 同时网络参数你最好相应加一点, 对, 这会再慢一点).)\n\n**4.超参** \n\n​\tlearning rate 最重要**，推荐了解 cosine learning rate 和 cyclic learning rate，其次是 **batchsize 和 weight decay**。当你的模型还不错的时候，可以试着做数据增广和改损失函数锦上添花了。(罗浩ZJU令言：随着网络训练的进行，学习率要逐渐降下来；网络性能越好，学习率要越小（即越需要微调而非粗调)；batchsize通常影响没那么大，塞满卡就行，除了特殊的算法需要batch大一点)\n​\tadam,adadelta等,在小数据上,我这里实验的效果不如sgd, sgd收敛速度会慢一些，但是最终收敛后的结果，一般都比较好。**如果使用sgd的话,可以选择从1.0或者0.1的学习率开始,隔一段时间,在验证集上检查一下,如果cost没有下降,就对**学习率减半**. 我看过很多论文都这么搞,我自己实验的结果也很好. 当然,也可以先用ada系列先跑,最后快收敛的时候,更换成sgd继续训练.同样也会有提升.据说adadelta一般在分类问题上效果比较好，adam在生成问题上效果比较好。(Captain Jack令言：sgd adam 这些选择上, 看你个人选择. 一般对网络不是决定性的. 反正我无脑用sgd + momentum. ）\n\n5.**激活函数**\n\t除了gate之类的地方,需要把输出限制成0-1之外,**尽量不要用sigmoid**,可以用tanh或者relu之类的激活函数.1. sigmoid函数在-4到4之外的区间梯度接近0，很容易造成梯度消失问题。2. 输入0均值，sigmoid函数的输出不是0均值的。（hzwer令言:虽然有至少十种激活函数，但在 Relu 外只推荐试一下 Swish。)\n\n6.BN层具有加速训练速度，有效防止梯度消失与梯度爆炸，具有防止过拟合的效果，所以构建网络时最好要加上这个组件。(Captain Jack令言：batch normalization我一直没用, 虽然我知道这个很好, 我不用仅仅是因为我懒. 所以要鼓励使用batch normalization.）\n\n7.如果你的模型包含全连接层（MLP），并且输入和输出大小一样，可以考虑将MLP替换成**Highway Network**,我尝试对结果有一点提升，建议作为最后提升模型的手段，原理很简单，就是给**输出加了一个gate来控制信息的流动**，详细介绍请参考论文: [http://arxiv.org/abs/1505.00387](https://link.zhihu.com/?target=http%3A//arxiv.org/abs/1505.00387)\n\n8.来自@张馨宇的技巧：**一轮加正则，一轮不加正则，反复进行。**\n\n**9.Ensemble**\nEnsemble是论文刷结果的终极核武器,深度学习中一般有以下几种方式\n同样的参数,不同的初始化方式\n不同的参数,通过cross-validation,选取最好的几组\n同样的参数,模型训练的不同阶段，即不同迭代次数的模型。\n不同的模型,进行线性融合. 例如RNN和传统模型.\n\n**10.自动调参方法**\n（1）Grid Search：其原理就像是在数组里找最大值。缺点是太费时间了，特别像神经网络，一般尝试不了太多的参数组合。\n（2）Random Search：经验上，Random Search比Gird Search更有效。实际操作的时候，一般也是先用Gird Search的方法，得到所有候选参数，然后每次从中随机选择进行训练。另外Random Search往往会和由粗到细的调参策略结合使用，即在效果比较好的参数附近进行更加精细的搜索。\n（3）Bayesian Optimization：贝叶斯优化，考虑到了不同参数对应的 实验结果值，因此更节省时间，贝叶斯调参比Grid Search迭代次数少， 速度快；而且其针对非凸问题依然稳健。\n\n**11.Loss设计**\n\\+ 一般来说分类就是Softmax, 回归就是L2的loss. 但是要注意loss的错误范围(主要是回归), 你预测一个label是10000的值, 模型输出0, 你算算这loss多大, 这还是单变量的情况下. 一般结果都是nan. 所以不仅仅输入要做normalization, 输出也要.\n\\+ 多任务情况下, 各loss想法限制在一个量级上, 或者最终限制在一个量级上, 初期可以着重一个任务的loss。\n\n### **网络结构设计（关于SE)**\n\nSE在分类上是个涨点必备的工具，换言之，堆最高精度是一定要给每个block都加上它的，但是如果需要考虑时间，参数量和精度等的trade-off，无脑堆就没有意义了，这个时候应该要选择在合适的地方使用合适的模块。这个时候，**推荐在block数量和添加SE上做权衡**，即**给部分blcok加上SE，同时砍掉一些block来加速**，这样可以在精度差不多的情况下减少一些参数量。当然inference时间这个事需要看具体的应用平台对SE的实现，就是GAP和FC的速度，这就具体问题具体分析了。**有余力有卡的人，可以迁移某种NAS方法来做这个的搜索。**\n参考自：\n你有哪些deep learning（rnn、cnn）调参的经验？ - 萧瑟的回答 - 知乎 https://www.zhihu.com/question/41631631/answer/94816420\n你有哪些deep learning（rnn、cnn）调参的经验？ - Towser的回答 - 知乎 https://www.zhihu.com/question/41631631/answer/862075836\n你有哪些deep learning（rnn、cnn）调参的经验？ - 罗浩.ZJU的回答 - 知乎 https://www.zhihu.com/question/41631631/answer/216788968\n你有哪些deep learning（rnn、cnn）调参的经验？ - 京东白条的回答 - 知乎 [https://www.zhihu.com/question/4163](https://www.zhihu.com/question/41631631/answer/776852832)\n\n> 所谓SE：SENet是Squeeze-and-Excitation Networks的简称，拿到了ImageNet2017分类比赛冠军，其效果得到了认可，其提出的SE模块思想简单，易于实现，并且很容易可以加载到现有的网络模型框架中。*<u>SENet主要是学习了channel之间的相关性，筛选出了针对通道的注意力</u>*，稍微增加了一点计算量，但是效果比较好。\n\n对于CNN网络来说，其核心计算是卷积算子，其通过卷积核从输入特征图学习到新特征图。从本质上讲，卷积是对一个局部区域进行特征融合，这包括空间上（H和W维度）以及通道间（C维度）的特征融合。\n\n\n![](https://picture.mulindya.com/fine-tuning-pic1.png)\n\n卷积实际上是对<u>局部区域</u>进行的特征融合。 这也导致了普通卷积神经网络的感受野不大，当然你也可以设计出更多的通道特征来增加这个，但是这样做导致了计算量大大的增加。因此为了空间上融合更多特征融合，或者是提取多尺度空间信息。也提出了许多不同的方法如Inception网络的多分支结构。对于channel维度的特征融合，卷积操作基本上默认对输入特征图的所有channel进行融合。<u>而SENet网络的创新点在于关注channel之间的关系，希望模型可以自动学习到不同channel特征的重要程度</u>。为此，SENet提出了Squeeze-and-Excitation (SE)模块，如下图所示：\n\n\n![](https://picture.mulindya.com/fine-tuning-pic2.png)\n\n### 反面训诫\n\n1.1、一上来就自己动手写模型。\n建议首先用**成熟的开源项目及其默认配置**（例如 Gluon 对经典模型的各种复现、各个著名模型作者自己放出来的代码仓库）在自己的数据集上跑一遍，在等程序运行结束的时间里仔细研究一下代码里的各种细节，最后再自己写或者改代码。\n\n1.2、**不推荐做人肉模型设计**，比如把某层卷积改大一点，或者微调一下通道数。除非有特别 insight，不要自己乱设计新组件。\n\n2、训 RNN 不加 gradient clipping，导致训练一段时间以后 loss 突然变成 Nan。\n\n3、tying input & output embedding（就是词向量层和输出 softmax 前的矩阵共享参数，在语言模型或机器翻译中常用）时学习率需要设置得非常小，不然容易 Nan。\n\n4.1、在数据集很大的情况下，一上来就跑全量数据。建议先用 1/100、1/10 的数据跑一跑，对模型性能和训练时间有个底。\n\n4.2认为网络层数越大越好。参数量什么的都不是大问题，在性能不丢的情况下，网络层数减到最小.（Captain Jack令言：你有95%概率不会使用超过40层的模型. ）\n\n5、只喜欢漂亮的模型结构，瞧不起调参数的论文/实验报告，**看论文时经常不看超参数设置等细节**。殊不知在自己没有太多资源实验的情况下，实验报告类文章简直是业界良心！\nNLP 领域主要推荐以下几篇：\nRegularizing and Optimizing LSTM Language Models（LSTM 的训练技巧）\nMassive Exploration of Neural Machine Translation Architectures（NMT 里各个超参的影响）\nTraining Tips for the Transformer Model（训练 Transformer 时会发生的各种现象）\nRoBERTa: A Robustly Optimized BERT Pretraining Approach（BERT 预训练技巧，虽然跟大部分人没啥关系）\nCV 我不算太熟，不过也可以勉强推荐几篇：\n\n[Training ImageNet in 1 Hour（大批量训练技巧）](https://arxiv.org/pdf/1706.02677.pdf)\n[Bag of Tricks for Image Classification with Convolutional Neural Networks（各种训练技巧集大成）](https://openaccess.thecvf.com/content_CVPR_2019/papers/He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf)\n[EfficientNet: Rethinking Model Scaling for Convolutional Neural Networks（当前对参数利用最有效的 CNN）](https://arxiv.org/pdf/1905.11946.pdf)\n\n6、对于loss这种受 batch size、sequence length 各种因素影响的数字，人是没有数感的，建议首先计算一下 per token loss（如果是多任务，可以每个任务单独算；类似地，某些 CV 任务可以计算 per pixel loss），心里有点感觉。**脱离损失函数的形式谈学习率没有意义**（例如单是对 batch size 求和或者取平均这个差异就会使梯度差成百上千倍）。\n在确定初始学习率的时候，从一个很小的值（例如 1e-7）开始，然后**每一步指数增大学习率（例如扩大1.05 倍）进行训练。**训练几百步应该能观察到损失函数随训练步数呈对勾形，选择损失下降最快那一段的学习率即可。\n(Captain Jack令言：**观察loss胜于观察准确率**\n准确率虽然是评测指标, 但是训练过程中还是要注意loss的. 你会发现有些情况下, 准确率是突变的, 原来一直是0, 可能保持上千迭代, 然后突然变1. 要是因为这个你提前中断训练了, 只有老天替你惋惜了. 而loss是不会有这么诡异的情况发生的, 毕竟优化目标是loss.\n给NN一点时间, 要根据任务留给NN的学习一定空间. 不能说前面一段时间没起色就不管了. 有些情况下就是前面一段时间看不出起色, 然后开始稳定学习.）\n\n7.1、优化器**只推荐** Momentum 和 Adam。在这些方面做尝试意义不大，如果性能提升反倒可能说明模型不成熟。\n\n7.2、**Adam 可以解决一堆奇奇怪怪的问题**（有时 loss 降不下去，换 Adam 瞬间就好了），**也可以带来一堆奇奇怪怪的问题**（比如单词词频差异很大，当前 batch 没有的单词的词向量也被更新；再比如Adam和L2正则结合产生的复杂效果）。用的时候要胆大心细，万一遇到问题找各种魔改 Adam（比如 [MaskedAdam](https://www.zhihu.com/question/265357659/answer/580469438), AdamW 啥的）抢救。\n\n8、subword 总是会很稳定地涨点，只管用就对了。\n\n9、**GPU 上报错时尽量放在 CPU 上重跑**，错误信息更友好。例如 \"ERROR:tensorflow:Model diverged with loss = NaN\" 其实很有可能是输入 ID 超出了 softmax 词表的范围。\n\n**10、别没耐心**！\n**有些指标是有滞后性的，需要等训练一段时间才开始动。**很多人训练几步看没什么效果就把程序停掉开始 debug 了，但其实代码毫无问题。如此反复好几天甚至一两周都在原地踏步，其实需要做的仅仅是让程序自个儿安安静静地跑上几个小时或者一天……\n\n### 相关trick\n\n-  fine-tuning: 通常来说，直接把预训练模型来用效果不一定足够好，因此需要进行fine-tuning（微调）。fine-tuning需要冻结网络的前几层参数，只更新网络结构的后面几层和最后的全连接层，这样效果会更好。\n\n-   Learning rate:在迁移学习的微调过程中一般不建议使用过大的学习率，通常来说1e-5是比较合适的选择。\n\n  #### 迁移学习往往还和你的任务中的数据关系密切，可以考虑以下几种情况。\n\n  - ##### 新的数据集较小，并且和pre-trained model所使用的训练数据集相似度较高\n\n    由于数据集较小，在进行finetune存在overfit的风险，又由于数据集和原始数据集相似度较高，因此二者不论是local feature还是global feature都比较相   近，所以此时最佳的方法是把CNN网络当做特征提取器然后训练一个分类器进行分类  \n\n  - ##### 新的数据集较大，并且和pre-trained model所使用的训练数据集相似度较高：\n\n    很明显，此时我们不用担心overfit，因此对全部网络结构进行fine-tune是较好的。\n\n  - ##### 新的数据集较小，并且和pre-trained model所使用的训练数据集差异很大： \n\n    由于数据集较小，不适合进行fine-tune，由于数据集差异大，应该在单独训练网络结构中较高的层，前面几层local的就不用训练了，直接固定权值。在实际中，这种问题下较好的解决方案一般是从网络的某层开始取出特征，然后训练SVM分类器。 \n\n  - ##### 新的数据集较大，并且和pre-trained model所使用的训练数据集差异很大：  \n\n    本来由于数据集较大，可以从头开始训练的，但是在实际中更偏向于训练整个pre-trained model的网络。\n\n  \n\n  ​    \n","source":"_posts/deep_learning/fine-tuning.md","raw":"---\ntitle: fine-tuning的方法\ntags: [深度学习,微调]\ncategories: [深度学习]\ndate: 2021-08-13 14:28:24\n---\n\n>收集关于深度学习的调参的相关笔记，主要用于网络训练的微调。\n\n### **训练技巧**\n\n1.要做**梯度归一化**,即算出来的梯度除以minibatch size\n\n2.clip c(梯度裁剪): 限制最大梯度,其实是value = sqrt(w1^2 +w2^2….),如果value超过了阈值,就算一个衰减系数,让value的值等于阈值: 5,10,15\n\n**3.防止过拟合**\n\n​\t一般常用的防止过拟合方法有使用**L1正则项、L2正则项、dropout、提前终止、数据集扩充等**。如果模型在训练集上表现比较好但在测试集上表现欠佳可以选择增大L1或L2正则的惩罚力度（**L2正则经验上首选1.0**，超过10很少见），或**增大dropout的随机失活概率**（经验首选0.5）；或者当随着训练的持续在测试集上不增反降时，使用提前终止训练的方法。当然**最有效的还是增大训练集的规模**，实在难以获得新数据也可以使用数据集增强的方法，比如CV任务可以对数据集进行裁剪、翻转、平移等方法进行数据集增强，这种方法往往都会提高最后模型的测试精度。\n \tdropout对小数据防止过拟合有很好的效果,值一般设为0.5,小数据上dropout+sgd。在大部分实验中，效果提升都非常明显.**建议尝试**。 dropout的位置比较有讲究, 对于RNN,建议放到输入->RNN与RNN->输出的位置.关于RNN如何用dropout,可以参考:[http://arxiv.org/abs/1409.2329](https://link.zhihu.com/?target=http%3A//arxiv.org/abs/1409.2329)(Captain Jack令言:(不仅仅可以防止过拟合, 其实这相当于做人力成本最低的Ensemble, 当然, 训练起来会比没有Dropout的要慢一点, 同时网络参数你最好相应加一点, 对, 这会再慢一点).)\n\n**4.超参** \n\n​\tlearning rate 最重要**，推荐了解 cosine learning rate 和 cyclic learning rate，其次是 **batchsize 和 weight decay**。当你的模型还不错的时候，可以试着做数据增广和改损失函数锦上添花了。(罗浩ZJU令言：随着网络训练的进行，学习率要逐渐降下来；网络性能越好，学习率要越小（即越需要微调而非粗调)；batchsize通常影响没那么大，塞满卡就行，除了特殊的算法需要batch大一点)\n​\tadam,adadelta等,在小数据上,我这里实验的效果不如sgd, sgd收敛速度会慢一些，但是最终收敛后的结果，一般都比较好。**如果使用sgd的话,可以选择从1.0或者0.1的学习率开始,隔一段时间,在验证集上检查一下,如果cost没有下降,就对**学习率减半**. 我看过很多论文都这么搞,我自己实验的结果也很好. 当然,也可以先用ada系列先跑,最后快收敛的时候,更换成sgd继续训练.同样也会有提升.据说adadelta一般在分类问题上效果比较好，adam在生成问题上效果比较好。(Captain Jack令言：sgd adam 这些选择上, 看你个人选择. 一般对网络不是决定性的. 反正我无脑用sgd + momentum. ）\n\n5.**激活函数**\n\t除了gate之类的地方,需要把输出限制成0-1之外,**尽量不要用sigmoid**,可以用tanh或者relu之类的激活函数.1. sigmoid函数在-4到4之外的区间梯度接近0，很容易造成梯度消失问题。2. 输入0均值，sigmoid函数的输出不是0均值的。（hzwer令言:虽然有至少十种激活函数，但在 Relu 外只推荐试一下 Swish。)\n\n6.BN层具有加速训练速度，有效防止梯度消失与梯度爆炸，具有防止过拟合的效果，所以构建网络时最好要加上这个组件。(Captain Jack令言：batch normalization我一直没用, 虽然我知道这个很好, 我不用仅仅是因为我懒. 所以要鼓励使用batch normalization.）\n\n7.如果你的模型包含全连接层（MLP），并且输入和输出大小一样，可以考虑将MLP替换成**Highway Network**,我尝试对结果有一点提升，建议作为最后提升模型的手段，原理很简单，就是给**输出加了一个gate来控制信息的流动**，详细介绍请参考论文: [http://arxiv.org/abs/1505.00387](https://link.zhihu.com/?target=http%3A//arxiv.org/abs/1505.00387)\n\n8.来自@张馨宇的技巧：**一轮加正则，一轮不加正则，反复进行。**\n\n**9.Ensemble**\nEnsemble是论文刷结果的终极核武器,深度学习中一般有以下几种方式\n同样的参数,不同的初始化方式\n不同的参数,通过cross-validation,选取最好的几组\n同样的参数,模型训练的不同阶段，即不同迭代次数的模型。\n不同的模型,进行线性融合. 例如RNN和传统模型.\n\n**10.自动调参方法**\n（1）Grid Search：其原理就像是在数组里找最大值。缺点是太费时间了，特别像神经网络，一般尝试不了太多的参数组合。\n（2）Random Search：经验上，Random Search比Gird Search更有效。实际操作的时候，一般也是先用Gird Search的方法，得到所有候选参数，然后每次从中随机选择进行训练。另外Random Search往往会和由粗到细的调参策略结合使用，即在效果比较好的参数附近进行更加精细的搜索。\n（3）Bayesian Optimization：贝叶斯优化，考虑到了不同参数对应的 实验结果值，因此更节省时间，贝叶斯调参比Grid Search迭代次数少， 速度快；而且其针对非凸问题依然稳健。\n\n**11.Loss设计**\n\\+ 一般来说分类就是Softmax, 回归就是L2的loss. 但是要注意loss的错误范围(主要是回归), 你预测一个label是10000的值, 模型输出0, 你算算这loss多大, 这还是单变量的情况下. 一般结果都是nan. 所以不仅仅输入要做normalization, 输出也要.\n\\+ 多任务情况下, 各loss想法限制在一个量级上, 或者最终限制在一个量级上, 初期可以着重一个任务的loss。\n\n### **网络结构设计（关于SE)**\n\nSE在分类上是个涨点必备的工具，换言之，堆最高精度是一定要给每个block都加上它的，但是如果需要考虑时间，参数量和精度等的trade-off，无脑堆就没有意义了，这个时候应该要选择在合适的地方使用合适的模块。这个时候，**推荐在block数量和添加SE上做权衡**，即**给部分blcok加上SE，同时砍掉一些block来加速**，这样可以在精度差不多的情况下减少一些参数量。当然inference时间这个事需要看具体的应用平台对SE的实现，就是GAP和FC的速度，这就具体问题具体分析了。**有余力有卡的人，可以迁移某种NAS方法来做这个的搜索。**\n参考自：\n你有哪些deep learning（rnn、cnn）调参的经验？ - 萧瑟的回答 - 知乎 https://www.zhihu.com/question/41631631/answer/94816420\n你有哪些deep learning（rnn、cnn）调参的经验？ - Towser的回答 - 知乎 https://www.zhihu.com/question/41631631/answer/862075836\n你有哪些deep learning（rnn、cnn）调参的经验？ - 罗浩.ZJU的回答 - 知乎 https://www.zhihu.com/question/41631631/answer/216788968\n你有哪些deep learning（rnn、cnn）调参的经验？ - 京东白条的回答 - 知乎 [https://www.zhihu.com/question/4163](https://www.zhihu.com/question/41631631/answer/776852832)\n\n> 所谓SE：SENet是Squeeze-and-Excitation Networks的简称，拿到了ImageNet2017分类比赛冠军，其效果得到了认可，其提出的SE模块思想简单，易于实现，并且很容易可以加载到现有的网络模型框架中。*<u>SENet主要是学习了channel之间的相关性，筛选出了针对通道的注意力</u>*，稍微增加了一点计算量，但是效果比较好。\n\n对于CNN网络来说，其核心计算是卷积算子，其通过卷积核从输入特征图学习到新特征图。从本质上讲，卷积是对一个局部区域进行特征融合，这包括空间上（H和W维度）以及通道间（C维度）的特征融合。\n\n\n![](https://picture.mulindya.com/fine-tuning-pic1.png)\n\n卷积实际上是对<u>局部区域</u>进行的特征融合。 这也导致了普通卷积神经网络的感受野不大，当然你也可以设计出更多的通道特征来增加这个，但是这样做导致了计算量大大的增加。因此为了空间上融合更多特征融合，或者是提取多尺度空间信息。也提出了许多不同的方法如Inception网络的多分支结构。对于channel维度的特征融合，卷积操作基本上默认对输入特征图的所有channel进行融合。<u>而SENet网络的创新点在于关注channel之间的关系，希望模型可以自动学习到不同channel特征的重要程度</u>。为此，SENet提出了Squeeze-and-Excitation (SE)模块，如下图所示：\n\n\n![](https://picture.mulindya.com/fine-tuning-pic2.png)\n\n### 反面训诫\n\n1.1、一上来就自己动手写模型。\n建议首先用**成熟的开源项目及其默认配置**（例如 Gluon 对经典模型的各种复现、各个著名模型作者自己放出来的代码仓库）在自己的数据集上跑一遍，在等程序运行结束的时间里仔细研究一下代码里的各种细节，最后再自己写或者改代码。\n\n1.2、**不推荐做人肉模型设计**，比如把某层卷积改大一点，或者微调一下通道数。除非有特别 insight，不要自己乱设计新组件。\n\n2、训 RNN 不加 gradient clipping，导致训练一段时间以后 loss 突然变成 Nan。\n\n3、tying input & output embedding（就是词向量层和输出 softmax 前的矩阵共享参数，在语言模型或机器翻译中常用）时学习率需要设置得非常小，不然容易 Nan。\n\n4.1、在数据集很大的情况下，一上来就跑全量数据。建议先用 1/100、1/10 的数据跑一跑，对模型性能和训练时间有个底。\n\n4.2认为网络层数越大越好。参数量什么的都不是大问题，在性能不丢的情况下，网络层数减到最小.（Captain Jack令言：你有95%概率不会使用超过40层的模型. ）\n\n5、只喜欢漂亮的模型结构，瞧不起调参数的论文/实验报告，**看论文时经常不看超参数设置等细节**。殊不知在自己没有太多资源实验的情况下，实验报告类文章简直是业界良心！\nNLP 领域主要推荐以下几篇：\nRegularizing and Optimizing LSTM Language Models（LSTM 的训练技巧）\nMassive Exploration of Neural Machine Translation Architectures（NMT 里各个超参的影响）\nTraining Tips for the Transformer Model（训练 Transformer 时会发生的各种现象）\nRoBERTa: A Robustly Optimized BERT Pretraining Approach（BERT 预训练技巧，虽然跟大部分人没啥关系）\nCV 我不算太熟，不过也可以勉强推荐几篇：\n\n[Training ImageNet in 1 Hour（大批量训练技巧）](https://arxiv.org/pdf/1706.02677.pdf)\n[Bag of Tricks for Image Classification with Convolutional Neural Networks（各种训练技巧集大成）](https://openaccess.thecvf.com/content_CVPR_2019/papers/He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf)\n[EfficientNet: Rethinking Model Scaling for Convolutional Neural Networks（当前对参数利用最有效的 CNN）](https://arxiv.org/pdf/1905.11946.pdf)\n\n6、对于loss这种受 batch size、sequence length 各种因素影响的数字，人是没有数感的，建议首先计算一下 per token loss（如果是多任务，可以每个任务单独算；类似地，某些 CV 任务可以计算 per pixel loss），心里有点感觉。**脱离损失函数的形式谈学习率没有意义**（例如单是对 batch size 求和或者取平均这个差异就会使梯度差成百上千倍）。\n在确定初始学习率的时候，从一个很小的值（例如 1e-7）开始，然后**每一步指数增大学习率（例如扩大1.05 倍）进行训练。**训练几百步应该能观察到损失函数随训练步数呈对勾形，选择损失下降最快那一段的学习率即可。\n(Captain Jack令言：**观察loss胜于观察准确率**\n准确率虽然是评测指标, 但是训练过程中还是要注意loss的. 你会发现有些情况下, 准确率是突变的, 原来一直是0, 可能保持上千迭代, 然后突然变1. 要是因为这个你提前中断训练了, 只有老天替你惋惜了. 而loss是不会有这么诡异的情况发生的, 毕竟优化目标是loss.\n给NN一点时间, 要根据任务留给NN的学习一定空间. 不能说前面一段时间没起色就不管了. 有些情况下就是前面一段时间看不出起色, 然后开始稳定学习.）\n\n7.1、优化器**只推荐** Momentum 和 Adam。在这些方面做尝试意义不大，如果性能提升反倒可能说明模型不成熟。\n\n7.2、**Adam 可以解决一堆奇奇怪怪的问题**（有时 loss 降不下去，换 Adam 瞬间就好了），**也可以带来一堆奇奇怪怪的问题**（比如单词词频差异很大，当前 batch 没有的单词的词向量也被更新；再比如Adam和L2正则结合产生的复杂效果）。用的时候要胆大心细，万一遇到问题找各种魔改 Adam（比如 [MaskedAdam](https://www.zhihu.com/question/265357659/answer/580469438), AdamW 啥的）抢救。\n\n8、subword 总是会很稳定地涨点，只管用就对了。\n\n9、**GPU 上报错时尽量放在 CPU 上重跑**，错误信息更友好。例如 \"ERROR:tensorflow:Model diverged with loss = NaN\" 其实很有可能是输入 ID 超出了 softmax 词表的范围。\n\n**10、别没耐心**！\n**有些指标是有滞后性的，需要等训练一段时间才开始动。**很多人训练几步看没什么效果就把程序停掉开始 debug 了，但其实代码毫无问题。如此反复好几天甚至一两周都在原地踏步，其实需要做的仅仅是让程序自个儿安安静静地跑上几个小时或者一天……\n\n### 相关trick\n\n-  fine-tuning: 通常来说，直接把预训练模型来用效果不一定足够好，因此需要进行fine-tuning（微调）。fine-tuning需要冻结网络的前几层参数，只更新网络结构的后面几层和最后的全连接层，这样效果会更好。\n\n-   Learning rate:在迁移学习的微调过程中一般不建议使用过大的学习率，通常来说1e-5是比较合适的选择。\n\n  #### 迁移学习往往还和你的任务中的数据关系密切，可以考虑以下几种情况。\n\n  - ##### 新的数据集较小，并且和pre-trained model所使用的训练数据集相似度较高\n\n    由于数据集较小，在进行finetune存在overfit的风险，又由于数据集和原始数据集相似度较高，因此二者不论是local feature还是global feature都比较相   近，所以此时最佳的方法是把CNN网络当做特征提取器然后训练一个分类器进行分类  \n\n  - ##### 新的数据集较大，并且和pre-trained model所使用的训练数据集相似度较高：\n\n    很明显，此时我们不用担心overfit，因此对全部网络结构进行fine-tune是较好的。\n\n  - ##### 新的数据集较小，并且和pre-trained model所使用的训练数据集差异很大： \n\n    由于数据集较小，不适合进行fine-tune，由于数据集差异大，应该在单独训练网络结构中较高的层，前面几层local的就不用训练了，直接固定权值。在实际中，这种问题下较好的解决方案一般是从网络的某层开始取出特征，然后训练SVM分类器。 \n\n  - ##### 新的数据集较大，并且和pre-trained model所使用的训练数据集差异很大：  \n\n    本来由于数据集较大，可以从头开始训练的，但是在实际中更偏向于训练整个pre-trained model的网络。\n\n  \n\n  ​    \n","slug":"deep_learning/fine-tuning","published":1,"updated":"2022-01-18T08:10:17.049Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p06u000nast95daobae4","content":"<blockquote>\n<p>收集关于深度学习的调参的相关笔记，主要用于网络训练的微调。</p>\n</blockquote>\n<h3 id=\"训练技巧\"><strong>训练技巧</strong></h3>\n<p>1.要做<strong>梯度归一化</strong>,即算出来的梯度除以minibatch size</p>\n<p>2.clip c(梯度裁剪): 限制最大梯度,其实是value = sqrt(w1^2 +w2^2….),如果value超过了阈值,就算一个衰减系数,让value的值等于阈值: 5,10,15</p>\n<p><strong>3.防止过拟合</strong></p>\n<p>​\t一般常用的防止过拟合方法有使用<strong>L1正则项、L2正则项、dropout、提前终止、数据集扩充等</strong>。如果模型在训练集上表现比较好但在测试集上表现欠佳可以选择增大L1或L2正则的惩罚力度（<strong>L2正则经验上首选1.0</strong>，超过10很少见），或<strong>增大dropout的随机失活概率</strong>（经验首选0.5）；或者当随着训练的持续在测试集上不增反降时，使用提前终止训练的方法。当然<strong>最有效的还是增大训练集的规模</strong>，实在难以获得新数据也可以使用数据集增强的方法，比如CV任务可以对数据集进行裁剪、翻转、平移等方法进行数据集增强，这种方法往往都会提高最后模型的测试精度。<br>\ndropout对小数据防止过拟合有很好的效果,值一般设为0.5,小数据上dropout+sgd。在大部分实验中，效果提升都非常明显.<strong>建议尝试</strong>。 dropout的位置比较有讲究, 对于RNN,建议放到输入-&gt;RNN与RNN-&gt;输出的位置.关于RNN如何用dropout,可以参考:<a href=\"https://link.zhihu.com/?target=http%3A//arxiv.org/abs/1409.2329\">http://arxiv.org/abs/1409.2329</a>(Captain Jack令言:(不仅仅可以防止过拟合, 其实这相当于做人力成本最低的Ensemble, 当然, 训练起来会比没有Dropout的要慢一点, 同时网络参数你最好相应加一点, 对, 这会再慢一点).)</p>\n<p><strong>4.超参</strong></p>\n<p>​\tlearning rate 最重要**，推荐了解 cosine learning rate 和 cyclic learning rate，其次是 <strong>batchsize 和 weight decay</strong>。当你的模型还不错的时候，可以试着做数据增广和改损失函数锦上添花了。(罗浩ZJU令言：随着网络训练的进行，学习率要逐渐降下来；网络性能越好，学习率要越小（即越需要微调而非粗调)；batchsize通常影响没那么大，塞满卡就行，除了特殊的算法需要batch大一点)<br>\n​\tadam,adadelta等,在小数据上,我这里实验的效果不如sgd, sgd收敛速度会慢一些，但是最终收敛后的结果，一般都比较好。<strong>如果使用sgd的话,可以选择从1.0或者0.1的学习率开始,隔一段时间,在验证集上检查一下,如果cost没有下降,就对</strong>学习率减半**. 我看过很多论文都这么搞,我自己实验的结果也很好. 当然,也可以先用ada系列先跑,最后快收敛的时候,更换成sgd继续训练.同样也会有提升.据说adadelta一般在分类问题上效果比较好，adam在生成问题上效果比较好。(Captain Jack令言：sgd adam 这些选择上, 看你个人选择. 一般对网络不是决定性的. 反正我无脑用sgd + momentum. ）</p>\n<p>5.<strong>激活函数</strong><br>\n除了gate之类的地方,需要把输出限制成0-1之外,<strong>尽量不要用sigmoid</strong>,可以用tanh或者relu之类的激活函数.1. sigmoid函数在-4到4之外的区间梯度接近0，很容易造成梯度消失问题。2. 输入0均值，sigmoid函数的输出不是0均值的。（hzwer令言:虽然有至少十种激活函数，但在 Relu 外只推荐试一下 Swish。)</p>\n<p>6.BN层具有加速训练速度，有效防止梯度消失与梯度爆炸，具有防止过拟合的效果，所以构建网络时最好要加上这个组件。(Captain Jack令言：batch normalization我一直没用, 虽然我知道这个很好, 我不用仅仅是因为我懒. 所以要鼓励使用batch normalization.）</p>\n<p>7.如果你的模型包含全连接层（MLP），并且输入和输出大小一样，可以考虑将MLP替换成<strong>Highway Network</strong>,我尝试对结果有一点提升，建议作为最后提升模型的手段，原理很简单，就是给<strong>输出加了一个gate来控制信息的流动</strong>，详细介绍请参考论文: <a href=\"https://link.zhihu.com/?target=http%3A//arxiv.org/abs/1505.00387\">http://arxiv.org/abs/1505.00387</a></p>\n<p>8.来自@张馨宇的技巧：<strong>一轮加正则，一轮不加正则，反复进行。</strong></p>\n<p><strong>9.Ensemble</strong><br>\nEnsemble是论文刷结果的终极核武器,深度学习中一般有以下几种方式<br>\n同样的参数,不同的初始化方式<br>\n不同的参数,通过cross-validation,选取最好的几组<br>\n同样的参数,模型训练的不同阶段，即不同迭代次数的模型。<br>\n不同的模型,进行线性融合. 例如RNN和传统模型.</p>\n<p><strong>10.自动调参方法</strong><br>\n（1）Grid Search：其原理就像是在数组里找最大值。缺点是太费时间了，特别像神经网络，一般尝试不了太多的参数组合。<br>\n（2）Random Search：经验上，Random Search比Gird Search更有效。实际操作的时候，一般也是先用Gird Search的方法，得到所有候选参数，然后每次从中随机选择进行训练。另外Random Search往往会和由粗到细的调参策略结合使用，即在效果比较好的参数附近进行更加精细的搜索。<br>\n（3）Bayesian Optimization：贝叶斯优化，考虑到了不同参数对应的 实验结果值，因此更节省时间，贝叶斯调参比Grid Search迭代次数少， 速度快；而且其针对非凸问题依然稳健。</p>\n<p><strong>11.Loss设计</strong><br>\n+ 一般来说分类就是Softmax, 回归就是L2的loss. 但是要注意loss的错误范围(主要是回归), 你预测一个label是10000的值, 模型输出0, 你算算这loss多大, 这还是单变量的情况下. 一般结果都是nan. 所以不仅仅输入要做normalization, 输出也要.<br>\n+ 多任务情况下, 各loss想法限制在一个量级上, 或者最终限制在一个量级上, 初期可以着重一个任务的loss。</p>\n<h3 id=\"网络结构设计（关于SE\"><strong>网络结构设计（关于SE)</strong></h3>\n<p>SE在分类上是个涨点必备的工具，换言之，堆最高精度是一定要给每个block都加上它的，但是如果需要考虑时间，参数量和精度等的trade-off，无脑堆就没有意义了，这个时候应该要选择在合适的地方使用合适的模块。这个时候，<strong>推荐在block数量和添加SE上做权衡</strong>，即<strong>给部分blcok加上SE，同时砍掉一些block来加速</strong>，这样可以在精度差不多的情况下减少一些参数量。当然inference时间这个事需要看具体的应用平台对SE的实现，就是GAP和FC的速度，这就具体问题具体分析了。<strong>有余力有卡的人，可以迁移某种NAS方法来做这个的搜索。</strong><br>\n参考自：<br>\n你有哪些deep learning（rnn、cnn）调参的经验？ - 萧瑟的回答 - 知乎 <a href=\"https://www.zhihu.com/question/41631631/answer/94816420\">https://www.zhihu.com/question/41631631/answer/94816420</a><br>\n你有哪些deep learning（rnn、cnn）调参的经验？ - Towser的回答 - 知乎 <a href=\"https://www.zhihu.com/question/41631631/answer/862075836\">https://www.zhihu.com/question/41631631/answer/862075836</a><br>\n你有哪些deep learning（rnn、cnn）调参的经验？ - 罗浩.ZJU的回答 - 知乎 <a href=\"https://www.zhihu.com/question/41631631/answer/216788968\">https://www.zhihu.com/question/41631631/answer/216788968</a><br>\n你有哪些deep learning（rnn、cnn）调参的经验？ - 京东白条的回答 - 知乎 <a href=\"https://www.zhihu.com/question/41631631/answer/776852832\">https://www.zhihu.com/question/4163</a></p>\n<blockquote>\n<p>所谓SE：SENet是Squeeze-and-Excitation Networks的简称，拿到了ImageNet2017分类比赛冠军，其效果得到了认可，其提出的SE模块思想简单，易于实现，并且很容易可以加载到现有的网络模型框架中。<em><u>SENet主要是学习了channel之间的相关性，筛选出了针对通道的注意力</u></em>，稍微增加了一点计算量，但是效果比较好。</p>\n</blockquote>\n<p>对于CNN网络来说，其核心计算是卷积算子，其通过卷积核从输入特征图学习到新特征图。从本质上讲，卷积是对一个局部区域进行特征融合，这包括空间上（H和W维度）以及通道间（C维度）的特征融合。</p>\n<p><img src=\"https://picture.mulindya.com/fine-tuning-pic1.png\" alt=\"\"></p>\n<p>卷积实际上是对<u>局部区域</u>进行的特征融合。 这也导致了普通卷积神经网络的感受野不大，当然你也可以设计出更多的通道特征来增加这个，但是这样做导致了计算量大大的增加。因此为了空间上融合更多特征融合，或者是提取多尺度空间信息。也提出了许多不同的方法如Inception网络的多分支结构。对于channel维度的特征融合，卷积操作基本上默认对输入特征图的所有channel进行融合。<u>而SENet网络的创新点在于关注channel之间的关系，希望模型可以自动学习到不同channel特征的重要程度</u>。为此，SENet提出了Squeeze-and-Excitation (SE)模块，如下图所示：</p>\n<p><img src=\"https://picture.mulindya.com/fine-tuning-pic2.png\" alt=\"\"></p>\n<h3 id=\"反面训诫\">反面训诫</h3>\n<p>1.1、一上来就自己动手写模型。<br>\n建议首先用<strong>成熟的开源项目及其默认配置</strong>（例如 Gluon 对经典模型的各种复现、各个著名模型作者自己放出来的代码仓库）在自己的数据集上跑一遍，在等程序运行结束的时间里仔细研究一下代码里的各种细节，最后再自己写或者改代码。</p>\n<p>1.2、<strong>不推荐做人肉模型设计</strong>，比如把某层卷积改大一点，或者微调一下通道数。除非有特别 insight，不要自己乱设计新组件。</p>\n<p>2、训 RNN 不加 gradient clipping，导致训练一段时间以后 loss 突然变成 Nan。</p>\n<p>3、tying input &amp; output embedding（就是词向量层和输出 softmax 前的矩阵共享参数，在语言模型或机器翻译中常用）时学习率需要设置得非常小，不然容易 Nan。</p>\n<p>4.1、在数据集很大的情况下，一上来就跑全量数据。建议先用 1/100、1/10 的数据跑一跑，对模型性能和训练时间有个底。</p>\n<p>4.2认为网络层数越大越好。参数量什么的都不是大问题，在性能不丢的情况下，网络层数减到最小.（Captain Jack令言：你有95%概率不会使用超过40层的模型. ）</p>\n<p>5、只喜欢漂亮的模型结构，瞧不起调参数的论文/实验报告，<strong>看论文时经常不看超参数设置等细节</strong>。殊不知在自己没有太多资源实验的情况下，实验报告类文章简直是业界良心！<br>\nNLP 领域主要推荐以下几篇：<br>\nRegularizing and Optimizing LSTM Language Models（LSTM 的训练技巧）<br>\nMassive Exploration of Neural Machine Translation Architectures（NMT 里各个超参的影响）<br>\nTraining Tips for the Transformer Model（训练 Transformer 时会发生的各种现象）<br>\nRoBERTa: A Robustly Optimized BERT Pretraining Approach（BERT 预训练技巧，虽然跟大部分人没啥关系）<br>\nCV 我不算太熟，不过也可以勉强推荐几篇：</p>\n<p><a href=\"https://arxiv.org/pdf/1706.02677.pdf\">Training ImageNet in 1 Hour（大批量训练技巧）</a><br>\n<a href=\"https://openaccess.thecvf.com/content_CVPR_2019/papers/He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf\">Bag of Tricks for Image Classification with Convolutional Neural Networks（各种训练技巧集大成）</a><br>\n<a href=\"https://arxiv.org/pdf/1905.11946.pdf\">EfficientNet: Rethinking Model Scaling for Convolutional Neural Networks（当前对参数利用最有效的 CNN）</a></p>\n<p>6、对于loss这种受 batch size、sequence length 各种因素影响的数字，人是没有数感的，建议首先计算一下 per token loss（如果是多任务，可以每个任务单独算；类似地，某些 CV 任务可以计算 per pixel loss），心里有点感觉。<strong>脱离损失函数的形式谈学习率没有意义</strong>（例如单是对 batch size 求和或者取平均这个差异就会使梯度差成百上千倍）。<br>\n在确定初始学习率的时候，从一个很小的值（例如 1e-7）开始，然后**每一步指数增大学习率（例如扩大1.05 倍）进行训练。**训练几百步应该能观察到损失函数随训练步数呈对勾形，选择损失下降最快那一段的学习率即可。<br>\n(Captain Jack令言：<strong>观察loss胜于观察准确率</strong><br>\n准确率虽然是评测指标, 但是训练过程中还是要注意loss的. 你会发现有些情况下, 准确率是突变的, 原来一直是0, 可能保持上千迭代, 然后突然变1. 要是因为这个你提前中断训练了, 只有老天替你惋惜了. 而loss是不会有这么诡异的情况发生的, 毕竟优化目标是loss.<br>\n给NN一点时间, 要根据任务留给NN的学习一定空间. 不能说前面一段时间没起色就不管了. 有些情况下就是前面一段时间看不出起色, 然后开始稳定学习.）</p>\n<p>7.1、优化器<strong>只推荐</strong> Momentum 和 Adam。在这些方面做尝试意义不大，如果性能提升反倒可能说明模型不成熟。</p>\n<p>7.2、<strong>Adam 可以解决一堆奇奇怪怪的问题</strong>（有时 loss 降不下去，换 Adam 瞬间就好了），<strong>也可以带来一堆奇奇怪怪的问题</strong>（比如单词词频差异很大，当前 batch 没有的单词的词向量也被更新；再比如Adam和L2正则结合产生的复杂效果）。用的时候要胆大心细，万一遇到问题找各种魔改 Adam（比如 <a href=\"https://www.zhihu.com/question/265357659/answer/580469438\">MaskedAdam</a>, AdamW 啥的）抢救。</p>\n<p>8、subword 总是会很稳定地涨点，只管用就对了。</p>\n<p>9、<strong>GPU 上报错时尽量放在 CPU 上重跑</strong>，错误信息更友好。例如 “ERROR:tensorflow:Model diverged with loss = NaN” 其实很有可能是输入 ID 超出了 softmax 词表的范围。</p>\n<p><strong>10、别没耐心</strong>！<br>\n**有些指标是有滞后性的，需要等训练一段时间才开始动。**很多人训练几步看没什么效果就把程序停掉开始 debug 了，但其实代码毫无问题。如此反复好几天甚至一两周都在原地踏步，其实需要做的仅仅是让程序自个儿安安静静地跑上几个小时或者一天……</p>\n<h3 id=\"相关trick\">相关trick</h3>\n<ul>\n<li>\n<p>fine-tuning: 通常来说，直接把预训练模型来用效果不一定足够好，因此需要进行fine-tuning（微调）。fine-tuning需要冻结网络的前几层参数，只更新网络结构的后面几层和最后的全连接层，这样效果会更好。</p>\n</li>\n<li>\n<p>Learning rate:在迁移学习的微调过程中一般不建议使用过大的学习率，通常来说1e-5是比较合适的选择。</p>\n</li>\n</ul>\n<h4 id=\"迁移学习往往还和你的任务中的数据关系密切，可以考虑以下几种情况。\">迁移学习往往还和你的任务中的数据关系密切，可以考虑以下几种情况。</h4>\n<ul>\n<li>\n<h5 id=\"新的数据集较小，并且和pre-trained-model所使用的训练数据集相似度较高\">新的数据集较小，并且和pre-trained model所使用的训练数据集相似度较高</h5>\n<p>由于数据集较小，在进行finetune存在overfit的风险，又由于数据集和原始数据集相似度较高，因此二者不论是local feature还是global feature都比较相   近，所以此时最佳的方法是把CNN网络当做特征提取器然后训练一个分类器进行分类</p>\n</li>\n<li>\n<h5 id=\"新的数据集较大，并且和pre-trained-model所使用的训练数据集相似度较高：\">新的数据集较大，并且和pre-trained model所使用的训练数据集相似度较高：</h5>\n<p>很明显，此时我们不用担心overfit，因此对全部网络结构进行fine-tune是较好的。</p>\n</li>\n<li>\n<h5 id=\"新的数据集较小，并且和pre-trained-model所使用的训练数据集差异很大：\">新的数据集较小，并且和pre-trained model所使用的训练数据集差异很大：</h5>\n<p>由于数据集较小，不适合进行fine-tune，由于数据集差异大，应该在单独训练网络结构中较高的层，前面几层local的就不用训练了，直接固定权值。在实际中，这种问题下较好的解决方案一般是从网络的某层开始取出特征，然后训练SVM分类器。</p>\n</li>\n<li>\n<h5 id=\"新的数据集较大，并且和pre-trained-model所使用的训练数据集差异很大：\">新的数据集较大，并且和pre-trained model所使用的训练数据集差异很大：</h5>\n<p>本来由于数据集较大，可以从头开始训练的，但是在实际中更偏向于训练整个pre-trained model的网络。</p>\n</li>\n</ul>\n<p>​</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>收集关于深度学习的调参的相关笔记，主要用于网络训练的微调。</p>\n</blockquote>\n<h3 id=\"训练技巧\"><strong>训练技巧</strong></h3>\n<p>1.要做<strong>梯度归一化</strong>,即算出来的梯度除以minibatch size</p>\n<p>2.clip c(梯度裁剪): 限制最大梯度,其实是value = sqrt(w1^2 +w2^2….),如果value超过了阈值,就算一个衰减系数,让value的值等于阈值: 5,10,15</p>\n<p><strong>3.防止过拟合</strong></p>\n<p>​\t一般常用的防止过拟合方法有使用<strong>L1正则项、L2正则项、dropout、提前终止、数据集扩充等</strong>。如果模型在训练集上表现比较好但在测试集上表现欠佳可以选择增大L1或L2正则的惩罚力度（<strong>L2正则经验上首选1.0</strong>，超过10很少见），或<strong>增大dropout的随机失活概率</strong>（经验首选0.5）；或者当随着训练的持续在测试集上不增反降时，使用提前终止训练的方法。当然<strong>最有效的还是增大训练集的规模</strong>，实在难以获得新数据也可以使用数据集增强的方法，比如CV任务可以对数据集进行裁剪、翻转、平移等方法进行数据集增强，这种方法往往都会提高最后模型的测试精度。<br>\ndropout对小数据防止过拟合有很好的效果,值一般设为0.5,小数据上dropout+sgd。在大部分实验中，效果提升都非常明显.<strong>建议尝试</strong>。 dropout的位置比较有讲究, 对于RNN,建议放到输入-&gt;RNN与RNN-&gt;输出的位置.关于RNN如何用dropout,可以参考:<a href=\"https://link.zhihu.com/?target=http%3A//arxiv.org/abs/1409.2329\">http://arxiv.org/abs/1409.2329</a>(Captain Jack令言:(不仅仅可以防止过拟合, 其实这相当于做人力成本最低的Ensemble, 当然, 训练起来会比没有Dropout的要慢一点, 同时网络参数你最好相应加一点, 对, 这会再慢一点).)</p>\n<p><strong>4.超参</strong></p>\n<p>​\tlearning rate 最重要**，推荐了解 cosine learning rate 和 cyclic learning rate，其次是 <strong>batchsize 和 weight decay</strong>。当你的模型还不错的时候，可以试着做数据增广和改损失函数锦上添花了。(罗浩ZJU令言：随着网络训练的进行，学习率要逐渐降下来；网络性能越好，学习率要越小（即越需要微调而非粗调)；batchsize通常影响没那么大，塞满卡就行，除了特殊的算法需要batch大一点)<br>\n​\tadam,adadelta等,在小数据上,我这里实验的效果不如sgd, sgd收敛速度会慢一些，但是最终收敛后的结果，一般都比较好。<strong>如果使用sgd的话,可以选择从1.0或者0.1的学习率开始,隔一段时间,在验证集上检查一下,如果cost没有下降,就对</strong>学习率减半**. 我看过很多论文都这么搞,我自己实验的结果也很好. 当然,也可以先用ada系列先跑,最后快收敛的时候,更换成sgd继续训练.同样也会有提升.据说adadelta一般在分类问题上效果比较好，adam在生成问题上效果比较好。(Captain Jack令言：sgd adam 这些选择上, 看你个人选择. 一般对网络不是决定性的. 反正我无脑用sgd + momentum. ）</p>\n<p>5.<strong>激活函数</strong><br>\n除了gate之类的地方,需要把输出限制成0-1之外,<strong>尽量不要用sigmoid</strong>,可以用tanh或者relu之类的激活函数.1. sigmoid函数在-4到4之外的区间梯度接近0，很容易造成梯度消失问题。2. 输入0均值，sigmoid函数的输出不是0均值的。（hzwer令言:虽然有至少十种激活函数，但在 Relu 外只推荐试一下 Swish。)</p>\n<p>6.BN层具有加速训练速度，有效防止梯度消失与梯度爆炸，具有防止过拟合的效果，所以构建网络时最好要加上这个组件。(Captain Jack令言：batch normalization我一直没用, 虽然我知道这个很好, 我不用仅仅是因为我懒. 所以要鼓励使用batch normalization.）</p>\n<p>7.如果你的模型包含全连接层（MLP），并且输入和输出大小一样，可以考虑将MLP替换成<strong>Highway Network</strong>,我尝试对结果有一点提升，建议作为最后提升模型的手段，原理很简单，就是给<strong>输出加了一个gate来控制信息的流动</strong>，详细介绍请参考论文: <a href=\"https://link.zhihu.com/?target=http%3A//arxiv.org/abs/1505.00387\">http://arxiv.org/abs/1505.00387</a></p>\n<p>8.来自@张馨宇的技巧：<strong>一轮加正则，一轮不加正则，反复进行。</strong></p>\n<p><strong>9.Ensemble</strong><br>\nEnsemble是论文刷结果的终极核武器,深度学习中一般有以下几种方式<br>\n同样的参数,不同的初始化方式<br>\n不同的参数,通过cross-validation,选取最好的几组<br>\n同样的参数,模型训练的不同阶段，即不同迭代次数的模型。<br>\n不同的模型,进行线性融合. 例如RNN和传统模型.</p>\n<p><strong>10.自动调参方法</strong><br>\n（1）Grid Search：其原理就像是在数组里找最大值。缺点是太费时间了，特别像神经网络，一般尝试不了太多的参数组合。<br>\n（2）Random Search：经验上，Random Search比Gird Search更有效。实际操作的时候，一般也是先用Gird Search的方法，得到所有候选参数，然后每次从中随机选择进行训练。另外Random Search往往会和由粗到细的调参策略结合使用，即在效果比较好的参数附近进行更加精细的搜索。<br>\n（3）Bayesian Optimization：贝叶斯优化，考虑到了不同参数对应的 实验结果值，因此更节省时间，贝叶斯调参比Grid Search迭代次数少， 速度快；而且其针对非凸问题依然稳健。</p>\n<p><strong>11.Loss设计</strong><br>\n+ 一般来说分类就是Softmax, 回归就是L2的loss. 但是要注意loss的错误范围(主要是回归), 你预测一个label是10000的值, 模型输出0, 你算算这loss多大, 这还是单变量的情况下. 一般结果都是nan. 所以不仅仅输入要做normalization, 输出也要.<br>\n+ 多任务情况下, 各loss想法限制在一个量级上, 或者最终限制在一个量级上, 初期可以着重一个任务的loss。</p>\n<h3 id=\"网络结构设计（关于SE\"><strong>网络结构设计（关于SE)</strong></h3>\n<p>SE在分类上是个涨点必备的工具，换言之，堆最高精度是一定要给每个block都加上它的，但是如果需要考虑时间，参数量和精度等的trade-off，无脑堆就没有意义了，这个时候应该要选择在合适的地方使用合适的模块。这个时候，<strong>推荐在block数量和添加SE上做权衡</strong>，即<strong>给部分blcok加上SE，同时砍掉一些block来加速</strong>，这样可以在精度差不多的情况下减少一些参数量。当然inference时间这个事需要看具体的应用平台对SE的实现，就是GAP和FC的速度，这就具体问题具体分析了。<strong>有余力有卡的人，可以迁移某种NAS方法来做这个的搜索。</strong><br>\n参考自：<br>\n你有哪些deep learning（rnn、cnn）调参的经验？ - 萧瑟的回答 - 知乎 <a href=\"https://www.zhihu.com/question/41631631/answer/94816420\">https://www.zhihu.com/question/41631631/answer/94816420</a><br>\n你有哪些deep learning（rnn、cnn）调参的经验？ - Towser的回答 - 知乎 <a href=\"https://www.zhihu.com/question/41631631/answer/862075836\">https://www.zhihu.com/question/41631631/answer/862075836</a><br>\n你有哪些deep learning（rnn、cnn）调参的经验？ - 罗浩.ZJU的回答 - 知乎 <a href=\"https://www.zhihu.com/question/41631631/answer/216788968\">https://www.zhihu.com/question/41631631/answer/216788968</a><br>\n你有哪些deep learning（rnn、cnn）调参的经验？ - 京东白条的回答 - 知乎 <a href=\"https://www.zhihu.com/question/41631631/answer/776852832\">https://www.zhihu.com/question/4163</a></p>\n<blockquote>\n<p>所谓SE：SENet是Squeeze-and-Excitation Networks的简称，拿到了ImageNet2017分类比赛冠军，其效果得到了认可，其提出的SE模块思想简单，易于实现，并且很容易可以加载到现有的网络模型框架中。<em><u>SENet主要是学习了channel之间的相关性，筛选出了针对通道的注意力</u></em>，稍微增加了一点计算量，但是效果比较好。</p>\n</blockquote>\n<p>对于CNN网络来说，其核心计算是卷积算子，其通过卷积核从输入特征图学习到新特征图。从本质上讲，卷积是对一个局部区域进行特征融合，这包括空间上（H和W维度）以及通道间（C维度）的特征融合。</p>\n<p><img src=\"https://picture.mulindya.com/fine-tuning-pic1.png\" alt=\"\"></p>\n<p>卷积实际上是对<u>局部区域</u>进行的特征融合。 这也导致了普通卷积神经网络的感受野不大，当然你也可以设计出更多的通道特征来增加这个，但是这样做导致了计算量大大的增加。因此为了空间上融合更多特征融合，或者是提取多尺度空间信息。也提出了许多不同的方法如Inception网络的多分支结构。对于channel维度的特征融合，卷积操作基本上默认对输入特征图的所有channel进行融合。<u>而SENet网络的创新点在于关注channel之间的关系，希望模型可以自动学习到不同channel特征的重要程度</u>。为此，SENet提出了Squeeze-and-Excitation (SE)模块，如下图所示：</p>\n<p><img src=\"https://picture.mulindya.com/fine-tuning-pic2.png\" alt=\"\"></p>\n<h3 id=\"反面训诫\">反面训诫</h3>\n<p>1.1、一上来就自己动手写模型。<br>\n建议首先用<strong>成熟的开源项目及其默认配置</strong>（例如 Gluon 对经典模型的各种复现、各个著名模型作者自己放出来的代码仓库）在自己的数据集上跑一遍，在等程序运行结束的时间里仔细研究一下代码里的各种细节，最后再自己写或者改代码。</p>\n<p>1.2、<strong>不推荐做人肉模型设计</strong>，比如把某层卷积改大一点，或者微调一下通道数。除非有特别 insight，不要自己乱设计新组件。</p>\n<p>2、训 RNN 不加 gradient clipping，导致训练一段时间以后 loss 突然变成 Nan。</p>\n<p>3、tying input &amp; output embedding（就是词向量层和输出 softmax 前的矩阵共享参数，在语言模型或机器翻译中常用）时学习率需要设置得非常小，不然容易 Nan。</p>\n<p>4.1、在数据集很大的情况下，一上来就跑全量数据。建议先用 1/100、1/10 的数据跑一跑，对模型性能和训练时间有个底。</p>\n<p>4.2认为网络层数越大越好。参数量什么的都不是大问题，在性能不丢的情况下，网络层数减到最小.（Captain Jack令言：你有95%概率不会使用超过40层的模型. ）</p>\n<p>5、只喜欢漂亮的模型结构，瞧不起调参数的论文/实验报告，<strong>看论文时经常不看超参数设置等细节</strong>。殊不知在自己没有太多资源实验的情况下，实验报告类文章简直是业界良心！<br>\nNLP 领域主要推荐以下几篇：<br>\nRegularizing and Optimizing LSTM Language Models（LSTM 的训练技巧）<br>\nMassive Exploration of Neural Machine Translation Architectures（NMT 里各个超参的影响）<br>\nTraining Tips for the Transformer Model（训练 Transformer 时会发生的各种现象）<br>\nRoBERTa: A Robustly Optimized BERT Pretraining Approach（BERT 预训练技巧，虽然跟大部分人没啥关系）<br>\nCV 我不算太熟，不过也可以勉强推荐几篇：</p>\n<p><a href=\"https://arxiv.org/pdf/1706.02677.pdf\">Training ImageNet in 1 Hour（大批量训练技巧）</a><br>\n<a href=\"https://openaccess.thecvf.com/content_CVPR_2019/papers/He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf\">Bag of Tricks for Image Classification with Convolutional Neural Networks（各种训练技巧集大成）</a><br>\n<a href=\"https://arxiv.org/pdf/1905.11946.pdf\">EfficientNet: Rethinking Model Scaling for Convolutional Neural Networks（当前对参数利用最有效的 CNN）</a></p>\n<p>6、对于loss这种受 batch size、sequence length 各种因素影响的数字，人是没有数感的，建议首先计算一下 per token loss（如果是多任务，可以每个任务单独算；类似地，某些 CV 任务可以计算 per pixel loss），心里有点感觉。<strong>脱离损失函数的形式谈学习率没有意义</strong>（例如单是对 batch size 求和或者取平均这个差异就会使梯度差成百上千倍）。<br>\n在确定初始学习率的时候，从一个很小的值（例如 1e-7）开始，然后**每一步指数增大学习率（例如扩大1.05 倍）进行训练。**训练几百步应该能观察到损失函数随训练步数呈对勾形，选择损失下降最快那一段的学习率即可。<br>\n(Captain Jack令言：<strong>观察loss胜于观察准确率</strong><br>\n准确率虽然是评测指标, 但是训练过程中还是要注意loss的. 你会发现有些情况下, 准确率是突变的, 原来一直是0, 可能保持上千迭代, 然后突然变1. 要是因为这个你提前中断训练了, 只有老天替你惋惜了. 而loss是不会有这么诡异的情况发生的, 毕竟优化目标是loss.<br>\n给NN一点时间, 要根据任务留给NN的学习一定空间. 不能说前面一段时间没起色就不管了. 有些情况下就是前面一段时间看不出起色, 然后开始稳定学习.）</p>\n<p>7.1、优化器<strong>只推荐</strong> Momentum 和 Adam。在这些方面做尝试意义不大，如果性能提升反倒可能说明模型不成熟。</p>\n<p>7.2、<strong>Adam 可以解决一堆奇奇怪怪的问题</strong>（有时 loss 降不下去，换 Adam 瞬间就好了），<strong>也可以带来一堆奇奇怪怪的问题</strong>（比如单词词频差异很大，当前 batch 没有的单词的词向量也被更新；再比如Adam和L2正则结合产生的复杂效果）。用的时候要胆大心细，万一遇到问题找各种魔改 Adam（比如 <a href=\"https://www.zhihu.com/question/265357659/answer/580469438\">MaskedAdam</a>, AdamW 啥的）抢救。</p>\n<p>8、subword 总是会很稳定地涨点，只管用就对了。</p>\n<p>9、<strong>GPU 上报错时尽量放在 CPU 上重跑</strong>，错误信息更友好。例如 “ERROR:tensorflow:Model diverged with loss = NaN” 其实很有可能是输入 ID 超出了 softmax 词表的范围。</p>\n<p><strong>10、别没耐心</strong>！<br>\n**有些指标是有滞后性的，需要等训练一段时间才开始动。**很多人训练几步看没什么效果就把程序停掉开始 debug 了，但其实代码毫无问题。如此反复好几天甚至一两周都在原地踏步，其实需要做的仅仅是让程序自个儿安安静静地跑上几个小时或者一天……</p>\n<h3 id=\"相关trick\">相关trick</h3>\n<ul>\n<li>\n<p>fine-tuning: 通常来说，直接把预训练模型来用效果不一定足够好，因此需要进行fine-tuning（微调）。fine-tuning需要冻结网络的前几层参数，只更新网络结构的后面几层和最后的全连接层，这样效果会更好。</p>\n</li>\n<li>\n<p>Learning rate:在迁移学习的微调过程中一般不建议使用过大的学习率，通常来说1e-5是比较合适的选择。</p>\n</li>\n</ul>\n<h4 id=\"迁移学习往往还和你的任务中的数据关系密切，可以考虑以下几种情况。\">迁移学习往往还和你的任务中的数据关系密切，可以考虑以下几种情况。</h4>\n<ul>\n<li>\n<h5 id=\"新的数据集较小，并且和pre-trained-model所使用的训练数据集相似度较高\">新的数据集较小，并且和pre-trained model所使用的训练数据集相似度较高</h5>\n<p>由于数据集较小，在进行finetune存在overfit的风险，又由于数据集和原始数据集相似度较高，因此二者不论是local feature还是global feature都比较相   近，所以此时最佳的方法是把CNN网络当做特征提取器然后训练一个分类器进行分类</p>\n</li>\n<li>\n<h5 id=\"新的数据集较大，并且和pre-trained-model所使用的训练数据集相似度较高：\">新的数据集较大，并且和pre-trained model所使用的训练数据集相似度较高：</h5>\n<p>很明显，此时我们不用担心overfit，因此对全部网络结构进行fine-tune是较好的。</p>\n</li>\n<li>\n<h5 id=\"新的数据集较小，并且和pre-trained-model所使用的训练数据集差异很大：\">新的数据集较小，并且和pre-trained model所使用的训练数据集差异很大：</h5>\n<p>由于数据集较小，不适合进行fine-tune，由于数据集差异大，应该在单独训练网络结构中较高的层，前面几层local的就不用训练了，直接固定权值。在实际中，这种问题下较好的解决方案一般是从网络的某层开始取出特征，然后训练SVM分类器。</p>\n</li>\n<li>\n<h5 id=\"新的数据集较大，并且和pre-trained-model所使用的训练数据集差异很大：\">新的数据集较大，并且和pre-trained model所使用的训练数据集差异很大：</h5>\n<p>本来由于数据集较大，可以从头开始训练的，但是在实际中更偏向于训练整个pre-trained model的网络。</p>\n</li>\n</ul>\n<p>​</p>\n"},{"title":"梯度裁剪","date":"2021-08-12T02:20:29.000Z","math":true,"_content":"\n>阅读代码 optimizer_config = dict(grad_clip=dict(max_norm=35, norm_type=2))，就此探究一下grap_clip。他的作用是梯度裁剪，为了防止梯度爆炸。其中max_norm是最大梯度阈值，norm_type是指定的范数类型。\n\n## 梯度爆炸\n\n梯度爆炸就是在梯度更新的时候偏导数很大，导致更新参数无法收敛到最值（总是跳到其他不好的地方）。\n\n$$\nw_1=w_1− \\alpha \\frac{∂J(w)}{∂w1} \n$$\n\n$$\nw_2=w_2− \\alpha \\frac{∂J(w)}{∂w2}\n$$\n\n![](https://picture.mulindya.com/gradient-exp-pic1.png)\n\n## 梯度裁剪\n\n梯度裁剪是解决**梯度爆炸**的一种高效的方法，这里介绍梯度裁剪（Gradient Clipping）的方法，对梯度进行裁剪，论文提出对梯度的L2范数进行裁剪，也就是所有参数偏导数的平方和再开方。\n$$\ng_1=\\frac{∂J(w)}{∂w1} \n$$\n\n$$\ng_2=\\frac{∂J(w)}{∂w2}\n$$\n\n设定裁剪阈值为 C = max_norm，$\\Vert g\\Vert_2= \\sqrt{g^2_1+g^2_2}$\n\n当$\\Vert g\\Vert_2$大于c时：\n\n$$\ng = \\frac{c}{\\Vert g \\Vert_2} \\cdot g\n$$\n当$\\Vert g\\Vert_2$小于等于C时：g不变。其中，$\\frac{c}{\\Vert g \\Vert_2}$是一个标量\n\n## 总结\n\n训练模型出现Loss值出现跳动，一直不收敛时，除了设小学习率之外，梯度裁剪也是一个好方法。\n\n然而效果不佳时，那这就跟学习率和梯度爆炸没啥关系了。因此，**学习率**的设定和**梯度裁剪**的阈值并不能提高模型的准确率\n\n","source":"_posts/deep_learning/gradient-clip.md","raw":"---\ntitle: 梯度裁剪\ntags: [深度学习，梯度]\ncategories: 深度学习\ndate: 2021-08-12 10:20:29\nmath: true\n---\n\n>阅读代码 optimizer_config = dict(grad_clip=dict(max_norm=35, norm_type=2))，就此探究一下grap_clip。他的作用是梯度裁剪，为了防止梯度爆炸。其中max_norm是最大梯度阈值，norm_type是指定的范数类型。\n\n## 梯度爆炸\n\n梯度爆炸就是在梯度更新的时候偏导数很大，导致更新参数无法收敛到最值（总是跳到其他不好的地方）。\n\n$$\nw_1=w_1− \\alpha \\frac{∂J(w)}{∂w1} \n$$\n\n$$\nw_2=w_2− \\alpha \\frac{∂J(w)}{∂w2}\n$$\n\n![](https://picture.mulindya.com/gradient-exp-pic1.png)\n\n## 梯度裁剪\n\n梯度裁剪是解决**梯度爆炸**的一种高效的方法，这里介绍梯度裁剪（Gradient Clipping）的方法，对梯度进行裁剪，论文提出对梯度的L2范数进行裁剪，也就是所有参数偏导数的平方和再开方。\n$$\ng_1=\\frac{∂J(w)}{∂w1} \n$$\n\n$$\ng_2=\\frac{∂J(w)}{∂w2}\n$$\n\n设定裁剪阈值为 C = max_norm，$\\Vert g\\Vert_2= \\sqrt{g^2_1+g^2_2}$\n\n当$\\Vert g\\Vert_2$大于c时：\n\n$$\ng = \\frac{c}{\\Vert g \\Vert_2} \\cdot g\n$$\n当$\\Vert g\\Vert_2$小于等于C时：g不变。其中，$\\frac{c}{\\Vert g \\Vert_2}$是一个标量\n\n## 总结\n\n训练模型出现Loss值出现跳动，一直不收敛时，除了设小学习率之外，梯度裁剪也是一个好方法。\n\n然而效果不佳时，那这就跟学习率和梯度爆炸没啥关系了。因此，**学习率**的设定和**梯度裁剪**的阈值并不能提高模型的准确率\n\n","slug":"deep_learning/gradient-clip","published":1,"updated":"2022-01-18T08:10:17.049Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p073000qast91ei68ays","content":"<blockquote>\n<p>阅读代码 optimizer_config = dict(grad_clip=dict(max_norm=35, norm_type=2))，就此探究一下grap_clip。他的作用是梯度裁剪，为了防止梯度爆炸。其中max_norm是最大梯度阈值，norm_type是指定的范数类型。</p>\n</blockquote>\n<h2 id=\"梯度爆炸\">梯度爆炸</h2>\n<p>梯度爆炸就是在梯度更新的时候偏导数很大，导致更新参数无法收敛到最值（总是跳到其他不好的地方）。</p>\n<p>$$<br>\nw_1=w_1− \\alpha \\frac{∂J(w)}{∂w1}<br>\n$$</p>\n<p>$$<br>\nw_2=w_2− \\alpha \\frac{∂J(w)}{∂w2}<br>\n$$</p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic1.png\" alt=\"\"></p>\n<h2 id=\"梯度裁剪\">梯度裁剪</h2>\n<p>梯度裁剪是解决<strong>梯度爆炸</strong>的一种高效的方法，这里介绍梯度裁剪（Gradient Clipping）的方法，对梯度进行裁剪，论文提出对梯度的L2范数进行裁剪，也就是所有参数偏导数的平方和再开方。<br>\n$$<br>\ng_1=\\frac{∂J(w)}{∂w1}<br>\n$$</p>\n<p>$$<br>\ng_2=\\frac{∂J(w)}{∂w2}<br>\n$$</p>\n<p>设定裁剪阈值为 C = max_norm，$\\Vert g\\Vert_2= \\sqrt{g<sup>2_1+g</sup>2_2}$</p>\n<p>当$\\Vert g\\Vert_2$大于c时：</p>\n<p>$$<br>\ng = \\frac{c}{\\Vert g \\Vert_2} \\cdot g<br>\n$$<br>\n当$\\Vert g\\Vert_2$小于等于C时：g不变。其中，$\\frac{c}{\\Vert g \\Vert_2}$是一个标量</p>\n<h2 id=\"总结\">总结</h2>\n<p>训练模型出现Loss值出现跳动，一直不收敛时，除了设小学习率之外，梯度裁剪也是一个好方法。</p>\n<p>然而效果不佳时，那这就跟学习率和梯度爆炸没啥关系了。因此，<strong>学习率</strong>的设定和<strong>梯度裁剪</strong>的阈值并不能提高模型的准确率</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>阅读代码 optimizer_config = dict(grad_clip=dict(max_norm=35, norm_type=2))，就此探究一下grap_clip。他的作用是梯度裁剪，为了防止梯度爆炸。其中max_norm是最大梯度阈值，norm_type是指定的范数类型。</p>\n</blockquote>\n<h2 id=\"梯度爆炸\">梯度爆炸</h2>\n<p>梯度爆炸就是在梯度更新的时候偏导数很大，导致更新参数无法收敛到最值（总是跳到其他不好的地方）。</p>\n<p>$$<br>\nw_1=w_1− \\alpha \\frac{∂J(w)}{∂w1}<br>\n$$</p>\n<p>$$<br>\nw_2=w_2− \\alpha \\frac{∂J(w)}{∂w2}<br>\n$$</p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic1.png\" alt=\"\"></p>\n<h2 id=\"梯度裁剪\">梯度裁剪</h2>\n<p>梯度裁剪是解决<strong>梯度爆炸</strong>的一种高效的方法，这里介绍梯度裁剪（Gradient Clipping）的方法，对梯度进行裁剪，论文提出对梯度的L2范数进行裁剪，也就是所有参数偏导数的平方和再开方。<br>\n$$<br>\ng_1=\\frac{∂J(w)}{∂w1}<br>\n$$</p>\n<p>$$<br>\ng_2=\\frac{∂J(w)}{∂w2}<br>\n$$</p>\n<p>设定裁剪阈值为 C = max_norm，$\\Vert g\\Vert_2= \\sqrt{g<sup>2_1+g</sup>2_2}$</p>\n<p>当$\\Vert g\\Vert_2$大于c时：</p>\n<p>$$<br>\ng = \\frac{c}{\\Vert g \\Vert_2} \\cdot g<br>\n$$<br>\n当$\\Vert g\\Vert_2$小于等于C时：g不变。其中，$\\frac{c}{\\Vert g \\Vert_2}$是一个标量</p>\n<h2 id=\"总结\">总结</h2>\n<p>训练模型出现Loss值出现跳动，一直不收敛时，除了设小学习率之外，梯度裁剪也是一个好方法。</p>\n<p>然而效果不佳时，那这就跟学习率和梯度爆炸没啥关系了。因此，<strong>学习率</strong>的设定和<strong>梯度裁剪</strong>的阈值并不能提高模型的准确率</p>\n"},{"title":"梯度消失&梯度爆炸","date":"2021-08-17T02:42:10.000Z","math":true,"_content":"\n> 本文探讨深度学习中经常提到的概念--梯度消失和梯度爆炸 。他们是影响模型收敛，学习好坏的重要因素。对此现象也提出了很多对应的解决方案。我们来大致做一个总结，对其概念，原因和相关的解决方案进行探讨叭~~\n\n## 梯度爆炸&梯度消失\n\n梯度爆炸就是在梯度更新的时候偏导数很大，导致更新参数无法收敛到最值（总是跳到其他不好的地方）。\n\n梯度消失就是在梯度更新的时候偏导数很小，导致更新参数无法收敛到最值（动不了）。\n$$\nw_1=w_1− \\alpha \\frac{∂J(w)}{∂w1} \n$$\n\n$$\nw_2=w_2− \\alpha \\frac{∂J(w)}{∂w2}\n$$\n\n![](https://picture.mulindya.com/gradient-exp-pic1.png)\n\n## 梯度消失和梯度爆炸原因\n\n- 训练方式：网络训练时采用反向传播的方式，会使用链式求导法则，因此对激活函数求导时，如果权重乘以激活函数导数此部分大于1，那么当层数很多时，求出的梯度更新将以指数的形式增加，则会梯度爆炸。如果此部分小于1，则随着层数增多，求出的梯度会指数衰减，则会梯度消失。\n\n- 激活函数：如果选用sigmoid，$S(x) = \\frac{1}{1+e^{-x}}$ ，而其导数 $S'(x) = \\frac{e^{-x}}{(1+e^{-x})^2}=S(x)(1-S(x))$ ，其梯度不会超过0.25。\n\n- 权重初始值：因此一个均值为0标准差为1的高斯分布初始化参数很容易发生梯度消失，因为权重集中在-1到1之间。如果初始化比较大的值\n\n- 根据链式求导和反向传播，我们很容易得出，其中C是代价函数\n\n  ![](https://picture.mulindya.com/gradient-exp-pic2.png)\n\n  ![](https://picture.mulindya.com/gradient-exp-pic3.png)\n\n## 解决方案\n\n### 1，采用好的参数初始化方法。比如[He方法](https://blog.csdn.net/u010505915/article/details/106608922/?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0.base&spm=1001.2101.3001.4242)\n\n1. 前向传播的时候, 每一层的卷积计算结果的方差为1.\n2. 反向传播的时候, 每一 层的继续往前传的梯度方差为1(因为每层会有两个梯度的计算, 一个用来更新当前层的权重, 一个继续传播, 用于前面层的梯度的计算.)\n\n### 2，梯度剪切--梯度爆炸\n\n梯度裁剪是解决**梯度爆炸**的一种高效的方法，这里介绍梯度裁剪（Gradient Clipping）的方法，对梯度进行裁剪，论文提出对梯度的L2范数进行裁剪，也就是所有参数偏导数的平方和再开方。\n$$\ng_1=\\frac{∂J(w)}{∂w1} \n$$\n\n$$\ng_2=\\frac{∂J(w)}{∂w2}\n$$\n\n设定裁剪阈值为 C = max_norm，$\\Vert g\\Vert_2= \\sqrt{g^2_1+g^2_2}$\n\n当$\\Vert g\\Vert_2$大于c时：\n\n$$\ng = \\frac{c}{\\Vert g \\Vert_2} \\cdot g\n$$\n当$\\Vert g\\Vert_2$小于等于C时：g不变。其中，$\\frac{c}{\\Vert g \\Vert_2}$是一个标量\n\n### 3，正则化--梯度爆炸\n\n​\t\t采用权重正则化，主要是通过对网络权重做正则来限制过拟合，同时，如果发生梯度爆炸，那么权值的范数就会变的非常大，反过来，通过限制正则化项的大小，也可以在一定程度上限制梯度爆炸的发生。比较常见的是l1正则，和l2正则，在各个深度框架中都有相应的API可以使用正则化，比如在pytorch中，若搭建网络的时候已经设置了正则化参数，则调用以下代码可以直接计算出正则损失。\n​\t\ttorch.optim集成了很多优化器，如SGD，Adadelta，Adam，Adagrad，RMSprop等，这些优化器自带的一个参数weight_decay，用于指定权值衰减率，相当于L2正则化中的λ参数，注意torch.optim集成的优化器只有L2正则化方法，你可以查看注释，参数weight_decay 的解析是：\n\n```python\n weight_decay (float, optional): weight decay (L2 penalty) (default: 0)\n optimizer = optim.Adam(model.parameters(),lr=learning_rate,weight_decay=0.01)\n```\n\nloss计算公式\n$$\nLoss = (y-W^Tx)^2+\\alpha {\\Vert W \\Vert}^2\n$$\n\n### 4，激活函数\n\n#### 1.ReLU函数：\n\n如果激活函数的导数为1，那么就不存在梯度消失爆炸的问题了，每层的网络都可以得到相同的更新速度，ReLU就这样应运而生。\n\nReLU的主要贡献在于：\n\n![](https://picture.mulindya.com/gradient-exp-pic4.png)\n\n##### 优点\n\n解决了梯度消失、爆炸的问题。\n计算方便，计算速度快。\n加速了网络的训练。\n\n##### 缺点：\n\n由于负数部分恒为0，会导致一些神经元无法激活（可通过设置小学习率部分解决）。\n输出不是以0为中心的。\n\n#### 2.LeakyReLU函数：\n\nLeakyReLU就是为了解决ReLU的0区间带来的影响，该函数输出对负值输入有很小的坡度，由于导数总是不为零，这能减少静默神经元的出现，允许基于梯度的学习（虽然会很慢），解决了ReLU函数进入负区间后，导致神经元不学习的问题。\n\n![](https://picture.mulindya.com/gradient-exp-pic5.png)\n\n#### 3.ELU函数：\n\n![](https://picture.mulindya.com/gradient-exp-pic6.png)\n\n- 融合了sigmoid和ReLU，**左侧具有软饱和性，右侧无饱和性**。\n\n- 右侧线性部分使得ELU能够缓解梯度消失，而左侧软饱能够让ELU对输入变化或噪声更鲁棒。\n\n- ELU的输出均值接近于零，所以收敛速度更快，但相对于LeakyReLU来说，计算要更耗时间一些。\n\n<font size=3 color=BlueViolet>小知识：</font>\n\n> 梯度饱和常常是和激活函数相关的，比如sigmod和tanh就属于典型容易进入梯度饱和区的函数，即自变量进入某个区间后，梯度变化会非常小，表现在图上就是函数曲线进入某些区域后，越来越趋近一条直线，梯度变化很小，梯度饱和会导致训练过程中梯度变化缓慢，从而造成模型训练缓慢\n\n### 4，Batch Normalization\n\nBN是深度学习发展以来提出的最重要的成果之一了，目前已经被广泛的应用到了各大网络中，具有加速网络收敛速度，提升训练稳定性的效果，**BN本质上是解决反向传播过程中的梯度问题。**BN全名是Batch Normalization，简称BN，即批规范化，**通过规范化操作将输出信号x规范化保证网络的稳定性。**\n反向传播式子中有w的存在，所以w的大小影响了梯度的消失和爆炸，**BN就是通过对每一层的输出规范为均值和方差一致的方法**，消除了w带来的放大缩小的影响，进而解决梯度消失和爆炸的问题，或者可以理解为BN将输出从饱和区拉倒了非饱和区。\n有关Batch Normalization详细的内容可以参考这篇博客： [Batch Normalization](http://blog.csdn.net/qq_25737169/article/details/79048516)\n\n### 5,残差结构\n\n事实上，就是残差网络的出现导致了image net比赛的终结，自从残差提出后，几乎所有的深度网络都离不开残差的身影，相比较之前的几层，几十层的深度网络，在残差网络面前都不值一提，残差可以很轻松的构建几百层，一千多层的网络而不用担心梯度消失过快的问题，原因就在于残差的捷径（shortcut）部分。原理可参见：[残差结构](https://zhuanlan.zhihu.com/p/42706477)\n\n### 6，LSTM网络\n\nLSTM是循环神经网络RNN的变体，全称是长短期记忆网络（long-short term memory networks），它是不那么容易发生梯度消失的，主要原因在于LSTM内部复杂的“门”结构，**LSTM通过它内部的“门”可以接下来更新的时候“记住”前几次训练的“残留记忆”**，因此，经常用于生成文本中。关于LSTM的原理详解后续再分析。[LSTM](https://zhuanlan.zhihu.com/p/32085405)\n\n\n![](https://picture.mulindya.com/gradient-exp-pic7.png)\n","source":"_posts/deep_learning/gradient-exp.md","raw":"---\ntitle: 梯度消失&梯度爆炸\ntags: 深度学习\ncategories: 深度学习\ndate: 2021-08-17 10:42:10\nmath: true\n---\n\n> 本文探讨深度学习中经常提到的概念--梯度消失和梯度爆炸 。他们是影响模型收敛，学习好坏的重要因素。对此现象也提出了很多对应的解决方案。我们来大致做一个总结，对其概念，原因和相关的解决方案进行探讨叭~~\n\n## 梯度爆炸&梯度消失\n\n梯度爆炸就是在梯度更新的时候偏导数很大，导致更新参数无法收敛到最值（总是跳到其他不好的地方）。\n\n梯度消失就是在梯度更新的时候偏导数很小，导致更新参数无法收敛到最值（动不了）。\n$$\nw_1=w_1− \\alpha \\frac{∂J(w)}{∂w1} \n$$\n\n$$\nw_2=w_2− \\alpha \\frac{∂J(w)}{∂w2}\n$$\n\n![](https://picture.mulindya.com/gradient-exp-pic1.png)\n\n## 梯度消失和梯度爆炸原因\n\n- 训练方式：网络训练时采用反向传播的方式，会使用链式求导法则，因此对激活函数求导时，如果权重乘以激活函数导数此部分大于1，那么当层数很多时，求出的梯度更新将以指数的形式增加，则会梯度爆炸。如果此部分小于1，则随着层数增多，求出的梯度会指数衰减，则会梯度消失。\n\n- 激活函数：如果选用sigmoid，$S(x) = \\frac{1}{1+e^{-x}}$ ，而其导数 $S'(x) = \\frac{e^{-x}}{(1+e^{-x})^2}=S(x)(1-S(x))$ ，其梯度不会超过0.25。\n\n- 权重初始值：因此一个均值为0标准差为1的高斯分布初始化参数很容易发生梯度消失，因为权重集中在-1到1之间。如果初始化比较大的值\n\n- 根据链式求导和反向传播，我们很容易得出，其中C是代价函数\n\n  ![](https://picture.mulindya.com/gradient-exp-pic2.png)\n\n  ![](https://picture.mulindya.com/gradient-exp-pic3.png)\n\n## 解决方案\n\n### 1，采用好的参数初始化方法。比如[He方法](https://blog.csdn.net/u010505915/article/details/106608922/?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0.base&spm=1001.2101.3001.4242)\n\n1. 前向传播的时候, 每一层的卷积计算结果的方差为1.\n2. 反向传播的时候, 每一 层的继续往前传的梯度方差为1(因为每层会有两个梯度的计算, 一个用来更新当前层的权重, 一个继续传播, 用于前面层的梯度的计算.)\n\n### 2，梯度剪切--梯度爆炸\n\n梯度裁剪是解决**梯度爆炸**的一种高效的方法，这里介绍梯度裁剪（Gradient Clipping）的方法，对梯度进行裁剪，论文提出对梯度的L2范数进行裁剪，也就是所有参数偏导数的平方和再开方。\n$$\ng_1=\\frac{∂J(w)}{∂w1} \n$$\n\n$$\ng_2=\\frac{∂J(w)}{∂w2}\n$$\n\n设定裁剪阈值为 C = max_norm，$\\Vert g\\Vert_2= \\sqrt{g^2_1+g^2_2}$\n\n当$\\Vert g\\Vert_2$大于c时：\n\n$$\ng = \\frac{c}{\\Vert g \\Vert_2} \\cdot g\n$$\n当$\\Vert g\\Vert_2$小于等于C时：g不变。其中，$\\frac{c}{\\Vert g \\Vert_2}$是一个标量\n\n### 3，正则化--梯度爆炸\n\n​\t\t采用权重正则化，主要是通过对网络权重做正则来限制过拟合，同时，如果发生梯度爆炸，那么权值的范数就会变的非常大，反过来，通过限制正则化项的大小，也可以在一定程度上限制梯度爆炸的发生。比较常见的是l1正则，和l2正则，在各个深度框架中都有相应的API可以使用正则化，比如在pytorch中，若搭建网络的时候已经设置了正则化参数，则调用以下代码可以直接计算出正则损失。\n​\t\ttorch.optim集成了很多优化器，如SGD，Adadelta，Adam，Adagrad，RMSprop等，这些优化器自带的一个参数weight_decay，用于指定权值衰减率，相当于L2正则化中的λ参数，注意torch.optim集成的优化器只有L2正则化方法，你可以查看注释，参数weight_decay 的解析是：\n\n```python\n weight_decay (float, optional): weight decay (L2 penalty) (default: 0)\n optimizer = optim.Adam(model.parameters(),lr=learning_rate,weight_decay=0.01)\n```\n\nloss计算公式\n$$\nLoss = (y-W^Tx)^2+\\alpha {\\Vert W \\Vert}^2\n$$\n\n### 4，激活函数\n\n#### 1.ReLU函数：\n\n如果激活函数的导数为1，那么就不存在梯度消失爆炸的问题了，每层的网络都可以得到相同的更新速度，ReLU就这样应运而生。\n\nReLU的主要贡献在于：\n\n![](https://picture.mulindya.com/gradient-exp-pic4.png)\n\n##### 优点\n\n解决了梯度消失、爆炸的问题。\n计算方便，计算速度快。\n加速了网络的训练。\n\n##### 缺点：\n\n由于负数部分恒为0，会导致一些神经元无法激活（可通过设置小学习率部分解决）。\n输出不是以0为中心的。\n\n#### 2.LeakyReLU函数：\n\nLeakyReLU就是为了解决ReLU的0区间带来的影响，该函数输出对负值输入有很小的坡度，由于导数总是不为零，这能减少静默神经元的出现，允许基于梯度的学习（虽然会很慢），解决了ReLU函数进入负区间后，导致神经元不学习的问题。\n\n![](https://picture.mulindya.com/gradient-exp-pic5.png)\n\n#### 3.ELU函数：\n\n![](https://picture.mulindya.com/gradient-exp-pic6.png)\n\n- 融合了sigmoid和ReLU，**左侧具有软饱和性，右侧无饱和性**。\n\n- 右侧线性部分使得ELU能够缓解梯度消失，而左侧软饱能够让ELU对输入变化或噪声更鲁棒。\n\n- ELU的输出均值接近于零，所以收敛速度更快，但相对于LeakyReLU来说，计算要更耗时间一些。\n\n<font size=3 color=BlueViolet>小知识：</font>\n\n> 梯度饱和常常是和激活函数相关的，比如sigmod和tanh就属于典型容易进入梯度饱和区的函数，即自变量进入某个区间后，梯度变化会非常小，表现在图上就是函数曲线进入某些区域后，越来越趋近一条直线，梯度变化很小，梯度饱和会导致训练过程中梯度变化缓慢，从而造成模型训练缓慢\n\n### 4，Batch Normalization\n\nBN是深度学习发展以来提出的最重要的成果之一了，目前已经被广泛的应用到了各大网络中，具有加速网络收敛速度，提升训练稳定性的效果，**BN本质上是解决反向传播过程中的梯度问题。**BN全名是Batch Normalization，简称BN，即批规范化，**通过规范化操作将输出信号x规范化保证网络的稳定性。**\n反向传播式子中有w的存在，所以w的大小影响了梯度的消失和爆炸，**BN就是通过对每一层的输出规范为均值和方差一致的方法**，消除了w带来的放大缩小的影响，进而解决梯度消失和爆炸的问题，或者可以理解为BN将输出从饱和区拉倒了非饱和区。\n有关Batch Normalization详细的内容可以参考这篇博客： [Batch Normalization](http://blog.csdn.net/qq_25737169/article/details/79048516)\n\n### 5,残差结构\n\n事实上，就是残差网络的出现导致了image net比赛的终结，自从残差提出后，几乎所有的深度网络都离不开残差的身影，相比较之前的几层，几十层的深度网络，在残差网络面前都不值一提，残差可以很轻松的构建几百层，一千多层的网络而不用担心梯度消失过快的问题，原因就在于残差的捷径（shortcut）部分。原理可参见：[残差结构](https://zhuanlan.zhihu.com/p/42706477)\n\n### 6，LSTM网络\n\nLSTM是循环神经网络RNN的变体，全称是长短期记忆网络（long-short term memory networks），它是不那么容易发生梯度消失的，主要原因在于LSTM内部复杂的“门”结构，**LSTM通过它内部的“门”可以接下来更新的时候“记住”前几次训练的“残留记忆”**，因此，经常用于生成文本中。关于LSTM的原理详解后续再分析。[LSTM](https://zhuanlan.zhihu.com/p/32085405)\n\n\n![](https://picture.mulindya.com/gradient-exp-pic7.png)\n","slug":"deep_learning/gradient-exp","published":1,"updated":"2022-01-18T08:10:17.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p076000rast92hbf7wrn","content":"<blockquote>\n<p>本文探讨深度学习中经常提到的概念–梯度消失和梯度爆炸 。他们是影响模型收敛，学习好坏的重要因素。对此现象也提出了很多对应的解决方案。我们来大致做一个总结，对其概念，原因和相关的解决方案进行探讨叭~~</p>\n</blockquote>\n<h2 id=\"梯度爆炸-梯度消失\">梯度爆炸&amp;梯度消失</h2>\n<p>梯度爆炸就是在梯度更新的时候偏导数很大，导致更新参数无法收敛到最值（总是跳到其他不好的地方）。</p>\n<p>梯度消失就是在梯度更新的时候偏导数很小，导致更新参数无法收敛到最值（动不了）。<br>\n$$<br>\nw_1=w_1− \\alpha \\frac{∂J(w)}{∂w1}<br>\n$$</p>\n<p>$$<br>\nw_2=w_2− \\alpha \\frac{∂J(w)}{∂w2}<br>\n$$</p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic1.png\" alt=\"\"></p>\n<h2 id=\"梯度消失和梯度爆炸原因\">梯度消失和梯度爆炸原因</h2>\n<ul>\n<li>\n<p>训练方式：网络训练时采用反向传播的方式，会使用链式求导法则，因此对激活函数求导时，如果权重乘以激活函数导数此部分大于1，那么当层数很多时，求出的梯度更新将以指数的形式增加，则会梯度爆炸。如果此部分小于1，则随着层数增多，求出的梯度会指数衰减，则会梯度消失。</p>\n</li>\n<li>\n<p>激活函数：如果选用sigmoid，$S(x) = \\frac{1}{1+e^{-x}}$ ，而其导数 $S’(x) = \\frac{e<sup>{-x}}{(1+e</sup>{-x})^2}=S(x)(1-S(x))$ ，其梯度不会超过0.25。</p>\n</li>\n<li>\n<p>权重初始值：因此一个均值为0标准差为1的高斯分布初始化参数很容易发生梯度消失，因为权重集中在-1到1之间。如果初始化比较大的值</p>\n</li>\n<li>\n<p>根据链式求导和反向传播，我们很容易得出，其中C是代价函数</p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic2.png\" alt=\"\"></p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic3.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"解决方案\">解决方案</h2>\n<h3 id=\"1，采用好的参数初始化方法。比如He方法\">1，采用好的参数初始化方法。比如<a href=\"https://blog.csdn.net/u010505915/article/details/106608922/?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0.base&amp;spm=1001.2101.3001.4242\">He方法</a></h3>\n<ol>\n<li>前向传播的时候, 每一层的卷积计算结果的方差为1.</li>\n<li>反向传播的时候, 每一 层的继续往前传的梯度方差为1(因为每层会有两个梯度的计算, 一个用来更新当前层的权重, 一个继续传播, 用于前面层的梯度的计算.)</li>\n</ol>\n<h3 id=\"2，梯度剪切–梯度爆炸\">2，梯度剪切–梯度爆炸</h3>\n<p>梯度裁剪是解决<strong>梯度爆炸</strong>的一种高效的方法，这里介绍梯度裁剪（Gradient Clipping）的方法，对梯度进行裁剪，论文提出对梯度的L2范数进行裁剪，也就是所有参数偏导数的平方和再开方。<br>\n$$<br>\ng_1=\\frac{∂J(w)}{∂w1}<br>\n$$</p>\n<p>$$<br>\ng_2=\\frac{∂J(w)}{∂w2}<br>\n$$</p>\n<p>设定裁剪阈值为 C = max_norm，$\\Vert g\\Vert_2= \\sqrt{g<sup>2_1+g</sup>2_2}$</p>\n<p>当$\\Vert g\\Vert_2$大于c时：</p>\n<p>$$<br>\ng = \\frac{c}{\\Vert g \\Vert_2} \\cdot g<br>\n$$<br>\n当$\\Vert g\\Vert_2$小于等于C时：g不变。其中，$\\frac{c}{\\Vert g \\Vert_2}$是一个标量</p>\n<h3 id=\"3，正则化–梯度爆炸\">3，正则化–梯度爆炸</h3>\n<p>​\t\t采用权重正则化，主要是通过对网络权重做正则来限制过拟合，同时，如果发生梯度爆炸，那么权值的范数就会变的非常大，反过来，通过限制正则化项的大小，也可以在一定程度上限制梯度爆炸的发生。比较常见的是l1正则，和l2正则，在各个深度框架中都有相应的API可以使用正则化，比如在pytorch中，若搭建网络的时候已经设置了正则化参数，则调用以下代码可以直接计算出正则损失。<br>\n​\t\ttorch.optim集成了很多优化器，如SGD，Adadelta，Adam，Adagrad，RMSprop等，这些优化器自带的一个参数weight_decay，用于指定权值衰减率，相当于L2正则化中的λ参数，注意torch.optim集成的优化器只有L2正则化方法，你可以查看注释，参数weight_decay 的解析是：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">weight_decay (<span class=\"hljs-built_in\">float</span>, optional): weight decay (L2 penalty) (default: <span class=\"hljs-number\">0</span>)<br>optimizer = optim.Adam(model.parameters(),lr=learning_rate,weight_decay=<span class=\"hljs-number\">0.01</span>)<br></code></pre></td></tr></tbody></table></figure>\n<p>loss计算公式<br>\n$$<br>\nLoss = (y-W<sup>Tx)</sup>2+\\alpha {\\Vert W \\Vert}^2<br>\n$$</p>\n<h3 id=\"4，激活函数\">4，激活函数</h3>\n<h4 id=\"1-ReLU函数：\">1.ReLU函数：</h4>\n<p>如果激活函数的导数为1，那么就不存在梯度消失爆炸的问题了，每层的网络都可以得到相同的更新速度，ReLU就这样应运而生。</p>\n<p>ReLU的主要贡献在于：</p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic4.png\" alt=\"\"></p>\n<h5 id=\"优点\">优点</h5>\n<p>解决了梯度消失、爆炸的问题。<br>\n计算方便，计算速度快。<br>\n加速了网络的训练。</p>\n<h5 id=\"缺点：\">缺点：</h5>\n<p>由于负数部分恒为0，会导致一些神经元无法激活（可通过设置小学习率部分解决）。<br>\n输出不是以0为中心的。</p>\n<h4 id=\"2-LeakyReLU函数：\">2.LeakyReLU函数：</h4>\n<p>LeakyReLU就是为了解决ReLU的0区间带来的影响，该函数输出对负值输入有很小的坡度，由于导数总是不为零，这能减少静默神经元的出现，允许基于梯度的学习（虽然会很慢），解决了ReLU函数进入负区间后，导致神经元不学习的问题。</p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic5.png\" alt=\"\"></p>\n<h4 id=\"3-ELU函数：\">3.ELU函数：</h4>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic6.png\" alt=\"\"></p>\n<ul>\n<li>\n<p>融合了sigmoid和ReLU，<strong>左侧具有软饱和性，右侧无饱和性</strong>。</p>\n</li>\n<li>\n<p>右侧线性部分使得ELU能够缓解梯度消失，而左侧软饱能够让ELU对输入变化或噪声更鲁棒。</p>\n</li>\n<li>\n<p>ELU的输出均值接近于零，所以收敛速度更快，但相对于LeakyReLU来说，计算要更耗时间一些。</p>\n</li>\n</ul>\n<p><font size=\"3\" color=\"BlueViolet\">小知识：</font></p>\n<blockquote>\n<p>梯度饱和常常是和激活函数相关的，比如sigmod和tanh就属于典型容易进入梯度饱和区的函数，即自变量进入某个区间后，梯度变化会非常小，表现在图上就是函数曲线进入某些区域后，越来越趋近一条直线，梯度变化很小，梯度饱和会导致训练过程中梯度变化缓慢，从而造成模型训练缓慢</p>\n</blockquote>\n<h3 id=\"4，Batch-Normalization\">4，Batch Normalization</h3>\n<p>BN是深度学习发展以来提出的最重要的成果之一了，目前已经被广泛的应用到了各大网络中，具有加速网络收敛速度，提升训练稳定性的效果，**BN本质上是解决反向传播过程中的梯度问题。**BN全名是Batch Normalization，简称BN，即批规范化，<strong>通过规范化操作将输出信号x规范化保证网络的稳定性。</strong><br>\n反向传播式子中有w的存在，所以w的大小影响了梯度的消失和爆炸，<strong>BN就是通过对每一层的输出规范为均值和方差一致的方法</strong>，消除了w带来的放大缩小的影响，进而解决梯度消失和爆炸的问题，或者可以理解为BN将输出从饱和区拉倒了非饱和区。<br>\n有关Batch Normalization详细的内容可以参考这篇博客： <a href=\"http://blog.csdn.net/qq_25737169/article/details/79048516\">Batch Normalization</a></p>\n<h3 id=\"5-残差结构\">5,残差结构</h3>\n<p>事实上，就是残差网络的出现导致了image net比赛的终结，自从残差提出后，几乎所有的深度网络都离不开残差的身影，相比较之前的几层，几十层的深度网络，在残差网络面前都不值一提，残差可以很轻松的构建几百层，一千多层的网络而不用担心梯度消失过快的问题，原因就在于残差的捷径（shortcut）部分。原理可参见：<a href=\"https://zhuanlan.zhihu.com/p/42706477\">残差结构</a></p>\n<h3 id=\"6，LSTM网络\">6，LSTM网络</h3>\n<p>LSTM是循环神经网络RNN的变体，全称是长短期记忆网络（long-short term memory networks），它是不那么容易发生梯度消失的，主要原因在于LSTM内部复杂的“门”结构，<strong>LSTM通过它内部的“门”可以接下来更新的时候“记住”前几次训练的“残留记忆”</strong>，因此，经常用于生成文本中。关于LSTM的原理详解后续再分析。<a href=\"https://zhuanlan.zhihu.com/p/32085405\">LSTM</a></p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic7.png\" alt=\"\"></p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>本文探讨深度学习中经常提到的概念–梯度消失和梯度爆炸 。他们是影响模型收敛，学习好坏的重要因素。对此现象也提出了很多对应的解决方案。我们来大致做一个总结，对其概念，原因和相关的解决方案进行探讨叭~~</p>\n</blockquote>\n<h2 id=\"梯度爆炸-梯度消失\">梯度爆炸&amp;梯度消失</h2>\n<p>梯度爆炸就是在梯度更新的时候偏导数很大，导致更新参数无法收敛到最值（总是跳到其他不好的地方）。</p>\n<p>梯度消失就是在梯度更新的时候偏导数很小，导致更新参数无法收敛到最值（动不了）。<br>\n$$<br>\nw_1=w_1− \\alpha \\frac{∂J(w)}{∂w1}<br>\n$$</p>\n<p>$$<br>\nw_2=w_2− \\alpha \\frac{∂J(w)}{∂w2}<br>\n$$</p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic1.png\" alt=\"\"></p>\n<h2 id=\"梯度消失和梯度爆炸原因\">梯度消失和梯度爆炸原因</h2>\n<ul>\n<li>\n<p>训练方式：网络训练时采用反向传播的方式，会使用链式求导法则，因此对激活函数求导时，如果权重乘以激活函数导数此部分大于1，那么当层数很多时，求出的梯度更新将以指数的形式增加，则会梯度爆炸。如果此部分小于1，则随着层数增多，求出的梯度会指数衰减，则会梯度消失。</p>\n</li>\n<li>\n<p>激活函数：如果选用sigmoid，$S(x) = \\frac{1}{1+e^{-x}}$ ，而其导数 $S’(x) = \\frac{e<sup>{-x}}{(1+e</sup>{-x})^2}=S(x)(1-S(x))$ ，其梯度不会超过0.25。</p>\n</li>\n<li>\n<p>权重初始值：因此一个均值为0标准差为1的高斯分布初始化参数很容易发生梯度消失，因为权重集中在-1到1之间。如果初始化比较大的值</p>\n</li>\n<li>\n<p>根据链式求导和反向传播，我们很容易得出，其中C是代价函数</p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic2.png\" alt=\"\"></p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic3.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"解决方案\">解决方案</h2>\n<h3 id=\"1，采用好的参数初始化方法。比如He方法\">1，采用好的参数初始化方法。比如<a href=\"https://blog.csdn.net/u010505915/article/details/106608922/?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0.base&amp;spm=1001.2101.3001.4242\">He方法</a></h3>\n<ol>\n<li>前向传播的时候, 每一层的卷积计算结果的方差为1.</li>\n<li>反向传播的时候, 每一 层的继续往前传的梯度方差为1(因为每层会有两个梯度的计算, 一个用来更新当前层的权重, 一个继续传播, 用于前面层的梯度的计算.)</li>\n</ol>\n<h3 id=\"2，梯度剪切–梯度爆炸\">2，梯度剪切–梯度爆炸</h3>\n<p>梯度裁剪是解决<strong>梯度爆炸</strong>的一种高效的方法，这里介绍梯度裁剪（Gradient Clipping）的方法，对梯度进行裁剪，论文提出对梯度的L2范数进行裁剪，也就是所有参数偏导数的平方和再开方。<br>\n$$<br>\ng_1=\\frac{∂J(w)}{∂w1}<br>\n$$</p>\n<p>$$<br>\ng_2=\\frac{∂J(w)}{∂w2}<br>\n$$</p>\n<p>设定裁剪阈值为 C = max_norm，$\\Vert g\\Vert_2= \\sqrt{g<sup>2_1+g</sup>2_2}$</p>\n<p>当$\\Vert g\\Vert_2$大于c时：</p>\n<p>$$<br>\ng = \\frac{c}{\\Vert g \\Vert_2} \\cdot g<br>\n$$<br>\n当$\\Vert g\\Vert_2$小于等于C时：g不变。其中，$\\frac{c}{\\Vert g \\Vert_2}$是一个标量</p>\n<h3 id=\"3，正则化–梯度爆炸\">3，正则化–梯度爆炸</h3>\n<p>​\t\t采用权重正则化，主要是通过对网络权重做正则来限制过拟合，同时，如果发生梯度爆炸，那么权值的范数就会变的非常大，反过来，通过限制正则化项的大小，也可以在一定程度上限制梯度爆炸的发生。比较常见的是l1正则，和l2正则，在各个深度框架中都有相应的API可以使用正则化，比如在pytorch中，若搭建网络的时候已经设置了正则化参数，则调用以下代码可以直接计算出正则损失。<br>\n​\t\ttorch.optim集成了很多优化器，如SGD，Adadelta，Adam，Adagrad，RMSprop等，这些优化器自带的一个参数weight_decay，用于指定权值衰减率，相当于L2正则化中的λ参数，注意torch.optim集成的优化器只有L2正则化方法，你可以查看注释，参数weight_decay 的解析是：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">weight_decay (<span class=\"hljs-built_in\">float</span>, optional): weight decay (L2 penalty) (default: <span class=\"hljs-number\">0</span>)<br>optimizer = optim.Adam(model.parameters(),lr=learning_rate,weight_decay=<span class=\"hljs-number\">0.01</span>)<br></code></pre></td></tr></table></figure>\n<p>loss计算公式<br>\n$$<br>\nLoss = (y-W<sup>Tx)</sup>2+\\alpha {\\Vert W \\Vert}^2<br>\n$$</p>\n<h3 id=\"4，激活函数\">4，激活函数</h3>\n<h4 id=\"1-ReLU函数：\">1.ReLU函数：</h4>\n<p>如果激活函数的导数为1，那么就不存在梯度消失爆炸的问题了，每层的网络都可以得到相同的更新速度，ReLU就这样应运而生。</p>\n<p>ReLU的主要贡献在于：</p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic4.png\" alt=\"\"></p>\n<h5 id=\"优点\">优点</h5>\n<p>解决了梯度消失、爆炸的问题。<br>\n计算方便，计算速度快。<br>\n加速了网络的训练。</p>\n<h5 id=\"缺点：\">缺点：</h5>\n<p>由于负数部分恒为0，会导致一些神经元无法激活（可通过设置小学习率部分解决）。<br>\n输出不是以0为中心的。</p>\n<h4 id=\"2-LeakyReLU函数：\">2.LeakyReLU函数：</h4>\n<p>LeakyReLU就是为了解决ReLU的0区间带来的影响，该函数输出对负值输入有很小的坡度，由于导数总是不为零，这能减少静默神经元的出现，允许基于梯度的学习（虽然会很慢），解决了ReLU函数进入负区间后，导致神经元不学习的问题。</p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic5.png\" alt=\"\"></p>\n<h4 id=\"3-ELU函数：\">3.ELU函数：</h4>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic6.png\" alt=\"\"></p>\n<ul>\n<li>\n<p>融合了sigmoid和ReLU，<strong>左侧具有软饱和性，右侧无饱和性</strong>。</p>\n</li>\n<li>\n<p>右侧线性部分使得ELU能够缓解梯度消失，而左侧软饱能够让ELU对输入变化或噪声更鲁棒。</p>\n</li>\n<li>\n<p>ELU的输出均值接近于零，所以收敛速度更快，但相对于LeakyReLU来说，计算要更耗时间一些。</p>\n</li>\n</ul>\n<p><font size=3 color=BlueViolet>小知识：</font></p>\n<blockquote>\n<p>梯度饱和常常是和激活函数相关的，比如sigmod和tanh就属于典型容易进入梯度饱和区的函数，即自变量进入某个区间后，梯度变化会非常小，表现在图上就是函数曲线进入某些区域后，越来越趋近一条直线，梯度变化很小，梯度饱和会导致训练过程中梯度变化缓慢，从而造成模型训练缓慢</p>\n</blockquote>\n<h3 id=\"4，Batch-Normalization\">4，Batch Normalization</h3>\n<p>BN是深度学习发展以来提出的最重要的成果之一了，目前已经被广泛的应用到了各大网络中，具有加速网络收敛速度，提升训练稳定性的效果，**BN本质上是解决反向传播过程中的梯度问题。**BN全名是Batch Normalization，简称BN，即批规范化，<strong>通过规范化操作将输出信号x规范化保证网络的稳定性。</strong><br>\n反向传播式子中有w的存在，所以w的大小影响了梯度的消失和爆炸，<strong>BN就是通过对每一层的输出规范为均值和方差一致的方法</strong>，消除了w带来的放大缩小的影响，进而解决梯度消失和爆炸的问题，或者可以理解为BN将输出从饱和区拉倒了非饱和区。<br>\n有关Batch Normalization详细的内容可以参考这篇博客： <a href=\"http://blog.csdn.net/qq_25737169/article/details/79048516\">Batch Normalization</a></p>\n<h3 id=\"5-残差结构\">5,残差结构</h3>\n<p>事实上，就是残差网络的出现导致了image net比赛的终结，自从残差提出后，几乎所有的深度网络都离不开残差的身影，相比较之前的几层，几十层的深度网络，在残差网络面前都不值一提，残差可以很轻松的构建几百层，一千多层的网络而不用担心梯度消失过快的问题，原因就在于残差的捷径（shortcut）部分。原理可参见：<a href=\"https://zhuanlan.zhihu.com/p/42706477\">残差结构</a></p>\n<h3 id=\"6，LSTM网络\">6，LSTM网络</h3>\n<p>LSTM是循环神经网络RNN的变体，全称是长短期记忆网络（long-short term memory networks），它是不那么容易发生梯度消失的，主要原因在于LSTM内部复杂的“门”结构，<strong>LSTM通过它内部的“门”可以接下来更新的时候“记住”前几次训练的“残留记忆”</strong>，因此，经常用于生成文本中。关于LSTM的原理详解后续再分析。<a href=\"https://zhuanlan.zhihu.com/p/32085405\">LSTM</a></p>\n<p><img src=\"https://picture.mulindya.com/gradient-exp-pic7.png\" alt=\"\"></p>\n"},{"title":"YOLOv1","date":"2021-08-21T07:56:11.000Z","math":true,"_content":"\n> YOLO系列是基于深度学习的回归方法。YOLO：you only look once的优点是实时快速目标检测。一直都很想把YOLO系统的学习一下。在此，记录下相关的知识和个人理解。做笔记也算是督促我好好的整理相关内容叭！ok开始！:wink:\n\n> 参考：\n> https://zhuanlan.zhihu.com/p/136382095\n> https://mp.weixin.qq.com/s/df1JaGtnoEY4FQford4UIw\n\n## YOLO 和 Faster R-CNN\n\n两个网络的差异有两个方面：\n\n1. Yolo没有显示求取region proposal的过程，虽然Faster R-CNN中的RPN于Fast R-CNN共享卷积层，但是在模型训练过程中，还是需要反复的训练RPN于Fast R-CNN，也就是说这种方式还是需要”look twice“ ：确定候选框和分类；而Yolo系列只需要”look once“\n\n   > 关于Faster R-CNN的知识后续再填坑.....\n\n2. Yolo将检测统一为一个回归问题。而R-CNN将检测结果分为两个部分进行求解：分类`物体的类别` ， 回归`物体的bounding  box`\n\n## YOLOv1\n\n### 综述\n\n**论文下载：** http://arxiv.org/abs/1506.02640\n\n**代码下载：** https://github.com/pjreddie/darknet\n\n**核心思想**：将整张图作为网络的输入（与Faster-RCNN类似），直接在输出层对BBox的位置和类别进行回归。\n\n### 论文\n\n<details>\n<summary> yolov1 论文：You Only Look Once:Unified, Real-Time Object Detection</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/yolov1.pdf' width=100% height=650></iframe>\n</details>\n\n实现方法：\n\n![](https://picture.mulindya.com/yolov1-pic1.png)\n\n\n- 首先将一幅图像分成S*S个网格（grid cell）,如果某个物体的中心落在这个网格中，那么这个网格就负责预测这个物体。\n\n- 每个网格需要预测B个边界框(BBox)的位置信息和对应的置信度（confidence）;一个BBox对应四个位置信息和一个confidence信息，confidence表示所预测的Box中含有objext的置信度和box的预测情况。\n\n  > 也就是$conf = Pr(object)\\times IOU^{truth}_{pred}$ 如果有object落在其中的grid cell里，那么第一项为1否则取0.\n\n每个bounding box要预测(x, y, w, h)和confidence共5个值，每个网格还要预测一个类别信息，记为C类。则SxS个网格，每个网格要预测B个bounding box还要预测C个categories。判断这个落在此网格的物体是c个物体中的哪一个物体。输出就是S x S x (5*B+C)的一个tensor。（**注意：class信息是针对每个网格的，confidence信息是针对每个bounding box的。**）\n\n举例说明: 在PASCAL VOC中，图像输入为448x448，取S=7，B=2，一共有20个类别(C=20)。则输出就是7x7x30的一个tensor。*其中30也就是2\\*5+20，整个网络结构如下图所示：\n\n![](https://picture.mulindya.com/yolov1-pic2.png)\n\n在test的时候，每个网格预测的class信息与BBox得到的confidenci信息相乘，就可以得到每个BBox的class-specific confidence score：\n\n{% raw %}\n$$\nPr(Class_i \\vert Object) \\times Pr(Object) \\times IOU^{truth}_{pred} = Pr(Class_i) \\times IOU^{truth}_{pred}\n$$\n{% endraw %}\n\n得到每个box的class-specific confidence score之后，设置阈值，过滤掉得分低的boxes，对保留的boxes进行NMS处理，即可得到最终的检测结果。\n\n> NMS：non-maximum suppression 非极大抑制，其操作即是从集合中找到得分score最高的候选框，与其他候选框计算IOU，删除重合率高的候选框，因为这些候选框和最高score的框“竞争”同一个物体，但是score又不够高，所以是应该被淘汰的。确定了这个最高score的BBOX之后就可以不考虑他了，再继续找寻最高score的候选框，把与他竞争的候选框给pass掉即可，以此类推。\n\n#### 流程\n1. 输入一张图像将其分为7\\*7的网格\n2. 对于每一个网格,预测两个边框；（包括边框的置信度和其对应的类别概率）\n3. 根据预测的7\\*7\\*2的目标窗口，首先通过阈值去除可能性地的窗口，再采用NMS去除冗余的窗口。\n\n### 损失函数\n\n最重要的是设计损失函数，作者使用了sum-squared error loss（https://blog.csdn.net/shengyan5515/article/details/84036734 ）\n\n> 关于YOLO的损失函数，采用sum-squared error整合localization error（bboxes的坐标误差）和classification error，其中classification error包括两部分，一部分是没有包含object的box的confidence loss权值，另一部分则是有包含object的box的confidence loss权值\n\n![](https://picture.mulindya.com/yolov1-pic3.png)\n\n#### 问题：\n\n- 8维的localization error(4*2),和20维的classification error同等重要是不合理的\n- 如果一个网格中没有object(大部分),将这些网格的box对应confidence设置为0，是比较“暴力”的，会让loss特别大，网络不稳定并且不容易收敛。\n\n#### 解决方案：\n\n- 对于坐标预测赋予更大的权重（重视框的位置）\n- 对没有object的confidence loss，赋予小的权重(注意力转移到其他地方)\n\n- 对存在object的box的confidence loss和类别的预测权重正常取1\n\n> 为什么第二项出现了根号呢？\n>\n> 是因为我们的误差度量量反应出大box的小偏差要小于小box。为了逐步解决这个问题，我们预测了边界框的宽度和高度的平⽅根，而不是直接预测宽度和⾼度。因为根号之后曲线越大越平缓。这样对小的box的偏差相对更加敏感。\n\n观察损失函数可以看出：\n\n- 只有在网格中存在object的时候才会对classification error进行计算\n\n- 只有当某个网格的box的和对于的ground truth box是负责回归的，才会对这个box 的位置xywh损失进行计算，确定对应ground truth box就需要将这个box与这个网格中的所有bbox计算IOU，最大的那个ground truth是由这个网络负责预测的。\n\n  激活函数使用的是leak relu，模型是使用预训练的Imagenet。\n\n### 优点\n\n- 快速，pipline简单\n\n- 背景误检率低\n\n- 通用性强，对艺术品中的物体也可以检测，对非自然的图像物体的检测率比一般的DOM，R-CNN都要好很多\n\n### 缺点\n\n- 由于输出层是全连接层，因此在检测时，YOLO训练模型只能支持与训练图像分辨率相同的图像\n- 每个格子可以预测B个Bbox，但是最终只能选择IOU最高的BBox作为物体检测结果，也就是说，一个各自只能最多预测出一个物体；当物体比较小或者分布密集的时候也只能检测出一个。\n- 在loss的求解方程中，大目标和小目标的IOU误差在loss计算上是接近的（即使用了平方根缓解），因此对于小物体的检测准确性不高。\n\n","source":"_posts/deep_learning/yolov1.md","raw":"---\ntitle: YOLOv1\ntags: [深度学习,目标检测,yolo]\ncategories: [深度学习,目标检测]\ndate: 2021-08-21 15:56:11\nmath: true\n---\n\n> YOLO系列是基于深度学习的回归方法。YOLO：you only look once的优点是实时快速目标检测。一直都很想把YOLO系统的学习一下。在此，记录下相关的知识和个人理解。做笔记也算是督促我好好的整理相关内容叭！ok开始！:wink:\n\n> 参考：\n> https://zhuanlan.zhihu.com/p/136382095\n> https://mp.weixin.qq.com/s/df1JaGtnoEY4FQford4UIw\n\n## YOLO 和 Faster R-CNN\n\n两个网络的差异有两个方面：\n\n1. Yolo没有显示求取region proposal的过程，虽然Faster R-CNN中的RPN于Fast R-CNN共享卷积层，但是在模型训练过程中，还是需要反复的训练RPN于Fast R-CNN，也就是说这种方式还是需要”look twice“ ：确定候选框和分类；而Yolo系列只需要”look once“\n\n   > 关于Faster R-CNN的知识后续再填坑.....\n\n2. Yolo将检测统一为一个回归问题。而R-CNN将检测结果分为两个部分进行求解：分类`物体的类别` ， 回归`物体的bounding  box`\n\n## YOLOv1\n\n### 综述\n\n**论文下载：** http://arxiv.org/abs/1506.02640\n\n**代码下载：** https://github.com/pjreddie/darknet\n\n**核心思想**：将整张图作为网络的输入（与Faster-RCNN类似），直接在输出层对BBox的位置和类别进行回归。\n\n### 论文\n\n<details>\n<summary> yolov1 论文：You Only Look Once:Unified, Real-Time Object Detection</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/yolov1.pdf' width=100% height=650></iframe>\n</details>\n\n实现方法：\n\n![](https://picture.mulindya.com/yolov1-pic1.png)\n\n\n- 首先将一幅图像分成S*S个网格（grid cell）,如果某个物体的中心落在这个网格中，那么这个网格就负责预测这个物体。\n\n- 每个网格需要预测B个边界框(BBox)的位置信息和对应的置信度（confidence）;一个BBox对应四个位置信息和一个confidence信息，confidence表示所预测的Box中含有objext的置信度和box的预测情况。\n\n  > 也就是$conf = Pr(object)\\times IOU^{truth}_{pred}$ 如果有object落在其中的grid cell里，那么第一项为1否则取0.\n\n每个bounding box要预测(x, y, w, h)和confidence共5个值，每个网格还要预测一个类别信息，记为C类。则SxS个网格，每个网格要预测B个bounding box还要预测C个categories。判断这个落在此网格的物体是c个物体中的哪一个物体。输出就是S x S x (5*B+C)的一个tensor。（**注意：class信息是针对每个网格的，confidence信息是针对每个bounding box的。**）\n\n举例说明: 在PASCAL VOC中，图像输入为448x448，取S=7，B=2，一共有20个类别(C=20)。则输出就是7x7x30的一个tensor。*其中30也就是2\\*5+20，整个网络结构如下图所示：\n\n![](https://picture.mulindya.com/yolov1-pic2.png)\n\n在test的时候，每个网格预测的class信息与BBox得到的confidenci信息相乘，就可以得到每个BBox的class-specific confidence score：\n\n{% raw %}\n$$\nPr(Class_i \\vert Object) \\times Pr(Object) \\times IOU^{truth}_{pred} = Pr(Class_i) \\times IOU^{truth}_{pred}\n$$\n{% endraw %}\n\n得到每个box的class-specific confidence score之后，设置阈值，过滤掉得分低的boxes，对保留的boxes进行NMS处理，即可得到最终的检测结果。\n\n> NMS：non-maximum suppression 非极大抑制，其操作即是从集合中找到得分score最高的候选框，与其他候选框计算IOU，删除重合率高的候选框，因为这些候选框和最高score的框“竞争”同一个物体，但是score又不够高，所以是应该被淘汰的。确定了这个最高score的BBOX之后就可以不考虑他了，再继续找寻最高score的候选框，把与他竞争的候选框给pass掉即可，以此类推。\n\n#### 流程\n1. 输入一张图像将其分为7\\*7的网格\n2. 对于每一个网格,预测两个边框；（包括边框的置信度和其对应的类别概率）\n3. 根据预测的7\\*7\\*2的目标窗口，首先通过阈值去除可能性地的窗口，再采用NMS去除冗余的窗口。\n\n### 损失函数\n\n最重要的是设计损失函数，作者使用了sum-squared error loss（https://blog.csdn.net/shengyan5515/article/details/84036734 ）\n\n> 关于YOLO的损失函数，采用sum-squared error整合localization error（bboxes的坐标误差）和classification error，其中classification error包括两部分，一部分是没有包含object的box的confidence loss权值，另一部分则是有包含object的box的confidence loss权值\n\n![](https://picture.mulindya.com/yolov1-pic3.png)\n\n#### 问题：\n\n- 8维的localization error(4*2),和20维的classification error同等重要是不合理的\n- 如果一个网格中没有object(大部分),将这些网格的box对应confidence设置为0，是比较“暴力”的，会让loss特别大，网络不稳定并且不容易收敛。\n\n#### 解决方案：\n\n- 对于坐标预测赋予更大的权重（重视框的位置）\n- 对没有object的confidence loss，赋予小的权重(注意力转移到其他地方)\n\n- 对存在object的box的confidence loss和类别的预测权重正常取1\n\n> 为什么第二项出现了根号呢？\n>\n> 是因为我们的误差度量量反应出大box的小偏差要小于小box。为了逐步解决这个问题，我们预测了边界框的宽度和高度的平⽅根，而不是直接预测宽度和⾼度。因为根号之后曲线越大越平缓。这样对小的box的偏差相对更加敏感。\n\n观察损失函数可以看出：\n\n- 只有在网格中存在object的时候才会对classification error进行计算\n\n- 只有当某个网格的box的和对于的ground truth box是负责回归的，才会对这个box 的位置xywh损失进行计算，确定对应ground truth box就需要将这个box与这个网格中的所有bbox计算IOU，最大的那个ground truth是由这个网络负责预测的。\n\n  激活函数使用的是leak relu，模型是使用预训练的Imagenet。\n\n### 优点\n\n- 快速，pipline简单\n\n- 背景误检率低\n\n- 通用性强，对艺术品中的物体也可以检测，对非自然的图像物体的检测率比一般的DOM，R-CNN都要好很多\n\n### 缺点\n\n- 由于输出层是全连接层，因此在检测时，YOLO训练模型只能支持与训练图像分辨率相同的图像\n- 每个格子可以预测B个Bbox，但是最终只能选择IOU最高的BBox作为物体检测结果，也就是说，一个各自只能最多预测出一个物体；当物体比较小或者分布密集的时候也只能检测出一个。\n- 在loss的求解方程中，大目标和小目标的IOU误差在loss计算上是接近的（即使用了平方根缓解），因此对于小物体的检测准确性不高。\n\n","slug":"deep_learning/yolov1","published":1,"updated":"2022-01-18T08:10:17.051Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p079000uast99g0ufuoa","content":"<blockquote>\n<p>YOLO系列是基于深度学习的回归方法。YOLO：you only look once的优点是实时快速目标检测。一直都很想把YOLO系统的学习一下。在此，记录下相关的知识和个人理解。做笔记也算是督促我好好的整理相关内容叭！ok开始！😉</p>\n</blockquote>\n<blockquote>\n<p>参考：<br>\n<a href=\"https://zhuanlan.zhihu.com/p/136382095\">https://zhuanlan.zhihu.com/p/136382095</a><br>\n<a href=\"https://mp.weixin.qq.com/s/df1JaGtnoEY4FQford4UIw\">https://mp.weixin.qq.com/s/df1JaGtnoEY4FQford4UIw</a></p>\n</blockquote>\n<h2 id=\"YOLO-和-Faster-R-CNN\">YOLO 和 Faster R-CNN</h2>\n<p>两个网络的差异有两个方面：</p>\n<ol>\n<li>\n<p>Yolo没有显示求取region proposal的过程，虽然Faster R-CNN中的RPN于Fast R-CNN共享卷积层，但是在模型训练过程中，还是需要反复的训练RPN于Fast R-CNN，也就是说这种方式还是需要”look twice“ ：确定候选框和分类；而Yolo系列只需要”look once“</p>\n<blockquote>\n<p>关于Faster R-CNN的知识后续再填坑…</p>\n</blockquote>\n</li>\n<li>\n<p>Yolo将检测统一为一个回归问题。而R-CNN将检测结果分为两个部分进行求解：分类<code>物体的类别</code> ， 回归<code>物体的bounding  box</code></p>\n</li>\n</ol>\n<h2 id=\"YOLOv1\">YOLOv1</h2>\n<h3 id=\"综述\">综述</h3>\n<p><strong>论文下载：</strong> <a href=\"http://arxiv.org/abs/1506.02640\">http://arxiv.org/abs/1506.02640</a></p>\n<p><strong>代码下载：</strong> <a href=\"https://github.com/pjreddie/darknet\">https://github.com/pjreddie/darknet</a></p>\n<p><strong>核心思想</strong>：将整张图作为网络的输入（与Faster-RCNN类似），直接在输出层对BBox的位置和类别进行回归。</p>\n<h3 id=\"论文\">论文</h3>\n<details>\n<summary> yolov1 论文：You Only Look Once:Unified, Real-Time Object Detection</summary>\n<iframe src=\"/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/yolov1.pdf\" width=\"100%\" height=\"650\"></iframe>\n</details>\n<p>实现方法：</p>\n<p><img src=\"https://picture.mulindya.com/yolov1-pic1.png\" alt=\"\"></p>\n<ul>\n<li>\n<p>首先将一幅图像分成S*S个网格（grid cell）,如果某个物体的中心落在这个网格中，那么这个网格就负责预测这个物体。</p>\n</li>\n<li>\n<p>每个网格需要预测B个边界框(BBox)的位置信息和对应的置信度（confidence）;一个BBox对应四个位置信息和一个confidence信息，confidence表示所预测的Box中含有objext的置信度和box的预测情况。</p>\n<blockquote>\n<p>也就是$conf = Pr(object)\\times IOU^{truth}_{pred}$ 如果有object落在其中的grid cell里，那么第一项为1否则取0.</p>\n</blockquote>\n</li>\n</ul>\n<p>每个bounding box要预测(x, y, w, h)和confidence共5个值，每个网格还要预测一个类别信息，记为C类。则SxS个网格，每个网格要预测B个bounding box还要预测C个categories。判断这个落在此网格的物体是c个物体中的哪一个物体。输出就是S x S x (5*B+C)的一个tensor。（<strong>注意：class信息是针对每个网格的，confidence信息是针对每个bounding box的。</strong>）</p>\n<p>举例说明: 在PASCAL VOC中，图像输入为448x448，取S=7，B=2，一共有20个类别(C=20)。则输出就是7x7x30的一个tensor。*其中30也就是2*5+20，整个网络结构如下图所示：</p>\n<p><img src=\"https://picture.mulindya.com/yolov1-pic2.png\" alt=\"\"></p>\n<p>在test的时候，每个网格预测的class信息与BBox得到的confidenci信息相乘，就可以得到每个BBox的class-specific confidence score：</p>\n\n$$\nPr(Class_i \\vert Object) \\times Pr(Object) \\times IOU^{truth}_{pred} = Pr(Class_i) \\times IOU^{truth}_{pred}\n$$\n\n<p>得到每个box的class-specific confidence score之后，设置阈值，过滤掉得分低的boxes，对保留的boxes进行NMS处理，即可得到最终的检测结果。</p>\n<blockquote>\n<p>NMS：non-maximum suppression 非极大抑制，其操作即是从集合中找到得分score最高的候选框，与其他候选框计算IOU，删除重合率高的候选框，因为这些候选框和最高score的框“竞争”同一个物体，但是score又不够高，所以是应该被淘汰的。确定了这个最高score的BBOX之后就可以不考虑他了，再继续找寻最高score的候选框，把与他竞争的候选框给pass掉即可，以此类推。</p>\n</blockquote>\n<h4 id=\"流程\">流程</h4>\n<ol>\n<li>输入一张图像将其分为7*7的网格</li>\n<li>对于每一个网格,预测两个边框；（包括边框的置信度和其对应的类别概率）</li>\n<li>根据预测的7*7*2的目标窗口，首先通过阈值去除可能性地的窗口，再采用NMS去除冗余的窗口。</li>\n</ol>\n<h3 id=\"损失函数\">损失函数</h3>\n<p>最重要的是设计损失函数，作者使用了sum-squared error loss（<a href=\"https://blog.csdn.net/shengyan5515/article/details/84036734\">https://blog.csdn.net/shengyan5515/article/details/84036734</a> ）</p>\n<blockquote>\n<p>关于YOLO的损失函数，采用sum-squared error整合localization error（bboxes的坐标误差）和classification error，其中classification error包括两部分，一部分是没有包含object的box的confidence loss权值，另一部分则是有包含object的box的confidence loss权值</p>\n</blockquote>\n<p><img src=\"https://picture.mulindya.com/yolov1-pic3.png\" alt=\"\"></p>\n<h4 id=\"问题：\">问题：</h4>\n<ul>\n<li>8维的localization error(4*2),和20维的classification error同等重要是不合理的</li>\n<li>如果一个网格中没有object(大部分),将这些网格的box对应confidence设置为0，是比较“暴力”的，会让loss特别大，网络不稳定并且不容易收敛。</li>\n</ul>\n<h4 id=\"解决方案：\">解决方案：</h4>\n<ul>\n<li>\n<p>对于坐标预测赋予更大的权重（重视框的位置）</p>\n</li>\n<li>\n<p>对没有object的confidence loss，赋予小的权重(注意力转移到其他地方)</p>\n</li>\n<li>\n<p>对存在object的box的confidence loss和类别的预测权重正常取1</p>\n</li>\n</ul>\n<blockquote>\n<p>为什么第二项出现了根号呢？</p>\n<p>是因为我们的误差度量量反应出大box的小偏差要小于小box。为了逐步解决这个问题，我们预测了边界框的宽度和高度的平⽅根，而不是直接预测宽度和⾼度。因为根号之后曲线越大越平缓。这样对小的box的偏差相对更加敏感。</p>\n</blockquote>\n<p>观察损失函数可以看出：</p>\n<ul>\n<li>\n<p>只有在网格中存在object的时候才会对classification error进行计算</p>\n</li>\n<li>\n<p>只有当某个网格的box的和对于的ground truth box是负责回归的，才会对这个box 的位置xywh损失进行计算，确定对应ground truth box就需要将这个box与这个网格中的所有bbox计算IOU，最大的那个ground truth是由这个网络负责预测的。</p>\n<p>激活函数使用的是leak relu，模型是使用预训练的Imagenet。</p>\n</li>\n</ul>\n<h3 id=\"优点\">优点</h3>\n<ul>\n<li>\n<p>快速，pipline简单</p>\n</li>\n<li>\n<p>背景误检率低</p>\n</li>\n<li>\n<p>通用性强，对艺术品中的物体也可以检测，对非自然的图像物体的检测率比一般的DOM，R-CNN都要好很多</p>\n</li>\n</ul>\n<h3 id=\"缺点\">缺点</h3>\n<ul>\n<li>由于输出层是全连接层，因此在检测时，YOLO训练模型只能支持与训练图像分辨率相同的图像</li>\n<li>每个格子可以预测B个Bbox，但是最终只能选择IOU最高的BBox作为物体检测结果，也就是说，一个各自只能最多预测出一个物体；当物体比较小或者分布密集的时候也只能检测出一个。</li>\n<li>在loss的求解方程中，大目标和小目标的IOU误差在loss计算上是接近的（即使用了平方根缓解），因此对于小物体的检测准确性不高。</li>\n</ul>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>YOLO系列是基于深度学习的回归方法。YOLO：you only look once的优点是实时快速目标检测。一直都很想把YOLO系统的学习一下。在此，记录下相关的知识和个人理解。做笔记也算是督促我好好的整理相关内容叭！ok开始！😉</p>\n</blockquote>\n<blockquote>\n<p>参考：<br>\n<a href=\"https://zhuanlan.zhihu.com/p/136382095\">https://zhuanlan.zhihu.com/p/136382095</a><br>\n<a href=\"https://mp.weixin.qq.com/s/df1JaGtnoEY4FQford4UIw\">https://mp.weixin.qq.com/s/df1JaGtnoEY4FQford4UIw</a></p>\n</blockquote>\n<h2 id=\"YOLO-和-Faster-R-CNN\">YOLO 和 Faster R-CNN</h2>\n<p>两个网络的差异有两个方面：</p>\n<ol>\n<li>\n<p>Yolo没有显示求取region proposal的过程，虽然Faster R-CNN中的RPN于Fast R-CNN共享卷积层，但是在模型训练过程中，还是需要反复的训练RPN于Fast R-CNN，也就是说这种方式还是需要”look twice“ ：确定候选框和分类；而Yolo系列只需要”look once“</p>\n<blockquote>\n<p>关于Faster R-CNN的知识后续再填坑…</p>\n</blockquote>\n</li>\n<li>\n<p>Yolo将检测统一为一个回归问题。而R-CNN将检测结果分为两个部分进行求解：分类<code>物体的类别</code> ， 回归<code>物体的bounding  box</code></p>\n</li>\n</ol>\n<h2 id=\"YOLOv1\">YOLOv1</h2>\n<h3 id=\"综述\">综述</h3>\n<p><strong>论文下载：</strong> <a href=\"http://arxiv.org/abs/1506.02640\">http://arxiv.org/abs/1506.02640</a></p>\n<p><strong>代码下载：</strong> <a href=\"https://github.com/pjreddie/darknet\">https://github.com/pjreddie/darknet</a></p>\n<p><strong>核心思想</strong>：将整张图作为网络的输入（与Faster-RCNN类似），直接在输出层对BBox的位置和类别进行回归。</p>\n<h3 id=\"论文\">论文</h3>\n<details>\n<summary> yolov1 论文：You Only Look Once:Unified, Real-Time Object Detection</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/yolov1.pdf' width=100% height=650></iframe>\n</details>\n<p>实现方法：</p>\n<p><img src=\"https://picture.mulindya.com/yolov1-pic1.png\" alt=\"\"></p>\n<ul>\n<li>\n<p>首先将一幅图像分成S*S个网格（grid cell）,如果某个物体的中心落在这个网格中，那么这个网格就负责预测这个物体。</p>\n</li>\n<li>\n<p>每个网格需要预测B个边界框(BBox)的位置信息和对应的置信度（confidence）;一个BBox对应四个位置信息和一个confidence信息，confidence表示所预测的Box中含有objext的置信度和box的预测情况。</p>\n<blockquote>\n<p>也就是$conf = Pr(object)\\times IOU^{truth}_{pred}$ 如果有object落在其中的grid cell里，那么第一项为1否则取0.</p>\n</blockquote>\n</li>\n</ul>\n<p>每个bounding box要预测(x, y, w, h)和confidence共5个值，每个网格还要预测一个类别信息，记为C类。则SxS个网格，每个网格要预测B个bounding box还要预测C个categories。判断这个落在此网格的物体是c个物体中的哪一个物体。输出就是S x S x (5*B+C)的一个tensor。（<strong>注意：class信息是针对每个网格的，confidence信息是针对每个bounding box的。</strong>）</p>\n<p>举例说明: 在PASCAL VOC中，图像输入为448x448，取S=7，B=2，一共有20个类别(C=20)。则输出就是7x7x30的一个tensor。*其中30也就是2*5+20，整个网络结构如下图所示：</p>\n<p><img src=\"https://picture.mulindya.com/yolov1-pic2.png\" alt=\"\"></p>\n<p>在test的时候，每个网格预测的class信息与BBox得到的confidenci信息相乘，就可以得到每个BBox的class-specific confidence score：</p>\n\n$$\nPr(Class_i \\vert Object) \\times Pr(Object) \\times IOU^{truth}_{pred} = Pr(Class_i) \\times IOU^{truth}_{pred}\n$$\n\n<p>得到每个box的class-specific confidence score之后，设置阈值，过滤掉得分低的boxes，对保留的boxes进行NMS处理，即可得到最终的检测结果。</p>\n<blockquote>\n<p>NMS：non-maximum suppression 非极大抑制，其操作即是从集合中找到得分score最高的候选框，与其他候选框计算IOU，删除重合率高的候选框，因为这些候选框和最高score的框“竞争”同一个物体，但是score又不够高，所以是应该被淘汰的。确定了这个最高score的BBOX之后就可以不考虑他了，再继续找寻最高score的候选框，把与他竞争的候选框给pass掉即可，以此类推。</p>\n</blockquote>\n<h4 id=\"流程\">流程</h4>\n<ol>\n<li>输入一张图像将其分为7*7的网格</li>\n<li>对于每一个网格,预测两个边框；（包括边框的置信度和其对应的类别概率）</li>\n<li>根据预测的7*7*2的目标窗口，首先通过阈值去除可能性地的窗口，再采用NMS去除冗余的窗口。</li>\n</ol>\n<h3 id=\"损失函数\">损失函数</h3>\n<p>最重要的是设计损失函数，作者使用了sum-squared error loss（<a href=\"https://blog.csdn.net/shengyan5515/article/details/84036734\">https://blog.csdn.net/shengyan5515/article/details/84036734</a> ）</p>\n<blockquote>\n<p>关于YOLO的损失函数，采用sum-squared error整合localization error（bboxes的坐标误差）和classification error，其中classification error包括两部分，一部分是没有包含object的box的confidence loss权值，另一部分则是有包含object的box的confidence loss权值</p>\n</blockquote>\n<p><img src=\"https://picture.mulindya.com/yolov1-pic3.png\" alt=\"\"></p>\n<h4 id=\"问题：\">问题：</h4>\n<ul>\n<li>8维的localization error(4*2),和20维的classification error同等重要是不合理的</li>\n<li>如果一个网格中没有object(大部分),将这些网格的box对应confidence设置为0，是比较“暴力”的，会让loss特别大，网络不稳定并且不容易收敛。</li>\n</ul>\n<h4 id=\"解决方案：\">解决方案：</h4>\n<ul>\n<li>\n<p>对于坐标预测赋予更大的权重（重视框的位置）</p>\n</li>\n<li>\n<p>对没有object的confidence loss，赋予小的权重(注意力转移到其他地方)</p>\n</li>\n<li>\n<p>对存在object的box的confidence loss和类别的预测权重正常取1</p>\n</li>\n</ul>\n<blockquote>\n<p>为什么第二项出现了根号呢？</p>\n<p>是因为我们的误差度量量反应出大box的小偏差要小于小box。为了逐步解决这个问题，我们预测了边界框的宽度和高度的平⽅根，而不是直接预测宽度和⾼度。因为根号之后曲线越大越平缓。这样对小的box的偏差相对更加敏感。</p>\n</blockquote>\n<p>观察损失函数可以看出：</p>\n<ul>\n<li>\n<p>只有在网格中存在object的时候才会对classification error进行计算</p>\n</li>\n<li>\n<p>只有当某个网格的box的和对于的ground truth box是负责回归的，才会对这个box 的位置xywh损失进行计算，确定对应ground truth box就需要将这个box与这个网格中的所有bbox计算IOU，最大的那个ground truth是由这个网络负责预测的。</p>\n<p>激活函数使用的是leak relu，模型是使用预训练的Imagenet。</p>\n</li>\n</ul>\n<h3 id=\"优点\">优点</h3>\n<ul>\n<li>\n<p>快速，pipline简单</p>\n</li>\n<li>\n<p>背景误检率低</p>\n</li>\n<li>\n<p>通用性强，对艺术品中的物体也可以检测，对非自然的图像物体的检测率比一般的DOM，R-CNN都要好很多</p>\n</li>\n</ul>\n<h3 id=\"缺点\">缺点</h3>\n<ul>\n<li>由于输出层是全连接层，因此在检测时，YOLO训练模型只能支持与训练图像分辨率相同的图像</li>\n<li>每个格子可以预测B个Bbox，但是最终只能选择IOU最高的BBox作为物体检测结果，也就是说，一个各自只能最多预测出一个物体；当物体比较小或者分布密集的时候也只能检测出一个。</li>\n<li>在loss的求解方程中，大目标和小目标的IOU误差在loss计算上是接近的（即使用了平方根缓解），因此对于小物体的检测准确性不高。</li>\n</ul>\n"},{"title":"dvc相关设置","date":"2021-08-10T09:36:32.000Z","_content":"\n>\n\n运行 sh setup.sh detection报错：\n\n> (base) root@9b1a4b217508:/workspace/fanmeilin/project/task/ai_lab# sh setup.sh detection\n> setup.sh: 12: setup.sh: dvc: not found\n> cp: failed to get attributes of 'assets/examples': No such file or directory\n> [*] copy DETECTION skeleton scripts to upper directory\n\n原因是未安装dvc，运行下面的命令安装dvc\n\n```\npip install dvc==2.3.0\npip install 'dvc[s3]'\n```\n\n> 在Win平台下可能会报错：\n>\n> ```\n> ERROR: Cannot uninstall 'ruamel-yaml'. It is a distutils installed project and thus we cannot accurately determine which files belong to it which would lead to only a partial uninstall.\n> ```\n>\n> 此时需要进入python 的lib/site-packages 中删除 ‘ruamel-yaml’ 相关的文件\n\n**注意：** dvc 2.3.0 版本与之后的hash计算方法不同，不能混用\n\n再次执行 sh setup.sh detection报错\n\n> ERROR: unexpected error - Cannot connect to host ceph01:80 ssl:default [Name or service not known]: [Errno -2] Name or service not known  \n\n则修改etc/hosts文件\n\n- 配置hosts文件，在hosts文件中增加以下内容\n  `192.168.10.91 ceph01`\n\n##### *详细dvc的各种操作，可移步* [师兄博客 DVC 使用手册](https://www.zywvvd.com/2020/12/17/dvc/dvc/)\n\n","source":"_posts/dvc/dvc-config.md","raw":"---\ntitle: dvc相关设置\ntags: [dvc]\ncategories: dvc\ndate: 2021-08-10 17:36:32\n---\n\n>\n\n运行 sh setup.sh detection报错：\n\n> (base) root@9b1a4b217508:/workspace/fanmeilin/project/task/ai_lab# sh setup.sh detection\n> setup.sh: 12: setup.sh: dvc: not found\n> cp: failed to get attributes of 'assets/examples': No such file or directory\n> [*] copy DETECTION skeleton scripts to upper directory\n\n原因是未安装dvc，运行下面的命令安装dvc\n\n```\npip install dvc==2.3.0\npip install 'dvc[s3]'\n```\n\n> 在Win平台下可能会报错：\n>\n> ```\n> ERROR: Cannot uninstall 'ruamel-yaml'. It is a distutils installed project and thus we cannot accurately determine which files belong to it which would lead to only a partial uninstall.\n> ```\n>\n> 此时需要进入python 的lib/site-packages 中删除 ‘ruamel-yaml’ 相关的文件\n\n**注意：** dvc 2.3.0 版本与之后的hash计算方法不同，不能混用\n\n再次执行 sh setup.sh detection报错\n\n> ERROR: unexpected error - Cannot connect to host ceph01:80 ssl:default [Name or service not known]: [Errno -2] Name or service not known  \n\n则修改etc/hosts文件\n\n- 配置hosts文件，在hosts文件中增加以下内容\n  `192.168.10.91 ceph01`\n\n##### *详细dvc的各种操作，可移步* [师兄博客 DVC 使用手册](https://www.zywvvd.com/2020/12/17/dvc/dvc/)\n\n","slug":"dvc/dvc-config","published":1,"updated":"2022-01-18T08:10:17.054Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p07c000wast96lfp7xll","content":"<blockquote></blockquote>\n<p>运行 sh <a href=\"http://setup.sh\">setup.sh</a> detection报错：</p>\n<blockquote>\n<p>(base) root@9b1a4b217508:/workspace/fanmeilin/project/task/ai_lab# sh <a href=\"http://setup.sh\">setup.sh</a> detection<br>\n<a href=\"http://setup.sh\">setup.sh</a>: 12: <a href=\"http://setup.sh\">setup.sh</a>: dvc: not found<br>\ncp: failed to get attributes of ‘assets/examples’: No such file or directory<br>\n[*] copy DETECTION skeleton scripts to upper directory</p>\n</blockquote>\n<p>原因是未安装dvc，运行下面的命令安装dvc</p>\n<figure class=\"highlight apache\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">pip</span> install dvc==<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">3</span>.<span class=\"hljs-number\">0</span><br><span class=\"hljs-attribute\">pip</span> install 'dvc[s<span class=\"hljs-number\">3</span>]'<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>在Win平台下可能会报错：</p>\n<figure class=\"highlight subunit\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs subunit\"><span class=\"hljs-keyword\">ERROR: </span>Cannot uninstall 'ruamel-yaml'. It is a distutils installed project and thus we cannot accurately determine which files belong to it which would lead to only a partial uninstall.<br></code></pre></td></tr></tbody></table></figure>\n<p>此时需要进入python 的lib/site-packages 中删除 ‘ruamel-yaml’ 相关的文件</p>\n</blockquote>\n<p><strong>注意：</strong> dvc 2.3.0 版本与之后的hash计算方法不同，不能混用</p>\n<p>再次执行 sh <a href=\"http://setup.sh\">setup.sh</a> detection报错</p>\n<blockquote>\n<p>ERROR: unexpected error - Cannot connect to host ceph01:80 ssl:default [Name or service not known]: [Errno -2] Name or service not known</p>\n</blockquote>\n<p>则修改etc/hosts文件</p>\n<ul>\n<li>配置hosts文件，在hosts文件中增加以下内容<br>\n<code>192.168.10.91 ceph01</code></li>\n</ul>\n<h5 id=\"详细dvc的各种操作，可移步-师兄博客-DVC-使用手册\"><em>详细dvc的各种操作，可移步</em> <a href=\"https://www.zywvvd.com/2020/12/17/dvc/dvc/\">师兄博客 DVC 使用手册</a></h5>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote></blockquote>\n<p>运行 sh <a href=\"http://setup.sh\">setup.sh</a> detection报错：</p>\n<blockquote>\n<p>(base) root@9b1a4b217508:/workspace/fanmeilin/project/task/ai_lab# sh <a href=\"http://setup.sh\">setup.sh</a> detection<br>\n<a href=\"http://setup.sh\">setup.sh</a>: 12: <a href=\"http://setup.sh\">setup.sh</a>: dvc: not found<br>\ncp: failed to get attributes of ‘assets/examples’: No such file or directory<br>\n[*] copy DETECTION skeleton scripts to upper directory</p>\n</blockquote>\n<p>原因是未安装dvc，运行下面的命令安装dvc</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">pip</span> install dvc==<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">3</span>.<span class=\"hljs-number\">0</span><br><span class=\"hljs-attribute\">pip</span> install &#x27;dvc[s<span class=\"hljs-number\">3</span>]&#x27;<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>在Win平台下可能会报错：</p>\n<figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs subunit\"><span class=\"hljs-keyword\">ERROR: </span>Cannot uninstall &#x27;ruamel-yaml&#x27;. It is a distutils installed project and thus we cannot accurately determine which files belong to it which would lead to only a partial uninstall.<br></code></pre></td></tr></table></figure>\n<p>此时需要进入python 的lib/site-packages 中删除 ‘ruamel-yaml’ 相关的文件</p>\n</blockquote>\n<p><strong>注意：</strong> dvc 2.3.0 版本与之后的hash计算方法不同，不能混用</p>\n<p>再次执行 sh <a href=\"http://setup.sh\">setup.sh</a> detection报错</p>\n<blockquote>\n<p>ERROR: unexpected error - Cannot connect to host ceph01:80 ssl:default [Name or service not known]: [Errno -2] Name or service not known</p>\n</blockquote>\n<p>则修改etc/hosts文件</p>\n<ul>\n<li>配置hosts文件，在hosts文件中增加以下内容<br>\n<code>192.168.10.91 ceph01</code></li>\n</ul>\n<h5 id=\"详细dvc的各种操作，可移步-师兄博客-DVC-使用手册\"><em>详细dvc的各种操作，可移步</em> <a href=\"https://www.zywvvd.com/2020/12/17/dvc/dvc/\">师兄博客 DVC 使用手册</a></h5>\n"},{"title":"YOLOv2","date":"2021-08-27T02:57:37.000Z","math":true,"_content":"\n## YOLOv2\n\n### 综述\n\n**论文地址**：https://arxiv.org/abs/1612.08242\n\nYolov2与Yolov1在保持速度的基础上，对预测效果的准确度，耗费时间，鲁棒性三个方面进行了改进，检测能力提高到9000种不同对象。文章提出了一种新的**训练方法--联合训练**方法。这种算法可以将两种数据集混合到一起，使用一种分层的观点进行分类，用大型的分类数据集扩充检测的数据集。也成为YOLO9000.\n\n联合训练的思路：**在检测数据集和分类数据集上训练物体检测器（Object Detectors），用检测数据集学习物体的准确位置，用分类数据集来增加分类的类别两。提升健壮性。**\n\nYolo9000就是使用联合训练的算法，拥有来自于Imagenet的9000种分类信息，物体检测的部分来自于CoCo的检测数据集。\n\n### 论文\n\n\n<details>\n<summary> yolov2 论文：YOLO9000: Better, Faster, Stronger</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/YOLOv2.pdf' width=100% height=650></iframe>\n</details>\n\n\n### 改进点\n\n#### BN(batch normalization) 批量归一化\n\nBN层有助于解决反向传播过程的**梯度消失和梯度爆炸**的问题，**降低**对超参数的**敏感性**，同时对batch归一化时，起到了一定的**正则化**的效果（去掉的dropout层）。通常，在网络的线性变换与激活函数之前增加一个BN层，BN层可以将其特征量归一化使得变换后的特征均值为0，方差为1，从而每一批训练样本都有类似的分布。同时还有修正的参数$\\gamma,\\beta$可以恢复原有信息。实验结果mAP提升2.4%\n\n一般的归一化公式：\n\n{% raw %}\n$$\n\\widehat x^{(k)} = \\frac{x^{(k)}-E[x^{(k)}]}{\\sqrt {Var[x^{(k)}]}} \\\\\n$$\n{% endraw %}\n\n![](https://picture.mulindya.com/yolov2-pic1.png)\n\n#### High resolution classifier（高分辨率图像分类器）\n\n由于对象检测的样本相对图像分类的训练样本要少得多，在对象检测时模型通常时先用图像分类的样本训练卷积层提取图像特征（训练backbone）。但是图像分类样本的分辨率不高，比如在yolov1中，训练集是224\\*224的图片来训练卷积层，但是在训练对象检测的模型使用的是448\\*448的图片，这样的切换对模型性能有一定影响。所以Yolo2在采用**224\\*224图像分类模型预训练之后再采用448\\*448的高分辨率样本对分类模型进行微调**(10个epoch)，这样再训练对象检测模型之前，网络特征就逐渐适应448\\*448的分辨率，然后再使用448\\*448的检测样本进行对象检测模型的训练，以缓解了分辨率突然切换造成的影响。通过这种方式，mAP提升了3.7%。\n\n#### Convolution with anchor boxes(使用先验框)\n\nYolov1是使用全连接层直接预测BBox的坐标值（每个grid预测k个Bbox），Faster R-CNN的方法是只用卷积层和region proposal network来预测锚框的偏移度和置信度。但是作者发现采用Faster R-CNN的方法比Yolov1的方法更加简便，让神经网络学习起来更加容易。\n\n因此，Yolov2也尝试了先验框（anchor），在每个grid预先设定一组不同大小不同宽高比的边框，来覆盖整个图像的不同位置和多种尺度，这些先验框作为预定义的候选区检测框内是否有目标，以及微调边框的位置。之前yolov1并没有采用先验框，并且每个grid只预测两个bounding box，整个图像有98个，yolov2入轨每个grid采用9个先验框，收缩网络运行在416\\*416的图片，一个grid有32像素，那么总共有13\\*13\\*9=1521个先验框，最终去掉了全连接层，采用anchor boxes来预测bounding boxes。由于图片中的物体都倾向于出现在图片的中心位置，特别是那种比较大的物体，所以有一个单独位于物体中心的位置用于预测这些物体。YOLO的卷积层采用32这个值来下采样图片，所以通过选择416\\*416用作输入尺寸最终能输出一个13\\*13的Feature Map。使用Anchor Box会让精确度稍微下降，但用了它能让YOLO能预测出大于一千个框，同时recall达到88%，mAP达到69.2%。\n\n#### Dimension clusters（聚类提取先验框的尺度信息）\n\n之前Anchor Box的尺寸是手动选择的，所以尺寸还有优化的余地。YOLO2尝试统计出更符合样本中对象尺寸的先验框，这样就可以减少网络微调先验框到实际位置的难度。YOLO2的做法是对训练集中标注的边框进行K-mean聚类分析，以寻找尽可能匹配样本的边框尺寸。\n\n在使用Kmeans聚类分析时，并不是直接采用的欧氏距离度量，因为这样大边框的距离会相对小边框大，这样误差就很大，因此我们采用IOU的形式。\n$$\nd(box,centroid) = 1-IOU(box,centroid)\n$$\ncentroid是聚类时被选作中心的边框，box就是其它边框，d就是两者间的“距离”。IOU越大，“距离”越近。YOLO2给出的聚类分析结果如下图所示：\n\n![](https://picture.mulindya.com/yolov2-pic2.png)\n\n通过分析实验结果，在model复杂性与high recall之间权衡之后，选择聚类分类数K=5。\n\n![](https://picture.mulindya.com/yolov2-pic3.png)\n\n说明用K-means选择Anchor Boxes时，选择值为5时，AVG IOU的值是61，这个值要比不用聚类的方法的60.9要高。选择值为9的时候，AVG IOU更有显著提高。总之就是说明用聚类的方法是有效果的。\n\n#### Direct location prediction（约束预测边框的位置）\n\n借鉴于Faster RCNN的先验框方法，在训练的早期阶段，其位置预测容易不稳定。其位置预测公式为：\n\n{% raw %}\n$$\nx = (t_x*w_a)+x_a \\\\\ny = (t_y*h_a)+y_a\n$$\n{% endraw %}\n\n其中， 是预测边框的中心， $x_a,y_a$是先验框（anchor）的中心点坐标， $w_a,h_a$是先验框（anchor）的宽和高，$t_x,t_y$ 是要学习的参数。注意，YOLO论文中写的是$x = (t_x*w_a)-x_a$ ，根据Faster RCNN，应该是\"+\"。\n\n但是$t_x,t_y$ 不加约束的这种方式，会导致预测边框中心会出现在任意位置，因此在早期训练阶段不稳定，文章将边框的中心约束在grid网格当中。\n\n![](https://picture.mulindya.com/yolov2-pic4.png)\n\n其中， $b_x,b_y,b_w,b_h$是预测边框的中心和宽高。 $Pr(object)*IOU(b,object)$是预测边框的置信度，在YOLO1是直接预测置信度的值，这里对预测参数$t_o$进行σ变换后作为置信度的值。 $c_x,c_y$是当前网格左上角到图像左上角的距离，要先将网格大小归一化，即令一个网格的宽=1，高=1。 $p_w,p_h$是先验框的宽和高($t_w,t_h$会对初始的设置进行调整)。σ是sigmoid函数。 $t_x,t_y,t_w,t_h,t_o$是要学习的参数($t_o$也可以学习的嘛，学到某种规律用以表示置信度:question:)，分别用于预测边框的中心和宽高，以及置信度。\n\n![](https://picture.mulindya.com/yolov2-pic5.png)\n\n这种方式可以让数值更幅度稳定，也让网络更容易学习。\n\n#### Fine-Grained Features(passthrough层检测细粒度特征)\n\n对象检测面临一个问题：即目标检测的对象有大有小，输入图像经过多层网络提取特征，最后输出的特征图中（比如YOLO2中输入416*416经过卷积网络下采样最后输出是13*13），较小的对象可能特征已经不明显甚至被忽略掉了。为了更好的检测出一些比较小的对象，最后输出的特征图需要保留一些更细节的信息。\n\nYOLO2引入一种称为passthrough层的方法在特征图中保留一些细节信息。具体来说，就是在最后一个pooling之前，特征图的大小是26\\*26\\*512，将其1拆4，直接传递（passthrough）到pooling后（并且又经过一组卷积）的特征图，两者叠加到一起作为输出的特征图。\n![](https://picture.mulindya.com/yolov2-pic11.png)\n\n具体怎样1拆4，下面借用一副图看的很清楚。图中示例的是1个4\\*4拆成4个2\\*2。另外，根据YOLO2的代码，特征图先用1\\*1卷积从 26\\*26\\*512 降维到 26\\*26\\*64，再做1拆4并passthrough。\n\n```python\nut = tf.extract_image_patches(in, [1, stride, stride, 1], [1, stride, stride, 1], [1,1,1,1], padding=\"VALID\")\n# or use tf.space_to_depth\n# out = tf.space_to_depth(in, 2)\n```\n\n```python\ntf.extract_image_patches(\n    images,\n    ksizes,\n    strides,\n    rates,\n    padding,\n    name=None\n)\n#images：必须是shape为[batch, in_rows, in_cols, depth]的tensor；\n#ksize：长度大于等于4的list，滑动窗的大小\n#strides:每块patch区域之间中心点之间的距离，必须是: [1, stride_rows, stride_cols, 1].\n    #具体点说就是用来计算每次选取patch的初始点位置\n#rates: 在每次提取的patch中，对应dim像素点位置之间的差距，必须是[1, rate_rows, rate_cols, 1]；「或者理解为 提取出来的每个框里面的像素不是都选择的 根据rate的不同 隔几个选一个 默认是1也就是的都选择 若为2 那么就是隔一个来选择」\n#padding:有两个取值，“VALID”或者“SAME”，“VALID”表示所取的patch区域必须完全包含在原始图像中.\"SAME\"表示可以取超出原始图像的部分，这一部分进行0填充。\n```\n\n#### Multi-scale Training（多尺度图像训练）\n\n作者希望YOLOv2能健壮的运行于不同尺寸的图片之上，所以把这一想法用于训练model中。\n\n区别于之前的补全图片的尺寸的方法，YOLOv2每迭代几次都会改变网络参数。每10个Batch，网络会**随机地选择一个新的图片尺寸**，由于使用了下采样参数是32，所以不同的尺寸大小也选择为32的倍数{320，352…..608}，最小320\\*320，最大608\\*608，网络会自动改变尺寸，并继续训练的过程。\n\n这一方法让网络在不同的输入尺寸上都能达到一个很好的预测效果，同一网络能在不同分辨率上进行检测。当输入图片尺寸比较小的精度高，输入图片尺寸比较大的时候精度相对低，所以你可以在YOLOv2的速度和精度上进行权衡。\n<center class=\"half\">\n<img src = \"https://picture.mulindya.com/yolov2-pic6.png\">\n<img src = \"https://picture.mulindya.com/yolov2-pic7.png\">\n</center>\n\n\n#### hi-res-detect(高分辨率图像的对象检测)\n\n上面左图表格中最后一行是使用高分辨l率的图像hi-res detector，因为YOLO2调整网络结构后能够支持多种尺寸的输入图像。通常是使用416\\*416的输入图像，如果用较高分辨率的输入图像，比如544\\*544，则mAP可以达到78.6，有1.8的提升。\n\n#### Hierarchical classification(分层分类)\n\n作者提出了一种在分类数据集和检测数据集上联合训练的机制。使用检测数据集的图片去学习检测相关的信息，例如bounding box 坐标预测，是否包含物体以及属于各个物体的概率。使用仅有类别标签的分类数据集图片去扩展可以检测的种类。作者通过ImageNet训练分类、COCO和VOC数据集来训练检测，这是一个很有价值的思路，可以让我们达到比较优的效果。通过将两个数据集混合训练，**如果遇到来自分类集的图片则只计算分类的Loss，遇到来自检测集的图片则计算完整的Loss**。\n\n但是ImageNet对应分类有9000种，而COCO则只提供80种目标检测，作者使用multi-label模型，即假定一张图片可以有多个label，并且不要求label间独立。因为作者选择在COCO和ImageNet数据集上进行联合训练，遇到的第一问题是两者的类别并不是完全互斥的，比如\"Norfolk terrier\"明显属于\"dog\"，所以作者提出了一种层级分类方法（Hierarchical classification），主要思路是根据各个类别之间的从属关系（根据WordNet）建立一种树结构WordTree，结合COCO和ImageNet建立的WordTree如下图所示：\n\n![](https://picture.mulindya.com/yolov2-pic8.png)\n\n1. 遍历Imagenet的label，然后在WordNet中寻找该label到根节点(指向一个物理对象)的路径；\n2. 如果路径只有一条，那么就将该路径直接加入到分层树结构中；\n3. 否则，从剩余的路径中选择一条最短路径，加入到分层树。\n\n这个分层树我们称之为 WordTree，作用就在于将两种数据集按照层级进行结合。(感觉就是为了扩充数据集同时简便计算)\n\n分类时的概率计算借用了**决策树思想**，**某个节点的概率值等于该节点到根节点的所有条件概率之积**。最终结果是一颗 WordTree （视觉名词组成的层次结构模型）。用WordTree执行分类时，预测每个节点的条件概率。如果想求得特定节点的绝对概率，只需要沿着路径做连续乘积。例如，如果想知道一张图片是不是“Norfolk terrier ”需要计算：\n\n![](https://picture.mulindya.com/yolov2-pic10.png)\n\n另外，为了验证这种方法作者在WordTree（用1000类别的ImageNet创建）上训练了Darknet-19模型。为了创建WordTree1k，作者添加了很多中间节点，把label由1000扩展到1369。训练过程中ground truth标签要顺着向根节点的路径传播。例如，如果一张图片被标记为“Norfolk terrier”，它也被标记为“dog” 和“mammal”等。为了计算条件概率，模型预测了一个包含1369个元素的向量，而且基于所有“同义词集”计算softmax。\n\nsoftmax操作也同时应该采用分组操作，下图上半部分为ImageNet对应的原生Softmax，下半部分对应基于WordTree的Softmax：\n\n![](https://picture.mulindya.com/yolov2-pic9.png)\n\n通过上述方案构造WordTree，得到对应9418个分类，通过重采样保证Imagenet和COCO的样本数据比例为4:1。\n\n### 总结\n\n通过联合训练策略，YOLO9000可以快速检测出超过9000个类别的物体，总体mAP值为19,7%。我觉得这是作者在这篇论文作出的最大的贡献，因为YOLOv2的改进策略亮点并不是很突出，但是YOLO9000算是开创之举。\n","source":"_posts/deep_learning/yolov2.md","raw":"---\ntitle: YOLOv2\ntags: [深度学习,目标检测,yolo]\ncategories: [深度学习,目标检测]\ndate: 2021-08-27 10:57:37\nmath: true\n---\n\n## YOLOv2\n\n### 综述\n\n**论文地址**：https://arxiv.org/abs/1612.08242\n\nYolov2与Yolov1在保持速度的基础上，对预测效果的准确度，耗费时间，鲁棒性三个方面进行了改进，检测能力提高到9000种不同对象。文章提出了一种新的**训练方法--联合训练**方法。这种算法可以将两种数据集混合到一起，使用一种分层的观点进行分类，用大型的分类数据集扩充检测的数据集。也成为YOLO9000.\n\n联合训练的思路：**在检测数据集和分类数据集上训练物体检测器（Object Detectors），用检测数据集学习物体的准确位置，用分类数据集来增加分类的类别两。提升健壮性。**\n\nYolo9000就是使用联合训练的算法，拥有来自于Imagenet的9000种分类信息，物体检测的部分来自于CoCo的检测数据集。\n\n### 论文\n\n\n<details>\n<summary> yolov2 论文：YOLO9000: Better, Faster, Stronger</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/YOLOv2.pdf' width=100% height=650></iframe>\n</details>\n\n\n### 改进点\n\n#### BN(batch normalization) 批量归一化\n\nBN层有助于解决反向传播过程的**梯度消失和梯度爆炸**的问题，**降低**对超参数的**敏感性**，同时对batch归一化时，起到了一定的**正则化**的效果（去掉的dropout层）。通常，在网络的线性变换与激活函数之前增加一个BN层，BN层可以将其特征量归一化使得变换后的特征均值为0，方差为1，从而每一批训练样本都有类似的分布。同时还有修正的参数$\\gamma,\\beta$可以恢复原有信息。实验结果mAP提升2.4%\n\n一般的归一化公式：\n\n{% raw %}\n$$\n\\widehat x^{(k)} = \\frac{x^{(k)}-E[x^{(k)}]}{\\sqrt {Var[x^{(k)}]}} \\\\\n$$\n{% endraw %}\n\n![](https://picture.mulindya.com/yolov2-pic1.png)\n\n#### High resolution classifier（高分辨率图像分类器）\n\n由于对象检测的样本相对图像分类的训练样本要少得多，在对象检测时模型通常时先用图像分类的样本训练卷积层提取图像特征（训练backbone）。但是图像分类样本的分辨率不高，比如在yolov1中，训练集是224\\*224的图片来训练卷积层，但是在训练对象检测的模型使用的是448\\*448的图片，这样的切换对模型性能有一定影响。所以Yolo2在采用**224\\*224图像分类模型预训练之后再采用448\\*448的高分辨率样本对分类模型进行微调**(10个epoch)，这样再训练对象检测模型之前，网络特征就逐渐适应448\\*448的分辨率，然后再使用448\\*448的检测样本进行对象检测模型的训练，以缓解了分辨率突然切换造成的影响。通过这种方式，mAP提升了3.7%。\n\n#### Convolution with anchor boxes(使用先验框)\n\nYolov1是使用全连接层直接预测BBox的坐标值（每个grid预测k个Bbox），Faster R-CNN的方法是只用卷积层和region proposal network来预测锚框的偏移度和置信度。但是作者发现采用Faster R-CNN的方法比Yolov1的方法更加简便，让神经网络学习起来更加容易。\n\n因此，Yolov2也尝试了先验框（anchor），在每个grid预先设定一组不同大小不同宽高比的边框，来覆盖整个图像的不同位置和多种尺度，这些先验框作为预定义的候选区检测框内是否有目标，以及微调边框的位置。之前yolov1并没有采用先验框，并且每个grid只预测两个bounding box，整个图像有98个，yolov2入轨每个grid采用9个先验框，收缩网络运行在416\\*416的图片，一个grid有32像素，那么总共有13\\*13\\*9=1521个先验框，最终去掉了全连接层，采用anchor boxes来预测bounding boxes。由于图片中的物体都倾向于出现在图片的中心位置，特别是那种比较大的物体，所以有一个单独位于物体中心的位置用于预测这些物体。YOLO的卷积层采用32这个值来下采样图片，所以通过选择416\\*416用作输入尺寸最终能输出一个13\\*13的Feature Map。使用Anchor Box会让精确度稍微下降，但用了它能让YOLO能预测出大于一千个框，同时recall达到88%，mAP达到69.2%。\n\n#### Dimension clusters（聚类提取先验框的尺度信息）\n\n之前Anchor Box的尺寸是手动选择的，所以尺寸还有优化的余地。YOLO2尝试统计出更符合样本中对象尺寸的先验框，这样就可以减少网络微调先验框到实际位置的难度。YOLO2的做法是对训练集中标注的边框进行K-mean聚类分析，以寻找尽可能匹配样本的边框尺寸。\n\n在使用Kmeans聚类分析时，并不是直接采用的欧氏距离度量，因为这样大边框的距离会相对小边框大，这样误差就很大，因此我们采用IOU的形式。\n$$\nd(box,centroid) = 1-IOU(box,centroid)\n$$\ncentroid是聚类时被选作中心的边框，box就是其它边框，d就是两者间的“距离”。IOU越大，“距离”越近。YOLO2给出的聚类分析结果如下图所示：\n\n![](https://picture.mulindya.com/yolov2-pic2.png)\n\n通过分析实验结果，在model复杂性与high recall之间权衡之后，选择聚类分类数K=5。\n\n![](https://picture.mulindya.com/yolov2-pic3.png)\n\n说明用K-means选择Anchor Boxes时，选择值为5时，AVG IOU的值是61，这个值要比不用聚类的方法的60.9要高。选择值为9的时候，AVG IOU更有显著提高。总之就是说明用聚类的方法是有效果的。\n\n#### Direct location prediction（约束预测边框的位置）\n\n借鉴于Faster RCNN的先验框方法，在训练的早期阶段，其位置预测容易不稳定。其位置预测公式为：\n\n{% raw %}\n$$\nx = (t_x*w_a)+x_a \\\\\ny = (t_y*h_a)+y_a\n$$\n{% endraw %}\n\n其中， 是预测边框的中心， $x_a,y_a$是先验框（anchor）的中心点坐标， $w_a,h_a$是先验框（anchor）的宽和高，$t_x,t_y$ 是要学习的参数。注意，YOLO论文中写的是$x = (t_x*w_a)-x_a$ ，根据Faster RCNN，应该是\"+\"。\n\n但是$t_x,t_y$ 不加约束的这种方式，会导致预测边框中心会出现在任意位置，因此在早期训练阶段不稳定，文章将边框的中心约束在grid网格当中。\n\n![](https://picture.mulindya.com/yolov2-pic4.png)\n\n其中， $b_x,b_y,b_w,b_h$是预测边框的中心和宽高。 $Pr(object)*IOU(b,object)$是预测边框的置信度，在YOLO1是直接预测置信度的值，这里对预测参数$t_o$进行σ变换后作为置信度的值。 $c_x,c_y$是当前网格左上角到图像左上角的距离，要先将网格大小归一化，即令一个网格的宽=1，高=1。 $p_w,p_h$是先验框的宽和高($t_w,t_h$会对初始的设置进行调整)。σ是sigmoid函数。 $t_x,t_y,t_w,t_h,t_o$是要学习的参数($t_o$也可以学习的嘛，学到某种规律用以表示置信度:question:)，分别用于预测边框的中心和宽高，以及置信度。\n\n![](https://picture.mulindya.com/yolov2-pic5.png)\n\n这种方式可以让数值更幅度稳定，也让网络更容易学习。\n\n#### Fine-Grained Features(passthrough层检测细粒度特征)\n\n对象检测面临一个问题：即目标检测的对象有大有小，输入图像经过多层网络提取特征，最后输出的特征图中（比如YOLO2中输入416*416经过卷积网络下采样最后输出是13*13），较小的对象可能特征已经不明显甚至被忽略掉了。为了更好的检测出一些比较小的对象，最后输出的特征图需要保留一些更细节的信息。\n\nYOLO2引入一种称为passthrough层的方法在特征图中保留一些细节信息。具体来说，就是在最后一个pooling之前，特征图的大小是26\\*26\\*512，将其1拆4，直接传递（passthrough）到pooling后（并且又经过一组卷积）的特征图，两者叠加到一起作为输出的特征图。\n![](https://picture.mulindya.com/yolov2-pic11.png)\n\n具体怎样1拆4，下面借用一副图看的很清楚。图中示例的是1个4\\*4拆成4个2\\*2。另外，根据YOLO2的代码，特征图先用1\\*1卷积从 26\\*26\\*512 降维到 26\\*26\\*64，再做1拆4并passthrough。\n\n```python\nut = tf.extract_image_patches(in, [1, stride, stride, 1], [1, stride, stride, 1], [1,1,1,1], padding=\"VALID\")\n# or use tf.space_to_depth\n# out = tf.space_to_depth(in, 2)\n```\n\n```python\ntf.extract_image_patches(\n    images,\n    ksizes,\n    strides,\n    rates,\n    padding,\n    name=None\n)\n#images：必须是shape为[batch, in_rows, in_cols, depth]的tensor；\n#ksize：长度大于等于4的list，滑动窗的大小\n#strides:每块patch区域之间中心点之间的距离，必须是: [1, stride_rows, stride_cols, 1].\n    #具体点说就是用来计算每次选取patch的初始点位置\n#rates: 在每次提取的patch中，对应dim像素点位置之间的差距，必须是[1, rate_rows, rate_cols, 1]；「或者理解为 提取出来的每个框里面的像素不是都选择的 根据rate的不同 隔几个选一个 默认是1也就是的都选择 若为2 那么就是隔一个来选择」\n#padding:有两个取值，“VALID”或者“SAME”，“VALID”表示所取的patch区域必须完全包含在原始图像中.\"SAME\"表示可以取超出原始图像的部分，这一部分进行0填充。\n```\n\n#### Multi-scale Training（多尺度图像训练）\n\n作者希望YOLOv2能健壮的运行于不同尺寸的图片之上，所以把这一想法用于训练model中。\n\n区别于之前的补全图片的尺寸的方法，YOLOv2每迭代几次都会改变网络参数。每10个Batch，网络会**随机地选择一个新的图片尺寸**，由于使用了下采样参数是32，所以不同的尺寸大小也选择为32的倍数{320，352…..608}，最小320\\*320，最大608\\*608，网络会自动改变尺寸，并继续训练的过程。\n\n这一方法让网络在不同的输入尺寸上都能达到一个很好的预测效果，同一网络能在不同分辨率上进行检测。当输入图片尺寸比较小的精度高，输入图片尺寸比较大的时候精度相对低，所以你可以在YOLOv2的速度和精度上进行权衡。\n<center class=\"half\">\n<img src = \"https://picture.mulindya.com/yolov2-pic6.png\">\n<img src = \"https://picture.mulindya.com/yolov2-pic7.png\">\n</center>\n\n\n#### hi-res-detect(高分辨率图像的对象检测)\n\n上面左图表格中最后一行是使用高分辨l率的图像hi-res detector，因为YOLO2调整网络结构后能够支持多种尺寸的输入图像。通常是使用416\\*416的输入图像，如果用较高分辨率的输入图像，比如544\\*544，则mAP可以达到78.6，有1.8的提升。\n\n#### Hierarchical classification(分层分类)\n\n作者提出了一种在分类数据集和检测数据集上联合训练的机制。使用检测数据集的图片去学习检测相关的信息，例如bounding box 坐标预测，是否包含物体以及属于各个物体的概率。使用仅有类别标签的分类数据集图片去扩展可以检测的种类。作者通过ImageNet训练分类、COCO和VOC数据集来训练检测，这是一个很有价值的思路，可以让我们达到比较优的效果。通过将两个数据集混合训练，**如果遇到来自分类集的图片则只计算分类的Loss，遇到来自检测集的图片则计算完整的Loss**。\n\n但是ImageNet对应分类有9000种，而COCO则只提供80种目标检测，作者使用multi-label模型，即假定一张图片可以有多个label，并且不要求label间独立。因为作者选择在COCO和ImageNet数据集上进行联合训练，遇到的第一问题是两者的类别并不是完全互斥的，比如\"Norfolk terrier\"明显属于\"dog\"，所以作者提出了一种层级分类方法（Hierarchical classification），主要思路是根据各个类别之间的从属关系（根据WordNet）建立一种树结构WordTree，结合COCO和ImageNet建立的WordTree如下图所示：\n\n![](https://picture.mulindya.com/yolov2-pic8.png)\n\n1. 遍历Imagenet的label，然后在WordNet中寻找该label到根节点(指向一个物理对象)的路径；\n2. 如果路径只有一条，那么就将该路径直接加入到分层树结构中；\n3. 否则，从剩余的路径中选择一条最短路径，加入到分层树。\n\n这个分层树我们称之为 WordTree，作用就在于将两种数据集按照层级进行结合。(感觉就是为了扩充数据集同时简便计算)\n\n分类时的概率计算借用了**决策树思想**，**某个节点的概率值等于该节点到根节点的所有条件概率之积**。最终结果是一颗 WordTree （视觉名词组成的层次结构模型）。用WordTree执行分类时，预测每个节点的条件概率。如果想求得特定节点的绝对概率，只需要沿着路径做连续乘积。例如，如果想知道一张图片是不是“Norfolk terrier ”需要计算：\n\n![](https://picture.mulindya.com/yolov2-pic10.png)\n\n另外，为了验证这种方法作者在WordTree（用1000类别的ImageNet创建）上训练了Darknet-19模型。为了创建WordTree1k，作者添加了很多中间节点，把label由1000扩展到1369。训练过程中ground truth标签要顺着向根节点的路径传播。例如，如果一张图片被标记为“Norfolk terrier”，它也被标记为“dog” 和“mammal”等。为了计算条件概率，模型预测了一个包含1369个元素的向量，而且基于所有“同义词集”计算softmax。\n\nsoftmax操作也同时应该采用分组操作，下图上半部分为ImageNet对应的原生Softmax，下半部分对应基于WordTree的Softmax：\n\n![](https://picture.mulindya.com/yolov2-pic9.png)\n\n通过上述方案构造WordTree，得到对应9418个分类，通过重采样保证Imagenet和COCO的样本数据比例为4:1。\n\n### 总结\n\n通过联合训练策略，YOLO9000可以快速检测出超过9000个类别的物体，总体mAP值为19,7%。我觉得这是作者在这篇论文作出的最大的贡献，因为YOLOv2的改进策略亮点并不是很突出，但是YOLO9000算是开创之举。\n","slug":"deep_learning/yolov2","published":1,"updated":"2022-01-18T08:10:17.052Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p07f0010ast98rwj58mf","content":"<h2 id=\"YOLOv2\">YOLOv2</h2>\n<h3 id=\"综述\">综述</h3>\n<p><strong>论文地址</strong>：<a href=\"https://arxiv.org/abs/1612.08242\">https://arxiv.org/abs/1612.08242</a></p>\n<p>Yolov2与Yolov1在保持速度的基础上，对预测效果的准确度，耗费时间，鲁棒性三个方面进行了改进，检测能力提高到9000种不同对象。文章提出了一种新的<strong>训练方法–联合训练</strong>方法。这种算法可以将两种数据集混合到一起，使用一种分层的观点进行分类，用大型的分类数据集扩充检测的数据集。也成为YOLO9000.</p>\n<p>联合训练的思路：<strong>在检测数据集和分类数据集上训练物体检测器（Object Detectors），用检测数据集学习物体的准确位置，用分类数据集来增加分类的类别两。提升健壮性。</strong></p>\n<p>Yolo9000就是使用联合训练的算法，拥有来自于Imagenet的9000种分类信息，物体检测的部分来自于CoCo的检测数据集。</p>\n<h3 id=\"论文\">论文</h3>\n<details>\n<summary> yolov2 论文：YOLO9000: Better, Faster, Stronger</summary>\n<iframe src=\"/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/YOLOv2.pdf\" width=\"100%\" height=\"650\"></iframe>\n</details>\n<h3 id=\"改进点\">改进点</h3>\n<h4 id=\"BN-batch-normalization-批量归一化\">BN(batch normalization) 批量归一化</h4>\n<p>BN层有助于解决反向传播过程的<strong>梯度消失和梯度爆炸</strong>的问题，<strong>降低</strong>对超参数的<strong>敏感性</strong>，同时对batch归一化时，起到了一定的<strong>正则化</strong>的效果（去掉的dropout层）。通常，在网络的线性变换与激活函数之前增加一个BN层，BN层可以将其特征量归一化使得变换后的特征均值为0，方差为1，从而每一批训练样本都有类似的分布。同时还有修正的参数$\\gamma,\\beta$可以恢复原有信息。实验结果mAP提升2.4%</p>\n<p>一般的归一化公式：</p>\n\n$$\n\\widehat x^{(k)} = \\frac{x^{(k)}-E[x^{(k)}]}{\\sqrt {Var[x^{(k)}]}} \\\\\n$$\n\n<p><img src=\"https://picture.mulindya.com/yolov2-pic1.png\" alt=\"\"></p>\n<h4 id=\"High-resolution-classifier（高分辨率图像分类器）\">High resolution classifier（高分辨率图像分类器）</h4>\n<p>由于对象检测的样本相对图像分类的训练样本要少得多，在对象检测时模型通常时先用图像分类的样本训练卷积层提取图像特征（训练backbone）。但是图像分类样本的分辨率不高，比如在yolov1中，训练集是224*224的图片来训练卷积层，但是在训练对象检测的模型使用的是448*448的图片，这样的切换对模型性能有一定影响。所以Yolo2在采用<strong>224*224图像分类模型预训练之后再采用448*448的高分辨率样本对分类模型进行微调</strong>(10个epoch)，这样再训练对象检测模型之前，网络特征就逐渐适应448*448的分辨率，然后再使用448*448的检测样本进行对象检测模型的训练，以缓解了分辨率突然切换造成的影响。通过这种方式，mAP提升了3.7%。</p>\n<h4 id=\"Convolution-with-anchor-boxes-使用先验框\">Convolution with anchor boxes(使用先验框)</h4>\n<p>Yolov1是使用全连接层直接预测BBox的坐标值（每个grid预测k个Bbox），Faster R-CNN的方法是只用卷积层和region proposal network来预测锚框的偏移度和置信度。但是作者发现采用Faster R-CNN的方法比Yolov1的方法更加简便，让神经网络学习起来更加容易。</p>\n<p>因此，Yolov2也尝试了先验框（anchor），在每个grid预先设定一组不同大小不同宽高比的边框，来覆盖整个图像的不同位置和多种尺度，这些先验框作为预定义的候选区检测框内是否有目标，以及微调边框的位置。之前yolov1并没有采用先验框，并且每个grid只预测两个bounding box，整个图像有98个，yolov2入轨每个grid采用9个先验框，收缩网络运行在416*416的图片，一个grid有32像素，那么总共有13*13*9=1521个先验框，最终去掉了全连接层，采用anchor boxes来预测bounding boxes。由于图片中的物体都倾向于出现在图片的中心位置，特别是那种比较大的物体，所以有一个单独位于物体中心的位置用于预测这些物体。YOLO的卷积层采用32这个值来下采样图片，所以通过选择416*416用作输入尺寸最终能输出一个13*13的Feature Map。使用Anchor Box会让精确度稍微下降，但用了它能让YOLO能预测出大于一千个框，同时recall达到88%，mAP达到69.2%。</p>\n<h4 id=\"Dimension-clusters（聚类提取先验框的尺度信息）\">Dimension clusters（聚类提取先验框的尺度信息）</h4>\n<p>之前Anchor Box的尺寸是手动选择的，所以尺寸还有优化的余地。YOLO2尝试统计出更符合样本中对象尺寸的先验框，这样就可以减少网络微调先验框到实际位置的难度。YOLO2的做法是对训练集中标注的边框进行K-mean聚类分析，以寻找尽可能匹配样本的边框尺寸。</p>\n<p>在使用Kmeans聚类分析时，并不是直接采用的欧氏距离度量，因为这样大边框的距离会相对小边框大，这样误差就很大，因此我们采用IOU的形式。<br>\n$$<br>\nd(box,centroid) = 1-IOU(box,centroid)<br>\n$$<br>\ncentroid是聚类时被选作中心的边框，box就是其它边框，d就是两者间的“距离”。IOU越大，“距离”越近。YOLO2给出的聚类分析结果如下图所示：</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic2.png\" alt=\"\"></p>\n<p>通过分析实验结果，在model复杂性与high recall之间权衡之后，选择聚类分类数K=5。</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic3.png\" alt=\"\"></p>\n<p>说明用K-means选择Anchor Boxes时，选择值为5时，AVG IOU的值是61，这个值要比不用聚类的方法的60.9要高。选择值为9的时候，AVG IOU更有显著提高。总之就是说明用聚类的方法是有效果的。</p>\n<h4 id=\"Direct-location-prediction（约束预测边框的位置）\">Direct location prediction（约束预测边框的位置）</h4>\n<p>借鉴于Faster RCNN的先验框方法，在训练的早期阶段，其位置预测容易不稳定。其位置预测公式为：</p>\n\n$$\nx = (t_x*w_a)+x_a \\\\\ny = (t_y*h_a)+y_a\n$$\n\n<p>其中， 是预测边框的中心， $x_a,y_a$是先验框（anchor）的中心点坐标， $w_a,h_a$是先验框（anchor）的宽和高，$t_x,t_y$ 是要学习的参数。注意，YOLO论文中写的是$x = (t_x*w_a)-x_a$ ，根据Faster RCNN，应该是\"+\"。</p>\n<p>但是$t_x,t_y$ 不加约束的这种方式，会导致预测边框中心会出现在任意位置，因此在早期训练阶段不稳定，文章将边框的中心约束在grid网格当中。</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic4.png\" alt=\"\"></p>\n<p>其中， $b_x,b_y,b_w,b_h$是预测边框的中心和宽高。 $Pr(object)*IOU(b,object)$是预测边框的置信度，在YOLO1是直接预测置信度的值，这里对预测参数$t_o$进行σ变换后作为置信度的值。 $c_x,c_y$是当前网格左上角到图像左上角的距离，要先将网格大小归一化，即令一个网格的宽=1，高=1。 $p_w,p_h$是先验框的宽和高($t_w,t_h$会对初始的设置进行调整)。σ是sigmoid函数。 $t_x,t_y,t_w,t_h,t_o$是要学习的参数($t_o$也可以学习的嘛，学到某种规律用以表示置信度❓)，分别用于预测边框的中心和宽高，以及置信度。</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic5.png\" alt=\"\"></p>\n<p>这种方式可以让数值更幅度稳定，也让网络更容易学习。</p>\n<h4 id=\"Fine-Grained-Features-passthrough层检测细粒度特征\">Fine-Grained Features(passthrough层检测细粒度特征)</h4>\n<p>对象检测面临一个问题：即目标检测的对象有大有小，输入图像经过多层网络提取特征，最后输出的特征图中（比如YOLO2中输入416<em>416经过卷积网络下采样最后输出是13</em>13），较小的对象可能特征已经不明显甚至被忽略掉了。为了更好的检测出一些比较小的对象，最后输出的特征图需要保留一些更细节的信息。</p>\n<p>YOLO2引入一种称为passthrough层的方法在特征图中保留一些细节信息。具体来说，就是在最后一个pooling之前，特征图的大小是26*26*512，将其1拆4，直接传递（passthrough）到pooling后（并且又经过一组卷积）的特征图，两者叠加到一起作为输出的特征图。<br>\n<img src=\"https://picture.mulindya.com/yolov2-pic11.png\" alt=\"\"></p>\n<p>具体怎样1拆4，下面借用一副图看的很清楚。图中示例的是1个4*4拆成4个2*2。另外，根据YOLO2的代码，特征图先用1*1卷积从 26*26*512 降维到 26*26*64，再做1拆4并passthrough。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">ut = tf.extract_image_patches(<span class=\"hljs-keyword\">in</span>, [<span class=\"hljs-number\">1</span>, stride, stride, <span class=\"hljs-number\">1</span>], [<span class=\"hljs-number\">1</span>, stride, stride, <span class=\"hljs-number\">1</span>], [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>], padding=<span class=\"hljs-string\">\"VALID\"</span>)<br><span class=\"hljs-comment\"># or use tf.space_to_depth</span><br><span class=\"hljs-comment\"># out = tf.space_to_depth(in, 2)</span><br></code></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">tf.extract_image_patches(<br>    images,<br>    ksizes,<br>    strides,<br>    rates,<br>    padding,<br>    name=<span class=\"hljs-literal\">None</span><br>)<br><span class=\"hljs-comment\">#images：必须是shape为[batch, in_rows, in_cols, depth]的tensor；</span><br><span class=\"hljs-comment\">#ksize：长度大于等于4的list，滑动窗的大小</span><br><span class=\"hljs-comment\">#strides:每块patch区域之间中心点之间的距离，必须是: [1, stride_rows, stride_cols, 1].</span><br>    <span class=\"hljs-comment\">#具体点说就是用来计算每次选取patch的初始点位置</span><br><span class=\"hljs-comment\">#rates: 在每次提取的patch中，对应dim像素点位置之间的差距，必须是[1, rate_rows, rate_cols, 1]；「或者理解为 提取出来的每个框里面的像素不是都选择的 根据rate的不同 隔几个选一个 默认是1也就是的都选择 若为2 那么就是隔一个来选择」</span><br><span class=\"hljs-comment\">#padding:有两个取值，“VALID”或者“SAME”，“VALID”表示所取的patch区域必须完全包含在原始图像中.\"SAME\"表示可以取超出原始图像的部分，这一部分进行0填充。</span><br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"Multi-scale-Training（多尺度图像训练）\">Multi-scale Training（多尺度图像训练）</h4>\n<p>作者希望YOLOv2能健壮的运行于不同尺寸的图片之上，所以把这一想法用于训练model中。</p>\n<p>区别于之前的补全图片的尺寸的方法，YOLOv2每迭代几次都会改变网络参数。每10个Batch，网络会<strong>随机地选择一个新的图片尺寸</strong>，由于使用了下采样参数是32，所以不同的尺寸大小也选择为32的倍数{320，352……608}，最小320*320，最大608*608，网络会自动改变尺寸，并继续训练的过程。</p>\n<p>这一方法让网络在不同的输入尺寸上都能达到一个很好的预测效果，同一网络能在不同分辨率上进行检测。当输入图片尺寸比较小的精度高，输入图片尺寸比较大的时候精度相对低，所以你可以在YOLOv2的速度和精度上进行权衡。</p>\n<center class=\"half\">\n<img src=\"https://picture.mulindya.com/yolov2-pic6.png\">\n<img src=\"https://picture.mulindya.com/yolov2-pic7.png\">\n</center>\n<h4 id=\"hi-res-detect-高分辨率图像的对象检测\">hi-res-detect(高分辨率图像的对象检测)</h4>\n<p>上面左图表格中最后一行是使用高分辨l率的图像hi-res detector，因为YOLO2调整网络结构后能够支持多种尺寸的输入图像。通常是使用416*416的输入图像，如果用较高分辨率的输入图像，比如544*544，则mAP可以达到78.6，有1.8的提升。</p>\n<h4 id=\"Hierarchical-classification-分层分类\">Hierarchical classification(分层分类)</h4>\n<p>作者提出了一种在分类数据集和检测数据集上联合训练的机制。使用检测数据集的图片去学习检测相关的信息，例如bounding box 坐标预测，是否包含物体以及属于各个物体的概率。使用仅有类别标签的分类数据集图片去扩展可以检测的种类。作者通过ImageNet训练分类、COCO和VOC数据集来训练检测，这是一个很有价值的思路，可以让我们达到比较优的效果。通过将两个数据集混合训练，<strong>如果遇到来自分类集的图片则只计算分类的Loss，遇到来自检测集的图片则计算完整的Loss</strong>。</p>\n<p>但是ImageNet对应分类有9000种，而COCO则只提供80种目标检测，作者使用multi-label模型，即假定一张图片可以有多个label，并且不要求label间独立。因为作者选择在COCO和ImageNet数据集上进行联合训练，遇到的第一问题是两者的类别并不是完全互斥的，比如\"Norfolk terrier\"明显属于\"dog\"，所以作者提出了一种层级分类方法（Hierarchical classification），主要思路是根据各个类别之间的从属关系（根据WordNet）建立一种树结构WordTree，结合COCO和ImageNet建立的WordTree如下图所示：</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic8.png\" alt=\"\"></p>\n<ol>\n<li>遍历Imagenet的label，然后在WordNet中寻找该label到根节点(指向一个物理对象)的路径；</li>\n<li>如果路径只有一条，那么就将该路径直接加入到分层树结构中；</li>\n<li>否则，从剩余的路径中选择一条最短路径，加入到分层树。</li>\n</ol>\n<p>这个分层树我们称之为 WordTree，作用就在于将两种数据集按照层级进行结合。(感觉就是为了扩充数据集同时简便计算)</p>\n<p>分类时的概率计算借用了<strong>决策树思想</strong>，<strong>某个节点的概率值等于该节点到根节点的所有条件概率之积</strong>。最终结果是一颗 WordTree （视觉名词组成的层次结构模型）。用WordTree执行分类时，预测每个节点的条件概率。如果想求得特定节点的绝对概率，只需要沿着路径做连续乘积。例如，如果想知道一张图片是不是“Norfolk terrier ”需要计算：</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic10.png\" alt=\"\"></p>\n<p>另外，为了验证这种方法作者在WordTree（用1000类别的ImageNet创建）上训练了Darknet-19模型。为了创建WordTree1k，作者添加了很多中间节点，把label由1000扩展到1369。训练过程中ground truth标签要顺着向根节点的路径传播。例如，如果一张图片被标记为“Norfolk terrier”，它也被标记为“dog” 和“mammal”等。为了计算条件概率，模型预测了一个包含1369个元素的向量，而且基于所有“同义词集”计算softmax。</p>\n<p>softmax操作也同时应该采用分组操作，下图上半部分为ImageNet对应的原生Softmax，下半部分对应基于WordTree的Softmax：</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic9.png\" alt=\"\"></p>\n<p>通过上述方案构造WordTree，得到对应9418个分类，通过重采样保证Imagenet和COCO的样本数据比例为4:1。</p>\n<h3 id=\"总结\">总结</h3>\n<p>通过联合训练策略，YOLO9000可以快速检测出超过9000个类别的物体，总体mAP值为19,7%。我觉得这是作者在这篇论文作出的最大的贡献，因为YOLOv2的改进策略亮点并不是很突出，但是YOLO9000算是开创之举。</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<h2 id=\"YOLOv2\">YOLOv2</h2>\n<h3 id=\"综述\">综述</h3>\n<p><strong>论文地址</strong>：<a href=\"https://arxiv.org/abs/1612.08242\">https://arxiv.org/abs/1612.08242</a></p>\n<p>Yolov2与Yolov1在保持速度的基础上，对预测效果的准确度，耗费时间，鲁棒性三个方面进行了改进，检测能力提高到9000种不同对象。文章提出了一种新的<strong>训练方法–联合训练</strong>方法。这种算法可以将两种数据集混合到一起，使用一种分层的观点进行分类，用大型的分类数据集扩充检测的数据集。也成为YOLO9000.</p>\n<p>联合训练的思路：<strong>在检测数据集和分类数据集上训练物体检测器（Object Detectors），用检测数据集学习物体的准确位置，用分类数据集来增加分类的类别两。提升健壮性。</strong></p>\n<p>Yolo9000就是使用联合训练的算法，拥有来自于Imagenet的9000种分类信息，物体检测的部分来自于CoCo的检测数据集。</p>\n<h3 id=\"论文\">论文</h3>\n<details>\n<summary> yolov2 论文：YOLO9000: Better, Faster, Stronger</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/YOLOv2.pdf' width=100% height=650></iframe>\n</details>\n<h3 id=\"改进点\">改进点</h3>\n<h4 id=\"BN-batch-normalization-批量归一化\">BN(batch normalization) 批量归一化</h4>\n<p>BN层有助于解决反向传播过程的<strong>梯度消失和梯度爆炸</strong>的问题，<strong>降低</strong>对超参数的<strong>敏感性</strong>，同时对batch归一化时，起到了一定的<strong>正则化</strong>的效果（去掉的dropout层）。通常，在网络的线性变换与激活函数之前增加一个BN层，BN层可以将其特征量归一化使得变换后的特征均值为0，方差为1，从而每一批训练样本都有类似的分布。同时还有修正的参数$\\gamma,\\beta$可以恢复原有信息。实验结果mAP提升2.4%</p>\n<p>一般的归一化公式：</p>\n\n$$\n\\widehat x^{(k)} = \\frac{x^{(k)}-E[x^{(k)}]}{\\sqrt {Var[x^{(k)}]}} \\\\\n$$\n\n<p><img src=\"https://picture.mulindya.com/yolov2-pic1.png\" alt=\"\"></p>\n<h4 id=\"High-resolution-classifier（高分辨率图像分类器）\">High resolution classifier（高分辨率图像分类器）</h4>\n<p>由于对象检测的样本相对图像分类的训练样本要少得多，在对象检测时模型通常时先用图像分类的样本训练卷积层提取图像特征（训练backbone）。但是图像分类样本的分辨率不高，比如在yolov1中，训练集是224*224的图片来训练卷积层，但是在训练对象检测的模型使用的是448*448的图片，这样的切换对模型性能有一定影响。所以Yolo2在采用<strong>224*224图像分类模型预训练之后再采用448*448的高分辨率样本对分类模型进行微调</strong>(10个epoch)，这样再训练对象检测模型之前，网络特征就逐渐适应448*448的分辨率，然后再使用448*448的检测样本进行对象检测模型的训练，以缓解了分辨率突然切换造成的影响。通过这种方式，mAP提升了3.7%。</p>\n<h4 id=\"Convolution-with-anchor-boxes-使用先验框\">Convolution with anchor boxes(使用先验框)</h4>\n<p>Yolov1是使用全连接层直接预测BBox的坐标值（每个grid预测k个Bbox），Faster R-CNN的方法是只用卷积层和region proposal network来预测锚框的偏移度和置信度。但是作者发现采用Faster R-CNN的方法比Yolov1的方法更加简便，让神经网络学习起来更加容易。</p>\n<p>因此，Yolov2也尝试了先验框（anchor），在每个grid预先设定一组不同大小不同宽高比的边框，来覆盖整个图像的不同位置和多种尺度，这些先验框作为预定义的候选区检测框内是否有目标，以及微调边框的位置。之前yolov1并没有采用先验框，并且每个grid只预测两个bounding box，整个图像有98个，yolov2入轨每个grid采用9个先验框，收缩网络运行在416*416的图片，一个grid有32像素，那么总共有13*13*9=1521个先验框，最终去掉了全连接层，采用anchor boxes来预测bounding boxes。由于图片中的物体都倾向于出现在图片的中心位置，特别是那种比较大的物体，所以有一个单独位于物体中心的位置用于预测这些物体。YOLO的卷积层采用32这个值来下采样图片，所以通过选择416*416用作输入尺寸最终能输出一个13*13的Feature Map。使用Anchor Box会让精确度稍微下降，但用了它能让YOLO能预测出大于一千个框，同时recall达到88%，mAP达到69.2%。</p>\n<h4 id=\"Dimension-clusters（聚类提取先验框的尺度信息）\">Dimension clusters（聚类提取先验框的尺度信息）</h4>\n<p>之前Anchor Box的尺寸是手动选择的，所以尺寸还有优化的余地。YOLO2尝试统计出更符合样本中对象尺寸的先验框，这样就可以减少网络微调先验框到实际位置的难度。YOLO2的做法是对训练集中标注的边框进行K-mean聚类分析，以寻找尽可能匹配样本的边框尺寸。</p>\n<p>在使用Kmeans聚类分析时，并不是直接采用的欧氏距离度量，因为这样大边框的距离会相对小边框大，这样误差就很大，因此我们采用IOU的形式。<br>\n$$<br>\nd(box,centroid) = 1-IOU(box,centroid)<br>\n$$<br>\ncentroid是聚类时被选作中心的边框，box就是其它边框，d就是两者间的“距离”。IOU越大，“距离”越近。YOLO2给出的聚类分析结果如下图所示：</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic2.png\" alt=\"\"></p>\n<p>通过分析实验结果，在model复杂性与high recall之间权衡之后，选择聚类分类数K=5。</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic3.png\" alt=\"\"></p>\n<p>说明用K-means选择Anchor Boxes时，选择值为5时，AVG IOU的值是61，这个值要比不用聚类的方法的60.9要高。选择值为9的时候，AVG IOU更有显著提高。总之就是说明用聚类的方法是有效果的。</p>\n<h4 id=\"Direct-location-prediction（约束预测边框的位置）\">Direct location prediction（约束预测边框的位置）</h4>\n<p>借鉴于Faster RCNN的先验框方法，在训练的早期阶段，其位置预测容易不稳定。其位置预测公式为：</p>\n\n$$\nx = (t_x*w_a)+x_a \\\\\ny = (t_y*h_a)+y_a\n$$\n\n<p>其中， 是预测边框的中心， $x_a,y_a$是先验框（anchor）的中心点坐标， $w_a,h_a$是先验框（anchor）的宽和高，$t_x,t_y$ 是要学习的参数。注意，YOLO论文中写的是$x = (t_x*w_a)-x_a$ ，根据Faster RCNN，应该是&quot;+&quot;。</p>\n<p>但是$t_x,t_y$ 不加约束的这种方式，会导致预测边框中心会出现在任意位置，因此在早期训练阶段不稳定，文章将边框的中心约束在grid网格当中。</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic4.png\" alt=\"\"></p>\n<p>其中， $b_x,b_y,b_w,b_h$是预测边框的中心和宽高。 $Pr(object)*IOU(b,object)$是预测边框的置信度，在YOLO1是直接预测置信度的值，这里对预测参数$t_o$进行σ变换后作为置信度的值。 $c_x,c_y$是当前网格左上角到图像左上角的距离，要先将网格大小归一化，即令一个网格的宽=1，高=1。 $p_w,p_h$是先验框的宽和高($t_w,t_h$会对初始的设置进行调整)。σ是sigmoid函数。 $t_x,t_y,t_w,t_h,t_o$是要学习的参数($t_o$也可以学习的嘛，学到某种规律用以表示置信度❓)，分别用于预测边框的中心和宽高，以及置信度。</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic5.png\" alt=\"\"></p>\n<p>这种方式可以让数值更幅度稳定，也让网络更容易学习。</p>\n<h4 id=\"Fine-Grained-Features-passthrough层检测细粒度特征\">Fine-Grained Features(passthrough层检测细粒度特征)</h4>\n<p>对象检测面临一个问题：即目标检测的对象有大有小，输入图像经过多层网络提取特征，最后输出的特征图中（比如YOLO2中输入416<em>416经过卷积网络下采样最后输出是13</em>13），较小的对象可能特征已经不明显甚至被忽略掉了。为了更好的检测出一些比较小的对象，最后输出的特征图需要保留一些更细节的信息。</p>\n<p>YOLO2引入一种称为passthrough层的方法在特征图中保留一些细节信息。具体来说，就是在最后一个pooling之前，特征图的大小是26*26*512，将其1拆4，直接传递（passthrough）到pooling后（并且又经过一组卷积）的特征图，两者叠加到一起作为输出的特征图。<br>\n<img src=\"https://picture.mulindya.com/yolov2-pic11.png\" alt=\"\"></p>\n<p>具体怎样1拆4，下面借用一副图看的很清楚。图中示例的是1个4*4拆成4个2*2。另外，根据YOLO2的代码，特征图先用1*1卷积从 26*26*512 降维到 26*26*64，再做1拆4并passthrough。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">ut = tf.extract_image_patches(<span class=\"hljs-keyword\">in</span>, [<span class=\"hljs-number\">1</span>, stride, stride, <span class=\"hljs-number\">1</span>], [<span class=\"hljs-number\">1</span>, stride, stride, <span class=\"hljs-number\">1</span>], [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>], padding=<span class=\"hljs-string\">&quot;VALID&quot;</span>)<br><span class=\"hljs-comment\"># or use tf.space_to_depth</span><br><span class=\"hljs-comment\"># out = tf.space_to_depth(in, 2)</span><br></code></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">tf.extract_image_patches(<br>    images,<br>    ksizes,<br>    strides,<br>    rates,<br>    padding,<br>    name=<span class=\"hljs-literal\">None</span><br>)<br><span class=\"hljs-comment\">#images：必须是shape为[batch, in_rows, in_cols, depth]的tensor；</span><br><span class=\"hljs-comment\">#ksize：长度大于等于4的list，滑动窗的大小</span><br><span class=\"hljs-comment\">#strides:每块patch区域之间中心点之间的距离，必须是: [1, stride_rows, stride_cols, 1].</span><br>    <span class=\"hljs-comment\">#具体点说就是用来计算每次选取patch的初始点位置</span><br><span class=\"hljs-comment\">#rates: 在每次提取的patch中，对应dim像素点位置之间的差距，必须是[1, rate_rows, rate_cols, 1]；「或者理解为 提取出来的每个框里面的像素不是都选择的 根据rate的不同 隔几个选一个 默认是1也就是的都选择 若为2 那么就是隔一个来选择」</span><br><span class=\"hljs-comment\">#padding:有两个取值，“VALID”或者“SAME”，“VALID”表示所取的patch区域必须完全包含在原始图像中.&quot;SAME&quot;表示可以取超出原始图像的部分，这一部分进行0填充。</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"Multi-scale-Training（多尺度图像训练）\">Multi-scale Training（多尺度图像训练）</h4>\n<p>作者希望YOLOv2能健壮的运行于不同尺寸的图片之上，所以把这一想法用于训练model中。</p>\n<p>区别于之前的补全图片的尺寸的方法，YOLOv2每迭代几次都会改变网络参数。每10个Batch，网络会<strong>随机地选择一个新的图片尺寸</strong>，由于使用了下采样参数是32，所以不同的尺寸大小也选择为32的倍数{320，352……608}，最小320*320，最大608*608，网络会自动改变尺寸，并继续训练的过程。</p>\n<p>这一方法让网络在不同的输入尺寸上都能达到一个很好的预测效果，同一网络能在不同分辨率上进行检测。当输入图片尺寸比较小的精度高，输入图片尺寸比较大的时候精度相对低，所以你可以在YOLOv2的速度和精度上进行权衡。</p>\n<center class=\"half\">\n<img src = \"https://picture.mulindya.com/yolov2-pic6.png\">\n<img src = \"https://picture.mulindya.com/yolov2-pic7.png\">\n</center>\n<h4 id=\"hi-res-detect-高分辨率图像的对象检测\">hi-res-detect(高分辨率图像的对象检测)</h4>\n<p>上面左图表格中最后一行是使用高分辨l率的图像hi-res detector，因为YOLO2调整网络结构后能够支持多种尺寸的输入图像。通常是使用416*416的输入图像，如果用较高分辨率的输入图像，比如544*544，则mAP可以达到78.6，有1.8的提升。</p>\n<h4 id=\"Hierarchical-classification-分层分类\">Hierarchical classification(分层分类)</h4>\n<p>作者提出了一种在分类数据集和检测数据集上联合训练的机制。使用检测数据集的图片去学习检测相关的信息，例如bounding box 坐标预测，是否包含物体以及属于各个物体的概率。使用仅有类别标签的分类数据集图片去扩展可以检测的种类。作者通过ImageNet训练分类、COCO和VOC数据集来训练检测，这是一个很有价值的思路，可以让我们达到比较优的效果。通过将两个数据集混合训练，<strong>如果遇到来自分类集的图片则只计算分类的Loss，遇到来自检测集的图片则计算完整的Loss</strong>。</p>\n<p>但是ImageNet对应分类有9000种，而COCO则只提供80种目标检测，作者使用multi-label模型，即假定一张图片可以有多个label，并且不要求label间独立。因为作者选择在COCO和ImageNet数据集上进行联合训练，遇到的第一问题是两者的类别并不是完全互斥的，比如&quot;Norfolk terrier&quot;明显属于&quot;dog&quot;，所以作者提出了一种层级分类方法（Hierarchical classification），主要思路是根据各个类别之间的从属关系（根据WordNet）建立一种树结构WordTree，结合COCO和ImageNet建立的WordTree如下图所示：</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic8.png\" alt=\"\"></p>\n<ol>\n<li>遍历Imagenet的label，然后在WordNet中寻找该label到根节点(指向一个物理对象)的路径；</li>\n<li>如果路径只有一条，那么就将该路径直接加入到分层树结构中；</li>\n<li>否则，从剩余的路径中选择一条最短路径，加入到分层树。</li>\n</ol>\n<p>这个分层树我们称之为 WordTree，作用就在于将两种数据集按照层级进行结合。(感觉就是为了扩充数据集同时简便计算)</p>\n<p>分类时的概率计算借用了<strong>决策树思想</strong>，<strong>某个节点的概率值等于该节点到根节点的所有条件概率之积</strong>。最终结果是一颗 WordTree （视觉名词组成的层次结构模型）。用WordTree执行分类时，预测每个节点的条件概率。如果想求得特定节点的绝对概率，只需要沿着路径做连续乘积。例如，如果想知道一张图片是不是“Norfolk terrier ”需要计算：</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic10.png\" alt=\"\"></p>\n<p>另外，为了验证这种方法作者在WordTree（用1000类别的ImageNet创建）上训练了Darknet-19模型。为了创建WordTree1k，作者添加了很多中间节点，把label由1000扩展到1369。训练过程中ground truth标签要顺着向根节点的路径传播。例如，如果一张图片被标记为“Norfolk terrier”，它也被标记为“dog” 和“mammal”等。为了计算条件概率，模型预测了一个包含1369个元素的向量，而且基于所有“同义词集”计算softmax。</p>\n<p>softmax操作也同时应该采用分组操作，下图上半部分为ImageNet对应的原生Softmax，下半部分对应基于WordTree的Softmax：</p>\n<p><img src=\"https://picture.mulindya.com/yolov2-pic9.png\" alt=\"\"></p>\n<p>通过上述方案构造WordTree，得到对应9418个分类，通过重采样保证Imagenet和COCO的样本数据比例为4:1。</p>\n<h3 id=\"总结\">总结</h3>\n<p>通过联合训练策略，YOLO9000可以快速检测出超过9000个类别的物体，总体mAP值为19,7%。我觉得这是作者在这篇论文作出的最大的贡献，因为YOLOv2的改进策略亮点并不是很突出，但是YOLO9000算是开创之举。</p>\n"},{"title":"Self-awareness","date":"2021-08-19T13:24:42.000Z","_content":"\n>\n\nhttps://paper.mulindya.com/Self-awareness.pdf\n\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/Self-awareness.pdf' width=100% height=600></iframe>\n","source":"_posts/english/self-aware.md","raw":"---\ntitle: Self-awareness\ntags: 英语\ncategories: 英语\ndate: 2021-08-19 21:24:42\n---\n\n>\n\nhttps://paper.mulindya.com/Self-awareness.pdf\n\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/Self-awareness.pdf' width=100% height=600></iframe>\n","slug":"english/self-aware","published":1,"updated":"2022-01-18T08:10:17.055Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p07j0013ast95a01fsvr","content":"<blockquote></blockquote>\n<p><a href=\"https://paper.mulindya.com/Self-awareness.pdf\">https://paper.mulindya.com/Self-awareness.pdf</a></p>\n<iframe src=\"/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/Self-awareness.pdf\" width=\"100%\" height=\"600\"></iframe>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote></blockquote>\n<p><a href=\"https://paper.mulindya.com/Self-awareness.pdf\">https://paper.mulindya.com/Self-awareness.pdf</a></p>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/Self-awareness.pdf' width=100% height=600></iframe>\n"},{"title":"Sobel算子","date":"2021-08-14T02:25:07.000Z","math":true,"_content":"\n>本文主要介绍Sobel算子，主要用于边缘检测；由于该算子引入了局部平均，对噪声有平滑作用，因此还可以消除噪声。\n\n## 图像边缘与梯度\n\n在图像边缘，灰度值的变化较大，因此图像在此处的梯度值也较大。一般情况，图像梯度时计算图像的边缘信息。图像梯度严格来说时需要求导数，但是在图像计算上时使用像素值的差得到梯度的近似值。\n图像强度的显著变化可分为：\n\n- 阶跃变化函数，即图像强度在不连续处的两边的像素灰度值有着显著的差异；\n- 线条（屋顶）变化函数，即图像强度突然从一个值变化到另一个值，保持一较小行程后又回到原来的值。\n\n![](https://picture.mulindya.com/sobel-pic1.png)\n\n（a）（b）分别是阶跃函数和屋顶函数的二维图像；（c）（d）是阶跃和屋顶函数的函数图象；（e）（f）对应一阶倒数；（g）（h）是二阶倒数。\n\n## Sobel算子\n\n常用如下两个模板进行边缘检测，将Gx，Gy与图像卷积，即可得到横向和纵向的亮度差分近似值。\n\n{% raw %}\n$$\nG_x = \\begin{bmatrix} -1 & 0 & 1 \\\\ -2 & 0 & 2\\\\-1 & 0 & 1\\end{bmatrix} \\qquad G_y = \\begin{bmatrix} 1 & 2 & 1 \\\\ 0 & 0 & 0\\\\-1 & -2 & -1\\end{bmatrix}\n$$\n{% endraw %}\n\n图像每一个像素的梯度可以使用$G = \\sqrt{G^2_x+G^2_y}$来表示，梯度的方向使用$\\Theta = arctan(\\frac{G_y}{G_x})$。\n\n还有另外一个比`Sobel`函数的近似效果更好的 `Scharr`函数，其内核矩阵如下:\n\n{% raw %}\n$$\nG_x = \\begin{bmatrix} -3 & 0 & 3 \\\\ -10 & 0 & 10 \\\\ -3 & 0 & 3\\end{bmatrix} \\qquad G_y = \\begin{bmatrix} -3 & -10 & -3 \\\\ 0 & 0 & 0 \\\\ 3 & 10 & 3\\end{bmatrix}\n$$\n\n{% endraw %}\n\n## 代码使用\n\n### cv2.Sobel()\n\nSobel算子依然是一种过滤器，只是其是带有方向的\n\n```python\ndst = cv2.Sobel(src, ddepth, dx, dy[,ksize[, scale[, delta[, borderType]]]])\n```\n\n- dst代表目标函数\n-  src代表原始图像\n-  ddpeth代表输出图像的深度 ，-1表示采用的是与原图像相同的深度。目标图像的深度必须大于等于原图像的深度；\n-   dx代表x方向上的求导阶数 ，0表示这个方向上没有求导，一般为0、1、2。\n-   dy代表y方向上的求导阶数，0表示这个方向上没有求导，一般为0、1、2。\n-   ksize代表Sobel核的大小，该值为-1时，则会使用Scharr算子进行运算,一般选择为1、3、5、7\n-   scale代表计算导数时所采用的缩放因子，默认为1，无缩放\n-  delta代表加在目标图像dst上的值，该值是可选的，默认为0\n-  borderType代表边界样式，这个参数默认值为cv2.BORDER_DEFAULT。\n\n> 其中ddepth设计图像深度的概念：\n> 图像深度是指存储每个像素值所用的位数，例如cv2.CV_8U，指的是8位无符号数，取值范围为0~255，超出范围则会被截断（截断指的是，当数值大于255保留为255，当数值小于0保留为0，其余不变）。\n>\n> 具体还有：CV_16S（16位无符号数），CV_16U（16位有符号数），CV_32F（32位浮点数），CV_64F（64位浮点数）等.\n\n```python\nimport cv2\n#载入原图，图像深度为CV_8U\nimg_original=cv2.imread('E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg',0)\n#求X方向梯度，并且输出图像一个为CV_8U,一个为CV_64F\nimg_gradient_X_8U=cv2.Sobel(img_original,-1,1,0)\nimg_gradient_X_64F=cv2.Sobel(img_original,cv2.CV_64F,1,0)\n#将图像深度改为CV_8U\nimg_gradient_X_64Fto8U=cv2.convertScaleAbs(img_gradient_X_64F)\n#图像显示\ncv2.imshow('X_gradient_8U',img_gradient_X)\ncv2.imshow('X_gradient_64Fto8U',img_gradient_X_64Fto8U)\ncv2.waitKey()\ncv2.destroyAllWindows()\n```\n\n![](https://picture.mulindya.com/sobel-pic2.png)\n\n`cv2.imshow()`的默认显示为8位无符号数，即[0,255]，因此在显示`CV_64F`的图像前使用了函数`cv2.convertScaleAbs()`将图像深度为`CV_64F`的梯度图像重新转化为`CV_8U`。\n\n### cv2.convertScaleAbs()\n\n```\ncv2.convertScaleAbs(src[,alpha[,beta]])\n```\n\n先计算数组绝对值，后转化为8位无符号数\n\n- src:输入图像（多维数组）\n- alpha:比例因子\n- beta:保存新图像（数组）前可以增加的值\n\n### 归一化\n\n防止梯度大小被截断最简单的方法就是先将输入图像归一化（实际归一化的过程就已经实现了图像深度的转变）。在使用深度大于8U的格式之前将灰度先归一化，就不用`convertScaleAbs`转换了。\n\n```python\nimport cv2\nimport numpy as np\n#载入灰度原图，图像深度为CV_8U\nimg_original=cv2.imread('E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg',0)\n#原图归一化,实际图像深度已经变为CV_64F\nimg_standard=img_original/255\n#采用灰度原图求X方向梯度\noriginal_gradient_X_64F=cv2.Sobel(img_original,cv2.CV_64F,1,0)\noriginal_gradient_X_64Fto8U=cv2.convertScaleAbs(original_gradient_X_64F)\n#采用归一化的图像求X方向梯度\nstandard_gradient_X=cv2.Sobel(img_standard,-1,1,0)\n#图像显示\ncv2.imshow('original',img_original)\ncv2.imshow('original_X',original_gradient_X_64Fto8U)\ncv2.imshow('standard_X',standard_gradient_X)\ncv2.waitKey()\ncv2.destroyAllWindows()\n```\n\n![](https://picture.mulindya.com/sobel-pic3.png)\n\n### cv2.addWeighted()\n\n```\ncv2.addWeighted(src1, alpha, src2, beta, gamma[, dst[, dtype]]) → dst\n```\n\n- src1 输入的第一个数组\n- alpha 第一个数组的权重\n- src2 输入的第二个数组（与第一个数组有相同的shape）\n- beta 第二个数组的权重\n- dst 输出的数组名称\n- gamma 计算和时所采用的缩放因子，默认为1，无缩放\n- dtype 输出图像的深度，-1表示和input相同\n- \n> dst = src1 * alpha + src2 * beta + gamma;\n\n注意：由参数说明可以看出，被叠加的两幅图像必须是尺寸相同、类型相同的；并且，当输出图像array的深度为CV_32S时，这个函数就不适用了，这时候就会内存溢出或者算出的结果压根不对。\n\n### 边缘检测\n\n通过cv2.Sobel()我们可以轻松计算出X,Y方向的梯度大小，根据公式\n\n$$\nG = \\sqrt{G^2_x+G^2_y}\n$$\n可以求出梯度图像，实际操作时，为了简化运算，我们使用公式\n\n$$\nG = \\vert{G_x}\\vert+\\vert{G_y}\\vert\n$$\n\n```python\nimport cv2\nimport numpy as np\n#载入灰度原图，并且归一化\nimg_original=cv2.imread('E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg',0)/255\n#分别求X,Y方向的梯度\ngrad_X=cv2.Sobel(img_original,-1,1,0)\ngrad_Y=cv2.Sobel(img_original,-1,0,1)\n#求梯度图像\ngrad=cv2.addWeighted(grad_X,0.5,grad_Y,0.5,0)\ncv2.imshow('gradient',grad)\n```\n\n## 官方说明\n\n当年作者并没有公开发表过论文，仅仅是在一次博士生课题讨论会(1968)上提出(\"A 3x3 Isotropic Gradient Operator for Image Processing\")，后在1973年出版的一本专著（\"Pattern Classification and Scene Analysis\"）的脚注里作为注释出现和公开的。\n\n详细介绍，请参考以下内容。\n\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf' width=100% height=450></iframe>\n\n","source":"_posts/img_process/sobel.md","raw":"---\ntitle: Sobel算子\ntags: 图像处理\ncategories: [图像处理]\ndate: 2021-08-14 10:25:07\nmath: true\n---\n\n>本文主要介绍Sobel算子，主要用于边缘检测；由于该算子引入了局部平均，对噪声有平滑作用，因此还可以消除噪声。\n\n## 图像边缘与梯度\n\n在图像边缘，灰度值的变化较大，因此图像在此处的梯度值也较大。一般情况，图像梯度时计算图像的边缘信息。图像梯度严格来说时需要求导数，但是在图像计算上时使用像素值的差得到梯度的近似值。\n图像强度的显著变化可分为：\n\n- 阶跃变化函数，即图像强度在不连续处的两边的像素灰度值有着显著的差异；\n- 线条（屋顶）变化函数，即图像强度突然从一个值变化到另一个值，保持一较小行程后又回到原来的值。\n\n![](https://picture.mulindya.com/sobel-pic1.png)\n\n（a）（b）分别是阶跃函数和屋顶函数的二维图像；（c）（d）是阶跃和屋顶函数的函数图象；（e）（f）对应一阶倒数；（g）（h）是二阶倒数。\n\n## Sobel算子\n\n常用如下两个模板进行边缘检测，将Gx，Gy与图像卷积，即可得到横向和纵向的亮度差分近似值。\n\n{% raw %}\n$$\nG_x = \\begin{bmatrix} -1 & 0 & 1 \\\\ -2 & 0 & 2\\\\-1 & 0 & 1\\end{bmatrix} \\qquad G_y = \\begin{bmatrix} 1 & 2 & 1 \\\\ 0 & 0 & 0\\\\-1 & -2 & -1\\end{bmatrix}\n$$\n{% endraw %}\n\n图像每一个像素的梯度可以使用$G = \\sqrt{G^2_x+G^2_y}$来表示，梯度的方向使用$\\Theta = arctan(\\frac{G_y}{G_x})$。\n\n还有另外一个比`Sobel`函数的近似效果更好的 `Scharr`函数，其内核矩阵如下:\n\n{% raw %}\n$$\nG_x = \\begin{bmatrix} -3 & 0 & 3 \\\\ -10 & 0 & 10 \\\\ -3 & 0 & 3\\end{bmatrix} \\qquad G_y = \\begin{bmatrix} -3 & -10 & -3 \\\\ 0 & 0 & 0 \\\\ 3 & 10 & 3\\end{bmatrix}\n$$\n\n{% endraw %}\n\n## 代码使用\n\n### cv2.Sobel()\n\nSobel算子依然是一种过滤器，只是其是带有方向的\n\n```python\ndst = cv2.Sobel(src, ddepth, dx, dy[,ksize[, scale[, delta[, borderType]]]])\n```\n\n- dst代表目标函数\n-  src代表原始图像\n-  ddpeth代表输出图像的深度 ，-1表示采用的是与原图像相同的深度。目标图像的深度必须大于等于原图像的深度；\n-   dx代表x方向上的求导阶数 ，0表示这个方向上没有求导，一般为0、1、2。\n-   dy代表y方向上的求导阶数，0表示这个方向上没有求导，一般为0、1、2。\n-   ksize代表Sobel核的大小，该值为-1时，则会使用Scharr算子进行运算,一般选择为1、3、5、7\n-   scale代表计算导数时所采用的缩放因子，默认为1，无缩放\n-  delta代表加在目标图像dst上的值，该值是可选的，默认为0\n-  borderType代表边界样式，这个参数默认值为cv2.BORDER_DEFAULT。\n\n> 其中ddepth设计图像深度的概念：\n> 图像深度是指存储每个像素值所用的位数，例如cv2.CV_8U，指的是8位无符号数，取值范围为0~255，超出范围则会被截断（截断指的是，当数值大于255保留为255，当数值小于0保留为0，其余不变）。\n>\n> 具体还有：CV_16S（16位无符号数），CV_16U（16位有符号数），CV_32F（32位浮点数），CV_64F（64位浮点数）等.\n\n```python\nimport cv2\n#载入原图，图像深度为CV_8U\nimg_original=cv2.imread('E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg',0)\n#求X方向梯度，并且输出图像一个为CV_8U,一个为CV_64F\nimg_gradient_X_8U=cv2.Sobel(img_original,-1,1,0)\nimg_gradient_X_64F=cv2.Sobel(img_original,cv2.CV_64F,1,0)\n#将图像深度改为CV_8U\nimg_gradient_X_64Fto8U=cv2.convertScaleAbs(img_gradient_X_64F)\n#图像显示\ncv2.imshow('X_gradient_8U',img_gradient_X)\ncv2.imshow('X_gradient_64Fto8U',img_gradient_X_64Fto8U)\ncv2.waitKey()\ncv2.destroyAllWindows()\n```\n\n![](https://picture.mulindya.com/sobel-pic2.png)\n\n`cv2.imshow()`的默认显示为8位无符号数，即[0,255]，因此在显示`CV_64F`的图像前使用了函数`cv2.convertScaleAbs()`将图像深度为`CV_64F`的梯度图像重新转化为`CV_8U`。\n\n### cv2.convertScaleAbs()\n\n```\ncv2.convertScaleAbs(src[,alpha[,beta]])\n```\n\n先计算数组绝对值，后转化为8位无符号数\n\n- src:输入图像（多维数组）\n- alpha:比例因子\n- beta:保存新图像（数组）前可以增加的值\n\n### 归一化\n\n防止梯度大小被截断最简单的方法就是先将输入图像归一化（实际归一化的过程就已经实现了图像深度的转变）。在使用深度大于8U的格式之前将灰度先归一化，就不用`convertScaleAbs`转换了。\n\n```python\nimport cv2\nimport numpy as np\n#载入灰度原图，图像深度为CV_8U\nimg_original=cv2.imread('E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg',0)\n#原图归一化,实际图像深度已经变为CV_64F\nimg_standard=img_original/255\n#采用灰度原图求X方向梯度\noriginal_gradient_X_64F=cv2.Sobel(img_original,cv2.CV_64F,1,0)\noriginal_gradient_X_64Fto8U=cv2.convertScaleAbs(original_gradient_X_64F)\n#采用归一化的图像求X方向梯度\nstandard_gradient_X=cv2.Sobel(img_standard,-1,1,0)\n#图像显示\ncv2.imshow('original',img_original)\ncv2.imshow('original_X',original_gradient_X_64Fto8U)\ncv2.imshow('standard_X',standard_gradient_X)\ncv2.waitKey()\ncv2.destroyAllWindows()\n```\n\n![](https://picture.mulindya.com/sobel-pic3.png)\n\n### cv2.addWeighted()\n\n```\ncv2.addWeighted(src1, alpha, src2, beta, gamma[, dst[, dtype]]) → dst\n```\n\n- src1 输入的第一个数组\n- alpha 第一个数组的权重\n- src2 输入的第二个数组（与第一个数组有相同的shape）\n- beta 第二个数组的权重\n- dst 输出的数组名称\n- gamma 计算和时所采用的缩放因子，默认为1，无缩放\n- dtype 输出图像的深度，-1表示和input相同\n- \n> dst = src1 * alpha + src2 * beta + gamma;\n\n注意：由参数说明可以看出，被叠加的两幅图像必须是尺寸相同、类型相同的；并且，当输出图像array的深度为CV_32S时，这个函数就不适用了，这时候就会内存溢出或者算出的结果压根不对。\n\n### 边缘检测\n\n通过cv2.Sobel()我们可以轻松计算出X,Y方向的梯度大小，根据公式\n\n$$\nG = \\sqrt{G^2_x+G^2_y}\n$$\n可以求出梯度图像，实际操作时，为了简化运算，我们使用公式\n\n$$\nG = \\vert{G_x}\\vert+\\vert{G_y}\\vert\n$$\n\n```python\nimport cv2\nimport numpy as np\n#载入灰度原图，并且归一化\nimg_original=cv2.imread('E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg',0)/255\n#分别求X,Y方向的梯度\ngrad_X=cv2.Sobel(img_original,-1,1,0)\ngrad_Y=cv2.Sobel(img_original,-1,0,1)\n#求梯度图像\ngrad=cv2.addWeighted(grad_X,0.5,grad_Y,0.5,0)\ncv2.imshow('gradient',grad)\n```\n\n## 官方说明\n\n当年作者并没有公开发表过论文，仅仅是在一次博士生课题讨论会(1968)上提出(\"A 3x3 Isotropic Gradient Operator for Image Processing\")，后在1973年出版的一本专著（\"Pattern Classification and Scene Analysis\"）的脚注里作为注释出现和公开的。\n\n详细介绍，请参考以下内容。\n\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf' width=100% height=450></iframe>\n\n","slug":"img_process/sobel","published":1,"updated":"2022-01-18T08:10:17.058Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p07m0017ast9081z3rdw","content":"<blockquote>\n<p>本文主要介绍Sobel算子，主要用于边缘检测；由于该算子引入了局部平均，对噪声有平滑作用，因此还可以消除噪声。</p>\n</blockquote>\n<h2 id=\"图像边缘与梯度\">图像边缘与梯度</h2>\n<p>在图像边缘，灰度值的变化较大，因此图像在此处的梯度值也较大。一般情况，图像梯度时计算图像的边缘信息。图像梯度严格来说时需要求导数，但是在图像计算上时使用像素值的差得到梯度的近似值。<br>\n图像强度的显著变化可分为：</p>\n<ul>\n<li>阶跃变化函数，即图像强度在不连续处的两边的像素灰度值有着显著的差异；</li>\n<li>线条（屋顶）变化函数，即图像强度突然从一个值变化到另一个值，保持一较小行程后又回到原来的值。</li>\n</ul>\n<p><img src=\"https://picture.mulindya.com/sobel-pic1.png\" alt=\"\"></p>\n<p>（a）（b）分别是阶跃函数和屋顶函数的二维图像；（c）（d）是阶跃和屋顶函数的函数图象；（e）（f）对应一阶倒数；（g）（h）是二阶倒数。</p>\n<h2 id=\"Sobel算子\">Sobel算子</h2>\n<p>常用如下两个模板进行边缘检测，将Gx，Gy与图像卷积，即可得到横向和纵向的亮度差分近似值。</p>\n\n$$\nG_x = \\begin{bmatrix} -1 &amp; 0 &amp; 1 \\\\ -2 &amp; 0 &amp; 2\\\\-1 &amp; 0 &amp; 1\\end{bmatrix} \\qquad G_y = \\begin{bmatrix} 1 &amp; 2 &amp; 1 \\\\ 0 &amp; 0 &amp; 0\\\\-1 &amp; -2 &amp; -1\\end{bmatrix}\n$$\n\n<p>图像每一个像素的梯度可以使用$G = \\sqrt{G<sup>2_x+G</sup>2_y}$来表示，梯度的方向使用$\\Theta = arctan(\\frac{G_y}{G_x})$。</p>\n<p>还有另外一个比<code>Sobel</code>函数的近似效果更好的 <code>Scharr</code>函数，其内核矩阵如下:</p>\n\n$$\nG_x = \\begin{bmatrix} -3 &amp; 0 &amp; 3 \\\\ -10 &amp; 0 &amp; 10 \\\\ -3 &amp; 0 &amp; 3\\end{bmatrix} \\qquad G_y = \\begin{bmatrix} -3 &amp; -10 &amp; -3 \\\\ 0 &amp; 0 &amp; 0 \\\\ 3 &amp; 10 &amp; 3\\end{bmatrix}\n$$\n\n\n<h2 id=\"代码使用\">代码使用</h2>\n<h3 id=\"cv2-Sobel\">cv2.Sobel()</h3>\n<p>Sobel算子依然是一种过滤器，只是其是带有方向的</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">dst = cv2.Sobel(src, ddepth, dx, dy[,ksize[, scale[, delta[, borderType]]]])<br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>dst代表目标函数</li>\n<li>src代表原始图像</li>\n<li>ddpeth代表输出图像的深度 ，-1表示采用的是与原图像相同的深度。目标图像的深度必须大于等于原图像的深度；</li>\n<li>dx代表x方向上的求导阶数 ，0表示这个方向上没有求导，一般为0、1、2。</li>\n<li>dy代表y方向上的求导阶数，0表示这个方向上没有求导，一般为0、1、2。</li>\n<li>ksize代表Sobel核的大小，该值为-1时，则会使用Scharr算子进行运算,一般选择为1、3、5、7</li>\n<li>scale代表计算导数时所采用的缩放因子，默认为1，无缩放</li>\n<li>delta代表加在目标图像dst上的值，该值是可选的，默认为0</li>\n<li>borderType代表边界样式，这个参数默认值为cv2.BORDER_DEFAULT。</li>\n</ul>\n<blockquote>\n<p>其中ddepth设计图像深度的概念：<br>\n图像深度是指存储每个像素值所用的位数，例如cv2.CV_8U，指的是8位无符号数，取值范围为0~255，超出范围则会被截断（截断指的是，当数值大于255保留为255，当数值小于0保留为0，其余不变）。</p>\n<p>具体还有：CV_16S（16位无符号数），CV_16U（16位有符号数），CV_32F（32位浮点数），CV_64F（64位浮点数）等.</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-comment\">#载入原图，图像深度为CV_8U</span><br>img_original=cv2.imread(<span class=\"hljs-string\">'E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg'</span>,<span class=\"hljs-number\">0</span>)<br><span class=\"hljs-comment\">#求X方向梯度，并且输出图像一个为CV_8U,一个为CV_64F</span><br>img_gradient_X_8U=cv2.Sobel(img_original,-<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>)<br>img_gradient_X_64F=cv2.Sobel(img_original,cv2.CV_64F,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>)<br><span class=\"hljs-comment\">#将图像深度改为CV_8U</span><br>img_gradient_X_64Fto8U=cv2.convertScaleAbs(img_gradient_X_64F)<br><span class=\"hljs-comment\">#图像显示</span><br>cv2.imshow(<span class=\"hljs-string\">'X_gradient_8U'</span>,img_gradient_X)<br>cv2.imshow(<span class=\"hljs-string\">'X_gradient_64Fto8U'</span>,img_gradient_X_64Fto8U)<br>cv2.waitKey()<br>cv2.destroyAllWindows()<br></code></pre></td></tr></tbody></table></figure>\n<p><img src=\"https://picture.mulindya.com/sobel-pic2.png\" alt=\"\"></p>\n<p><code>cv2.imshow()</code>的默认显示为8位无符号数，即[0,255]，因此在显示<code>CV_64F</code>的图像前使用了函数<code>cv2.convertScaleAbs()</code>将图像深度为<code>CV_64F</code>的梯度图像重新转化为<code>CV_8U</code>。</p>\n<h3 id=\"cv2-convertScaleAbs\">cv2.convertScaleAbs()</h3>\n<figure class=\"highlight reasonml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs reasonml\">cv2.convert<span class=\"hljs-constructor\">ScaleAbs(<span class=\"hljs-params\">src</span>[,<span class=\"hljs-params\">alpha</span>[,<span class=\"hljs-params\">beta</span>]])</span><br></code></pre></td></tr></tbody></table></figure>\n<p>先计算数组绝对值，后转化为8位无符号数</p>\n<ul>\n<li>src:输入图像（多维数组）</li>\n<li>alpha:比例因子</li>\n<li>beta:保存新图像（数组）前可以增加的值</li>\n</ul>\n<h3 id=\"归一化\">归一化</h3>\n<p>防止梯度大小被截断最简单的方法就是先将输入图像归一化（实际归一化的过程就已经实现了图像深度的转变）。在使用深度大于8U的格式之前将灰度先归一化，就不用<code>convertScaleAbs</code>转换了。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><span class=\"hljs-comment\">#载入灰度原图，图像深度为CV_8U</span><br>img_original=cv2.imread(<span class=\"hljs-string\">'E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg'</span>,<span class=\"hljs-number\">0</span>)<br><span class=\"hljs-comment\">#原图归一化,实际图像深度已经变为CV_64F</span><br>img_standard=img_original/<span class=\"hljs-number\">255</span><br><span class=\"hljs-comment\">#采用灰度原图求X方向梯度</span><br>original_gradient_X_64F=cv2.Sobel(img_original,cv2.CV_64F,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>)<br>original_gradient_X_64Fto8U=cv2.convertScaleAbs(original_gradient_X_64F)<br><span class=\"hljs-comment\">#采用归一化的图像求X方向梯度</span><br>standard_gradient_X=cv2.Sobel(img_standard,-<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>)<br><span class=\"hljs-comment\">#图像显示</span><br>cv2.imshow(<span class=\"hljs-string\">'original'</span>,img_original)<br>cv2.imshow(<span class=\"hljs-string\">'original_X'</span>,original_gradient_X_64Fto8U)<br>cv2.imshow(<span class=\"hljs-string\">'standard_X'</span>,standard_gradient_X)<br>cv2.waitKey()<br>cv2.destroyAllWindows()<br></code></pre></td></tr></tbody></table></figure>\n<p><img src=\"https://picture.mulindya.com/sobel-pic3.png\" alt=\"\"></p>\n<h3 id=\"cv2-addWeighted\">cv2.addWeighted()</h3>\n<figure class=\"highlight reasonml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs reasonml\">cv2.add<span class=\"hljs-constructor\">Weighted(<span class=\"hljs-params\">src1</span>, <span class=\"hljs-params\">alpha</span>, <span class=\"hljs-params\">src2</span>, <span class=\"hljs-params\">beta</span>, <span class=\"hljs-params\">gamma</span>[, <span class=\"hljs-params\">dst</span>[, <span class=\"hljs-params\">dtype</span>]])</span> → dst<br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>src1 输入的第一个数组</li>\n<li>alpha 第一个数组的权重</li>\n<li>src2 输入的第二个数组（与第一个数组有相同的shape）</li>\n<li>beta 第二个数组的权重</li>\n<li>dst 输出的数组名称</li>\n<li>gamma 计算和时所采用的缩放因子，默认为1，无缩放</li>\n<li>dtype 输出图像的深度，-1表示和input相同</li>\n<li></li>\n</ul>\n<blockquote>\n<p>dst = src1 * alpha + src2 * beta + gamma;</p>\n</blockquote>\n<p>注意：由参数说明可以看出，被叠加的两幅图像必须是尺寸相同、类型相同的；并且，当输出图像array的深度为CV_32S时，这个函数就不适用了，这时候就会内存溢出或者算出的结果压根不对。</p>\n<h3 id=\"边缘检测\">边缘检测</h3>\n<p>通过cv2.Sobel()我们可以轻松计算出X,Y方向的梯度大小，根据公式</p>\n<p>$$<br>\nG = \\sqrt{G<sup>2_x+G</sup>2_y}<br>\n$$<br>\n可以求出梯度图像，实际操作时，为了简化运算，我们使用公式</p>\n<p>$$<br>\nG = \\vert{G_x}\\vert+\\vert{G_y}\\vert<br>\n$$</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><span class=\"hljs-comment\">#载入灰度原图，并且归一化</span><br>img_original=cv2.imread(<span class=\"hljs-string\">'E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg'</span>,<span class=\"hljs-number\">0</span>)/<span class=\"hljs-number\">255</span><br><span class=\"hljs-comment\">#分别求X,Y方向的梯度</span><br>grad_X=cv2.Sobel(img_original,-<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>)<br>grad_Y=cv2.Sobel(img_original,-<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span>)<br><span class=\"hljs-comment\">#求梯度图像</span><br>grad=cv2.addWeighted(grad_X,<span class=\"hljs-number\">0.5</span>,grad_Y,<span class=\"hljs-number\">0.5</span>,<span class=\"hljs-number\">0</span>)<br>cv2.imshow(<span class=\"hljs-string\">'gradient'</span>,grad)<br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"官方说明\">官方说明</h2>\n<p>当年作者并没有公开发表过论文，仅仅是在一次博士生课题讨论会(1968)上提出(“A 3x3 Isotropic Gradient Operator for Image Processing”)，后在1973年出版的一本专著（“Pattern Classification and Scene Analysis”）的脚注里作为注释出现和公开的。</p>\n<p>详细介绍，请参考以下内容。</p>\n<iframe src=\"/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf\" width=\"100%\" height=\"450\"></iframe>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>本文主要介绍Sobel算子，主要用于边缘检测；由于该算子引入了局部平均，对噪声有平滑作用，因此还可以消除噪声。</p>\n</blockquote>\n<h2 id=\"图像边缘与梯度\">图像边缘与梯度</h2>\n<p>在图像边缘，灰度值的变化较大，因此图像在此处的梯度值也较大。一般情况，图像梯度时计算图像的边缘信息。图像梯度严格来说时需要求导数，但是在图像计算上时使用像素值的差得到梯度的近似值。<br>\n图像强度的显著变化可分为：</p>\n<ul>\n<li>阶跃变化函数，即图像强度在不连续处的两边的像素灰度值有着显著的差异；</li>\n<li>线条（屋顶）变化函数，即图像强度突然从一个值变化到另一个值，保持一较小行程后又回到原来的值。</li>\n</ul>\n<p><img src=\"https://picture.mulindya.com/sobel-pic1.png\" alt=\"\"></p>\n<p>（a）（b）分别是阶跃函数和屋顶函数的二维图像；（c）（d）是阶跃和屋顶函数的函数图象；（e）（f）对应一阶倒数；（g）（h）是二阶倒数。</p>\n<h2 id=\"Sobel算子\">Sobel算子</h2>\n<p>常用如下两个模板进行边缘检测，将Gx，Gy与图像卷积，即可得到横向和纵向的亮度差分近似值。</p>\n\n$$\nG_x = \\begin{bmatrix} -1 & 0 & 1 \\\\ -2 & 0 & 2\\\\-1 & 0 & 1\\end{bmatrix} \\qquad G_y = \\begin{bmatrix} 1 & 2 & 1 \\\\ 0 & 0 & 0\\\\-1 & -2 & -1\\end{bmatrix}\n$$\n\n<p>图像每一个像素的梯度可以使用$G = \\sqrt{G<sup>2_x+G</sup>2_y}$来表示，梯度的方向使用$\\Theta = arctan(\\frac{G_y}{G_x})$。</p>\n<p>还有另外一个比<code>Sobel</code>函数的近似效果更好的 <code>Scharr</code>函数，其内核矩阵如下:</p>\n\n$$\nG_x = \\begin{bmatrix} -3 & 0 & 3 \\\\ -10 & 0 & 10 \\\\ -3 & 0 & 3\\end{bmatrix} \\qquad G_y = \\begin{bmatrix} -3 & -10 & -3 \\\\ 0 & 0 & 0 \\\\ 3 & 10 & 3\\end{bmatrix}\n$$\n\n\n<h2 id=\"代码使用\">代码使用</h2>\n<h3 id=\"cv2-Sobel\">cv2.Sobel()</h3>\n<p>Sobel算子依然是一种过滤器，只是其是带有方向的</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">dst = cv2.Sobel(src, ddepth, dx, dy[,ksize[, scale[, delta[, borderType]]]])<br></code></pre></td></tr></table></figure>\n<ul>\n<li>dst代表目标函数</li>\n<li>src代表原始图像</li>\n<li>ddpeth代表输出图像的深度 ，-1表示采用的是与原图像相同的深度。目标图像的深度必须大于等于原图像的深度；</li>\n<li>dx代表x方向上的求导阶数 ，0表示这个方向上没有求导，一般为0、1、2。</li>\n<li>dy代表y方向上的求导阶数，0表示这个方向上没有求导，一般为0、1、2。</li>\n<li>ksize代表Sobel核的大小，该值为-1时，则会使用Scharr算子进行运算,一般选择为1、3、5、7</li>\n<li>scale代表计算导数时所采用的缩放因子，默认为1，无缩放</li>\n<li>delta代表加在目标图像dst上的值，该值是可选的，默认为0</li>\n<li>borderType代表边界样式，这个参数默认值为cv2.BORDER_DEFAULT。</li>\n</ul>\n<blockquote>\n<p>其中ddepth设计图像深度的概念：<br>\n图像深度是指存储每个像素值所用的位数，例如cv2.CV_8U，指的是8位无符号数，取值范围为0~255，超出范围则会被截断（截断指的是，当数值大于255保留为255，当数值小于0保留为0，其余不变）。</p>\n<p>具体还有：CV_16S（16位无符号数），CV_16U（16位有符号数），CV_32F（32位浮点数），CV_64F（64位浮点数）等.</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-comment\">#载入原图，图像深度为CV_8U</span><br>img_original=cv2.imread(<span class=\"hljs-string\">&#x27;E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg&#x27;</span>,<span class=\"hljs-number\">0</span>)<br><span class=\"hljs-comment\">#求X方向梯度，并且输出图像一个为CV_8U,一个为CV_64F</span><br>img_gradient_X_8U=cv2.Sobel(img_original,-<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>)<br>img_gradient_X_64F=cv2.Sobel(img_original,cv2.CV_64F,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>)<br><span class=\"hljs-comment\">#将图像深度改为CV_8U</span><br>img_gradient_X_64Fto8U=cv2.convertScaleAbs(img_gradient_X_64F)<br><span class=\"hljs-comment\">#图像显示</span><br>cv2.imshow(<span class=\"hljs-string\">&#x27;X_gradient_8U&#x27;</span>,img_gradient_X)<br>cv2.imshow(<span class=\"hljs-string\">&#x27;X_gradient_64Fto8U&#x27;</span>,img_gradient_X_64Fto8U)<br>cv2.waitKey()<br>cv2.destroyAllWindows()<br></code></pre></td></tr></table></figure>\n<p><img src=\"https://picture.mulindya.com/sobel-pic2.png\" alt=\"\"></p>\n<p><code>cv2.imshow()</code>的默认显示为8位无符号数，即[0,255]，因此在显示<code>CV_64F</code>的图像前使用了函数<code>cv2.convertScaleAbs()</code>将图像深度为<code>CV_64F</code>的梯度图像重新转化为<code>CV_8U</code>。</p>\n<h3 id=\"cv2-convertScaleAbs\">cv2.convertScaleAbs()</h3>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs reasonml\">cv2.convert<span class=\"hljs-constructor\">ScaleAbs(<span class=\"hljs-params\">src</span>[,<span class=\"hljs-params\">alpha</span>[,<span class=\"hljs-params\">beta</span>]])</span><br></code></pre></td></tr></table></figure>\n<p>先计算数组绝对值，后转化为8位无符号数</p>\n<ul>\n<li>src:输入图像（多维数组）</li>\n<li>alpha:比例因子</li>\n<li>beta:保存新图像（数组）前可以增加的值</li>\n</ul>\n<h3 id=\"归一化\">归一化</h3>\n<p>防止梯度大小被截断最简单的方法就是先将输入图像归一化（实际归一化的过程就已经实现了图像深度的转变）。在使用深度大于8U的格式之前将灰度先归一化，就不用<code>convertScaleAbs</code>转换了。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><span class=\"hljs-comment\">#载入灰度原图，图像深度为CV_8U</span><br>img_original=cv2.imread(<span class=\"hljs-string\">&#x27;E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg&#x27;</span>,<span class=\"hljs-number\">0</span>)<br><span class=\"hljs-comment\">#原图归一化,实际图像深度已经变为CV_64F</span><br>img_standard=img_original/<span class=\"hljs-number\">255</span><br><span class=\"hljs-comment\">#采用灰度原图求X方向梯度</span><br>original_gradient_X_64F=cv2.Sobel(img_original,cv2.CV_64F,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>)<br>original_gradient_X_64Fto8U=cv2.convertScaleAbs(original_gradient_X_64F)<br><span class=\"hljs-comment\">#采用归一化的图像求X方向梯度</span><br>standard_gradient_X=cv2.Sobel(img_standard,-<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>)<br><span class=\"hljs-comment\">#图像显示</span><br>cv2.imshow(<span class=\"hljs-string\">&#x27;original&#x27;</span>,img_original)<br>cv2.imshow(<span class=\"hljs-string\">&#x27;original_X&#x27;</span>,original_gradient_X_64Fto8U)<br>cv2.imshow(<span class=\"hljs-string\">&#x27;standard_X&#x27;</span>,standard_gradient_X)<br>cv2.waitKey()<br>cv2.destroyAllWindows()<br></code></pre></td></tr></table></figure>\n<p><img src=\"https://picture.mulindya.com/sobel-pic3.png\" alt=\"\"></p>\n<h3 id=\"cv2-addWeighted\">cv2.addWeighted()</h3>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs reasonml\">cv2.add<span class=\"hljs-constructor\">Weighted(<span class=\"hljs-params\">src1</span>, <span class=\"hljs-params\">alpha</span>, <span class=\"hljs-params\">src2</span>, <span class=\"hljs-params\">beta</span>, <span class=\"hljs-params\">gamma</span>[, <span class=\"hljs-params\">dst</span>[, <span class=\"hljs-params\">dtype</span>]])</span> → dst<br></code></pre></td></tr></table></figure>\n<ul>\n<li>src1 输入的第一个数组</li>\n<li>alpha 第一个数组的权重</li>\n<li>src2 输入的第二个数组（与第一个数组有相同的shape）</li>\n<li>beta 第二个数组的权重</li>\n<li>dst 输出的数组名称</li>\n<li>gamma 计算和时所采用的缩放因子，默认为1，无缩放</li>\n<li>dtype 输出图像的深度，-1表示和input相同</li>\n<li></li>\n</ul>\n<blockquote>\n<p>dst = src1 * alpha + src2 * beta + gamma;</p>\n</blockquote>\n<p>注意：由参数说明可以看出，被叠加的两幅图像必须是尺寸相同、类型相同的；并且，当输出图像array的深度为CV_32S时，这个函数就不适用了，这时候就会内存溢出或者算出的结果压根不对。</p>\n<h3 id=\"边缘检测\">边缘检测</h3>\n<p>通过cv2.Sobel()我们可以轻松计算出X,Y方向的梯度大小，根据公式</p>\n<p>$$<br>\nG = \\sqrt{G<sup>2_x+G</sup>2_y}<br>\n$$<br>\n可以求出梯度图像，实际操作时，为了简化运算，我们使用公式</p>\n<p>$$<br>\nG = \\vert{G_x}\\vert+\\vert{G_y}\\vert<br>\n$$</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><span class=\"hljs-comment\">#载入灰度原图，并且归一化</span><br>img_original=cv2.imread(<span class=\"hljs-string\">&#x27;E:\\ShannonT\\\\notebook workspace\\\\images\\\\4.28.9.jpg&#x27;</span>,<span class=\"hljs-number\">0</span>)/<span class=\"hljs-number\">255</span><br><span class=\"hljs-comment\">#分别求X,Y方向的梯度</span><br>grad_X=cv2.Sobel(img_original,-<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>)<br>grad_Y=cv2.Sobel(img_original,-<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span>)<br><span class=\"hljs-comment\">#求梯度图像</span><br>grad=cv2.addWeighted(grad_X,<span class=\"hljs-number\">0.5</span>,grad_Y,<span class=\"hljs-number\">0.5</span>,<span class=\"hljs-number\">0</span>)<br>cv2.imshow(<span class=\"hljs-string\">&#x27;gradient&#x27;</span>,grad)<br></code></pre></td></tr></table></figure>\n<h2 id=\"官方说明\">官方说明</h2>\n<p>当年作者并没有公开发表过论文，仅仅是在一次博士生课题讨论会(1968)上提出(“A 3x3 Isotropic Gradient Operator for Image Processing”)，后在1973年出版的一本专著（“Pattern Classification and Scene Analysis”）的脚注里作为注释出现和公开的。</p>\n<p>详细介绍，请参考以下内容。</p>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/An%20Isotropic%203x3%20Image%20Gradient%20Operator.pdf' width=100% height=450></iframe>\n"},{"title":"获取两个向量角度","date":"2021-09-08T08:46:35.000Z","_content":"\n> 获取两个向量的夹角\n\n![](https://picture.mulindya.com/getAngle.jpg)\n\n比如AB向量表示为[1,-3,5,-1],前两位是A的坐标，后两位是B的坐标。\n\n直接计算出每个向量与x正轴的夹角，然后相减即可；核心的部分使用atan2函数（atan和atan2优先使用atan2）。\n\n> atan与atan2的区别：\n> atan 和 atan2 都是求反正切函数，如：有两个点 point(x1,y1), 和 point(x2,y2);\n> 那么这两个点形成的斜率的角度计算方法分别是：\n> float angle = atan( (y2-y1)/(x2-x1) ); 或 float angle = atan2( y2-y1, x2-x1 );\n> atan2 的优点在于如果 x2-x1等于0 依然可以计算，但是atan函数就会导致程序出错；\n\n\n```python\nimport math\ndef get_angle(vec1,vec2):\n    dx1 = vec1[2] - vec1[0]\n    dy1 = vec1[3] - vec1[1]\n    dx2 = vec2[2] - vec2[0]\n    dy2 = vec2[3] - vec2[1]\n    angle1 = math.atan2(dy1,dx1)*180/math.pi #atan2结果为弧度制(可以处理90度的情况)\n    angle2 = math.atan2(dy2,dx2)*180/math.pi\n    angle = abs(angle1-angle2)\n    if(angle>180):angle = 360-angle\n    return angle\n```\n\n","source":"_posts/img_process/getAngle.md","raw":"---\ntitle: 获取两个向量角度\ntags: [图像处理，角度]\ncategories: [图像处理]\ndate: 2021-09-08 16:46:35\n---\n\n> 获取两个向量的夹角\n\n![](https://picture.mulindya.com/getAngle.jpg)\n\n比如AB向量表示为[1,-3,5,-1],前两位是A的坐标，后两位是B的坐标。\n\n直接计算出每个向量与x正轴的夹角，然后相减即可；核心的部分使用atan2函数（atan和atan2优先使用atan2）。\n\n> atan与atan2的区别：\n> atan 和 atan2 都是求反正切函数，如：有两个点 point(x1,y1), 和 point(x2,y2);\n> 那么这两个点形成的斜率的角度计算方法分别是：\n> float angle = atan( (y2-y1)/(x2-x1) ); 或 float angle = atan2( y2-y1, x2-x1 );\n> atan2 的优点在于如果 x2-x1等于0 依然可以计算，但是atan函数就会导致程序出错；\n\n\n```python\nimport math\ndef get_angle(vec1,vec2):\n    dx1 = vec1[2] - vec1[0]\n    dy1 = vec1[3] - vec1[1]\n    dx2 = vec2[2] - vec2[0]\n    dy2 = vec2[3] - vec2[1]\n    angle1 = math.atan2(dy1,dx1)*180/math.pi #atan2结果为弧度制(可以处理90度的情况)\n    angle2 = math.atan2(dy2,dx2)*180/math.pi\n    angle = abs(angle1-angle2)\n    if(angle>180):angle = 360-angle\n    return angle\n```\n\n","slug":"img_process/getAngle","published":1,"updated":"2022-01-18T08:10:17.055Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p07q0019ast9829h3f9y","content":"<blockquote>\n<p>获取两个向量的夹角</p>\n</blockquote>\n<p><img src=\"https://picture.mulindya.com/getAngle.jpg\" alt=\"\"></p>\n<p>比如AB向量表示为[1,-3,5,-1],前两位是A的坐标，后两位是B的坐标。</p>\n<p>直接计算出每个向量与x正轴的夹角，然后相减即可；核心的部分使用atan2函数（atan和atan2优先使用atan2）。</p>\n<blockquote>\n<p>atan与atan2的区别：<br>\natan 和 atan2 都是求反正切函数，如：有两个点 point(x1,y1), 和 point(x2,y2);<br>\n那么这两个点形成的斜率的角度计算方法分别是：<br>\nfloat angle = atan( (y2-y1)/(x2-x1) ); 或 float angle = atan2( y2-y1, x2-x1 );<br>\natan2 的优点在于如果 x2-x1等于0 依然可以计算，但是atan函数就会导致程序出错；</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> math<br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">get_angle</span>(<span class=\"hljs-params\">vec1,vec2</span>):</span><br>    dx1 = vec1[<span class=\"hljs-number\">2</span>] - vec1[<span class=\"hljs-number\">0</span>]<br>    dy1 = vec1[<span class=\"hljs-number\">3</span>] - vec1[<span class=\"hljs-number\">1</span>]<br>    dx2 = vec2[<span class=\"hljs-number\">2</span>] - vec2[<span class=\"hljs-number\">0</span>]<br>    dy2 = vec2[<span class=\"hljs-number\">3</span>] - vec2[<span class=\"hljs-number\">1</span>]<br>    angle1 = math.atan2(dy1,dx1)*<span class=\"hljs-number\">180</span>/math.pi <span class=\"hljs-comment\">#atan2结果为弧度制(可以处理90度的情况)</span><br>    angle2 = math.atan2(dy2,dx2)*<span class=\"hljs-number\">180</span>/math.pi<br>    angle = <span class=\"hljs-built_in\">abs</span>(angle1-angle2)<br>    <span class=\"hljs-keyword\">if</span>(angle&gt;<span class=\"hljs-number\">180</span>):angle = <span class=\"hljs-number\">360</span>-angle<br>    <span class=\"hljs-keyword\">return</span> angle<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>获取两个向量的夹角</p>\n</blockquote>\n<p><img src=\"https://picture.mulindya.com/getAngle.jpg\" alt=\"\"></p>\n<p>比如AB向量表示为[1,-3,5,-1],前两位是A的坐标，后两位是B的坐标。</p>\n<p>直接计算出每个向量与x正轴的夹角，然后相减即可；核心的部分使用atan2函数（atan和atan2优先使用atan2）。</p>\n<blockquote>\n<p>atan与atan2的区别：<br>\natan 和 atan2 都是求反正切函数，如：有两个点 point(x1,y1), 和 point(x2,y2);<br>\n那么这两个点形成的斜率的角度计算方法分别是：<br>\nfloat angle = atan( (y2-y1)/(x2-x1) ); 或 float angle = atan2( y2-y1, x2-x1 );<br>\natan2 的优点在于如果 x2-x1等于0 依然可以计算，但是atan函数就会导致程序出错；</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> math<br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">get_angle</span>(<span class=\"hljs-params\">vec1,vec2</span>):</span><br>    dx1 = vec1[<span class=\"hljs-number\">2</span>] - vec1[<span class=\"hljs-number\">0</span>]<br>    dy1 = vec1[<span class=\"hljs-number\">3</span>] - vec1[<span class=\"hljs-number\">1</span>]<br>    dx2 = vec2[<span class=\"hljs-number\">2</span>] - vec2[<span class=\"hljs-number\">0</span>]<br>    dy2 = vec2[<span class=\"hljs-number\">3</span>] - vec2[<span class=\"hljs-number\">1</span>]<br>    angle1 = math.atan2(dy1,dx1)*<span class=\"hljs-number\">180</span>/math.pi <span class=\"hljs-comment\">#atan2结果为弧度制(可以处理90度的情况)</span><br>    angle2 = math.atan2(dy2,dx2)*<span class=\"hljs-number\">180</span>/math.pi<br>    angle = <span class=\"hljs-built_in\">abs</span>(angle1-angle2)<br>    <span class=\"hljs-keyword\">if</span>(angle&gt;<span class=\"hljs-number\">180</span>):angle = <span class=\"hljs-number\">360</span>-angle<br>    <span class=\"hljs-keyword\">return</span> angle<br></code></pre></td></tr></table></figure>\n"},{"title":"Sartorius竞赛数据说明","date":"2021-10-21T09:37:18.000Z","math":true,"_content":"\n> 数据说明\n\nData Description\n\nIn this competition we are segmenting neuronal cells in images. The training annotations are provided as run length encoded masks, and the images are in PNG format. The number of images is small, but the number of annotated objects is quite high. The hidden test set is roughly 240 images.\n\n**Note: while predictions are not allowed to overlap, the training labels are provided in full (with overlapping portions included). This is to ensure that models are provided the full data for each object. Removing overlap in predictions is a task for the competitor.**\n\n## Files\n\n**train.csv** - IDs and masks for all training objects. None of this metadata is provided for the test set.\n\n- `id` - unique identifier for object\n- `annotation` - run length encoded pixels for the identified neuronal cell\n- `width` - source image width\n- `height` - source image height\n- `cell_type` - the cell line\n- `plate_time` - time plate was created\n- `sample_date` - date sample was created\n- `sample_id` - sample identifier\n- `elapsed_timedelta` - time since first image taken of sample\n\n**sample_submission.csv** - a sample submission file in the correct format\n\n**train** - train images in PNG format\n\n**test** - test images in PNG format. Only a few test set images are available for download; the remainder can only be accessed by your notebooks when you submit.\n\n**train_semi_supervised** - unlabeled images offered in case you want to use additional data for a semi-supervised approach.\n\n**LIVECell_dataset_2021** - A mirror of the data from [the LIVECell dataset](https://github.com/sartorius-research/LIVECell). LIVECell is the predecessor dataset to this competition. You will find extra data for the `SH-SHY5Y` cell line, plus several other cell lines not covered in the competition dataset that may be of interest for transfer learning.\n\n","source":"_posts/kaggle/kaggle-data-intro.md","raw":"---\ntitle: Sartorius竞赛数据说明\ntags: kaggle\ncategories: kaggle\ndate: 2021-10-21 17:37:18\nmath: true\n---\n\n> 数据说明\n\nData Description\n\nIn this competition we are segmenting neuronal cells in images. The training annotations are provided as run length encoded masks, and the images are in PNG format. The number of images is small, but the number of annotated objects is quite high. The hidden test set is roughly 240 images.\n\n**Note: while predictions are not allowed to overlap, the training labels are provided in full (with overlapping portions included). This is to ensure that models are provided the full data for each object. Removing overlap in predictions is a task for the competitor.**\n\n## Files\n\n**train.csv** - IDs and masks for all training objects. None of this metadata is provided for the test set.\n\n- `id` - unique identifier for object\n- `annotation` - run length encoded pixels for the identified neuronal cell\n- `width` - source image width\n- `height` - source image height\n- `cell_type` - the cell line\n- `plate_time` - time plate was created\n- `sample_date` - date sample was created\n- `sample_id` - sample identifier\n- `elapsed_timedelta` - time since first image taken of sample\n\n**sample_submission.csv** - a sample submission file in the correct format\n\n**train** - train images in PNG format\n\n**test** - test images in PNG format. Only a few test set images are available for download; the remainder can only be accessed by your notebooks when you submit.\n\n**train_semi_supervised** - unlabeled images offered in case you want to use additional data for a semi-supervised approach.\n\n**LIVECell_dataset_2021** - A mirror of the data from [the LIVECell dataset](https://github.com/sartorius-research/LIVECell). LIVECell is the predecessor dataset to this competition. You will find extra data for the `SH-SHY5Y` cell line, plus several other cell lines not covered in the competition dataset that may be of interest for transfer learning.\n\n","slug":"kaggle/kaggle-data-intro","published":1,"updated":"2022-01-18T08:10:17.059Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p07t001cast96hid04z9","content":"<blockquote>\n<p>数据说明</p>\n</blockquote>\n<p>Data Description</p>\n<p>In this competition we are segmenting neuronal cells in images. The training annotations are provided as run length encoded masks, and the images are in PNG format. The number of images is small, but the number of annotated objects is quite high. The hidden test set is roughly 240 images.</p>\n<p><strong>Note: while predictions are not allowed to overlap, the training labels are provided in full (with overlapping portions included). This is to ensure that models are provided the full data for each object. Removing overlap in predictions is a task for the competitor.</strong></p>\n<h2 id=\"Files\">Files</h2>\n<p><strong>train.csv</strong> - IDs and masks for all training objects. None of this metadata is provided for the test set.</p>\n<ul>\n<li><code>id</code> - unique identifier for object</li>\n<li><code>annotation</code> - run length encoded pixels for the identified neuronal cell</li>\n<li><code>width</code> - source image width</li>\n<li><code>height</code> - source image height</li>\n<li><code>cell_type</code> - the cell line</li>\n<li><code>plate_time</code> - time plate was created</li>\n<li><code>sample_date</code> - date sample was created</li>\n<li><code>sample_id</code> - sample identifier</li>\n<li><code>elapsed_timedelta</code> - time since first image taken of sample</li>\n</ul>\n<p><strong>sample_submission.csv</strong> - a sample submission file in the correct format</p>\n<p><strong>train</strong> - train images in PNG format</p>\n<p><strong>test</strong> - test images in PNG format. Only a few test set images are available for download; the remainder can only be accessed by your notebooks when you submit.</p>\n<p><strong>train_semi_supervised</strong> - unlabeled images offered in case you want to use additional data for a semi-supervised approach.</p>\n<p><strong>LIVECell_dataset_2021</strong> - A mirror of the data from <a href=\"https://github.com/sartorius-research/LIVECell\">the LIVECell dataset</a>. LIVECell is the predecessor dataset to this competition. You will find extra data for the <code>SH-SHY5Y</code> cell line, plus several other cell lines not covered in the competition dataset that may be of interest for transfer learning.</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>数据说明</p>\n</blockquote>\n<p>Data Description</p>\n<p>In this competition we are segmenting neuronal cells in images. The training annotations are provided as run length encoded masks, and the images are in PNG format. The number of images is small, but the number of annotated objects is quite high. The hidden test set is roughly 240 images.</p>\n<p><strong>Note: while predictions are not allowed to overlap, the training labels are provided in full (with overlapping portions included). This is to ensure that models are provided the full data for each object. Removing overlap in predictions is a task for the competitor.</strong></p>\n<h2 id=\"Files\">Files</h2>\n<p><strong>train.csv</strong> - IDs and masks for all training objects. None of this metadata is provided for the test set.</p>\n<ul>\n<li><code>id</code> - unique identifier for object</li>\n<li><code>annotation</code> - run length encoded pixels for the identified neuronal cell</li>\n<li><code>width</code> - source image width</li>\n<li><code>height</code> - source image height</li>\n<li><code>cell_type</code> - the cell line</li>\n<li><code>plate_time</code> - time plate was created</li>\n<li><code>sample_date</code> - date sample was created</li>\n<li><code>sample_id</code> - sample identifier</li>\n<li><code>elapsed_timedelta</code> - time since first image taken of sample</li>\n</ul>\n<p><strong>sample_submission.csv</strong> - a sample submission file in the correct format</p>\n<p><strong>train</strong> - train images in PNG format</p>\n<p><strong>test</strong> - test images in PNG format. Only a few test set images are available for download; the remainder can only be accessed by your notebooks when you submit.</p>\n<p><strong>train_semi_supervised</strong> - unlabeled images offered in case you want to use additional data for a semi-supervised approach.</p>\n<p><strong>LIVECell_dataset_2021</strong> - A mirror of the data from <a href=\"https://github.com/sartorius-research/LIVECell\">the LIVECell dataset</a>. LIVECell is the predecessor dataset to this competition. You will find extra data for the <code>SH-SHY5Y</code> cell line, plus several other cell lines not covered in the competition dataset that may be of interest for transfer learning.</p>\n"},{"title":"剑指offer 力扣-21","date":"2021-12-23T07:34:57.000Z","_content":"\n> 合并两个有序链表\n\n## 题目\n将两个升序链表合并为一个新的 升序 链表并返回。新链表是通过拼接给定的两个链表的所有节点组成的。\n\n\n### 示例 1：\n\n```\n输入：l1 = [1,2,4], l2 = [1,3,4]\n输出：[1,1,2,3,4,4]\n```\n\n### 示例 2：\n\n```\n输入：l1 = [], l2 = []\n输出：[]\n```\n\n### 示例 2：\n\n```\n输入：l1 = [], l2 = [0]\n输出：[0]\n```\n\n### 提示：\n\n- 两个链表的节点数目范围是 [0, 50]\n- -100 <= Node.val <= 100\n- l1 和 l2 均按 非递减顺序 排列\n\n## 题解\n\n这里使用的是链表，使用两个变量p1，p2分别指向两个链表，通过比较大小确定p的next的指向。最后将剩余的元素添加至p后。\n\n```python\n# Definition for singly-linked list.\n# class ListNode:\n#     def __init__(self, val=0, next=None):\n#         self.val = val\n#         self.next = next\nclass Solution:\n    def mergeTwoLists(self, list1: Optional[ListNode], list2: Optional[ListNode]) -> Optional[ListNode]:\n        p1,p2 = list1,list2\n        l = ListNode()\n        p = l\n        while(p1 and p2):\n            if p1.val<p2.val:\n                p.next = p1\n                p1 = p1.next\n            else:\n                p.next = p2\n                p2 = p2.next\n            p = p.next\n        p.next = p1 if p1 else p2\n        return l.next\n```\n\n","source":"_posts/leetcode/leetcode-21.md","raw":"---\ntitle: 剑指offer 力扣-21\ntags: [剑指,排序]\ncategories: [剑指,排序]\ndate: 2021-12-23 15:34:57\n---\n\n> 合并两个有序链表\n\n## 题目\n将两个升序链表合并为一个新的 升序 链表并返回。新链表是通过拼接给定的两个链表的所有节点组成的。\n\n\n### 示例 1：\n\n```\n输入：l1 = [1,2,4], l2 = [1,3,4]\n输出：[1,1,2,3,4,4]\n```\n\n### 示例 2：\n\n```\n输入：l1 = [], l2 = []\n输出：[]\n```\n\n### 示例 2：\n\n```\n输入：l1 = [], l2 = [0]\n输出：[0]\n```\n\n### 提示：\n\n- 两个链表的节点数目范围是 [0, 50]\n- -100 <= Node.val <= 100\n- l1 和 l2 均按 非递减顺序 排列\n\n## 题解\n\n这里使用的是链表，使用两个变量p1，p2分别指向两个链表，通过比较大小确定p的next的指向。最后将剩余的元素添加至p后。\n\n```python\n# Definition for singly-linked list.\n# class ListNode:\n#     def __init__(self, val=0, next=None):\n#         self.val = val\n#         self.next = next\nclass Solution:\n    def mergeTwoLists(self, list1: Optional[ListNode], list2: Optional[ListNode]) -> Optional[ListNode]:\n        p1,p2 = list1,list2\n        l = ListNode()\n        p = l\n        while(p1 and p2):\n            if p1.val<p2.val:\n                p.next = p1\n                p1 = p1.next\n            else:\n                p.next = p2\n                p2 = p2.next\n            p = p.next\n        p.next = p1 if p1 else p2\n        return l.next\n```\n\n","slug":"leetcode/leetcode-21","published":1,"updated":"2022-01-18T08:10:17.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p07x001east96z2ndmp1","content":"<blockquote>\n<p>合并两个有序链表</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>将两个升序链表合并为一个新的 升序 链表并返回。新链表是通过拼接给定的两个链表的所有节点组成的。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：l1 = <span class=\"hljs-comment\">[1,2,4]</span>, l2 = <span class=\"hljs-comment\">[1,3,4]</span><br>输出：<span class=\"hljs-comment\">[1,1,2,3,4,4]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：l1 = <span class=\"hljs-comment\">[]</span>, l2 = <span class=\"hljs-comment\">[]</span><br>输出：<span class=\"hljs-comment\">[]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：-2\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：l1 = <span class=\"hljs-comment\">[]</span>, l2 = <span class=\"hljs-comment\">[0]</span><br>输出：<span class=\"hljs-comment\">[0]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>两个链表的节点数目范围是 [0, 50]</li>\n<li>-100 &lt;= Node.val &lt;= 100</li>\n<li>l1 和 l2 均按 非递减顺序 排列</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>这里使用的是链表，使用两个变量p1，p2分别指向两个链表，通过比较大小确定p的next的指向。最后将剩余的元素添加至p后。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for singly-linked list.</span><br><span class=\"hljs-comment\"># class ListNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, val=0, next=None):</span><br><span class=\"hljs-comment\">#         self.val = val</span><br><span class=\"hljs-comment\">#         self.next = next</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">mergeTwoLists</span>(<span class=\"hljs-params\">self, list1: <span class=\"hljs-type\">Optional</span>[ListNode], list2: <span class=\"hljs-type\">Optional</span>[ListNode]</span>) -&gt; <span class=\"hljs-type\">Optional</span>[ListNode]:</span><br>        p1,p2 = list1,list2<br>        l = ListNode()<br>        p = l<br>        <span class=\"hljs-keyword\">while</span>(p1 <span class=\"hljs-keyword\">and</span> p2):<br>            <span class=\"hljs-keyword\">if</span> p1.val&lt;p2.val:<br>                p.<span class=\"hljs-built_in\">next</span> = p1<br>                p1 = p1.<span class=\"hljs-built_in\">next</span><br>            <span class=\"hljs-keyword\">else</span>:<br>                p.<span class=\"hljs-built_in\">next</span> = p2<br>                p2 = p2.<span class=\"hljs-built_in\">next</span><br>            p = p.<span class=\"hljs-built_in\">next</span><br>        p.<span class=\"hljs-built_in\">next</span> = p1 <span class=\"hljs-keyword\">if</span> p1 <span class=\"hljs-keyword\">else</span> p2<br>        <span class=\"hljs-keyword\">return</span> l.<span class=\"hljs-built_in\">next</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>合并两个有序链表</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>将两个升序链表合并为一个新的 升序 链表并返回。新链表是通过拼接给定的两个链表的所有节点组成的。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：l1 = <span class=\"hljs-comment\">[1,2,4]</span>, l2 = <span class=\"hljs-comment\">[1,3,4]</span><br>输出：<span class=\"hljs-comment\">[1,1,2,3,4,4]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：l1 = <span class=\"hljs-comment\">[]</span>, l2 = <span class=\"hljs-comment\">[]</span><br>输出：<span class=\"hljs-comment\">[]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：-2\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：l1 = <span class=\"hljs-comment\">[]</span>, l2 = <span class=\"hljs-comment\">[0]</span><br>输出：<span class=\"hljs-comment\">[0]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>两个链表的节点数目范围是 [0, 50]</li>\n<li>-100 &lt;= Node.val &lt;= 100</li>\n<li>l1 和 l2 均按 非递减顺序 排列</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>这里使用的是链表，使用两个变量p1，p2分别指向两个链表，通过比较大小确定p的next的指向。最后将剩余的元素添加至p后。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for singly-linked list.</span><br><span class=\"hljs-comment\"># class ListNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, val=0, next=None):</span><br><span class=\"hljs-comment\">#         self.val = val</span><br><span class=\"hljs-comment\">#         self.next = next</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">mergeTwoLists</span>(<span class=\"hljs-params\">self, list1: <span class=\"hljs-type\">Optional</span>[ListNode], list2: <span class=\"hljs-type\">Optional</span>[ListNode]</span>) -&gt; <span class=\"hljs-type\">Optional</span>[ListNode]:</span><br>        p1,p2 = list1,list2<br>        l = ListNode()<br>        p = l<br>        <span class=\"hljs-keyword\">while</span>(p1 <span class=\"hljs-keyword\">and</span> p2):<br>            <span class=\"hljs-keyword\">if</span> p1.val&lt;p2.val:<br>                p.<span class=\"hljs-built_in\">next</span> = p1<br>                p1 = p1.<span class=\"hljs-built_in\">next</span><br>            <span class=\"hljs-keyword\">else</span>:<br>                p.<span class=\"hljs-built_in\">next</span> = p2<br>                p2 = p2.<span class=\"hljs-built_in\">next</span><br>            p = p.<span class=\"hljs-built_in\">next</span><br>        p.<span class=\"hljs-built_in\">next</span> = p1 <span class=\"hljs-keyword\">if</span> p1 <span class=\"hljs-keyword\">else</span> p2<br>        <span class=\"hljs-keyword\">return</span> l.<span class=\"hljs-built_in\">next</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer03 数组中重复的数字","date":"2021-08-11T02:53:45.000Z","_content":"\n>数组中重复的数字\n\n## 题目\n\n找出数组中重复的数字。\n\n\n在一个长度为 n 的数组 nums 里的所有数字都在 0～n-1 的范围内。数组中某些数字是重复的，但不知道有几个数字重复了，也不知道每个数字重复了几次。请找出数组中任意一个重复的数字。\n\n### 示例 1：\n\n```\n输入：\n[2, 3, 1, 0, 2, 5, 3]\n输出：2 或 3 \n```\n\n### 提示：\n\n- 2 <= n <= 100000\n\n## 题解\n\n创建一个flag数组进行标记；\n\n指定大小的数组创建\n\n**填坑：** <font color=red> 不要使用后者,因为后者是浅拷贝，改变某一元素，该列均会改变</font>\n\n- 一维\n\n  a = [0 for _ in range(n)]  《=》  a = [0] * n \n\n- 二维\n\n  a = [[0 for col in range(m)] for row in range(n)]  *# 创建一个n\\*m的二维矩阵a，每个初值都是0*   《=》  a = [[0] \\*m] \\*n \n\n```python\nclass Solution:\n    def findRepeatNumber(self, nums: List[int]) -> int:\n        flag = [0 for _ in range(len(nums))] #创建长度为nums的数组 也可以用[0]*n\n        for x in nums:\n            flag[x] += 1\n            if(flag[x]>1):\n                return x\n```\n\n<font color=purple size=4>实际上无需构建新的数组进行标记，可以直接使用set的长度进行判断。或者使用sort，使用list的sort方法。判断相邻的元素是否相等。</font>\n\n方法1：利用python set的无序不重复特性：利用Python中的set集合为无序不重复集合，通过判断temp_set的长度确定是否是重复数字。\n\n```python\nclass Solution:\n    def findRepeatNumber(self, nums: List[int]) -> int:\n        temp_set = set()\n        repeat = -1\n        for i in range(len(nums)):\n            temp_set.add(nums[i])\n            if len(temp_set) < i + 1:\n                repeat = nums[i]\n                break\n        return repeat\n```\n\n方法2：利用python的sort函数排序，然后计算相邻两个数据是否相等即可。\n\n```python\nclass Solution:\n    def findRepeatNumber(self, nums: List[int]) -> int:\n        nums.sort()\n        for i in range(len(nums)-1):\n            if nums[i]==nums[i+1]:\n                return nums[i]\n```\n","source":"_posts/leetcode/leetcode-offer03.md","raw":"---\ntitle: 剑指offer03 数组中重复的数字\ntags: [剑指,数组,idea]\ncategories: [剑指,数组]\ndate: 2021-08-11 10:53:45\n---\n\n>数组中重复的数字\n\n## 题目\n\n找出数组中重复的数字。\n\n\n在一个长度为 n 的数组 nums 里的所有数字都在 0～n-1 的范围内。数组中某些数字是重复的，但不知道有几个数字重复了，也不知道每个数字重复了几次。请找出数组中任意一个重复的数字。\n\n### 示例 1：\n\n```\n输入：\n[2, 3, 1, 0, 2, 5, 3]\n输出：2 或 3 \n```\n\n### 提示：\n\n- 2 <= n <= 100000\n\n## 题解\n\n创建一个flag数组进行标记；\n\n指定大小的数组创建\n\n**填坑：** <font color=red> 不要使用后者,因为后者是浅拷贝，改变某一元素，该列均会改变</font>\n\n- 一维\n\n  a = [0 for _ in range(n)]  《=》  a = [0] * n \n\n- 二维\n\n  a = [[0 for col in range(m)] for row in range(n)]  *# 创建一个n\\*m的二维矩阵a，每个初值都是0*   《=》  a = [[0] \\*m] \\*n \n\n```python\nclass Solution:\n    def findRepeatNumber(self, nums: List[int]) -> int:\n        flag = [0 for _ in range(len(nums))] #创建长度为nums的数组 也可以用[0]*n\n        for x in nums:\n            flag[x] += 1\n            if(flag[x]>1):\n                return x\n```\n\n<font color=purple size=4>实际上无需构建新的数组进行标记，可以直接使用set的长度进行判断。或者使用sort，使用list的sort方法。判断相邻的元素是否相等。</font>\n\n方法1：利用python set的无序不重复特性：利用Python中的set集合为无序不重复集合，通过判断temp_set的长度确定是否是重复数字。\n\n```python\nclass Solution:\n    def findRepeatNumber(self, nums: List[int]) -> int:\n        temp_set = set()\n        repeat = -1\n        for i in range(len(nums)):\n            temp_set.add(nums[i])\n            if len(temp_set) < i + 1:\n                repeat = nums[i]\n                break\n        return repeat\n```\n\n方法2：利用python的sort函数排序，然后计算相邻两个数据是否相等即可。\n\n```python\nclass Solution:\n    def findRepeatNumber(self, nums: List[int]) -> int:\n        nums.sort()\n        for i in range(len(nums)-1):\n            if nums[i]==nums[i+1]:\n                return nums[i]\n```\n","slug":"leetcode/leetcode-offer03","published":1,"updated":"2022-01-18T08:10:17.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p080001hast9901oek34","content":"<blockquote>\n<p>数组中重复的数字</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>找出数组中重复的数字。</p>\n<p>在一个长度为 n 的数组 nums 里的所有数字都在 0～n-1 的范围内。数组中某些数字是重复的，但不知道有几个数字重复了，也不知道每个数字重复了几次。请找出数组中任意一个重复的数字。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight accesslog\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs accesslog\">输入：<br><span class=\"hljs-string\">[2, 3, 1, 0, 2, 5, 3]</span><br>输出：<span class=\"hljs-number\">2</span> 或 <span class=\"hljs-number\">3</span> <br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>2 &lt;= n &lt;= 100000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>创建一个flag数组进行标记；</p>\n<p>指定大小的数组创建</p>\n<p><strong>填坑：</strong> <font color=\"red\"> 不要使用后者,因为后者是浅拷贝，改变某一元素，该列均会改变</font></p>\n<ul>\n<li>\n<p>一维</p>\n<p>a = [0 for _ in range(n)]  《=》  a = [0] * n</p>\n</li>\n<li>\n<p>二维</p>\n<p>a = [[0 for col in range(m)] for row in range(n)]  <em># 创建一个n*m的二维矩阵a，每个初值都是0</em>   《=》  a = [[0] *m] *n</p>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findRepeatNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        flag = [<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(nums))] <span class=\"hljs-comment\">#创建长度为nums的数组 也可以用[0]*n</span><br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> nums:<br>            flag[x] += <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span>(flag[x]&gt;<span class=\"hljs-number\">1</span>):<br>                <span class=\"hljs-keyword\">return</span> x<br></code></pre></td></tr></tbody></table></figure>\n<p><font color=\"purple\" size=\"4\">实际上无需构建新的数组进行标记，可以直接使用set的长度进行判断。或者使用sort，使用list的sort方法。判断相邻的元素是否相等。</font></p>\n<p>方法1：利用python set的无序不重复特性：利用Python中的set集合为无序不重复集合，通过判断temp_set的长度确定是否是重复数字。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findRepeatNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        temp_set = <span class=\"hljs-built_in\">set</span>()<br>        repeat = -<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(nums)):<br>            temp_set.add(nums[i])<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(temp_set) &lt; i + <span class=\"hljs-number\">1</span>:<br>                repeat = nums[i]<br>                <span class=\"hljs-keyword\">break</span><br>        <span class=\"hljs-keyword\">return</span> repeat<br></code></pre></td></tr></tbody></table></figure>\n<p>方法2：利用python的sort函数排序，然后计算相邻两个数据是否相等即可。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findRepeatNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        nums.sort()<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(nums)-<span class=\"hljs-number\">1</span>):<br>            <span class=\"hljs-keyword\">if</span> nums[i]==nums[i+<span class=\"hljs-number\">1</span>]:<br>                <span class=\"hljs-keyword\">return</span> nums[i]<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>数组中重复的数字</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>找出数组中重复的数字。</p>\n<p>在一个长度为 n 的数组 nums 里的所有数字都在 0～n-1 的范围内。数组中某些数字是重复的，但不知道有几个数字重复了，也不知道每个数字重复了几次。请找出数组中任意一个重复的数字。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs accesslog\">输入：<br><span class=\"hljs-string\">[2, 3, 1, 0, 2, 5, 3]</span><br>输出：<span class=\"hljs-number\">2</span> 或 <span class=\"hljs-number\">3</span> <br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>2 &lt;= n &lt;= 100000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>创建一个flag数组进行标记；</p>\n<p>指定大小的数组创建</p>\n<p><strong>填坑：</strong> <font color=red> 不要使用后者,因为后者是浅拷贝，改变某一元素，该列均会改变</font></p>\n<ul>\n<li>\n<p>一维</p>\n<p>a = [0 for _ in range(n)]  《=》  a = [0] * n</p>\n</li>\n<li>\n<p>二维</p>\n<p>a = [[0 for col in range(m)] for row in range(n)]  <em># 创建一个n*m的二维矩阵a，每个初值都是0</em>   《=》  a = [[0] *m] *n</p>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findRepeatNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        flag = [<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(nums))] <span class=\"hljs-comment\">#创建长度为nums的数组 也可以用[0]*n</span><br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> nums:<br>            flag[x] += <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span>(flag[x]&gt;<span class=\"hljs-number\">1</span>):<br>                <span class=\"hljs-keyword\">return</span> x<br></code></pre></td></tr></table></figure>\n<p><font color=purple size=4>实际上无需构建新的数组进行标记，可以直接使用set的长度进行判断。或者使用sort，使用list的sort方法。判断相邻的元素是否相等。</font></p>\n<p>方法1：利用python set的无序不重复特性：利用Python中的set集合为无序不重复集合，通过判断temp_set的长度确定是否是重复数字。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findRepeatNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        temp_set = <span class=\"hljs-built_in\">set</span>()<br>        repeat = -<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(nums)):<br>            temp_set.add(nums[i])<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(temp_set) &lt; i + <span class=\"hljs-number\">1</span>:<br>                repeat = nums[i]<br>                <span class=\"hljs-keyword\">break</span><br>        <span class=\"hljs-keyword\">return</span> repeat<br></code></pre></td></tr></table></figure>\n<p>方法2：利用python的sort函数排序，然后计算相邻两个数据是否相等即可。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findRepeatNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        nums.sort()<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(nums)-<span class=\"hljs-number\">1</span>):<br>            <span class=\"hljs-keyword\">if</span> nums[i]==nums[i+<span class=\"hljs-number\">1</span>]:<br>                <span class=\"hljs-keyword\">return</span> nums[i]<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer04 二维数组中的查找","date":"2021-08-11T10:07:12.000Z","_content":"\n>二维数组中的查找\n\n## 题目\n\n在一个 n * m 的二维数组中，每一行都按照从左到右递增的顺序排序，每一列都按照从上到下递增的顺序排序。请完成一个高效的函数，输入这样的一个二维数组和一个整数，判断数组中是否含有该整数。\n\n### 示例 1：\n\n现有矩阵 matrix 如下：\n\n```\n[\n  [1,   4,  7, 11, 15],\n  [2,   5,  8, 12, 19],\n  [3,   6,  9, 16, 22],\n  [10, 13, 14, 17, 24],\n  [18, 21, 23, 26, 30]\n]\n```\n\n给定 target = `5`，返回 `true`。\n\n给定 target = `20`，返回 `false`。\n\n### 提示：\n\n- 0 <= n <= 1000\n- 0 <= m <= 1000\n\n## 题解\n\n当开始想要采用二分法的思想进行判断。但是发现二分只能考虑到左上和右下块的内容。右上和左下的内容无法判断其大小划分。所以会有视觉盲区无法二分缩小区域。\n\n<font color=purple>二维数组无法用二分法，因为其“二分”是分为4份，无法充分涵盖进行判断，会出现错误。</font>\n\n```python\nclass Solution:\n    def findNumberIn2DArray(self, matrix: List[List[int]], target: int) -> bool:\n        if not(matrix): return False\n        si,sj = 0,0\n        ei,ej = len(matrix)-1,len(matrix[0])-1\n        def isExit(matrix: List[List[int]], si, sj, ei, ej, target: int):\n            if not (si<=ei and sj<=ej): #先判断范围\n                return False\n            if(target<matrix[si][sj] or target>matrix[ei][ej]): return False\n            if(target==matrix[si][sj] or target==matrix[ei][ej]): return True\n            mi,mj = int((si+ei)/2),int((sj+ej)/2)\n            if(target==matrix[mi][mj]):\n                return True\n            elif (target>matrix[mi][mj]):\n                return isExit(matrix,mi+1,mj,ei,ej,target) or isExit(matrix,mi,mj+1,ei,ej,target)\n            else:\n                return isExit(matrix,si,sj,mi-1,mj,target) or isExit(matrix,si,sj,mi,mj-1,target)\n        return isExit(matrix,si,sj,ei,ej,target)\n```\n使用线性查找的方法，可以使得复杂度从暴力的O(n*m)到O(n+m)\n思想是选取左下角或者右上角，周围不均衡的点开始进行判断，这样才知道应该向哪个方向缩小区域.\n\n<font color=hotpink>例如此处是选取左下角作为初始，向上此列逐渐变小，向右此行逐渐变大。因此target如果比此点小，就向上移动查找，如果比此点大，就向右查找。</font>\n\n```python\nclass Solution:\n    def findNumberIn2DArray(self, matrix: List[List[int]], target: int) -> bool:\n        if not(matrix): return False\n        i,j = len(matrix)-1,0\n        while(i>=0 and j<=len(matrix[0])-1):\n            if(target==matrix[i][j]):return True\n            elif(target>matrix[i][j]):j += 1\n            else:i -= 1\n        return False\n```\n\n","source":"_posts/leetcode/leetcode-offer04.md","raw":"---\ntitle: 剑指offer04 二维数组中的查找\ntags: [剑指,数组查找,idea]\ncategories: [剑指,数组]\ndate: 2021-08-11 18:07:12\n---\n\n>二维数组中的查找\n\n## 题目\n\n在一个 n * m 的二维数组中，每一行都按照从左到右递增的顺序排序，每一列都按照从上到下递增的顺序排序。请完成一个高效的函数，输入这样的一个二维数组和一个整数，判断数组中是否含有该整数。\n\n### 示例 1：\n\n现有矩阵 matrix 如下：\n\n```\n[\n  [1,   4,  7, 11, 15],\n  [2,   5,  8, 12, 19],\n  [3,   6,  9, 16, 22],\n  [10, 13, 14, 17, 24],\n  [18, 21, 23, 26, 30]\n]\n```\n\n给定 target = `5`，返回 `true`。\n\n给定 target = `20`，返回 `false`。\n\n### 提示：\n\n- 0 <= n <= 1000\n- 0 <= m <= 1000\n\n## 题解\n\n当开始想要采用二分法的思想进行判断。但是发现二分只能考虑到左上和右下块的内容。右上和左下的内容无法判断其大小划分。所以会有视觉盲区无法二分缩小区域。\n\n<font color=purple>二维数组无法用二分法，因为其“二分”是分为4份，无法充分涵盖进行判断，会出现错误。</font>\n\n```python\nclass Solution:\n    def findNumberIn2DArray(self, matrix: List[List[int]], target: int) -> bool:\n        if not(matrix): return False\n        si,sj = 0,0\n        ei,ej = len(matrix)-1,len(matrix[0])-1\n        def isExit(matrix: List[List[int]], si, sj, ei, ej, target: int):\n            if not (si<=ei and sj<=ej): #先判断范围\n                return False\n            if(target<matrix[si][sj] or target>matrix[ei][ej]): return False\n            if(target==matrix[si][sj] or target==matrix[ei][ej]): return True\n            mi,mj = int((si+ei)/2),int((sj+ej)/2)\n            if(target==matrix[mi][mj]):\n                return True\n            elif (target>matrix[mi][mj]):\n                return isExit(matrix,mi+1,mj,ei,ej,target) or isExit(matrix,mi,mj+1,ei,ej,target)\n            else:\n                return isExit(matrix,si,sj,mi-1,mj,target) or isExit(matrix,si,sj,mi,mj-1,target)\n        return isExit(matrix,si,sj,ei,ej,target)\n```\n使用线性查找的方法，可以使得复杂度从暴力的O(n*m)到O(n+m)\n思想是选取左下角或者右上角，周围不均衡的点开始进行判断，这样才知道应该向哪个方向缩小区域.\n\n<font color=hotpink>例如此处是选取左下角作为初始，向上此列逐渐变小，向右此行逐渐变大。因此target如果比此点小，就向上移动查找，如果比此点大，就向右查找。</font>\n\n```python\nclass Solution:\n    def findNumberIn2DArray(self, matrix: List[List[int]], target: int) -> bool:\n        if not(matrix): return False\n        i,j = len(matrix)-1,0\n        while(i>=0 and j<=len(matrix[0])-1):\n            if(target==matrix[i][j]):return True\n            elif(target>matrix[i][j]):j += 1\n            else:i -= 1\n        return False\n```\n\n","slug":"leetcode/leetcode-offer04","published":1,"updated":"2022-01-18T08:10:17.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p084001mast93pib4j1t","content":"<blockquote>\n<p>二维数组中的查找</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>在一个 n * m 的二维数组中，每一行都按照从左到右递增的顺序排序，每一列都按照从上到下递增的顺序排序。请完成一个高效的函数，输入这样的一个二维数组和一个整数，判断数组中是否含有该整数。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p>现有矩阵 matrix 如下：</p>\n<figure class=\"highlight json\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">[<br>  [<span class=\"hljs-number\">1</span>,   <span class=\"hljs-number\">4</span>,  <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">11</span>, <span class=\"hljs-number\">15</span>],<br>  [<span class=\"hljs-number\">2</span>,   <span class=\"hljs-number\">5</span>,  <span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">19</span>],<br>  [<span class=\"hljs-number\">3</span>,   <span class=\"hljs-number\">6</span>,  <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">22</span>],<br>  [<span class=\"hljs-number\">10</span>, <span class=\"hljs-number\">13</span>, <span class=\"hljs-number\">14</span>, <span class=\"hljs-number\">17</span>, <span class=\"hljs-number\">24</span>],<br>  [<span class=\"hljs-number\">18</span>, <span class=\"hljs-number\">21</span>, <span class=\"hljs-number\">23</span>, <span class=\"hljs-number\">26</span>, <span class=\"hljs-number\">30</span>]<br>]<br></code></pre></td></tr></tbody></table></figure>\n<p>给定 target = <code>5</code>，返回 <code>true</code>。</p>\n<p>给定 target = <code>20</code>，返回 <code>false</code>。</p>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= n &lt;= 1000</li>\n<li>0 &lt;= m &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>当开始想要采用二分法的思想进行判断。但是发现二分只能考虑到左上和右下块的内容。右上和左下的内容无法判断其大小划分。所以会有视觉盲区无法二分缩小区域。</p>\n<p><font color=\"purple\">二维数组无法用二分法，因为其“二分”是分为4份，无法充分涵盖进行判断，会出现错误。</font></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findNumberIn2DArray</span>(<span class=\"hljs-params\">self, matrix: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]], target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(matrix): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>        si,sj = <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span><br>        ei,ej = <span class=\"hljs-built_in\">len</span>(matrix)-<span class=\"hljs-number\">1</span>,<span class=\"hljs-built_in\">len</span>(matrix[<span class=\"hljs-number\">0</span>])-<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isExit</span>(<span class=\"hljs-params\">matrix: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]], si, sj, ei, ej, target: <span class=\"hljs-built_in\">int</span></span>):</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> (si&lt;=ei <span class=\"hljs-keyword\">and</span> sj&lt;=ej): <span class=\"hljs-comment\">#先判断范围</span><br>                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>            <span class=\"hljs-keyword\">if</span>(target&lt;matrix[si][sj] <span class=\"hljs-keyword\">or</span> target&gt;matrix[ei][ej]): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>            <span class=\"hljs-keyword\">if</span>(target==matrix[si][sj] <span class=\"hljs-keyword\">or</span> target==matrix[ei][ej]): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>            mi,mj = <span class=\"hljs-built_in\">int</span>((si+ei)/<span class=\"hljs-number\">2</span>),<span class=\"hljs-built_in\">int</span>((sj+ej)/<span class=\"hljs-number\">2</span>)<br>            <span class=\"hljs-keyword\">if</span>(target==matrix[mi][mj]):<br>                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>            <span class=\"hljs-keyword\">elif</span> (target&gt;matrix[mi][mj]):<br>                <span class=\"hljs-keyword\">return</span> isExit(matrix,mi+<span class=\"hljs-number\">1</span>,mj,ei,ej,target) <span class=\"hljs-keyword\">or</span> isExit(matrix,mi,mj+<span class=\"hljs-number\">1</span>,ei,ej,target)<br>            <span class=\"hljs-keyword\">else</span>:<br>                <span class=\"hljs-keyword\">return</span> isExit(matrix,si,sj,mi-<span class=\"hljs-number\">1</span>,mj,target) <span class=\"hljs-keyword\">or</span> isExit(matrix,si,sj,mi,mj-<span class=\"hljs-number\">1</span>,target)<br>        <span class=\"hljs-keyword\">return</span> isExit(matrix,si,sj,ei,ej,target)<br></code></pre></td></tr></tbody></table></figure>\n<p>使用线性查找的方法，可以使得复杂度从暴力的O(n*m)到O(n+m)<br>\n思想是选取左下角或者右上角，周围不均衡的点开始进行判断，这样才知道应该向哪个方向缩小区域.</p>\n<p><font color=\"hotpink\">例如此处是选取左下角作为初始，向上此列逐渐变小，向右此行逐渐变大。因此target如果比此点小，就向上移动查找，如果比此点大，就向右查找。</font></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findNumberIn2DArray</span>(<span class=\"hljs-params\">self, matrix: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]], target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(matrix): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>        i,j = <span class=\"hljs-built_in\">len</span>(matrix)-<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">while</span>(i&gt;=<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> j&lt;=<span class=\"hljs-built_in\">len</span>(matrix[<span class=\"hljs-number\">0</span>])-<span class=\"hljs-number\">1</span>):<br>            <span class=\"hljs-keyword\">if</span>(target==matrix[i][j]):<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>            <span class=\"hljs-keyword\">elif</span>(target&gt;matrix[i][j]):j += <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>:i -= <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>二维数组中的查找</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>在一个 n * m 的二维数组中，每一行都按照从左到右递增的顺序排序，每一列都按照从上到下递增的顺序排序。请完成一个高效的函数，输入这样的一个二维数组和一个整数，判断数组中是否含有该整数。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p>现有矩阵 matrix 如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">[<br>  [<span class=\"hljs-number\">1</span>,   <span class=\"hljs-number\">4</span>,  <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">11</span>, <span class=\"hljs-number\">15</span>],<br>  [<span class=\"hljs-number\">2</span>,   <span class=\"hljs-number\">5</span>,  <span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">19</span>],<br>  [<span class=\"hljs-number\">3</span>,   <span class=\"hljs-number\">6</span>,  <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">22</span>],<br>  [<span class=\"hljs-number\">10</span>, <span class=\"hljs-number\">13</span>, <span class=\"hljs-number\">14</span>, <span class=\"hljs-number\">17</span>, <span class=\"hljs-number\">24</span>],<br>  [<span class=\"hljs-number\">18</span>, <span class=\"hljs-number\">21</span>, <span class=\"hljs-number\">23</span>, <span class=\"hljs-number\">26</span>, <span class=\"hljs-number\">30</span>]<br>]<br></code></pre></td></tr></table></figure>\n<p>给定 target = <code>5</code>，返回 <code>true</code>。</p>\n<p>给定 target = <code>20</code>，返回 <code>false</code>。</p>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= n &lt;= 1000</li>\n<li>0 &lt;= m &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>当开始想要采用二分法的思想进行判断。但是发现二分只能考虑到左上和右下块的内容。右上和左下的内容无法判断其大小划分。所以会有视觉盲区无法二分缩小区域。</p>\n<p><font color=purple>二维数组无法用二分法，因为其“二分”是分为4份，无法充分涵盖进行判断，会出现错误。</font></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findNumberIn2DArray</span>(<span class=\"hljs-params\">self, matrix: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]], target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(matrix): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>        si,sj = <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span><br>        ei,ej = <span class=\"hljs-built_in\">len</span>(matrix)-<span class=\"hljs-number\">1</span>,<span class=\"hljs-built_in\">len</span>(matrix[<span class=\"hljs-number\">0</span>])-<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isExit</span>(<span class=\"hljs-params\">matrix: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]], si, sj, ei, ej, target: <span class=\"hljs-built_in\">int</span></span>):</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> (si&lt;=ei <span class=\"hljs-keyword\">and</span> sj&lt;=ej): <span class=\"hljs-comment\">#先判断范围</span><br>                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>            <span class=\"hljs-keyword\">if</span>(target&lt;matrix[si][sj] <span class=\"hljs-keyword\">or</span> target&gt;matrix[ei][ej]): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>            <span class=\"hljs-keyword\">if</span>(target==matrix[si][sj] <span class=\"hljs-keyword\">or</span> target==matrix[ei][ej]): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>            mi,mj = <span class=\"hljs-built_in\">int</span>((si+ei)/<span class=\"hljs-number\">2</span>),<span class=\"hljs-built_in\">int</span>((sj+ej)/<span class=\"hljs-number\">2</span>)<br>            <span class=\"hljs-keyword\">if</span>(target==matrix[mi][mj]):<br>                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>            <span class=\"hljs-keyword\">elif</span> (target&gt;matrix[mi][mj]):<br>                <span class=\"hljs-keyword\">return</span> isExit(matrix,mi+<span class=\"hljs-number\">1</span>,mj,ei,ej,target) <span class=\"hljs-keyword\">or</span> isExit(matrix,mi,mj+<span class=\"hljs-number\">1</span>,ei,ej,target)<br>            <span class=\"hljs-keyword\">else</span>:<br>                <span class=\"hljs-keyword\">return</span> isExit(matrix,si,sj,mi-<span class=\"hljs-number\">1</span>,mj,target) <span class=\"hljs-keyword\">or</span> isExit(matrix,si,sj,mi,mj-<span class=\"hljs-number\">1</span>,target)<br>        <span class=\"hljs-keyword\">return</span> isExit(matrix,si,sj,ei,ej,target)<br></code></pre></td></tr></table></figure>\n<p>使用线性查找的方法，可以使得复杂度从暴力的O(n*m)到O(n+m)<br>\n思想是选取左下角或者右上角，周围不均衡的点开始进行判断，这样才知道应该向哪个方向缩小区域.</p>\n<p><font color=hotpink>例如此处是选取左下角作为初始，向上此列逐渐变小，向右此行逐渐变大。因此target如果比此点小，就向上移动查找，如果比此点大，就向右查找。</font></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findNumberIn2DArray</span>(<span class=\"hljs-params\">self, matrix: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]], target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(matrix): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>        i,j = <span class=\"hljs-built_in\">len</span>(matrix)-<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">while</span>(i&gt;=<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> j&lt;=<span class=\"hljs-built_in\">len</span>(matrix[<span class=\"hljs-number\">0</span>])-<span class=\"hljs-number\">1</span>):<br>            <span class=\"hljs-keyword\">if</span>(target==matrix[i][j]):<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>            <span class=\"hljs-keyword\">elif</span>(target&gt;matrix[i][j]):j += <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>:i -= <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer05 替换空格","date":"2021-08-11T10:36:13.000Z","_content":"\n>替换空格\n\n## 题目\n\n请实现一个函数，把字符串 `s` 中的每个空格替换成\"%20\"。\n\n### 示例 1：\n\n```\n输入：s = \"We are happy.\"\n输出：\"We%20are%20happy.\"\n```\n\n### 提示：\n\n- 0 <= s 的长度 <= 10000\n\n## 题解\n\n直接替换即可。相当于使用replace方法\n\n```python\nclass Solution:\n    def replaceSpace(self, s: str) -> str:\n       #相当于现成函数 return s.replace(\" \",\"%20\")\n        result = \"\"\n        for x in s:\n            if x==' ':\n                x = \"%20\"\n            result += x\n        return result\n```\n\n","source":"_posts/leetcode/leetcode-offer05.md","raw":"---\ntitle: 剑指offer05 替换空格\ntags: [剑指,字符串]\ncategories: [剑指,字符串]\ndate: 2021-08-11 18:36:13\n---\n\n>替换空格\n\n## 题目\n\n请实现一个函数，把字符串 `s` 中的每个空格替换成\"%20\"。\n\n### 示例 1：\n\n```\n输入：s = \"We are happy.\"\n输出：\"We%20are%20happy.\"\n```\n\n### 提示：\n\n- 0 <= s 的长度 <= 10000\n\n## 题解\n\n直接替换即可。相当于使用replace方法\n\n```python\nclass Solution:\n    def replaceSpace(self, s: str) -> str:\n       #相当于现成函数 return s.replace(\" \",\"%20\")\n        result = \"\"\n        for x in s:\n            if x==' ':\n                x = \"%20\"\n            result += x\n        return result\n```\n\n","slug":"leetcode/leetcode-offer05","published":1,"updated":"2022-01-18T08:10:17.062Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p087001nast95usq1qqb","content":"<blockquote>\n<p>替换空格</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现一个函数，把字符串 <code>s</code> 中的每个空格替换成\"%20\"。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight perl\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs perl\">输入：s = <span class=\"hljs-string\">\"We are happy.\"</span><br>输出：<span class=\"hljs-string\">\"We%20are%20happy.\"</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= s 的长度 &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>直接替换即可。相当于使用replace方法</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">replaceSpace</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>       <span class=\"hljs-comment\">#相当于现成函数 return s.replace(\" \",\"%20\")</span><br>        result = <span class=\"hljs-string\">\"\"</span><br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> s:<br>            <span class=\"hljs-keyword\">if</span> x==<span class=\"hljs-string\">' '</span>:<br>                x = <span class=\"hljs-string\">\"%20\"</span><br>            result += x<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>替换空格</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现一个函数，把字符串 <code>s</code> 中的每个空格替换成&quot;%20&quot;。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs perl\">输入：s = <span class=\"hljs-string\">&quot;We are happy.&quot;</span><br>输出：<span class=\"hljs-string\">&quot;We%20are%20happy.&quot;</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= s 的长度 &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>直接替换即可。相当于使用replace方法</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">replaceSpace</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>       <span class=\"hljs-comment\">#相当于现成函数 return s.replace(&quot; &quot;,&quot;%20&quot;)</span><br>        result = <span class=\"hljs-string\">&quot;&quot;</span><br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> s:<br>            <span class=\"hljs-keyword\">if</span> x==<span class=\"hljs-string\">&#x27; &#x27;</span>:<br>                x = <span class=\"hljs-string\">&quot;%20&quot;</span><br>            result += x<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer07 重建二叉树","date":"2021-08-17T12:59:06.000Z","_content":"\n>重建二叉树\n\n## 题目\n输入某二叉树的前序遍历和中序遍历的结果，请构建该二叉树并返回其根节点。\n\n假设输入的前序遍历和中序遍历的结果中都不含重复的数字。\n\n### 示例 1：\n\n![img](https://picture.mulindya.com/leetcode-offer07-tree.jpg)\n\n```\nInput: preorder = [3,9,20,15,7], inorder = [9,3,15,20,7]\nOutput: [3,9,20,null,null,15,7]\n```\n\n### 示例 2：\n\n```\nInput: preorder = [-1], inorder = [-1]\nOutput: [-1]\n```\n\n### 提示：\n\n- 0 <= 节点个数 <= 5000\n\n## 题解\n\n使用闭包函数，构建对应区域的树，返回根节点。关键步骤是查找到rootindex在中序遍历中的位置，然后分别构建对应的子树。在查找时可以先建立哈希表，使用字典和枚举结合构建flag `flag = {ele:i for i,ele in enumerate(inorder)}`。可以减少执行时间的开销。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def buildTree(self, preorder: List[int], inorder: List[int]) -> TreeNode:\n        def func(rootindex,ins,ine):\n            if(ins>ine): return None\n            root = TreeNode(preorder[rootindex])\n            # t = ins\n            # while(inorder[t]!=preorder[rootindex]):t+=1\n            t = flag[preorder[rootindex]]\n            root.left = func(rootindex+1,ins,t-1)\n            root.right = func(rootindex+t-ins+1,t+1,ine)\n            return root\n        # 构建哈希表 在查找时更方便\n        flag = {ele:i for i,ele in enumerate(inorder)} #使用字典构建\n        root = func(0,0,len(inorder)-1)\n        return root\n```\n\n","source":"_posts/leetcode/leetcode-offer07.md","raw":"---\ntitle: 剑指offer07 重建二叉树\ntags: [剑指,树]\ncategories: [剑指,树]\ndate: 2021-08-17 20:59:06\n---\n\n>重建二叉树\n\n## 题目\n输入某二叉树的前序遍历和中序遍历的结果，请构建该二叉树并返回其根节点。\n\n假设输入的前序遍历和中序遍历的结果中都不含重复的数字。\n\n### 示例 1：\n\n![img](https://picture.mulindya.com/leetcode-offer07-tree.jpg)\n\n```\nInput: preorder = [3,9,20,15,7], inorder = [9,3,15,20,7]\nOutput: [3,9,20,null,null,15,7]\n```\n\n### 示例 2：\n\n```\nInput: preorder = [-1], inorder = [-1]\nOutput: [-1]\n```\n\n### 提示：\n\n- 0 <= 节点个数 <= 5000\n\n## 题解\n\n使用闭包函数，构建对应区域的树，返回根节点。关键步骤是查找到rootindex在中序遍历中的位置，然后分别构建对应的子树。在查找时可以先建立哈希表，使用字典和枚举结合构建flag `flag = {ele:i for i,ele in enumerate(inorder)}`。可以减少执行时间的开销。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def buildTree(self, preorder: List[int], inorder: List[int]) -> TreeNode:\n        def func(rootindex,ins,ine):\n            if(ins>ine): return None\n            root = TreeNode(preorder[rootindex])\n            # t = ins\n            # while(inorder[t]!=preorder[rootindex]):t+=1\n            t = flag[preorder[rootindex]]\n            root.left = func(rootindex+1,ins,t-1)\n            root.right = func(rootindex+t-ins+1,t+1,ine)\n            return root\n        # 构建哈希表 在查找时更方便\n        flag = {ele:i for i,ele in enumerate(inorder)} #使用字典构建\n        root = func(0,0,len(inorder)-1)\n        return root\n```\n\n","slug":"leetcode/leetcode-offer07","published":1,"updated":"2022-01-18T08:10:17.063Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p08a001qast93mb188e3","content":"<blockquote>\n<p>重建二叉树</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入某二叉树的前序遍历和中序遍历的结果，请构建该二叉树并返回其根节点。</p>\n<p>假设输入的前序遍历和中序遍历的结果中都不含重复的数字。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer07-tree.jpg\" alt=\"img\"></p>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">Input: <span class=\"hljs-attr\">preorder</span> = [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>], <span class=\"hljs-attr\">inorder</span> = [<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-number\">7</span>]<br>Output: [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">Input: preorder = <span class=\"hljs-comment\">[-1]</span>, inorder = <span class=\"hljs-comment\">[-1]</span><br>Output: <span class=\"hljs-comment\">[-1]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 节点个数 &lt;= 5000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用闭包函数，构建对应区域的树，返回根节点。关键步骤是查找到rootindex在中序遍历中的位置，然后分别构建对应的子树。在查找时可以先建立哈希表，使用字典和枚举结合构建flag <code>flag = {ele:i for i,ele in enumerate(inorder)}</code>。可以减少执行时间的开销。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">buildTree</span>(<span class=\"hljs-params\">self, preorder: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], inorder: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; TreeNode:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">func</span>(<span class=\"hljs-params\">rootindex,ins,ine</span>):</span><br>            <span class=\"hljs-keyword\">if</span>(ins&gt;ine): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">None</span><br>            root = TreeNode(preorder[rootindex])<br>            <span class=\"hljs-comment\"># t = ins</span><br>            <span class=\"hljs-comment\"># while(inorder[t]!=preorder[rootindex]):t+=1</span><br>            t = flag[preorder[rootindex]]<br>            root.left = func(rootindex+<span class=\"hljs-number\">1</span>,ins,t-<span class=\"hljs-number\">1</span>)<br>            root.right = func(rootindex+t-ins+<span class=\"hljs-number\">1</span>,t+<span class=\"hljs-number\">1</span>,ine)<br>            <span class=\"hljs-keyword\">return</span> root<br>        <span class=\"hljs-comment\"># 构建哈希表 在查找时更方便</span><br>        flag = {ele:i <span class=\"hljs-keyword\">for</span> i,ele <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(inorder)} <span class=\"hljs-comment\">#使用字典构建</span><br>        root = func(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">len</span>(inorder)-<span class=\"hljs-number\">1</span>)<br>        <span class=\"hljs-keyword\">return</span> root<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>重建二叉树</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入某二叉树的前序遍历和中序遍历的结果，请构建该二叉树并返回其根节点。</p>\n<p>假设输入的前序遍历和中序遍历的结果中都不含重复的数字。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer07-tree.jpg\" alt=\"img\"></p>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">Input: <span class=\"hljs-attr\">preorder</span> = [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>], <span class=\"hljs-attr\">inorder</span> = [<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-number\">7</span>]<br>Output: [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">Input: preorder = <span class=\"hljs-comment\">[-1]</span>, inorder = <span class=\"hljs-comment\">[-1]</span><br>Output: <span class=\"hljs-comment\">[-1]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 节点个数 &lt;= 5000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用闭包函数，构建对应区域的树，返回根节点。关键步骤是查找到rootindex在中序遍历中的位置，然后分别构建对应的子树。在查找时可以先建立哈希表，使用字典和枚举结合构建flag <code>flag = &#123;ele:i for i,ele in enumerate(inorder)&#125;</code>。可以减少执行时间的开销。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">buildTree</span>(<span class=\"hljs-params\">self, preorder: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], inorder: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; TreeNode:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">func</span>(<span class=\"hljs-params\">rootindex,ins,ine</span>):</span><br>            <span class=\"hljs-keyword\">if</span>(ins&gt;ine): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">None</span><br>            root = TreeNode(preorder[rootindex])<br>            <span class=\"hljs-comment\"># t = ins</span><br>            <span class=\"hljs-comment\"># while(inorder[t]!=preorder[rootindex]):t+=1</span><br>            t = flag[preorder[rootindex]]<br>            root.left = func(rootindex+<span class=\"hljs-number\">1</span>,ins,t-<span class=\"hljs-number\">1</span>)<br>            root.right = func(rootindex+t-ins+<span class=\"hljs-number\">1</span>,t+<span class=\"hljs-number\">1</span>,ine)<br>            <span class=\"hljs-keyword\">return</span> root<br>        <span class=\"hljs-comment\"># 构建哈希表 在查找时更方便</span><br>        flag = &#123;ele:i <span class=\"hljs-keyword\">for</span> i,ele <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(inorder)&#125; <span class=\"hljs-comment\">#使用字典构建</span><br>        root = func(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">len</span>(inorder)-<span class=\"hljs-number\">1</span>)<br>        <span class=\"hljs-keyword\">return</span> root<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer06 从尾到头打印链表","date":"2021-08-13T17:28:42.000Z","_content":"\n>从尾到头打印链表\n\n## 题目\n\n输入一个链表的头节点，从尾到头反过来返回每个节点的值（用数组返回）。\n\n### 示例 1：\n\n```\n输入：head = [1,3,2]\n输出：[2,3,1]\n```\n\n### 提示：\n\n- 0 <= 链表长度 <= 10000\n\n## 题解\n\n遍历链表，直接插入到头位置。就可以直接输出了。或者采用递归，超级简洁，值得借鉴。注意if的条件和对应结果。（递归就从中间普适的节点开始考虑 然后补充边界细节）\n\n<font color=orange>return self.reversePrint( head.next ) + [ head.val ] if head else []</font>\n\n```python\n# Definition for singly-linked list.\n# class ListNode(object):\n#     def __init__(self, x):\n#         self.val = x\n#         self.next = None\n\nclass Solution(object):\n    def reversePrint(self, head):\n        \"\"\"\n        :type head: ListNode\n        :rtype: List[int]\n        \"\"\"\n        p=head\n        result = []\n        while(p):\n            result = [p.val]+result #直接添加到前面\n            p = p.next\n        return result\n        #使用递归一条语句超级简洁 递归后一个元素+当前元素 如果当前为空则+【】 也是终止未知\n        #return self.reversePrint(head.next) + [head.val] if head else []\n```\n\n","source":"_posts/leetcode/leetcode-offer06.md","raw":"---\ntitle: 剑指offer06 从尾到头打印链表\ntags: [剑指,链表,idea]\ncategories: [剑指,链表]\ndate: 2021-08-14 01:28:42\n---\n\n>从尾到头打印链表\n\n## 题目\n\n输入一个链表的头节点，从尾到头反过来返回每个节点的值（用数组返回）。\n\n### 示例 1：\n\n```\n输入：head = [1,3,2]\n输出：[2,3,1]\n```\n\n### 提示：\n\n- 0 <= 链表长度 <= 10000\n\n## 题解\n\n遍历链表，直接插入到头位置。就可以直接输出了。或者采用递归，超级简洁，值得借鉴。注意if的条件和对应结果。（递归就从中间普适的节点开始考虑 然后补充边界细节）\n\n<font color=orange>return self.reversePrint( head.next ) + [ head.val ] if head else []</font>\n\n```python\n# Definition for singly-linked list.\n# class ListNode(object):\n#     def __init__(self, x):\n#         self.val = x\n#         self.next = None\n\nclass Solution(object):\n    def reversePrint(self, head):\n        \"\"\"\n        :type head: ListNode\n        :rtype: List[int]\n        \"\"\"\n        p=head\n        result = []\n        while(p):\n            result = [p.val]+result #直接添加到前面\n            p = p.next\n        return result\n        #使用递归一条语句超级简洁 递归后一个元素+当前元素 如果当前为空则+【】 也是终止未知\n        #return self.reversePrint(head.next) + [head.val] if head else []\n```\n\n","slug":"leetcode/leetcode-offer06","published":1,"updated":"2022-01-18T08:10:17.062Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p08d001sast9611378tv","content":"<blockquote>\n<p>从尾到头打印链表</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个链表的头节点，从尾到头反过来返回每个节点的值（用数组返回）。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：head = <span class=\"hljs-comment\">[1,3,2]</span><br>输出：<span class=\"hljs-comment\">[2,3,1]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 链表长度 &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>遍历链表，直接插入到头位置。就可以直接输出了。或者采用递归，超级简洁，值得借鉴。注意if的条件和对应结果。（递归就从中间普适的节点开始考虑 然后补充边界细节）</p>\n<p><font color=\"orange\">return self.reversePrint( head.next ) + [ head.val ] if head else []</font></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for singly-linked list.</span><br><span class=\"hljs-comment\"># class ListNode(object):</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.next = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">object</span></span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">reversePrint</span>(<span class=\"hljs-params\">self, head</span>):</span><br>        <span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\">        :type head: ListNode</span><br><span class=\"hljs-string\">        :rtype: List[int]</span><br><span class=\"hljs-string\">        \"\"\"</span><br>        p=head<br>        result = []<br>        <span class=\"hljs-keyword\">while</span>(p):<br>            result = [p.val]+result <span class=\"hljs-comment\">#直接添加到前面</span><br>            p = p.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-keyword\">return</span> result<br>        <span class=\"hljs-comment\">#使用递归一条语句超级简洁 递归后一个元素+当前元素 如果当前为空则+【】 也是终止未知</span><br>        <span class=\"hljs-comment\">#return self.reversePrint(head.next) + [head.val] if head else []</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>从尾到头打印链表</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个链表的头节点，从尾到头反过来返回每个节点的值（用数组返回）。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：head = <span class=\"hljs-comment\">[1,3,2]</span><br>输出：<span class=\"hljs-comment\">[2,3,1]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 链表长度 &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>遍历链表，直接插入到头位置。就可以直接输出了。或者采用递归，超级简洁，值得借鉴。注意if的条件和对应结果。（递归就从中间普适的节点开始考虑 然后补充边界细节）</p>\n<p><font color=orange>return self.reversePrint( head.next ) + [ head.val ] if head else []</font></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for singly-linked list.</span><br><span class=\"hljs-comment\"># class ListNode(object):</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.next = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">object</span></span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">reversePrint</span>(<span class=\"hljs-params\">self, head</span>):</span><br>        <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">        :type head: ListNode</span><br><span class=\"hljs-string\">        :rtype: List[int]</span><br><span class=\"hljs-string\">        &quot;&quot;&quot;</span><br>        p=head<br>        result = []<br>        <span class=\"hljs-keyword\">while</span>(p):<br>            result = [p.val]+result <span class=\"hljs-comment\">#直接添加到前面</span><br>            p = p.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-keyword\">return</span> result<br>        <span class=\"hljs-comment\">#使用递归一条语句超级简洁 递归后一个元素+当前元素 如果当前为空则+【】 也是终止未知</span><br>        <span class=\"hljs-comment\">#return self.reversePrint(head.next) + [head.val] if head else []</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer09 用两个栈实现队列","date":"2021-08-10T02:46:28.000Z","_content":"\n> 用两个栈实现队列\n\n## 题目\n\n用两个栈实现一个队列。队列的声明如下，请实现它的两个函数 appendTail 和 deleteHead ，分别完成在队列尾部插入整数和在队列头部删除整数的功能。(若队列中没有元素，deleteHead 操作返回 -1 )\n\n### 示例 1：\n\n```\n输入：\n[\"CQueue\",\"appendTail\",\"deleteHead\",\"deleteHead\"]\n[[],[3],[],[]]\n输出：[null,null,3,-1]\n```\n\n### 示例 2：\n\n```\n输入：\n[\"CQueue\",\"deleteHead\",\"appendTail\",\"appendTail\",\"deleteHead\",\"deleteHead\"]\n[[],[],[5],[2],[],[]]\n输出：[null,-1,null,null,5,2]\n```\n\n### 提示：\n\n- 1 <= values <= 10000\n- 最多会对 appendTail、deleteHead 进行 10000 次调用\n\n## 题解\n\n使用两个栈，*一个作为插入栈，一个作为删除栈*。`使用list进行相关操作（append，pop）`；在插入时直接对stack1进行append操作，删除时首先需要构建删除栈内容，再进行判断，最后同步到插入栈中（此时删除栈又为空）。\n\n```python\nclass CQueue:\n\n    def __init__(self):\n        # stack1是insert栈 stack2是delete栈\n        self.stack1 = [] #list作用和stack类似\n        self.stack2 = []\n\n    def appendTail(self, value: int) -> None:\n        self.stack1.append(value) # 直接插入栈顶\n\n    def deleteHead(self) -> int:\n        while self.stack1: #首先更新delete栈\n            self.stack2.append(self.stack1.pop())\n        #进行deleteHead操作\n        if not self.stack2: \n            return -1\n        popitem = self.stack2.pop()\n        # 将更新结果写回stack1中 保持一致\n        while self.stack2:\n            self.stack1.append(self.stack2.pop())\n        return popitem\n\n# Your CQueue object will be instantiated and called as such:\n# obj = CQueue()\n# obj.appendTail(value)\n# param_2 = obj.deleteHead()\n```\n\n","source":"_posts/leetcode/leetcode-offer09.md","raw":"---\ntitle: 剑指offer09 用两个栈实现队列\ndate: 2021-08-10 10:46:28\ntags: [剑指,栈]\ncategories: [剑指,栈]\n---\n\n> 用两个栈实现队列\n\n## 题目\n\n用两个栈实现一个队列。队列的声明如下，请实现它的两个函数 appendTail 和 deleteHead ，分别完成在队列尾部插入整数和在队列头部删除整数的功能。(若队列中没有元素，deleteHead 操作返回 -1 )\n\n### 示例 1：\n\n```\n输入：\n[\"CQueue\",\"appendTail\",\"deleteHead\",\"deleteHead\"]\n[[],[3],[],[]]\n输出：[null,null,3,-1]\n```\n\n### 示例 2：\n\n```\n输入：\n[\"CQueue\",\"deleteHead\",\"appendTail\",\"appendTail\",\"deleteHead\",\"deleteHead\"]\n[[],[],[5],[2],[],[]]\n输出：[null,-1,null,null,5,2]\n```\n\n### 提示：\n\n- 1 <= values <= 10000\n- 最多会对 appendTail、deleteHead 进行 10000 次调用\n\n## 题解\n\n使用两个栈，*一个作为插入栈，一个作为删除栈*。`使用list进行相关操作（append，pop）`；在插入时直接对stack1进行append操作，删除时首先需要构建删除栈内容，再进行判断，最后同步到插入栈中（此时删除栈又为空）。\n\n```python\nclass CQueue:\n\n    def __init__(self):\n        # stack1是insert栈 stack2是delete栈\n        self.stack1 = [] #list作用和stack类似\n        self.stack2 = []\n\n    def appendTail(self, value: int) -> None:\n        self.stack1.append(value) # 直接插入栈顶\n\n    def deleteHead(self) -> int:\n        while self.stack1: #首先更新delete栈\n            self.stack2.append(self.stack1.pop())\n        #进行deleteHead操作\n        if not self.stack2: \n            return -1\n        popitem = self.stack2.pop()\n        # 将更新结果写回stack1中 保持一致\n        while self.stack2:\n            self.stack1.append(self.stack2.pop())\n        return popitem\n\n# Your CQueue object will be instantiated and called as such:\n# obj = CQueue()\n# obj.appendTail(value)\n# param_2 = obj.deleteHead()\n```\n\n","slug":"leetcode/leetcode-offer09","published":1,"updated":"2022-01-18T08:10:17.063Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p08h001xast9bur41oci","content":"<blockquote>\n<p>用两个栈实现队列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>用两个栈实现一个队列。队列的声明如下，请实现它的两个函数 appendTail 和 deleteHead ，分别完成在队列尾部插入整数和在队列头部删除整数的功能。(若队列中没有元素，deleteHead 操作返回 -1 )</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight prolog\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs prolog\">输入：<br>[<span class=\"hljs-string\">\"CQueue\"</span>,<span class=\"hljs-string\">\"appendTail\"</span>,<span class=\"hljs-string\">\"deleteHead\"</span>,<span class=\"hljs-string\">\"deleteHead\"</span>]<br>[[],[<span class=\"hljs-number\">3</span>],[],[]]<br>输出：[null,null,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">-1</span>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight prolog\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs prolog\">输入：<br>[<span class=\"hljs-string\">\"CQueue\"</span>,<span class=\"hljs-string\">\"deleteHead\"</span>,<span class=\"hljs-string\">\"appendTail\"</span>,<span class=\"hljs-string\">\"appendTail\"</span>,<span class=\"hljs-string\">\"deleteHead\"</span>,<span class=\"hljs-string\">\"deleteHead\"</span>]<br>[[],[],[<span class=\"hljs-number\">5</span>],[<span class=\"hljs-number\">2</span>],[],[]]<br>输出：[null,<span class=\"hljs-number\">-1</span>,null,null,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">2</span>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= values &lt;= 10000</li>\n<li>最多会对 appendTail、deleteHead 进行 10000 次调用</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用两个栈，<em>一个作为插入栈，一个作为删除栈</em>。<code>使用list进行相关操作（append，pop）</code>；在插入时直接对stack1进行append操作，删除时首先需要构建删除栈内容，再进行判断，最后同步到插入栈中（此时删除栈又为空）。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CQueue</span>:</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-comment\"># stack1是insert栈 stack2是delete栈</span><br>        self.stack1 = [] <span class=\"hljs-comment\">#list作用和stack类似</span><br>        self.stack2 = []<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">appendTail</span>(<span class=\"hljs-params\">self, value: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-literal\">None</span>:</span><br>        self.stack1.append(value) <span class=\"hljs-comment\"># 直接插入栈顶</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">deleteHead</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">while</span> self.stack1: <span class=\"hljs-comment\">#首先更新delete栈</span><br>            self.stack2.append(self.stack1.pop())<br>        <span class=\"hljs-comment\">#进行deleteHead操作</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> self.stack2: <br>            <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">1</span><br>        popitem = self.stack2.pop()<br>        <span class=\"hljs-comment\"># 将更新结果写回stack1中 保持一致</span><br>        <span class=\"hljs-keyword\">while</span> self.stack2:<br>            self.stack1.append(self.stack2.pop())<br>        <span class=\"hljs-keyword\">return</span> popitem<br><br><span class=\"hljs-comment\"># Your CQueue object will be instantiated and called as such:</span><br><span class=\"hljs-comment\"># obj = CQueue()</span><br><span class=\"hljs-comment\"># obj.appendTail(value)</span><br><span class=\"hljs-comment\"># param_2 = obj.deleteHead()</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>用两个栈实现队列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>用两个栈实现一个队列。队列的声明如下，请实现它的两个函数 appendTail 和 deleteHead ，分别完成在队列尾部插入整数和在队列头部删除整数的功能。(若队列中没有元素，deleteHead 操作返回 -1 )</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight prolog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs prolog\">输入：<br>[<span class=\"hljs-string\">&quot;CQueue&quot;</span>,<span class=\"hljs-string\">&quot;appendTail&quot;</span>,<span class=\"hljs-string\">&quot;deleteHead&quot;</span>,<span class=\"hljs-string\">&quot;deleteHead&quot;</span>]<br>[[],[<span class=\"hljs-number\">3</span>],[],[]]<br>输出：[null,null,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">-1</span>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight prolog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs prolog\">输入：<br>[<span class=\"hljs-string\">&quot;CQueue&quot;</span>,<span class=\"hljs-string\">&quot;deleteHead&quot;</span>,<span class=\"hljs-string\">&quot;appendTail&quot;</span>,<span class=\"hljs-string\">&quot;appendTail&quot;</span>,<span class=\"hljs-string\">&quot;deleteHead&quot;</span>,<span class=\"hljs-string\">&quot;deleteHead&quot;</span>]<br>[[],[],[<span class=\"hljs-number\">5</span>],[<span class=\"hljs-number\">2</span>],[],[]]<br>输出：[null,<span class=\"hljs-number\">-1</span>,null,null,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">2</span>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= values &lt;= 10000</li>\n<li>最多会对 appendTail、deleteHead 进行 10000 次调用</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用两个栈，<em>一个作为插入栈，一个作为删除栈</em>。<code>使用list进行相关操作（append，pop）</code>；在插入时直接对stack1进行append操作，删除时首先需要构建删除栈内容，再进行判断，最后同步到插入栈中（此时删除栈又为空）。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CQueue</span>:</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-comment\"># stack1是insert栈 stack2是delete栈</span><br>        self.stack1 = [] <span class=\"hljs-comment\">#list作用和stack类似</span><br>        self.stack2 = []<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">appendTail</span>(<span class=\"hljs-params\">self, value: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-literal\">None</span>:</span><br>        self.stack1.append(value) <span class=\"hljs-comment\"># 直接插入栈顶</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">deleteHead</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">while</span> self.stack1: <span class=\"hljs-comment\">#首先更新delete栈</span><br>            self.stack2.append(self.stack1.pop())<br>        <span class=\"hljs-comment\">#进行deleteHead操作</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> self.stack2: <br>            <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">1</span><br>        popitem = self.stack2.pop()<br>        <span class=\"hljs-comment\"># 将更新结果写回stack1中 保持一致</span><br>        <span class=\"hljs-keyword\">while</span> self.stack2:<br>            self.stack1.append(self.stack2.pop())<br>        <span class=\"hljs-keyword\">return</span> popitem<br><br><span class=\"hljs-comment\"># Your CQueue object will be instantiated and called as such:</span><br><span class=\"hljs-comment\"># obj = CQueue()</span><br><span class=\"hljs-comment\"># obj.appendTail(value)</span><br><span class=\"hljs-comment\"># param_2 = obj.deleteHead()</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer10-1 斐波那契数列","date":"2021-08-10T03:55:26.000Z","math":true,"_content":"\n>斐波那契数列\n\n## 题目\n\n写一个函数，输入 n ，求斐波那契（Fibonacci）数列的第 n 项（即 F(N)）。斐波那契数列的定义如下：\n\n$$\nF(0) = 0,   F(1) = 1 \\\\\\\\\nF(N) = F(N - 1) + F(N - 2), 其中 N > 1.\n$$\n斐波那契数列由 0 和 1 开始，之后的斐波那契数就是由之前的两数相加而得出。\n\n答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。\n\n### 示例 1：\n\n```\n输入：n = 2\n输出：1\n```\n\n### 示例 2：\n\n```\n输入：n = 5\n输出：5\n```\n\n### 提示：\n\n- 0 <= n <= 100\n\n## 题解\n\n有三种方向：\n\n- 使用递归\n\n  大量重复计算，时间超时。\n\n- 使用数组存储\n\n  新建长度为n的数组，在递归基础上，存储计算的结果，后直接取用。但是占用了额外的空间$O(n)$\n\n- 使用动态规划\n\n  `以其公式F(N) = F(N - 1) + F(N - 2)为转移方程。`\n\n```python\nclass Solution:\n    def fib(self, n: int) -> int:\n        a,b = 0,1\n        for _ in range(n):\n            a,b = b,a+b #sum = a+b a = b b = sum a相当于f(i) b相当于f(i+1)\n        return a%1000000007\n    # def fib(self, n: int) -> int:\n    #     if(n==0): return 0\n    #     if(n==1): return 1\n    #     return (self.fib(n-1)+self.fib(n-2))%1000000007 #超时 递归时间复杂度大\n```\n\n循环n次\n\n注意`a,b = b,a+b` 相当于sum = a+b ；a = b； b = sum ；\n\n第i轮中 a相当于f(i)，b相当于f(i+1) 。因此最后返回a\n\n","source":"_posts/leetcode/leetcode-offer10-1.md","raw":"---\ntitle: 剑指offer10-1 斐波那契数列\ntags: [剑指,斐波那契,动态规划]\ncategories: [剑指,动态规划]\ndate: 2021-08-10 11:55:26\nmath: true\n---\n\n>斐波那契数列\n\n## 题目\n\n写一个函数，输入 n ，求斐波那契（Fibonacci）数列的第 n 项（即 F(N)）。斐波那契数列的定义如下：\n\n$$\nF(0) = 0,   F(1) = 1 \\\\\\\\\nF(N) = F(N - 1) + F(N - 2), 其中 N > 1.\n$$\n斐波那契数列由 0 和 1 开始，之后的斐波那契数就是由之前的两数相加而得出。\n\n答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。\n\n### 示例 1：\n\n```\n输入：n = 2\n输出：1\n```\n\n### 示例 2：\n\n```\n输入：n = 5\n输出：5\n```\n\n### 提示：\n\n- 0 <= n <= 100\n\n## 题解\n\n有三种方向：\n\n- 使用递归\n\n  大量重复计算，时间超时。\n\n- 使用数组存储\n\n  新建长度为n的数组，在递归基础上，存储计算的结果，后直接取用。但是占用了额外的空间$O(n)$\n\n- 使用动态规划\n\n  `以其公式F(N) = F(N - 1) + F(N - 2)为转移方程。`\n\n```python\nclass Solution:\n    def fib(self, n: int) -> int:\n        a,b = 0,1\n        for _ in range(n):\n            a,b = b,a+b #sum = a+b a = b b = sum a相当于f(i) b相当于f(i+1)\n        return a%1000000007\n    # def fib(self, n: int) -> int:\n    #     if(n==0): return 0\n    #     if(n==1): return 1\n    #     return (self.fib(n-1)+self.fib(n-2))%1000000007 #超时 递归时间复杂度大\n```\n\n循环n次\n\n注意`a,b = b,a+b` 相当于sum = a+b ；a = b； b = sum ；\n\n第i轮中 a相当于f(i)，b相当于f(i+1) 。因此最后返回a\n\n","slug":"leetcode/leetcode-offer10-1","published":1,"updated":"2022-01-18T08:10:17.064Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p08j001yast90cpe7zuu","content":"<blockquote>\n<p>斐波那契数列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>写一个函数，输入 n ，求斐波那契（Fibonacci）数列的第 n 项（即 F(N)）。斐波那契数列的定义如下：</p>\n<p>$$<br>\nF(0) = 0,   F(1) = 1 \\\\<br>\nF(N) = F(N - 1) + F(N - 2), 其中 N &gt; 1.<br>\n$$<br>\n斐波那契数列由 0 和 1 开始，之后的斐波那契数就是由之前的两数相加而得出。</p>\n<p>答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight excel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">2</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight excel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">5</span><br>输出：<span class=\"hljs-number\">5</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= n &lt;= 100</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>有三种方向：</p>\n<ul>\n<li>\n<p>使用递归</p>\n<p>大量重复计算，时间超时。</p>\n</li>\n<li>\n<p>使用数组存储</p>\n<p>新建长度为n的数组，在递归基础上，存储计算的结果，后直接取用。但是占用了额外的空间$O(n)$</p>\n</li>\n<li>\n<p>使用动态规划</p>\n<p><code>以其公式F(N) = F(N - 1) + F(N - 2)为转移方程。</code></p>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">fib</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        a,b = <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n):<br>            a,b = b,a+b <span class=\"hljs-comment\">#sum = a+b a = b b = sum a相当于f(i) b相当于f(i+1)</span><br>        <span class=\"hljs-keyword\">return</span> a%<span class=\"hljs-number\">1000000007</span><br>    <span class=\"hljs-comment\"># def fib(self, n: int) -&gt; int:</span><br>    <span class=\"hljs-comment\">#     if(n==0): return 0</span><br>    <span class=\"hljs-comment\">#     if(n==1): return 1</span><br>    <span class=\"hljs-comment\">#     return (self.fib(n-1)+self.fib(n-2))%1000000007 #超时 递归时间复杂度大</span><br></code></pre></td></tr></tbody></table></figure>\n<p>循环n次</p>\n<p>注意<code>a,b = b,a+b</code> 相当于sum = a+b ；a = b； b = sum ；</p>\n<p>第i轮中 a相当于f(i)，b相当于f(i+1) 。因此最后返回a</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>斐波那契数列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>写一个函数，输入 n ，求斐波那契（Fibonacci）数列的第 n 项（即 F(N)）。斐波那契数列的定义如下：</p>\n<p>$$<br>\nF(0) = 0,   F(1) = 1 \\\\<br>\nF(N) = F(N - 1) + F(N - 2), 其中 N &gt; 1.<br>\n$$<br>\n斐波那契数列由 0 和 1 开始，之后的斐波那契数就是由之前的两数相加而得出。</p>\n<p>答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">2</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">5</span><br>输出：<span class=\"hljs-number\">5</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= n &lt;= 100</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>有三种方向：</p>\n<ul>\n<li>\n<p>使用递归</p>\n<p>大量重复计算，时间超时。</p>\n</li>\n<li>\n<p>使用数组存储</p>\n<p>新建长度为n的数组，在递归基础上，存储计算的结果，后直接取用。但是占用了额外的空间$O(n)$</p>\n</li>\n<li>\n<p>使用动态规划</p>\n<p><code>以其公式F(N) = F(N - 1) + F(N - 2)为转移方程。</code></p>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">fib</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        a,b = <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n):<br>            a,b = b,a+b <span class=\"hljs-comment\">#sum = a+b a = b b = sum a相当于f(i) b相当于f(i+1)</span><br>        <span class=\"hljs-keyword\">return</span> a%<span class=\"hljs-number\">1000000007</span><br>    <span class=\"hljs-comment\"># def fib(self, n: int) -&gt; int:</span><br>    <span class=\"hljs-comment\">#     if(n==0): return 0</span><br>    <span class=\"hljs-comment\">#     if(n==1): return 1</span><br>    <span class=\"hljs-comment\">#     return (self.fib(n-1)+self.fib(n-2))%1000000007 #超时 递归时间复杂度大</span><br></code></pre></td></tr></table></figure>\n<p>循环n次</p>\n<p>注意<code>a,b = b,a+b</code> 相当于sum = a+b ；a = b； b = sum ；</p>\n<p>第i轮中 a相当于f(i)，b相当于f(i+1) 。因此最后返回a</p>\n"},{"title":"剑指offer10-2 青蛙跳台阶问题","date":"2021-08-10T06:22:55.000Z","math":true,"_content":"\n>青蛙跳台阶问题\n\n## 题目\n\n一只青蛙一次可以跳上1级台阶，也可以跳上2级台阶。求该青蛙跳上一个 n 级的台阶总共有多少种跳法。\n\n答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。\n\n### 示例 1：\n\n```\n输入：n = 2\n输出：2\n```\n\n### 示例 2：\n\n```\n输入：n = 7\n输出：21\n```\n### 示例3：\n```\n输入：n = 0\n输出：1\n```\n\n### 提示：\n\n- 0 <= n <= 100\n\n## 题解\n\n实际上是斐波那契数列的变种。跳上n级台阶的方法个数 可以分解为：*跳上此台阶前的一步是1步还是2步*。也就是 $f(n) = f(n-1) + f(n-2)$。\n\n不同之处在于此时的f(0) = 1\n\n```python\nclass Solution:\n    def numWays(self, n: int) -> int:\n        a,b = 1,1\n        for _ in range(n):\n            a,b = b,a+b\n        return a%1000000007\n```\n\n","source":"_posts/leetcode/leetcode-offer10-2.md","raw":"---\ntitle: 剑指offer10-2 青蛙跳台阶问题\ntags: [剑指,斐波那契,动态规划,idea]\ncategories: [剑指,动态规划]\ndate: 2021-08-10 14:22:55\nmath: true\n---\n\n>青蛙跳台阶问题\n\n## 题目\n\n一只青蛙一次可以跳上1级台阶，也可以跳上2级台阶。求该青蛙跳上一个 n 级的台阶总共有多少种跳法。\n\n答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。\n\n### 示例 1：\n\n```\n输入：n = 2\n输出：2\n```\n\n### 示例 2：\n\n```\n输入：n = 7\n输出：21\n```\n### 示例3：\n```\n输入：n = 0\n输出：1\n```\n\n### 提示：\n\n- 0 <= n <= 100\n\n## 题解\n\n实际上是斐波那契数列的变种。跳上n级台阶的方法个数 可以分解为：*跳上此台阶前的一步是1步还是2步*。也就是 $f(n) = f(n-1) + f(n-2)$。\n\n不同之处在于此时的f(0) = 1\n\n```python\nclass Solution:\n    def numWays(self, n: int) -> int:\n        a,b = 1,1\n        for _ in range(n):\n            a,b = b,a+b\n        return a%1000000007\n```\n\n","slug":"leetcode/leetcode-offer10-2","published":1,"updated":"2022-01-18T08:10:17.064Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p08m0022ast93dj1hwib","content":"<blockquote>\n<p>青蛙跳台阶问题</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>一只青蛙一次可以跳上1级台阶，也可以跳上2级台阶。求该青蛙跳上一个 n 级的台阶总共有多少种跳法。</p>\n<p>答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight excel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">2</span><br>输出：<span class=\"hljs-number\">2</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight excel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">7</span><br>输出：<span class=\"hljs-number\">21</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例3：\">示例3：</h3>\n<figure class=\"highlight excel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">0</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= n &lt;= 100</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>实际上是斐波那契数列的变种。跳上n级台阶的方法个数 可以分解为：<em>跳上此台阶前的一步是1步还是2步</em>。也就是 $f(n) = f(n-1) + f(n-2)$。</p>\n<p>不同之处在于此时的f(0) = 1</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">numWays</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        a,b = <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n):<br>            a,b = b,a+b<br>        <span class=\"hljs-keyword\">return</span> a%<span class=\"hljs-number\">1000000007</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>青蛙跳台阶问题</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>一只青蛙一次可以跳上1级台阶，也可以跳上2级台阶。求该青蛙跳上一个 n 级的台阶总共有多少种跳法。</p>\n<p>答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">2</span><br>输出：<span class=\"hljs-number\">2</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">7</span><br>输出：<span class=\"hljs-number\">21</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例3：\">示例3：</h3>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">0</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= n &lt;= 100</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>实际上是斐波那契数列的变种。跳上n级台阶的方法个数 可以分解为：<em>跳上此台阶前的一步是1步还是2步</em>。也就是 $f(n) = f(n-1) + f(n-2)$。</p>\n<p>不同之处在于此时的f(0) = 1</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">numWays</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        a,b = <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n):<br>            a,b = b,a+b<br>        <span class=\"hljs-keyword\">return</span> a%<span class=\"hljs-number\">1000000007</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer11 旋转数组的最小数字","date":"2021-08-13T09:40:06.000Z","_content":"\n>旋转数组的最小数字\n\n## 题目\n\n把一个数组最开始的若干个元素搬到数组的末尾，我们称之为数组的旋转。输入一个递增排序的数组的一个旋转，输出旋转数组的最小元素。例如，数组 [3,4,5,1,2] 为 [1,2,3,4,5] 的一个旋转，该数组的最小值为1。\n\n### 示例 1：\n\n```\n输入：[3,4,5,1,2]\n输出：1\n```\n\n### 示例 2：\n\n```\n输入：[2,2,2,0,1]\n输出：0\n```\n\n## 题解\n\n将数组遍历一遍，遇到第一个非增序的元素即为最小值。复杂度为线性级别。\n\n```python\nclass Solution:\n    def minArray(self, numbers: List[int]) -> int:\n        if not(numbers):return 0\n        minitem = numbers[0]\n        for i in range(1,len(numbers)):\n            if numbers[i]<numbers[i-1]:\n                return min(minitem,numbers[i])\n        return minitem\n```\n\n还可以使用二分法，将线性级别的复杂度降低到对数级别。\n\n![](https://picture.mulindya.com/leetcode-offer11-pic1.png)\n\n最低点有特性：左边的所有元素都要比右边所有元素大。利用这个特性可以逐渐缩小范围。\n\n中间元素和某个边界元素比较大小，来确定范围，<u>但是要注意两者相等时就没有确切的判断了</u>。可以直接用线性比较来替代。\n\n```python\nclass Solution:\n    def minArray(self, numbers: [int]) -> int:\n        i, j = 0, len(numbers) - 1\n        while i < j:\n            m = (i + j) // 2\n            if numbers[m] > numbers[j]: i = m + 1\n            elif numbers[m] < numbers[j]: j = m\n            else: j -= 1\n        return numbers[i]\n```\n\n实际上，当出现 nums[m] = nums[j] 时，一定有区间[i,m]内所有元素相等 或 区间 [m,j] 内所有元素相等（或两者皆满足）。对于寻找此类数组的最小值问题，可直接放弃二分查找，而使用线性查找替代。\n\n```python\nclass Solution:\n    def minArray(self, numbers: [int]) -> int:\n        i, j = 0, len(numbers) - 1\n        while i < j:\n            m = (i + j) // 2\n            if numbers[m] > numbers[j]: i = m + 1\n            elif numbers[m] < numbers[j]: j = m\n            else: return min(numbers[i:j])\n        return numbers[i]\n```\n\n","source":"_posts/leetcode/leetcode-offer11.md","raw":"---\ntitle: 剑指offer11 旋转数组的最小数字\ntags: [剑指,数组,idea]\ncategories: [剑指,数组]\ndate: 2021-08-13 17:40:06\n---\n\n>旋转数组的最小数字\n\n## 题目\n\n把一个数组最开始的若干个元素搬到数组的末尾，我们称之为数组的旋转。输入一个递增排序的数组的一个旋转，输出旋转数组的最小元素。例如，数组 [3,4,5,1,2] 为 [1,2,3,4,5] 的一个旋转，该数组的最小值为1。\n\n### 示例 1：\n\n```\n输入：[3,4,5,1,2]\n输出：1\n```\n\n### 示例 2：\n\n```\n输入：[2,2,2,0,1]\n输出：0\n```\n\n## 题解\n\n将数组遍历一遍，遇到第一个非增序的元素即为最小值。复杂度为线性级别。\n\n```python\nclass Solution:\n    def minArray(self, numbers: List[int]) -> int:\n        if not(numbers):return 0\n        minitem = numbers[0]\n        for i in range(1,len(numbers)):\n            if numbers[i]<numbers[i-1]:\n                return min(minitem,numbers[i])\n        return minitem\n```\n\n还可以使用二分法，将线性级别的复杂度降低到对数级别。\n\n![](https://picture.mulindya.com/leetcode-offer11-pic1.png)\n\n最低点有特性：左边的所有元素都要比右边所有元素大。利用这个特性可以逐渐缩小范围。\n\n中间元素和某个边界元素比较大小，来确定范围，<u>但是要注意两者相等时就没有确切的判断了</u>。可以直接用线性比较来替代。\n\n```python\nclass Solution:\n    def minArray(self, numbers: [int]) -> int:\n        i, j = 0, len(numbers) - 1\n        while i < j:\n            m = (i + j) // 2\n            if numbers[m] > numbers[j]: i = m + 1\n            elif numbers[m] < numbers[j]: j = m\n            else: j -= 1\n        return numbers[i]\n```\n\n实际上，当出现 nums[m] = nums[j] 时，一定有区间[i,m]内所有元素相等 或 区间 [m,j] 内所有元素相等（或两者皆满足）。对于寻找此类数组的最小值问题，可直接放弃二分查找，而使用线性查找替代。\n\n```python\nclass Solution:\n    def minArray(self, numbers: [int]) -> int:\n        i, j = 0, len(numbers) - 1\n        while i < j:\n            m = (i + j) // 2\n            if numbers[m] > numbers[j]: i = m + 1\n            elif numbers[m] < numbers[j]: j = m\n            else: return min(numbers[i:j])\n        return numbers[i]\n```\n\n","slug":"leetcode/leetcode-offer11","published":1,"updated":"2022-01-18T08:10:17.065Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p08o0024ast9fo36gkyh","content":"<blockquote>\n<p>旋转数组的最小数字</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>把一个数组最开始的若干个元素搬到数组的末尾，我们称之为数组的旋转。输入一个递增排序的数组的一个旋转，输出旋转数组的最小元素。例如，数组 [3,4,5,1,2] 为 [1,2,3,4,5] 的一个旋转，该数组的最小值为1。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight accesslog\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs accesslog\">输入：<span class=\"hljs-string\">[3,4,5,1,2]</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight accesslog\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs accesslog\">输入：<span class=\"hljs-string\">[2,2,2,0,1]</span><br>输出：<span class=\"hljs-number\">0</span><br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"题解\">题解</h2>\n<p>将数组遍历一遍，遇到第一个非增序的元素即为最小值。复杂度为线性级别。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">minArray</span>(<span class=\"hljs-params\">self, numbers: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(numbers):<span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br>        minitem = numbers[<span class=\"hljs-number\">0</span>]<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-built_in\">len</span>(numbers)):<br>            <span class=\"hljs-keyword\">if</span> numbers[i]&lt;numbers[i-<span class=\"hljs-number\">1</span>]:<br>                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">min</span>(minitem,numbers[i])<br>        <span class=\"hljs-keyword\">return</span> minitem<br></code></pre></td></tr></tbody></table></figure>\n<p>还可以使用二分法，将线性级别的复杂度降低到对数级别。</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer11-pic1.png\" alt=\"\"></p>\n<p>最低点有特性：左边的所有元素都要比右边所有元素大。利用这个特性可以逐渐缩小范围。</p>\n<p>中间元素和某个边界元素比较大小，来确定范围，<u>但是要注意两者相等时就没有确切的判断了</u>。可以直接用线性比较来替代。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">minArray</span>(<span class=\"hljs-params\">self, numbers: [<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        i, j = <span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(numbers) - <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">while</span> i &lt; j:<br>            m = (i + j) // <span class=\"hljs-number\">2</span><br>            <span class=\"hljs-keyword\">if</span> numbers[m] &gt; numbers[j]: i = m + <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">elif</span> numbers[m] &lt; numbers[j]: j = m<br>            <span class=\"hljs-keyword\">else</span>: j -= <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> numbers[i]<br></code></pre></td></tr></tbody></table></figure>\n<p>实际上，当出现 nums[m] = nums[j] 时，一定有区间[i,m]内所有元素相等 或 区间 [m,j] 内所有元素相等（或两者皆满足）。对于寻找此类数组的最小值问题，可直接放弃二分查找，而使用线性查找替代。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">minArray</span>(<span class=\"hljs-params\">self, numbers: [<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        i, j = <span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(numbers) - <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">while</span> i &lt; j:<br>            m = (i + j) // <span class=\"hljs-number\">2</span><br>            <span class=\"hljs-keyword\">if</span> numbers[m] &gt; numbers[j]: i = m + <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">elif</span> numbers[m] &lt; numbers[j]: j = m<br>            <span class=\"hljs-keyword\">else</span>: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">min</span>(numbers[i:j])<br>        <span class=\"hljs-keyword\">return</span> numbers[i]<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>旋转数组的最小数字</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>把一个数组最开始的若干个元素搬到数组的末尾，我们称之为数组的旋转。输入一个递增排序的数组的一个旋转，输出旋转数组的最小元素。例如，数组 [3,4,5,1,2] 为 [1,2,3,4,5] 的一个旋转，该数组的最小值为1。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs accesslog\">输入：<span class=\"hljs-string\">[3,4,5,1,2]</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs accesslog\">输入：<span class=\"hljs-string\">[2,2,2,0,1]</span><br>输出：<span class=\"hljs-number\">0</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"题解\">题解</h2>\n<p>将数组遍历一遍，遇到第一个非增序的元素即为最小值。复杂度为线性级别。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">minArray</span>(<span class=\"hljs-params\">self, numbers: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(numbers):<span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br>        minitem = numbers[<span class=\"hljs-number\">0</span>]<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-built_in\">len</span>(numbers)):<br>            <span class=\"hljs-keyword\">if</span> numbers[i]&lt;numbers[i-<span class=\"hljs-number\">1</span>]:<br>                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">min</span>(minitem,numbers[i])<br>        <span class=\"hljs-keyword\">return</span> minitem<br></code></pre></td></tr></table></figure>\n<p>还可以使用二分法，将线性级别的复杂度降低到对数级别。</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer11-pic1.png\" alt=\"\"></p>\n<p>最低点有特性：左边的所有元素都要比右边所有元素大。利用这个特性可以逐渐缩小范围。</p>\n<p>中间元素和某个边界元素比较大小，来确定范围，<u>但是要注意两者相等时就没有确切的判断了</u>。可以直接用线性比较来替代。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">minArray</span>(<span class=\"hljs-params\">self, numbers: [<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        i, j = <span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(numbers) - <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">while</span> i &lt; j:<br>            m = (i + j) // <span class=\"hljs-number\">2</span><br>            <span class=\"hljs-keyword\">if</span> numbers[m] &gt; numbers[j]: i = m + <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">elif</span> numbers[m] &lt; numbers[j]: j = m<br>            <span class=\"hljs-keyword\">else</span>: j -= <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> numbers[i]<br></code></pre></td></tr></table></figure>\n<p>实际上，当出现 nums[m] = nums[j] 时，一定有区间[i,m]内所有元素相等 或 区间 [m,j] 内所有元素相等（或两者皆满足）。对于寻找此类数组的最小值问题，可直接放弃二分查找，而使用线性查找替代。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">minArray</span>(<span class=\"hljs-params\">self, numbers: [<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        i, j = <span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(numbers) - <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">while</span> i &lt; j:<br>            m = (i + j) // <span class=\"hljs-number\">2</span><br>            <span class=\"hljs-keyword\">if</span> numbers[m] &gt; numbers[j]: i = m + <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">elif</span> numbers[m] &lt; numbers[j]: j = m<br>            <span class=\"hljs-keyword\">else</span>: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">min</span>(numbers[i:j])<br>        <span class=\"hljs-keyword\">return</span> numbers[i]<br></code></pre></td></tr></table></figure>\n"},{"title":"拉普拉斯算子","date":"2021-08-20T06:27:00.000Z","math":true,"_content":"\n>  ​\t图像锐化处理的作用是使灰度反差增强，从而使模糊图像变得更加清晰。图像模糊的实质就是图像受到平均运算或积分运算，因此可以对图像进行逆运算，如微分运算能够突出图像细节，使图像变得更为清晰。\n> ​\t积分运算的模板可以平滑图像，反过来对应微分运算的模板卷积可以锐化图像。锐化模板系数的取值再中心为正数而周围为负数。或者中心为负数周围为正数。而拉普拉斯算子就是一种常用的线性锐化滤波的方法。\n\n## 拉普拉斯的背景\n\n在图像中的边缘区域，像素值会发生“跳跃”，对这些像素求导，在其一阶导数在边缘位置为极值（Sobel算子）：\n\n![img](https://picture.mulindya.com/laplace-pic1.png)\n\n如果对像素值求二阶导数，会发现边缘处的导数值为0；**但是并不是说二阶导数为0就意味着是边缘**。\n\n![](https://picture.mulindya.com/laplace-pic2.png)\n\n## 计算方法\n\n### 像素二阶导数\n\n二阶导数的计算方法：\n$$\n\\nabla^2f = \\frac{\\partial^2 f}{\\partial x^2}+\\frac{\\partial^2 f}{\\partial y^2}\n$$\n分别沿着X和Y方向有二阶偏导数均可借用差分计算：\n$$\n\\frac{\\partial^2 f}{\\partial x^2} = f(x+1,y)+f(x-1,y)-2f(x,y)\n$$\n\n$$\n\\frac{\\partial^2 f}{\\partial y^2} = f(x,y+1)+f(x,y-1)-2f(x,y)\n$$\n\n那么可以得到\n$$\n\\nabla^2f = f(x+1,y)+f(x-1,y)+f(x,y+1)+f(x,y-1)-4f(x,y)\n$$\n### 模板卷积\n\n对应的模板卷积即为\n\n{%raw%}\n$$\n\\begin{bmatrix} 0 & 1 & 0\\\\ 1 & -4 & 1 \\\\ 0 & 1 & 0 \\end{bmatrix} 或者\\begin{bmatrix} 0 & -1 & 0 \\\\ -1 & 4 & -1 \\\\ 0 & -1 & 0 \\end{bmatrix}\n$$\n{%endraw%}\n\n前者是mask中心为负数，后者是mask中心为正数；他们的目的和效果是一致的，只是表现形式稍有不同，前者在卷积后，在边缘的亮处为负数，在边缘暗处为正数。后者相反。\n\nmask为负数时，在边缘的亮处为负数，在边缘暗处为正数。可以参见下图：\n\n![](https://picture.mulindya.com/laplace-pic3.png)\n\n上述是考虑中心像素4邻域，类似还有考虑8邻域，此时中心点区8或-8，周围为-1或1。\n\n{%raw%}\n$$\n\\begin{bmatrix} 1 & 1 & 1 \\\\ 1 & -8 & 1 \\\\ 1 & 1 & 1 \\end{bmatrix} 或者\\begin{bmatrix} -1 & -1 & -1 \\\\ -1 & 8 & -1 \\\\ -1 & -1 & -1 \\end{bmatrix}\n$$\n\n{%endraw%}\n\n## 图像锐化\n\n锐化处理可选择拉普拉斯算子对原图像进行处理，产生描述灰度突变的图像，再将拉普拉斯图像与原始图像叠加而产生锐化图像。拉普拉斯锐化的基本方法可以由下式表示：\n$$\ng(x,y) = \\begin{cases} f(x,y) - \\nabla^2f(x,y) & \\text{mask中心为负数}\\\\f(x,y) + \\nabla^2f(x,y) & \\text{mask中心为正数} \\end{cases}\n$$\n\n这种简单的锐化方法既可以产生拉普拉斯锐化处理的效果，同时又能保留背景信息，将原始图像叠加到拉普拉斯变换的处理结果中去，可以使图像中的各灰度值得到保留，使灰度突变处的对比度得到增强，**最终结果是在保留图像背景的前提下，突现出图像中小的细节信息**。\n\n缺点是没有了边缘的方向信息；双倍加强了噪声的影响。\n\n> 锐化处理的公式从模板形式容易看出，如果在图像中一个较暗的区域中出现了一个亮点，那么用拉普拉斯运算就会使这个亮点变得更亮。因为图像中的边缘就是那些灰度发生跳变的区域，所以拉普拉斯锐化模板在边缘检测中很有用。一般增强技术对于陡峭的边缘和缓慢变化的边缘很难确定其边缘线的位置。但此算子却可用二次微分正峰和负峰之间的过零点来确定，对孤立点或端点更为敏感，因此特别适用于以**突出图像中的孤立点、孤立线或线端点为目的的场合**。同梯度算子一样，拉普拉斯算子也会增强图像中的噪声，有时用拉普拉斯算子进行边缘检测时，可将图像先进行**平滑处理**。\n\n## 代码\n\n在OpenCV内使用函数cv2.Laplacian()实现Laplacian算子的计算，该函数的语法格式为：\n\n```\ndst = cv2.Laplacian( src, ddepth[, ksize[, scale[, delta[, borderType]]]] )\n```\n\n式中：\n● dst代表目标图像。\n● src代表原始图像。\n● ddepth代表目标图像的深度。\n● ksize代表用于计算二阶导数的核尺寸大小。该值必须是正的奇数。\n● scale代表计算Laplacian值的缩放比例因子，该参数是可选的。默认情况下，该值为1，表示不进行缩放。\n● delta代表加到目标图像上的可选值，默认为0。\n● borderType : 用于推断图像外部像素的边界模式，一般是DORDER_DEFAULT,不支持BORDER_WRAP.\n\n```python\nimport cv2\nimg = cv2.imread(\"img.png\",0)\nlaplacian = cv2.Laplacian(img,cv2.CV_64F)\nlaplacian = cv2.convertScaleABs(laplacian)\ncv2.imshow(img)\ncv2.imshow(laplacian)\n```\n原图\n![](https://picture.mulindya.com/laplace-pic4.png)\n处理之后\n![](https://picture.mulindya.com/laplace-pic5.png)\n\n","source":"_posts/img_process/laplace.md","raw":"---\ntitle: 拉普拉斯算子\ntags: [图像处理]\ncategories: [图像处理]\ndate: 2021-08-20 14:27:00\nmath: true\n---\n\n>  ​\t图像锐化处理的作用是使灰度反差增强，从而使模糊图像变得更加清晰。图像模糊的实质就是图像受到平均运算或积分运算，因此可以对图像进行逆运算，如微分运算能够突出图像细节，使图像变得更为清晰。\n> ​\t积分运算的模板可以平滑图像，反过来对应微分运算的模板卷积可以锐化图像。锐化模板系数的取值再中心为正数而周围为负数。或者中心为负数周围为正数。而拉普拉斯算子就是一种常用的线性锐化滤波的方法。\n\n## 拉普拉斯的背景\n\n在图像中的边缘区域，像素值会发生“跳跃”，对这些像素求导，在其一阶导数在边缘位置为极值（Sobel算子）：\n\n![img](https://picture.mulindya.com/laplace-pic1.png)\n\n如果对像素值求二阶导数，会发现边缘处的导数值为0；**但是并不是说二阶导数为0就意味着是边缘**。\n\n![](https://picture.mulindya.com/laplace-pic2.png)\n\n## 计算方法\n\n### 像素二阶导数\n\n二阶导数的计算方法：\n$$\n\\nabla^2f = \\frac{\\partial^2 f}{\\partial x^2}+\\frac{\\partial^2 f}{\\partial y^2}\n$$\n分别沿着X和Y方向有二阶偏导数均可借用差分计算：\n$$\n\\frac{\\partial^2 f}{\\partial x^2} = f(x+1,y)+f(x-1,y)-2f(x,y)\n$$\n\n$$\n\\frac{\\partial^2 f}{\\partial y^2} = f(x,y+1)+f(x,y-1)-2f(x,y)\n$$\n\n那么可以得到\n$$\n\\nabla^2f = f(x+1,y)+f(x-1,y)+f(x,y+1)+f(x,y-1)-4f(x,y)\n$$\n### 模板卷积\n\n对应的模板卷积即为\n\n{%raw%}\n$$\n\\begin{bmatrix} 0 & 1 & 0\\\\ 1 & -4 & 1 \\\\ 0 & 1 & 0 \\end{bmatrix} 或者\\begin{bmatrix} 0 & -1 & 0 \\\\ -1 & 4 & -1 \\\\ 0 & -1 & 0 \\end{bmatrix}\n$$\n{%endraw%}\n\n前者是mask中心为负数，后者是mask中心为正数；他们的目的和效果是一致的，只是表现形式稍有不同，前者在卷积后，在边缘的亮处为负数，在边缘暗处为正数。后者相反。\n\nmask为负数时，在边缘的亮处为负数，在边缘暗处为正数。可以参见下图：\n\n![](https://picture.mulindya.com/laplace-pic3.png)\n\n上述是考虑中心像素4邻域，类似还有考虑8邻域，此时中心点区8或-8，周围为-1或1。\n\n{%raw%}\n$$\n\\begin{bmatrix} 1 & 1 & 1 \\\\ 1 & -8 & 1 \\\\ 1 & 1 & 1 \\end{bmatrix} 或者\\begin{bmatrix} -1 & -1 & -1 \\\\ -1 & 8 & -1 \\\\ -1 & -1 & -1 \\end{bmatrix}\n$$\n\n{%endraw%}\n\n## 图像锐化\n\n锐化处理可选择拉普拉斯算子对原图像进行处理，产生描述灰度突变的图像，再将拉普拉斯图像与原始图像叠加而产生锐化图像。拉普拉斯锐化的基本方法可以由下式表示：\n$$\ng(x,y) = \\begin{cases} f(x,y) - \\nabla^2f(x,y) & \\text{mask中心为负数}\\\\f(x,y) + \\nabla^2f(x,y) & \\text{mask中心为正数} \\end{cases}\n$$\n\n这种简单的锐化方法既可以产生拉普拉斯锐化处理的效果，同时又能保留背景信息，将原始图像叠加到拉普拉斯变换的处理结果中去，可以使图像中的各灰度值得到保留，使灰度突变处的对比度得到增强，**最终结果是在保留图像背景的前提下，突现出图像中小的细节信息**。\n\n缺点是没有了边缘的方向信息；双倍加强了噪声的影响。\n\n> 锐化处理的公式从模板形式容易看出，如果在图像中一个较暗的区域中出现了一个亮点，那么用拉普拉斯运算就会使这个亮点变得更亮。因为图像中的边缘就是那些灰度发生跳变的区域，所以拉普拉斯锐化模板在边缘检测中很有用。一般增强技术对于陡峭的边缘和缓慢变化的边缘很难确定其边缘线的位置。但此算子却可用二次微分正峰和负峰之间的过零点来确定，对孤立点或端点更为敏感，因此特别适用于以**突出图像中的孤立点、孤立线或线端点为目的的场合**。同梯度算子一样，拉普拉斯算子也会增强图像中的噪声，有时用拉普拉斯算子进行边缘检测时，可将图像先进行**平滑处理**。\n\n## 代码\n\n在OpenCV内使用函数cv2.Laplacian()实现Laplacian算子的计算，该函数的语法格式为：\n\n```\ndst = cv2.Laplacian( src, ddepth[, ksize[, scale[, delta[, borderType]]]] )\n```\n\n式中：\n● dst代表目标图像。\n● src代表原始图像。\n● ddepth代表目标图像的深度。\n● ksize代表用于计算二阶导数的核尺寸大小。该值必须是正的奇数。\n● scale代表计算Laplacian值的缩放比例因子，该参数是可选的。默认情况下，该值为1，表示不进行缩放。\n● delta代表加到目标图像上的可选值，默认为0。\n● borderType : 用于推断图像外部像素的边界模式，一般是DORDER_DEFAULT,不支持BORDER_WRAP.\n\n```python\nimport cv2\nimg = cv2.imread(\"img.png\",0)\nlaplacian = cv2.Laplacian(img,cv2.CV_64F)\nlaplacian = cv2.convertScaleABs(laplacian)\ncv2.imshow(img)\ncv2.imshow(laplacian)\n```\n原图\n![](https://picture.mulindya.com/laplace-pic4.png)\n处理之后\n![](https://picture.mulindya.com/laplace-pic5.png)\n\n","slug":"img_process/laplace","published":1,"updated":"2022-01-18T08:10:17.056Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p08q0027ast93c58awk1","content":"<blockquote>\n<p>​\t图像锐化处理的作用是使灰度反差增强，从而使模糊图像变得更加清晰。图像模糊的实质就是图像受到平均运算或积分运算，因此可以对图像进行逆运算，如微分运算能够突出图像细节，使图像变得更为清晰。<br>\n​\t积分运算的模板可以平滑图像，反过来对应微分运算的模板卷积可以锐化图像。锐化模板系数的取值再中心为正数而周围为负数。或者中心为负数周围为正数。而拉普拉斯算子就是一种常用的线性锐化滤波的方法。</p>\n</blockquote>\n<h2 id=\"拉普拉斯的背景\">拉普拉斯的背景</h2>\n<p>在图像中的边缘区域，像素值会发生“跳跃”，对这些像素求导，在其一阶导数在边缘位置为极值（Sobel算子）：</p>\n<p><img src=\"https://picture.mulindya.com/laplace-pic1.png\" alt=\"img\"></p>\n<p>如果对像素值求二阶导数，会发现边缘处的导数值为0；<strong>但是并不是说二阶导数为0就意味着是边缘</strong>。</p>\n<p><img src=\"https://picture.mulindya.com/laplace-pic2.png\" alt=\"\"></p>\n<h2 id=\"计算方法\">计算方法</h2>\n<h3 id=\"像素二阶导数\">像素二阶导数</h3>\n<p>二阶导数的计算方法：<br>\n$$<br>\n\\nabla^2f = \\frac{\\partial^2 f}{\\partial x<sup>2}+\\frac{\\partial</sup>2 f}{\\partial y^2}<br>\n$$<br>\n分别沿着X和Y方向有二阶偏导数均可借用差分计算：<br>\n$$<br>\n\\frac{\\partial^2 f}{\\partial x^2} = f(x+1,y)+f(x-1,y)-2f(x,y)<br>\n$$</p>\n<p>$$<br>\n\\frac{\\partial^2 f}{\\partial y^2} = f(x,y+1)+f(x,y-1)-2f(x,y)<br>\n$$</p>\n<p>那么可以得到<br>\n$$<br>\n\\nabla^2f = f(x+1,y)+f(x-1,y)+f(x,y+1)+f(x,y-1)-4f(x,y)<br>\n$$</p>\n<h3 id=\"模板卷积\">模板卷积</h3>\n<p>对应的模板卷积即为</p>\n\n$$\n\\begin{bmatrix} 0 &amp; 1 &amp; 0\\\\ 1 &amp; -4 &amp; 1 \\\\ 0 &amp; 1 &amp; 0 \\end{bmatrix} 或者\\begin{bmatrix} 0 &amp; -1 &amp; 0 \\\\ -1 &amp; 4 &amp; -1 \\\\ 0 &amp; -1 &amp; 0 \\end{bmatrix}\n$$\n\n<p>前者是mask中心为负数，后者是mask中心为正数；他们的目的和效果是一致的，只是表现形式稍有不同，前者在卷积后，在边缘的亮处为负数，在边缘暗处为正数。后者相反。</p>\n<p>mask为负数时，在边缘的亮处为负数，在边缘暗处为正数。可以参见下图：</p>\n<p><img src=\"https://picture.mulindya.com/laplace-pic3.png\" alt=\"\"></p>\n<p>上述是考虑中心像素4邻域，类似还有考虑8邻域，此时中心点区8或-8，周围为-1或1。</p>\n\n$$\n\\begin{bmatrix} 1 &amp; 1 &amp; 1 \\\\ 1 &amp; -8 &amp; 1 \\\\ 1 &amp; 1 &amp; 1 \\end{bmatrix} 或者\\begin{bmatrix} -1 &amp; -1 &amp; -1 \\\\ -1 &amp; 8 &amp; -1 \\\\ -1 &amp; -1 &amp; -1 \\end{bmatrix}\n$$\n\n\n<h2 id=\"图像锐化\">图像锐化</h2>\n<p>锐化处理可选择拉普拉斯算子对原图像进行处理，产生描述灰度突变的图像，再将拉普拉斯图像与原始图像叠加而产生锐化图像。拉普拉斯锐化的基本方法可以由下式表示：<br>\n$$<br>\ng(x,y) = \\begin{cases} f(x,y) - \\nabla^2f(x,y) &amp; \\text{mask中心为负数}\\f(x,y) + \\nabla^2f(x,y) &amp; \\text{mask中心为正数} \\end{cases}<br>\n$$</p>\n<p>这种简单的锐化方法既可以产生拉普拉斯锐化处理的效果，同时又能保留背景信息，将原始图像叠加到拉普拉斯变换的处理结果中去，可以使图像中的各灰度值得到保留，使灰度突变处的对比度得到增强，<strong>最终结果是在保留图像背景的前提下，突现出图像中小的细节信息</strong>。</p>\n<p>缺点是没有了边缘的方向信息；双倍加强了噪声的影响。</p>\n<blockquote>\n<p>锐化处理的公式从模板形式容易看出，如果在图像中一个较暗的区域中出现了一个亮点，那么用拉普拉斯运算就会使这个亮点变得更亮。因为图像中的边缘就是那些灰度发生跳变的区域，所以拉普拉斯锐化模板在边缘检测中很有用。一般增强技术对于陡峭的边缘和缓慢变化的边缘很难确定其边缘线的位置。但此算子却可用二次微分正峰和负峰之间的过零点来确定，对孤立点或端点更为敏感，因此特别适用于以<strong>突出图像中的孤立点、孤立线或线端点为目的的场合</strong>。同梯度算子一样，拉普拉斯算子也会增强图像中的噪声，有时用拉普拉斯算子进行边缘检测时，可将图像先进行<strong>平滑处理</strong>。</p>\n</blockquote>\n<h2 id=\"代码\">代码</h2>\n<p>在OpenCV内使用函数cv2.Laplacian()实现Laplacian算子的计算，该函数的语法格式为：</p>\n<figure class=\"highlight reasonml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs reasonml\">dst = cv2.<span class=\"hljs-constructor\">Laplacian( <span class=\"hljs-params\">src</span>, <span class=\"hljs-params\">ddepth</span>[, <span class=\"hljs-params\">ksize</span>[, <span class=\"hljs-params\">scale</span>[, <span class=\"hljs-params\">delta</span>[, <span class=\"hljs-params\">borderType</span>]]]] )</span><br></code></pre></td></tr></tbody></table></figure>\n<p>式中：<br>\n● dst代表目标图像。<br>\n● src代表原始图像。<br>\n● ddepth代表目标图像的深度。<br>\n● ksize代表用于计算二阶导数的核尺寸大小。该值必须是正的奇数。<br>\n● scale代表计算Laplacian值的缩放比例因子，该参数是可选的。默认情况下，该值为1，表示不进行缩放。<br>\n● delta代表加到目标图像上的可选值，默认为0。<br>\n● borderType : 用于推断图像外部像素的边界模式，一般是DORDER_DEFAULT,不支持BORDER_WRAP.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br>img = cv2.imread(<span class=\"hljs-string\">\"img.png\"</span>,<span class=\"hljs-number\">0</span>)<br>laplacian = cv2.Laplacian(img,cv2.CV_64F)<br>laplacian = cv2.convertScaleABs(laplacian)<br>cv2.imshow(img)<br>cv2.imshow(laplacian)<br></code></pre></td></tr></tbody></table></figure>\n<p>原图<br>\n<img src=\"https://picture.mulindya.com/laplace-pic4.png\" alt=\"\"><br>\n处理之后<br>\n<img src=\"https://picture.mulindya.com/laplace-pic5.png\" alt=\"\"></p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>​\t图像锐化处理的作用是使灰度反差增强，从而使模糊图像变得更加清晰。图像模糊的实质就是图像受到平均运算或积分运算，因此可以对图像进行逆运算，如微分运算能够突出图像细节，使图像变得更为清晰。<br>\n​\t积分运算的模板可以平滑图像，反过来对应微分运算的模板卷积可以锐化图像。锐化模板系数的取值再中心为正数而周围为负数。或者中心为负数周围为正数。而拉普拉斯算子就是一种常用的线性锐化滤波的方法。</p>\n</blockquote>\n<h2 id=\"拉普拉斯的背景\">拉普拉斯的背景</h2>\n<p>在图像中的边缘区域，像素值会发生“跳跃”，对这些像素求导，在其一阶导数在边缘位置为极值（Sobel算子）：</p>\n<p><img src=\"https://picture.mulindya.com/laplace-pic1.png\" alt=\"img\"></p>\n<p>如果对像素值求二阶导数，会发现边缘处的导数值为0；<strong>但是并不是说二阶导数为0就意味着是边缘</strong>。</p>\n<p><img src=\"https://picture.mulindya.com/laplace-pic2.png\" alt=\"\"></p>\n<h2 id=\"计算方法\">计算方法</h2>\n<h3 id=\"像素二阶导数\">像素二阶导数</h3>\n<p>二阶导数的计算方法：<br>\n$$<br>\n\\nabla^2f = \\frac{\\partial^2 f}{\\partial x<sup>2}+\\frac{\\partial</sup>2 f}{\\partial y^2}<br>\n$$<br>\n分别沿着X和Y方向有二阶偏导数均可借用差分计算：<br>\n$$<br>\n\\frac{\\partial^2 f}{\\partial x^2} = f(x+1,y)+f(x-1,y)-2f(x,y)<br>\n$$</p>\n<p>$$<br>\n\\frac{\\partial^2 f}{\\partial y^2} = f(x,y+1)+f(x,y-1)-2f(x,y)<br>\n$$</p>\n<p>那么可以得到<br>\n$$<br>\n\\nabla^2f = f(x+1,y)+f(x-1,y)+f(x,y+1)+f(x,y-1)-4f(x,y)<br>\n$$</p>\n<h3 id=\"模板卷积\">模板卷积</h3>\n<p>对应的模板卷积即为</p>\n\n$$\n\\begin{bmatrix} 0 & 1 & 0\\\\ 1 & -4 & 1 \\\\ 0 & 1 & 0 \\end{bmatrix} 或者\\begin{bmatrix} 0 & -1 & 0 \\\\ -1 & 4 & -1 \\\\ 0 & -1 & 0 \\end{bmatrix}\n$$\n\n<p>前者是mask中心为负数，后者是mask中心为正数；他们的目的和效果是一致的，只是表现形式稍有不同，前者在卷积后，在边缘的亮处为负数，在边缘暗处为正数。后者相反。</p>\n<p>mask为负数时，在边缘的亮处为负数，在边缘暗处为正数。可以参见下图：</p>\n<p><img src=\"https://picture.mulindya.com/laplace-pic3.png\" alt=\"\"></p>\n<p>上述是考虑中心像素4邻域，类似还有考虑8邻域，此时中心点区8或-8，周围为-1或1。</p>\n\n$$\n\\begin{bmatrix} 1 & 1 & 1 \\\\ 1 & -8 & 1 \\\\ 1 & 1 & 1 \\end{bmatrix} 或者\\begin{bmatrix} -1 & -1 & -1 \\\\ -1 & 8 & -1 \\\\ -1 & -1 & -1 \\end{bmatrix}\n$$\n\n\n<h2 id=\"图像锐化\">图像锐化</h2>\n<p>锐化处理可选择拉普拉斯算子对原图像进行处理，产生描述灰度突变的图像，再将拉普拉斯图像与原始图像叠加而产生锐化图像。拉普拉斯锐化的基本方法可以由下式表示：<br>\n$$<br>\ng(x,y) = \\begin{cases} f(x,y) - \\nabla^2f(x,y) &amp; \\text{mask中心为负数}\\f(x,y) + \\nabla^2f(x,y) &amp; \\text{mask中心为正数} \\end{cases}<br>\n$$</p>\n<p>这种简单的锐化方法既可以产生拉普拉斯锐化处理的效果，同时又能保留背景信息，将原始图像叠加到拉普拉斯变换的处理结果中去，可以使图像中的各灰度值得到保留，使灰度突变处的对比度得到增强，<strong>最终结果是在保留图像背景的前提下，突现出图像中小的细节信息</strong>。</p>\n<p>缺点是没有了边缘的方向信息；双倍加强了噪声的影响。</p>\n<blockquote>\n<p>锐化处理的公式从模板形式容易看出，如果在图像中一个较暗的区域中出现了一个亮点，那么用拉普拉斯运算就会使这个亮点变得更亮。因为图像中的边缘就是那些灰度发生跳变的区域，所以拉普拉斯锐化模板在边缘检测中很有用。一般增强技术对于陡峭的边缘和缓慢变化的边缘很难确定其边缘线的位置。但此算子却可用二次微分正峰和负峰之间的过零点来确定，对孤立点或端点更为敏感，因此特别适用于以<strong>突出图像中的孤立点、孤立线或线端点为目的的场合</strong>。同梯度算子一样，拉普拉斯算子也会增强图像中的噪声，有时用拉普拉斯算子进行边缘检测时，可将图像先进行<strong>平滑处理</strong>。</p>\n</blockquote>\n<h2 id=\"代码\">代码</h2>\n<p>在OpenCV内使用函数cv2.Laplacian()实现Laplacian算子的计算，该函数的语法格式为：</p>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs reasonml\">dst = cv2.<span class=\"hljs-constructor\">Laplacian( <span class=\"hljs-params\">src</span>, <span class=\"hljs-params\">ddepth</span>[, <span class=\"hljs-params\">ksize</span>[, <span class=\"hljs-params\">scale</span>[, <span class=\"hljs-params\">delta</span>[, <span class=\"hljs-params\">borderType</span>]]]] )</span><br></code></pre></td></tr></table></figure>\n<p>式中：<br>\n● dst代表目标图像。<br>\n● src代表原始图像。<br>\n● ddepth代表目标图像的深度。<br>\n● ksize代表用于计算二阶导数的核尺寸大小。该值必须是正的奇数。<br>\n● scale代表计算Laplacian值的缩放比例因子，该参数是可选的。默认情况下，该值为1，表示不进行缩放。<br>\n● delta代表加到目标图像上的可选值，默认为0。<br>\n● borderType : 用于推断图像外部像素的边界模式，一般是DORDER_DEFAULT,不支持BORDER_WRAP.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br>img = cv2.imread(<span class=\"hljs-string\">&quot;img.png&quot;</span>,<span class=\"hljs-number\">0</span>)<br>laplacian = cv2.Laplacian(img,cv2.CV_64F)<br>laplacian = cv2.convertScaleABs(laplacian)<br>cv2.imshow(img)<br>cv2.imshow(laplacian)<br></code></pre></td></tr></table></figure>\n<p>原图<br>\n<img src=\"https://picture.mulindya.com/laplace-pic4.png\" alt=\"\"><br>\n处理之后<br>\n<img src=\"https://picture.mulindya.com/laplace-pic5.png\" alt=\"\"></p>\n"},{"title":"剑指offer12 矩阵中的路径","date":"2021-08-13T17:04:59.000Z","_content":"\n>矩阵中的路径\n\n## 题目\n\n给定一个 m x n 二维字符网格 board 和一个字符串单词 word 。如果 word 存在于网格中，返回 true ；否则，返回 false 。\n\n单词必须按照字母顺序，通过相邻的单元格内的字母构成，其中“相邻”单元格是那些水平相邻或垂直相邻的单元格。同一个单元格内的字母不允许被重复使用。\n\n例如，在下面的 3×4 的矩阵中包含单词 \"ABCCED\"（单词中的字母已标出）。\n\n![](https://picture.mulindya.com/leetcode-offer12-pic1.jpg)\n\n### 示例 1：\n\n```\n输入：board = [[\"A\",\"B\",\"C\",\"E\"],[\"S\",\"F\",\"C\",\"S\"],[\"A\",\"D\",\"E\",\"E\"]], word = \"ABCCED\"\n输出：true\n```\n\n### 示例 2：\n\n```\n输入：board = [[\"a\",\"b\"],[\"c\",\"d\"]], word = \"abcd\"\n输出：false\n```\n\n### 提示：\n\n- `1 <= board.length <= 200`\n- `1 <= board[i].length <= 200`\n- `board` 和 `word` 仅由大小写英文字母组成\n\n## 题解\n\n循环遍历二维数组，以此为起点判断是否存在连续的字符串。在dfs中首先进行边界范围判断，以及此点是否满足要求，如果不满足要求直接返回假，为真则继续word判断之后的字符。如果以及是最后的字符就可以直接返回结果。<font color=purple>注意在判断k+1之前需要先mask掉自身的值，防止后续“路线返回”</font>\n\n```python\nclass Solution(object):\n    def exist(self, board, word):\n        \"\"\"\n        :type board: List[List[str]]\n        :type word: str\n        :rtype: bool\n        \"\"\"\n        def dfs(i,j,k):\n            if (not len(board)>i>=0) or (not len(board[0])>j>=0) or board[i][j]!=word[k]: return False \n            #不匹配的情况\n            if k == len(word)-1: return True #不用继续判断\n            board[i][j] = ' '\n            # #注意不能直接返回 因为在处理邻近的内容会判断到自身，这是不允许的，所以先mask\n            # return dfs(i+1,j,k+1) or dfs(i-1,j,k+1) or dfs(i,j+1,k+1) or dfs(i,j-1,k+1) \n            res = dfs(i+1,j,k+1) or dfs(i-1,j,k+1) or dfs(i,j+1,k+1) or dfs(i,j-1,k+1) \n            board[i][j] = word[k]\n            return res\n        for i in range(len(board)):\n            for j in range(len(board[0])):\n                if dfs(i,j,0): return True #如果从ij开始找0之后的字符串找到则为真\n        return False\n```\n\n","source":"_posts/leetcode/leetcode-offer12.md","raw":"---\ntitle: 剑指offer12 矩阵中的路径\ntags: [剑指,DFS,idea]\ncategories: [剑指,DFS]\ndate: 2021-08-14 01:04:59\n---\n\n>矩阵中的路径\n\n## 题目\n\n给定一个 m x n 二维字符网格 board 和一个字符串单词 word 。如果 word 存在于网格中，返回 true ；否则，返回 false 。\n\n单词必须按照字母顺序，通过相邻的单元格内的字母构成，其中“相邻”单元格是那些水平相邻或垂直相邻的单元格。同一个单元格内的字母不允许被重复使用。\n\n例如，在下面的 3×4 的矩阵中包含单词 \"ABCCED\"（单词中的字母已标出）。\n\n![](https://picture.mulindya.com/leetcode-offer12-pic1.jpg)\n\n### 示例 1：\n\n```\n输入：board = [[\"A\",\"B\",\"C\",\"E\"],[\"S\",\"F\",\"C\",\"S\"],[\"A\",\"D\",\"E\",\"E\"]], word = \"ABCCED\"\n输出：true\n```\n\n### 示例 2：\n\n```\n输入：board = [[\"a\",\"b\"],[\"c\",\"d\"]], word = \"abcd\"\n输出：false\n```\n\n### 提示：\n\n- `1 <= board.length <= 200`\n- `1 <= board[i].length <= 200`\n- `board` 和 `word` 仅由大小写英文字母组成\n\n## 题解\n\n循环遍历二维数组，以此为起点判断是否存在连续的字符串。在dfs中首先进行边界范围判断，以及此点是否满足要求，如果不满足要求直接返回假，为真则继续word判断之后的字符。如果以及是最后的字符就可以直接返回结果。<font color=purple>注意在判断k+1之前需要先mask掉自身的值，防止后续“路线返回”</font>\n\n```python\nclass Solution(object):\n    def exist(self, board, word):\n        \"\"\"\n        :type board: List[List[str]]\n        :type word: str\n        :rtype: bool\n        \"\"\"\n        def dfs(i,j,k):\n            if (not len(board)>i>=0) or (not len(board[0])>j>=0) or board[i][j]!=word[k]: return False \n            #不匹配的情况\n            if k == len(word)-1: return True #不用继续判断\n            board[i][j] = ' '\n            # #注意不能直接返回 因为在处理邻近的内容会判断到自身，这是不允许的，所以先mask\n            # return dfs(i+1,j,k+1) or dfs(i-1,j,k+1) or dfs(i,j+1,k+1) or dfs(i,j-1,k+1) \n            res = dfs(i+1,j,k+1) or dfs(i-1,j,k+1) or dfs(i,j+1,k+1) or dfs(i,j-1,k+1) \n            board[i][j] = word[k]\n            return res\n        for i in range(len(board)):\n            for j in range(len(board[0])):\n                if dfs(i,j,0): return True #如果从ij开始找0之后的字符串找到则为真\n        return False\n```\n\n","slug":"leetcode/leetcode-offer12","published":1,"updated":"2022-01-18T08:10:17.066Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p08s002aast984fdc8mb","content":"<blockquote>\n<p>矩阵中的路径</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给定一个 m x n 二维字符网格 board 和一个字符串单词 word 。如果 word 存在于网格中，返回 true ；否则，返回 false 。</p>\n<p>单词必须按照字母顺序，通过相邻的单元格内的字母构成，其中“相邻”单元格是那些水平相邻或垂直相邻的单元格。同一个单元格内的字母不允许被重复使用。</p>\n<p>例如，在下面的 3×4 的矩阵中包含单词 “ABCCED”（单词中的字母已标出）。</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer12-pic1.jpg\" alt=\"\"></p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight prolog\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs prolog\">输入：board = [[<span class=\"hljs-string\">\"A\"</span>,<span class=\"hljs-string\">\"B\"</span>,<span class=\"hljs-string\">\"C\"</span>,<span class=\"hljs-string\">\"E\"</span>],[<span class=\"hljs-string\">\"S\"</span>,<span class=\"hljs-string\">\"F\"</span>,<span class=\"hljs-string\">\"C\"</span>,<span class=\"hljs-string\">\"S\"</span>],[<span class=\"hljs-string\">\"A\"</span>,<span class=\"hljs-string\">\"D\"</span>,<span class=\"hljs-string\">\"E\"</span>,<span class=\"hljs-string\">\"E\"</span>]], word = <span class=\"hljs-string\">\"ABCCED\"</span><br>输出：true<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">board</span> = [[<span class=\"hljs-string\">\"a\"</span>,<span class=\"hljs-string\">\"b\"</span>],[<span class=\"hljs-string\">\"c\"</span>,<span class=\"hljs-string\">\"d\"</span>]], <span class=\"hljs-attr\">word</span> = <span class=\"hljs-string\">\"abcd\"</span><br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>1 &lt;= board.length &lt;= 200</code></li>\n<li><code>1 &lt;= board[i].length &lt;= 200</code></li>\n<li><code>board</code> 和 <code>word</code> 仅由大小写英文字母组成</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>循环遍历二维数组，以此为起点判断是否存在连续的字符串。在dfs中首先进行边界范围判断，以及此点是否满足要求，如果不满足要求直接返回假，为真则继续word判断之后的字符。如果以及是最后的字符就可以直接返回结果。<font color=\"purple\">注意在判断k+1之前需要先mask掉自身的值，防止后续“路线返回”</font></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">object</span></span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">exist</span>(<span class=\"hljs-params\">self, board, word</span>):</span><br>        <span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\">        :type board: List[List[str]]</span><br><span class=\"hljs-string\">        :type word: str</span><br><span class=\"hljs-string\">        :rtype: bool</span><br><span class=\"hljs-string\">        \"\"\"</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">i,j,k</span>):</span><br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">len</span>(board)&gt;i&gt;=<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">or</span> (<span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">len</span>(board[<span class=\"hljs-number\">0</span>])&gt;j&gt;=<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">or</span> board[i][j]!=word[k]: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span> <br>            <span class=\"hljs-comment\">#不匹配的情况</span><br>            <span class=\"hljs-keyword\">if</span> k == <span class=\"hljs-built_in\">len</span>(word)-<span class=\"hljs-number\">1</span>: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span> <span class=\"hljs-comment\">#不用继续判断</span><br>            board[i][j] = <span class=\"hljs-string\">' '</span><br>            <span class=\"hljs-comment\"># #注意不能直接返回 因为在处理邻近的内容会判断到自身，这是不允许的，所以先mask</span><br>            <span class=\"hljs-comment\"># return dfs(i+1,j,k+1) or dfs(i-1,j,k+1) or dfs(i,j+1,k+1) or dfs(i,j-1,k+1) </span><br>            res = dfs(i+<span class=\"hljs-number\">1</span>,j,k+<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">or</span> dfs(i-<span class=\"hljs-number\">1</span>,j,k+<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">or</span> dfs(i,j+<span class=\"hljs-number\">1</span>,k+<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">or</span> dfs(i,j-<span class=\"hljs-number\">1</span>,k+<span class=\"hljs-number\">1</span>) <br>            board[i][j] = word[k]<br>            <span class=\"hljs-keyword\">return</span> res<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(board)):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(board[<span class=\"hljs-number\">0</span>])):<br>                <span class=\"hljs-keyword\">if</span> dfs(i,j,<span class=\"hljs-number\">0</span>): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span> <span class=\"hljs-comment\">#如果从ij开始找0之后的字符串找到则为真</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>矩阵中的路径</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给定一个 m x n 二维字符网格 board 和一个字符串单词 word 。如果 word 存在于网格中，返回 true ；否则，返回 false 。</p>\n<p>单词必须按照字母顺序，通过相邻的单元格内的字母构成，其中“相邻”单元格是那些水平相邻或垂直相邻的单元格。同一个单元格内的字母不允许被重复使用。</p>\n<p>例如，在下面的 3×4 的矩阵中包含单词 “ABCCED”（单词中的字母已标出）。</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer12-pic1.jpg\" alt=\"\"></p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight prolog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs prolog\">输入：board = [[<span class=\"hljs-string\">&quot;A&quot;</span>,<span class=\"hljs-string\">&quot;B&quot;</span>,<span class=\"hljs-string\">&quot;C&quot;</span>,<span class=\"hljs-string\">&quot;E&quot;</span>],[<span class=\"hljs-string\">&quot;S&quot;</span>,<span class=\"hljs-string\">&quot;F&quot;</span>,<span class=\"hljs-string\">&quot;C&quot;</span>,<span class=\"hljs-string\">&quot;S&quot;</span>],[<span class=\"hljs-string\">&quot;A&quot;</span>,<span class=\"hljs-string\">&quot;D&quot;</span>,<span class=\"hljs-string\">&quot;E&quot;</span>,<span class=\"hljs-string\">&quot;E&quot;</span>]], word = <span class=\"hljs-string\">&quot;ABCCED&quot;</span><br>输出：true<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">board</span> = [[<span class=\"hljs-string\">&quot;a&quot;</span>,<span class=\"hljs-string\">&quot;b&quot;</span>],[<span class=\"hljs-string\">&quot;c&quot;</span>,<span class=\"hljs-string\">&quot;d&quot;</span>]], <span class=\"hljs-attr\">word</span> = <span class=\"hljs-string\">&quot;abcd&quot;</span><br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>1 &lt;= board.length &lt;= 200</code></li>\n<li><code>1 &lt;= board[i].length &lt;= 200</code></li>\n<li><code>board</code> 和 <code>word</code> 仅由大小写英文字母组成</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>循环遍历二维数组，以此为起点判断是否存在连续的字符串。在dfs中首先进行边界范围判断，以及此点是否满足要求，如果不满足要求直接返回假，为真则继续word判断之后的字符。如果以及是最后的字符就可以直接返回结果。<font color=purple>注意在判断k+1之前需要先mask掉自身的值，防止后续“路线返回”</font></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">object</span></span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">exist</span>(<span class=\"hljs-params\">self, board, word</span>):</span><br>        <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">        :type board: List[List[str]]</span><br><span class=\"hljs-string\">        :type word: str</span><br><span class=\"hljs-string\">        :rtype: bool</span><br><span class=\"hljs-string\">        &quot;&quot;&quot;</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">i,j,k</span>):</span><br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">len</span>(board)&gt;i&gt;=<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">or</span> (<span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">len</span>(board[<span class=\"hljs-number\">0</span>])&gt;j&gt;=<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">or</span> board[i][j]!=word[k]: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span> <br>            <span class=\"hljs-comment\">#不匹配的情况</span><br>            <span class=\"hljs-keyword\">if</span> k == <span class=\"hljs-built_in\">len</span>(word)-<span class=\"hljs-number\">1</span>: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span> <span class=\"hljs-comment\">#不用继续判断</span><br>            board[i][j] = <span class=\"hljs-string\">&#x27; &#x27;</span><br>            <span class=\"hljs-comment\"># #注意不能直接返回 因为在处理邻近的内容会判断到自身，这是不允许的，所以先mask</span><br>            <span class=\"hljs-comment\"># return dfs(i+1,j,k+1) or dfs(i-1,j,k+1) or dfs(i,j+1,k+1) or dfs(i,j-1,k+1) </span><br>            res = dfs(i+<span class=\"hljs-number\">1</span>,j,k+<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">or</span> dfs(i-<span class=\"hljs-number\">1</span>,j,k+<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">or</span> dfs(i,j+<span class=\"hljs-number\">1</span>,k+<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">or</span> dfs(i,j-<span class=\"hljs-number\">1</span>,k+<span class=\"hljs-number\">1</span>) <br>            board[i][j] = word[k]<br>            <span class=\"hljs-keyword\">return</span> res<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(board)):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(board[<span class=\"hljs-number\">0</span>])):<br>                <span class=\"hljs-keyword\">if</span> dfs(i,j,<span class=\"hljs-number\">0</span>): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span> <span class=\"hljs-comment\">#如果从ij开始找0之后的字符串找到则为真</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer13 机器人的运动范围","date":"2021-08-14T09:56:11.000Z","_content":"\n>机器人的运动范围\n\n## 题目\n\n地上有一个m行n列的方格，从坐标 [0,0] 到坐标 [m-1,n-1] 。一个机器人从坐标 [0, 0] 的格子开始移动，它每次可以向左、右、上、下移动一格（不能移动到方格外），也不能进入行坐标和列坐标的数位之和大于k的格子。例如，当k为18时，机器人能够进入方格 [35, 37] ，因为3+5+3+7=18。但它不能进入方格 [35, 38]，因为3+5+3+8=19。请问该机器人能够到达多少个格子？\n\n### 示例 1：\n\n```\n输入：m = 2, n = 3, k = 1\n输出：3\n```\n\n### 示例 2：\n\n```\n输入：m = 3, n = 1, k = 0\n输出：1\n```\n\n### 提示：\n\n- `1 <= n,m <= 100`\n- `0 <= k <= 20`\n\n## 题解\n\n### 解法一 DFS\n\n- 深搜+剪枝\n- 优化技巧就是只判断右边和下边就行了，因为左和上是一定会在搜索的过程中被包括的\n\n​        <font color=purple>注意[[1]*n]*m 是浅拷贝复制（“=”复制）因此如果一个元素改变了，此列都会改变</font>\n\n```python\nclass Solution(object):\n    def movingCount(self, m, n, k):\n        \"\"\"\n        :type m: int\n        :type n: int\n        :type k: int\n        :rtype: int\n        \"\"\"\n        \n        fflag = [[1 for _ in range(n)] for _ in range(m)]  \n        def numsum(i,j):\n            sum=0\n            while(i):\n                sum+=(i%10)\n                i = i//10\n            while(j):\n                sum+=(j%10)\n                j = j//10\n            return sum\n        def dfs(i,j):\n            if (not m>i>=0) or (not n>j>=0) or (fflag[i][j]==0) or (numsum(i,j)>k): \n                return 0\n            fflag[i][j] = 0\n            # return 1+dfs(i+1,j)+dfs(i-1,j)+dfs(i,j+1)+dfs(i,j-1)\n            return 1+dfs(i+1,j)+dfs(i,j+1)\n\n        return dfs(0,0)\n```\n\n### 解法二 递推\n\n#### 思路\n\n考虑到方法一提到搜索的方向只需要朝下或朝右，我们可以得出一种递推的求解方法。\n\n#### 算法\n\n定义 `vis[i][j]` 为 `(i, j)` 坐标是否可达，如果可达返回 1，否则返回 0。\n\n首先 (i, j) 本身需要可以进入，因此需要先判断 i 和 j 的数位之和是否大于 k ，如果大于的话直接设置 `vis[i][j]` 为不可达即可。\n\n否则，前面提到搜索方向只需朝下或朝右，因此 (i, j) 的格子只会从 (i - 1, j) 或者 (i, j - 1) 两个格子走过来（不考虑边界条件），那么 `vis[i][j]` 是否可达的状态则可由如下公式计算得到：\n\n即只要有一个格子可达，那么 (i, j) 这个格子就是可达的，因此我们只要遍历所有格子，递推计算出它们是否可达然后用变量 ans 记录可达的格子数量即可。\n\n初始条件 `vis[i][j] = 1` ，递推计算的过程中注意边界的处理。\n\n```python\ndef digitsum(n):\n    ans = 0\n    while n:\n        ans += n % 10\n        n //= 10\n    return ans\n\nclass Solution:\n    def movingCount(self, m: int, n: int, k: int) -> int:\n        vis = set([(0, 0)])\n        for i in range(m):\n            for j in range(n):\n                if ((i - 1, j) in vis or (i, j - 1) in vis) and digitsum(i) + digitsum(j) <= k:\n                    vis.add((i, j))\n        return len(vis)\n```\n\n### 解法三\n\n#### 思路和算法\n\n我们将行坐标和列坐标数位之和大于 k 的格子看作障碍物，那么这道题就是一道很传统的搜索题目，我们可以使用广度优先搜索或者深度优先搜索来解决它，本文选择使用广度优先搜索的方法来讲解。\n\n那么如何计算一个数的数位之和呢？我们只需要对数 x 每次对 10 取余，就能知道数 x 的个位数是多少，然后再将 x 除 10，这个操作等价于将 x 的十进制数向右移一位，删除个位数（类似于二进制中的 >> 右移运算符），不断重复直到 x 为 0 时结束。\n\n同时这道题还有一个隐藏的优化：我们在搜索的过程中搜索方向可以缩减为向右和向下，而不必再向上和向左进行搜索。如下图，我们展示了 16 * 16 的地图随着限制条件 k 的放大，可行方格的变化趋势，每个格子里的值为行坐标和列坐标的数位之和，蓝色方格代表非障碍方格，即其值小于等于当前的限制条件 k。我们可以发现随着限制条件 k 的增大，(0, 0) 所在的蓝色方格区域内新加入的非障碍方格都可以由上方或左方的格子移动一步得到。而其他不连通的蓝色方格区域会随着 k 的增大而连通，且连通的时候也是由上方或左方的格子移动一步得到，因此我们可以将我们的搜索方向缩减为向右或向下。\n\n```python\ndef digitsum(n):\n    ans = 0\n    while n:\n        ans += n % 10\n        n //= 10\n    return ans\n\nclass Solution:\n    def movingCount(self, m: int, n: int, k: int) -> int:\n        from queue import Queue\n        q = Queue()\n        q.put((0, 0))\n        s = set()\n        while not q.empty():\n            x, y = q.get()\n            if (x, y) not in s and 0 <= x < m and 0 <= y < n and digitsum(x) + digitsum(y) <= k:\n                s.add((x, y))\n                for nx, ny in [(x + 1, y), (x, y + 1)]:\n                    q.put((nx, ny))\n        return len(s)\n```\n\n#### 复杂度分析\n\n##### 时间复杂度：O(mn)\n\n其中 m 为方格的行数，n 为方格的列数。考虑所有格子都能进入，那么搜索的时候一个格子最多会被访问的次数为常数，所以时间复杂度为 O(2mn)=O(mn)。\n\n##### 空间复杂度：O(mn)\n\n其中 m 为方格的行数，n 为方格的列数。搜索的时候需要一个大小为 O(mn)的标记结构用来标记每个格子是否被走过。\n\n","source":"_posts/leetcode/leetcode-offer13.md","raw":"---\ntitle: 剑指offer13 机器人的运动范围\ntags: [剑指,DFS,idea]\ncategories: [剑指,DFS]\ndate: 2021-08-14 17:56:11\n---\n\n>机器人的运动范围\n\n## 题目\n\n地上有一个m行n列的方格，从坐标 [0,0] 到坐标 [m-1,n-1] 。一个机器人从坐标 [0, 0] 的格子开始移动，它每次可以向左、右、上、下移动一格（不能移动到方格外），也不能进入行坐标和列坐标的数位之和大于k的格子。例如，当k为18时，机器人能够进入方格 [35, 37] ，因为3+5+3+7=18。但它不能进入方格 [35, 38]，因为3+5+3+8=19。请问该机器人能够到达多少个格子？\n\n### 示例 1：\n\n```\n输入：m = 2, n = 3, k = 1\n输出：3\n```\n\n### 示例 2：\n\n```\n输入：m = 3, n = 1, k = 0\n输出：1\n```\n\n### 提示：\n\n- `1 <= n,m <= 100`\n- `0 <= k <= 20`\n\n## 题解\n\n### 解法一 DFS\n\n- 深搜+剪枝\n- 优化技巧就是只判断右边和下边就行了，因为左和上是一定会在搜索的过程中被包括的\n\n​        <font color=purple>注意[[1]*n]*m 是浅拷贝复制（“=”复制）因此如果一个元素改变了，此列都会改变</font>\n\n```python\nclass Solution(object):\n    def movingCount(self, m, n, k):\n        \"\"\"\n        :type m: int\n        :type n: int\n        :type k: int\n        :rtype: int\n        \"\"\"\n        \n        fflag = [[1 for _ in range(n)] for _ in range(m)]  \n        def numsum(i,j):\n            sum=0\n            while(i):\n                sum+=(i%10)\n                i = i//10\n            while(j):\n                sum+=(j%10)\n                j = j//10\n            return sum\n        def dfs(i,j):\n            if (not m>i>=0) or (not n>j>=0) or (fflag[i][j]==0) or (numsum(i,j)>k): \n                return 0\n            fflag[i][j] = 0\n            # return 1+dfs(i+1,j)+dfs(i-1,j)+dfs(i,j+1)+dfs(i,j-1)\n            return 1+dfs(i+1,j)+dfs(i,j+1)\n\n        return dfs(0,0)\n```\n\n### 解法二 递推\n\n#### 思路\n\n考虑到方法一提到搜索的方向只需要朝下或朝右，我们可以得出一种递推的求解方法。\n\n#### 算法\n\n定义 `vis[i][j]` 为 `(i, j)` 坐标是否可达，如果可达返回 1，否则返回 0。\n\n首先 (i, j) 本身需要可以进入，因此需要先判断 i 和 j 的数位之和是否大于 k ，如果大于的话直接设置 `vis[i][j]` 为不可达即可。\n\n否则，前面提到搜索方向只需朝下或朝右，因此 (i, j) 的格子只会从 (i - 1, j) 或者 (i, j - 1) 两个格子走过来（不考虑边界条件），那么 `vis[i][j]` 是否可达的状态则可由如下公式计算得到：\n\n即只要有一个格子可达，那么 (i, j) 这个格子就是可达的，因此我们只要遍历所有格子，递推计算出它们是否可达然后用变量 ans 记录可达的格子数量即可。\n\n初始条件 `vis[i][j] = 1` ，递推计算的过程中注意边界的处理。\n\n```python\ndef digitsum(n):\n    ans = 0\n    while n:\n        ans += n % 10\n        n //= 10\n    return ans\n\nclass Solution:\n    def movingCount(self, m: int, n: int, k: int) -> int:\n        vis = set([(0, 0)])\n        for i in range(m):\n            for j in range(n):\n                if ((i - 1, j) in vis or (i, j - 1) in vis) and digitsum(i) + digitsum(j) <= k:\n                    vis.add((i, j))\n        return len(vis)\n```\n\n### 解法三\n\n#### 思路和算法\n\n我们将行坐标和列坐标数位之和大于 k 的格子看作障碍物，那么这道题就是一道很传统的搜索题目，我们可以使用广度优先搜索或者深度优先搜索来解决它，本文选择使用广度优先搜索的方法来讲解。\n\n那么如何计算一个数的数位之和呢？我们只需要对数 x 每次对 10 取余，就能知道数 x 的个位数是多少，然后再将 x 除 10，这个操作等价于将 x 的十进制数向右移一位，删除个位数（类似于二进制中的 >> 右移运算符），不断重复直到 x 为 0 时结束。\n\n同时这道题还有一个隐藏的优化：我们在搜索的过程中搜索方向可以缩减为向右和向下，而不必再向上和向左进行搜索。如下图，我们展示了 16 * 16 的地图随着限制条件 k 的放大，可行方格的变化趋势，每个格子里的值为行坐标和列坐标的数位之和，蓝色方格代表非障碍方格，即其值小于等于当前的限制条件 k。我们可以发现随着限制条件 k 的增大，(0, 0) 所在的蓝色方格区域内新加入的非障碍方格都可以由上方或左方的格子移动一步得到。而其他不连通的蓝色方格区域会随着 k 的增大而连通，且连通的时候也是由上方或左方的格子移动一步得到，因此我们可以将我们的搜索方向缩减为向右或向下。\n\n```python\ndef digitsum(n):\n    ans = 0\n    while n:\n        ans += n % 10\n        n //= 10\n    return ans\n\nclass Solution:\n    def movingCount(self, m: int, n: int, k: int) -> int:\n        from queue import Queue\n        q = Queue()\n        q.put((0, 0))\n        s = set()\n        while not q.empty():\n            x, y = q.get()\n            if (x, y) not in s and 0 <= x < m and 0 <= y < n and digitsum(x) + digitsum(y) <= k:\n                s.add((x, y))\n                for nx, ny in [(x + 1, y), (x, y + 1)]:\n                    q.put((nx, ny))\n        return len(s)\n```\n\n#### 复杂度分析\n\n##### 时间复杂度：O(mn)\n\n其中 m 为方格的行数，n 为方格的列数。考虑所有格子都能进入，那么搜索的时候一个格子最多会被访问的次数为常数，所以时间复杂度为 O(2mn)=O(mn)。\n\n##### 空间复杂度：O(mn)\n\n其中 m 为方格的行数，n 为方格的列数。搜索的时候需要一个大小为 O(mn)的标记结构用来标记每个格子是否被走过。\n\n","slug":"leetcode/leetcode-offer13","published":1,"updated":"2022-01-18T08:10:17.067Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p08u002east9heit0sbb","content":"<blockquote>\n<p>机器人的运动范围</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>地上有一个m行n列的方格，从坐标 [0,0] 到坐标 [m-1,n-1] 。一个机器人从坐标 [0, 0] 的格子开始移动，它每次可以向左、右、上、下移动一格（不能移动到方格外），也不能进入行坐标和列坐标的数位之和大于k的格子。例如，当k为18时，机器人能够进入方格 [35, 37] ，因为3+5+3+7=18。但它不能进入方格 [35, 38]，因为3+5+3+8=19。请问该机器人能够到达多少个格子？</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">m</span> = <span class=\"hljs-number\">2</span>, <span class=\"hljs-attr\">n</span> = <span class=\"hljs-number\">3</span>, <span class=\"hljs-attr\">k</span> = <span class=\"hljs-number\">1</span><br>输出：<span class=\"hljs-number\">3</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">m</span> = <span class=\"hljs-number\">3</span>, <span class=\"hljs-attr\">n</span> = <span class=\"hljs-number\">1</span>, <span class=\"hljs-attr\">k</span> = <span class=\"hljs-number\">0</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>1 &lt;= n,m &lt;= 100</code></li>\n<li><code>0 &lt;= k &lt;= 20</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h3 id=\"解法一-DFS\">解法一 DFS</h3>\n<ul>\n<li>深搜+剪枝</li>\n<li>优化技巧就是只判断右边和下边就行了，因为左和上是一定会在搜索的过程中被包括的</li>\n</ul>\n<p>​        <font color=\"purple\">注意[[1]*n]*m 是浅拷贝复制（“=”复制）因此如果一个元素改变了，此列都会改变</font></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">object</span></span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">movingCount</span>(<span class=\"hljs-params\">self, m, n, k</span>):</span><br>        <span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\">        :type m: int</span><br><span class=\"hljs-string\">        :type n: int</span><br><span class=\"hljs-string\">        :type k: int</span><br><span class=\"hljs-string\">        :rtype: int</span><br><span class=\"hljs-string\">        \"\"\"</span><br>        <br>        fflag = [[<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n)] <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(m)]  <br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">numsum</span>(<span class=\"hljs-params\">i,j</span>):</span><br>            <span class=\"hljs-built_in\">sum</span>=<span class=\"hljs-number\">0</span><br>            <span class=\"hljs-keyword\">while</span>(i):<br>                <span class=\"hljs-built_in\">sum</span>+=(i%<span class=\"hljs-number\">10</span>)<br>                i = i//<span class=\"hljs-number\">10</span><br>            <span class=\"hljs-keyword\">while</span>(j):<br>                <span class=\"hljs-built_in\">sum</span>+=(j%<span class=\"hljs-number\">10</span>)<br>                j = j//<span class=\"hljs-number\">10</span><br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">sum</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">i,j</span>):</span><br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">not</span> m&gt;i&gt;=<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">or</span> (<span class=\"hljs-keyword\">not</span> n&gt;j&gt;=<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">or</span> (fflag[i][j]==<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">or</span> (numsum(i,j)&gt;k): <br>                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br>            fflag[i][j] = <span class=\"hljs-number\">0</span><br>            <span class=\"hljs-comment\"># return 1+dfs(i+1,j)+dfs(i-1,j)+dfs(i,j+1)+dfs(i,j-1)</span><br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span>+dfs(i+<span class=\"hljs-number\">1</span>,j)+dfs(i,j+<span class=\"hljs-number\">1</span>)<br><br>        <span class=\"hljs-keyword\">return</span> dfs(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"解法二-递推\">解法二 递推</h3>\n<h4 id=\"思路\">思路</h4>\n<p>考虑到方法一提到搜索的方向只需要朝下或朝右，我们可以得出一种递推的求解方法。</p>\n<h4 id=\"算法\">算法</h4>\n<p>定义 <code>vis[i][j]</code> 为 <code>(i, j)</code> 坐标是否可达，如果可达返回 1，否则返回 0。</p>\n<p>首先 (i, j) 本身需要可以进入，因此需要先判断 i 和 j 的数位之和是否大于 k ，如果大于的话直接设置 <code>vis[i][j]</code> 为不可达即可。</p>\n<p>否则，前面提到搜索方向只需朝下或朝右，因此 (i, j) 的格子只会从 (i - 1, j) 或者 (i, j - 1) 两个格子走过来（不考虑边界条件），那么 <code>vis[i][j]</code> 是否可达的状态则可由如下公式计算得到：</p>\n<p>即只要有一个格子可达，那么 (i, j) 这个格子就是可达的，因此我们只要遍历所有格子，递推计算出它们是否可达然后用变量 ans 记录可达的格子数量即可。</p>\n<p>初始条件 <code>vis[i][j] = 1</code> ，递推计算的过程中注意边界的处理。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">digitsum</span>(<span class=\"hljs-params\">n</span>):</span><br>    ans = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">while</span> n:<br>        ans += n % <span class=\"hljs-number\">10</span><br>        n //= <span class=\"hljs-number\">10</span><br>    <span class=\"hljs-keyword\">return</span> ans<br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">movingCount</span>(<span class=\"hljs-params\">self, m: <span class=\"hljs-built_in\">int</span>, n: <span class=\"hljs-built_in\">int</span>, k: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        vis = <span class=\"hljs-built_in\">set</span>([(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>)])<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(m):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n):<br>                <span class=\"hljs-keyword\">if</span> ((i - <span class=\"hljs-number\">1</span>, j) <span class=\"hljs-keyword\">in</span> vis <span class=\"hljs-keyword\">or</span> (i, j - <span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">in</span> vis) <span class=\"hljs-keyword\">and</span> digitsum(i) + digitsum(j) &lt;= k:<br>                    vis.add((i, j))<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">len</span>(vis)<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"解法三\">解法三</h3>\n<h4 id=\"思路和算法\">思路和算法</h4>\n<p>我们将行坐标和列坐标数位之和大于 k 的格子看作障碍物，那么这道题就是一道很传统的搜索题目，我们可以使用广度优先搜索或者深度优先搜索来解决它，本文选择使用广度优先搜索的方法来讲解。</p>\n<p>那么如何计算一个数的数位之和呢？我们只需要对数 x 每次对 10 取余，就能知道数 x 的个位数是多少，然后再将 x 除 10，这个操作等价于将 x 的十进制数向右移一位，删除个位数（类似于二进制中的 &gt;&gt; 右移运算符），不断重复直到 x 为 0 时结束。</p>\n<p>同时这道题还有一个隐藏的优化：我们在搜索的过程中搜索方向可以缩减为向右和向下，而不必再向上和向左进行搜索。如下图，我们展示了 16 * 16 的地图随着限制条件 k 的放大，可行方格的变化趋势，每个格子里的值为行坐标和列坐标的数位之和，蓝色方格代表非障碍方格，即其值小于等于当前的限制条件 k。我们可以发现随着限制条件 k 的增大，(0, 0) 所在的蓝色方格区域内新加入的非障碍方格都可以由上方或左方的格子移动一步得到。而其他不连通的蓝色方格区域会随着 k 的增大而连通，且连通的时候也是由上方或左方的格子移动一步得到，因此我们可以将我们的搜索方向缩减为向右或向下。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">digitsum</span>(<span class=\"hljs-params\">n</span>):</span><br>    ans = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">while</span> n:<br>        ans += n % <span class=\"hljs-number\">10</span><br>        n //= <span class=\"hljs-number\">10</span><br>    <span class=\"hljs-keyword\">return</span> ans<br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">movingCount</span>(<span class=\"hljs-params\">self, m: <span class=\"hljs-built_in\">int</span>, n: <span class=\"hljs-built_in\">int</span>, k: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">from</span> queue <span class=\"hljs-keyword\">import</span> Queue<br>        q = Queue()<br>        q.put((<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>))<br>        s = <span class=\"hljs-built_in\">set</span>()<br>        <span class=\"hljs-keyword\">while</span> <span class=\"hljs-keyword\">not</span> q.empty():<br>            x, y = q.get()<br>            <span class=\"hljs-keyword\">if</span> (x, y) <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> s <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">0</span> &lt;= x &lt; m <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">0</span> &lt;= y &lt; n <span class=\"hljs-keyword\">and</span> digitsum(x) + digitsum(y) &lt;= k:<br>                s.add((x, y))<br>                <span class=\"hljs-keyword\">for</span> nx, ny <span class=\"hljs-keyword\">in</span> [(x + <span class=\"hljs-number\">1</span>, y), (x, y + <span class=\"hljs-number\">1</span>)]:<br>                    q.put((nx, ny))<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">len</span>(s)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"复杂度分析\">复杂度分析</h4>\n<h5 id=\"时间复杂度：O-mn\">时间复杂度：O(mn)</h5>\n<p>其中 m 为方格的行数，n 为方格的列数。考虑所有格子都能进入，那么搜索的时候一个格子最多会被访问的次数为常数，所以时间复杂度为 O(2mn)=O(mn)。</p>\n<h5 id=\"空间复杂度：O-mn\">空间复杂度：O(mn)</h5>\n<p>其中 m 为方格的行数，n 为方格的列数。搜索的时候需要一个大小为 O(mn)的标记结构用来标记每个格子是否被走过。</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>机器人的运动范围</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>地上有一个m行n列的方格，从坐标 [0,0] 到坐标 [m-1,n-1] 。一个机器人从坐标 [0, 0] 的格子开始移动，它每次可以向左、右、上、下移动一格（不能移动到方格外），也不能进入行坐标和列坐标的数位之和大于k的格子。例如，当k为18时，机器人能够进入方格 [35, 37] ，因为3+5+3+7=18。但它不能进入方格 [35, 38]，因为3+5+3+8=19。请问该机器人能够到达多少个格子？</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">m</span> = <span class=\"hljs-number\">2</span>, <span class=\"hljs-attr\">n</span> = <span class=\"hljs-number\">3</span>, <span class=\"hljs-attr\">k</span> = <span class=\"hljs-number\">1</span><br>输出：<span class=\"hljs-number\">3</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">m</span> = <span class=\"hljs-number\">3</span>, <span class=\"hljs-attr\">n</span> = <span class=\"hljs-number\">1</span>, <span class=\"hljs-attr\">k</span> = <span class=\"hljs-number\">0</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>1 &lt;= n,m &lt;= 100</code></li>\n<li><code>0 &lt;= k &lt;= 20</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h3 id=\"解法一-DFS\">解法一 DFS</h3>\n<ul>\n<li>深搜+剪枝</li>\n<li>优化技巧就是只判断右边和下边就行了，因为左和上是一定会在搜索的过程中被包括的</li>\n</ul>\n<p>​        <font color=purple>注意[[1]*n]*m 是浅拷贝复制（“=”复制）因此如果一个元素改变了，此列都会改变</font></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">object</span></span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">movingCount</span>(<span class=\"hljs-params\">self, m, n, k</span>):</span><br>        <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">        :type m: int</span><br><span class=\"hljs-string\">        :type n: int</span><br><span class=\"hljs-string\">        :type k: int</span><br><span class=\"hljs-string\">        :rtype: int</span><br><span class=\"hljs-string\">        &quot;&quot;&quot;</span><br>        <br>        fflag = [[<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n)] <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(m)]  <br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">numsum</span>(<span class=\"hljs-params\">i,j</span>):</span><br>            <span class=\"hljs-built_in\">sum</span>=<span class=\"hljs-number\">0</span><br>            <span class=\"hljs-keyword\">while</span>(i):<br>                <span class=\"hljs-built_in\">sum</span>+=(i%<span class=\"hljs-number\">10</span>)<br>                i = i//<span class=\"hljs-number\">10</span><br>            <span class=\"hljs-keyword\">while</span>(j):<br>                <span class=\"hljs-built_in\">sum</span>+=(j%<span class=\"hljs-number\">10</span>)<br>                j = j//<span class=\"hljs-number\">10</span><br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">sum</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">i,j</span>):</span><br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">not</span> m&gt;i&gt;=<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">or</span> (<span class=\"hljs-keyword\">not</span> n&gt;j&gt;=<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">or</span> (fflag[i][j]==<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">or</span> (numsum(i,j)&gt;k): <br>                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br>            fflag[i][j] = <span class=\"hljs-number\">0</span><br>            <span class=\"hljs-comment\"># return 1+dfs(i+1,j)+dfs(i-1,j)+dfs(i,j+1)+dfs(i,j-1)</span><br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span>+dfs(i+<span class=\"hljs-number\">1</span>,j)+dfs(i,j+<span class=\"hljs-number\">1</span>)<br><br>        <span class=\"hljs-keyword\">return</span> dfs(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>)<br></code></pre></td></tr></table></figure>\n<h3 id=\"解法二-递推\">解法二 递推</h3>\n<h4 id=\"思路\">思路</h4>\n<p>考虑到方法一提到搜索的方向只需要朝下或朝右，我们可以得出一种递推的求解方法。</p>\n<h4 id=\"算法\">算法</h4>\n<p>定义 <code>vis[i][j]</code> 为 <code>(i, j)</code> 坐标是否可达，如果可达返回 1，否则返回 0。</p>\n<p>首先 (i, j) 本身需要可以进入，因此需要先判断 i 和 j 的数位之和是否大于 k ，如果大于的话直接设置 <code>vis[i][j]</code> 为不可达即可。</p>\n<p>否则，前面提到搜索方向只需朝下或朝右，因此 (i, j) 的格子只会从 (i - 1, j) 或者 (i, j - 1) 两个格子走过来（不考虑边界条件），那么 <code>vis[i][j]</code> 是否可达的状态则可由如下公式计算得到：</p>\n<p>即只要有一个格子可达，那么 (i, j) 这个格子就是可达的，因此我们只要遍历所有格子，递推计算出它们是否可达然后用变量 ans 记录可达的格子数量即可。</p>\n<p>初始条件 <code>vis[i][j] = 1</code> ，递推计算的过程中注意边界的处理。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">digitsum</span>(<span class=\"hljs-params\">n</span>):</span><br>    ans = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">while</span> n:<br>        ans += n % <span class=\"hljs-number\">10</span><br>        n //= <span class=\"hljs-number\">10</span><br>    <span class=\"hljs-keyword\">return</span> ans<br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">movingCount</span>(<span class=\"hljs-params\">self, m: <span class=\"hljs-built_in\">int</span>, n: <span class=\"hljs-built_in\">int</span>, k: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        vis = <span class=\"hljs-built_in\">set</span>([(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>)])<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(m):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n):<br>                <span class=\"hljs-keyword\">if</span> ((i - <span class=\"hljs-number\">1</span>, j) <span class=\"hljs-keyword\">in</span> vis <span class=\"hljs-keyword\">or</span> (i, j - <span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">in</span> vis) <span class=\"hljs-keyword\">and</span> digitsum(i) + digitsum(j) &lt;= k:<br>                    vis.add((i, j))<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">len</span>(vis)<br></code></pre></td></tr></table></figure>\n<h3 id=\"解法三\">解法三</h3>\n<h4 id=\"思路和算法\">思路和算法</h4>\n<p>我们将行坐标和列坐标数位之和大于 k 的格子看作障碍物，那么这道题就是一道很传统的搜索题目，我们可以使用广度优先搜索或者深度优先搜索来解决它，本文选择使用广度优先搜索的方法来讲解。</p>\n<p>那么如何计算一个数的数位之和呢？我们只需要对数 x 每次对 10 取余，就能知道数 x 的个位数是多少，然后再将 x 除 10，这个操作等价于将 x 的十进制数向右移一位，删除个位数（类似于二进制中的 &gt;&gt; 右移运算符），不断重复直到 x 为 0 时结束。</p>\n<p>同时这道题还有一个隐藏的优化：我们在搜索的过程中搜索方向可以缩减为向右和向下，而不必再向上和向左进行搜索。如下图，我们展示了 16 * 16 的地图随着限制条件 k 的放大，可行方格的变化趋势，每个格子里的值为行坐标和列坐标的数位之和，蓝色方格代表非障碍方格，即其值小于等于当前的限制条件 k。我们可以发现随着限制条件 k 的增大，(0, 0) 所在的蓝色方格区域内新加入的非障碍方格都可以由上方或左方的格子移动一步得到。而其他不连通的蓝色方格区域会随着 k 的增大而连通，且连通的时候也是由上方或左方的格子移动一步得到，因此我们可以将我们的搜索方向缩减为向右或向下。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">digitsum</span>(<span class=\"hljs-params\">n</span>):</span><br>    ans = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">while</span> n:<br>        ans += n % <span class=\"hljs-number\">10</span><br>        n //= <span class=\"hljs-number\">10</span><br>    <span class=\"hljs-keyword\">return</span> ans<br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">movingCount</span>(<span class=\"hljs-params\">self, m: <span class=\"hljs-built_in\">int</span>, n: <span class=\"hljs-built_in\">int</span>, k: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">from</span> queue <span class=\"hljs-keyword\">import</span> Queue<br>        q = Queue()<br>        q.put((<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>))<br>        s = <span class=\"hljs-built_in\">set</span>()<br>        <span class=\"hljs-keyword\">while</span> <span class=\"hljs-keyword\">not</span> q.empty():<br>            x, y = q.get()<br>            <span class=\"hljs-keyword\">if</span> (x, y) <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> s <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">0</span> &lt;= x &lt; m <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">0</span> &lt;= y &lt; n <span class=\"hljs-keyword\">and</span> digitsum(x) + digitsum(y) &lt;= k:<br>                s.add((x, y))<br>                <span class=\"hljs-keyword\">for</span> nx, ny <span class=\"hljs-keyword\">in</span> [(x + <span class=\"hljs-number\">1</span>, y), (x, y + <span class=\"hljs-number\">1</span>)]:<br>                    q.put((nx, ny))<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">len</span>(s)<br></code></pre></td></tr></table></figure>\n<h4 id=\"复杂度分析\">复杂度分析</h4>\n<h5 id=\"时间复杂度：O-mn\">时间复杂度：O(mn)</h5>\n<p>其中 m 为方格的行数，n 为方格的列数。考虑所有格子都能进入，那么搜索的时候一个格子最多会被访问的次数为常数，所以时间复杂度为 O(2mn)=O(mn)。</p>\n<h5 id=\"空间复杂度：O-mn\">空间复杂度：O(mn)</h5>\n<p>其中 m 为方格的行数，n 为方格的列数。搜索的时候需要一个大小为 O(mn)的标记结构用来标记每个格子是否被走过。</p>\n"},{"title":"剑指offer14.1 剪绳子1","date":"2021-08-17T15:46:41.000Z","_content":"\n>剪绳子\n\n## 题目\n\n给你一根长度为 n 的绳子，请把绳子剪成整数长度的 m 段（m、n都是整数，n>1并且m>1），每段绳子的长度记为 k[0],k[1]...k[m-1] 。请问 k[0]*k[1]*...*k[m-1] 可能的最大乘积是多少？例如，当绳子的长度是8时，我们把它剪成长度分别为2、3、3的三段，此时得到的最大乘积是18。\n\n#### 示例 1：\n\n```\n输入: 2\n输出: 1\n解释: 2 = 1 + 1, 1 × 1 = 1\n```\n\n#### 示例 2：\n\n```\n输入: 10\n输出: 36\n解释: 10 = 3 + 3 + 4, 3 × 3 × 4 = 36\n```\n\n##### 提示：\n\n- `2 <= n <= 58`\n\n#### 题解\n\n该题采用动态规划比较好理解，dp[i]表示长度为i的绳子分成m的最大乘积。j表示第一段的长度，遍历j的取值（可以直接从2开始），在剩余的i-j（**缩小范围**）的长度选择不切分或者最大乘积，即dp\\[i][j] = max(j\\*(i-j),j\\*dp[i-j])。**但是实际上“【j】”并不关心**，因此可以与dp[i]比较,选择最大的更新dp[i]即可。\n\n```python\nclass Solution:\n    def cuttingRope(self, n: int) -> int:\n        dp = [1 for _ in range(n+1)]  # 表示长度为n的绳子得到的最大乘积\n        dp[2] = 1\n        for i in range(3,n+1):\n            for j in range(2,i): # 第一段\n                dp[i] = max(dp[i],max(j*(i-j),j*dp[i-j])) \n                #向前获取信息，在选定j之后，注意还要比较dp[i]本身，以及在第一段j的基础上剩下的是否切\n        return dp[n]\n\n```\n\n","source":"_posts/leetcode/leetcode-offer14-1.md","raw":"---\ntitle: 剑指offer14.1 剪绳子1\ntags: [剑指,动态规划,idea]\ncategories: [剑指,动态规划]\ndate: 2021-08-17 23:46:41\n---\n\n>剪绳子\n\n## 题目\n\n给你一根长度为 n 的绳子，请把绳子剪成整数长度的 m 段（m、n都是整数，n>1并且m>1），每段绳子的长度记为 k[0],k[1]...k[m-1] 。请问 k[0]*k[1]*...*k[m-1] 可能的最大乘积是多少？例如，当绳子的长度是8时，我们把它剪成长度分别为2、3、3的三段，此时得到的最大乘积是18。\n\n#### 示例 1：\n\n```\n输入: 2\n输出: 1\n解释: 2 = 1 + 1, 1 × 1 = 1\n```\n\n#### 示例 2：\n\n```\n输入: 10\n输出: 36\n解释: 10 = 3 + 3 + 4, 3 × 3 × 4 = 36\n```\n\n##### 提示：\n\n- `2 <= n <= 58`\n\n#### 题解\n\n该题采用动态规划比较好理解，dp[i]表示长度为i的绳子分成m的最大乘积。j表示第一段的长度，遍历j的取值（可以直接从2开始），在剩余的i-j（**缩小范围**）的长度选择不切分或者最大乘积，即dp\\[i][j] = max(j\\*(i-j),j\\*dp[i-j])。**但是实际上“【j】”并不关心**，因此可以与dp[i]比较,选择最大的更新dp[i]即可。\n\n```python\nclass Solution:\n    def cuttingRope(self, n: int) -> int:\n        dp = [1 for _ in range(n+1)]  # 表示长度为n的绳子得到的最大乘积\n        dp[2] = 1\n        for i in range(3,n+1):\n            for j in range(2,i): # 第一段\n                dp[i] = max(dp[i],max(j*(i-j),j*dp[i-j])) \n                #向前获取信息，在选定j之后，注意还要比较dp[i]本身，以及在第一段j的基础上剩下的是否切\n        return dp[n]\n\n```\n\n","slug":"leetcode/leetcode-offer14-1","published":1,"updated":"2022-01-18T08:10:17.068Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p08w002hast97okbc4sw","content":"<blockquote>\n<p>剪绳子</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给你一根长度为 n 的绳子，请把绳子剪成整数长度的 m 段（m、n都是整数，n&gt;1并且m&gt;1），每段绳子的长度记为 k[0],k[1]…k[m-1] 。请问 k[0]<em>k[1]</em>…*k[m-1] 可能的最大乘积是多少？例如，当绳子的长度是8时，我们把它剪成长度分别为2、3、3的三段，此时得到的最大乘积是18。</p>\n<h4 id=\"示例-1：\">示例 1：</h4>\n<figure class=\"highlight tap\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入: 2<br>输出: 1<br>解释:<span class=\"hljs-number\"> 2 </span>=<span class=\"hljs-number\"> 1 </span>+ 1,<span class=\"hljs-number\"> 1 </span>×<span class=\"hljs-number\"> 1 </span>= 1<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"示例-2：\">示例 2：</h4>\n<figure class=\"highlight tap\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入: 10<br>输出: 36<br>解释:<span class=\"hljs-number\"> 10 </span>=<span class=\"hljs-number\"> 3 </span>+<span class=\"hljs-number\"> 3 </span>+ 4,<span class=\"hljs-number\"> 3 </span>×<span class=\"hljs-number\"> 3 </span>×<span class=\"hljs-number\"> 4 </span>= 36<br></code></pre></td></tr></tbody></table></figure>\n<h5 id=\"提示：\">提示：</h5>\n<ul>\n<li><code>2 &lt;= n &lt;= 58</code></li>\n</ul>\n<h4 id=\"题解\">题解</h4>\n<p>该题采用动态规划比较好理解，dp[i]表示长度为i的绳子分成m的最大乘积。j表示第一段的长度，遍历j的取值（可以直接从2开始），在剩余的i-j（<strong>缩小范围</strong>）的长度选择不切分或者最大乘积，即dp[i][j] = max(j*(i-j),j*dp[i-j])。<strong>但是实际上“【j】”并不关心</strong>，因此可以与dp[i]比较,选择最大的更新dp[i]即可。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">cuttingRope</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        dp = [<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n+<span class=\"hljs-number\">1</span>)]  <span class=\"hljs-comment\"># 表示长度为n的绳子得到的最大乘积</span><br>        dp[<span class=\"hljs-number\">2</span>] = <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">3</span>,n+<span class=\"hljs-number\">1</span>):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">2</span>,i): <span class=\"hljs-comment\"># 第一段</span><br>                dp[i] = <span class=\"hljs-built_in\">max</span>(dp[i],<span class=\"hljs-built_in\">max</span>(j*(i-j),j*dp[i-j])) <br>                <span class=\"hljs-comment\">#向前获取信息，在选定j之后，注意还要比较dp[i]本身，以及在第一段j的基础上剩下的是否切</span><br>        <span class=\"hljs-keyword\">return</span> dp[n]<br><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>剪绳子</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给你一根长度为 n 的绳子，请把绳子剪成整数长度的 m 段（m、n都是整数，n&gt;1并且m&gt;1），每段绳子的长度记为 k[0],k[1]…k[m-1] 。请问 k[0]<em>k[1]</em>…*k[m-1] 可能的最大乘积是多少？例如，当绳子的长度是8时，我们把它剪成长度分别为2、3、3的三段，此时得到的最大乘积是18。</p>\n<h4 id=\"示例-1：\">示例 1：</h4>\n<figure class=\"highlight tap\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入: 2<br>输出: 1<br>解释:<span class=\"hljs-number\"> 2 </span>=<span class=\"hljs-number\"> 1 </span>+ 1,<span class=\"hljs-number\"> 1 </span>×<span class=\"hljs-number\"> 1 </span>= 1<br></code></pre></td></tr></table></figure>\n<h4 id=\"示例-2：\">示例 2：</h4>\n<figure class=\"highlight tap\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入: 10<br>输出: 36<br>解释:<span class=\"hljs-number\"> 10 </span>=<span class=\"hljs-number\"> 3 </span>+<span class=\"hljs-number\"> 3 </span>+ 4,<span class=\"hljs-number\"> 3 </span>×<span class=\"hljs-number\"> 3 </span>×<span class=\"hljs-number\"> 4 </span>= 36<br></code></pre></td></tr></table></figure>\n<h5 id=\"提示：\">提示：</h5>\n<ul>\n<li><code>2 &lt;= n &lt;= 58</code></li>\n</ul>\n<h4 id=\"题解\">题解</h4>\n<p>该题采用动态规划比较好理解，dp[i]表示长度为i的绳子分成m的最大乘积。j表示第一段的长度，遍历j的取值（可以直接从2开始），在剩余的i-j（<strong>缩小范围</strong>）的长度选择不切分或者最大乘积，即dp[i][j] = max(j*(i-j),j*dp[i-j])。<strong>但是实际上“【j】”并不关心</strong>，因此可以与dp[i]比较,选择最大的更新dp[i]即可。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">cuttingRope</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        dp = [<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n+<span class=\"hljs-number\">1</span>)]  <span class=\"hljs-comment\"># 表示长度为n的绳子得到的最大乘积</span><br>        dp[<span class=\"hljs-number\">2</span>] = <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">3</span>,n+<span class=\"hljs-number\">1</span>):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">2</span>,i): <span class=\"hljs-comment\"># 第一段</span><br>                dp[i] = <span class=\"hljs-built_in\">max</span>(dp[i],<span class=\"hljs-built_in\">max</span>(j*(i-j),j*dp[i-j])) <br>                <span class=\"hljs-comment\">#向前获取信息，在选定j之后，注意还要比较dp[i]本身，以及在第一段j的基础上剩下的是否切</span><br>        <span class=\"hljs-keyword\">return</span> dp[n]<br><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer14.2 剪绳子2","date":"2021-08-17T16:20:17.000Z","_content":"\n> 剪绳子2\n\n## 题目\n\n给你一根长度为 n 的绳子，请把绳子剪成整数长度的 m 段（m、n都是整数，n>1并且m>1），每段绳子的长度记为 k[0],k[1]...k[m - 1] .请问 k[0]*k[1]*...*k[m - 1] 可能的最大乘积是多少？例如，当绳子的长度是8时，我们把它剪成长度分别为2、3、3的三段，此时得到的最大乘积是18。\n\n答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。\n\n### 示例 1：\n\n```\n输入: 2\n输出: 1\n解释: 2 = 1 + 1, 1 × 1 = 1\n```\n\n### 示例 2：\n\n```\n输入: 10\n输出: 36\n解释: 10 = 3 + 3 + 4, 3 × 3 × 4 = 36\n```\n\n### 提示：\n\n- `2 <= n <= 1000`\n\n## 题解\n\n使用动态规划具体参照剪绳子1\n\n```python\nclass Solution:\n    def cuttingRope(self, n: int) -> int:\n        dp = [0 for i in range(n+1)]\n        dp[2] = 1\n        for i in range(3,n+1):\n            for j in range(2,i):\n                dp[i] = max(dp[i],max(j*(i-j),j*dp[i-j]))\n        return dp[n]%1000000007\n```\n\n但是这种方式时间复杂度较大。\n\n步骤如下：(数学可以证明尽量分成多的3)[参见题解](https://leetcode-cn.com/problems/jian-sheng-zi-lcof/solution/mian-shi-ti-14-i-jian-sheng-zi-tan-xin-si-xiang-by/)\n\n- 如果 n == 2，返回1，如果 n == 3，返回2，两个可以合并成n小于4的时候返回n - 1\n- 如果 n == 4，返回4\n- 如果 n > 4，分成尽可能多的长度为3的小段，每次循环长度n减去3，乘积res乘以3；最后返回时乘以小于等于4的最后一小段；每次乘法操作后记得取余就行\n以上2和3可以合并\n\n```python\nclass Solution:\n    def cuttingRope(self, n: int) -> int:\n        if n < 4:\n            return n - 1\n        res = 1\n        while n > 4: # 找寻尽量多的3\n            res = res * 3 % 1000000007\n            n -= 3\n        return res * n % 1000000007 #乘以剩余的\n```\n\n","source":"_posts/leetcode/leetcode-offer14-2.md","raw":"---\ntitle: 剑指offer14.2 剪绳子2\ntags: [剑指,动态规划]\ncategories: [剑指,动态规划]\ndate: 2021-08-18 00:20:17\n---\n\n> 剪绳子2\n\n## 题目\n\n给你一根长度为 n 的绳子，请把绳子剪成整数长度的 m 段（m、n都是整数，n>1并且m>1），每段绳子的长度记为 k[0],k[1]...k[m - 1] .请问 k[0]*k[1]*...*k[m - 1] 可能的最大乘积是多少？例如，当绳子的长度是8时，我们把它剪成长度分别为2、3、3的三段，此时得到的最大乘积是18。\n\n答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。\n\n### 示例 1：\n\n```\n输入: 2\n输出: 1\n解释: 2 = 1 + 1, 1 × 1 = 1\n```\n\n### 示例 2：\n\n```\n输入: 10\n输出: 36\n解释: 10 = 3 + 3 + 4, 3 × 3 × 4 = 36\n```\n\n### 提示：\n\n- `2 <= n <= 1000`\n\n## 题解\n\n使用动态规划具体参照剪绳子1\n\n```python\nclass Solution:\n    def cuttingRope(self, n: int) -> int:\n        dp = [0 for i in range(n+1)]\n        dp[2] = 1\n        for i in range(3,n+1):\n            for j in range(2,i):\n                dp[i] = max(dp[i],max(j*(i-j),j*dp[i-j]))\n        return dp[n]%1000000007\n```\n\n但是这种方式时间复杂度较大。\n\n步骤如下：(数学可以证明尽量分成多的3)[参见题解](https://leetcode-cn.com/problems/jian-sheng-zi-lcof/solution/mian-shi-ti-14-i-jian-sheng-zi-tan-xin-si-xiang-by/)\n\n- 如果 n == 2，返回1，如果 n == 3，返回2，两个可以合并成n小于4的时候返回n - 1\n- 如果 n == 4，返回4\n- 如果 n > 4，分成尽可能多的长度为3的小段，每次循环长度n减去3，乘积res乘以3；最后返回时乘以小于等于4的最后一小段；每次乘法操作后记得取余就行\n以上2和3可以合并\n\n```python\nclass Solution:\n    def cuttingRope(self, n: int) -> int:\n        if n < 4:\n            return n - 1\n        res = 1\n        while n > 4: # 找寻尽量多的3\n            res = res * 3 % 1000000007\n            n -= 3\n        return res * n % 1000000007 #乘以剩余的\n```\n\n","slug":"leetcode/leetcode-offer14-2","published":1,"updated":"2022-01-18T08:10:17.068Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p08y002kast9h7b77z2r","content":"<blockquote>\n<p>剪绳子2</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给你一根长度为 n 的绳子，请把绳子剪成整数长度的 m 段（m、n都是整数，n&gt;1并且m&gt;1），每段绳子的长度记为 k[0],k[1]…k[m - 1] .请问 k[0]<em>k[1]</em>…*k[m - 1] 可能的最大乘积是多少？例如，当绳子的长度是8时，我们把它剪成长度分别为2、3、3的三段，此时得到的最大乘积是18。</p>\n<p>答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight tap\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入: 2<br>输出: 1<br>解释:<span class=\"hljs-number\"> 2 </span>=<span class=\"hljs-number\"> 1 </span>+ 1,<span class=\"hljs-number\"> 1 </span>×<span class=\"hljs-number\"> 1 </span>= 1<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight tap\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入: 10<br>输出: 36<br>解释:<span class=\"hljs-number\"> 10 </span>=<span class=\"hljs-number\"> 3 </span>+<span class=\"hljs-number\"> 3 </span>+ 4,<span class=\"hljs-number\"> 3 </span>×<span class=\"hljs-number\"> 3 </span>×<span class=\"hljs-number\"> 4 </span>= 36<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>2 &lt;= n &lt;= 1000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用动态规划具体参照剪绳子1</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">cuttingRope</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        dp = [<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n+<span class=\"hljs-number\">1</span>)]<br>        dp[<span class=\"hljs-number\">2</span>] = <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">3</span>,n+<span class=\"hljs-number\">1</span>):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">2</span>,i):<br>                dp[i] = <span class=\"hljs-built_in\">max</span>(dp[i],<span class=\"hljs-built_in\">max</span>(j*(i-j),j*dp[i-j]))<br>        <span class=\"hljs-keyword\">return</span> dp[n]%<span class=\"hljs-number\">1000000007</span><br></code></pre></td></tr></tbody></table></figure>\n<p>但是这种方式时间复杂度较大。</p>\n<p>步骤如下：(数学可以证明尽量分成多的3)<a href=\"https://leetcode-cn.com/problems/jian-sheng-zi-lcof/solution/mian-shi-ti-14-i-jian-sheng-zi-tan-xin-si-xiang-by/\">参见题解</a></p>\n<ul>\n<li>如果 n == 2，返回1，如果 n == 3，返回2，两个可以合并成n小于4的时候返回n - 1</li>\n<li>如果 n == 4，返回4</li>\n<li>如果 n &gt; 4，分成尽可能多的长度为3的小段，每次循环长度n减去3，乘积res乘以3；最后返回时乘以小于等于4的最后一小段；每次乘法操作后记得取余就行<br>\n以上2和3可以合并</li>\n</ul>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">cuttingRope</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">if</span> n &lt; <span class=\"hljs-number\">4</span>:<br>            <span class=\"hljs-keyword\">return</span> n - <span class=\"hljs-number\">1</span><br>        res = <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">while</span> n &gt; <span class=\"hljs-number\">4</span>: <span class=\"hljs-comment\"># 找寻尽量多的3</span><br>            res = res * <span class=\"hljs-number\">3</span> % <span class=\"hljs-number\">1000000007</span><br>            n -= <span class=\"hljs-number\">3</span><br>        <span class=\"hljs-keyword\">return</span> res * n % <span class=\"hljs-number\">1000000007</span> <span class=\"hljs-comment\">#乘以剩余的</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>剪绳子2</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给你一根长度为 n 的绳子，请把绳子剪成整数长度的 m 段（m、n都是整数，n&gt;1并且m&gt;1），每段绳子的长度记为 k[0],k[1]…k[m - 1] .请问 k[0]<em>k[1]</em>…*k[m - 1] 可能的最大乘积是多少？例如，当绳子的长度是8时，我们把它剪成长度分别为2、3、3的三段，此时得到的最大乘积是18。</p>\n<p>答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight tap\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入: 2<br>输出: 1<br>解释:<span class=\"hljs-number\"> 2 </span>=<span class=\"hljs-number\"> 1 </span>+ 1,<span class=\"hljs-number\"> 1 </span>×<span class=\"hljs-number\"> 1 </span>= 1<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight tap\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入: 10<br>输出: 36<br>解释:<span class=\"hljs-number\"> 10 </span>=<span class=\"hljs-number\"> 3 </span>+<span class=\"hljs-number\"> 3 </span>+ 4,<span class=\"hljs-number\"> 3 </span>×<span class=\"hljs-number\"> 3 </span>×<span class=\"hljs-number\"> 4 </span>= 36<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>2 &lt;= n &lt;= 1000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用动态规划具体参照剪绳子1</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">cuttingRope</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        dp = [<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(n+<span class=\"hljs-number\">1</span>)]<br>        dp[<span class=\"hljs-number\">2</span>] = <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">3</span>,n+<span class=\"hljs-number\">1</span>):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">2</span>,i):<br>                dp[i] = <span class=\"hljs-built_in\">max</span>(dp[i],<span class=\"hljs-built_in\">max</span>(j*(i-j),j*dp[i-j]))<br>        <span class=\"hljs-keyword\">return</span> dp[n]%<span class=\"hljs-number\">1000000007</span><br></code></pre></td></tr></table></figure>\n<p>但是这种方式时间复杂度较大。</p>\n<p>步骤如下：(数学可以证明尽量分成多的3)<a href=\"https://leetcode-cn.com/problems/jian-sheng-zi-lcof/solution/mian-shi-ti-14-i-jian-sheng-zi-tan-xin-si-xiang-by/\">参见题解</a></p>\n<ul>\n<li>如果 n == 2，返回1，如果 n == 3，返回2，两个可以合并成n小于4的时候返回n - 1</li>\n<li>如果 n == 4，返回4</li>\n<li>如果 n &gt; 4，分成尽可能多的长度为3的小段，每次循环长度n减去3，乘积res乘以3；最后返回时乘以小于等于4的最后一小段；每次乘法操作后记得取余就行<br>\n以上2和3可以合并</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">cuttingRope</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">if</span> n &lt; <span class=\"hljs-number\">4</span>:<br>            <span class=\"hljs-keyword\">return</span> n - <span class=\"hljs-number\">1</span><br>        res = <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">while</span> n &gt; <span class=\"hljs-number\">4</span>: <span class=\"hljs-comment\"># 找寻尽量多的3</span><br>            res = res * <span class=\"hljs-number\">3</span> % <span class=\"hljs-number\">1000000007</span><br>            n -= <span class=\"hljs-number\">3</span><br>        <span class=\"hljs-keyword\">return</span> res * n % <span class=\"hljs-number\">1000000007</span> <span class=\"hljs-comment\">#乘以剩余的</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer15 二进制中1的个数","date":"2021-08-19T12:22:04.000Z","_content":"\n> 二进制中1的个数\n\n## 题目\n\n编写一个函数，输入是一个无符号整数（以二进制串的形式），返回其二进制表达式中数字位数为 '1' 的个数（也被称为 汉明重量).）。\n提示：\n- 请注意，在某些语言（如 Java）中，没有无符号整数类型。在这种情况下，输入和输出都将被指定为有符号整数类型，并且不应影响您的实现，因为无论整数是有符号的还是无符号的，其内部的二进制表示形式都是相同的。\n- 在 Java 中，编译器使用 二进制补码 记法来表示有符号整数。因此，在上面的 示例 3 中，输入表示有符号整数 -3。\n\n\n### 示例 1：\n\n```\n输入：n = 11 (控制台输入 00000000000000000000000000001011)\n输出：3\n解释：输入的二进制串 00000000000000000000000000001011 中，共有三位为 '1'。\n```\n\n### 示例 2：\n\n```\n输入：n = 128 (控制台输入 00000000000000000000000010000000)\n输出：1\n解释：输入的二进制串 00000000000000000000000010000000 中，共有一位为 '1'。\n```\n\n### 示例 3：\n\n```\n输入：n = 4294967293 (控制台输入 11111111111111111111111111111101，部分语言中 n = -3）\n输出：31\n解释：输入的二进制串 11111111111111111111111111111101 中，共有 31 位为 '1'。\n```\n### 提示：\n\n- 输入必须是长度为 32 的 二进制串 。\n\n## 题解\n\n第一种方式是采用内置的bin函数，将n转化为二进制格式。然后统计其字符串的1的个数。\n\n```python\nclass Solution:\n    def hammingWeight(self, n: int) -> int:\n        s = str(bin(n))\n        cnt = 0\n        for x in s:\n            if(x=='1'):\n                cnt+=1\n        return cnt\n```\n第二种方法是采用移位操作`<<`和按位与`&`对输入的数字进行统计。如：11 & 8 = 8（1011 & 100 = 100）\n```python\n class Solution:\n \tdef hammingWeight(self, n: int) -> int:\n        cnt = sum(1 for i in range(32) if(n & (1 << i)))\n        return cnt\n```\n\n<font color=hotpink>下面这个就很妙了</font>\n\n第三种方法 利用 `n &（n-1）` \n\n(n−1) 解析： 二进制数字 n 最右边的 1 变成 0 ，此 1 右边的 0 都变成 1。\nn \\& (n - 1) 解析： 二进制数字 n 最右边的 1变成 0，其余不变。\n利用此特性每次循环可以消去一个1\n\n![](https://picture.mulindya.com/leetcode-offer15pic1.png)\n\n```python\nclass Solution:\n    def hammingWeight(self, n: int) -> int:\n        res = 0\n        while n:\n            res += 1\n            n &= n - 1\n        return res\n```\n\n","source":"_posts/leetcode/leetcode-offer15.md","raw":"---\ntitle: 剑指offer15 二进制中1的个数\ntags: [剑指,变量]\ncategories: [剑指,变量]\ndate: 2021-08-19 20:22:04\n---\n\n> 二进制中1的个数\n\n## 题目\n\n编写一个函数，输入是一个无符号整数（以二进制串的形式），返回其二进制表达式中数字位数为 '1' 的个数（也被称为 汉明重量).）。\n提示：\n- 请注意，在某些语言（如 Java）中，没有无符号整数类型。在这种情况下，输入和输出都将被指定为有符号整数类型，并且不应影响您的实现，因为无论整数是有符号的还是无符号的，其内部的二进制表示形式都是相同的。\n- 在 Java 中，编译器使用 二进制补码 记法来表示有符号整数。因此，在上面的 示例 3 中，输入表示有符号整数 -3。\n\n\n### 示例 1：\n\n```\n输入：n = 11 (控制台输入 00000000000000000000000000001011)\n输出：3\n解释：输入的二进制串 00000000000000000000000000001011 中，共有三位为 '1'。\n```\n\n### 示例 2：\n\n```\n输入：n = 128 (控制台输入 00000000000000000000000010000000)\n输出：1\n解释：输入的二进制串 00000000000000000000000010000000 中，共有一位为 '1'。\n```\n\n### 示例 3：\n\n```\n输入：n = 4294967293 (控制台输入 11111111111111111111111111111101，部分语言中 n = -3）\n输出：31\n解释：输入的二进制串 11111111111111111111111111111101 中，共有 31 位为 '1'。\n```\n### 提示：\n\n- 输入必须是长度为 32 的 二进制串 。\n\n## 题解\n\n第一种方式是采用内置的bin函数，将n转化为二进制格式。然后统计其字符串的1的个数。\n\n```python\nclass Solution:\n    def hammingWeight(self, n: int) -> int:\n        s = str(bin(n))\n        cnt = 0\n        for x in s:\n            if(x=='1'):\n                cnt+=1\n        return cnt\n```\n第二种方法是采用移位操作`<<`和按位与`&`对输入的数字进行统计。如：11 & 8 = 8（1011 & 100 = 100）\n```python\n class Solution:\n \tdef hammingWeight(self, n: int) -> int:\n        cnt = sum(1 for i in range(32) if(n & (1 << i)))\n        return cnt\n```\n\n<font color=hotpink>下面这个就很妙了</font>\n\n第三种方法 利用 `n &（n-1）` \n\n(n−1) 解析： 二进制数字 n 最右边的 1 变成 0 ，此 1 右边的 0 都变成 1。\nn \\& (n - 1) 解析： 二进制数字 n 最右边的 1变成 0，其余不变。\n利用此特性每次循环可以消去一个1\n\n![](https://picture.mulindya.com/leetcode-offer15pic1.png)\n\n```python\nclass Solution:\n    def hammingWeight(self, n: int) -> int:\n        res = 0\n        while n:\n            res += 1\n            n &= n - 1\n        return res\n```\n\n","slug":"leetcode/leetcode-offer15","published":1,"updated":"2022-01-18T08:10:17.069Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p090002mast9bx7dccec","content":"<blockquote>\n<p>二进制中1的个数</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>编写一个函数，输入是一个无符号整数（以二进制串的形式），返回其二进制表达式中数字位数为 ‘1’ 的个数（也被称为 汉明重量).）。<br>\n提示：</p>\n<ul>\n<li>请注意，在某些语言（如 Java）中，没有无符号整数类型。在这种情况下，输入和输出都将被指定为有符号整数类型，并且不应影响您的实现，因为无论整数是有符号的还是无符号的，其内部的二进制表示形式都是相同的。</li>\n<li>在 Java 中，编译器使用 二进制补码 记法来表示有符号整数。因此，在上面的&nbsp;示例 3&nbsp;中，输入表示有符号整数 -3。</li>\n</ul>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight 1c\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs 1c\">输入：n = <span class=\"hljs-number\">11</span> (控制台输入 <span class=\"hljs-number\">00000000000000000000000000001011</span>)<br>输出：<span class=\"hljs-number\">3</span><br>解释：输入的二进制串 <span class=\"hljs-number\">00000000000000000000000000001011</span>&nbsp;中，共有三位为 '1'。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight 1c\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs 1c\">输入：n = <span class=\"hljs-number\">128</span> (控制台输入 <span class=\"hljs-number\">00000000000000000000000010000000</span>)<br>输出：<span class=\"hljs-number\">1</span><br>解释：输入的二进制串 <span class=\"hljs-number\">00000000000000000000000010000000</span>&nbsp;中，共有一位为 '1'。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight tap\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入：n =<span class=\"hljs-number\"> 4294967293 </span>(控制台输入 11111111111111111111111111111101，部分语言中 n = -3）<br>输出：31<br>解释：输入的二进制串<span class=\"hljs-number\"> 11111111111111111111111111111101 </span>中，共有<span class=\"hljs-number\"> 31 </span>位为 '1'。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>输入必须是长度为 32 的 二进制串 。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>第一种方式是采用内置的bin函数，将n转化为二进制格式。然后统计其字符串的1的个数。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">hammingWeight</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        s = <span class=\"hljs-built_in\">str</span>(<span class=\"hljs-built_in\">bin</span>(n))<br>        cnt = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> s:<br>            <span class=\"hljs-keyword\">if</span>(x==<span class=\"hljs-string\">'1'</span>):<br>                cnt+=<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> cnt<br></code></pre></td></tr></tbody></table></figure>\n<p>第二种方法是采用移位操作<code>&lt;&lt;</code>和按位与<code>&amp;</code>对输入的数字进行统计。如：11 &amp; 8 = 8（1011 &amp; 100 = 100）</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">hammingWeight</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>       cnt = <span class=\"hljs-built_in\">sum</span>(<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">32</span>) <span class=\"hljs-keyword\">if</span>(n &amp; (<span class=\"hljs-number\">1</span> &lt;&lt; i)))<br>       <span class=\"hljs-keyword\">return</span> cnt<br></code></pre></td></tr></tbody></table></figure>\n<p><font color=\"hotpink\">下面这个就很妙了</font></p>\n<p>第三种方法 利用 <code>n &amp;（n-1）</code></p>\n<p>(n−1) 解析： 二进制数字 n 最右边的 1 变成 0 ，此 1 右边的 0 都变成 1。<br>\nn &amp; (n - 1) 解析： 二进制数字 n 最右边的 1变成 0，其余不变。<br>\n利用此特性每次循环可以消去一个1</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer15pic1.png\" alt=\"\"></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">hammingWeight</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        res = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">while</span> n:<br>            res += <span class=\"hljs-number\">1</span><br>            n &amp;= n - <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> res<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>二进制中1的个数</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>编写一个函数，输入是一个无符号整数（以二进制串的形式），返回其二进制表达式中数字位数为 ‘1’ 的个数（也被称为 汉明重量).）。<br>\n提示：</p>\n<ul>\n<li>请注意，在某些语言（如 Java）中，没有无符号整数类型。在这种情况下，输入和输出都将被指定为有符号整数类型，并且不应影响您的实现，因为无论整数是有符号的还是无符号的，其内部的二进制表示形式都是相同的。</li>\n<li>在 Java 中，编译器使用 二进制补码 记法来表示有符号整数。因此，在上面的 示例 3 中，输入表示有符号整数 -3。</li>\n</ul>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight 1c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs 1c\">输入：n = <span class=\"hljs-number\">11</span> (控制台输入 <span class=\"hljs-number\">00000000000000000000000000001011</span>)<br>输出：<span class=\"hljs-number\">3</span><br>解释：输入的二进制串 <span class=\"hljs-number\">00000000000000000000000000001011</span> 中，共有三位为 &#x27;1&#x27;。<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight 1c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs 1c\">输入：n = <span class=\"hljs-number\">128</span> (控制台输入 <span class=\"hljs-number\">00000000000000000000000010000000</span>)<br>输出：<span class=\"hljs-number\">1</span><br>解释：输入的二进制串 <span class=\"hljs-number\">00000000000000000000000010000000</span> 中，共有一位为 &#x27;1&#x27;。<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight tap\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入：n =<span class=\"hljs-number\"> 4294967293 </span>(控制台输入 11111111111111111111111111111101，部分语言中 n = -3）<br>输出：31<br>解释：输入的二进制串<span class=\"hljs-number\"> 11111111111111111111111111111101 </span>中，共有<span class=\"hljs-number\"> 31 </span>位为 &#x27;1&#x27;。<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>输入必须是长度为 32 的 二进制串 。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>第一种方式是采用内置的bin函数，将n转化为二进制格式。然后统计其字符串的1的个数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">hammingWeight</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        s = <span class=\"hljs-built_in\">str</span>(<span class=\"hljs-built_in\">bin</span>(n))<br>        cnt = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> s:<br>            <span class=\"hljs-keyword\">if</span>(x==<span class=\"hljs-string\">&#x27;1&#x27;</span>):<br>                cnt+=<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> cnt<br></code></pre></td></tr></table></figure>\n<p>第二种方法是采用移位操作<code>&lt;&lt;</code>和按位与<code>&amp;</code>对输入的数字进行统计。如：11 &amp; 8 = 8（1011 &amp; 100 = 100）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">hammingWeight</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>       cnt = <span class=\"hljs-built_in\">sum</span>(<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">32</span>) <span class=\"hljs-keyword\">if</span>(n &amp; (<span class=\"hljs-number\">1</span> &lt;&lt; i)))<br>       <span class=\"hljs-keyword\">return</span> cnt<br></code></pre></td></tr></table></figure>\n<p><font color=hotpink>下面这个就很妙了</font></p>\n<p>第三种方法 利用 <code>n &amp;（n-1）</code></p>\n<p>(n−1) 解析： 二进制数字 n 最右边的 1 变成 0 ，此 1 右边的 0 都变成 1。<br>\nn &amp; (n - 1) 解析： 二进制数字 n 最右边的 1变成 0，其余不变。<br>\n利用此特性每次循环可以消去一个1</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer15pic1.png\" alt=\"\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">hammingWeight</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        res = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">while</span> n:<br>            res += <span class=\"hljs-number\">1</span><br>            n &amp;= n - <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> res<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer16  数值的整数次方","date":"2021-08-21T03:08:18.000Z","math":true,"_content":"\n> 数值的整数次方\n\n## 题目\n\n实现 pow(x, n) ，即计算 x 的 n 次幂函数（即，xn）。不得使用库函数，同时不需要考虑大数问题。\n\n### 示例 1：\n\n```\n输入：x = 2.00000, n = 10\n输出：1024.00000\n```\n\n### 示例 2：\n\n```\n输入：x = 2.10000, n = 3\n输出：9.26100\n```\n\n### 提示：\n\n- -100.0 < x < 100.0\n- $-2^{31}$ <= n <= $2^{31}-1$\n- $-10^4$ <= $x^n$ <= $10^4$\n\n## 题解\n\n一种方法是将x乘以n次，但是这种时间复杂度是O(n)。判题时时间超出限制。\n\n```python\nclass Solution:\n    def myPow(self, x: float, n: int) -> float:\n        if(n==0):return 1\n        result=1\n        if(n<0):\n            n = -n\n            x = 1/x\n        while(n):\n            result *= x\n            n -=1\n        return result\n```\n\n实际上可以利用x *= x 和对n右移操作可以得到$x,x^2,x^4,x^8,x^{16}.....$，而$x^{11}$可以二进制指数表示为$x^{1011}$也就是$x \\times x^2 \\times x^8$。这样原本需要循环11次就只需要循环4次\n\n根据提示条件，循环最多不会超过32次。就很棒！\n\n```python\nclass Solution:\n    def myPow(self, x: float, n: int) -> float:\n        if(n==0):return 1\n        result=1\n        if(n<0):\n            n = -n\n            x = 1/x\n        while(n): #时间复杂度大大降低 不超过32次 O(logn)\n            if(n & 1):result *= x #看最后一位是否为1\n            x *= x\n            n = n>>1 #n右移 1011-》101\n        return result\n```\n\n","source":"_posts/leetcode/leetcode-offer16.md","raw":"---\ntitle: 剑指offer16  数值的整数次方\ntags: [剑指,快速幂,idea]\ncategories: [剑指,快速幂]\ndate: 2021-08-21 11:08:18\nmath: true\n---\n\n> 数值的整数次方\n\n## 题目\n\n实现 pow(x, n) ，即计算 x 的 n 次幂函数（即，xn）。不得使用库函数，同时不需要考虑大数问题。\n\n### 示例 1：\n\n```\n输入：x = 2.00000, n = 10\n输出：1024.00000\n```\n\n### 示例 2：\n\n```\n输入：x = 2.10000, n = 3\n输出：9.26100\n```\n\n### 提示：\n\n- -100.0 < x < 100.0\n- $-2^{31}$ <= n <= $2^{31}-1$\n- $-10^4$ <= $x^n$ <= $10^4$\n\n## 题解\n\n一种方法是将x乘以n次，但是这种时间复杂度是O(n)。判题时时间超出限制。\n\n```python\nclass Solution:\n    def myPow(self, x: float, n: int) -> float:\n        if(n==0):return 1\n        result=1\n        if(n<0):\n            n = -n\n            x = 1/x\n        while(n):\n            result *= x\n            n -=1\n        return result\n```\n\n实际上可以利用x *= x 和对n右移操作可以得到$x,x^2,x^4,x^8,x^{16}.....$，而$x^{11}$可以二进制指数表示为$x^{1011}$也就是$x \\times x^2 \\times x^8$。这样原本需要循环11次就只需要循环4次\n\n根据提示条件，循环最多不会超过32次。就很棒！\n\n```python\nclass Solution:\n    def myPow(self, x: float, n: int) -> float:\n        if(n==0):return 1\n        result=1\n        if(n<0):\n            n = -n\n            x = 1/x\n        while(n): #时间复杂度大大降低 不超过32次 O(logn)\n            if(n & 1):result *= x #看最后一位是否为1\n            x *= x\n            n = n>>1 #n右移 1011-》101\n        return result\n```\n\n","slug":"leetcode/leetcode-offer16","published":1,"updated":"2022-01-18T08:10:17.069Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p092002past9dpuqa6ub","content":"<blockquote>\n<p>数值的整数次方</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>实现 pow(x, n) ，即计算 x 的 n 次幂函数（即，xn）。不得使用库函数，同时不需要考虑大数问题。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight dns\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：x = <span class=\"hljs-number\">2.00000</span>, n = <span class=\"hljs-number\">10</span><br>输出：<span class=\"hljs-number\">1024.00000</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight dns\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：x = <span class=\"hljs-number\">2.10000</span>, n = <span class=\"hljs-number\">3</span><br>输出：<span class=\"hljs-number\">9.26100</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>-100.0 &lt; x &lt; 100.0</li>\n<li>$-2^{31}$ &lt;= n &lt;= $2^{31}-1$</li>\n<li>$-10^4$ &lt;= $x^n$ &lt;= $10^4$</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>一种方法是将x乘以n次，但是这种时间复杂度是O(n)。判题时时间超出限制。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">myPow</span>(<span class=\"hljs-params\">self, x: <span class=\"hljs-built_in\">float</span>, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">float</span>:</span><br>        <span class=\"hljs-keyword\">if</span>(n==<span class=\"hljs-number\">0</span>):<span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span><br>        result=<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">if</span>(n&lt;<span class=\"hljs-number\">0</span>):<br>            n = -n<br>            x = <span class=\"hljs-number\">1</span>/x<br>        <span class=\"hljs-keyword\">while</span>(n):<br>            result *= x<br>            n -=<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></tbody></table></figure>\n<p>实际上可以利用x *= x 和对n右移操作可以得到$x,x<sup>2,x</sup>4,x<sup>8,x</sup>{16}…$，而$x<sup>{11}$可以二进制指数表示为$x</sup>{1011}$也就是$x \\times x^2 \\times x^8$。这样原本需要循环11次就只需要循环4次</p>\n<p>根据提示条件，循环最多不会超过32次。就很棒！</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">myPow</span>(<span class=\"hljs-params\">self, x: <span class=\"hljs-built_in\">float</span>, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">float</span>:</span><br>        <span class=\"hljs-keyword\">if</span>(n==<span class=\"hljs-number\">0</span>):<span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span><br>        result=<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">if</span>(n&lt;<span class=\"hljs-number\">0</span>):<br>            n = -n<br>            x = <span class=\"hljs-number\">1</span>/x<br>        <span class=\"hljs-keyword\">while</span>(n): <span class=\"hljs-comment\">#时间复杂度大大降低 不超过32次 O(logn)</span><br>            <span class=\"hljs-keyword\">if</span>(n &amp; <span class=\"hljs-number\">1</span>):result *= x <span class=\"hljs-comment\">#看最后一位是否为1</span><br>            x *= x<br>            n = n&gt;&gt;<span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#n右移 1011-》101</span><br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>数值的整数次方</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>实现 pow(x, n) ，即计算 x 的 n 次幂函数（即，xn）。不得使用库函数，同时不需要考虑大数问题。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight dns\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：x = <span class=\"hljs-number\">2.00000</span>, n = <span class=\"hljs-number\">10</span><br>输出：<span class=\"hljs-number\">1024.00000</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight dns\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：x = <span class=\"hljs-number\">2.10000</span>, n = <span class=\"hljs-number\">3</span><br>输出：<span class=\"hljs-number\">9.26100</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>-100.0 &lt; x &lt; 100.0</li>\n<li>$-2^{31}$ &lt;= n &lt;= $2^{31}-1$</li>\n<li>$-10^4$ &lt;= $x^n$ &lt;= $10^4$</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>一种方法是将x乘以n次，但是这种时间复杂度是O(n)。判题时时间超出限制。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">myPow</span>(<span class=\"hljs-params\">self, x: <span class=\"hljs-built_in\">float</span>, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">float</span>:</span><br>        <span class=\"hljs-keyword\">if</span>(n==<span class=\"hljs-number\">0</span>):<span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span><br>        result=<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">if</span>(n&lt;<span class=\"hljs-number\">0</span>):<br>            n = -n<br>            x = <span class=\"hljs-number\">1</span>/x<br>        <span class=\"hljs-keyword\">while</span>(n):<br>            result *= x<br>            n -=<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></table></figure>\n<p>实际上可以利用x *= x 和对n右移操作可以得到$x,x<sup>2,x</sup>4,x<sup>8,x</sup>{16}…$，而$x<sup>{11}$可以二进制指数表示为$x</sup>{1011}$也就是$x \\times x^2 \\times x^8$。这样原本需要循环11次就只需要循环4次</p>\n<p>根据提示条件，循环最多不会超过32次。就很棒！</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">myPow</span>(<span class=\"hljs-params\">self, x: <span class=\"hljs-built_in\">float</span>, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">float</span>:</span><br>        <span class=\"hljs-keyword\">if</span>(n==<span class=\"hljs-number\">0</span>):<span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span><br>        result=<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">if</span>(n&lt;<span class=\"hljs-number\">0</span>):<br>            n = -n<br>            x = <span class=\"hljs-number\">1</span>/x<br>        <span class=\"hljs-keyword\">while</span>(n): <span class=\"hljs-comment\">#时间复杂度大大降低 不超过32次 O(logn)</span><br>            <span class=\"hljs-keyword\">if</span>(n &amp; <span class=\"hljs-number\">1</span>):result *= x <span class=\"hljs-comment\">#看最后一位是否为1</span><br>            x *= x<br>            n = n&gt;&gt;<span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#n右移 1011-》101</span><br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer19","date":"2021-08-21T07:28:32.000Z","math":true,"_content":"\n> 正则表达式匹配\n\n## 题目\n\n请实现一个函数用来匹配包含'. '和'*'的正则表达式。模式中的字符'.'表示任意一个字符，而'*'表示它前面的字符可以出现任意次（含0次）。在本题中，匹配是指字符串的所有字符匹配整个模式。例如，字符串\"aaa\"与模式\"a.a\"和\"ab*ac*a\"匹配，但与\"aa.a\"和\"ab*a\"均不匹配。\n\n### 示例 1：\n\n```\n输入:\ns = \"aa\"\np = \"a\"\n输出: false\n解释: \"a\" 无法匹配 \"aa\" 整个字符串。\n```\n\n### 示例 2：\n\n```\n输入:\ns = \"aa\"\np = \"a*\"\n输出: true\n解释: 因为 '*' 代表可以匹配零个或多个前面的那一个元素, 在这里前面的元素就是 'a'。因此，字符串 \"aa\" 可被视为 'a' 重复了一次。\n```\n### 示例 3：\n\n```\n输入:\ns = \"ab\"\np = \".*\"\n输出: true\n解释: \".*\" 表示可匹配零个或多个（'*'）任意字符（'.'）。\n```\n\n### 示例 4：\n\n```\n输入:\ns = \"aab\"\np = \"c*a*b\"\n输出: true\n解释: 因为 '*' 表示零个或多个，这里 'c' 为 0 个, 'a' 被重复一次。因此可以匹配字符串 \"aab\"。\n```\n### 示例 5：\n\n```\n输入:\ns = \"mississippi\"\np = \"mis*is*p*.\"\n输出: false\n```\n\n### 提示：\n\n- `s` 可能为空，且只包含从 `a-z` 的小写字母。\n- `p` 可能为空，且只包含从 `a-z` 的小写字母以及字符 `.` 和 `*`，无连续的 `'*'`。\n\n## 题解\n\n动态规划的核心是建立状态转移方程。dp\\[i][j]表示前j个模式串匹配s的前i个字母的匹配情况。\n\n那么就要分情况讨论了，一种是p[j]是`字母`，第二是` .` ,第三是 `*`.\n\n1. `字母`:直接判断是否一致，如果$p[j]==s[i]$就可以转移 $dp[i][j] = dp[i-1][j-1]$\n\n2. ` .` : 可以匹配任意字符直接转移$dp[i][j] = dp[i-1][j-1]$\n\n3.  `*`：如果前一个字符$p[j-1]==s[i]$，那么这个`*`可以选择是匹配s的**一个元素还是多个元素**\n\n    $dp[i][j] = dp[i][j-2] \\quad or \\quad dp[i-1][j]$\n   \n   如果元素不相等，就直接向前匹配（0次匹配）$dp[i][j-2]$\n   \n   > $dp[i][j-2]$是匹配0个；$dp[i-1][j]$是匹配多个，忽略i元素继续向前查找；$dp[i-1][j-2]$是匹配1个是包含于多个$dp[i-1][j]$中\n\n```python\nclass Solution:\n    def isMatch(self, s: str, p: str) -> bool:\n        s = \" \"+s\n        p = \" \"+p\n        dp = [[False for _ in range(len(p))] for _ in range(len(s))]\n        dp[0][0] = True\n        for i in range(0,len(s)):\n            for j in range(1,len(p)):\n                if(p[j]!='*'):\n                    if((p[j]=='.' and s[i]!=\" \") or p[j]==s[i]):\n                        dp[i][j] = dp[i-1][j-1]\n                else:\n                    if(p[j-1]==s[i] or (p[j-1]=='.' and s[i]!=\" \")): dp[i][j] = dp[i][j-2] or dp[i-1][j-2] or dp[i-1][j] \n                    #dp[i][j] = dp[i][j-2] or dp[i-1][j] #直接0次或者多次\n                    else:dp[i][j] = dp[i][j-2]\n        return dp[len(s)-1][len(p)-1]\n```\n\n","source":"_posts/leetcode/leetcode-offer19.md","raw":"---\ntitle: 剑指offer19 \ntags: [剑指,动态规划]\ncategories: [剑指,动态规划]\ndate: 2021-08-21 15:28:32\nmath: true\n---\n\n> 正则表达式匹配\n\n## 题目\n\n请实现一个函数用来匹配包含'. '和'*'的正则表达式。模式中的字符'.'表示任意一个字符，而'*'表示它前面的字符可以出现任意次（含0次）。在本题中，匹配是指字符串的所有字符匹配整个模式。例如，字符串\"aaa\"与模式\"a.a\"和\"ab*ac*a\"匹配，但与\"aa.a\"和\"ab*a\"均不匹配。\n\n### 示例 1：\n\n```\n输入:\ns = \"aa\"\np = \"a\"\n输出: false\n解释: \"a\" 无法匹配 \"aa\" 整个字符串。\n```\n\n### 示例 2：\n\n```\n输入:\ns = \"aa\"\np = \"a*\"\n输出: true\n解释: 因为 '*' 代表可以匹配零个或多个前面的那一个元素, 在这里前面的元素就是 'a'。因此，字符串 \"aa\" 可被视为 'a' 重复了一次。\n```\n### 示例 3：\n\n```\n输入:\ns = \"ab\"\np = \".*\"\n输出: true\n解释: \".*\" 表示可匹配零个或多个（'*'）任意字符（'.'）。\n```\n\n### 示例 4：\n\n```\n输入:\ns = \"aab\"\np = \"c*a*b\"\n输出: true\n解释: 因为 '*' 表示零个或多个，这里 'c' 为 0 个, 'a' 被重复一次。因此可以匹配字符串 \"aab\"。\n```\n### 示例 5：\n\n```\n输入:\ns = \"mississippi\"\np = \"mis*is*p*.\"\n输出: false\n```\n\n### 提示：\n\n- `s` 可能为空，且只包含从 `a-z` 的小写字母。\n- `p` 可能为空，且只包含从 `a-z` 的小写字母以及字符 `.` 和 `*`，无连续的 `'*'`。\n\n## 题解\n\n动态规划的核心是建立状态转移方程。dp\\[i][j]表示前j个模式串匹配s的前i个字母的匹配情况。\n\n那么就要分情况讨论了，一种是p[j]是`字母`，第二是` .` ,第三是 `*`.\n\n1. `字母`:直接判断是否一致，如果$p[j]==s[i]$就可以转移 $dp[i][j] = dp[i-1][j-1]$\n\n2. ` .` : 可以匹配任意字符直接转移$dp[i][j] = dp[i-1][j-1]$\n\n3.  `*`：如果前一个字符$p[j-1]==s[i]$，那么这个`*`可以选择是匹配s的**一个元素还是多个元素**\n\n    $dp[i][j] = dp[i][j-2] \\quad or \\quad dp[i-1][j]$\n   \n   如果元素不相等，就直接向前匹配（0次匹配）$dp[i][j-2]$\n   \n   > $dp[i][j-2]$是匹配0个；$dp[i-1][j]$是匹配多个，忽略i元素继续向前查找；$dp[i-1][j-2]$是匹配1个是包含于多个$dp[i-1][j]$中\n\n```python\nclass Solution:\n    def isMatch(self, s: str, p: str) -> bool:\n        s = \" \"+s\n        p = \" \"+p\n        dp = [[False for _ in range(len(p))] for _ in range(len(s))]\n        dp[0][0] = True\n        for i in range(0,len(s)):\n            for j in range(1,len(p)):\n                if(p[j]!='*'):\n                    if((p[j]=='.' and s[i]!=\" \") or p[j]==s[i]):\n                        dp[i][j] = dp[i-1][j-1]\n                else:\n                    if(p[j-1]==s[i] or (p[j-1]=='.' and s[i]!=\" \")): dp[i][j] = dp[i][j-2] or dp[i-1][j-2] or dp[i-1][j] \n                    #dp[i][j] = dp[i][j-2] or dp[i-1][j] #直接0次或者多次\n                    else:dp[i][j] = dp[i][j-2]\n        return dp[len(s)-1][len(p)-1]\n```\n\n","slug":"leetcode/leetcode-offer19","published":1,"updated":"2022-01-18T08:10:17.075Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p095002sast91nsmhf6l","content":"<blockquote>\n<p>正则表达式匹配</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现一个函数用来匹配包含’. ‘和’<em>‘的正则表达式。模式中的字符’.‘表示任意一个字符，而’</em>'表示它前面的字符可以出现任意次（含0次）。在本题中，匹配是指字符串的所有字符匹配整个模式。例如，字符串\"aaa\"与模式\"a.a\"和\"ab<em>ac</em>a\"匹配，但与\"aa.a\"和\"ab*a\"均不匹配。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight makefile\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入:</span><br>s = <span class=\"hljs-string\">\"aa\"</span><br>p = <span class=\"hljs-string\">\"a\"</span><br><span class=\"hljs-section\">输出: false</span><br><span class=\"hljs-section\">解释: \"a\" 无法匹配 \"aa\" 整个字符串。</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight smalltalk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs smalltalk\">输入:<br>s = <span class=\"hljs-comment\">\"aa\"</span><br>p = <span class=\"hljs-comment\">\"a*\"</span><br>输出: <span class=\"hljs-keyword\">true</span><br>解释:&nbsp;因为 <span class=\"hljs-string\">'*'</span> 代表可以匹配零个或多个前面的那一个元素, 在这里前面的元素就是 <span class=\"hljs-string\">'a'</span>。因此，字符串 <span class=\"hljs-comment\">\"aa\"</span> 可被视为 <span class=\"hljs-string\">'a'</span> 重复了一次。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight makefile\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入:</span><br>s = <span class=\"hljs-string\">\"ab\"</span><br>p = <span class=\"hljs-string\">\".*\"</span><br><span class=\"hljs-section\">输出: true</span><br><span class=\"hljs-section\">解释: \".*\" 表示可匹配零个或多个（'*'）任意字符（'.'）。</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight smalltalk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs smalltalk\">输入:<br>s = <span class=\"hljs-comment\">\"aab\"</span><br>p = <span class=\"hljs-comment\">\"c*a*b\"</span><br>输出: <span class=\"hljs-keyword\">true</span><br>解释:&nbsp;因为 <span class=\"hljs-string\">'*'</span> 表示零个或多个，这里 <span class=\"hljs-string\">'c'</span> 为 <span class=\"hljs-number\">0</span> 个, <span class=\"hljs-string\">'a'</span> 被重复一次。因此可以匹配字符串 <span class=\"hljs-comment\">\"aab\"</span>。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-5：\">示例 5：</h3>\n<figure class=\"highlight makefile\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入:</span><br>s = <span class=\"hljs-string\">\"mississippi\"</span><br>p = <span class=\"hljs-string\">\"mis*is*p*.\"</span><br><span class=\"hljs-section\">输出: false</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>s</code> 可能为空，且只包含从 <code>a-z</code> 的小写字母。</li>\n<li><code>p</code> 可能为空，且只包含从 <code>a-z</code> 的小写字母以及字符 <code>.</code> 和 <code>*</code>，无连续的 <code>'*'</code>。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>动态规划的核心是建立状态转移方程。dp[i][j]表示前j个模式串匹配s的前i个字母的匹配情况。</p>\n<p>那么就要分情况讨论了，一种是p[j]是<code>字母</code>，第二是<code> .</code> ,第三是 <code>*</code>.</p>\n<ol>\n<li>\n<p><code>字母</code>:直接判断是否一致，如果$p[j]==s[i]$就可以转移 $dp[i][j] = dp[i-1][j-1]$</p>\n</li>\n<li>\n<p><code> .</code> : 可以匹配任意字符直接转移$dp[i][j] = dp[i-1][j-1]$</p>\n</li>\n<li>\n<p><code>*</code>：如果前一个字符$p[j-1]==s[i]$，那么这个<code>*</code>可以选择是匹配s的<strong>一个元素还是多个元素</strong></p>\n<p>$dp[i][j] = dp[i][j-2] \\quad or \\quad dp[i-1][j]$</p>\n</li>\n</ol>\n<p>如果元素不相等，就直接向前匹配（0次匹配）$dp[i][j-2]$</p>\n<blockquote>\n<p>$dp[i][j-2]$是匹配0个；$dp[i-1][j]$是匹配多个，忽略i元素继续向前查找；$dp[i-1][j-2]$是匹配1个是包含于多个$dp[i-1][j]$中</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isMatch</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span>, p: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        s = <span class=\"hljs-string\">\" \"</span>+s<br>        p = <span class=\"hljs-string\">\" \"</span>+p<br>        dp = [[<span class=\"hljs-literal\">False</span> <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(p))] <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(s))]<br>        dp[<span class=\"hljs-number\">0</span>][<span class=\"hljs-number\">0</span>] = <span class=\"hljs-literal\">True</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">len</span>(s)):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-built_in\">len</span>(p)):<br>                <span class=\"hljs-keyword\">if</span>(p[j]!=<span class=\"hljs-string\">'*'</span>):<br>                    <span class=\"hljs-keyword\">if</span>((p[j]==<span class=\"hljs-string\">'.'</span> <span class=\"hljs-keyword\">and</span> s[i]!=<span class=\"hljs-string\">\" \"</span>) <span class=\"hljs-keyword\">or</span> p[j]==s[i]):<br>                        dp[i][j] = dp[i-<span class=\"hljs-number\">1</span>][j-<span class=\"hljs-number\">1</span>]<br>                <span class=\"hljs-keyword\">else</span>:<br>                    <span class=\"hljs-keyword\">if</span>(p[j-<span class=\"hljs-number\">1</span>]==s[i] <span class=\"hljs-keyword\">or</span> (p[j-<span class=\"hljs-number\">1</span>]==<span class=\"hljs-string\">'.'</span> <span class=\"hljs-keyword\">and</span> s[i]!=<span class=\"hljs-string\">\" \"</span>)): dp[i][j] = dp[i][j-<span class=\"hljs-number\">2</span>] <span class=\"hljs-keyword\">or</span> dp[i-<span class=\"hljs-number\">1</span>][j-<span class=\"hljs-number\">2</span>] <span class=\"hljs-keyword\">or</span> dp[i-<span class=\"hljs-number\">1</span>][j] <br>                    <span class=\"hljs-comment\">#dp[i][j] = dp[i][j-2] or dp[i-1][j] #直接0次或者多次</span><br>                    <span class=\"hljs-keyword\">else</span>:dp[i][j] = dp[i][j-<span class=\"hljs-number\">2</span>]<br>        <span class=\"hljs-keyword\">return</span> dp[<span class=\"hljs-built_in\">len</span>(s)-<span class=\"hljs-number\">1</span>][<span class=\"hljs-built_in\">len</span>(p)-<span class=\"hljs-number\">1</span>]<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>正则表达式匹配</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现一个函数用来匹配包含’. ‘和’<em>‘的正则表达式。模式中的字符’.‘表示任意一个字符，而’</em>'表示它前面的字符可以出现任意次（含0次）。在本题中，匹配是指字符串的所有字符匹配整个模式。例如，字符串&quot;aaa&quot;与模式&quot;a.a&quot;和&quot;ab<em>ac</em>a&quot;匹配，但与&quot;aa.a&quot;和&quot;ab*a&quot;均不匹配。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入:</span><br>s = <span class=\"hljs-string\">&quot;aa&quot;</span><br>p = <span class=\"hljs-string\">&quot;a&quot;</span><br><span class=\"hljs-section\">输出: false</span><br><span class=\"hljs-section\">解释: &quot;a&quot; 无法匹配 &quot;aa&quot; 整个字符串。</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight smalltalk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs smalltalk\">输入:<br>s = <span class=\"hljs-comment\">&quot;aa&quot;</span><br>p = <span class=\"hljs-comment\">&quot;a*&quot;</span><br>输出: <span class=\"hljs-keyword\">true</span><br>解释: 因为 <span class=\"hljs-string\">&#x27;*&#x27;</span> 代表可以匹配零个或多个前面的那一个元素, 在这里前面的元素就是 <span class=\"hljs-string\">&#x27;a&#x27;</span>。因此，字符串 <span class=\"hljs-comment\">&quot;aa&quot;</span> 可被视为 <span class=\"hljs-string\">&#x27;a&#x27;</span> 重复了一次。<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入:</span><br>s = <span class=\"hljs-string\">&quot;ab&quot;</span><br>p = <span class=\"hljs-string\">&quot;.*&quot;</span><br><span class=\"hljs-section\">输出: true</span><br><span class=\"hljs-section\">解释: &quot;.*&quot; 表示可匹配零个或多个（&#x27;*&#x27;）任意字符（&#x27;.&#x27;）。</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight smalltalk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs smalltalk\">输入:<br>s = <span class=\"hljs-comment\">&quot;aab&quot;</span><br>p = <span class=\"hljs-comment\">&quot;c*a*b&quot;</span><br>输出: <span class=\"hljs-keyword\">true</span><br>解释: 因为 <span class=\"hljs-string\">&#x27;*&#x27;</span> 表示零个或多个，这里 <span class=\"hljs-string\">&#x27;c&#x27;</span> 为 <span class=\"hljs-number\">0</span> 个, <span class=\"hljs-string\">&#x27;a&#x27;</span> 被重复一次。因此可以匹配字符串 <span class=\"hljs-comment\">&quot;aab&quot;</span>。<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-5：\">示例 5：</h3>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入:</span><br>s = <span class=\"hljs-string\">&quot;mississippi&quot;</span><br>p = <span class=\"hljs-string\">&quot;mis*is*p*.&quot;</span><br><span class=\"hljs-section\">输出: false</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>s</code> 可能为空，且只包含从 <code>a-z</code> 的小写字母。</li>\n<li><code>p</code> 可能为空，且只包含从 <code>a-z</code> 的小写字母以及字符 <code>.</code> 和 <code>*</code>，无连续的 <code>'*'</code>。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>动态规划的核心是建立状态转移方程。dp[i][j]表示前j个模式串匹配s的前i个字母的匹配情况。</p>\n<p>那么就要分情况讨论了，一种是p[j]是<code>字母</code>，第二是<code> .</code> ,第三是 <code>*</code>.</p>\n<ol>\n<li>\n<p><code>字母</code>:直接判断是否一致，如果$p[j]==s[i]$就可以转移 $dp[i][j] = dp[i-1][j-1]$</p>\n</li>\n<li>\n<p><code> .</code> : 可以匹配任意字符直接转移$dp[i][j] = dp[i-1][j-1]$</p>\n</li>\n<li>\n<p><code>*</code>：如果前一个字符$p[j-1]==s[i]$，那么这个<code>*</code>可以选择是匹配s的<strong>一个元素还是多个元素</strong></p>\n<p>$dp[i][j] = dp[i][j-2] \\quad or \\quad dp[i-1][j]$</p>\n</li>\n</ol>\n<p>如果元素不相等，就直接向前匹配（0次匹配）$dp[i][j-2]$</p>\n<blockquote>\n<p>$dp[i][j-2]$是匹配0个；$dp[i-1][j]$是匹配多个，忽略i元素继续向前查找；$dp[i-1][j-2]$是匹配1个是包含于多个$dp[i-1][j]$中</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isMatch</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span>, p: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        s = <span class=\"hljs-string\">&quot; &quot;</span>+s<br>        p = <span class=\"hljs-string\">&quot; &quot;</span>+p<br>        dp = [[<span class=\"hljs-literal\">False</span> <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(p))] <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(s))]<br>        dp[<span class=\"hljs-number\">0</span>][<span class=\"hljs-number\">0</span>] = <span class=\"hljs-literal\">True</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">len</span>(s)):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-built_in\">len</span>(p)):<br>                <span class=\"hljs-keyword\">if</span>(p[j]!=<span class=\"hljs-string\">&#x27;*&#x27;</span>):<br>                    <span class=\"hljs-keyword\">if</span>((p[j]==<span class=\"hljs-string\">&#x27;.&#x27;</span> <span class=\"hljs-keyword\">and</span> s[i]!=<span class=\"hljs-string\">&quot; &quot;</span>) <span class=\"hljs-keyword\">or</span> p[j]==s[i]):<br>                        dp[i][j] = dp[i-<span class=\"hljs-number\">1</span>][j-<span class=\"hljs-number\">1</span>]<br>                <span class=\"hljs-keyword\">else</span>:<br>                    <span class=\"hljs-keyword\">if</span>(p[j-<span class=\"hljs-number\">1</span>]==s[i] <span class=\"hljs-keyword\">or</span> (p[j-<span class=\"hljs-number\">1</span>]==<span class=\"hljs-string\">&#x27;.&#x27;</span> <span class=\"hljs-keyword\">and</span> s[i]!=<span class=\"hljs-string\">&quot; &quot;</span>)): dp[i][j] = dp[i][j-<span class=\"hljs-number\">2</span>] <span class=\"hljs-keyword\">or</span> dp[i-<span class=\"hljs-number\">1</span>][j-<span class=\"hljs-number\">2</span>] <span class=\"hljs-keyword\">or</span> dp[i-<span class=\"hljs-number\">1</span>][j] <br>                    <span class=\"hljs-comment\">#dp[i][j] = dp[i][j-2] or dp[i-1][j] #直接0次或者多次</span><br>                    <span class=\"hljs-keyword\">else</span>:dp[i][j] = dp[i][j-<span class=\"hljs-number\">2</span>]<br>        <span class=\"hljs-keyword\">return</span> dp[<span class=\"hljs-built_in\">len</span>(s)-<span class=\"hljs-number\">1</span>][<span class=\"hljs-built_in\">len</span>(p)-<span class=\"hljs-number\">1</span>]<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer17 打印从1到最大的n位数","date":"2021-08-20T09:11:58.000Z","_content":"\n> 打印从1到最大的n位数\n\n## 题目\n\n输入数字 n，按顺序打印出从 1 到最大的 n 位十进制数。比如输入 3，则打印出 1、2、3 一直到最大的 3 位数 999。\n\n### 示例 1：\n\n```\n输入: n = 1\n输出: [1,2,3,4,5,6,7,8,9]\n```\n\n### 提示：\n\n- 用返回一个整数列表来代替打印\n- n 为正整数\n\n## 题解\n\n借用python的类型转换的包容性，直接可以返回列表\n\n```python\nclass Solution:\n    def printNumbers(self, n: int) -> List[int]:\n        return [i for i in range(1,pow(10,n))] #或者10**n\n```\n实际上，考点是大数越界情况下的打印。\n解决思路，用字符串的全排列来解决数字的越界情况。基于分治算法的思想，先固定高位，向低位递归，当个位已被固定时，添加数字的字符串。例如当 n = 2时（数字范围 1 - 99 ），固定十位为 0- 9 ，按顺序依次开启递归，固定个位 0 - 9 ，终止递归并添加数字字符串。\n\n```python\nclass Solution:\n    def printNumbers(self, n: int) -> [int]:\n        def dfs(x):\n            if x == n:\n                s = ''.join(num[self.start:])\n                if s != '0': res.append(int(s))\n                if n - self.start == self.nine: self.start -= 1\n                return\n            for i in range(10):\n                if i == 9: self.nine += 1\n                num[x] = str(i)\n                dfs(x + 1)\n            self.nine -= 1\n        \n        num, res = ['0'] * n, []\n        self.nine = 0\n        self.start = n - 1\n        dfs(0)\n        return res\n```\n\n- 字符串左边界定义： 声明变量 start 规定字符串的左边界，以保证添加的数字字符串 num[start:] 中无高位多余的 0 。例如当 n = 2 时, 1 - 9时 start = 1， 10 - 99 时 start = 0。\n- 左边界 start 变化规律： 观察可知，当输出数字的所有位都是 9 时，则下个数字需要向更高位进 11 ，此时左边界 start 需要减11 （即高位多余的 0 减少一个）。例如当 n = 3（数字范围 1 - 999 ）时，左边界 start 需要减 1 的情况有： \"009\" 进位至 \"010\" ， \"099\" 进位至 \"100\" 。设数字各位中 9 的数量为 nine ，所有位都为 9 的判断条件可用以下公式表示：n - start = nine统计 nine 的方法： 固定第 x 位时，当 i = 9则执行 nine = nine + 1 ，并在回溯前恢复 nine = nine - 1\n\n","source":"_posts/leetcode/leetcode-offer17.md","raw":"---\ntitle: 剑指offer17 打印从1到最大的n位数\ntags: [剑指,大数]\ncategories: [剑指,大数]\ndate: 2021-08-20 17:11:58\n---\n\n> 打印从1到最大的n位数\n\n## 题目\n\n输入数字 n，按顺序打印出从 1 到最大的 n 位十进制数。比如输入 3，则打印出 1、2、3 一直到最大的 3 位数 999。\n\n### 示例 1：\n\n```\n输入: n = 1\n输出: [1,2,3,4,5,6,7,8,9]\n```\n\n### 提示：\n\n- 用返回一个整数列表来代替打印\n- n 为正整数\n\n## 题解\n\n借用python的类型转换的包容性，直接可以返回列表\n\n```python\nclass Solution:\n    def printNumbers(self, n: int) -> List[int]:\n        return [i for i in range(1,pow(10,n))] #或者10**n\n```\n实际上，考点是大数越界情况下的打印。\n解决思路，用字符串的全排列来解决数字的越界情况。基于分治算法的思想，先固定高位，向低位递归，当个位已被固定时，添加数字的字符串。例如当 n = 2时（数字范围 1 - 99 ），固定十位为 0- 9 ，按顺序依次开启递归，固定个位 0 - 9 ，终止递归并添加数字字符串。\n\n```python\nclass Solution:\n    def printNumbers(self, n: int) -> [int]:\n        def dfs(x):\n            if x == n:\n                s = ''.join(num[self.start:])\n                if s != '0': res.append(int(s))\n                if n - self.start == self.nine: self.start -= 1\n                return\n            for i in range(10):\n                if i == 9: self.nine += 1\n                num[x] = str(i)\n                dfs(x + 1)\n            self.nine -= 1\n        \n        num, res = ['0'] * n, []\n        self.nine = 0\n        self.start = n - 1\n        dfs(0)\n        return res\n```\n\n- 字符串左边界定义： 声明变量 start 规定字符串的左边界，以保证添加的数字字符串 num[start:] 中无高位多余的 0 。例如当 n = 2 时, 1 - 9时 start = 1， 10 - 99 时 start = 0。\n- 左边界 start 变化规律： 观察可知，当输出数字的所有位都是 9 时，则下个数字需要向更高位进 11 ，此时左边界 start 需要减11 （即高位多余的 0 减少一个）。例如当 n = 3（数字范围 1 - 999 ）时，左边界 start 需要减 1 的情况有： \"009\" 进位至 \"010\" ， \"099\" 进位至 \"100\" 。设数字各位中 9 的数量为 nine ，所有位都为 9 的判断条件可用以下公式表示：n - start = nine统计 nine 的方法： 固定第 x 位时，当 i = 9则执行 nine = nine + 1 ，并在回溯前恢复 nine = nine - 1\n\n","slug":"leetcode/leetcode-offer17","published":1,"updated":"2022-01-18T08:10:17.070Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p097002wast9ejr11lmx","content":"<blockquote>\n<p>打印从1到最大的n位数</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入数字 n，按顺序打印出从 1 到最大的 n 位十进制数。比如输入 3，则打印出 1、2、3 一直到最大的 3 位数 999。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight dns\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入: n = <span class=\"hljs-number\">1</span><br>输出: [<span class=\"hljs-number\">1,2,3,4</span>,<span class=\"hljs-number\">5,6,7,8</span>,<span class=\"hljs-number\">9</span>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>用返回一个整数列表来代替打印</li>\n<li>n 为正整数</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>借用python的类型转换的包容性，直接可以返回列表</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">printNumbers</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-keyword\">return</span> [i <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-built_in\">pow</span>(<span class=\"hljs-number\">10</span>,n))] <span class=\"hljs-comment\">#或者10**n</span><br></code></pre></td></tr></tbody></table></figure>\n<p>实际上，考点是大数越界情况下的打印。<br>\n解决思路，用字符串的全排列来解决数字的越界情况。基于分治算法的思想，先固定高位，向低位递归，当个位已被固定时，添加数字的字符串。例如当 n = 2时（数字范围 1 - 99 ），固定十位为 0- 9 ，按顺序依次开启递归，固定个位 0 - 9 ，终止递归并添加数字字符串。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">printNumbers</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; [<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">x</span>):</span><br>            <span class=\"hljs-keyword\">if</span> x == n:<br>                s = <span class=\"hljs-string\">''</span>.join(num[self.start:])<br>                <span class=\"hljs-keyword\">if</span> s != <span class=\"hljs-string\">'0'</span>: res.append(<span class=\"hljs-built_in\">int</span>(s))<br>                <span class=\"hljs-keyword\">if</span> n - self.start == self.nine: self.start -= <span class=\"hljs-number\">1</span><br>                <span class=\"hljs-keyword\">return</span><br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">10</span>):<br>                <span class=\"hljs-keyword\">if</span> i == <span class=\"hljs-number\">9</span>: self.nine += <span class=\"hljs-number\">1</span><br>                num[x] = <span class=\"hljs-built_in\">str</span>(i)<br>                dfs(x + <span class=\"hljs-number\">1</span>)<br>            self.nine -= <span class=\"hljs-number\">1</span><br>        <br>        num, res = [<span class=\"hljs-string\">'0'</span>] * n, []<br>        self.nine = <span class=\"hljs-number\">0</span><br>        self.start = n - <span class=\"hljs-number\">1</span><br>        dfs(<span class=\"hljs-number\">0</span>)<br>        <span class=\"hljs-keyword\">return</span> res<br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>字符串左边界定义： 声明变量 start 规定字符串的左边界，以保证添加的数字字符串 num[start:] 中无高位多余的 0 。例如当 n = 2 时, 1 - 9时 start = 1， 10 - 99 时 start = 0。</li>\n<li>左边界 start 变化规律： 观察可知，当输出数字的所有位都是 9 时，则下个数字需要向更高位进 11 ，此时左边界 start 需要减11 （即高位多余的 0 减少一个）。例如当 n = 3（数字范围 1 - 999 ）时，左边界 start 需要减 1 的情况有： “009” 进位至 “010” ， “099” 进位至 “100” 。设数字各位中 9 的数量为 nine ，所有位都为 9 的判断条件可用以下公式表示：n - start = nine统计 nine 的方法： 固定第 x 位时，当 i = 9则执行 nine = nine + 1 ，并在回溯前恢复 nine = nine - 1</li>\n</ul>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>打印从1到最大的n位数</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入数字 n，按顺序打印出从 1 到最大的 n 位十进制数。比如输入 3，则打印出 1、2、3 一直到最大的 3 位数 999。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight dns\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入: n = <span class=\"hljs-number\">1</span><br>输出: [<span class=\"hljs-number\">1,2,3,4</span>,<span class=\"hljs-number\">5,6,7,8</span>,<span class=\"hljs-number\">9</span>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>用返回一个整数列表来代替打印</li>\n<li>n 为正整数</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>借用python的类型转换的包容性，直接可以返回列表</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">printNumbers</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-keyword\">return</span> [i <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-built_in\">pow</span>(<span class=\"hljs-number\">10</span>,n))] <span class=\"hljs-comment\">#或者10**n</span><br></code></pre></td></tr></table></figure>\n<p>实际上，考点是大数越界情况下的打印。<br>\n解决思路，用字符串的全排列来解决数字的越界情况。基于分治算法的思想，先固定高位，向低位递归，当个位已被固定时，添加数字的字符串。例如当 n = 2时（数字范围 1 - 99 ），固定十位为 0- 9 ，按顺序依次开启递归，固定个位 0 - 9 ，终止递归并添加数字字符串。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">printNumbers</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; [<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">x</span>):</span><br>            <span class=\"hljs-keyword\">if</span> x == n:<br>                s = <span class=\"hljs-string\">&#x27;&#x27;</span>.join(num[self.start:])<br>                <span class=\"hljs-keyword\">if</span> s != <span class=\"hljs-string\">&#x27;0&#x27;</span>: res.append(<span class=\"hljs-built_in\">int</span>(s))<br>                <span class=\"hljs-keyword\">if</span> n - self.start == self.nine: self.start -= <span class=\"hljs-number\">1</span><br>                <span class=\"hljs-keyword\">return</span><br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">10</span>):<br>                <span class=\"hljs-keyword\">if</span> i == <span class=\"hljs-number\">9</span>: self.nine += <span class=\"hljs-number\">1</span><br>                num[x] = <span class=\"hljs-built_in\">str</span>(i)<br>                dfs(x + <span class=\"hljs-number\">1</span>)<br>            self.nine -= <span class=\"hljs-number\">1</span><br>        <br>        num, res = [<span class=\"hljs-string\">&#x27;0&#x27;</span>] * n, []<br>        self.nine = <span class=\"hljs-number\">0</span><br>        self.start = n - <span class=\"hljs-number\">1</span><br>        dfs(<span class=\"hljs-number\">0</span>)<br>        <span class=\"hljs-keyword\">return</span> res<br></code></pre></td></tr></table></figure>\n<ul>\n<li>字符串左边界定义： 声明变量 start 规定字符串的左边界，以保证添加的数字字符串 num[start:] 中无高位多余的 0 。例如当 n = 2 时, 1 - 9时 start = 1， 10 - 99 时 start = 0。</li>\n<li>左边界 start 变化规律： 观察可知，当输出数字的所有位都是 9 时，则下个数字需要向更高位进 11 ，此时左边界 start 需要减11 （即高位多余的 0 减少一个）。例如当 n = 3（数字范围 1 - 999 ）时，左边界 start 需要减 1 的情况有： “009” 进位至 “010” ， “099” 进位至 “100” 。设数字各位中 9 的数量为 nine ，所有位都为 9 的判断条件可用以下公式表示：n - start = nine统计 nine 的方法： 固定第 x 位时，当 i = 9则执行 nine = nine + 1 ，并在回溯前恢复 nine = nine - 1</li>\n</ul>\n"},{"title":"剑指offer18 删除链表的节点","date":"2021-08-21T06:15:05.000Z","_content":"\n> 删除链表的节点\n\n## 题目\n\n给定单向链表的头指针和一个要删除的节点的值，定义一个函数删除该节点。返回删除后的链表的头节点。\n注意：此题对比原题有改动\n\n### 示例 1：\n\n```\n输入: head = [4,5,1,9], val = 5\n输出: [4,1,9]\n解释: 给定你链表中值为 5 的第二个节点，那么在调用了你的函数之后，该链表应变为 4 -> 1 -> 9.\n```\n\n### 示例 2：\n\n```\n输入: head = [4,5,1,9], val = 1\n输出: [4,5,9]\n解释: 给定你链表中值为 1 的第三个节点，那么在调用了你的函数之后，该链表应变为 4 -> 5 -> 9.\n```\n\n### 提示：\n\n- 题目保证链表中节点的值互不相同\n- 若使用 C 或 C++ 语言，你不需要 free 或 delete 被删除的节点\n\n## 题解\n\n常规操作\n\n```python\n# Definition for singly-linked list.\n# class ListNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.next = None\nclass Solution:\n    def deleteNode(self, head: ListNode, val: int) -> ListNode:\n        p = head\n        if(head.val==val):return p.next\n        while(p.next):\n            if(p.next.val == val):\n                p.next = p.next.next\n                return head\n            p = p.next\n```\n\n","source":"_posts/leetcode/leetcode-offer18.md","raw":"---\ntitle: 剑指offer18 删除链表的节点\ntags: [剑指,链表]\ncategories:  [剑指,链表]\ndate: 2021-08-21 14:15:05\n---\n\n> 删除链表的节点\n\n## 题目\n\n给定单向链表的头指针和一个要删除的节点的值，定义一个函数删除该节点。返回删除后的链表的头节点。\n注意：此题对比原题有改动\n\n### 示例 1：\n\n```\n输入: head = [4,5,1,9], val = 5\n输出: [4,1,9]\n解释: 给定你链表中值为 5 的第二个节点，那么在调用了你的函数之后，该链表应变为 4 -> 1 -> 9.\n```\n\n### 示例 2：\n\n```\n输入: head = [4,5,1,9], val = 1\n输出: [4,5,9]\n解释: 给定你链表中值为 1 的第三个节点，那么在调用了你的函数之后，该链表应变为 4 -> 5 -> 9.\n```\n\n### 提示：\n\n- 题目保证链表中节点的值互不相同\n- 若使用 C 或 C++ 语言，你不需要 free 或 delete 被删除的节点\n\n## 题解\n\n常规操作\n\n```python\n# Definition for singly-linked list.\n# class ListNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.next = None\nclass Solution:\n    def deleteNode(self, head: ListNode, val: int) -> ListNode:\n        p = head\n        if(head.val==val):return p.next\n        while(p.next):\n            if(p.next.val == val):\n                p.next = p.next.next\n                return head\n            p = p.next\n```\n\n","slug":"leetcode/leetcode-offer18","published":1,"updated":"2022-01-18T08:10:17.071Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p098002yast97x437raz","content":"<blockquote>\n<p>删除链表的节点</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给定单向链表的头指针和一个要删除的节点的值，定义一个函数删除该节点。返回删除后的链表的头节点。<br>\n注意：此题对比原题有改动</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight makefile\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: head = [4,5,1,9], val = 5</span><br><span class=\"hljs-section\">输出: [4,1,9]</span><br><span class=\"hljs-section\">解释: 给定你链表中值为&nbsp;5&nbsp;的第二个节点，那么在调用了你的函数之后，该链表应变为 4 -&gt; 1 -&gt; 9.</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight makefile\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: head = [4,5,1,9], val = 1</span><br><span class=\"hljs-section\">输出: [4,5,9]</span><br><span class=\"hljs-section\">解释: 给定你链表中值为&nbsp;1&nbsp;的第三个节点，那么在调用了你的函数之后，该链表应变为 4 -&gt; 5 -&gt; 9.</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>题目保证链表中节点的值互不相同</li>\n<li>若使用 C 或 C++ 语言，你不需要 free 或 delete 被删除的节点</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>常规操作</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for singly-linked list.</span><br><span class=\"hljs-comment\"># class ListNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.next = None</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">deleteNode</span>(<span class=\"hljs-params\">self, head: ListNode, val: <span class=\"hljs-built_in\">int</span></span>) -&gt; ListNode:</span><br>        p = head<br>        <span class=\"hljs-keyword\">if</span>(head.val==val):<span class=\"hljs-keyword\">return</span> p.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-keyword\">while</span>(p.<span class=\"hljs-built_in\">next</span>):<br>            <span class=\"hljs-keyword\">if</span>(p.<span class=\"hljs-built_in\">next</span>.val == val):<br>                p.<span class=\"hljs-built_in\">next</span> = p.<span class=\"hljs-built_in\">next</span>.<span class=\"hljs-built_in\">next</span><br>                <span class=\"hljs-keyword\">return</span> head<br>            p = p.<span class=\"hljs-built_in\">next</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>删除链表的节点</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给定单向链表的头指针和一个要删除的节点的值，定义一个函数删除该节点。返回删除后的链表的头节点。<br>\n注意：此题对比原题有改动</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: head = [4,5,1,9], val = 5</span><br><span class=\"hljs-section\">输出: [4,1,9]</span><br><span class=\"hljs-section\">解释: 给定你链表中值为 5 的第二个节点，那么在调用了你的函数之后，该链表应变为 4 -&gt; 1 -&gt; 9.</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: head = [4,5,1,9], val = 1</span><br><span class=\"hljs-section\">输出: [4,5,9]</span><br><span class=\"hljs-section\">解释: 给定你链表中值为 1 的第三个节点，那么在调用了你的函数之后，该链表应变为 4 -&gt; 5 -&gt; 9.</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>题目保证链表中节点的值互不相同</li>\n<li>若使用 C 或 C++ 语言，你不需要 free 或 delete 被删除的节点</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>常规操作</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for singly-linked list.</span><br><span class=\"hljs-comment\"># class ListNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.next = None</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">deleteNode</span>(<span class=\"hljs-params\">self, head: ListNode, val: <span class=\"hljs-built_in\">int</span></span>) -&gt; ListNode:</span><br>        p = head<br>        <span class=\"hljs-keyword\">if</span>(head.val==val):<span class=\"hljs-keyword\">return</span> p.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-keyword\">while</span>(p.<span class=\"hljs-built_in\">next</span>):<br>            <span class=\"hljs-keyword\">if</span>(p.<span class=\"hljs-built_in\">next</span>.val == val):<br>                p.<span class=\"hljs-built_in\">next</span> = p.<span class=\"hljs-built_in\">next</span>.<span class=\"hljs-built_in\">next</span><br>                <span class=\"hljs-keyword\">return</span> head<br>            p = p.<span class=\"hljs-built_in\">next</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer2_085 生成匹配的括号","date":"2021-12-09T07:46:53.000Z","_content":"\n> 生成匹配的括号\n\n## 题目\n\n正整数 `n` 代表生成括号的对数，请设计一个函数，用于能够生成所有可能的并且 **有效的** 括号组合。\n\n### 示例 1：\n\n```\n输入：n = 3\n输出：[\"((()))\",\"(()())\",\"(())()\",\"()(())\",\"()()()\"]\n```\n\n### 示例 2：\n\n```\n输入：n = 1\n输出：[\"()\"]\n```\n\n### 提示：\n\n- 1 <= n <= 8\n\n## 题解\n\n巧妙的深度优先算法，记录生成当前的字符串，左括号，右括号的数目；\n如果左括号个数不超，就增加左括号，如果可以增加右括号（**现有的右括号小于左括号数目**），那么增加右括号。\n\n```python\nclass Solution:\n    def generateParenthesis(self, n: int) -> List[str]:\n        def dfs(s,left,right):\n            if(len(s)==2*n):\n                result.append(s)\n            if(left<n):dfs(s+\"(\",left+1,right) #如果left数组少于n个就增加左括号\n            if(left>right):dfs(s+\")\",left,right+1) #如果可以匹配左括号，可以增加右括号区匹配\n        result = []\n        dfs(\"\",0,0)\n        return result\n```\n\n","source":"_posts/leetcode/leetcode-offer2-085.md","raw":"---\ntitle: 剑指offer2_085 生成匹配的括号\ntags: [剑指,树,idea]\ncategories: [剑指,树]\ndate: 2021-12-09 15:46:53\n---\n\n> 生成匹配的括号\n\n## 题目\n\n正整数 `n` 代表生成括号的对数，请设计一个函数，用于能够生成所有可能的并且 **有效的** 括号组合。\n\n### 示例 1：\n\n```\n输入：n = 3\n输出：[\"((()))\",\"(()())\",\"(())()\",\"()(())\",\"()()()\"]\n```\n\n### 示例 2：\n\n```\n输入：n = 1\n输出：[\"()\"]\n```\n\n### 提示：\n\n- 1 <= n <= 8\n\n## 题解\n\n巧妙的深度优先算法，记录生成当前的字符串，左括号，右括号的数目；\n如果左括号个数不超，就增加左括号，如果可以增加右括号（**现有的右括号小于左括号数目**），那么增加右括号。\n\n```python\nclass Solution:\n    def generateParenthesis(self, n: int) -> List[str]:\n        def dfs(s,left,right):\n            if(len(s)==2*n):\n                result.append(s)\n            if(left<n):dfs(s+\"(\",left+1,right) #如果left数组少于n个就增加左括号\n            if(left>right):dfs(s+\")\",left,right+1) #如果可以匹配左括号，可以增加右括号区匹配\n        result = []\n        dfs(\"\",0,0)\n        return result\n```\n\n","slug":"leetcode/leetcode-offer2-085","published":1,"updated":"2022-01-18T08:10:17.075Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09a0030ast9aig0cpen","content":"<blockquote>\n<p>生成匹配的括号</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>正整数 <code>n</code> 代表生成括号的对数，请设计一个函数，用于能够生成所有可能的并且 <strong>有效的</strong> 括号组合。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight excel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">3</span><br>输出：[<span class=\"hljs-string\">\"((()))\"</span>,<span class=\"hljs-string\">\"(()())\"</span>,<span class=\"hljs-string\">\"(())()\"</span>,<span class=\"hljs-string\">\"()(())\"</span>,<span class=\"hljs-string\">\"()()()\"</span>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight excel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">1</span><br>输出：[<span class=\"hljs-string\">\"()\"</span>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= n &lt;= 8</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>巧妙的深度优先算法，记录生成当前的字符串，左括号，右括号的数目；<br>\n如果左括号个数不超，就增加左括号，如果可以增加右括号（<strong>现有的右括号小于左括号数目</strong>），那么增加右括号。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">generateParenthesis</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">str</span>]:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">s,left,right</span>):</span><br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(s)==<span class=\"hljs-number\">2</span>*n):<br>                result.append(s)<br>            <span class=\"hljs-keyword\">if</span>(left&lt;n):dfs(s+<span class=\"hljs-string\">\"(\"</span>,left+<span class=\"hljs-number\">1</span>,right) <span class=\"hljs-comment\">#如果left数组少于n个就增加左括号</span><br>            <span class=\"hljs-keyword\">if</span>(left&gt;right):dfs(s+<span class=\"hljs-string\">\")\"</span>,left,right+<span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">#如果可以匹配左括号，可以增加右括号区匹配</span><br>        result = []<br>        dfs(<span class=\"hljs-string\">\"\"</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>)<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>生成匹配的括号</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>正整数 <code>n</code> 代表生成括号的对数，请设计一个函数，用于能够生成所有可能的并且 <strong>有效的</strong> 括号组合。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">3</span><br>输出：[<span class=\"hljs-string\">&quot;((()))&quot;</span>,<span class=\"hljs-string\">&quot;(()())&quot;</span>,<span class=\"hljs-string\">&quot;(())()&quot;</span>,<span class=\"hljs-string\">&quot;()(())&quot;</span>,<span class=\"hljs-string\">&quot;()()()&quot;</span>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs excel\">输入：<span class=\"hljs-built_in\">n</span> = <span class=\"hljs-number\">1</span><br>输出：[<span class=\"hljs-string\">&quot;()&quot;</span>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= n &lt;= 8</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>巧妙的深度优先算法，记录生成当前的字符串，左括号，右括号的数目；<br>\n如果左括号个数不超，就增加左括号，如果可以增加右括号（<strong>现有的右括号小于左括号数目</strong>），那么增加右括号。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">generateParenthesis</span>(<span class=\"hljs-params\">self, n: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">str</span>]:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">s,left,right</span>):</span><br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(s)==<span class=\"hljs-number\">2</span>*n):<br>                result.append(s)<br>            <span class=\"hljs-keyword\">if</span>(left&lt;n):dfs(s+<span class=\"hljs-string\">&quot;(&quot;</span>,left+<span class=\"hljs-number\">1</span>,right) <span class=\"hljs-comment\">#如果left数组少于n个就增加左括号</span><br>            <span class=\"hljs-keyword\">if</span>(left&gt;right):dfs(s+<span class=\"hljs-string\">&quot;)&quot;</span>,left,right+<span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">#如果可以匹配左括号，可以增加右括号区匹配</span><br>        result = []<br>        dfs(<span class=\"hljs-string\">&quot;&quot;</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>)<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer20 表示数值的字符串","date":"2021-08-19T01:30:05.000Z","math":true,"_content":"\n> 表示数值的字符串\n\n## 题目\n请实现一个函数用来判断字符串是否表示数值（包括整数和小数）。\n\n**数值**（按顺序）可以分成以下几个部分：\n\n1. 若干空格\n2. 一个 小数 或者 整数\n3. （可选）一个 'e' 或 'E' ，后面跟着一个 整数\n4. 若干空格\n\n**小数**（按顺序）可以分成以下几个部分：\n\n1. （可选）一个符号字符（'+' 或 '-'）\n\n2. 下述格式之一：\n\n   1. 至少一位数字，后面跟着一个点 '.'\n   2. 至少一位数字，后面跟着一个点 '.' ，后面再跟着至少一位数字\n   3. 一个点 '.' ，后面跟着至少一位数字\n\n**整数**（按顺序）可以分成以下几个部分：\n\n1. （可选）一个符号字符（'+' 或 '-'）\n2. 至少一位数字\n\n部分**数值**列举如下：\n- [\"+100\", \"5e2\", \"-123\", \"3.1416\", \"-1E-16\", \"0123\"]\n\n部分非数值列举如下：\n- [\"12e\", \"1a3.14\", \"1.2.3\", \"+-5\", \"12e+5.4\"]\n\n### 示例 1：\n\n```\n输入：s = \"0\"\n输出：true\n\n```\n\n### 示例 2：\n\n```\n输入：s = \"e\"\n输出：false\n\n```\n### 示例 3：\n\n```\n输入：s = \".\"\n输出：false\n```\n### 示例 4：\n\n```\n输入：s = \"    .1  \"\n输出：true\n```\n\n### 提示：\n\n- 1 <= s.length <= 20\n- s 仅含英文字母（大写和小写），数字（0-9），加号 '+' ，减号 '-' ，空格 ' ' 或者点 '.' 。\n\n## 题解\n\n### 解题思路\n\n本题解决方案是有限状态自动机。根据字符类型和合法数值的特点，定义状态，再画出状态转移图。\n\n#### 字符类型\n\n空格:' '，数字:d，正负号:s，小数点:'.'，幂符号：e\n\n#### 状态定义\n\n从左到右可以定义为\n\n   0.左边的`空格`\n\n1. E之前的`正负号`\n2. 小数点前的`数字`\n3. 小数点，小数点之后的`数字`\n4. 小数点前为空格，`小数点`，小数点后为数字\n5. `幂符号`\n6. 幂符号之后的`正负号`\n7. 幂符号之后的`数字`\n8. 结尾的`空格`\n\n![](https://picture.mulindya.com/leetcode-offer20-pic1.png)\n\n#### 结束状态\n\n正常的结束状态有2，3，7，8\n\n### 算法流程\n\n#### 初始化\n\n##### 1，状态转移表status\n\n$states[i]$表示所处的状态，$i$为所处的状态表示，$states[i]$使用哈希表存储从i状态到可转移的状态；使用键值对来表示$(key,value)$：若输入$key$，可从状态$i$转移至状态$value$.\n\n当前状态p：初始状态为0\n\n##### 2，转移循环\n\n还需要**记录字符类型**t，遍历字符串的每个字符c\n\n- 当 c 为正负号时，执行 t = 's' ;\n- 当 c 为数字时，执行 t = 'd' ;\n- 当 c 为 e , E 时，执行 t = 'e' ;\n- 当 c 为 . , 空格 时，执行 t = c （即用字符本身表示字符类型）;\n- 否则，执行 t = '?' ，代表为不属于判断范围的非法字符，后续直接返回 false。\n\n**终止条件**： 若字符类型 t不在哈希表  $states[p]$ 中，说明无法转移至下一状态，因此直接返回 False 。\n**状态转移**： 状态 p 转移至 $states[p][t]$。\n\n```python\nclass Solution:\n    def isNumber(self, s: str) -> bool:\n        states = [\n            { ' ': 0, 's': 1, 'd': 2, '.': 4 }, # 0. start with 'blank'\n            { 'd': 2, '.': 4 } ,                # 1. 'sign' before 'e'\n            { 'd': 2, '.': 3, 'e': 5, ' ': 8 }, # 2. 'digit' before 'dot'\n            { 'd': 3, 'e': 5, ' ': 8 },         # 3. 'digit' after 'dot'\n            { 'd': 3 },                         # 4. 'digit' after 'dot' (‘blank’ before 'dot')\n            { 's': 6, 'd': 7 },                 # 5. 'e'\n            { 'd': 7 },                         # 6. 'sign' after 'e'\n            { 'd': 7, ' ': 8 },                 # 7. 'digit' after 'e'\n            { ' ': 8 }                          # 8. end with 'blank'\n        ]\n        p = 0                           # start with state 0\n        for c in s:\n            if '0' <= c <= '9': t = 'd' # digit\n            elif c in \"+-\": t = 's'     # sign\n            elif c in \"eE\": t = 'e'     # e or E\n            elif c in \". \": t = c       # dot, blank\n            else: t = '?'               # unknown\n            if t not in states[p]: return False\n            p = states[p][t]\n        return p in (2, 3, 7, 8)\n\n```\n\n","source":"_posts/leetcode/leetcode-offer20.md","raw":"---\ntitle: 剑指offer20 表示数值的字符串\ntags: [剑指,有限状态机,idea]\ncategories: [剑指,有限状态机]\ndate: 2021-08-19 09:30:05\nmath: true\n---\n\n> 表示数值的字符串\n\n## 题目\n请实现一个函数用来判断字符串是否表示数值（包括整数和小数）。\n\n**数值**（按顺序）可以分成以下几个部分：\n\n1. 若干空格\n2. 一个 小数 或者 整数\n3. （可选）一个 'e' 或 'E' ，后面跟着一个 整数\n4. 若干空格\n\n**小数**（按顺序）可以分成以下几个部分：\n\n1. （可选）一个符号字符（'+' 或 '-'）\n\n2. 下述格式之一：\n\n   1. 至少一位数字，后面跟着一个点 '.'\n   2. 至少一位数字，后面跟着一个点 '.' ，后面再跟着至少一位数字\n   3. 一个点 '.' ，后面跟着至少一位数字\n\n**整数**（按顺序）可以分成以下几个部分：\n\n1. （可选）一个符号字符（'+' 或 '-'）\n2. 至少一位数字\n\n部分**数值**列举如下：\n- [\"+100\", \"5e2\", \"-123\", \"3.1416\", \"-1E-16\", \"0123\"]\n\n部分非数值列举如下：\n- [\"12e\", \"1a3.14\", \"1.2.3\", \"+-5\", \"12e+5.4\"]\n\n### 示例 1：\n\n```\n输入：s = \"0\"\n输出：true\n\n```\n\n### 示例 2：\n\n```\n输入：s = \"e\"\n输出：false\n\n```\n### 示例 3：\n\n```\n输入：s = \".\"\n输出：false\n```\n### 示例 4：\n\n```\n输入：s = \"    .1  \"\n输出：true\n```\n\n### 提示：\n\n- 1 <= s.length <= 20\n- s 仅含英文字母（大写和小写），数字（0-9），加号 '+' ，减号 '-' ，空格 ' ' 或者点 '.' 。\n\n## 题解\n\n### 解题思路\n\n本题解决方案是有限状态自动机。根据字符类型和合法数值的特点，定义状态，再画出状态转移图。\n\n#### 字符类型\n\n空格:' '，数字:d，正负号:s，小数点:'.'，幂符号：e\n\n#### 状态定义\n\n从左到右可以定义为\n\n   0.左边的`空格`\n\n1. E之前的`正负号`\n2. 小数点前的`数字`\n3. 小数点，小数点之后的`数字`\n4. 小数点前为空格，`小数点`，小数点后为数字\n5. `幂符号`\n6. 幂符号之后的`正负号`\n7. 幂符号之后的`数字`\n8. 结尾的`空格`\n\n![](https://picture.mulindya.com/leetcode-offer20-pic1.png)\n\n#### 结束状态\n\n正常的结束状态有2，3，7，8\n\n### 算法流程\n\n#### 初始化\n\n##### 1，状态转移表status\n\n$states[i]$表示所处的状态，$i$为所处的状态表示，$states[i]$使用哈希表存储从i状态到可转移的状态；使用键值对来表示$(key,value)$：若输入$key$，可从状态$i$转移至状态$value$.\n\n当前状态p：初始状态为0\n\n##### 2，转移循环\n\n还需要**记录字符类型**t，遍历字符串的每个字符c\n\n- 当 c 为正负号时，执行 t = 's' ;\n- 当 c 为数字时，执行 t = 'd' ;\n- 当 c 为 e , E 时，执行 t = 'e' ;\n- 当 c 为 . , 空格 时，执行 t = c （即用字符本身表示字符类型）;\n- 否则，执行 t = '?' ，代表为不属于判断范围的非法字符，后续直接返回 false。\n\n**终止条件**： 若字符类型 t不在哈希表  $states[p]$ 中，说明无法转移至下一状态，因此直接返回 False 。\n**状态转移**： 状态 p 转移至 $states[p][t]$。\n\n```python\nclass Solution:\n    def isNumber(self, s: str) -> bool:\n        states = [\n            { ' ': 0, 's': 1, 'd': 2, '.': 4 }, # 0. start with 'blank'\n            { 'd': 2, '.': 4 } ,                # 1. 'sign' before 'e'\n            { 'd': 2, '.': 3, 'e': 5, ' ': 8 }, # 2. 'digit' before 'dot'\n            { 'd': 3, 'e': 5, ' ': 8 },         # 3. 'digit' after 'dot'\n            { 'd': 3 },                         # 4. 'digit' after 'dot' (‘blank’ before 'dot')\n            { 's': 6, 'd': 7 },                 # 5. 'e'\n            { 'd': 7 },                         # 6. 'sign' after 'e'\n            { 'd': 7, ' ': 8 },                 # 7. 'digit' after 'e'\n            { ' ': 8 }                          # 8. end with 'blank'\n        ]\n        p = 0                           # start with state 0\n        for c in s:\n            if '0' <= c <= '9': t = 'd' # digit\n            elif c in \"+-\": t = 's'     # sign\n            elif c in \"eE\": t = 'e'     # e or E\n            elif c in \". \": t = c       # dot, blank\n            else: t = '?'               # unknown\n            if t not in states[p]: return False\n            p = states[p][t]\n        return p in (2, 3, 7, 8)\n\n```\n\n","slug":"leetcode/leetcode-offer20","published":1,"updated":"2022-01-18T08:10:17.076Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09c0032ast9gwx0emj4","content":"<blockquote>\n<p>表示数值的字符串</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现一个函数用来判断字符串是否表示数值（包括整数和小数）。</p>\n<p><strong>数值</strong>（按顺序）可以分成以下几个部分：</p>\n<ol>\n<li>若干空格</li>\n<li>一个&nbsp;小数&nbsp;或者&nbsp;整数</li>\n<li>（可选）一个&nbsp;‘e’&nbsp;或&nbsp;‘E’&nbsp;，后面跟着一个&nbsp;整数</li>\n<li>若干空格</li>\n</ol>\n<p><strong>小数</strong>（按顺序）可以分成以下几个部分：</p>\n<ol>\n<li>\n<p>（可选）一个符号字符（‘+’ 或 ‘-’）</p>\n</li>\n<li>\n<p>下述格式之一：</p>\n<ol>\n<li>至少一位数字，后面跟着一个点 ‘.’</li>\n<li>至少一位数字，后面跟着一个点 ‘.’ ，后面再跟着至少一位数字</li>\n<li>一个点 ‘.’ ，后面跟着至少一位数字</li>\n</ol>\n</li>\n</ol>\n<p><strong>整数</strong>（按顺序）可以分成以下几个部分：</p>\n<ol>\n<li>（可选）一个符号字符（‘+’ 或 ‘-’）</li>\n<li>至少一位数字</li>\n</ol>\n<p>部分<strong>数值</strong>列举如下：</p>\n<ul>\n<li>[“+100”, “5e2”, “-123”, “3.1416”, “-1E-16”, “0123”]</li>\n</ul>\n<p>部分非数值列举如下：</p>\n<ul>\n<li>[“12e”, “1a3.14”, “1.2.3”, “±5”, “12e+5.4”]</li>\n</ul>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">\"0\"</span><br>输出：<span class=\"hljs-literal\">true</span><br><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">\"e\"</span><br>输出：<span class=\"hljs-literal\">false</span><br><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">\".\"</span><br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">\"    .1  \"</span><br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= s.length &lt;= 20</li>\n<li>s 仅含英文字母（大写和小写），数字（0-9），加号 ‘+’ ，减号 ‘-’ ，空格 ’ ’ 或者点 ‘.’ 。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h3 id=\"解题思路\">解题思路</h3>\n<p>本题解决方案是有限状态自动机。根据字符类型和合法数值的特点，定义状态，再画出状态转移图。</p>\n<h4 id=\"字符类型\">字符类型</h4>\n<p>空格:’ ‘，数字:d，正负号:s，小数点:’.'，幂符号：e</p>\n<h4 id=\"状态定义\">状态定义</h4>\n<p>从左到右可以定义为</p>\n<p>0.左边的<code>空格</code></p>\n<ol>\n<li>E之前的<code>正负号</code></li>\n<li>小数点前的<code>数字</code></li>\n<li>小数点，小数点之后的<code>数字</code></li>\n<li>小数点前为空格，<code>小数点</code>，小数点后为数字</li>\n<li><code>幂符号</code></li>\n<li>幂符号之后的<code>正负号</code></li>\n<li>幂符号之后的<code>数字</code></li>\n<li>结尾的<code>空格</code></li>\n</ol>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer20-pic1.png\" alt=\"\"></p>\n<h4 id=\"结束状态\">结束状态</h4>\n<p>正常的结束状态有2，3，7，8</p>\n<h3 id=\"算法流程\">算法流程</h3>\n<h4 id=\"初始化\">初始化</h4>\n<h5 id=\"1，状态转移表status\">1，状态转移表status</h5>\n<p>$states[i]$表示所处的状态，$i$为所处的状态表示，$states[i]$使用哈希表存储从i状态到可转移的状态；使用键值对来表示$(key,value)$：若输入$key$，可从状态$i$转移至状态$value$.</p>\n<p>当前状态p：初始状态为0</p>\n<h5 id=\"2，转移循环\">2，转移循环</h5>\n<p>还需要<strong>记录字符类型</strong>t，遍历字符串的每个字符c</p>\n<ul>\n<li>当 c 为正负号时，执行 t = ‘s’ ;</li>\n<li>当 c 为数字时，执行 t = ‘d’ ;</li>\n<li>当 c 为 e , E 时，执行 t = ‘e’ ;</li>\n<li>当 c 为 . , 空格 时，执行 t = c （即用字符本身表示字符类型）;</li>\n<li>否则，执行 t = ‘?’ ，代表为不属于判断范围的非法字符，后续直接返回 false。</li>\n</ul>\n<p><strong>终止条件</strong>： 若字符类型 t不在哈希表  $states[p]$ 中，说明无法转移至下一状态，因此直接返回 False 。<br>\n<strong>状态转移</strong>： 状态 p 转移至 $states[p][t]$。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isNumber</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        states = [<br>            { <span class=\"hljs-string\">' '</span>: <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">'s'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'d'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'.'</span>: <span class=\"hljs-number\">4</span> }, <span class=\"hljs-comment\"># 0. start with 'blank'</span><br>            { <span class=\"hljs-string\">'d'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'.'</span>: <span class=\"hljs-number\">4</span> } ,                <span class=\"hljs-comment\"># 1. 'sign' before 'e'</span><br>            { <span class=\"hljs-string\">'d'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'.'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'e'</span>: <span class=\"hljs-number\">5</span>, <span class=\"hljs-string\">' '</span>: <span class=\"hljs-number\">8</span> }, <span class=\"hljs-comment\"># 2. 'digit' before 'dot'</span><br>            { <span class=\"hljs-string\">'d'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'e'</span>: <span class=\"hljs-number\">5</span>, <span class=\"hljs-string\">' '</span>: <span class=\"hljs-number\">8</span> },         <span class=\"hljs-comment\"># 3. 'digit' after 'dot'</span><br>            { <span class=\"hljs-string\">'d'</span>: <span class=\"hljs-number\">3</span> },                         <span class=\"hljs-comment\"># 4. 'digit' after 'dot' (‘blank’ before 'dot')</span><br>            { <span class=\"hljs-string\">'s'</span>: <span class=\"hljs-number\">6</span>, <span class=\"hljs-string\">'d'</span>: <span class=\"hljs-number\">7</span> },                 <span class=\"hljs-comment\"># 5. 'e'</span><br>            { <span class=\"hljs-string\">'d'</span>: <span class=\"hljs-number\">7</span> },                         <span class=\"hljs-comment\"># 6. 'sign' after 'e'</span><br>            { <span class=\"hljs-string\">'d'</span>: <span class=\"hljs-number\">7</span>, <span class=\"hljs-string\">' '</span>: <span class=\"hljs-number\">8</span> },                 <span class=\"hljs-comment\"># 7. 'digit' after 'e'</span><br>            { <span class=\"hljs-string\">' '</span>: <span class=\"hljs-number\">8</span> }                          <span class=\"hljs-comment\"># 8. end with 'blank'</span><br>        ]<br>        p = <span class=\"hljs-number\">0</span>                           <span class=\"hljs-comment\"># start with state 0</span><br>        <span class=\"hljs-keyword\">for</span> c <span class=\"hljs-keyword\">in</span> s:<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'0'</span> &lt;= c &lt;= <span class=\"hljs-string\">'9'</span>: t = <span class=\"hljs-string\">'d'</span> <span class=\"hljs-comment\"># digit</span><br>            <span class=\"hljs-keyword\">elif</span> c <span class=\"hljs-keyword\">in</span> <span class=\"hljs-string\">\"+-\"</span>: t = <span class=\"hljs-string\">'s'</span>     <span class=\"hljs-comment\"># sign</span><br>            <span class=\"hljs-keyword\">elif</span> c <span class=\"hljs-keyword\">in</span> <span class=\"hljs-string\">\"eE\"</span>: t = <span class=\"hljs-string\">'e'</span>     <span class=\"hljs-comment\"># e or E</span><br>            <span class=\"hljs-keyword\">elif</span> c <span class=\"hljs-keyword\">in</span> <span class=\"hljs-string\">\". \"</span>: t = c       <span class=\"hljs-comment\"># dot, blank</span><br>            <span class=\"hljs-keyword\">else</span>: t = <span class=\"hljs-string\">'?'</span>               <span class=\"hljs-comment\"># unknown</span><br>            <span class=\"hljs-keyword\">if</span> t <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> states[p]: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>            p = states[p][t]<br>        <span class=\"hljs-keyword\">return</span> p <span class=\"hljs-keyword\">in</span> (<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>)<br><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>表示数值的字符串</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现一个函数用来判断字符串是否表示数值（包括整数和小数）。</p>\n<p><strong>数值</strong>（按顺序）可以分成以下几个部分：</p>\n<ol>\n<li>若干空格</li>\n<li>一个 小数 或者 整数</li>\n<li>（可选）一个 ‘e’ 或 ‘E’ ，后面跟着一个 整数</li>\n<li>若干空格</li>\n</ol>\n<p><strong>小数</strong>（按顺序）可以分成以下几个部分：</p>\n<ol>\n<li>\n<p>（可选）一个符号字符（‘+’ 或 ‘-’）</p>\n</li>\n<li>\n<p>下述格式之一：</p>\n<ol>\n<li>至少一位数字，后面跟着一个点 ‘.’</li>\n<li>至少一位数字，后面跟着一个点 ‘.’ ，后面再跟着至少一位数字</li>\n<li>一个点 ‘.’ ，后面跟着至少一位数字</li>\n</ol>\n</li>\n</ol>\n<p><strong>整数</strong>（按顺序）可以分成以下几个部分：</p>\n<ol>\n<li>（可选）一个符号字符（‘+’ 或 ‘-’）</li>\n<li>至少一位数字</li>\n</ol>\n<p>部分<strong>数值</strong>列举如下：</p>\n<ul>\n<li>[“+100”, “5e2”, “-123”, “3.1416”, “-1E-16”, “0123”]</li>\n</ul>\n<p>部分非数值列举如下：</p>\n<ul>\n<li>[“12e”, “1a3.14”, “1.2.3”, “±5”, “12e+5.4”]</li>\n</ul>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">&quot;0&quot;</span><br>输出：<span class=\"hljs-literal\">true</span><br><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">&quot;e&quot;</span><br>输出：<span class=\"hljs-literal\">false</span><br><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">&quot;.&quot;</span><br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">&quot;    .1  &quot;</span><br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= s.length &lt;= 20</li>\n<li>s 仅含英文字母（大写和小写），数字（0-9），加号 ‘+’ ，减号 ‘-’ ，空格 ’ ’ 或者点 ‘.’ 。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h3 id=\"解题思路\">解题思路</h3>\n<p>本题解决方案是有限状态自动机。根据字符类型和合法数值的特点，定义状态，再画出状态转移图。</p>\n<h4 id=\"字符类型\">字符类型</h4>\n<p>空格:’ ‘，数字:d，正负号:s，小数点:’.'，幂符号：e</p>\n<h4 id=\"状态定义\">状态定义</h4>\n<p>从左到右可以定义为</p>\n<p>0.左边的<code>空格</code></p>\n<ol>\n<li>E之前的<code>正负号</code></li>\n<li>小数点前的<code>数字</code></li>\n<li>小数点，小数点之后的<code>数字</code></li>\n<li>小数点前为空格，<code>小数点</code>，小数点后为数字</li>\n<li><code>幂符号</code></li>\n<li>幂符号之后的<code>正负号</code></li>\n<li>幂符号之后的<code>数字</code></li>\n<li>结尾的<code>空格</code></li>\n</ol>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer20-pic1.png\" alt=\"\"></p>\n<h4 id=\"结束状态\">结束状态</h4>\n<p>正常的结束状态有2，3，7，8</p>\n<h3 id=\"算法流程\">算法流程</h3>\n<h4 id=\"初始化\">初始化</h4>\n<h5 id=\"1，状态转移表status\">1，状态转移表status</h5>\n<p>$states[i]$表示所处的状态，$i$为所处的状态表示，$states[i]$使用哈希表存储从i状态到可转移的状态；使用键值对来表示$(key,value)$：若输入$key$，可从状态$i$转移至状态$value$.</p>\n<p>当前状态p：初始状态为0</p>\n<h5 id=\"2，转移循环\">2，转移循环</h5>\n<p>还需要<strong>记录字符类型</strong>t，遍历字符串的每个字符c</p>\n<ul>\n<li>当 c 为正负号时，执行 t = ‘s’ ;</li>\n<li>当 c 为数字时，执行 t = ‘d’ ;</li>\n<li>当 c 为 e , E 时，执行 t = ‘e’ ;</li>\n<li>当 c 为 . , 空格 时，执行 t = c （即用字符本身表示字符类型）;</li>\n<li>否则，执行 t = ‘?’ ，代表为不属于判断范围的非法字符，后续直接返回 false。</li>\n</ul>\n<p><strong>终止条件</strong>： 若字符类型 t不在哈希表  $states[p]$ 中，说明无法转移至下一状态，因此直接返回 False 。<br>\n<strong>状态转移</strong>： 状态 p 转移至 $states[p][t]$。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isNumber</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        states = [<br>            &#123; <span class=\"hljs-string\">&#x27; &#x27;</span>: <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&#x27;s&#x27;</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&#x27;d&#x27;</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">&#x27;.&#x27;</span>: <span class=\"hljs-number\">4</span> &#125;, <span class=\"hljs-comment\"># 0. start with &#x27;blank&#x27;</span><br>            &#123; <span class=\"hljs-string\">&#x27;d&#x27;</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">&#x27;.&#x27;</span>: <span class=\"hljs-number\">4</span> &#125; ,                <span class=\"hljs-comment\"># 1. &#x27;sign&#x27; before &#x27;e&#x27;</span><br>            &#123; <span class=\"hljs-string\">&#x27;d&#x27;</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">&#x27;.&#x27;</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">&#x27;e&#x27;</span>: <span class=\"hljs-number\">5</span>, <span class=\"hljs-string\">&#x27; &#x27;</span>: <span class=\"hljs-number\">8</span> &#125;, <span class=\"hljs-comment\"># 2. &#x27;digit&#x27; before &#x27;dot&#x27;</span><br>            &#123; <span class=\"hljs-string\">&#x27;d&#x27;</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">&#x27;e&#x27;</span>: <span class=\"hljs-number\">5</span>, <span class=\"hljs-string\">&#x27; &#x27;</span>: <span class=\"hljs-number\">8</span> &#125;,         <span class=\"hljs-comment\"># 3. &#x27;digit&#x27; after &#x27;dot&#x27;</span><br>            &#123; <span class=\"hljs-string\">&#x27;d&#x27;</span>: <span class=\"hljs-number\">3</span> &#125;,                         <span class=\"hljs-comment\"># 4. &#x27;digit&#x27; after &#x27;dot&#x27; (‘blank’ before &#x27;dot&#x27;)</span><br>            &#123; <span class=\"hljs-string\">&#x27;s&#x27;</span>: <span class=\"hljs-number\">6</span>, <span class=\"hljs-string\">&#x27;d&#x27;</span>: <span class=\"hljs-number\">7</span> &#125;,                 <span class=\"hljs-comment\"># 5. &#x27;e&#x27;</span><br>            &#123; <span class=\"hljs-string\">&#x27;d&#x27;</span>: <span class=\"hljs-number\">7</span> &#125;,                         <span class=\"hljs-comment\"># 6. &#x27;sign&#x27; after &#x27;e&#x27;</span><br>            &#123; <span class=\"hljs-string\">&#x27;d&#x27;</span>: <span class=\"hljs-number\">7</span>, <span class=\"hljs-string\">&#x27; &#x27;</span>: <span class=\"hljs-number\">8</span> &#125;,                 <span class=\"hljs-comment\"># 7. &#x27;digit&#x27; after &#x27;e&#x27;</span><br>            &#123; <span class=\"hljs-string\">&#x27; &#x27;</span>: <span class=\"hljs-number\">8</span> &#125;                          <span class=\"hljs-comment\"># 8. end with &#x27;blank&#x27;</span><br>        ]<br>        p = <span class=\"hljs-number\">0</span>                           <span class=\"hljs-comment\"># start with state 0</span><br>        <span class=\"hljs-keyword\">for</span> c <span class=\"hljs-keyword\">in</span> s:<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">&#x27;0&#x27;</span> &lt;= c &lt;= <span class=\"hljs-string\">&#x27;9&#x27;</span>: t = <span class=\"hljs-string\">&#x27;d&#x27;</span> <span class=\"hljs-comment\"># digit</span><br>            <span class=\"hljs-keyword\">elif</span> c <span class=\"hljs-keyword\">in</span> <span class=\"hljs-string\">&quot;+-&quot;</span>: t = <span class=\"hljs-string\">&#x27;s&#x27;</span>     <span class=\"hljs-comment\"># sign</span><br>            <span class=\"hljs-keyword\">elif</span> c <span class=\"hljs-keyword\">in</span> <span class=\"hljs-string\">&quot;eE&quot;</span>: t = <span class=\"hljs-string\">&#x27;e&#x27;</span>     <span class=\"hljs-comment\"># e or E</span><br>            <span class=\"hljs-keyword\">elif</span> c <span class=\"hljs-keyword\">in</span> <span class=\"hljs-string\">&quot;. &quot;</span>: t = c       <span class=\"hljs-comment\"># dot, blank</span><br>            <span class=\"hljs-keyword\">else</span>: t = <span class=\"hljs-string\">&#x27;?&#x27;</span>               <span class=\"hljs-comment\"># unknown</span><br>            <span class=\"hljs-keyword\">if</span> t <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> states[p]: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>            p = states[p][t]<br>        <span class=\"hljs-keyword\">return</span> p <span class=\"hljs-keyword\">in</span> (<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>)<br><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer21 调整数组顺序使奇数位于偶数前面","date":"2021-08-18T10:18:43.000Z","_content":"\n> 调整数组顺序使奇数位于偶数前面\n\n## 题目\n\n输入一个整数数组，实现一个函数来调整该数组中数字的顺序，使得所有奇数位于数组的前半部分，所有偶数位于数组的后半部分。\n\n### 示例 1：\n\n```\n输入：nums = [1,2,3,4]\n输出：[1,3,2,4] \n注：[3,1,2,4] 也是正确的答案之一。\n```\n\n### 提示：\n\n- 0 <= nums.length <= 50000\n- 1 <= nums[i] <= 10000\n\n## 题解\n\npython的list的常规操作。\n\n```python\nclass Solution:\n    def exchange(self, nums: List[int]) -> List[int]:\n        odd = []\n        even = []\n        for x in nums:\n            if(x%2):\n                odd.append(x)\n            else:\n                even.append(x)\n        return odd+even\n```\n\n","source":"_posts/leetcode/leetcode-offer21.md","raw":"---\ntitle: 剑指offer21 调整数组顺序使奇数位于偶数前面\ntags: [剑指,数组]\ncategories: [剑指,数组]\ndate: 2021-08-18 18:18:43\n---\n\n> 调整数组顺序使奇数位于偶数前面\n\n## 题目\n\n输入一个整数数组，实现一个函数来调整该数组中数字的顺序，使得所有奇数位于数组的前半部分，所有偶数位于数组的后半部分。\n\n### 示例 1：\n\n```\n输入：nums = [1,2,3,4]\n输出：[1,3,2,4] \n注：[3,1,2,4] 也是正确的答案之一。\n```\n\n### 提示：\n\n- 0 <= nums.length <= 50000\n- 1 <= nums[i] <= 10000\n\n## 题解\n\npython的list的常规操作。\n\n```python\nclass Solution:\n    def exchange(self, nums: List[int]) -> List[int]:\n        odd = []\n        even = []\n        for x in nums:\n            if(x%2):\n                odd.append(x)\n            else:\n                even.append(x)\n        return odd+even\n```\n\n","slug":"leetcode/leetcode-offer21","published":1,"updated":"2022-01-18T08:10:17.076Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09d0036ast9b9prdk8c","content":"<blockquote>\n<p>调整数组顺序使奇数位于偶数前面</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个整数数组，实现一个函数来调整该数组中数字的顺序，使得所有奇数位于数组的前半部分，所有偶数位于数组的后半部分。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight dns\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：nums = [<span class=\"hljs-number\">1,2,3,4</span>]<br>输出：[<span class=\"hljs-number\">1,3,2,4</span>] <br>注：[<span class=\"hljs-number\">3,1,2,4</span>] 也是正确的答案之一。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= nums.length &lt;= 50000</li>\n<li>1 &lt;= nums[i] &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>python的list的常规操作。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">exchange</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        odd = []<br>        even = []<br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span>(x%<span class=\"hljs-number\">2</span>):<br>                odd.append(x)<br>            <span class=\"hljs-keyword\">else</span>:<br>                even.append(x)<br>        <span class=\"hljs-keyword\">return</span> odd+even<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>调整数组顺序使奇数位于偶数前面</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个整数数组，实现一个函数来调整该数组中数字的顺序，使得所有奇数位于数组的前半部分，所有偶数位于数组的后半部分。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight dns\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：nums = [<span class=\"hljs-number\">1,2,3,4</span>]<br>输出：[<span class=\"hljs-number\">1,3,2,4</span>] <br>注：[<span class=\"hljs-number\">3,1,2,4</span>] 也是正确的答案之一。<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= nums.length &lt;= 50000</li>\n<li>1 &lt;= nums[i] &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>python的list的常规操作。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">exchange</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        odd = []<br>        even = []<br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span>(x%<span class=\"hljs-number\">2</span>):<br>                odd.append(x)<br>            <span class=\"hljs-keyword\">else</span>:<br>                even.append(x)<br>        <span class=\"hljs-keyword\">return</span> odd+even<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer22 链表中倒数第k个节点","date":"2021-08-20T03:26:27.000Z","_content":"\n> 链表中倒数第k个节点\n\n## 题目\n\n输入一个链表，输出该链表中倒数第k个节点。为了符合大多数人的习惯，本题从1开始计数，即链表的尾节点是倒数第1个节点。\n\n例如，一个链表有 6 个节点，从头节点开始，它们的值依次是 1、2、3、4、5、6。这个链表的倒数第 3 个节点是值为 4 的节点。\n\n### 示例 1：\n\n```\n给定一个链表: 1->2->3->4->5, 和 k = 2.\n返回链表 4->5.\n```\n\n## 题解\n\n一种方法是先确定链表的长度，然后再移动对应的结点个数。那么就需要O(2n)\n\n```python\nclass Solution:\n    def getKthFromEnd(self, head: ListNode, k: int) -> ListNode:\n        y = x = head\n        cnt = 0\n        while(x):\n            cnt += 1\n            x = x.next\n        t = cnt - k\n        while(t):\n            y = y.next\n            t -= 1\n        return y\n```\n\n使用快慢指针，使得x与y相距k元素，然后x遍历到最后，y就可以得到对应的结果。此时只需要O(n)\n```python\nclass Solution:\n    def getKthFromEnd(self, head: ListNode, k: int) -> ListNode:\n        y = x = head\n        while(x):\n            if(k<=0):y = y.next\n            x = x.next\n            k -= 1\n        return y\n```","source":"_posts/leetcode/leetcode-offer22.md","raw":"---\ntitle: 剑指offer22 链表中倒数第k个节点\ntags: [剑指,链表]\ncategories: [剑指,链表]\ndate: 2021-08-20 11:26:27\n---\n\n> 链表中倒数第k个节点\n\n## 题目\n\n输入一个链表，输出该链表中倒数第k个节点。为了符合大多数人的习惯，本题从1开始计数，即链表的尾节点是倒数第1个节点。\n\n例如，一个链表有 6 个节点，从头节点开始，它们的值依次是 1、2、3、4、5、6。这个链表的倒数第 3 个节点是值为 4 的节点。\n\n### 示例 1：\n\n```\n给定一个链表: 1->2->3->4->5, 和 k = 2.\n返回链表 4->5.\n```\n\n## 题解\n\n一种方法是先确定链表的长度，然后再移动对应的结点个数。那么就需要O(2n)\n\n```python\nclass Solution:\n    def getKthFromEnd(self, head: ListNode, k: int) -> ListNode:\n        y = x = head\n        cnt = 0\n        while(x):\n            cnt += 1\n            x = x.next\n        t = cnt - k\n        while(t):\n            y = y.next\n            t -= 1\n        return y\n```\n\n使用快慢指针，使得x与y相距k元素，然后x遍历到最后，y就可以得到对应的结果。此时只需要O(n)\n```python\nclass Solution:\n    def getKthFromEnd(self, head: ListNode, k: int) -> ListNode:\n        y = x = head\n        while(x):\n            if(k<=0):y = y.next\n            x = x.next\n            k -= 1\n        return y\n```","slug":"leetcode/leetcode-offer22","published":1,"updated":"2022-01-18T08:10:17.077Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09f0038ast90e5a0xxt","content":"<blockquote>\n<p>链表中倒数第k个节点</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个链表，输出该链表中倒数第k个节点。为了符合大多数人的习惯，本题从1开始计数，即链表的尾节点是倒数第1个节点。</p>\n<p>例如，一个链表有 6 个节点，从头节点开始，它们的值依次是 1、2、3、4、5、6。这个链表的倒数第 3 个节点是值为 4 的节点。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight clean\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs clean\">给定一个链表: <span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">2</span>-&gt;<span class=\"hljs-number\">3</span>-&gt;<span class=\"hljs-number\">4</span>-&gt;<span class=\"hljs-number\">5</span>, 和 k = <span class=\"hljs-number\">2.</span><br>返回链表 <span class=\"hljs-number\">4</span>-&gt;<span class=\"hljs-number\">5.</span><br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"题解\">题解</h2>\n<p>一种方法是先确定链表的长度，然后再移动对应的结点个数。那么就需要O(2n)</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">getKthFromEnd</span>(<span class=\"hljs-params\">self, head: ListNode, k: <span class=\"hljs-built_in\">int</span></span>) -&gt; ListNode:</span><br>        y = x = head<br>        cnt = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">while</span>(x):<br>            cnt += <span class=\"hljs-number\">1</span><br>            x = x.<span class=\"hljs-built_in\">next</span><br>        t = cnt - k<br>        <span class=\"hljs-keyword\">while</span>(t):<br>            y = y.<span class=\"hljs-built_in\">next</span><br>            t -= <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> y<br></code></pre></td></tr></tbody></table></figure>\n<p>使用快慢指针，使得x与y相距k元素，然后x遍历到最后，y就可以得到对应的结果。此时只需要O(n)</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">getKthFromEnd</span>(<span class=\"hljs-params\">self, head: ListNode, k: <span class=\"hljs-built_in\">int</span></span>) -&gt; ListNode:</span><br>        y = x = head<br>        <span class=\"hljs-keyword\">while</span>(x):<br>            <span class=\"hljs-keyword\">if</span>(k&lt;=<span class=\"hljs-number\">0</span>):y = y.<span class=\"hljs-built_in\">next</span><br>            x = x.<span class=\"hljs-built_in\">next</span><br>            k -= <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> y<br></code></pre></td></tr></tbody></table></figure>","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>链表中倒数第k个节点</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个链表，输出该链表中倒数第k个节点。为了符合大多数人的习惯，本题从1开始计数，即链表的尾节点是倒数第1个节点。</p>\n<p>例如，一个链表有 6 个节点，从头节点开始，它们的值依次是 1、2、3、4、5、6。这个链表的倒数第 3 个节点是值为 4 的节点。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight clean\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs clean\">给定一个链表: <span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">2</span>-&gt;<span class=\"hljs-number\">3</span>-&gt;<span class=\"hljs-number\">4</span>-&gt;<span class=\"hljs-number\">5</span>, 和 k = <span class=\"hljs-number\">2.</span><br>返回链表 <span class=\"hljs-number\">4</span>-&gt;<span class=\"hljs-number\">5.</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"题解\">题解</h2>\n<p>一种方法是先确定链表的长度，然后再移动对应的结点个数。那么就需要O(2n)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">getKthFromEnd</span>(<span class=\"hljs-params\">self, head: ListNode, k: <span class=\"hljs-built_in\">int</span></span>) -&gt; ListNode:</span><br>        y = x = head<br>        cnt = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">while</span>(x):<br>            cnt += <span class=\"hljs-number\">1</span><br>            x = x.<span class=\"hljs-built_in\">next</span><br>        t = cnt - k<br>        <span class=\"hljs-keyword\">while</span>(t):<br>            y = y.<span class=\"hljs-built_in\">next</span><br>            t -= <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> y<br></code></pre></td></tr></table></figure>\n<p>使用快慢指针，使得x与y相距k元素，然后x遍历到最后，y就可以得到对应的结果。此时只需要O(n)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">getKthFromEnd</span>(<span class=\"hljs-params\">self, head: ListNode, k: <span class=\"hljs-built_in\">int</span></span>) -&gt; ListNode:</span><br>        y = x = head<br>        <span class=\"hljs-keyword\">while</span>(x):<br>            <span class=\"hljs-keyword\">if</span>(k&lt;=<span class=\"hljs-number\">0</span>):y = y.<span class=\"hljs-built_in\">next</span><br>            x = x.<span class=\"hljs-built_in\">next</span><br>            k -= <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> y<br></code></pre></td></tr></table></figure>"},{"title":"剑指offer24 反转链表","date":"2021-08-21T03:51:30.000Z","_content":"\n> 反转链表\n\n## 题目\n\n定义一个函数，输入一个链表的头节点，反转该链表并输出反转后链表的头节点。\n\n### 示例 1：\n\n```\n输入: 1->2->3->4->5->NULL\n输出: 5->4->3->2->1->NULL\n```\n\n### 提示：\n\n- 0 <= 节点个数 <= 5000\n\n## 题解\n\n比较常规，遍历链表把元素移动到头节点。\n\n```python\n# Definition for singly-linked list.\n# class ListNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.next = None\n\nclass Solution:\n    def reverseList(self, head: ListNode) -> ListNode:\n        if not(head):return head\n        p = head.next\n        head.next = None\n        while(p):\n            t = p.next\n            p.next = head\n            head = p\n            p = t\n        return head\n```\n\n","source":"_posts/leetcode/leetcode-offer24.md","raw":"---\ntitle: 剑指offer24 反转链表\ntags: [剑指,链表]\ncategories: [剑指,链表]\ndate: 2021-08-21 11:51:30\n---\n\n> 反转链表\n\n## 题目\n\n定义一个函数，输入一个链表的头节点，反转该链表并输出反转后链表的头节点。\n\n### 示例 1：\n\n```\n输入: 1->2->3->4->5->NULL\n输出: 5->4->3->2->1->NULL\n```\n\n### 提示：\n\n- 0 <= 节点个数 <= 5000\n\n## 题解\n\n比较常规，遍历链表把元素移动到头节点。\n\n```python\n# Definition for singly-linked list.\n# class ListNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.next = None\n\nclass Solution:\n    def reverseList(self, head: ListNode) -> ListNode:\n        if not(head):return head\n        p = head.next\n        head.next = None\n        while(p):\n            t = p.next\n            p.next = head\n            head = p\n            p = t\n        return head\n```\n\n","slug":"leetcode/leetcode-offer24","published":1,"updated":"2022-01-18T08:10:17.078Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09i003dast9c6sp3gdm","content":"<blockquote>\n<p>反转链表</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>定义一个函数，输入一个链表的头节点，反转该链表并输出反转后链表的头节点。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight clean\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs clean\">输入: <span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">2</span>-&gt;<span class=\"hljs-number\">3</span>-&gt;<span class=\"hljs-number\">4</span>-&gt;<span class=\"hljs-number\">5</span>-&gt;NULL<br>输出: <span class=\"hljs-number\">5</span>-&gt;<span class=\"hljs-number\">4</span>-&gt;<span class=\"hljs-number\">3</span>-&gt;<span class=\"hljs-number\">2</span>-&gt;<span class=\"hljs-number\">1</span>-&gt;NULL<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 节点个数 &lt;= 5000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>比较常规，遍历链表把元素移动到头节点。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for singly-linked list.</span><br><span class=\"hljs-comment\"># class ListNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.next = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">reverseList</span>(<span class=\"hljs-params\">self, head: ListNode</span>) -&gt; ListNode:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(head):<span class=\"hljs-keyword\">return</span> head<br>        p = head.<span class=\"hljs-built_in\">next</span><br>        head.<span class=\"hljs-built_in\">next</span> = <span class=\"hljs-literal\">None</span><br>        <span class=\"hljs-keyword\">while</span>(p):<br>            t = p.<span class=\"hljs-built_in\">next</span><br>            p.<span class=\"hljs-built_in\">next</span> = head<br>            head = p<br>            p = t<br>        <span class=\"hljs-keyword\">return</span> head<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>反转链表</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>定义一个函数，输入一个链表的头节点，反转该链表并输出反转后链表的头节点。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight clean\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs clean\">输入: <span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">2</span>-&gt;<span class=\"hljs-number\">3</span>-&gt;<span class=\"hljs-number\">4</span>-&gt;<span class=\"hljs-number\">5</span>-&gt;NULL<br>输出: <span class=\"hljs-number\">5</span>-&gt;<span class=\"hljs-number\">4</span>-&gt;<span class=\"hljs-number\">3</span>-&gt;<span class=\"hljs-number\">2</span>-&gt;<span class=\"hljs-number\">1</span>-&gt;NULL<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 节点个数 &lt;= 5000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>比较常规，遍历链表把元素移动到头节点。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for singly-linked list.</span><br><span class=\"hljs-comment\"># class ListNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.next = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">reverseList</span>(<span class=\"hljs-params\">self, head: ListNode</span>) -&gt; ListNode:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(head):<span class=\"hljs-keyword\">return</span> head<br>        p = head.<span class=\"hljs-built_in\">next</span><br>        head.<span class=\"hljs-built_in\">next</span> = <span class=\"hljs-literal\">None</span><br>        <span class=\"hljs-keyword\">while</span>(p):<br>            t = p.<span class=\"hljs-built_in\">next</span><br>            p.<span class=\"hljs-built_in\">next</span> = head<br>            head = p<br>            p = t<br>        <span class=\"hljs-keyword\">return</span> head<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer06 合并两个排序的链表","date":"2021-08-16T09:39:21.000Z","_content":"\n>合并两个排序的链表\n\n## 题目\n\n输入两个递增排序的链表，合并这两个链表并使新链表中的节点仍然是递增排序的。\n\n### 示例 1：\n\n```\n输入：1->2->4, 1->3->4\n输出：1->1->2->3->4->4\n```\n\n### 提示：\n\n- 0 <= 链表长度 <= 1000\n\n## 题解\n\n如果直接用p = l.next  那么不能达到“指针”的效果。这样的操作对l没有影响，无法更新。\n\n```python\nclass Solution:\n    def mergeTwoLists(self, l1: ListNode, l2: ListNode) -> ListNode:\n        l = ListNode(0) \n        p = l.next     \n        while(l1 and l2):\n            if(l1.val>l2.val):\n                p = l2\n                l2 = l2.next\n            else:\n                p = l1\n                l1 = l1.next\n            p = p.next\n        p = l1 if l1 else l2\n        return l.next\n```\n\n正确方式，不能使用 p = p.next， 因为next是一个None值，改变p值并不会修改l对应的next。所以首先浅拷贝l，然后再直接改变内部的next，才能对应的改变l的内容。\n\n```python\n# Definition for singly-linked list.\n# class ListNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.next = None\n\nclass Solution:\n    def mergeTwoLists(self, l1: ListNode, l2: ListNode) -> ListNode:\n        p = l = ListNode(0) #先指向同一块空间\n        #p = p.next      \n        # 不能使用p = p.next  因为next是一个None值改变p值并不会修改l对应的next。\n        # 所以首先浅拷贝，然后再直接改变内部的next，才能对应的改变l的内容\n        while(l1 and l2):\n            if(l1.val>l2.val):\n                p.next = l2\n                l2 = l2.next\n            else:\n                p.next = l1\n                l1 = l1.next\n            p = p.next\n        p.next = l1 if l1 else l2\n        return l.next\n```\n\n","source":"_posts/leetcode/leetcode-offer25.md","raw":"---\ntitle: 剑指offer06 合并两个排序的链表\ntags: [剑指,链表]\ncategories: [剑指,链表]\ndate: 2021-08-16 17:39:21\n---\n\n>合并两个排序的链表\n\n## 题目\n\n输入两个递增排序的链表，合并这两个链表并使新链表中的节点仍然是递增排序的。\n\n### 示例 1：\n\n```\n输入：1->2->4, 1->3->4\n输出：1->1->2->3->4->4\n```\n\n### 提示：\n\n- 0 <= 链表长度 <= 1000\n\n## 题解\n\n如果直接用p = l.next  那么不能达到“指针”的效果。这样的操作对l没有影响，无法更新。\n\n```python\nclass Solution:\n    def mergeTwoLists(self, l1: ListNode, l2: ListNode) -> ListNode:\n        l = ListNode(0) \n        p = l.next     \n        while(l1 and l2):\n            if(l1.val>l2.val):\n                p = l2\n                l2 = l2.next\n            else:\n                p = l1\n                l1 = l1.next\n            p = p.next\n        p = l1 if l1 else l2\n        return l.next\n```\n\n正确方式，不能使用 p = p.next， 因为next是一个None值，改变p值并不会修改l对应的next。所以首先浅拷贝l，然后再直接改变内部的next，才能对应的改变l的内容。\n\n```python\n# Definition for singly-linked list.\n# class ListNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.next = None\n\nclass Solution:\n    def mergeTwoLists(self, l1: ListNode, l2: ListNode) -> ListNode:\n        p = l = ListNode(0) #先指向同一块空间\n        #p = p.next      \n        # 不能使用p = p.next  因为next是一个None值改变p值并不会修改l对应的next。\n        # 所以首先浅拷贝，然后再直接改变内部的next，才能对应的改变l的内容\n        while(l1 and l2):\n            if(l1.val>l2.val):\n                p.next = l2\n                l2 = l2.next\n            else:\n                p.next = l1\n                l1 = l1.next\n            p = p.next\n        p.next = l1 if l1 else l2\n        return l.next\n```\n\n","slug":"leetcode/leetcode-offer25","published":1,"updated":"2022-01-18T08:10:17.078Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09j003east94ilp3mh1","content":"<blockquote>\n<p>合并两个排序的链表</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入两个递增排序的链表，合并这两个链表并使新链表中的节点仍然是递增排序的。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight clean\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs clean\">输入：<span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">2</span>-&gt;<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">3</span>-&gt;<span class=\"hljs-number\">4</span><br>输出：<span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">2</span>-&gt;<span class=\"hljs-number\">3</span>-&gt;<span class=\"hljs-number\">4</span>-&gt;<span class=\"hljs-number\">4</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 链表长度 &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>如果直接用p = l.next  那么不能达到“指针”的效果。这样的操作对l没有影响，无法更新。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">mergeTwoLists</span>(<span class=\"hljs-params\">self, l1: ListNode, l2: ListNode</span>) -&gt; ListNode:</span><br>        l = ListNode(<span class=\"hljs-number\">0</span>) <br>        p = l.<span class=\"hljs-built_in\">next</span>     <br>        <span class=\"hljs-keyword\">while</span>(l1 <span class=\"hljs-keyword\">and</span> l2):<br>            <span class=\"hljs-keyword\">if</span>(l1.val&gt;l2.val):<br>                p = l2<br>                l2 = l2.<span class=\"hljs-built_in\">next</span><br>            <span class=\"hljs-keyword\">else</span>:<br>                p = l1<br>                l1 = l1.<span class=\"hljs-built_in\">next</span><br>            p = p.<span class=\"hljs-built_in\">next</span><br>        p = l1 <span class=\"hljs-keyword\">if</span> l1 <span class=\"hljs-keyword\">else</span> l2<br>        <span class=\"hljs-keyword\">return</span> l.<span class=\"hljs-built_in\">next</span><br></code></pre></td></tr></tbody></table></figure>\n<p>正确方式，不能使用 p = p.next， 因为next是一个None值，改变p值并不会修改l对应的next。所以首先浅拷贝l，然后再直接改变内部的next，才能对应的改变l的内容。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for singly-linked list.</span><br><span class=\"hljs-comment\"># class ListNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.next = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">mergeTwoLists</span>(<span class=\"hljs-params\">self, l1: ListNode, l2: ListNode</span>) -&gt; ListNode:</span><br>        p = l = ListNode(<span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\">#先指向同一块空间</span><br>        <span class=\"hljs-comment\">#p = p.next      </span><br>        <span class=\"hljs-comment\"># 不能使用p = p.next  因为next是一个None值改变p值并不会修改l对应的next。</span><br>        <span class=\"hljs-comment\"># 所以首先浅拷贝，然后再直接改变内部的next，才能对应的改变l的内容</span><br>        <span class=\"hljs-keyword\">while</span>(l1 <span class=\"hljs-keyword\">and</span> l2):<br>            <span class=\"hljs-keyword\">if</span>(l1.val&gt;l2.val):<br>                p.<span class=\"hljs-built_in\">next</span> = l2<br>                l2 = l2.<span class=\"hljs-built_in\">next</span><br>            <span class=\"hljs-keyword\">else</span>:<br>                p.<span class=\"hljs-built_in\">next</span> = l1<br>                l1 = l1.<span class=\"hljs-built_in\">next</span><br>            p = p.<span class=\"hljs-built_in\">next</span><br>        p.<span class=\"hljs-built_in\">next</span> = l1 <span class=\"hljs-keyword\">if</span> l1 <span class=\"hljs-keyword\">else</span> l2<br>        <span class=\"hljs-keyword\">return</span> l.<span class=\"hljs-built_in\">next</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>合并两个排序的链表</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入两个递增排序的链表，合并这两个链表并使新链表中的节点仍然是递增排序的。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight clean\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs clean\">输入：<span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">2</span>-&gt;<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">3</span>-&gt;<span class=\"hljs-number\">4</span><br>输出：<span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">1</span>-&gt;<span class=\"hljs-number\">2</span>-&gt;<span class=\"hljs-number\">3</span>-&gt;<span class=\"hljs-number\">4</span>-&gt;<span class=\"hljs-number\">4</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 链表长度 &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>如果直接用p = l.next  那么不能达到“指针”的效果。这样的操作对l没有影响，无法更新。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">mergeTwoLists</span>(<span class=\"hljs-params\">self, l1: ListNode, l2: ListNode</span>) -&gt; ListNode:</span><br>        l = ListNode(<span class=\"hljs-number\">0</span>) <br>        p = l.<span class=\"hljs-built_in\">next</span>     <br>        <span class=\"hljs-keyword\">while</span>(l1 <span class=\"hljs-keyword\">and</span> l2):<br>            <span class=\"hljs-keyword\">if</span>(l1.val&gt;l2.val):<br>                p = l2<br>                l2 = l2.<span class=\"hljs-built_in\">next</span><br>            <span class=\"hljs-keyword\">else</span>:<br>                p = l1<br>                l1 = l1.<span class=\"hljs-built_in\">next</span><br>            p = p.<span class=\"hljs-built_in\">next</span><br>        p = l1 <span class=\"hljs-keyword\">if</span> l1 <span class=\"hljs-keyword\">else</span> l2<br>        <span class=\"hljs-keyword\">return</span> l.<span class=\"hljs-built_in\">next</span><br></code></pre></td></tr></table></figure>\n<p>正确方式，不能使用 p = p.next， 因为next是一个None值，改变p值并不会修改l对应的next。所以首先浅拷贝l，然后再直接改变内部的next，才能对应的改变l的内容。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for singly-linked list.</span><br><span class=\"hljs-comment\"># class ListNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.next = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">mergeTwoLists</span>(<span class=\"hljs-params\">self, l1: ListNode, l2: ListNode</span>) -&gt; ListNode:</span><br>        p = l = ListNode(<span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\">#先指向同一块空间</span><br>        <span class=\"hljs-comment\">#p = p.next      </span><br>        <span class=\"hljs-comment\"># 不能使用p = p.next  因为next是一个None值改变p值并不会修改l对应的next。</span><br>        <span class=\"hljs-comment\"># 所以首先浅拷贝，然后再直接改变内部的next，才能对应的改变l的内容</span><br>        <span class=\"hljs-keyword\">while</span>(l1 <span class=\"hljs-keyword\">and</span> l2):<br>            <span class=\"hljs-keyword\">if</span>(l1.val&gt;l2.val):<br>                p.<span class=\"hljs-built_in\">next</span> = l2<br>                l2 = l2.<span class=\"hljs-built_in\">next</span><br>            <span class=\"hljs-keyword\">else</span>:<br>                p.<span class=\"hljs-built_in\">next</span> = l1<br>                l1 = l1.<span class=\"hljs-built_in\">next</span><br>            p = p.<span class=\"hljs-built_in\">next</span><br>        p.<span class=\"hljs-built_in\">next</span> = l1 <span class=\"hljs-keyword\">if</span> l1 <span class=\"hljs-keyword\">else</span> l2<br>        <span class=\"hljs-keyword\">return</span> l.<span class=\"hljs-built_in\">next</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer26 树的子结构","date":"2021-08-18T09:13:56.000Z","_content":"\n> 树的子结构\n\n## 题目\n输入两棵二叉树A和B，判断B是不是A的子结构。(约定空树不是任意一个树的子结构)\nB是A的子结构， 即 A中有出现和B相同的结构和节点值。\n\n例如:\n给定的树 A:\n\n     3\n    / \\\n   4   5\n  / \\\n 1   2\n给定的树 B：\n\n   4 \n  /\n 1\n返回 true，因为 B 与 A 的一个子树拥有相同的结构和节点值。\n\n### 示例 1：\n\n```\n输入：A = [1,2,3], B = [3,1]\n输出：false\n```\n\n### 示例 2：\n\n```\n输入：A = [3,4,5,1,2], B = [4,1]\n输出：true\n```\n\n### 提示：\n\n- 0 <= 节点个数 <= 10000\n\n## 题解\n\npython代码真的！好！简洁！\n\n`isSubStructure`的作用是先序查找A，B的匹配情况。而在内部会对匹配的`judgechildren(A,B)`进行判断，查看是否为其子结构。\n\n如果B为空了则表示匹配成功。如果根节点不匹配或者A为空了就直接返回失败。如果可以继续判断，就继续判断对应的左右子树。\n\n`(judgechildren(A,B) or self.isSubStructure(A.left,B) or self.isSubStructure(A.right,B))` 判断AB两子树；先序判断左右子树，`注意这里是self.isSubStructure`进行递归哦~~\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def isSubStructure(self, A: TreeNode, B: TreeNode) -> bool:\n        def judgechildren(A,B): #判断以AB为根节点的条件下，B是否为A的子结构\n            if not(B): return True\n            if (not A) or (A.val!=B.val): return False\n            return judgechildren(A.right,B.right) and judgechildren(A.left,B.left)\n        return bool(A and B) and (judgechildren(A,B) or self.isSubStructure(A.left,B) or self.isSubStructure(A.right,B))\n```\n\n> bool(A and B)注意要转换为bool变量\n\n- 时间复杂度为O(MN)\n\n- 空间复杂度 O(M)： 当树 A和树 B 都退化为链表时，递归调用深度最大。当 M≤N 时，遍历树 A 与递归判断的总递归深度为 M ；当 M>N 时，最差情况为遍历至树 A叶子节点，此时总递归深度为 M。\n\n\n","source":"_posts/leetcode/leetcode-offer26.md","raw":"---\ntitle: 剑指offer26 树的子结构\ntags: [剑指,树,idea]\ncategories: [剑指,树]\ndate: 2021-08-18 17:13:56\n---\n\n> 树的子结构\n\n## 题目\n输入两棵二叉树A和B，判断B是不是A的子结构。(约定空树不是任意一个树的子结构)\nB是A的子结构， 即 A中有出现和B相同的结构和节点值。\n\n例如:\n给定的树 A:\n\n     3\n    / \\\n   4   5\n  / \\\n 1   2\n给定的树 B：\n\n   4 \n  /\n 1\n返回 true，因为 B 与 A 的一个子树拥有相同的结构和节点值。\n\n### 示例 1：\n\n```\n输入：A = [1,2,3], B = [3,1]\n输出：false\n```\n\n### 示例 2：\n\n```\n输入：A = [3,4,5,1,2], B = [4,1]\n输出：true\n```\n\n### 提示：\n\n- 0 <= 节点个数 <= 10000\n\n## 题解\n\npython代码真的！好！简洁！\n\n`isSubStructure`的作用是先序查找A，B的匹配情况。而在内部会对匹配的`judgechildren(A,B)`进行判断，查看是否为其子结构。\n\n如果B为空了则表示匹配成功。如果根节点不匹配或者A为空了就直接返回失败。如果可以继续判断，就继续判断对应的左右子树。\n\n`(judgechildren(A,B) or self.isSubStructure(A.left,B) or self.isSubStructure(A.right,B))` 判断AB两子树；先序判断左右子树，`注意这里是self.isSubStructure`进行递归哦~~\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def isSubStructure(self, A: TreeNode, B: TreeNode) -> bool:\n        def judgechildren(A,B): #判断以AB为根节点的条件下，B是否为A的子结构\n            if not(B): return True\n            if (not A) or (A.val!=B.val): return False\n            return judgechildren(A.right,B.right) and judgechildren(A.left,B.left)\n        return bool(A and B) and (judgechildren(A,B) or self.isSubStructure(A.left,B) or self.isSubStructure(A.right,B))\n```\n\n> bool(A and B)注意要转换为bool变量\n\n- 时间复杂度为O(MN)\n\n- 空间复杂度 O(M)： 当树 A和树 B 都退化为链表时，递归调用深度最大。当 M≤N 时，遍历树 A 与递归判断的总递归深度为 M ；当 M>N 时，最差情况为遍历至树 A叶子节点，此时总递归深度为 M。\n\n\n","slug":"leetcode/leetcode-offer26","published":1,"updated":"2022-01-18T08:10:17.079Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09l003iast9bgbobs4z","content":"<blockquote>\n<p>树的子结构</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入两棵二叉树A和B，判断B是不是A的子结构。(约定空树不是任意一个树的子结构)<br>\nB是A的子结构， 即 A中有出现和B相同的结构和节点值。</p>\n<p>例如:<br>\n给定的树 A:</p>\n<p>3<br>\n&nbsp; &nbsp; / <br>\n&nbsp; &nbsp;4 &nbsp; 5<br>\n&nbsp; / <br>\n&nbsp;1 &nbsp; 2<br>\n给定的树 B：</p>\n<p>4&nbsp;<br>\n&nbsp; /<br>\n&nbsp;1<br>\n返回 true，因为 B 与 A 的一个子树拥有相同的结构和节点值。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">A</span> = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>], <span class=\"hljs-attr\">B</span> = [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">1</span>]<br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">A</span> = [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>], <span class=\"hljs-attr\">B</span> = [<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">1</span>]<br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 节点个数 &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>python代码真的！好！简洁！</p>\n<p><code>isSubStructure</code>的作用是先序查找A，B的匹配情况。而在内部会对匹配的<code>judgechildren(A,B)</code>进行判断，查看是否为其子结构。</p>\n<p>如果B为空了则表示匹配成功。如果根节点不匹配或者A为空了就直接返回失败。如果可以继续判断，就继续判断对应的左右子树。</p>\n<p><code>(judgechildren(A,B) or self.isSubStructure(A.left,B) or self.isSubStructure(A.right,B))</code> 判断AB两子树；先序判断左右子树，<code>注意这里是self.isSubStructure</code>进行递归哦~~</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isSubStructure</span>(<span class=\"hljs-params\">self, A: TreeNode, B: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">judgechildren</span>(<span class=\"hljs-params\">A,B</span>):</span> <span class=\"hljs-comment\">#判断以AB为根节点的条件下，B是否为A的子结构</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(B): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">not</span> A) <span class=\"hljs-keyword\">or</span> (A.val!=B.val): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>            <span class=\"hljs-keyword\">return</span> judgechildren(A.right,B.right) <span class=\"hljs-keyword\">and</span> judgechildren(A.left,B.left)<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">bool</span>(A <span class=\"hljs-keyword\">and</span> B) <span class=\"hljs-keyword\">and</span> (judgechildren(A,B) <span class=\"hljs-keyword\">or</span> self.isSubStructure(A.left,B) <span class=\"hljs-keyword\">or</span> self.isSubStructure(A.right,B))<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>bool(A and B)注意要转换为bool变量</p>\n</blockquote>\n<ul>\n<li>\n<p>时间复杂度为O(MN)</p>\n</li>\n<li>\n<p>空间复杂度 O(M)： 当树 A和树 B 都退化为链表时，递归调用深度最大。当 M≤N 时，遍历树 A 与递归判断的总递归深度为 M ；当 M&gt;N 时，最差情况为遍历至树 A叶子节点，此时总递归深度为 M。</p>\n</li>\n</ul>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>树的子结构</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入两棵二叉树A和B，判断B是不是A的子结构。(约定空树不是任意一个树的子结构)<br>\nB是A的子结构， 即 A中有出现和B相同的结构和节点值。</p>\n<p>例如:<br>\n给定的树 A:</p>\n<p>3<br>\n    / <br>\n   4   5<br>\n  / <br>\n 1   2<br>\n给定的树 B：</p>\n<p>4 <br>\n  /<br>\n 1<br>\n返回 true，因为 B 与 A 的一个子树拥有相同的结构和节点值。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">A</span> = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>], <span class=\"hljs-attr\">B</span> = [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">1</span>]<br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">A</span> = [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>], <span class=\"hljs-attr\">B</span> = [<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">1</span>]<br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 节点个数 &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>python代码真的！好！简洁！</p>\n<p><code>isSubStructure</code>的作用是先序查找A，B的匹配情况。而在内部会对匹配的<code>judgechildren(A,B)</code>进行判断，查看是否为其子结构。</p>\n<p>如果B为空了则表示匹配成功。如果根节点不匹配或者A为空了就直接返回失败。如果可以继续判断，就继续判断对应的左右子树。</p>\n<p><code>(judgechildren(A,B) or self.isSubStructure(A.left,B) or self.isSubStructure(A.right,B))</code> 判断AB两子树；先序判断左右子树，<code>注意这里是self.isSubStructure</code>进行递归哦~~</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isSubStructure</span>(<span class=\"hljs-params\">self, A: TreeNode, B: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">judgechildren</span>(<span class=\"hljs-params\">A,B</span>):</span> <span class=\"hljs-comment\">#判断以AB为根节点的条件下，B是否为A的子结构</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(B): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">not</span> A) <span class=\"hljs-keyword\">or</span> (A.val!=B.val): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>            <span class=\"hljs-keyword\">return</span> judgechildren(A.right,B.right) <span class=\"hljs-keyword\">and</span> judgechildren(A.left,B.left)<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">bool</span>(A <span class=\"hljs-keyword\">and</span> B) <span class=\"hljs-keyword\">and</span> (judgechildren(A,B) <span class=\"hljs-keyword\">or</span> self.isSubStructure(A.left,B) <span class=\"hljs-keyword\">or</span> self.isSubStructure(A.right,B))<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>bool(A and B)注意要转换为bool变量</p>\n</blockquote>\n<ul>\n<li>\n<p>时间复杂度为O(MN)</p>\n</li>\n<li>\n<p>空间复杂度 O(M)： 当树 A和树 B 都退化为链表时，递归调用深度最大。当 M≤N 时，遍历树 A 与递归判断的总递归深度为 M ；当 M&gt;N 时，最差情况为遍历至树 A叶子节点，此时总递归深度为 M。</p>\n</li>\n</ul>\n"},{"title":"剑指offer27 二叉树的镜像","date":"2021-08-16T13:01:18.000Z","_content":"\n>二叉树的镜像\n\n## 题目\n\n请完成一个函数，输入一个二叉树，该函数输出它的镜像。\n\n例如输入：\n\n​     4\n  2     7\n1   3  6   9\n镜像输出：\n\n​     4\n  7     2\n9   6 3   1\n\n### 示例 1：\n\n```\n输入：root = [4,2,7,1,3,6,9]\n输出：[4,7,2,9,6,3,1]\n```\n\n### 提示：\n\n- 0 <= 节点个数 <= 1000\n\n## 题解\n\n如果为空树就返回空。然后保存左子树，翻转右子树后赋值为左节点，翻转左子树赋值为右节点。\n\n**if not(root.left or root.right): return root #为单一节点就直接返回 可以省略，因为已经包含在内**\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def mirrorTree(self, root: TreeNode) -> TreeNode:\n        if not(root): return None\n        x = root.left\n        root.left = self.mirrorTree(root.right)\n        root.right = self.mirrorTree(x)\n        return root\n```\n\n","source":"_posts/leetcode/leetcode-offer27.md","raw":"---\ntitle: 剑指offer27 二叉树的镜像\ntags: [剑指,树]\ncategories: [剑指,树]\ndate: 2021-08-16 21:01:18\n---\n\n>二叉树的镜像\n\n## 题目\n\n请完成一个函数，输入一个二叉树，该函数输出它的镜像。\n\n例如输入：\n\n​     4\n  2     7\n1   3  6   9\n镜像输出：\n\n​     4\n  7     2\n9   6 3   1\n\n### 示例 1：\n\n```\n输入：root = [4,2,7,1,3,6,9]\n输出：[4,7,2,9,6,3,1]\n```\n\n### 提示：\n\n- 0 <= 节点个数 <= 1000\n\n## 题解\n\n如果为空树就返回空。然后保存左子树，翻转右子树后赋值为左节点，翻转左子树赋值为右节点。\n\n**if not(root.left or root.right): return root #为单一节点就直接返回 可以省略，因为已经包含在内**\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def mirrorTree(self, root: TreeNode) -> TreeNode:\n        if not(root): return None\n        x = root.left\n        root.left = self.mirrorTree(root.right)\n        root.right = self.mirrorTree(x)\n        return root\n```\n\n","slug":"leetcode/leetcode-offer27","published":1,"updated":"2022-01-18T08:10:17.080Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09n003kast9fyzp5hpo","content":"<blockquote>\n<p>二叉树的镜像</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请完成一个函数，输入一个二叉树，该函数输出它的镜像。</p>\n<p>例如输入：</p>\n<p>​     4<br>\n2     7<br>\n1   3  6   9<br>\n镜像输出：</p>\n<p>​     4<br>\n7     2<br>\n9   6 3   1</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight accesslog\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs accesslog\">输入：root = <span class=\"hljs-string\">[4,2,7,1,3,6,9]</span><br>输出：<span class=\"hljs-string\">[4,7,2,9,6,3,1]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 节点个数 &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>如果为空树就返回空。然后保存左子树，翻转右子树后赋值为左节点，翻转左子树赋值为右节点。</p>\n<p><strong>if not(root.left or root.right): return root #为单一节点就直接返回 可以省略，因为已经包含在内</strong></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">mirrorTree</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; TreeNode:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(root): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">None</span><br>        x = root.left<br>        root.left = self.mirrorTree(root.right)<br>        root.right = self.mirrorTree(x)<br>        <span class=\"hljs-keyword\">return</span> root<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>二叉树的镜像</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请完成一个函数，输入一个二叉树，该函数输出它的镜像。</p>\n<p>例如输入：</p>\n<p>​     4<br>\n2     7<br>\n1   3  6   9<br>\n镜像输出：</p>\n<p>​     4<br>\n7     2<br>\n9   6 3   1</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs accesslog\">输入：root = <span class=\"hljs-string\">[4,2,7,1,3,6,9]</span><br>输出：<span class=\"hljs-string\">[4,7,2,9,6,3,1]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 节点个数 &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>如果为空树就返回空。然后保存左子树，翻转右子树后赋值为左节点，翻转左子树赋值为右节点。</p>\n<p><strong>if not(root.left or root.right): return root #为单一节点就直接返回 可以省略，因为已经包含在内</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">mirrorTree</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; TreeNode:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(root): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">None</span><br>        x = root.left<br>        root.left = self.mirrorTree(root.right)<br>        root.right = self.mirrorTree(x)<br>        <span class=\"hljs-keyword\">return</span> root<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer30 包含min函数的栈","date":"2021-09-17T09:07:11.000Z","_content":"\n> 包含min函数的栈\n\n## 题目\n定义栈的数据结构，请在该类型中实现一个能够得到栈的最小元素的 min 函数在该栈中，调用 min、push 及 pop 的时间复杂度都是 O(1)。\n\n### 示例 1：\n\n```\nMinStack minStack = new MinStack();\nminStack.push(-2);\nminStack.push(0);\nminStack.push(-3);\nminStack.min();   --> 返回 -3.\nminStack.pop();\nminStack.top();      --> 返回 0.\nminStack.min();   --> 返回 -2.\n```\n\n\n### 提示：\n\n- 各函数的调用总次数不超过 20000 次\n\n## 题解\n\nemm这样子使用min函数，不太科学，时间复杂度为O(N)\n```python\nclass MinStack:\n\n    def __init__(self):\n        \"\"\"\n        initialize your data structure here.\n        \"\"\"\n        self.stack = []\n        self.minnum = sys.maxsize #float(\"inf\")\n\n    def push(self, x: int) -> None:\n        if(self.minnum>x): self.minnum = x\n        self.stack.append(x)\n\n    def pop(self) -> None:\n        item = self.top()\n        self.stack.pop()\n        if(len(self.stack) == 0): \n            self.minnum = sys.maxsize #float(\"inf\")\n        elif(item==self.minnum):\n            self.minnum = min(self.stack)\n    def top(self) -> int:\n        return self.stack[-1]\n\n    def min(self) -> int:\n        return self.minnum\n\n# Your MinStack object will be instantiated and called as such:\n# obj = MinStack()\n# obj.push(x)\n# obj.pop()\n# param_3 = obj.top()\n# param_4 = obj.min()\n```\n-实际上应该创建两个栈，一个作为普通的栈A记录数据，另一个B用于辅助栈min的实现；使得A中的最小元素始终对应于B的栈顶元素。**栈B的主要目的是记录最小值，所以不一定是需要所有完整的数据。**\n\n- 在调用push函数时，注意要维护好栈B，也就是说判断x时小于等于栈顶元素，才压入栈B；\n- 在调用pop函数时，要保持A，B元素的一致性，在A中pop的元素是B的栈顶元素就要同步删除掉栈B的栈顶元素；\n\n这种方式可以保证在删除掉A和B的栈顶元素（最小值）之后，B的栈顶元素依然还是A的最小值。\n\n嗯厉害~ o(*￣▽￣*)o\n\n```python\nclass MinStack:\n\n    def __init__(self):\n        \"\"\"\n        initialize your data structure here.\n        \"\"\"\n        self.A,self.B = [],[]\n\n    def push(self, x: int) -> None:\n\t\tself.A.append(x)\n        if not self.B or self.B[-1]>=x: #注意是大于等于，因为需要记录避免后续弹出导致元素不同步\n            self.B.append(x)\n\n    def pop(self) -> None:\n\t\tif(self.A.pop() == self.B[-1]): #如果是相同元素就注意同步删除\n            self.B.pop()\n    def top(self) -> int:\n        return self.A[-1]\n\n    def min(self) -> int:\n        return self.B[-1]\n```\n\n","source":"_posts/leetcode/leetcode-offer30.md","raw":"---\ntitle: 剑指offer30 包含min函数的栈\ntags: [剑指,栈]\ncategories: [剑指,栈]\ndate: 2021-09-17 17:07:11\n---\n\n> 包含min函数的栈\n\n## 题目\n定义栈的数据结构，请在该类型中实现一个能够得到栈的最小元素的 min 函数在该栈中，调用 min、push 及 pop 的时间复杂度都是 O(1)。\n\n### 示例 1：\n\n```\nMinStack minStack = new MinStack();\nminStack.push(-2);\nminStack.push(0);\nminStack.push(-3);\nminStack.min();   --> 返回 -3.\nminStack.pop();\nminStack.top();      --> 返回 0.\nminStack.min();   --> 返回 -2.\n```\n\n\n### 提示：\n\n- 各函数的调用总次数不超过 20000 次\n\n## 题解\n\nemm这样子使用min函数，不太科学，时间复杂度为O(N)\n```python\nclass MinStack:\n\n    def __init__(self):\n        \"\"\"\n        initialize your data structure here.\n        \"\"\"\n        self.stack = []\n        self.minnum = sys.maxsize #float(\"inf\")\n\n    def push(self, x: int) -> None:\n        if(self.minnum>x): self.minnum = x\n        self.stack.append(x)\n\n    def pop(self) -> None:\n        item = self.top()\n        self.stack.pop()\n        if(len(self.stack) == 0): \n            self.minnum = sys.maxsize #float(\"inf\")\n        elif(item==self.minnum):\n            self.minnum = min(self.stack)\n    def top(self) -> int:\n        return self.stack[-1]\n\n    def min(self) -> int:\n        return self.minnum\n\n# Your MinStack object will be instantiated and called as such:\n# obj = MinStack()\n# obj.push(x)\n# obj.pop()\n# param_3 = obj.top()\n# param_4 = obj.min()\n```\n-实际上应该创建两个栈，一个作为普通的栈A记录数据，另一个B用于辅助栈min的实现；使得A中的最小元素始终对应于B的栈顶元素。**栈B的主要目的是记录最小值，所以不一定是需要所有完整的数据。**\n\n- 在调用push函数时，注意要维护好栈B，也就是说判断x时小于等于栈顶元素，才压入栈B；\n- 在调用pop函数时，要保持A，B元素的一致性，在A中pop的元素是B的栈顶元素就要同步删除掉栈B的栈顶元素；\n\n这种方式可以保证在删除掉A和B的栈顶元素（最小值）之后，B的栈顶元素依然还是A的最小值。\n\n嗯厉害~ o(*￣▽￣*)o\n\n```python\nclass MinStack:\n\n    def __init__(self):\n        \"\"\"\n        initialize your data structure here.\n        \"\"\"\n        self.A,self.B = [],[]\n\n    def push(self, x: int) -> None:\n\t\tself.A.append(x)\n        if not self.B or self.B[-1]>=x: #注意是大于等于，因为需要记录避免后续弹出导致元素不同步\n            self.B.append(x)\n\n    def pop(self) -> None:\n\t\tif(self.A.pop() == self.B[-1]): #如果是相同元素就注意同步删除\n            self.B.pop()\n    def top(self) -> int:\n        return self.A[-1]\n\n    def min(self) -> int:\n        return self.B[-1]\n```\n\n","slug":"leetcode/leetcode-offer30","published":1,"updated":"2022-01-18T08:10:17.082Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09p003mast9bu10d12t","content":"<blockquote>\n<p>包含min函数的栈</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>定义栈的数据结构，请在该类型中实现一个能够得到栈的最小元素的 min 函数在该栈中，调用 min、push 及 pop 的时间复杂度都是 O(1)。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight pf\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs pf\">M<span class=\"hljs-keyword\">in</span>Stack <span class=\"hljs-keyword\">min</span>Stack = new M<span class=\"hljs-keyword\">in</span>Stack();<br><span class=\"hljs-keyword\">min</span>Stack.push(-<span class=\"hljs-number\">2</span>);<br><span class=\"hljs-keyword\">min</span>Stack.push(<span class=\"hljs-number\">0</span>);<br><span class=\"hljs-keyword\">min</span>Stack.push(-<span class=\"hljs-number\">3</span>);<br><span class=\"hljs-keyword\">min</span>Stack.<span class=\"hljs-keyword\">min</span>();   --&gt; 返回 -<span class=\"hljs-number\">3</span>.<br><span class=\"hljs-keyword\">min</span>Stack.pop();<br><span class=\"hljs-keyword\">min</span>Stack.top();      --&gt; 返回 <span class=\"hljs-number\">0</span>.<br><span class=\"hljs-keyword\">min</span>Stack.<span class=\"hljs-keyword\">min</span>();   --&gt; 返回 -<span class=\"hljs-number\">2</span>.<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>各函数的调用总次数不超过 20000 次</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>emm这样子使用min函数，不太科学，时间复杂度为O(N)</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MinStack</span>:</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\">        initialize your data structure here.</span><br><span class=\"hljs-string\">        \"\"\"</span><br>        self.stack = []<br>        self.minnum = sys.maxsize <span class=\"hljs-comment\">#float(\"inf\")</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">push</span>(<span class=\"hljs-params\">self, x: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-literal\">None</span>:</span><br>        <span class=\"hljs-keyword\">if</span>(self.minnum&gt;x): self.minnum = x<br>        self.stack.append(x)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">pop</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-literal\">None</span>:</span><br>        item = self.top()<br>        self.stack.pop()<br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(self.stack) == <span class=\"hljs-number\">0</span>): <br>            self.minnum = sys.maxsize <span class=\"hljs-comment\">#float(\"inf\")</span><br>        <span class=\"hljs-keyword\">elif</span>(item==self.minnum):<br>            self.minnum = <span class=\"hljs-built_in\">min</span>(self.stack)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">top</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">return</span> self.stack[-<span class=\"hljs-number\">1</span>]<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">min</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">return</span> self.minnum<br><br><span class=\"hljs-comment\"># Your MinStack object will be instantiated and called as such:</span><br><span class=\"hljs-comment\"># obj = MinStack()</span><br><span class=\"hljs-comment\"># obj.push(x)</span><br><span class=\"hljs-comment\"># obj.pop()</span><br><span class=\"hljs-comment\"># param_3 = obj.top()</span><br><span class=\"hljs-comment\"># param_4 = obj.min()</span><br></code></pre></td></tr></tbody></table></figure>\n<p>-实际上应该创建两个栈，一个作为普通的栈A记录数据，另一个B用于辅助栈min的实现；使得A中的最小元素始终对应于B的栈顶元素。<strong>栈B的主要目的是记录最小值，所以不一定是需要所有完整的数据。</strong></p>\n<ul>\n<li>在调用push函数时，注意要维护好栈B，也就是说判断x时小于等于栈顶元素，才压入栈B；</li>\n<li>在调用pop函数时，要保持A，B元素的一致性，在A中pop的元素是B的栈顶元素就要同步删除掉栈B的栈顶元素；</li>\n</ul>\n<p>这种方式可以保证在删除掉A和B的栈顶元素（最小值）之后，B的栈顶元素依然还是A的最小值。</p>\n<p>嗯厉害~ o(<em>￣▽￣</em>)o</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MinStack</span>:</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\">        initialize your data structure here.</span><br><span class=\"hljs-string\">        \"\"\"</span><br>        self.A,self.B = [],[]<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">push</span>(<span class=\"hljs-params\">self, x: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-literal\">None</span>:</span><br>\t\tself.A.append(x)<br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> self.B <span class=\"hljs-keyword\">or</span> self.B[-<span class=\"hljs-number\">1</span>]&gt;=x: <span class=\"hljs-comment\">#注意是大于等于，因为需要记录避免后续弹出导致元素不同步</span><br>            self.B.append(x)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">pop</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-literal\">None</span>:</span><br>\t\t<span class=\"hljs-keyword\">if</span>(self.A.pop() == self.B[-<span class=\"hljs-number\">1</span>]): <span class=\"hljs-comment\">#如果是相同元素就注意同步删除</span><br>            self.B.pop()<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">top</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">return</span> self.A[-<span class=\"hljs-number\">1</span>]<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">min</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">return</span> self.B[-<span class=\"hljs-number\">1</span>]<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>包含min函数的栈</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>定义栈的数据结构，请在该类型中实现一个能够得到栈的最小元素的 min 函数在该栈中，调用 min、push 及 pop 的时间复杂度都是 O(1)。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight pf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs pf\">M<span class=\"hljs-keyword\">in</span>Stack <span class=\"hljs-keyword\">min</span>Stack = new M<span class=\"hljs-keyword\">in</span>Stack();<br><span class=\"hljs-keyword\">min</span>Stack.push(-<span class=\"hljs-number\">2</span>);<br><span class=\"hljs-keyword\">min</span>Stack.push(<span class=\"hljs-number\">0</span>);<br><span class=\"hljs-keyword\">min</span>Stack.push(-<span class=\"hljs-number\">3</span>);<br><span class=\"hljs-keyword\">min</span>Stack.<span class=\"hljs-keyword\">min</span>();   --&gt; 返回 -<span class=\"hljs-number\">3</span>.<br><span class=\"hljs-keyword\">min</span>Stack.pop();<br><span class=\"hljs-keyword\">min</span>Stack.top();      --&gt; 返回 <span class=\"hljs-number\">0</span>.<br><span class=\"hljs-keyword\">min</span>Stack.<span class=\"hljs-keyword\">min</span>();   --&gt; 返回 -<span class=\"hljs-number\">2</span>.<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>各函数的调用总次数不超过 20000 次</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>emm这样子使用min函数，不太科学，时间复杂度为O(N)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MinStack</span>:</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">        initialize your data structure here.</span><br><span class=\"hljs-string\">        &quot;&quot;&quot;</span><br>        self.stack = []<br>        self.minnum = sys.maxsize <span class=\"hljs-comment\">#float(&quot;inf&quot;)</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">push</span>(<span class=\"hljs-params\">self, x: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-literal\">None</span>:</span><br>        <span class=\"hljs-keyword\">if</span>(self.minnum&gt;x): self.minnum = x<br>        self.stack.append(x)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">pop</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-literal\">None</span>:</span><br>        item = self.top()<br>        self.stack.pop()<br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(self.stack) == <span class=\"hljs-number\">0</span>): <br>            self.minnum = sys.maxsize <span class=\"hljs-comment\">#float(&quot;inf&quot;)</span><br>        <span class=\"hljs-keyword\">elif</span>(item==self.minnum):<br>            self.minnum = <span class=\"hljs-built_in\">min</span>(self.stack)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">top</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">return</span> self.stack[-<span class=\"hljs-number\">1</span>]<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">min</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">return</span> self.minnum<br><br><span class=\"hljs-comment\"># Your MinStack object will be instantiated and called as such:</span><br><span class=\"hljs-comment\"># obj = MinStack()</span><br><span class=\"hljs-comment\"># obj.push(x)</span><br><span class=\"hljs-comment\"># obj.pop()</span><br><span class=\"hljs-comment\"># param_3 = obj.top()</span><br><span class=\"hljs-comment\"># param_4 = obj.min()</span><br></code></pre></td></tr></table></figure>\n<p>-实际上应该创建两个栈，一个作为普通的栈A记录数据，另一个B用于辅助栈min的实现；使得A中的最小元素始终对应于B的栈顶元素。<strong>栈B的主要目的是记录最小值，所以不一定是需要所有完整的数据。</strong></p>\n<ul>\n<li>在调用push函数时，注意要维护好栈B，也就是说判断x时小于等于栈顶元素，才压入栈B；</li>\n<li>在调用pop函数时，要保持A，B元素的一致性，在A中pop的元素是B的栈顶元素就要同步删除掉栈B的栈顶元素；</li>\n</ul>\n<p>这种方式可以保证在删除掉A和B的栈顶元素（最小值）之后，B的栈顶元素依然还是A的最小值。</p>\n<p>嗯厉害~ o(<em>￣▽￣</em>)o</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MinStack</span>:</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">        initialize your data structure here.</span><br><span class=\"hljs-string\">        &quot;&quot;&quot;</span><br>        self.A,self.B = [],[]<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">push</span>(<span class=\"hljs-params\">self, x: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-literal\">None</span>:</span><br>\t\tself.A.append(x)<br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> self.B <span class=\"hljs-keyword\">or</span> self.B[-<span class=\"hljs-number\">1</span>]&gt;=x: <span class=\"hljs-comment\">#注意是大于等于，因为需要记录避免后续弹出导致元素不同步</span><br>            self.B.append(x)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">pop</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-literal\">None</span>:</span><br>\t\t<span class=\"hljs-keyword\">if</span>(self.A.pop() == self.B[-<span class=\"hljs-number\">1</span>]): <span class=\"hljs-comment\">#如果是相同元素就注意同步删除</span><br>            self.B.pop()<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">top</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">return</span> self.A[-<span class=\"hljs-number\">1</span>]<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">min</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">return</span> self.B[-<span class=\"hljs-number\">1</span>]<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer29 顺时针打印矩阵","date":"2021-08-19T13:00:34.000Z","math":true,"_content":"\n>  顺时针打印矩阵\n\n## 题目\n\n输入一个矩阵，按照从外向里以顺时针的顺序依次打印出每一个数字。\n\n### 示例 1：\n\n```\n输入：matrix = [[1,2,3],[4,5,6],[7,8,9]]\n输出：[1,2,3,6,9,8,7,4,5]\n```\n\n### 示例 2：\n\n```\n输入：matrix = [[1,2,3,4],[5,6,7,8],[9,10,11,12]]\n输出：[1,2,3,4,8,12,11,10,9,5,6,7]\n```\n\n### 提示：\n\n- `0 <= matrix.length <= 100`\n- `0 <= matrix[i].length <= 100`\n\n## 题解\n\n一种是对数组进行常规操作，安装题目要求进行遍历判断。\n\n```python\nclass Solution:\n    def spiralOrder(self, matrix: List[List[int]]) -> List[int]:\n        if not matrix: return []\n        l, r, t, b, res = 0, len(matrix[0]) - 1, 0, len(matrix) - 1, []\n        while True:\n            for i in range(l, r + 1): res.append(matrix[t][i]) # left to right\n            t += 1\n            if t > b: break\n            for i in range(t, b + 1): res.append(matrix[i][r]) # top to bottom\n            r -= 1\n            if l > r: break\n            for i in range(r, l - 1, -1): res.append(matrix[b][i]) # right to left\n            b -= 1\n            if t > b: break\n            for i in range(b, t - 1, -1): res.append(matrix[i][l]) # bottom to top\n            l += 1\n            if l > r: break\n        return res\n\n```\n第二种是采用相关的方法，`pop(0)`可以弹出第一个元素。使用$zip(*)$相当于对矩阵转置。`list(zip(*matrix))[::-1]`就是对矩阵逆旋转90度。zip和zip(*)也是一对逆操作；前者表示压缩，后者表示解压。\n```python\nclass Solution:\n    def spiralOrder(self, matrix: List[List[int]]) -> List[int]:\n        res = []\n        while matrix:\n            res += matrix.pop(0)\n            matrix = list(zip(*matrix))[::-1]\n        return res\n```\n\n> pop & zip知识参考\n>\n> https://blog.csdn.net/zhanshen112/article/details/90341177\n>\n> https://www.cnblogs.com/Aurora-Twinkle/p/8660778.html\n","source":"_posts/leetcode/leetcode-offer29.md","raw":"---\ntitle: 剑指offer29 顺时针打印矩阵\ntags: [剑指,数组]\ncategories: [剑指,数组]\ndate: 2021-08-19 21:00:34\nmath: true\n---\n\n>  顺时针打印矩阵\n\n## 题目\n\n输入一个矩阵，按照从外向里以顺时针的顺序依次打印出每一个数字。\n\n### 示例 1：\n\n```\n输入：matrix = [[1,2,3],[4,5,6],[7,8,9]]\n输出：[1,2,3,6,9,8,7,4,5]\n```\n\n### 示例 2：\n\n```\n输入：matrix = [[1,2,3,4],[5,6,7,8],[9,10,11,12]]\n输出：[1,2,3,4,8,12,11,10,9,5,6,7]\n```\n\n### 提示：\n\n- `0 <= matrix.length <= 100`\n- `0 <= matrix[i].length <= 100`\n\n## 题解\n\n一种是对数组进行常规操作，安装题目要求进行遍历判断。\n\n```python\nclass Solution:\n    def spiralOrder(self, matrix: List[List[int]]) -> List[int]:\n        if not matrix: return []\n        l, r, t, b, res = 0, len(matrix[0]) - 1, 0, len(matrix) - 1, []\n        while True:\n            for i in range(l, r + 1): res.append(matrix[t][i]) # left to right\n            t += 1\n            if t > b: break\n            for i in range(t, b + 1): res.append(matrix[i][r]) # top to bottom\n            r -= 1\n            if l > r: break\n            for i in range(r, l - 1, -1): res.append(matrix[b][i]) # right to left\n            b -= 1\n            if t > b: break\n            for i in range(b, t - 1, -1): res.append(matrix[i][l]) # bottom to top\n            l += 1\n            if l > r: break\n        return res\n\n```\n第二种是采用相关的方法，`pop(0)`可以弹出第一个元素。使用$zip(*)$相当于对矩阵转置。`list(zip(*matrix))[::-1]`就是对矩阵逆旋转90度。zip和zip(*)也是一对逆操作；前者表示压缩，后者表示解压。\n```python\nclass Solution:\n    def spiralOrder(self, matrix: List[List[int]]) -> List[int]:\n        res = []\n        while matrix:\n            res += matrix.pop(0)\n            matrix = list(zip(*matrix))[::-1]\n        return res\n```\n\n> pop & zip知识参考\n>\n> https://blog.csdn.net/zhanshen112/article/details/90341177\n>\n> https://www.cnblogs.com/Aurora-Twinkle/p/8660778.html\n","slug":"leetcode/leetcode-offer29","published":1,"updated":"2022-01-18T08:10:17.081Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09q003past97upfcl8g","content":"<blockquote>\n<p>顺时针打印矩阵</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个矩阵，按照从外向里以顺时针的顺序依次打印出每一个数字。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：matrix = <span class=\"hljs-comment\">[<span class=\"hljs-comment\">[1,2,3]</span>,<span class=\"hljs-comment\">[4,5,6]</span>,<span class=\"hljs-comment\">[7,8,9]</span>]</span><br>输出：<span class=\"hljs-comment\">[1,2,3,6,9,8,7,4,5]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight dns\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：matrix = [[<span class=\"hljs-number\">1,2,3,4</span>],[<span class=\"hljs-number\">5,6,7,8</span>],[<span class=\"hljs-number\">9,10,11,12</span>]]<br>输出：[<span class=\"hljs-number\">1,2,3,4</span>,<span class=\"hljs-number\">8,12,11,10</span>,<span class=\"hljs-number\">9,5,6,7</span>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>0 &lt;= matrix.length &lt;= 100</code></li>\n<li><code>0 &lt;= matrix[i].length &lt;= 100</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>一种是对数组进行常规操作，安装题目要求进行遍历判断。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">spiralOrder</span>(<span class=\"hljs-params\">self, matrix: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> matrix: <span class=\"hljs-keyword\">return</span> []<br>        l, r, t, b, res = <span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(matrix[<span class=\"hljs-number\">0</span>]) - <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(matrix) - <span class=\"hljs-number\">1</span>, []<br>        <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:<br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(l, r + <span class=\"hljs-number\">1</span>): res.append(matrix[t][i]) <span class=\"hljs-comment\"># left to right</span><br>            t += <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span> t &gt; b: <span class=\"hljs-keyword\">break</span><br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(t, b + <span class=\"hljs-number\">1</span>): res.append(matrix[i][r]) <span class=\"hljs-comment\"># top to bottom</span><br>            r -= <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span> l &gt; r: <span class=\"hljs-keyword\">break</span><br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(r, l - <span class=\"hljs-number\">1</span>, -<span class=\"hljs-number\">1</span>): res.append(matrix[b][i]) <span class=\"hljs-comment\"># right to left</span><br>            b -= <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span> t &gt; b: <span class=\"hljs-keyword\">break</span><br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(b, t - <span class=\"hljs-number\">1</span>, -<span class=\"hljs-number\">1</span>): res.append(matrix[i][l]) <span class=\"hljs-comment\"># bottom to top</span><br>            l += <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span> l &gt; r: <span class=\"hljs-keyword\">break</span><br>        <span class=\"hljs-keyword\">return</span> res<br><br></code></pre></td></tr></tbody></table></figure>\n<p>第二种是采用相关的方法，<code>pop(0)</code>可以弹出第一个元素。使用$zip(<em>)$相当于对矩阵转置。<code>list(zip(*matrix))[::-1]</code>就是对矩阵逆旋转90度。zip和zip(</em>)也是一对逆操作；前者表示压缩，后者表示解压。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">spiralOrder</span>(<span class=\"hljs-params\">self, matrix: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        res = []<br>        <span class=\"hljs-keyword\">while</span> matrix:<br>            res += matrix.pop(<span class=\"hljs-number\">0</span>)<br>            matrix = <span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">zip</span>(*matrix))[::-<span class=\"hljs-number\">1</span>]<br>        <span class=\"hljs-keyword\">return</span> res<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>pop &amp; zip知识参考</p>\n<p><a href=\"https://blog.csdn.net/zhanshen112/article/details/90341177\">https://blog.csdn.net/zhanshen112/article/details/90341177</a></p>\n<p><a href=\"https://www.cnblogs.com/Aurora-Twinkle/p/8660778.html\">https://www.cnblogs.com/Aurora-Twinkle/p/8660778.html</a></p>\n</blockquote>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>顺时针打印矩阵</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个矩阵，按照从外向里以顺时针的顺序依次打印出每一个数字。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：matrix = <span class=\"hljs-comment\">[<span class=\"hljs-comment\">[1,2,3]</span>,<span class=\"hljs-comment\">[4,5,6]</span>,<span class=\"hljs-comment\">[7,8,9]</span>]</span><br>输出：<span class=\"hljs-comment\">[1,2,3,6,9,8,7,4,5]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight dns\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：matrix = [[<span class=\"hljs-number\">1,2,3,4</span>],[<span class=\"hljs-number\">5,6,7,8</span>],[<span class=\"hljs-number\">9,10,11,12</span>]]<br>输出：[<span class=\"hljs-number\">1,2,3,4</span>,<span class=\"hljs-number\">8,12,11,10</span>,<span class=\"hljs-number\">9,5,6,7</span>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>0 &lt;= matrix.length &lt;= 100</code></li>\n<li><code>0 &lt;= matrix[i].length &lt;= 100</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>一种是对数组进行常规操作，安装题目要求进行遍历判断。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">spiralOrder</span>(<span class=\"hljs-params\">self, matrix: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> matrix: <span class=\"hljs-keyword\">return</span> []<br>        l, r, t, b, res = <span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(matrix[<span class=\"hljs-number\">0</span>]) - <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(matrix) - <span class=\"hljs-number\">1</span>, []<br>        <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:<br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(l, r + <span class=\"hljs-number\">1</span>): res.append(matrix[t][i]) <span class=\"hljs-comment\"># left to right</span><br>            t += <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span> t &gt; b: <span class=\"hljs-keyword\">break</span><br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(t, b + <span class=\"hljs-number\">1</span>): res.append(matrix[i][r]) <span class=\"hljs-comment\"># top to bottom</span><br>            r -= <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span> l &gt; r: <span class=\"hljs-keyword\">break</span><br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(r, l - <span class=\"hljs-number\">1</span>, -<span class=\"hljs-number\">1</span>): res.append(matrix[b][i]) <span class=\"hljs-comment\"># right to left</span><br>            b -= <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span> t &gt; b: <span class=\"hljs-keyword\">break</span><br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(b, t - <span class=\"hljs-number\">1</span>, -<span class=\"hljs-number\">1</span>): res.append(matrix[i][l]) <span class=\"hljs-comment\"># bottom to top</span><br>            l += <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span> l &gt; r: <span class=\"hljs-keyword\">break</span><br>        <span class=\"hljs-keyword\">return</span> res<br><br></code></pre></td></tr></table></figure>\n<p>第二种是采用相关的方法，<code>pop(0)</code>可以弹出第一个元素。使用$zip(<em>)$相当于对矩阵转置。<code>list(zip(*matrix))[::-1]</code>就是对矩阵逆旋转90度。zip和zip(</em>)也是一对逆操作；前者表示压缩，后者表示解压。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">spiralOrder</span>(<span class=\"hljs-params\">self, matrix: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        res = []<br>        <span class=\"hljs-keyword\">while</span> matrix:<br>            res += matrix.pop(<span class=\"hljs-number\">0</span>)<br>            matrix = <span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">zip</span>(*matrix))[::-<span class=\"hljs-number\">1</span>]<br>        <span class=\"hljs-keyword\">return</span> res<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>pop &amp; zip知识参考</p>\n<p><a href=\"https://blog.csdn.net/zhanshen112/article/details/90341177\">https://blog.csdn.net/zhanshen112/article/details/90341177</a></p>\n<p><a href=\"https://www.cnblogs.com/Aurora-Twinkle/p/8660778.html\">https://www.cnblogs.com/Aurora-Twinkle/p/8660778.html</a></p>\n</blockquote>\n"},{"title":"剑指offer28 对称的二叉树","date":"2021-08-18T09:58:39.000Z","_content":"\n>对称的二叉树\n\n## 题目\n请实现一个函数，用来判断一棵二叉树是不是对称的。如果一棵二叉树和它的镜像一样，那么它是对称的。\n\n例如，二叉树 [1,2,2,3,4,4,3] 是对称的。\n\n    1\n   / \\\n  2   2\n / \\ / \\\n3  4 4  3\n但是下面这个 [1,2,2,null,3,null,3] 则不是镜像对称的:\n\n    1\n   / \\\n  2   2\n   \\   \\\n   3    3\n\n### 示例 1：\n\n```\n输入：root = [1,2,2,3,4,4,3]\n输出：true\n```\n\n### 示例 2：\n\n```\n输入：root = [1,2,2,null,3,null,3]\n输出：false\n```\n\n### 提示：\n\n- 0 <= 节点个数 <= 1000\n\n## 题解\n\n如果root为空就直接返回True，然后判断其左右子树是否为镜像结构。如果两个子节点为空则为真，如果一空则为假，然后分别判断其对称结构。 `judge(A.left,B.right) and judge(A.right,B.left)` 注意是镜像因此左右时相反的呢\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def isSymmetric(self, root: TreeNode) -> bool:\n        if not root: return True\n        def judge(A,B):\n            if not (A or B): return True\n            if not (A and B) or (A.val!=B.val): return False\n            return judge(A.left,B.right) and judge(A.right,B.left) \n        return judge(root.left,root.right)\n```\n\n","source":"_posts/leetcode/leetcode-offer28.md","raw":"---\ntitle: 剑指offer28 对称的二叉树\ntags: [剑指,树]\ncategories: [剑指,树]\ndate: 2021-08-18 17:58:39\n---\n\n>对称的二叉树\n\n## 题目\n请实现一个函数，用来判断一棵二叉树是不是对称的。如果一棵二叉树和它的镜像一样，那么它是对称的。\n\n例如，二叉树 [1,2,2,3,4,4,3] 是对称的。\n\n    1\n   / \\\n  2   2\n / \\ / \\\n3  4 4  3\n但是下面这个 [1,2,2,null,3,null,3] 则不是镜像对称的:\n\n    1\n   / \\\n  2   2\n   \\   \\\n   3    3\n\n### 示例 1：\n\n```\n输入：root = [1,2,2,3,4,4,3]\n输出：true\n```\n\n### 示例 2：\n\n```\n输入：root = [1,2,2,null,3,null,3]\n输出：false\n```\n\n### 提示：\n\n- 0 <= 节点个数 <= 1000\n\n## 题解\n\n如果root为空就直接返回True，然后判断其左右子树是否为镜像结构。如果两个子节点为空则为真，如果一空则为假，然后分别判断其对称结构。 `judge(A.left,B.right) and judge(A.right,B.left)` 注意是镜像因此左右时相反的呢\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def isSymmetric(self, root: TreeNode) -> bool:\n        if not root: return True\n        def judge(A,B):\n            if not (A or B): return True\n            if not (A and B) or (A.val!=B.val): return False\n            return judge(A.left,B.right) and judge(A.right,B.left) \n        return judge(root.left,root.right)\n```\n\n","slug":"leetcode/leetcode-offer28","published":1,"updated":"2022-01-18T08:10:17.081Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09s003rast95vl5a85w","content":"<blockquote>\n<p>对称的二叉树</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现一个函数，用来判断一棵二叉树是不是对称的。如果一棵二叉树和它的镜像一样，那么它是对称的。</p>\n<p>例如，二叉树&nbsp;[1,2,2,3,4,4,3] 是对称的。</p>\n<p>1<br>\n&nbsp; &nbsp;/ <br>\n&nbsp; 2 &nbsp; 2<br>\n&nbsp;/ \\ / <br>\n3 &nbsp;4 4 &nbsp;3<br>\n但是下面这个&nbsp;[1,2,2,null,3,null,3] 则不是镜像对称的:</p>\n<p>1<br>\n&nbsp; &nbsp;/ <br>\n&nbsp; 2 &nbsp; 2<br>\n&nbsp; &nbsp;\\ &nbsp; <br>\n&nbsp; &nbsp;3 &nbsp; &nbsp;3</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">root</span> = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">3</span>]<br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">root</span> = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-number\">3</span>]<br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 节点个数 &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>如果root为空就直接返回True，然后判断其左右子树是否为镜像结构。如果两个子节点为空则为真，如果一空则为假，然后分别判断其对称结构。 <code>judge(A.left,B.right) and judge(A.right,B.left)</code> 注意是镜像因此左右时相反的呢</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isSymmetric</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">judge</span>(<span class=\"hljs-params\">A,B</span>):</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> (A <span class=\"hljs-keyword\">or</span> B): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> (A <span class=\"hljs-keyword\">and</span> B) <span class=\"hljs-keyword\">or</span> (A.val!=B.val): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>            <span class=\"hljs-keyword\">return</span> judge(A.left,B.right) <span class=\"hljs-keyword\">and</span> judge(A.right,B.left) <br>        <span class=\"hljs-keyword\">return</span> judge(root.left,root.right)<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>对称的二叉树</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现一个函数，用来判断一棵二叉树是不是对称的。如果一棵二叉树和它的镜像一样，那么它是对称的。</p>\n<p>例如，二叉树 [1,2,2,3,4,4,3] 是对称的。</p>\n<p>1<br>\n   / <br>\n  2   2<br>\n / \\ / <br>\n3  4 4  3<br>\n但是下面这个 [1,2,2,null,3,null,3] 则不是镜像对称的:</p>\n<p>1<br>\n   / <br>\n  2   2<br>\n   \\   <br>\n   3    3</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">root</span> = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">3</span>]<br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">root</span> = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-number\">3</span>]<br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= 节点个数 &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>如果root为空就直接返回True，然后判断其左右子树是否为镜像结构。如果两个子节点为空则为真，如果一空则为假，然后分别判断其对称结构。 <code>judge(A.left,B.right) and judge(A.right,B.left)</code> 注意是镜像因此左右时相反的呢</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isSymmetric</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">judge</span>(<span class=\"hljs-params\">A,B</span>):</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> (A <span class=\"hljs-keyword\">or</span> B): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> (A <span class=\"hljs-keyword\">and</span> B) <span class=\"hljs-keyword\">or</span> (A.val!=B.val): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>            <span class=\"hljs-keyword\">return</span> judge(A.left,B.right) <span class=\"hljs-keyword\">and</span> judge(A.right,B.left) <br>        <span class=\"hljs-keyword\">return</span> judge(root.left,root.right)<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer31 栈的压入，弹出序列","date":"2021-11-19T02:28:15.000Z","_content":"\n>栈的压入，弹出序列\n\n## 题目\n\n输入两个整数序列，第一个序列表示栈的压入顺序，请判断第二个序列是否为该栈的弹出顺序。假设压入栈的所有数字均不相等。例如，序列 {1,2,3,4,5} 是某栈的压栈序列，序列 {4,5,3,2,1} 是该压栈序列对应的一个弹出序列，但 {4,3,5,1,2} 就不可能是该压栈序列的弹出序列。\n\n### 示例 1：\n\n```\n输入：pushed = [1,2,3,4,5], popped = [4,5,3,2,1]\n输出：true\n解释：我们可以按以下顺序执行：\npush(1), push(2), push(3), push(4), pop() -> 4,\npush(5), pop() -> 5, pop() -> 3, pop() -> 2, pop() -> 1\n```\n\n### 示例 2：\n\n```\n输入：pushed = [1,2,3,4,5], popped = [4,3,5,1,2]\n输出：false\n解释：1 不能在 2 之前弹出。\n```\n\n### 提示：\n\n- 0 <= pushed.length == popped.length <= 1000\n- 0 <= pushed[i], popped[i] < 1000\n- pushed 是 popped 的排列。\n\n## 题解\n\n按照压入和弹出序列可以双向唯一确定栈的压入弹出的顺序，所以按照对应的此序列，可以模拟压出和弹出的场景，最终如果可以成立，那么栈中的数据应该全部弹出了。\n具体的做法就是按照压入序列的顺序，每压入一个数值，就比对弹出序列的值，查看是否可以弹出，等到压入的数值都处理完成，查看栈是否为空，如果不是空就说明弹出序列时不能匹配的。\n\n```python\nclass Solution:\n    def validateStackSequences(self, pushed: List[int], popped: List[int]) -> bool:\n        #模拟场景\n        stack = []\n        i = 0\n        j = 0\n        while(i<len(pushed)):\n            stack.append(pushed[i])\n            while(len(stack) and stack[len(stack)-1]==popped[j]):\n                j += 1\n                stack.pop()\n            i += 1\n        return not stack\n```\n\n","source":"_posts/leetcode/leetcode-offer31.md","raw":"---\ntitle: 剑指offer31 栈的压入，弹出序列\ntags: [剑指,栈]\ncategories: [剑指,栈]\ndate: 2021-11-19 10:28:15\n---\n\n>栈的压入，弹出序列\n\n## 题目\n\n输入两个整数序列，第一个序列表示栈的压入顺序，请判断第二个序列是否为该栈的弹出顺序。假设压入栈的所有数字均不相等。例如，序列 {1,2,3,4,5} 是某栈的压栈序列，序列 {4,5,3,2,1} 是该压栈序列对应的一个弹出序列，但 {4,3,5,1,2} 就不可能是该压栈序列的弹出序列。\n\n### 示例 1：\n\n```\n输入：pushed = [1,2,3,4,5], popped = [4,5,3,2,1]\n输出：true\n解释：我们可以按以下顺序执行：\npush(1), push(2), push(3), push(4), pop() -> 4,\npush(5), pop() -> 5, pop() -> 3, pop() -> 2, pop() -> 1\n```\n\n### 示例 2：\n\n```\n输入：pushed = [1,2,3,4,5], popped = [4,3,5,1,2]\n输出：false\n解释：1 不能在 2 之前弹出。\n```\n\n### 提示：\n\n- 0 <= pushed.length == popped.length <= 1000\n- 0 <= pushed[i], popped[i] < 1000\n- pushed 是 popped 的排列。\n\n## 题解\n\n按照压入和弹出序列可以双向唯一确定栈的压入弹出的顺序，所以按照对应的此序列，可以模拟压出和弹出的场景，最终如果可以成立，那么栈中的数据应该全部弹出了。\n具体的做法就是按照压入序列的顺序，每压入一个数值，就比对弹出序列的值，查看是否可以弹出，等到压入的数值都处理完成，查看栈是否为空，如果不是空就说明弹出序列时不能匹配的。\n\n```python\nclass Solution:\n    def validateStackSequences(self, pushed: List[int], popped: List[int]) -> bool:\n        #模拟场景\n        stack = []\n        i = 0\n        j = 0\n        while(i<len(pushed)):\n            stack.append(pushed[i])\n            while(len(stack) and stack[len(stack)-1]==popped[j]):\n                j += 1\n                stack.pop()\n            i += 1\n        return not stack\n```\n\n","slug":"leetcode/leetcode-offer31","published":1,"updated":"2022-01-18T08:10:17.083Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09t003tast92g1p1a8o","content":"<blockquote>\n<p>栈的压入，弹出序列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入两个整数序列，第一个序列表示栈的压入顺序，请判断第二个序列是否为该栈的弹出顺序。假设压入栈的所有数字均不相等。例如，序列 {1,2,3,4,5} 是某栈的压栈序列，序列 {4,5,3,2,1} 是该压栈序列对应的一个弹出序列，但 {4,3,5,1,2} 就不可能是该压栈序列的弹出序列。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight livescript\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\">输入：pushed = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>], popped = [<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">1</span>]<br>输出：<span class=\"hljs-literal\">true</span><br>解释：我们可以按以下顺序执行：<br>push<span class=\"hljs-function\"><span class=\"hljs-params\">(<span class=\"hljs-number\">1</span>)</span>, <span class=\"hljs-title\">push</span><span class=\"hljs-params\">(<span class=\"hljs-number\">2</span>)</span>, <span class=\"hljs-title\">push</span><span class=\"hljs-params\">(<span class=\"hljs-number\">3</span>)</span>, <span class=\"hljs-title\">push</span><span class=\"hljs-params\">(<span class=\"hljs-number\">4</span>)</span>, <span class=\"hljs-title\">pop</span><span class=\"hljs-params\">()</span> -&gt;</span> <span class=\"hljs-number\">4</span>,<br>push<span class=\"hljs-function\"><span class=\"hljs-params\">(<span class=\"hljs-number\">5</span>)</span>, <span class=\"hljs-title\">pop</span><span class=\"hljs-params\">()</span> -&gt;</span> <span class=\"hljs-number\">5</span>, pop<span class=\"hljs-function\"><span class=\"hljs-params\">()</span> -&gt;</span> <span class=\"hljs-number\">3</span>, pop<span class=\"hljs-function\"><span class=\"hljs-params\">()</span> -&gt;</span> <span class=\"hljs-number\">2</span>, pop<span class=\"hljs-function\"><span class=\"hljs-params\">()</span> -&gt;</span> <span class=\"hljs-number\">1</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">pushed</span> = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>], <span class=\"hljs-attr\">popped</span> = [<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>]<br>输出：<span class=\"hljs-literal\">false</span><br>解释：<span class=\"hljs-number\">1</span> 不能在 <span class=\"hljs-number\">2</span> 之前弹出。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= pushed.length == popped.length &lt;= 1000</li>\n<li>0 &lt;= pushed[i], popped[i] &lt; 1000</li>\n<li>pushed&nbsp;是&nbsp;popped&nbsp;的排列。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>按照压入和弹出序列可以双向唯一确定栈的压入弹出的顺序，所以按照对应的此序列，可以模拟压出和弹出的场景，最终如果可以成立，那么栈中的数据应该全部弹出了。<br>\n具体的做法就是按照压入序列的顺序，每压入一个数值，就比对弹出序列的值，查看是否可以弹出，等到压入的数值都处理完成，查看栈是否为空，如果不是空就说明弹出序列时不能匹配的。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">validateStackSequences</span>(<span class=\"hljs-params\">self, pushed: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], popped: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-comment\">#模拟场景</span><br>        stack = []<br>        i = <span class=\"hljs-number\">0</span><br>        j = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">while</span>(i&lt;<span class=\"hljs-built_in\">len</span>(pushed)):<br>            stack.append(pushed[i])<br>            <span class=\"hljs-keyword\">while</span>(<span class=\"hljs-built_in\">len</span>(stack) <span class=\"hljs-keyword\">and</span> stack[<span class=\"hljs-built_in\">len</span>(stack)-<span class=\"hljs-number\">1</span>]==popped[j]):<br>                j += <span class=\"hljs-number\">1</span><br>                stack.pop()<br>            i += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">not</span> stack<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>栈的压入，弹出序列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入两个整数序列，第一个序列表示栈的压入顺序，请判断第二个序列是否为该栈的弹出顺序。假设压入栈的所有数字均不相等。例如，序列 {1,2,3,4,5} 是某栈的压栈序列，序列 {4,5,3,2,1} 是该压栈序列对应的一个弹出序列，但 {4,3,5,1,2} 就不可能是该压栈序列的弹出序列。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight livescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\">输入：pushed = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>], popped = [<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">1</span>]<br>输出：<span class=\"hljs-literal\">true</span><br>解释：我们可以按以下顺序执行：<br>push<span class=\"hljs-function\"><span class=\"hljs-params\">(<span class=\"hljs-number\">1</span>)</span>, <span class=\"hljs-title\">push</span><span class=\"hljs-params\">(<span class=\"hljs-number\">2</span>)</span>, <span class=\"hljs-title\">push</span><span class=\"hljs-params\">(<span class=\"hljs-number\">3</span>)</span>, <span class=\"hljs-title\">push</span><span class=\"hljs-params\">(<span class=\"hljs-number\">4</span>)</span>, <span class=\"hljs-title\">pop</span><span class=\"hljs-params\">()</span> -&gt;</span> <span class=\"hljs-number\">4</span>,<br>push<span class=\"hljs-function\"><span class=\"hljs-params\">(<span class=\"hljs-number\">5</span>)</span>, <span class=\"hljs-title\">pop</span><span class=\"hljs-params\">()</span> -&gt;</span> <span class=\"hljs-number\">5</span>, pop<span class=\"hljs-function\"><span class=\"hljs-params\">()</span> -&gt;</span> <span class=\"hljs-number\">3</span>, pop<span class=\"hljs-function\"><span class=\"hljs-params\">()</span> -&gt;</span> <span class=\"hljs-number\">2</span>, pop<span class=\"hljs-function\"><span class=\"hljs-params\">()</span> -&gt;</span> <span class=\"hljs-number\">1</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">pushed</span> = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>], <span class=\"hljs-attr\">popped</span> = [<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>]<br>输出：<span class=\"hljs-literal\">false</span><br>解释：<span class=\"hljs-number\">1</span> 不能在 <span class=\"hljs-number\">2</span> 之前弹出。<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= pushed.length == popped.length &lt;= 1000</li>\n<li>0 &lt;= pushed[i], popped[i] &lt; 1000</li>\n<li>pushed 是 popped 的排列。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>按照压入和弹出序列可以双向唯一确定栈的压入弹出的顺序，所以按照对应的此序列，可以模拟压出和弹出的场景，最终如果可以成立，那么栈中的数据应该全部弹出了。<br>\n具体的做法就是按照压入序列的顺序，每压入一个数值，就比对弹出序列的值，查看是否可以弹出，等到压入的数值都处理完成，查看栈是否为空，如果不是空就说明弹出序列时不能匹配的。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">validateStackSequences</span>(<span class=\"hljs-params\">self, pushed: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], popped: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-comment\">#模拟场景</span><br>        stack = []<br>        i = <span class=\"hljs-number\">0</span><br>        j = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">while</span>(i&lt;<span class=\"hljs-built_in\">len</span>(pushed)):<br>            stack.append(pushed[i])<br>            <span class=\"hljs-keyword\">while</span>(<span class=\"hljs-built_in\">len</span>(stack) <span class=\"hljs-keyword\">and</span> stack[<span class=\"hljs-built_in\">len</span>(stack)-<span class=\"hljs-number\">1</span>]==popped[j]):<br>                j += <span class=\"hljs-number\">1</span><br>                stack.pop()<br>            i += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">not</span> stack<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer32-1 从上到下打印二叉树","date":"2021-11-21T09:39:52.000Z","_content":"\n>\n\n## 题目\n\n从上到下打印出二叉树的每个节点，同一层的节点按照从左到右的顺序打印。\n\n### 示例 1：\n\n```\n例如:\n给定二叉树: [3,9,20,null,null,15,7],\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n 返回：  \n   [3,9,20,15,7]\n```\n\n### 提示：\n\n- 节点总数 <= 1000\n\n## 题解\n\n常规的层序遍历\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def levelOrder(self, root: TreeNode) -> List[int]:\n        if not root:return []\n        queue = deque()\n        result = []\n        queue.append(root)\n        while(queue):\n            top = queue.popleft()\n            result.append(top.val)\n            if top.left:queue.append(top.left)\n            if top.right:queue.append(top.right)\n        return result\n\n#如果按照层数来打印，那么记录每次的queue长度（本层长度），按照现有队列中的元素来（本层）压入后续元素（下一层）。就可以分层次打印\n```\n\n","source":"_posts/leetcode/leetcode-offer32-1.md","raw":"---\ntitle: 剑指offer32-1 从上到下打印二叉树\ntags: 剑指\ncategories: 剑指\ndate: 2021-11-21 17:39:52\n---\n\n>\n\n## 题目\n\n从上到下打印出二叉树的每个节点，同一层的节点按照从左到右的顺序打印。\n\n### 示例 1：\n\n```\n例如:\n给定二叉树: [3,9,20,null,null,15,7],\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n 返回：  \n   [3,9,20,15,7]\n```\n\n### 提示：\n\n- 节点总数 <= 1000\n\n## 题解\n\n常规的层序遍历\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def levelOrder(self, root: TreeNode) -> List[int]:\n        if not root:return []\n        queue = deque()\n        result = []\n        queue.append(root)\n        while(queue):\n            top = queue.popleft()\n            result.append(top.val)\n            if top.left:queue.append(top.left)\n            if top.right:queue.append(top.right)\n        return result\n\n#如果按照层数来打印，那么记录每次的queue长度（本层长度），按照现有队列中的元素来（本层）压入后续元素（下一层）。就可以分层次打印\n```\n\n","slug":"leetcode/leetcode-offer32-1","published":1,"updated":"2022-01-18T08:10:17.083Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p09z003vast982u1fnx1","content":"<blockquote></blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>从上到下打印出二叉树的每个节点，同一层的节点按照从左到右的顺序打印。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight livescript\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\">例如:<br>给定二叉树: [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>],<br>    <span class=\"hljs-number\">3</span><br>   / <span class=\"hljs-string\">\\</span><br>  <span class=\"hljs-number\">9</span>  <span class=\"hljs-number\">20</span><br>    /  <span class=\"hljs-string\">\\</span><br>   <span class=\"hljs-number\">15</span>   <span class=\"hljs-number\">7</span><br> 返回：  <br>   [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>节点总数 &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>常规的层序遍历</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">levelOrder</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root:<span class=\"hljs-keyword\">return</span> []<br>        queue = deque()<br>        result = []<br>        queue.append(root)<br>        <span class=\"hljs-keyword\">while</span>(queue):<br>            top = queue.popleft()<br>            result.append(top.val)<br>            <span class=\"hljs-keyword\">if</span> top.left:queue.append(top.left)<br>            <span class=\"hljs-keyword\">if</span> top.right:queue.append(top.right)<br>        <span class=\"hljs-keyword\">return</span> result<br><br><span class=\"hljs-comment\">#如果按照层数来打印，那么记录每次的queue长度（本层长度），按照现有队列中的元素来（本层）压入后续元素（下一层）。就可以分层次打印</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote></blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>从上到下打印出二叉树的每个节点，同一层的节点按照从左到右的顺序打印。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight livescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\">例如:<br>给定二叉树: [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>],<br>    <span class=\"hljs-number\">3</span><br>   / <span class=\"hljs-string\">\\</span><br>  <span class=\"hljs-number\">9</span>  <span class=\"hljs-number\">20</span><br>    /  <span class=\"hljs-string\">\\</span><br>   <span class=\"hljs-number\">15</span>   <span class=\"hljs-number\">7</span><br> 返回：  <br>   [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>节点总数 &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>常规的层序遍历</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">levelOrder</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root:<span class=\"hljs-keyword\">return</span> []<br>        queue = deque()<br>        result = []<br>        queue.append(root)<br>        <span class=\"hljs-keyword\">while</span>(queue):<br>            top = queue.popleft()<br>            result.append(top.val)<br>            <span class=\"hljs-keyword\">if</span> top.left:queue.append(top.left)<br>            <span class=\"hljs-keyword\">if</span> top.right:queue.append(top.right)<br>        <span class=\"hljs-keyword\">return</span> result<br><br><span class=\"hljs-comment\">#如果按照层数来打印，那么记录每次的queue长度（本层长度），按照现有队列中的元素来（本层）压入后续元素（下一层）。就可以分层次打印</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer32-3 从上到下打印二叉树 Ⅲ","date":"2021-11-22T12:15:15.000Z","_content":"\n>从上到下打印二叉树 Ⅲ\n\n## 题目\n\n请实现一个函数按照之字形顺序打印二叉树，即第一行按照从左到右的顺序打印，第二层按照从右到左的顺序打印，第三行再按照从左到右的顺序打印，其他行以此类推。\n\n### 示例 1：\n\n例如:\n给定二叉树: `[3,9,20,null,null,15,7]`,\n\n```\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n\n返回其层次遍历结果：\n\n```\n[\n  [3],\n  [20,9],\n  [15,7]\n]\n```\n\n### 提示：\n\n- `节点总数 <= 1000`\n\n## 题解\n\n#### 解法一\n\n记录本层的数字个数，将本层的元素全部弹出到列表中，同时将下层元素压进队列中；只是要根据flag，来将列表倒序 。\n\n> 列表倒叙的方法：\n>\n> 1，temp.reverse()  直接原地修改哦~\n>\n> 2，temp = temp[::-1]\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def levelOrder(self, root: TreeNode) -> List[List[int]]:\n        if(not root):return []\n        queue ,result,flag = deque(),[],False\n        queue.append(root)\n        while(queue):\n            tmp = []\n            num = len(queue)\n            for i in range(num):\n                top = queue.popleft()\n                tmp.append(top.val)\n                if(top.left): queue.append(top.left)\n                if(top.right): queue.append(top.right)\n            if flag: tmp = tmp[::-1] #tmp.reverse() # tmp = tmp[::-1]\n            flag = not flag\n            result.append(list(tmp))\n        return result\n```\n\n#### 解法二\n\n去掉倒叙的操作，根据flag的值更改tmp的插入方向，将tmp声明为`deque()`，右插为`append`,左插为`appendleft`；\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def levelOrder(self, root: TreeNode) -> List[List[int]]:\n        if(not root):return []\n        queue ,result,flag = deque(),[],False\n        queue.append(root)\n        while(queue):\n            tmp = deque()\n            num = len(queue)\n            for i in range(num):\n                top = queue.popleft()\n                if flag: tmp.appendleft(top.val)\n                else:tmp.append(top.val)\n                if(top.left): queue.append(top.left)\n                if(top.right): queue.append(top.right)\n            flag = not flag\n            result.append(list(tmp))\n        return result\n```\n\n","source":"_posts/leetcode/leetcode-offer32-3.md","raw":"---\ntitle: 剑指offer32-3 从上到下打印二叉树 Ⅲ\ntags: [剑指,树]\ncategories: [剑指,树]\ndate: 2021-11-22 20:15:15\n---\n\n>从上到下打印二叉树 Ⅲ\n\n## 题目\n\n请实现一个函数按照之字形顺序打印二叉树，即第一行按照从左到右的顺序打印，第二层按照从右到左的顺序打印，第三行再按照从左到右的顺序打印，其他行以此类推。\n\n### 示例 1：\n\n例如:\n给定二叉树: `[3,9,20,null,null,15,7]`,\n\n```\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n\n返回其层次遍历结果：\n\n```\n[\n  [3],\n  [20,9],\n  [15,7]\n]\n```\n\n### 提示：\n\n- `节点总数 <= 1000`\n\n## 题解\n\n#### 解法一\n\n记录本层的数字个数，将本层的元素全部弹出到列表中，同时将下层元素压进队列中；只是要根据flag，来将列表倒序 。\n\n> 列表倒叙的方法：\n>\n> 1，temp.reverse()  直接原地修改哦~\n>\n> 2，temp = temp[::-1]\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def levelOrder(self, root: TreeNode) -> List[List[int]]:\n        if(not root):return []\n        queue ,result,flag = deque(),[],False\n        queue.append(root)\n        while(queue):\n            tmp = []\n            num = len(queue)\n            for i in range(num):\n                top = queue.popleft()\n                tmp.append(top.val)\n                if(top.left): queue.append(top.left)\n                if(top.right): queue.append(top.right)\n            if flag: tmp = tmp[::-1] #tmp.reverse() # tmp = tmp[::-1]\n            flag = not flag\n            result.append(list(tmp))\n        return result\n```\n\n#### 解法二\n\n去掉倒叙的操作，根据flag的值更改tmp的插入方向，将tmp声明为`deque()`，右插为`append`,左插为`appendleft`；\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def levelOrder(self, root: TreeNode) -> List[List[int]]:\n        if(not root):return []\n        queue ,result,flag = deque(),[],False\n        queue.append(root)\n        while(queue):\n            tmp = deque()\n            num = len(queue)\n            for i in range(num):\n                top = queue.popleft()\n                if flag: tmp.appendleft(top.val)\n                else:tmp.append(top.val)\n                if(top.left): queue.append(top.left)\n                if(top.right): queue.append(top.right)\n            flag = not flag\n            result.append(list(tmp))\n        return result\n```\n\n","slug":"leetcode/leetcode-offer32-3","published":1,"updated":"2022-01-18T08:10:17.084Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0a2003zast90iz90bfo","content":"<blockquote>\n<p>从上到下打印二叉树 Ⅲ</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现一个函数按照之字形顺序打印二叉树，即第一行按照从左到右的顺序打印，第二层按照从右到左的顺序打印，第三行再按照从左到右的顺序打印，其他行以此类推。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p>例如:<br>\n给定二叉树: <code>[3,9,20,null,null,15,7]</code>,</p>\n<figure class=\"highlight livescript\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\">  <span class=\"hljs-number\">3</span><br> / <span class=\"hljs-string\">\\</span><br><span class=\"hljs-number\">9</span>  <span class=\"hljs-number\">20</span><br>  /  <span class=\"hljs-string\">\\</span><br> <span class=\"hljs-number\">15</span>   <span class=\"hljs-number\">7</span><br></code></pre></td></tr></tbody></table></figure>\n<p>返回其层次遍历结果：</p>\n<figure class=\"highlight json\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">[<br>  [<span class=\"hljs-number\">3</span>],<br>  [<span class=\"hljs-number\">20</span>,<span class=\"hljs-number\">9</span>],<br>  [<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>]<br>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>节点总数 &lt;= 1000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h4 id=\"解法一\">解法一</h4>\n<p>记录本层的数字个数，将本层的元素全部弹出到列表中，同时将下层元素压进队列中；只是要根据flag，来将列表倒序 。</p>\n<blockquote>\n<p>列表倒叙的方法：</p>\n<p>1，temp.reverse()  直接原地修改哦~</p>\n<p>2，temp = temp[::-1]</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">levelOrder</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root):<span class=\"hljs-keyword\">return</span> []<br>        queue ,result,flag = deque(),[],<span class=\"hljs-literal\">False</span><br>        queue.append(root)<br>        <span class=\"hljs-keyword\">while</span>(queue):<br>            tmp = []<br>            num = <span class=\"hljs-built_in\">len</span>(queue)<br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(num):<br>                top = queue.popleft()<br>                tmp.append(top.val)<br>                <span class=\"hljs-keyword\">if</span>(top.left): queue.append(top.left)<br>                <span class=\"hljs-keyword\">if</span>(top.right): queue.append(top.right)<br>            <span class=\"hljs-keyword\">if</span> flag: tmp = tmp[::-<span class=\"hljs-number\">1</span>] <span class=\"hljs-comment\">#tmp.reverse() # tmp = tmp[::-1]</span><br>            flag = <span class=\"hljs-keyword\">not</span> flag<br>            result.append(<span class=\"hljs-built_in\">list</span>(tmp))<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"解法二\">解法二</h4>\n<p>去掉倒叙的操作，根据flag的值更改tmp的插入方向，将tmp声明为<code>deque()</code>，右插为<code>append</code>,左插为<code>appendleft</code>；</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">levelOrder</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root):<span class=\"hljs-keyword\">return</span> []<br>        queue ,result,flag = deque(),[],<span class=\"hljs-literal\">False</span><br>        queue.append(root)<br>        <span class=\"hljs-keyword\">while</span>(queue):<br>            tmp = deque()<br>            num = <span class=\"hljs-built_in\">len</span>(queue)<br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(num):<br>                top = queue.popleft()<br>                <span class=\"hljs-keyword\">if</span> flag: tmp.appendleft(top.val)<br>                <span class=\"hljs-keyword\">else</span>:tmp.append(top.val)<br>                <span class=\"hljs-keyword\">if</span>(top.left): queue.append(top.left)<br>                <span class=\"hljs-keyword\">if</span>(top.right): queue.append(top.right)<br>            flag = <span class=\"hljs-keyword\">not</span> flag<br>            result.append(<span class=\"hljs-built_in\">list</span>(tmp))<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>从上到下打印二叉树 Ⅲ</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现一个函数按照之字形顺序打印二叉树，即第一行按照从左到右的顺序打印，第二层按照从右到左的顺序打印，第三行再按照从左到右的顺序打印，其他行以此类推。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p>例如:<br>\n给定二叉树: <code>[3,9,20,null,null,15,7]</code>,</p>\n<figure class=\"highlight livescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\">  <span class=\"hljs-number\">3</span><br> / <span class=\"hljs-string\">\\</span><br><span class=\"hljs-number\">9</span>  <span class=\"hljs-number\">20</span><br>  /  <span class=\"hljs-string\">\\</span><br> <span class=\"hljs-number\">15</span>   <span class=\"hljs-number\">7</span><br></code></pre></td></tr></table></figure>\n<p>返回其层次遍历结果：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">[<br>  [<span class=\"hljs-number\">3</span>],<br>  [<span class=\"hljs-number\">20</span>,<span class=\"hljs-number\">9</span>],<br>  [<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>]<br>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>节点总数 &lt;= 1000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h4 id=\"解法一\">解法一</h4>\n<p>记录本层的数字个数，将本层的元素全部弹出到列表中，同时将下层元素压进队列中；只是要根据flag，来将列表倒序 。</p>\n<blockquote>\n<p>列表倒叙的方法：</p>\n<p>1，temp.reverse()  直接原地修改哦~</p>\n<p>2，temp = temp[::-1]</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">levelOrder</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root):<span class=\"hljs-keyword\">return</span> []<br>        queue ,result,flag = deque(),[],<span class=\"hljs-literal\">False</span><br>        queue.append(root)<br>        <span class=\"hljs-keyword\">while</span>(queue):<br>            tmp = []<br>            num = <span class=\"hljs-built_in\">len</span>(queue)<br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(num):<br>                top = queue.popleft()<br>                tmp.append(top.val)<br>                <span class=\"hljs-keyword\">if</span>(top.left): queue.append(top.left)<br>                <span class=\"hljs-keyword\">if</span>(top.right): queue.append(top.right)<br>            <span class=\"hljs-keyword\">if</span> flag: tmp = tmp[::-<span class=\"hljs-number\">1</span>] <span class=\"hljs-comment\">#tmp.reverse() # tmp = tmp[::-1]</span><br>            flag = <span class=\"hljs-keyword\">not</span> flag<br>            result.append(<span class=\"hljs-built_in\">list</span>(tmp))<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></table></figure>\n<h4 id=\"解法二\">解法二</h4>\n<p>去掉倒叙的操作，根据flag的值更改tmp的插入方向，将tmp声明为<code>deque()</code>，右插为<code>append</code>,左插为<code>appendleft</code>；</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">levelOrder</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root):<span class=\"hljs-keyword\">return</span> []<br>        queue ,result,flag = deque(),[],<span class=\"hljs-literal\">False</span><br>        queue.append(root)<br>        <span class=\"hljs-keyword\">while</span>(queue):<br>            tmp = deque()<br>            num = <span class=\"hljs-built_in\">len</span>(queue)<br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(num):<br>                top = queue.popleft()<br>                <span class=\"hljs-keyword\">if</span> flag: tmp.appendleft(top.val)<br>                <span class=\"hljs-keyword\">else</span>:tmp.append(top.val)<br>                <span class=\"hljs-keyword\">if</span>(top.left): queue.append(top.left)<br>                <span class=\"hljs-keyword\">if</span>(top.right): queue.append(top.right)<br>            flag = <span class=\"hljs-keyword\">not</span> flag<br>            result.append(<span class=\"hljs-built_in\">list</span>(tmp))<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指leetcode-offer32-Ⅱ 从上到下打印二叉树Ⅱ","date":"2021-11-12T12:59:54.000Z","_content":"\n> 从上到下打印二叉树Ⅱ\n\n## 题目\n从上到下按层打印二叉树，同一层的节点按从左到右的顺序打印，每一层打印到一行。\n\n\n### 示例 1：\n\n```\n例如:\n给定二叉树: [3,9,20,null,null,15,7],\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n\n\n\n```\n返回其层次遍历结果：\n\n[\n  [3],\n  [9,20],\n  [15,7]\n]\n```\n\n### 提示：\n\n- 节点总数 <= 1000\n\n## 题解\n\n#### 解法一\n\n其实是层序遍历，注意是按照深度标识的层序遍历。在python中是使用deque这个数据结构实现的，是一个双向队列。\n在右端输出输出是采用`append` 和`pop`，在左端输入输出采用的是`appendleft`和`popleft`。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def levelOrder(self, root: TreeNode) -> List[List[int]]:\n        if(not root):\n            return []\n        x = deque()\n        result = []\n        temp = []\n        depth = -1\n        x.append((root,0))\n        while(len(x)):\n            item = x.popleft()\n            if(depth!=-1 and depth!=item[1]):\n                result.append(temp)\n                temp = []\n                # temp.clear() # temp.clear()很危险，append就应该使用result.append(temp.copy()) 因为append进去的是引用格式的 或者重新初始化temp\n            temp.append(item[0].val)  \n            depth = item[1]\n            if item[0].left: x.append((item[0].left,item[1]+1))\n            if item[0].right: x.append((item[0].right,item[1]+1))\n        if(temp):\n            result.append(temp)\n        return result\n\n```\npython要注意的坑点是在如果将temp加到列表之后，将temp清空，随之list中的列表内容也会清空，相当于说在两个temp是指向同一个地址块，所以需要重新temp初始化，或者在append时使用copy函数进行深拷贝。\n\n#### 解法二\n\n更简便的方法是可以直接把每一轮的输出到result中。\n```python\nclass Solution:\n    def levelOrder(self, root: TreeNode) -> List[List[int]]:\n        if not root: return []\n        res, queue = [], collections.deque()\n        queue.append(root)\n        while queue:\n            tmp = []\n            for _ in range(len(queue)):\n                node = queue.popleft()\n                tmp.append(node.val)\n                if node.left: queue.append(node.left)\n                if node.right: queue.append(node.right)\n            res.append(tmp)\n        return res\n\n```\n","source":"_posts/leetcode/leetcode-offer32.md","raw":"---\ntitle: 剑指leetcode-offer32-Ⅱ 从上到下打印二叉树Ⅱ\ntags: [剑指,队列]\ncategories: [剑指,队列]\ndate: 2021-11-12 20:59:54\n---\n\n> 从上到下打印二叉树Ⅱ\n\n## 题目\n从上到下按层打印二叉树，同一层的节点按从左到右的顺序打印，每一层打印到一行。\n\n\n### 示例 1：\n\n```\n例如:\n给定二叉树: [3,9,20,null,null,15,7],\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n\n\n\n```\n返回其层次遍历结果：\n\n[\n  [3],\n  [9,20],\n  [15,7]\n]\n```\n\n### 提示：\n\n- 节点总数 <= 1000\n\n## 题解\n\n#### 解法一\n\n其实是层序遍历，注意是按照深度标识的层序遍历。在python中是使用deque这个数据结构实现的，是一个双向队列。\n在右端输出输出是采用`append` 和`pop`，在左端输入输出采用的是`appendleft`和`popleft`。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def levelOrder(self, root: TreeNode) -> List[List[int]]:\n        if(not root):\n            return []\n        x = deque()\n        result = []\n        temp = []\n        depth = -1\n        x.append((root,0))\n        while(len(x)):\n            item = x.popleft()\n            if(depth!=-1 and depth!=item[1]):\n                result.append(temp)\n                temp = []\n                # temp.clear() # temp.clear()很危险，append就应该使用result.append(temp.copy()) 因为append进去的是引用格式的 或者重新初始化temp\n            temp.append(item[0].val)  \n            depth = item[1]\n            if item[0].left: x.append((item[0].left,item[1]+1))\n            if item[0].right: x.append((item[0].right,item[1]+1))\n        if(temp):\n            result.append(temp)\n        return result\n\n```\npython要注意的坑点是在如果将temp加到列表之后，将temp清空，随之list中的列表内容也会清空，相当于说在两个temp是指向同一个地址块，所以需要重新temp初始化，或者在append时使用copy函数进行深拷贝。\n\n#### 解法二\n\n更简便的方法是可以直接把每一轮的输出到result中。\n```python\nclass Solution:\n    def levelOrder(self, root: TreeNode) -> List[List[int]]:\n        if not root: return []\n        res, queue = [], collections.deque()\n        queue.append(root)\n        while queue:\n            tmp = []\n            for _ in range(len(queue)):\n                node = queue.popleft()\n                tmp.append(node.val)\n                if node.left: queue.append(node.left)\n                if node.right: queue.append(node.right)\n            res.append(tmp)\n        return res\n\n```\n","slug":"leetcode/leetcode-offer32","published":1,"updated":"2022-01-18T08:10:17.084Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0a50043ast9516p81om","content":"<blockquote>\n<p>从上到下打印二叉树Ⅱ</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>从上到下按层打印二叉树，同一层的节点按从左到右的顺序打印，每一层打印到一行。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight livescript\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\">例如:<br>给定二叉树: [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>],<br>    <span class=\"hljs-number\">3</span><br>   / <span class=\"hljs-string\">\\</span><br>  <span class=\"hljs-number\">9</span>  <span class=\"hljs-number\">20</span><br>    /  <span class=\"hljs-string\">\\</span><br>   <span class=\"hljs-number\">15</span>   <span class=\"hljs-number\">7</span><br></code></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">返回其层次遍历结果：<br><br><span class=\"hljs-comment\">[</span><br><span class=\"hljs-comment\">  <span class=\"hljs-comment\">[3]</span>,</span><br><span class=\"hljs-comment\">  <span class=\"hljs-comment\">[9,20]</span>,</span><br><span class=\"hljs-comment\">  <span class=\"hljs-comment\">[15,7]</span></span><br><span class=\"hljs-comment\">]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>节点总数 &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h4 id=\"解法一\">解法一</h4>\n<p>其实是层序遍历，注意是按照深度标识的层序遍历。在python中是使用deque这个数据结构实现的，是一个双向队列。<br>\n在右端输出输出是采用<code>append</code> 和<code>pop</code>，在左端输入输出采用的是<code>appendleft</code>和<code>popleft</code>。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">levelOrder</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root):<br>            <span class=\"hljs-keyword\">return</span> []<br>        x = deque()<br>        result = []<br>        temp = []<br>        depth = -<span class=\"hljs-number\">1</span><br>        x.append((root,<span class=\"hljs-number\">0</span>))<br>        <span class=\"hljs-keyword\">while</span>(<span class=\"hljs-built_in\">len</span>(x)):<br>            item = x.popleft()<br>            <span class=\"hljs-keyword\">if</span>(depth!=-<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">and</span> depth!=item[<span class=\"hljs-number\">1</span>]):<br>                result.append(temp)<br>                temp = []<br>                <span class=\"hljs-comment\"># temp.clear() # temp.clear()很危险，append就应该使用result.append(temp.copy()) 因为append进去的是引用格式的 或者重新初始化temp</span><br>            temp.append(item[<span class=\"hljs-number\">0</span>].val)  <br>            depth = item[<span class=\"hljs-number\">1</span>]<br>            <span class=\"hljs-keyword\">if</span> item[<span class=\"hljs-number\">0</span>].left: x.append((item[<span class=\"hljs-number\">0</span>].left,item[<span class=\"hljs-number\">1</span>]+<span class=\"hljs-number\">1</span>))<br>            <span class=\"hljs-keyword\">if</span> item[<span class=\"hljs-number\">0</span>].right: x.append((item[<span class=\"hljs-number\">0</span>].right,item[<span class=\"hljs-number\">1</span>]+<span class=\"hljs-number\">1</span>))<br>        <span class=\"hljs-keyword\">if</span>(temp):<br>            result.append(temp)<br>        <span class=\"hljs-keyword\">return</span> result<br><br></code></pre></td></tr></tbody></table></figure>\n<p>python要注意的坑点是在如果将temp加到列表之后，将temp清空，随之list中的列表内容也会清空，相当于说在两个temp是指向同一个地址块，所以需要重新temp初始化，或者在append时使用copy函数进行深拷贝。</p>\n<h4 id=\"解法二\">解法二</h4>\n<p>更简便的方法是可以直接把每一轮的输出到result中。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">levelOrder</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root: <span class=\"hljs-keyword\">return</span> []<br>        res, queue = [], collections.deque()<br>        queue.append(root)<br>        <span class=\"hljs-keyword\">while</span> queue:<br>            tmp = []<br>            <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(queue)):<br>                node = queue.popleft()<br>                tmp.append(node.val)<br>                <span class=\"hljs-keyword\">if</span> node.left: queue.append(node.left)<br>                <span class=\"hljs-keyword\">if</span> node.right: queue.append(node.right)<br>            res.append(tmp)<br>        <span class=\"hljs-keyword\">return</span> res<br><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>从上到下打印二叉树Ⅱ</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>从上到下按层打印二叉树，同一层的节点按从左到右的顺序打印，每一层打印到一行。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight livescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\">例如:<br>给定二叉树: [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">20</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-literal\">null</span>,<span class=\"hljs-number\">15</span>,<span class=\"hljs-number\">7</span>],<br>    <span class=\"hljs-number\">3</span><br>   / <span class=\"hljs-string\">\\</span><br>  <span class=\"hljs-number\">9</span>  <span class=\"hljs-number\">20</span><br>    /  <span class=\"hljs-string\">\\</span><br>   <span class=\"hljs-number\">15</span>   <span class=\"hljs-number\">7</span><br></code></pre></td></tr></table></figure>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">返回其层次遍历结果：<br><br><span class=\"hljs-comment\">[</span><br><span class=\"hljs-comment\">  <span class=\"hljs-comment\">[3]</span>,</span><br><span class=\"hljs-comment\">  <span class=\"hljs-comment\">[9,20]</span>,</span><br><span class=\"hljs-comment\">  <span class=\"hljs-comment\">[15,7]</span></span><br><span class=\"hljs-comment\">]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>节点总数 &lt;= 1000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h4 id=\"解法一\">解法一</h4>\n<p>其实是层序遍历，注意是按照深度标识的层序遍历。在python中是使用deque这个数据结构实现的，是一个双向队列。<br>\n在右端输出输出是采用<code>append</code> 和<code>pop</code>，在左端输入输出采用的是<code>appendleft</code>和<code>popleft</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">levelOrder</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root):<br>            <span class=\"hljs-keyword\">return</span> []<br>        x = deque()<br>        result = []<br>        temp = []<br>        depth = -<span class=\"hljs-number\">1</span><br>        x.append((root,<span class=\"hljs-number\">0</span>))<br>        <span class=\"hljs-keyword\">while</span>(<span class=\"hljs-built_in\">len</span>(x)):<br>            item = x.popleft()<br>            <span class=\"hljs-keyword\">if</span>(depth!=-<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">and</span> depth!=item[<span class=\"hljs-number\">1</span>]):<br>                result.append(temp)<br>                temp = []<br>                <span class=\"hljs-comment\"># temp.clear() # temp.clear()很危险，append就应该使用result.append(temp.copy()) 因为append进去的是引用格式的 或者重新初始化temp</span><br>            temp.append(item[<span class=\"hljs-number\">0</span>].val)  <br>            depth = item[<span class=\"hljs-number\">1</span>]<br>            <span class=\"hljs-keyword\">if</span> item[<span class=\"hljs-number\">0</span>].left: x.append((item[<span class=\"hljs-number\">0</span>].left,item[<span class=\"hljs-number\">1</span>]+<span class=\"hljs-number\">1</span>))<br>            <span class=\"hljs-keyword\">if</span> item[<span class=\"hljs-number\">0</span>].right: x.append((item[<span class=\"hljs-number\">0</span>].right,item[<span class=\"hljs-number\">1</span>]+<span class=\"hljs-number\">1</span>))<br>        <span class=\"hljs-keyword\">if</span>(temp):<br>            result.append(temp)<br>        <span class=\"hljs-keyword\">return</span> result<br><br></code></pre></td></tr></table></figure>\n<p>python要注意的坑点是在如果将temp加到列表之后，将temp清空，随之list中的列表内容也会清空，相当于说在两个temp是指向同一个地址块，所以需要重新temp初始化，或者在append时使用copy函数进行深拷贝。</p>\n<h4 id=\"解法二\">解法二</h4>\n<p>更简便的方法是可以直接把每一轮的输出到result中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">levelOrder</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root: <span class=\"hljs-keyword\">return</span> []<br>        res, queue = [], collections.deque()<br>        queue.append(root)<br>        <span class=\"hljs-keyword\">while</span> queue:<br>            tmp = []<br>            <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(queue)):<br>                node = queue.popleft()<br>                tmp.append(node.val)<br>                <span class=\"hljs-keyword\">if</span> node.left: queue.append(node.left)<br>                <span class=\"hljs-keyword\">if</span> node.right: queue.append(node.right)<br>            res.append(tmp)<br>        <span class=\"hljs-keyword\">return</span> res<br><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer33","date":"2021-12-04T13:59:06.000Z","_content":"\n>二叉搜索树的后续遍历序列\n\n## 题目\n\n输入一个整数数组，判断该数组是不是某二叉搜索树的后序遍历结果。如果是则返回 `true`，否则返回 `false`。假设输入的数组的任意两个数字都互不相同。\n\n\n\n参考以下这颗二叉搜索树\n\n```\n     5\n    / \\\n   2   6\n  / \\\n 1   3\n```\n\n### 示例 1：\n\n\n```\n输入: [1,6,3,2,5]\n输出: false\n```\n\n### 示例 2：\n\n```\n输入: [1,3,2,6,5]\n输出: true\n```\n\n### 提示：\n\n- `数组长度 <= 1000`\n\n## 题解\n\n采用递归的方式，最后一个元素作为root，找到第一个比root大的值，作为左子树的区域，比较左子树区域的值核对是否大于root即可，然后比较左右子树。\n\n```python\nclass Solution:\n    def verifyPostorder(self, postorder: List[int]) -> bool:\n        if(not postorder or len(postorder)==1): return True\n        root = postorder[len(postorder)-1]\n        result,flag = True,True\n        index = len(postorder)-1\n        for i,x in enumerate(postorder):\n            result = x>=root if not flag and result else result\n            # if(not flag and x<root):\n            #     result = False\n            #     break\n            # result = x>root if not flag else True\n            if(flag and x>root):\n                index = i\n                flag = False\n        return result and self.verifyPostorder(postorder[:index-1]) and self.verifyPostorder(postorder[index:len(postorder)-1])\n```\n\n","source":"_posts/leetcode/leetcode-offer33.md","raw":"---\ntitle: 剑指offer33\ntags: [剑指,树]\ncategories: [剑指,树]\ndate: 2021-12-04 21:59:06\n---\n\n>二叉搜索树的后续遍历序列\n\n## 题目\n\n输入一个整数数组，判断该数组是不是某二叉搜索树的后序遍历结果。如果是则返回 `true`，否则返回 `false`。假设输入的数组的任意两个数字都互不相同。\n\n\n\n参考以下这颗二叉搜索树\n\n```\n     5\n    / \\\n   2   6\n  / \\\n 1   3\n```\n\n### 示例 1：\n\n\n```\n输入: [1,6,3,2,5]\n输出: false\n```\n\n### 示例 2：\n\n```\n输入: [1,3,2,6,5]\n输出: true\n```\n\n### 提示：\n\n- `数组长度 <= 1000`\n\n## 题解\n\n采用递归的方式，最后一个元素作为root，找到第一个比root大的值，作为左子树的区域，比较左子树区域的值核对是否大于root即可，然后比较左右子树。\n\n```python\nclass Solution:\n    def verifyPostorder(self, postorder: List[int]) -> bool:\n        if(not postorder or len(postorder)==1): return True\n        root = postorder[len(postorder)-1]\n        result,flag = True,True\n        index = len(postorder)-1\n        for i,x in enumerate(postorder):\n            result = x>=root if not flag and result else result\n            # if(not flag and x<root):\n            #     result = False\n            #     break\n            # result = x>root if not flag else True\n            if(flag and x>root):\n                index = i\n                flag = False\n        return result and self.verifyPostorder(postorder[:index-1]) and self.verifyPostorder(postorder[index:len(postorder)-1])\n```\n\n","slug":"leetcode/leetcode-offer33","published":1,"updated":"2022-01-18T08:10:17.085Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0a70046ast9cbwpbs8n","content":"<blockquote>\n<p>二叉搜索树的后续遍历序列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个整数数组，判断该数组是不是某二叉搜索树的后序遍历结果。如果是则返回 <code>true</code>，否则返回 <code>false</code>。假设输入的数组的任意两个数字都互不相同。</p>\n<p>参考以下这颗二叉搜索树</p>\n<figure class=\"highlight livescript\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\">    <span class=\"hljs-number\">5</span><br>   / <span class=\"hljs-string\">\\</span><br>  <span class=\"hljs-number\">2</span>   <span class=\"hljs-number\">6</span><br> / <span class=\"hljs-string\">\\</span><br><span class=\"hljs-number\">1</span>   <span class=\"hljs-number\">3</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight makefile\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: [1,6,3,2,5]</span><br><span class=\"hljs-section\">输出: false</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight makefile\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: [1,3,2,6,5]</span><br><span class=\"hljs-section\">输出: true</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>数组长度 &lt;= 1000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>采用递归的方式，最后一个元素作为root，找到第一个比root大的值，作为左子树的区域，比较左子树区域的值核对是否大于root即可，然后比较左右子树。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">verifyPostorder</span>(<span class=\"hljs-params\">self, postorder: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> postorder <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">len</span>(postorder)==<span class=\"hljs-number\">1</span>): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>        root = postorder[<span class=\"hljs-built_in\">len</span>(postorder)-<span class=\"hljs-number\">1</span>]<br>        result,flag = <span class=\"hljs-literal\">True</span>,<span class=\"hljs-literal\">True</span><br>        index = <span class=\"hljs-built_in\">len</span>(postorder)-<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> i,x <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(postorder):<br>            result = x&gt;=root <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> flag <span class=\"hljs-keyword\">and</span> result <span class=\"hljs-keyword\">else</span> result<br>            <span class=\"hljs-comment\"># if(not flag and x&lt;root):</span><br>            <span class=\"hljs-comment\">#     result = False</span><br>            <span class=\"hljs-comment\">#     break</span><br>            <span class=\"hljs-comment\"># result = x&gt;root if not flag else True</span><br>            <span class=\"hljs-keyword\">if</span>(flag <span class=\"hljs-keyword\">and</span> x&gt;root):<br>                index = i<br>                flag = <span class=\"hljs-literal\">False</span><br>        <span class=\"hljs-keyword\">return</span> result <span class=\"hljs-keyword\">and</span> self.verifyPostorder(postorder[:index-<span class=\"hljs-number\">1</span>]) <span class=\"hljs-keyword\">and</span> self.verifyPostorder(postorder[index:<span class=\"hljs-built_in\">len</span>(postorder)-<span class=\"hljs-number\">1</span>])<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>二叉搜索树的后续遍历序列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个整数数组，判断该数组是不是某二叉搜索树的后序遍历结果。如果是则返回 <code>true</code>，否则返回 <code>false</code>。假设输入的数组的任意两个数字都互不相同。</p>\n<p>参考以下这颗二叉搜索树</p>\n<figure class=\"highlight livescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\">    <span class=\"hljs-number\">5</span><br>   / <span class=\"hljs-string\">\\</span><br>  <span class=\"hljs-number\">2</span>   <span class=\"hljs-number\">6</span><br> / <span class=\"hljs-string\">\\</span><br><span class=\"hljs-number\">1</span>   <span class=\"hljs-number\">3</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: [1,6,3,2,5]</span><br><span class=\"hljs-section\">输出: false</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: [1,3,2,6,5]</span><br><span class=\"hljs-section\">输出: true</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>数组长度 &lt;= 1000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>采用递归的方式，最后一个元素作为root，找到第一个比root大的值，作为左子树的区域，比较左子树区域的值核对是否大于root即可，然后比较左右子树。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">verifyPostorder</span>(<span class=\"hljs-params\">self, postorder: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> postorder <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">len</span>(postorder)==<span class=\"hljs-number\">1</span>): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>        root = postorder[<span class=\"hljs-built_in\">len</span>(postorder)-<span class=\"hljs-number\">1</span>]<br>        result,flag = <span class=\"hljs-literal\">True</span>,<span class=\"hljs-literal\">True</span><br>        index = <span class=\"hljs-built_in\">len</span>(postorder)-<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> i,x <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(postorder):<br>            result = x&gt;=root <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> flag <span class=\"hljs-keyword\">and</span> result <span class=\"hljs-keyword\">else</span> result<br>            <span class=\"hljs-comment\"># if(not flag and x&lt;root):</span><br>            <span class=\"hljs-comment\">#     result = False</span><br>            <span class=\"hljs-comment\">#     break</span><br>            <span class=\"hljs-comment\"># result = x&gt;root if not flag else True</span><br>            <span class=\"hljs-keyword\">if</span>(flag <span class=\"hljs-keyword\">and</span> x&gt;root):<br>                index = i<br>                flag = <span class=\"hljs-literal\">False</span><br>        <span class=\"hljs-keyword\">return</span> result <span class=\"hljs-keyword\">and</span> self.verifyPostorder(postorder[:index-<span class=\"hljs-number\">1</span>]) <span class=\"hljs-keyword\">and</span> self.verifyPostorder(postorder[index:<span class=\"hljs-built_in\">len</span>(postorder)-<span class=\"hljs-number\">1</span>])<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer34 二叉树中和为某一值的路径","date":"2021-12-06T08:50:08.000Z","_content":"\n>二叉树中和为某一值的路径\n\n## 题目\n\n给你二叉树的根节点 root 和一个整数目标和 targetSum ，找出所有 从根节点到叶子节点 路径总和等于给定目标和的路径。\n\n叶子节点 是指没有子节点的节点。\n\n\n\n### 示例 1：\n\n![](https://picture.mulindya.com/leetcode34-1.jpg)\n\n```\n输入：root = [5,4,8,11,null,13,4,7,2,null,null,5,1], targetSum = 22\n输出：[[5,4,11,2],[5,8,4,5]]\n```\n\n### 示例 2：\n\n![](https://picture.mulindya.com/leetcode34-2.jpg)\n\n```\n输入：root = [1,2,3], targetSum = 5\n输出：[]\n```\n\n### 示例4：\n\n```\n输入：root = [1,2], targetSum = 0\n输出：[]\n```\n\n### 提示：\n\n- 树中节点总数在范围 `[0, 5000]` 内\n- `-1000 <= Node.val <= 1000`\n- `-1000 <= targetSum <= 1000`\n\n## 题解\n\n注存在节点的值是负数，因此**不能按照当前得到的和进行剪枝操作**，另一个需要注意的点是**不能将对象append**，对象的append直接引用的，再后续修改会影响到result的内容，所以可以将其进行copy，深拷贝，或者list实例化一下。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, val=0, left=None, right=None):\n#         self.val = val\n#         self.left = left\n#         self.right = right\nclass Solution:\n    def pathSum(self, root: TreeNode, target: int) -> List[List[int]]:\n        if(not root): return []\n        result,nowlist = [],[]\n\n        def findPath(root,nowsum):\n            # if(not root or (root and root.val + nowsum>target)): return #还存在负数的情况因此不能剪枝\n            if(not root): return\n            tsum = root.val + nowsum\n            nowlist.append(root.val)\n            if(not root.left and not root.right and tsum==target):\n                result.append(nowlist.copy()) #不能随便将一个对象append进去，后续此对象出现变化，会影响到result\n            findPath(root.left,tsum)\n            findPath(root.right,tsum)\n            nowlist.pop()\n               \n        findPath(root,0)\n        return result\n```\n\n","source":"_posts/leetcode/leetcode-offer34.md","raw":"---\ntitle: 剑指offer34 二叉树中和为某一值的路径\ntags: [剑指,树]\ncategories: [剑指,树]\ndate: 2021-12-06 16:50:08\n---\n\n>二叉树中和为某一值的路径\n\n## 题目\n\n给你二叉树的根节点 root 和一个整数目标和 targetSum ，找出所有 从根节点到叶子节点 路径总和等于给定目标和的路径。\n\n叶子节点 是指没有子节点的节点。\n\n\n\n### 示例 1：\n\n![](https://picture.mulindya.com/leetcode34-1.jpg)\n\n```\n输入：root = [5,4,8,11,null,13,4,7,2,null,null,5,1], targetSum = 22\n输出：[[5,4,11,2],[5,8,4,5]]\n```\n\n### 示例 2：\n\n![](https://picture.mulindya.com/leetcode34-2.jpg)\n\n```\n输入：root = [1,2,3], targetSum = 5\n输出：[]\n```\n\n### 示例4：\n\n```\n输入：root = [1,2], targetSum = 0\n输出：[]\n```\n\n### 提示：\n\n- 树中节点总数在范围 `[0, 5000]` 内\n- `-1000 <= Node.val <= 1000`\n- `-1000 <= targetSum <= 1000`\n\n## 题解\n\n注存在节点的值是负数，因此**不能按照当前得到的和进行剪枝操作**，另一个需要注意的点是**不能将对象append**，对象的append直接引用的，再后续修改会影响到result的内容，所以可以将其进行copy，深拷贝，或者list实例化一下。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, val=0, left=None, right=None):\n#         self.val = val\n#         self.left = left\n#         self.right = right\nclass Solution:\n    def pathSum(self, root: TreeNode, target: int) -> List[List[int]]:\n        if(not root): return []\n        result,nowlist = [],[]\n\n        def findPath(root,nowsum):\n            # if(not root or (root and root.val + nowsum>target)): return #还存在负数的情况因此不能剪枝\n            if(not root): return\n            tsum = root.val + nowsum\n            nowlist.append(root.val)\n            if(not root.left and not root.right and tsum==target):\n                result.append(nowlist.copy()) #不能随便将一个对象append进去，后续此对象出现变化，会影响到result\n            findPath(root.left,tsum)\n            findPath(root.right,tsum)\n            nowlist.pop()\n               \n        findPath(root,0)\n        return result\n```\n\n","slug":"leetcode/leetcode-offer34","published":1,"updated":"2022-01-18T08:10:17.086Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0a9004aast93yci29qz","content":"<blockquote>\n<p>二叉树中和为某一值的路径</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给你二叉树的根节点 root 和一个整数目标和 targetSum ，找出所有 从根节点到叶子节点 路径总和等于给定目标和的路径。</p>\n<p>叶子节点 是指没有子节点的节点。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p><img src=\"https://picture.mulindya.com/leetcode34-1.jpg\" alt=\"\"></p>\n<figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\">输入：root = [<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">8</span>,<span class=\"hljs-number\">11</span>,null,<span class=\"hljs-number\">13</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">7</span>,<span class=\"hljs-number\">2</span>,null,null,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">1</span>], targetSum = <span class=\"hljs-number\">22</span><br>输出：<span class=\"hljs-string\">[[5,4,11,2],[5,8,4,5]]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<p><img src=\"https://picture.mulindya.com/leetcode34-2.jpg\" alt=\"\"></p>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：root = <span class=\"hljs-comment\">[1,2,3]</span>, targetSum = 5<br>输出：<span class=\"hljs-comment\">[]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例4：\">示例4：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：root = <span class=\"hljs-comment\">[1,2]</span>, targetSum = 0<br>输出：<span class=\"hljs-comment\">[]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>树中节点总数在范围 <code>[0, 5000]</code> 内</li>\n<li><code>-1000 &lt;= Node.val &lt;= 1000</code></li>\n<li><code>-1000 &lt;= targetSum &lt;= 1000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>注存在节点的值是负数，因此<strong>不能按照当前得到的和进行剪枝操作</strong>，另一个需要注意的点是<strong>不能将对象append</strong>，对象的append直接引用的，再后续修改会影响到result的内容，所以可以将其进行copy，深拷贝，或者list实例化一下。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, val=0, left=None, right=None):</span><br><span class=\"hljs-comment\">#         self.val = val</span><br><span class=\"hljs-comment\">#         self.left = left</span><br><span class=\"hljs-comment\">#         self.right = right</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">pathSum</span>(<span class=\"hljs-params\">self, root: TreeNode, target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root): <span class=\"hljs-keyword\">return</span> []<br>        result,nowlist = [],[]<br><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findPath</span>(<span class=\"hljs-params\">root,nowsum</span>):</span><br>            <span class=\"hljs-comment\"># if(not root or (root and root.val + nowsum&gt;target)): return #还存在负数的情况因此不能剪枝</span><br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root): <span class=\"hljs-keyword\">return</span><br>            tsum = root.val + nowsum<br>            nowlist.append(root.val)<br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root.left <span class=\"hljs-keyword\">and</span> <span class=\"hljs-keyword\">not</span> root.right <span class=\"hljs-keyword\">and</span> tsum==target):<br>                result.append(nowlist.copy()) <span class=\"hljs-comment\">#不能随便将一个对象append进去，后续此对象出现变化，会影响到result</span><br>            findPath(root.left,tsum)<br>            findPath(root.right,tsum)<br>            nowlist.pop()<br>               <br>        findPath(root,<span class=\"hljs-number\">0</span>)<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>二叉树中和为某一值的路径</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给你二叉树的根节点 root 和一个整数目标和 targetSum ，找出所有 从根节点到叶子节点 路径总和等于给定目标和的路径。</p>\n<p>叶子节点 是指没有子节点的节点。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p><img src=\"https://picture.mulindya.com/leetcode34-1.jpg\" alt=\"\"></p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\">输入：root = [<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">8</span>,<span class=\"hljs-number\">11</span>,null,<span class=\"hljs-number\">13</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">7</span>,<span class=\"hljs-number\">2</span>,null,null,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">1</span>], targetSum = <span class=\"hljs-number\">22</span><br>输出：<span class=\"hljs-string\">[[5,4,11,2],[5,8,4,5]]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<p><img src=\"https://picture.mulindya.com/leetcode34-2.jpg\" alt=\"\"></p>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：root = <span class=\"hljs-comment\">[1,2,3]</span>, targetSum = 5<br>输出：<span class=\"hljs-comment\">[]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例4：\">示例4：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：root = <span class=\"hljs-comment\">[1,2]</span>, targetSum = 0<br>输出：<span class=\"hljs-comment\">[]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>树中节点总数在范围 <code>[0, 5000]</code> 内</li>\n<li><code>-1000 &lt;= Node.val &lt;= 1000</code></li>\n<li><code>-1000 &lt;= targetSum &lt;= 1000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>注存在节点的值是负数，因此<strong>不能按照当前得到的和进行剪枝操作</strong>，另一个需要注意的点是<strong>不能将对象append</strong>，对象的append直接引用的，再后续修改会影响到result的内容，所以可以将其进行copy，深拷贝，或者list实例化一下。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, val=0, left=None, right=None):</span><br><span class=\"hljs-comment\">#         self.val = val</span><br><span class=\"hljs-comment\">#         self.left = left</span><br><span class=\"hljs-comment\">#         self.right = right</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">pathSum</span>(<span class=\"hljs-params\">self, root: TreeNode, target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root): <span class=\"hljs-keyword\">return</span> []<br>        result,nowlist = [],[]<br><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findPath</span>(<span class=\"hljs-params\">root,nowsum</span>):</span><br>            <span class=\"hljs-comment\"># if(not root or (root and root.val + nowsum&gt;target)): return #还存在负数的情况因此不能剪枝</span><br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root): <span class=\"hljs-keyword\">return</span><br>            tsum = root.val + nowsum<br>            nowlist.append(root.val)<br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root.left <span class=\"hljs-keyword\">and</span> <span class=\"hljs-keyword\">not</span> root.right <span class=\"hljs-keyword\">and</span> tsum==target):<br>                result.append(nowlist.copy()) <span class=\"hljs-comment\">#不能随便将一个对象append进去，后续此对象出现变化，会影响到result</span><br>            findPath(root.left,tsum)<br>            findPath(root.right,tsum)<br>            nowlist.pop()<br>               <br>        findPath(root,<span class=\"hljs-number\">0</span>)<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer35 复杂链表的复制","date":"2021-09-16T08:50:09.000Z","_content":"\n> 复杂链表的复制\n\n## 题目\n\n请实现 copyRandomList 函数，复制一个复杂链表。在复杂链表中，每个节点除了有一个 next 指针指向下一个节点，还有一个 random 指针指向链表中的任意节点或者 null。\n\n### 示例 1：\n\n```\n输入：head = [[7,null],[13,0],[11,4],[10,2],[1,0]]\n输出：[[7,null],[13,0],[11,4],[10,2],[1,0]]\n\n```\n\n### 示例 2：\n\n```\n输入：head = [[1,1],[2,1]]\n输出：[[1,1],[2,1]]\n```\n\n### 示例 3：\n\n```\n输入：head = [[3,null],[3,0],[3,null]]\n输出：[[3,null],[3,0],[3,null]]\n```\n\n### 示例 4：\n\n```\n输入：head = []\n输出：[]\n解释：给定的链表为空（空指针），因此返回 null。\n```\n### 提示：\n\n- -10000 <= Node.val <= 10000\n- Node.random 为空（null）或指向链表中的节点。\n- 节点数目不超过 1000 。\n\n## 题解\n\n通常普通的链表复制只需要遍历链表，每轮新建立一个节点，在添加前驱节点到当前节点的引用指向即可，但是本题的节点新增了random指针，因此需要处理random指针。\n- 第一种方法是使用`哈希表`\n- 第二种方法是使用`拼接+拆分`\n\n#### 哈希表\n\n先构建原链表节点和新链表节点的键值对映射关系，再遍历构建新链表节点的next和random的引用指向。\n\n这里可以直接使用字典，键值对就是（原节点，新节点），然后直接在字典中构建；\n\n```python\nclass Solution:\n    def copyRandomList(self,head:'Node')->'Node':\n        if not head:return\n        dic = {}\n        cur = head\n        while cur:\n            dic[cur] = Node(cur.val)\n            cur = cur.next\n        cur = head\n        while cur:\n            dic[cur].next = dic.get(cur.next)\n            dic[cur].random = dic.get(cur.random)\n            cur = cur.next\n        return dic[head]\n```\n\n> dict.get(key,default=None) key是字典中要查找的键，default是指定键值不存在时，返回默认值；\n\n此时时间复杂度为O(N),空间复杂度为O(N)。\n\n#### 拼接+拆分\n构建拼接链表`原节点1->新节点1->原节点2->新节点2->......`,这时，在访问原节点的random时可以找到新对应新节点的random的指向节点。\n当访问`cur.random`时，对应的新节点`cur.next`的随机指向节点为`cur.random.next`，就可以解决random的问题，再进行拆分链表。\n\n```python\nclass Solution:\n    def copyRandomList(self,head:'Node')->'Node':\n\t\tif not head:return\n\t\tcur = head\n\t\t#复制各个节点，并构建拼接链表\n\t\twhile cur:\n\t\t\ttmp = Node(cur.val)\n\t\t\ttmp.next = cur.next\n\t\t\tcur.next = tmp\n\t\t\tcur = tmp.next\n\t\t#构建random指向\n\t\tcur = head\n\t\twhile cur:\n\t\t\tif cur.random:\n\t\t\t\tcur.next.random = cur.random.next\n            cur = cur.next.next\n        #拆分链表\n        cur = res = head.next\n        while cur.next:\n            cur.next = cur.next.next\n            cur = cur.next\n        return res\n```\n\n此时时间复杂度为O(N),空间复杂度为O(1)。\n","source":"_posts/leetcode/leetcode-offer35.md","raw":"---\ntitle: 剑指offer35 复杂链表的复制\ntags: 剑指\ncategories: 剑指\ndate: 2021-09-16 16:50:09\n---\n\n> 复杂链表的复制\n\n## 题目\n\n请实现 copyRandomList 函数，复制一个复杂链表。在复杂链表中，每个节点除了有一个 next 指针指向下一个节点，还有一个 random 指针指向链表中的任意节点或者 null。\n\n### 示例 1：\n\n```\n输入：head = [[7,null],[13,0],[11,4],[10,2],[1,0]]\n输出：[[7,null],[13,0],[11,4],[10,2],[1,0]]\n\n```\n\n### 示例 2：\n\n```\n输入：head = [[1,1],[2,1]]\n输出：[[1,1],[2,1]]\n```\n\n### 示例 3：\n\n```\n输入：head = [[3,null],[3,0],[3,null]]\n输出：[[3,null],[3,0],[3,null]]\n```\n\n### 示例 4：\n\n```\n输入：head = []\n输出：[]\n解释：给定的链表为空（空指针），因此返回 null。\n```\n### 提示：\n\n- -10000 <= Node.val <= 10000\n- Node.random 为空（null）或指向链表中的节点。\n- 节点数目不超过 1000 。\n\n## 题解\n\n通常普通的链表复制只需要遍历链表，每轮新建立一个节点，在添加前驱节点到当前节点的引用指向即可，但是本题的节点新增了random指针，因此需要处理random指针。\n- 第一种方法是使用`哈希表`\n- 第二种方法是使用`拼接+拆分`\n\n#### 哈希表\n\n先构建原链表节点和新链表节点的键值对映射关系，再遍历构建新链表节点的next和random的引用指向。\n\n这里可以直接使用字典，键值对就是（原节点，新节点），然后直接在字典中构建；\n\n```python\nclass Solution:\n    def copyRandomList(self,head:'Node')->'Node':\n        if not head:return\n        dic = {}\n        cur = head\n        while cur:\n            dic[cur] = Node(cur.val)\n            cur = cur.next\n        cur = head\n        while cur:\n            dic[cur].next = dic.get(cur.next)\n            dic[cur].random = dic.get(cur.random)\n            cur = cur.next\n        return dic[head]\n```\n\n> dict.get(key,default=None) key是字典中要查找的键，default是指定键值不存在时，返回默认值；\n\n此时时间复杂度为O(N),空间复杂度为O(N)。\n\n#### 拼接+拆分\n构建拼接链表`原节点1->新节点1->原节点2->新节点2->......`,这时，在访问原节点的random时可以找到新对应新节点的random的指向节点。\n当访问`cur.random`时，对应的新节点`cur.next`的随机指向节点为`cur.random.next`，就可以解决random的问题，再进行拆分链表。\n\n```python\nclass Solution:\n    def copyRandomList(self,head:'Node')->'Node':\n\t\tif not head:return\n\t\tcur = head\n\t\t#复制各个节点，并构建拼接链表\n\t\twhile cur:\n\t\t\ttmp = Node(cur.val)\n\t\t\ttmp.next = cur.next\n\t\t\tcur.next = tmp\n\t\t\tcur = tmp.next\n\t\t#构建random指向\n\t\tcur = head\n\t\twhile cur:\n\t\t\tif cur.random:\n\t\t\t\tcur.next.random = cur.random.next\n            cur = cur.next.next\n        #拆分链表\n        cur = res = head.next\n        while cur.next:\n            cur.next = cur.next.next\n            cur = cur.next\n        return res\n```\n\n此时时间复杂度为O(N),空间复杂度为O(1)。\n","slug":"leetcode/leetcode-offer35","published":1,"updated":"2022-01-18T08:10:17.086Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ab004cast9e8bp7q3r","content":"<blockquote>\n<p>复杂链表的复制</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现 copyRandomList 函数，复制一个复杂链表。在复杂链表中，每个节点除了有一个 next 指针指向下一个节点，还有一个 random 指针指向链表中的任意节点或者 null。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：head = <span class=\"hljs-comment\">[<span class=\"hljs-comment\">[7,null]</span>,<span class=\"hljs-comment\">[13,0]</span>,<span class=\"hljs-comment\">[11,4]</span>,<span class=\"hljs-comment\">[10,2]</span>,<span class=\"hljs-comment\">[1,0]</span>]</span><br>输出：<span class=\"hljs-comment\">[<span class=\"hljs-comment\">[7,null]</span>,<span class=\"hljs-comment\">[13,0]</span>,<span class=\"hljs-comment\">[11,4]</span>,<span class=\"hljs-comment\">[10,2]</span>,<span class=\"hljs-comment\">[1,0]</span>]</span><br><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\">输入：head = <span class=\"hljs-string\">[[1,1],[2,1]]</span><br>输出：<span class=\"hljs-string\">[[1,1],[2,1]]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\">输入：head = <span class=\"hljs-string\">[[3,null],[3,0],[3,null]]</span><br>输出：<span class=\"hljs-string\">[[3,null],[3,0],[3,null]]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：head = <span class=\"hljs-comment\">[]</span><br>输出：<span class=\"hljs-comment\">[]</span><br>解释：给定的链表为空（空指针），因此返回 null。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>-10000 &lt;= Node.val &lt;= 10000</li>\n<li>Node.random 为空（null）或指向链表中的节点。</li>\n<li>节点数目不超过 1000 。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>通常普通的链表复制只需要遍历链表，每轮新建立一个节点，在添加前驱节点到当前节点的引用指向即可，但是本题的节点新增了random指针，因此需要处理random指针。</p>\n<ul>\n<li>第一种方法是使用<code>哈希表</code></li>\n<li>第二种方法是使用<code>拼接+拆分</code></li>\n</ul>\n<h4 id=\"哈希表\">哈希表</h4>\n<p>先构建原链表节点和新链表节点的键值对映射关系，再遍历构建新链表节点的next和random的引用指向。</p>\n<p>这里可以直接使用字典，键值对就是（原节点，新节点），然后直接在字典中构建；</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">copyRandomList</span>(<span class=\"hljs-params\">self,head:<span class=\"hljs-string\">'Node'</span></span>)-&gt;'Node':</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> head:<span class=\"hljs-keyword\">return</span><br>        dic = {}<br>        cur = head<br>        <span class=\"hljs-keyword\">while</span> cur:<br>            dic[cur] = Node(cur.val)<br>            cur = cur.<span class=\"hljs-built_in\">next</span><br>        cur = head<br>        <span class=\"hljs-keyword\">while</span> cur:<br>            dic[cur].<span class=\"hljs-built_in\">next</span> = dic.get(cur.<span class=\"hljs-built_in\">next</span>)<br>            dic[cur].random = dic.get(cur.random)<br>            cur = cur.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-keyword\">return</span> dic[head]<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>dict.get(key,default=None) key是字典中要查找的键，default是指定键值不存在时，返回默认值；</p>\n</blockquote>\n<p>此时时间复杂度为O(N),空间复杂度为O(N)。</p>\n<h4 id=\"拼接-拆分\">拼接+拆分</h4>\n<p>构建拼接链表<code>原节点1-&gt;新节点1-&gt;原节点2-&gt;新节点2-&gt;......</code>,这时，在访问原节点的random时可以找到新对应新节点的random的指向节点。<br>\n当访问<code>cur.random</code>时，对应的新节点<code>cur.next</code>的随机指向节点为<code>cur.random.next</code>，就可以解决random的问题，再进行拆分链表。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">copyRandomList</span>(<span class=\"hljs-params\">self,head:<span class=\"hljs-string\">'Node'</span></span>)-&gt;'Node':</span><br>\t\t<span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> head:<span class=\"hljs-keyword\">return</span><br>\t\tcur = head<br>\t\t<span class=\"hljs-comment\">#复制各个节点，并构建拼接链表</span><br>\t\t<span class=\"hljs-keyword\">while</span> cur:<br>\t\t\ttmp = Node(cur.val)<br>\t\t\ttmp.<span class=\"hljs-built_in\">next</span> = cur.<span class=\"hljs-built_in\">next</span><br>\t\t\tcur.<span class=\"hljs-built_in\">next</span> = tmp<br>\t\t\tcur = tmp.<span class=\"hljs-built_in\">next</span><br>\t\t<span class=\"hljs-comment\">#构建random指向</span><br>\t\tcur = head<br>\t\t<span class=\"hljs-keyword\">while</span> cur:<br>\t\t\t<span class=\"hljs-keyword\">if</span> cur.random:<br>\t\t\t\tcur.<span class=\"hljs-built_in\">next</span>.random = cur.random.<span class=\"hljs-built_in\">next</span><br>            cur = cur.<span class=\"hljs-built_in\">next</span>.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-comment\">#拆分链表</span><br>        cur = res = head.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-keyword\">while</span> cur.<span class=\"hljs-built_in\">next</span>:<br>            cur.<span class=\"hljs-built_in\">next</span> = cur.<span class=\"hljs-built_in\">next</span>.<span class=\"hljs-built_in\">next</span><br>            cur = cur.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-keyword\">return</span> res<br></code></pre></td></tr></tbody></table></figure>\n<p>此时时间复杂度为O(N),空间复杂度为O(1)。</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>复杂链表的复制</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>请实现 copyRandomList 函数，复制一个复杂链表。在复杂链表中，每个节点除了有一个 next 指针指向下一个节点，还有一个 random 指针指向链表中的任意节点或者 null。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：head = <span class=\"hljs-comment\">[<span class=\"hljs-comment\">[7,null]</span>,<span class=\"hljs-comment\">[13,0]</span>,<span class=\"hljs-comment\">[11,4]</span>,<span class=\"hljs-comment\">[10,2]</span>,<span class=\"hljs-comment\">[1,0]</span>]</span><br>输出：<span class=\"hljs-comment\">[<span class=\"hljs-comment\">[7,null]</span>,<span class=\"hljs-comment\">[13,0]</span>,<span class=\"hljs-comment\">[11,4]</span>,<span class=\"hljs-comment\">[10,2]</span>,<span class=\"hljs-comment\">[1,0]</span>]</span><br><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\">输入：head = <span class=\"hljs-string\">[[1,1],[2,1]]</span><br>输出：<span class=\"hljs-string\">[[1,1],[2,1]]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\">输入：head = <span class=\"hljs-string\">[[3,null],[3,0],[3,null]]</span><br>输出：<span class=\"hljs-string\">[[3,null],[3,0],[3,null]]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：head = <span class=\"hljs-comment\">[]</span><br>输出：<span class=\"hljs-comment\">[]</span><br>解释：给定的链表为空（空指针），因此返回 null。<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>-10000 &lt;= Node.val &lt;= 10000</li>\n<li>Node.random 为空（null）或指向链表中的节点。</li>\n<li>节点数目不超过 1000 。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>通常普通的链表复制只需要遍历链表，每轮新建立一个节点，在添加前驱节点到当前节点的引用指向即可，但是本题的节点新增了random指针，因此需要处理random指针。</p>\n<ul>\n<li>第一种方法是使用<code>哈希表</code></li>\n<li>第二种方法是使用<code>拼接+拆分</code></li>\n</ul>\n<h4 id=\"哈希表\">哈希表</h4>\n<p>先构建原链表节点和新链表节点的键值对映射关系，再遍历构建新链表节点的next和random的引用指向。</p>\n<p>这里可以直接使用字典，键值对就是（原节点，新节点），然后直接在字典中构建；</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">copyRandomList</span>(<span class=\"hljs-params\">self,head:<span class=\"hljs-string\">&#x27;Node&#x27;</span></span>)-&gt;&#x27;Node&#x27;:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> head:<span class=\"hljs-keyword\">return</span><br>        dic = &#123;&#125;<br>        cur = head<br>        <span class=\"hljs-keyword\">while</span> cur:<br>            dic[cur] = Node(cur.val)<br>            cur = cur.<span class=\"hljs-built_in\">next</span><br>        cur = head<br>        <span class=\"hljs-keyword\">while</span> cur:<br>            dic[cur].<span class=\"hljs-built_in\">next</span> = dic.get(cur.<span class=\"hljs-built_in\">next</span>)<br>            dic[cur].random = dic.get(cur.random)<br>            cur = cur.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-keyword\">return</span> dic[head]<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>dict.get(key,default=None) key是字典中要查找的键，default是指定键值不存在时，返回默认值；</p>\n</blockquote>\n<p>此时时间复杂度为O(N),空间复杂度为O(N)。</p>\n<h4 id=\"拼接-拆分\">拼接+拆分</h4>\n<p>构建拼接链表<code>原节点1-&gt;新节点1-&gt;原节点2-&gt;新节点2-&gt;......</code>,这时，在访问原节点的random时可以找到新对应新节点的random的指向节点。<br>\n当访问<code>cur.random</code>时，对应的新节点<code>cur.next</code>的随机指向节点为<code>cur.random.next</code>，就可以解决random的问题，再进行拆分链表。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">copyRandomList</span>(<span class=\"hljs-params\">self,head:<span class=\"hljs-string\">&#x27;Node&#x27;</span></span>)-&gt;&#x27;Node&#x27;:</span><br>\t\t<span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> head:<span class=\"hljs-keyword\">return</span><br>\t\tcur = head<br>\t\t<span class=\"hljs-comment\">#复制各个节点，并构建拼接链表</span><br>\t\t<span class=\"hljs-keyword\">while</span> cur:<br>\t\t\ttmp = Node(cur.val)<br>\t\t\ttmp.<span class=\"hljs-built_in\">next</span> = cur.<span class=\"hljs-built_in\">next</span><br>\t\t\tcur.<span class=\"hljs-built_in\">next</span> = tmp<br>\t\t\tcur = tmp.<span class=\"hljs-built_in\">next</span><br>\t\t<span class=\"hljs-comment\">#构建random指向</span><br>\t\tcur = head<br>\t\t<span class=\"hljs-keyword\">while</span> cur:<br>\t\t\t<span class=\"hljs-keyword\">if</span> cur.random:<br>\t\t\t\tcur.<span class=\"hljs-built_in\">next</span>.random = cur.random.<span class=\"hljs-built_in\">next</span><br>            cur = cur.<span class=\"hljs-built_in\">next</span>.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-comment\">#拆分链表</span><br>        cur = res = head.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-keyword\">while</span> cur.<span class=\"hljs-built_in\">next</span>:<br>            cur.<span class=\"hljs-built_in\">next</span> = cur.<span class=\"hljs-built_in\">next</span>.<span class=\"hljs-built_in\">next</span><br>            cur = cur.<span class=\"hljs-built_in\">next</span><br>        <span class=\"hljs-keyword\">return</span> res<br></code></pre></td></tr></table></figure>\n<p>此时时间复杂度为O(N),空间复杂度为O(1)。</p>\n"},{"title":"剑指offer36 二叉搜索树和双向链表","date":"2021-10-08T11:50:46.000Z","_content":"\n> 二叉搜索树和双向链表\n\n## 题目\n输入一棵二叉搜索树，将该二叉搜索树转换成一个排序的循环双向链表。要求不能创建任何新的节点，只能调整树中节点指针的指向\n为了让您更好地理解问题，以下面的二叉搜索树为例：\n\n![](https://picture.mulindya.com/leetcode-offer36-1.png)\n\n我们希望将这个二叉搜索树转化为双向循环链表。链表中的每个节点都有一个前驱和后继指针。对于双向循环链表，第一个节点的前驱是最后一个节点，最后一个节点的后继是第一个节点。\n\n下图展示了上面的二叉搜索树转化成的链表。“head” 表示指向链表中有最小元素的节点。\n\n![](https://picture.mulindya.com/leetcode-offer36-2.png)\n\n特别地，我们希望可以就地完成转换操作。当转化完成以后，树中节点的左指针需要指向前驱，树中节点的右指针需要指向后继。还需要返回链表中的第一个节点的指针。\n\n### 提示：\n\n- 注意：本题与主站 426 题相同：https://leetcode-cn.com/problems/convert-binary-search-tree-to-sorted-doubly-linked-list/\n\n- 注意：此题对比原题有改动。\n\n\n## 题解\n\n本题的算法思想是在中序遍历的基础上，涉及对链表的处理，但是还是按照中序递归遍历的逻辑，使用self可以全局设置pre和head，pre是用来更新节点的左右指向，head是用于后续的头尾节点的处理，函数结束时的pre即为尾节点。\n\n中序遍历代码结构：\n\n```python\ndef dfs(root):\n\tif not root:\n\t\treturn\n\tdfs(root.left)\n\tprint(root)\n\tdfs(root.right)\n```\n\n注意边界条件的处理，以及self.pre和self.head的更新。\n\n```python\n\"\"\"\n# Definition for a Node.\nclass Node:\n    def __init__(self, val, left=None, right=None):\n        self.val = val\n        self.left = left\n        self.right = right\n\"\"\"\nclass Solution:\n    def treeToDoublyList(self, root: 'Node') -> 'Node':\n        def mediumfunc(root):\n            if not root:return\n            mediumfunc(root.left)\n            if(self.pre):\n                self.pre.right = root\n                root.left = self.pre\n            else:\n                self.head = root\n            self.pre = root #注意在判断之后必须要更新pre\n            mediumfunc(root.right)\n        if not(root):\n            return None\n        self.head = root\n        self.pre = None\n        mediumfunc(root)\n        self.head.left = self.pre\n        self.pre.right = self.head\n        return self.head\n```\n\n","source":"_posts/leetcode/leetcode-offer36.md","raw":"---\ntitle: 剑指offer36 二叉搜索树和双向链表\ntags: [剑指,树]\ncategories: [剑指,树]\ndate: 2021-10-08 19:50:46\n---\n\n> 二叉搜索树和双向链表\n\n## 题目\n输入一棵二叉搜索树，将该二叉搜索树转换成一个排序的循环双向链表。要求不能创建任何新的节点，只能调整树中节点指针的指向\n为了让您更好地理解问题，以下面的二叉搜索树为例：\n\n![](https://picture.mulindya.com/leetcode-offer36-1.png)\n\n我们希望将这个二叉搜索树转化为双向循环链表。链表中的每个节点都有一个前驱和后继指针。对于双向循环链表，第一个节点的前驱是最后一个节点，最后一个节点的后继是第一个节点。\n\n下图展示了上面的二叉搜索树转化成的链表。“head” 表示指向链表中有最小元素的节点。\n\n![](https://picture.mulindya.com/leetcode-offer36-2.png)\n\n特别地，我们希望可以就地完成转换操作。当转化完成以后，树中节点的左指针需要指向前驱，树中节点的右指针需要指向后继。还需要返回链表中的第一个节点的指针。\n\n### 提示：\n\n- 注意：本题与主站 426 题相同：https://leetcode-cn.com/problems/convert-binary-search-tree-to-sorted-doubly-linked-list/\n\n- 注意：此题对比原题有改动。\n\n\n## 题解\n\n本题的算法思想是在中序遍历的基础上，涉及对链表的处理，但是还是按照中序递归遍历的逻辑，使用self可以全局设置pre和head，pre是用来更新节点的左右指向，head是用于后续的头尾节点的处理，函数结束时的pre即为尾节点。\n\n中序遍历代码结构：\n\n```python\ndef dfs(root):\n\tif not root:\n\t\treturn\n\tdfs(root.left)\n\tprint(root)\n\tdfs(root.right)\n```\n\n注意边界条件的处理，以及self.pre和self.head的更新。\n\n```python\n\"\"\"\n# Definition for a Node.\nclass Node:\n    def __init__(self, val, left=None, right=None):\n        self.val = val\n        self.left = left\n        self.right = right\n\"\"\"\nclass Solution:\n    def treeToDoublyList(self, root: 'Node') -> 'Node':\n        def mediumfunc(root):\n            if not root:return\n            mediumfunc(root.left)\n            if(self.pre):\n                self.pre.right = root\n                root.left = self.pre\n            else:\n                self.head = root\n            self.pre = root #注意在判断之后必须要更新pre\n            mediumfunc(root.right)\n        if not(root):\n            return None\n        self.head = root\n        self.pre = None\n        mediumfunc(root)\n        self.head.left = self.pre\n        self.pre.right = self.head\n        return self.head\n```\n\n","slug":"leetcode/leetcode-offer36","published":1,"updated":"2022-01-18T08:10:17.087Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ac004east9cp87d49v","content":"<blockquote>\n<p>二叉搜索树和双向链表</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一棵二叉搜索树，将该二叉搜索树转换成一个排序的循环双向链表。要求不能创建任何新的节点，只能调整树中节点指针的指向<br>\n为了让您更好地理解问题，以下面的二叉搜索树为例：</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer36-1.png\" alt=\"\"></p>\n<p>我们希望将这个二叉搜索树转化为双向循环链表。链表中的每个节点都有一个前驱和后继指针。对于双向循环链表，第一个节点的前驱是最后一个节点，最后一个节点的后继是第一个节点。</p>\n<p>下图展示了上面的二叉搜索树转化成的链表。“head” 表示指向链表中有最小元素的节点。</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer36-2.png\" alt=\"\"></p>\n<p>特别地，我们希望可以就地完成转换操作。当转化完成以后，树中节点的左指针需要指向前驱，树中节点的右指针需要指向后继。还需要返回链表中的第一个节点的指针。</p>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>\n<p>注意：本题与主站 426 题相同：<a href=\"https://leetcode-cn.com/problems/convert-binary-search-tree-to-sorted-doubly-linked-list/\">https://leetcode-cn.com/problems/convert-binary-search-tree-to-sorted-doubly-linked-list/</a></p>\n</li>\n<li>\n<p>注意：此题对比原题有改动。</p>\n</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>本题的算法思想是在中序遍历的基础上，涉及对链表的处理，但是还是按照中序递归遍历的逻辑，使用self可以全局设置pre和head，pre是用来更新节点的左右指向，head是用于后续的头尾节点的处理，函数结束时的pre即为尾节点。</p>\n<p>中序遍历代码结构：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">root</span>):</span><br>\t<span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root:<br>\t\t<span class=\"hljs-keyword\">return</span><br>\tdfs(root.left)<br>\t<span class=\"hljs-built_in\">print</span>(root)<br>\tdfs(root.right)<br></code></pre></td></tr></tbody></table></figure>\n<p>注意边界条件的处理，以及self.pre和self.head的更新。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\"># Definition for a Node.</span><br><span class=\"hljs-string\">class Node:</span><br><span class=\"hljs-string\">    def __init__(self, val, left=None, right=None):</span><br><span class=\"hljs-string\">        self.val = val</span><br><span class=\"hljs-string\">        self.left = left</span><br><span class=\"hljs-string\">        self.right = right</span><br><span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">treeToDoublyList</span>(<span class=\"hljs-params\">self, root: <span class=\"hljs-string\">'Node'</span></span>) -&gt; 'Node':</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">mediumfunc</span>(<span class=\"hljs-params\">root</span>):</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root:<span class=\"hljs-keyword\">return</span><br>            mediumfunc(root.left)<br>            <span class=\"hljs-keyword\">if</span>(self.pre):<br>                self.pre.right = root<br>                root.left = self.pre<br>            <span class=\"hljs-keyword\">else</span>:<br>                self.head = root<br>            self.pre = root <span class=\"hljs-comment\">#注意在判断之后必须要更新pre</span><br>            mediumfunc(root.right)<br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(root):<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">None</span><br>        self.head = root<br>        self.pre = <span class=\"hljs-literal\">None</span><br>        mediumfunc(root)<br>        self.head.left = self.pre<br>        self.pre.right = self.head<br>        <span class=\"hljs-keyword\">return</span> self.head<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>二叉搜索树和双向链表</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一棵二叉搜索树，将该二叉搜索树转换成一个排序的循环双向链表。要求不能创建任何新的节点，只能调整树中节点指针的指向<br>\n为了让您更好地理解问题，以下面的二叉搜索树为例：</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer36-1.png\" alt=\"\"></p>\n<p>我们希望将这个二叉搜索树转化为双向循环链表。链表中的每个节点都有一个前驱和后继指针。对于双向循环链表，第一个节点的前驱是最后一个节点，最后一个节点的后继是第一个节点。</p>\n<p>下图展示了上面的二叉搜索树转化成的链表。“head” 表示指向链表中有最小元素的节点。</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer36-2.png\" alt=\"\"></p>\n<p>特别地，我们希望可以就地完成转换操作。当转化完成以后，树中节点的左指针需要指向前驱，树中节点的右指针需要指向后继。还需要返回链表中的第一个节点的指针。</p>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>\n<p>注意：本题与主站 426 题相同：<a href=\"https://leetcode-cn.com/problems/convert-binary-search-tree-to-sorted-doubly-linked-list/\">https://leetcode-cn.com/problems/convert-binary-search-tree-to-sorted-doubly-linked-list/</a></p>\n</li>\n<li>\n<p>注意：此题对比原题有改动。</p>\n</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>本题的算法思想是在中序遍历的基础上，涉及对链表的处理，但是还是按照中序递归遍历的逻辑，使用self可以全局设置pre和head，pre是用来更新节点的左右指向，head是用于后续的头尾节点的处理，函数结束时的pre即为尾节点。</p>\n<p>中序遍历代码结构：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">root</span>):</span><br>\t<span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root:<br>\t\t<span class=\"hljs-keyword\">return</span><br>\tdfs(root.left)<br>\t<span class=\"hljs-built_in\">print</span>(root)<br>\tdfs(root.right)<br></code></pre></td></tr></table></figure>\n<p>注意边界条件的处理，以及self.pre和self.head的更新。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\"># Definition for a Node.</span><br><span class=\"hljs-string\">class Node:</span><br><span class=\"hljs-string\">    def __init__(self, val, left=None, right=None):</span><br><span class=\"hljs-string\">        self.val = val</span><br><span class=\"hljs-string\">        self.left = left</span><br><span class=\"hljs-string\">        self.right = right</span><br><span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">treeToDoublyList</span>(<span class=\"hljs-params\">self, root: <span class=\"hljs-string\">&#x27;Node&#x27;</span></span>) -&gt; &#x27;Node&#x27;:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">mediumfunc</span>(<span class=\"hljs-params\">root</span>):</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root:<span class=\"hljs-keyword\">return</span><br>            mediumfunc(root.left)<br>            <span class=\"hljs-keyword\">if</span>(self.pre):<br>                self.pre.right = root<br>                root.left = self.pre<br>            <span class=\"hljs-keyword\">else</span>:<br>                self.head = root<br>            self.pre = root <span class=\"hljs-comment\">#注意在判断之后必须要更新pre</span><br>            mediumfunc(root.right)<br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(root):<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">None</span><br>        self.head = root<br>        self.pre = <span class=\"hljs-literal\">None</span><br>        mediumfunc(root)<br>        self.head.left = self.pre<br>        self.pre.right = self.head<br>        <span class=\"hljs-keyword\">return</span> self.head<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer372 超级次方","date":"2021-12-05T13:29:30.000Z","_content":"\n>超级次方\n\n## 题目\n\n你的任务是计算 ab 对 1337 取模，a 是一个正整数，b 是一个非常大的正整数且会以数组形式给出。\n\n### 示例 1：\n\n```\n输入：a = 2, b = [3]\n输出：8\n```\n\n### 示例 2：\n\n```\n输入：a = 2, b = [1,0]\n输出：1024\n```\n\n### 示例 3：\n\n```\n输入：a = 1, b = [4,3,3,8,5,2]\n输出：1\n```\n\n### 示例 4：\n\n```\n输入：a = 2147483647, b = [2,0,0]\n输出：1198\n```\n\n### 提示：\n\n- 1 <= a <= 231 - 1\n- 1 <= b.length <= 2000\n- 0 <= b[i] <= 9\n- b 不含前导 0\n\n## 题解\n\n使用math模块\n\n```python\nimport math\nmath.pow( x, y )\n```\n\n内置的pow方法\n`pow(x, y[, z])`\n\n函数是计算 x 的 y 次方，如果 z 在存在，则再对结果进行取模，其结果等效于 pow(x,y) %z。\n\n**注意：pow() 通过内置的方法直接调用，内置方法会把参数作为整型，而 math 模块则会把参数转换为 float。**\n```python\nclass Solution:\n    def superPow(self, a: int, b: List[int]) -> int:\n        result = 1\n        mod = 1337\n        for i,x in enumerate(b):\n            temp = pow(a,x,mod)\n            result = result*temp%mod \n            if(i<len(b)-1):result = pow(result,10,mod)\n        return result\n```\n\n和二进制求十进制的思想类似，当前位求得之后再乘以10的基底，继续重复,,,\n","source":"_posts/leetcode/leetcode-offer372.md","raw":"---\ntitle: 剑指offer372 超级次方\ntags: [剑指,数组]\ncategories: [剑指,数组]\ndate: 2021-12-05 21:29:30\n---\n\n>超级次方\n\n## 题目\n\n你的任务是计算 ab 对 1337 取模，a 是一个正整数，b 是一个非常大的正整数且会以数组形式给出。\n\n### 示例 1：\n\n```\n输入：a = 2, b = [3]\n输出：8\n```\n\n### 示例 2：\n\n```\n输入：a = 2, b = [1,0]\n输出：1024\n```\n\n### 示例 3：\n\n```\n输入：a = 1, b = [4,3,3,8,5,2]\n输出：1\n```\n\n### 示例 4：\n\n```\n输入：a = 2147483647, b = [2,0,0]\n输出：1198\n```\n\n### 提示：\n\n- 1 <= a <= 231 - 1\n- 1 <= b.length <= 2000\n- 0 <= b[i] <= 9\n- b 不含前导 0\n\n## 题解\n\n使用math模块\n\n```python\nimport math\nmath.pow( x, y )\n```\n\n内置的pow方法\n`pow(x, y[, z])`\n\n函数是计算 x 的 y 次方，如果 z 在存在，则再对结果进行取模，其结果等效于 pow(x,y) %z。\n\n**注意：pow() 通过内置的方法直接调用，内置方法会把参数作为整型，而 math 模块则会把参数转换为 float。**\n```python\nclass Solution:\n    def superPow(self, a: int, b: List[int]) -> int:\n        result = 1\n        mod = 1337\n        for i,x in enumerate(b):\n            temp = pow(a,x,mod)\n            result = result*temp%mod \n            if(i<len(b)-1):result = pow(result,10,mod)\n        return result\n```\n\n和二进制求十进制的思想类似，当前位求得之后再乘以10的基底，继续重复,,,\n","slug":"leetcode/leetcode-offer372","published":1,"updated":"2022-01-18T08:10:17.088Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ae004gast9cir94ikc","content":"<blockquote>\n<p>超级次方</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>你的任务是计算 ab 对 1337 取模，a 是一个正整数，b 是一个非常大的正整数且会以数组形式给出。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight stylus\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">输入：<span class=\"hljs-selector-tag\">a</span> = <span class=\"hljs-number\">2</span>, <span class=\"hljs-selector-tag\">b</span> = <span class=\"hljs-selector-attr\">[3]</span><br>输出：<span class=\"hljs-number\">8</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight stylus\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">输入：<span class=\"hljs-selector-tag\">a</span> = <span class=\"hljs-number\">2</span>, <span class=\"hljs-selector-tag\">b</span> = <span class=\"hljs-selector-attr\">[1,0]</span><br>输出：<span class=\"hljs-number\">1024</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight stylus\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">输入：<span class=\"hljs-selector-tag\">a</span> = <span class=\"hljs-number\">1</span>, <span class=\"hljs-selector-tag\">b</span> = <span class=\"hljs-selector-attr\">[4,3,3,8,5,2]</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight stylus\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">输入：<span class=\"hljs-selector-tag\">a</span> = <span class=\"hljs-number\">2147483647</span>, <span class=\"hljs-selector-tag\">b</span> = <span class=\"hljs-selector-attr\">[2,0,0]</span><br>输出：<span class=\"hljs-number\">1198</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= a &lt;= 231 - 1</li>\n<li>1 &lt;= b.length &lt;= 2000</li>\n<li>0 &lt;= b[i] &lt;= 9</li>\n<li>b 不含前导 0</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用math模块</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> math<br>math.<span class=\"hljs-built_in\">pow</span>( x, y )<br></code></pre></td></tr></tbody></table></figure>\n<p>内置的pow方法<br>\n<code>pow(x, y[, z])</code></p>\n<p>函数是计算 x 的 y 次方，如果 z 在存在，则再对结果进行取模，其结果等效于 pow(x,y) %z。</p>\n<p><strong>注意：pow() 通过内置的方法直接调用，内置方法会把参数作为整型，而 math 模块则会把参数转换为 float。</strong></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">superPow</span>(<span class=\"hljs-params\">self, a: <span class=\"hljs-built_in\">int</span>, b: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        result = <span class=\"hljs-number\">1</span><br>        mod = <span class=\"hljs-number\">1337</span><br>        <span class=\"hljs-keyword\">for</span> i,x <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(b):<br>            temp = <span class=\"hljs-built_in\">pow</span>(a,x,mod)<br>            result = result*temp%mod <br>            <span class=\"hljs-keyword\">if</span>(i&lt;<span class=\"hljs-built_in\">len</span>(b)-<span class=\"hljs-number\">1</span>):result = <span class=\"hljs-built_in\">pow</span>(result,<span class=\"hljs-number\">10</span>,mod)<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></tbody></table></figure>\n<p>和二进制求十进制的思想类似，当前位求得之后再乘以10的基底，继续重复,</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>超级次方</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>你的任务是计算 ab 对 1337 取模，a 是一个正整数，b 是一个非常大的正整数且会以数组形式给出。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">输入：<span class=\"hljs-selector-tag\">a</span> = <span class=\"hljs-number\">2</span>, <span class=\"hljs-selector-tag\">b</span> = <span class=\"hljs-selector-attr\">[3]</span><br>输出：<span class=\"hljs-number\">8</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">输入：<span class=\"hljs-selector-tag\">a</span> = <span class=\"hljs-number\">2</span>, <span class=\"hljs-selector-tag\">b</span> = <span class=\"hljs-selector-attr\">[1,0]</span><br>输出：<span class=\"hljs-number\">1024</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">输入：<span class=\"hljs-selector-tag\">a</span> = <span class=\"hljs-number\">1</span>, <span class=\"hljs-selector-tag\">b</span> = <span class=\"hljs-selector-attr\">[4,3,3,8,5,2]</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">输入：<span class=\"hljs-selector-tag\">a</span> = <span class=\"hljs-number\">2147483647</span>, <span class=\"hljs-selector-tag\">b</span> = <span class=\"hljs-selector-attr\">[2,0,0]</span><br>输出：<span class=\"hljs-number\">1198</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= a &lt;= 231 - 1</li>\n<li>1 &lt;= b.length &lt;= 2000</li>\n<li>0 &lt;= b[i] &lt;= 9</li>\n<li>b 不含前导 0</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用math模块</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> math<br>math.<span class=\"hljs-built_in\">pow</span>( x, y )<br></code></pre></td></tr></table></figure>\n<p>内置的pow方法<br>\n<code>pow(x, y[, z])</code></p>\n<p>函数是计算 x 的 y 次方，如果 z 在存在，则再对结果进行取模，其结果等效于 pow(x,y) %z。</p>\n<p><strong>注意：pow() 通过内置的方法直接调用，内置方法会把参数作为整型，而 math 模块则会把参数转换为 float。</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">superPow</span>(<span class=\"hljs-params\">self, a: <span class=\"hljs-built_in\">int</span>, b: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        result = <span class=\"hljs-number\">1</span><br>        mod = <span class=\"hljs-number\">1337</span><br>        <span class=\"hljs-keyword\">for</span> i,x <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(b):<br>            temp = <span class=\"hljs-built_in\">pow</span>(a,x,mod)<br>            result = result*temp%mod <br>            <span class=\"hljs-keyword\">if</span>(i&lt;<span class=\"hljs-built_in\">len</span>(b)-<span class=\"hljs-number\">1</span>):result = <span class=\"hljs-built_in\">pow</span>(result,<span class=\"hljs-number\">10</span>,mod)<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></table></figure>\n<p>和二进制求十进制的思想类似，当前位求得之后再乘以10的基底，继续重复,</p>\n"},{"title":"剑指offer38 字符串的排列","date":"2021-11-20T07:10:23.000Z","_content":"\n>字符串的排列\n\n## 题目\n\n输入一个字符串，打印出该字符串中字符的所有排列。\n\n你可以以任意顺序返回这个字符串数组，但里面不能有重复元素。\n\n### 示例 1：\n\n```\n输入：s = \"abc\"\n输出：[\"abc\",\"acb\",\"bac\",\"bca\",\"cab\",\"cba\"]\n```\n\n### 提示：\n\n- 1 <= s 的长度 <= 8\n\n## 题解\n\n#### 思路一\n\n固定s的第一个元素,得到去掉这个元素的后续元素的全排列情况（递归调用）;\n\n第一个元素的确定方法使用循环遍历，但是这里要s中可能存在重复元素，因此需要使用set去掉重复元素，也有剪枝的作用；\n\n> 去掉字符串的某元素（或者字符串）的方法 \n>\n> 使用replace函数替换字符为空--**`s.replace(x,'',1)`**\n>\n>  - replace方法\n>\n>    `str.replace(old,new,max=string.count(old)）`\n> \n>   最多替换max个old字符为new字符，默认全部替换，这里只替换1个哦~\n>    \n\n```python\nclass Solution:\n    def permutation(self, s: str) -> List[str]:\n        if(not s): return [] \n        if(len(s)==1): return [s]\n        result = []\n        sset = set(s)\n        for x in sset:\n           temp = [x + item for item in self.permutation(s.replace(x,'',1))]\n           result += temp\n        return result\n```\n\n#### 思路二\n\n使用深度优先遍历的思想，模拟为树的遍历节点，遍历x位置处为x及x之后索引元素的情况，dfs(x) 是固定前面0到x，来深优x此元素情况。\n\n```python\nclass Solution:\n    def permutation(self, s: str) -> List[str]:\n        c, res = list(s), []\n        def dfs(x):\n            if x == len(c) - 1:\n                res.append(''.join(c))   # 添加排列方案\n                return\n            dic = set()\n            for i in range(x, len(c)):\n                if c[i] in dic: continue # 重复，因此剪枝\n                dic.add(c[i])\n                c[i], c[x] = c[x], c[i]  # 交换，将 c[i] 固定在第 x 位\n                dfs(x + 1)               # 开启固定第 x + 1 位字符\n                c[i], c[x] = c[x], c[i]  # 恢复交换\n        dfs(0)\n        return res\n\n```\n\n","source":"_posts/leetcode/leetcode-offer38.md","raw":"---\ntitle: 剑指offer38 字符串的排列\ntags: [剑指,递归]\ncategories: [剑指,递归]\ndate: 2021-11-20 15:10:23\n---\n\n>字符串的排列\n\n## 题目\n\n输入一个字符串，打印出该字符串中字符的所有排列。\n\n你可以以任意顺序返回这个字符串数组，但里面不能有重复元素。\n\n### 示例 1：\n\n```\n输入：s = \"abc\"\n输出：[\"abc\",\"acb\",\"bac\",\"bca\",\"cab\",\"cba\"]\n```\n\n### 提示：\n\n- 1 <= s 的长度 <= 8\n\n## 题解\n\n#### 思路一\n\n固定s的第一个元素,得到去掉这个元素的后续元素的全排列情况（递归调用）;\n\n第一个元素的确定方法使用循环遍历，但是这里要s中可能存在重复元素，因此需要使用set去掉重复元素，也有剪枝的作用；\n\n> 去掉字符串的某元素（或者字符串）的方法 \n>\n> 使用replace函数替换字符为空--**`s.replace(x,'',1)`**\n>\n>  - replace方法\n>\n>    `str.replace(old,new,max=string.count(old)）`\n> \n>   最多替换max个old字符为new字符，默认全部替换，这里只替换1个哦~\n>    \n\n```python\nclass Solution:\n    def permutation(self, s: str) -> List[str]:\n        if(not s): return [] \n        if(len(s)==1): return [s]\n        result = []\n        sset = set(s)\n        for x in sset:\n           temp = [x + item for item in self.permutation(s.replace(x,'',1))]\n           result += temp\n        return result\n```\n\n#### 思路二\n\n使用深度优先遍历的思想，模拟为树的遍历节点，遍历x位置处为x及x之后索引元素的情况，dfs(x) 是固定前面0到x，来深优x此元素情况。\n\n```python\nclass Solution:\n    def permutation(self, s: str) -> List[str]:\n        c, res = list(s), []\n        def dfs(x):\n            if x == len(c) - 1:\n                res.append(''.join(c))   # 添加排列方案\n                return\n            dic = set()\n            for i in range(x, len(c)):\n                if c[i] in dic: continue # 重复，因此剪枝\n                dic.add(c[i])\n                c[i], c[x] = c[x], c[i]  # 交换，将 c[i] 固定在第 x 位\n                dfs(x + 1)               # 开启固定第 x + 1 位字符\n                c[i], c[x] = c[x], c[i]  # 恢复交换\n        dfs(0)\n        return res\n\n```\n\n","slug":"leetcode/leetcode-offer38","published":1,"updated":"2022-01-18T08:10:17.088Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0af004iast95l96h2x7","content":"<blockquote>\n<p>字符串的排列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个字符串，打印出该字符串中字符的所有排列。</p>\n<p>你可以以任意顺序返回这个字符串数组，但里面不能有重复元素。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">\"abc\"</span><br>输出：[<span class=\"hljs-string\">\"abc\"</span>,<span class=\"hljs-string\">\"acb\"</span>,<span class=\"hljs-string\">\"bac\"</span>,<span class=\"hljs-string\">\"bca\"</span>,<span class=\"hljs-string\">\"cab\"</span>,<span class=\"hljs-string\">\"cba\"</span>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= s 的长度 &lt;= 8</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h4 id=\"思路一\">思路一</h4>\n<p>固定s的第一个元素,得到去掉这个元素的后续元素的全排列情况（递归调用）;</p>\n<p>第一个元素的确定方法使用循环遍历，但是这里要s中可能存在重复元素，因此需要使用set去掉重复元素，也有剪枝的作用；</p>\n<blockquote>\n<p>去掉字符串的某元素（或者字符串）的方法</p>\n<p>使用replace函数替换字符为空–<strong><code>s.replace(x,'',1)</code></strong></p>\n<ul>\n<li>\n<p>replace方法</p>\n<p><code>str.replace(old,new,max=string.count(old)）</code></p>\n</li>\n</ul>\n<p>最多替换max个old字符为new字符，默认全部替换，这里只替换1个哦~</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">permutation</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">str</span>]:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> s): <span class=\"hljs-keyword\">return</span> [] <br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(s)==<span class=\"hljs-number\">1</span>): <span class=\"hljs-keyword\">return</span> [s]<br>        result = []<br>        sset = <span class=\"hljs-built_in\">set</span>(s)<br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> sset:<br>           temp = [x + item <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> self.permutation(s.replace(x,<span class=\"hljs-string\">''</span>,<span class=\"hljs-number\">1</span>))]<br>           result += temp<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"思路二\">思路二</h4>\n<p>使用深度优先遍历的思想，模拟为树的遍历节点，遍历x位置处为x及x之后索引元素的情况，dfs(x) 是固定前面0到x，来深优x此元素情况。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">permutation</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">str</span>]:</span><br>        c, res = <span class=\"hljs-built_in\">list</span>(s), []<br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">x</span>):</span><br>            <span class=\"hljs-keyword\">if</span> x == <span class=\"hljs-built_in\">len</span>(c) - <span class=\"hljs-number\">1</span>:<br>                res.append(<span class=\"hljs-string\">''</span>.join(c))   <span class=\"hljs-comment\"># 添加排列方案</span><br>                <span class=\"hljs-keyword\">return</span><br>            dic = <span class=\"hljs-built_in\">set</span>()<br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(x, <span class=\"hljs-built_in\">len</span>(c)):<br>                <span class=\"hljs-keyword\">if</span> c[i] <span class=\"hljs-keyword\">in</span> dic: <span class=\"hljs-keyword\">continue</span> <span class=\"hljs-comment\"># 重复，因此剪枝</span><br>                dic.add(c[i])<br>                c[i], c[x] = c[x], c[i]  <span class=\"hljs-comment\"># 交换，将 c[i] 固定在第 x 位</span><br>                dfs(x + <span class=\"hljs-number\">1</span>)               <span class=\"hljs-comment\"># 开启固定第 x + 1 位字符</span><br>                c[i], c[x] = c[x], c[i]  <span class=\"hljs-comment\"># 恢复交换</span><br>        dfs(<span class=\"hljs-number\">0</span>)<br>        <span class=\"hljs-keyword\">return</span> res<br><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>字符串的排列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个字符串，打印出该字符串中字符的所有排列。</p>\n<p>你可以以任意顺序返回这个字符串数组，但里面不能有重复元素。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">&quot;abc&quot;</span><br>输出：[<span class=\"hljs-string\">&quot;abc&quot;</span>,<span class=\"hljs-string\">&quot;acb&quot;</span>,<span class=\"hljs-string\">&quot;bac&quot;</span>,<span class=\"hljs-string\">&quot;bca&quot;</span>,<span class=\"hljs-string\">&quot;cab&quot;</span>,<span class=\"hljs-string\">&quot;cba&quot;</span>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= s 的长度 &lt;= 8</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h4 id=\"思路一\">思路一</h4>\n<p>固定s的第一个元素,得到去掉这个元素的后续元素的全排列情况（递归调用）;</p>\n<p>第一个元素的确定方法使用循环遍历，但是这里要s中可能存在重复元素，因此需要使用set去掉重复元素，也有剪枝的作用；</p>\n<blockquote>\n<p>去掉字符串的某元素（或者字符串）的方法</p>\n<p>使用replace函数替换字符为空–<strong><code>s.replace(x,'',1)</code></strong></p>\n<ul>\n<li>\n<p>replace方法</p>\n<p><code>str.replace(old,new,max=string.count(old)）</code></p>\n</li>\n</ul>\n<p>最多替换max个old字符为new字符，默认全部替换，这里只替换1个哦~</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">permutation</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">str</span>]:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> s): <span class=\"hljs-keyword\">return</span> [] <br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(s)==<span class=\"hljs-number\">1</span>): <span class=\"hljs-keyword\">return</span> [s]<br>        result = []<br>        sset = <span class=\"hljs-built_in\">set</span>(s)<br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> sset:<br>           temp = [x + item <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> self.permutation(s.replace(x,<span class=\"hljs-string\">&#x27;&#x27;</span>,<span class=\"hljs-number\">1</span>))]<br>           result += temp<br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></table></figure>\n<h4 id=\"思路二\">思路二</h4>\n<p>使用深度优先遍历的思想，模拟为树的遍历节点，遍历x位置处为x及x之后索引元素的情况，dfs(x) 是固定前面0到x，来深优x此元素情况。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">permutation</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">str</span>]:</span><br>        c, res = <span class=\"hljs-built_in\">list</span>(s), []<br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">x</span>):</span><br>            <span class=\"hljs-keyword\">if</span> x == <span class=\"hljs-built_in\">len</span>(c) - <span class=\"hljs-number\">1</span>:<br>                res.append(<span class=\"hljs-string\">&#x27;&#x27;</span>.join(c))   <span class=\"hljs-comment\"># 添加排列方案</span><br>                <span class=\"hljs-keyword\">return</span><br>            dic = <span class=\"hljs-built_in\">set</span>()<br>            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(x, <span class=\"hljs-built_in\">len</span>(c)):<br>                <span class=\"hljs-keyword\">if</span> c[i] <span class=\"hljs-keyword\">in</span> dic: <span class=\"hljs-keyword\">continue</span> <span class=\"hljs-comment\"># 重复，因此剪枝</span><br>                dic.add(c[i])<br>                c[i], c[x] = c[x], c[i]  <span class=\"hljs-comment\"># 交换，将 c[i] 固定在第 x 位</span><br>                dfs(x + <span class=\"hljs-number\">1</span>)               <span class=\"hljs-comment\"># 开启固定第 x + 1 位字符</span><br>                c[i], c[x] = c[x], c[i]  <span class=\"hljs-comment\"># 恢复交换</span><br>        dfs(<span class=\"hljs-number\">0</span>)<br>        <span class=\"hljs-keyword\">return</span> res<br><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer39 数组中出现次数超过一半的数字","date":"2021-11-04T08:53:43.000Z","_content":"\n>数组中出现次数超过一半的数字\n\n## 题目\n\n数组中有一个数字出现的次数超过数组长度的一半，请找出这个数字。\n\n你可以假设数组是非空的，并且给定的数组总是存在多数元素。\n\n### 示例 1：\n\n```\n输入: [1, 2, 3, 2, 2, 2, 5, 4, 2]\n输出: 2\n```\n\n### 提示：\n\n- 1 <= 数组长度 <= 50000\n\n## 题解\n\n本题可以遍历数组哈希表统计时间和空间复杂度均为O(N)。\n\n```python\nclass Solution:\n    def majorityElement(self, nums: List[int]) -> int:\n        countlist = {}\n        length = len(nums)\n        for x in nums:\n            if countlist.get(x): #可以用内置的get方法或者用has_key()\n                countlist[x]+=1\n            else:\n                countlist[x] = 1\n            if(countlist[x]>length/2):\n                return x\n        return 0\n```\n字典的相关方法：\n\n```python\ndict = {'Name': 'Zara', 'Age': 7, 'Class': 'First'}\n \ndel dict['Name']  # 删除键是'Name'的条目\ndict.clear()      # 清空字典所有条目\ndel dict          # 删除字典\n```\n\nPython字典包含了以下内置方法：\n\n| 序号 | 函数及描述                                                   |\n| :--- | :----------------------------------------------------------- |\n| 1    | [dict.clear()](https://www.runoob.com/python/att-dictionary-clear.html) 删除字典内所有元素 |\n| 2    | [dict.copy()](https://www.runoob.com/python/att-dictionary-copy.html) 返回一个字典的浅复制 |\n| 3    | [dict.fromkeys(seq[, val\\])](https://www.runoob.com/python/att-dictionary-fromkeys.html) 创建一个新字典，以序列 seq 中元素做字典的键，val 为字典所有键对应的初始值 |\n| 4    | **[dict.get(key, default=None)](https://www.runoob.com/python/att-dictionary-get.html) 返回指定键的值，如果值不在字典中返回default值** |\n| 5    | **[dict.has_key(key)](https://www.runoob.com/python/att-dictionary-has_key.html) 如果键在字典dict里返回true，否则返回false** |\n| 6    | [dict.items()](https://www.runoob.com/python/att-dictionary-items.html) 以列表返回可遍历的(键, 值) 元组数组 |\n| 7    | [dict.keys()](https://www.runoob.com/python/att-dictionary-keys.html) 以列表返回一个字典所有的键 |\n| 8    | [dict.setdefault(key, default=None)](https://www.runoob.com/python/att-dictionary-setdefault.html) 和get()类似, 但如果键不存在于字典中，将会添加键并将值设为default |\n| 9    | [dict.update(dict2)](https://www.runoob.com/python/att-dictionary-update.html) 把字典dict2的键/值对更新到dict里 |\n| 10   | [dict.values()](https://www.runoob.com/python/att-dictionary-values.html) 以列表返回字典中的所有值 |\n| 11   | [pop(key[,default\\])](https://www.runoob.com/python/python-att-dictionary-pop.html) 删除字典给定键 key 所对应的值，返回值为被删除的值。key值必须给出。 否则，返回default值。 |\n| 12   | [popitem()](https://www.runoob.com/python/python-att-dictionary-popitem.html) 返回并删除字典中的最后一对键和值。 |\n\n##### 摩尔投票法：核心理念为票数正负抵消，时间复杂度为O(N),空间复杂度为O(1)。\n\n- 推论1：将指定的众数元素标记为+1，其他元素标记为-1，则所有数字的票数和大于0.\n- 推论2:  若数组的前a个数字的票数和为0，则剩余的n-a个数字的票数之和一定大于0，即（n-a）个数字的众数仍为x，可以直接不考虑前面a个数字了。\n\n```python\n\nclass Solution:\n    def majorityElement(self, nums: List[int]) -> int:\n        votes = 0\n        for num in nums:\n            if votes == 0: x = num\n            votes += 1 if num == x else -1\n        return x\n\n```\n\n**拓展**： 由于题目说明 给定的数组总是存在多数元素 ，因此本题不用考虑 数组不存在众数 的情况。若考虑，需要加入一个 “验证环节” ，遍历数组 nums 统计 x 的数量。\n\n**若 x 的数量超过数组长度一半，则返回 x ；**\n否则，返回未找到众数；\n时间和空间复杂度不变，仍为 O(N) 和 O(1) 。\n\n```python\nclass Solution:\n    def majorityElement(self, nums: List[int]) -> int:\n        votes, count = 0, 0\n        for num in nums:\n            if votes == 0: x = num\n            votes += 1 if num == x else -1\n        # 验证 x 是否为众数\n        for num in nums:\n            if num == x: count += 1\n        return x if count > len(nums) // 2 else 0 # 当无众数时返回 0\n```\n\n","source":"_posts/leetcode/leetcode-offer39.md","raw":"---\ntitle: 剑指offer39 数组中出现次数超过一半的数字\ntags: [剑指,字典]\ncategories: [剑指,字典]\ndate: 2021-11-04 16:53:43\n---\n\n>数组中出现次数超过一半的数字\n\n## 题目\n\n数组中有一个数字出现的次数超过数组长度的一半，请找出这个数字。\n\n你可以假设数组是非空的，并且给定的数组总是存在多数元素。\n\n### 示例 1：\n\n```\n输入: [1, 2, 3, 2, 2, 2, 5, 4, 2]\n输出: 2\n```\n\n### 提示：\n\n- 1 <= 数组长度 <= 50000\n\n## 题解\n\n本题可以遍历数组哈希表统计时间和空间复杂度均为O(N)。\n\n```python\nclass Solution:\n    def majorityElement(self, nums: List[int]) -> int:\n        countlist = {}\n        length = len(nums)\n        for x in nums:\n            if countlist.get(x): #可以用内置的get方法或者用has_key()\n                countlist[x]+=1\n            else:\n                countlist[x] = 1\n            if(countlist[x]>length/2):\n                return x\n        return 0\n```\n字典的相关方法：\n\n```python\ndict = {'Name': 'Zara', 'Age': 7, 'Class': 'First'}\n \ndel dict['Name']  # 删除键是'Name'的条目\ndict.clear()      # 清空字典所有条目\ndel dict          # 删除字典\n```\n\nPython字典包含了以下内置方法：\n\n| 序号 | 函数及描述                                                   |\n| :--- | :----------------------------------------------------------- |\n| 1    | [dict.clear()](https://www.runoob.com/python/att-dictionary-clear.html) 删除字典内所有元素 |\n| 2    | [dict.copy()](https://www.runoob.com/python/att-dictionary-copy.html) 返回一个字典的浅复制 |\n| 3    | [dict.fromkeys(seq[, val\\])](https://www.runoob.com/python/att-dictionary-fromkeys.html) 创建一个新字典，以序列 seq 中元素做字典的键，val 为字典所有键对应的初始值 |\n| 4    | **[dict.get(key, default=None)](https://www.runoob.com/python/att-dictionary-get.html) 返回指定键的值，如果值不在字典中返回default值** |\n| 5    | **[dict.has_key(key)](https://www.runoob.com/python/att-dictionary-has_key.html) 如果键在字典dict里返回true，否则返回false** |\n| 6    | [dict.items()](https://www.runoob.com/python/att-dictionary-items.html) 以列表返回可遍历的(键, 值) 元组数组 |\n| 7    | [dict.keys()](https://www.runoob.com/python/att-dictionary-keys.html) 以列表返回一个字典所有的键 |\n| 8    | [dict.setdefault(key, default=None)](https://www.runoob.com/python/att-dictionary-setdefault.html) 和get()类似, 但如果键不存在于字典中，将会添加键并将值设为default |\n| 9    | [dict.update(dict2)](https://www.runoob.com/python/att-dictionary-update.html) 把字典dict2的键/值对更新到dict里 |\n| 10   | [dict.values()](https://www.runoob.com/python/att-dictionary-values.html) 以列表返回字典中的所有值 |\n| 11   | [pop(key[,default\\])](https://www.runoob.com/python/python-att-dictionary-pop.html) 删除字典给定键 key 所对应的值，返回值为被删除的值。key值必须给出。 否则，返回default值。 |\n| 12   | [popitem()](https://www.runoob.com/python/python-att-dictionary-popitem.html) 返回并删除字典中的最后一对键和值。 |\n\n##### 摩尔投票法：核心理念为票数正负抵消，时间复杂度为O(N),空间复杂度为O(1)。\n\n- 推论1：将指定的众数元素标记为+1，其他元素标记为-1，则所有数字的票数和大于0.\n- 推论2:  若数组的前a个数字的票数和为0，则剩余的n-a个数字的票数之和一定大于0，即（n-a）个数字的众数仍为x，可以直接不考虑前面a个数字了。\n\n```python\n\nclass Solution:\n    def majorityElement(self, nums: List[int]) -> int:\n        votes = 0\n        for num in nums:\n            if votes == 0: x = num\n            votes += 1 if num == x else -1\n        return x\n\n```\n\n**拓展**： 由于题目说明 给定的数组总是存在多数元素 ，因此本题不用考虑 数组不存在众数 的情况。若考虑，需要加入一个 “验证环节” ，遍历数组 nums 统计 x 的数量。\n\n**若 x 的数量超过数组长度一半，则返回 x ；**\n否则，返回未找到众数；\n时间和空间复杂度不变，仍为 O(N) 和 O(1) 。\n\n```python\nclass Solution:\n    def majorityElement(self, nums: List[int]) -> int:\n        votes, count = 0, 0\n        for num in nums:\n            if votes == 0: x = num\n            votes += 1 if num == x else -1\n        # 验证 x 是否为众数\n        for num in nums:\n            if num == x: count += 1\n        return x if count > len(nums) // 2 else 0 # 当无众数时返回 0\n```\n\n","slug":"leetcode/leetcode-offer39","published":1,"updated":"2022-01-18T08:10:17.089Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ah004mast9h79t6azb","content":"<blockquote>\n<p>数组中出现次数超过一半的数字</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>数组中有一个数字出现的次数超过数组长度的一半，请找出这个数字。</p>\n<p>你可以假设数组是非空的，并且给定的数组总是存在多数元素。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight makefile\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: [1, 2, 3, 2, 2, 2, 5, 4, 2]</span><br><span class=\"hljs-section\">输出: 2</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= 数组长度 &lt;= 50000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>本题可以遍历数组哈希表统计时间和空间复杂度均为O(N)。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">majorityElement</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        countlist = {}<br>        length = <span class=\"hljs-built_in\">len</span>(nums)<br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span> countlist.get(x): <span class=\"hljs-comment\">#可以用内置的get方法或者用has_key()</span><br>                countlist[x]+=<span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>:<br>                countlist[x] = <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span>(countlist[x]&gt;length/<span class=\"hljs-number\">2</span>):<br>                <span class=\"hljs-keyword\">return</span> x<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br></code></pre></td></tr></tbody></table></figure>\n<p>字典的相关方法：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">dict</span> = {<span class=\"hljs-string\">'Name'</span>: <span class=\"hljs-string\">'Zara'</span>, <span class=\"hljs-string\">'Age'</span>: <span class=\"hljs-number\">7</span>, <span class=\"hljs-string\">'Class'</span>: <span class=\"hljs-string\">'First'</span>}<br> <br><span class=\"hljs-keyword\">del</span> <span class=\"hljs-built_in\">dict</span>[<span class=\"hljs-string\">'Name'</span>]  <span class=\"hljs-comment\"># 删除键是'Name'的条目</span><br><span class=\"hljs-built_in\">dict</span>.clear()      <span class=\"hljs-comment\"># 清空字典所有条目</span><br><span class=\"hljs-keyword\">del</span> <span class=\"hljs-built_in\">dict</span>          <span class=\"hljs-comment\"># 删除字典</span><br></code></pre></td></tr></tbody></table></figure>\n<p>Python字典包含了以下内置方法：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">序号</th>\n<th style=\"text-align:left\">函数及描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">1</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-clear.html\">dict.clear()</a> 删除字典内所有元素</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-copy.html\">dict.copy()</a> 返回一个字典的浅复制</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">3</td>\n<td style=\"text-align:left\">[dict.fromkeys(seq<a href=\"https://www.runoob.com/python/att-dictionary-fromkeys.html\">, val])</a> 创建一个新字典，以序列 seq 中元素做字典的键，val 为字典所有键对应的初始值</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">4</td>\n<td style=\"text-align:left\"><strong><a href=\"https://www.runoob.com/python/att-dictionary-get.html\">dict.get(key, default=None)</a> 返回指定键的值，如果值不在字典中返回default值</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">5</td>\n<td style=\"text-align:left\"><strong><a href=\"https://www.runoob.com/python/att-dictionary-has_key.html\">dict.has_key(key)</a> 如果键在字典dict里返回true，否则返回false</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">6</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-items.html\">dict.items()</a> 以列表返回可遍历的(键, 值) 元组数组</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">7</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-keys.html\">dict.keys()</a> 以列表返回一个字典所有的键</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-setdefault.html\">dict.setdefault(key, default=None)</a> 和get()类似, 但如果键不存在于字典中，将会添加键并将值设为default</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">9</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-update.html\">dict.update(dict2)</a> 把字典dict2的键/值对更新到dict里</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">10</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-values.html\">dict.values()</a> 以列表返回字典中的所有值</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">11</td>\n<td style=\"text-align:left\">[pop(key<a href=\"https://www.runoob.com/python/python-att-dictionary-pop.html\">,default])</a> 删除字典给定键 key 所对应的值，返回值为被删除的值。key值必须给出。 否则，返回default值。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">12</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/python-att-dictionary-popitem.html\">popitem()</a> 返回并删除字典中的最后一对键和值。</td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"摩尔投票法：核心理念为票数正负抵消，时间复杂度为O-N-空间复杂度为O-1-。\">摩尔投票法：核心理念为票数正负抵消，时间复杂度为O(N),空间复杂度为O(1)。</h5>\n<ul>\n<li>推论1：将指定的众数元素标记为+1，其他元素标记为-1，则所有数字的票数和大于0.</li>\n<li>推论2:  若数组的前a个数字的票数和为0，则剩余的n-a个数字的票数之和一定大于0，即（n-a）个数字的众数仍为x，可以直接不考虑前面a个数字了。</li>\n</ul>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">majorityElement</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        votes = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span> votes == <span class=\"hljs-number\">0</span>: x = num<br>            votes += <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">if</span> num == x <span class=\"hljs-keyword\">else</span> -<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> x<br><br></code></pre></td></tr></tbody></table></figure>\n<p><strong>拓展</strong>： 由于题目说明 给定的数组总是存在多数元素 ，因此本题不用考虑 数组不存在众数 的情况。若考虑，需要加入一个 “验证环节” ，遍历数组 nums 统计 x 的数量。</p>\n<p><strong>若 x 的数量超过数组长度一半，则返回 x ；</strong><br>\n否则，返回未找到众数；<br>\n时间和空间复杂度不变，仍为 O(N) 和 O(1) 。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">majorityElement</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        votes, count = <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span> votes == <span class=\"hljs-number\">0</span>: x = num<br>            votes += <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">if</span> num == x <span class=\"hljs-keyword\">else</span> -<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-comment\"># 验证 x 是否为众数</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span> num == x: count += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> x <span class=\"hljs-keyword\">if</span> count &gt; <span class=\"hljs-built_in\">len</span>(nums) // <span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-comment\"># 当无众数时返回 0</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>数组中出现次数超过一半的数字</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>数组中有一个数字出现的次数超过数组长度的一半，请找出这个数字。</p>\n<p>你可以假设数组是非空的，并且给定的数组总是存在多数元素。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: [1, 2, 3, 2, 2, 2, 5, 4, 2]</span><br><span class=\"hljs-section\">输出: 2</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= 数组长度 &lt;= 50000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>本题可以遍历数组哈希表统计时间和空间复杂度均为O(N)。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">majorityElement</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        countlist = &#123;&#125;<br>        length = <span class=\"hljs-built_in\">len</span>(nums)<br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span> countlist.get(x): <span class=\"hljs-comment\">#可以用内置的get方法或者用has_key()</span><br>                countlist[x]+=<span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>:<br>                countlist[x] = <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">if</span>(countlist[x]&gt;length/<span class=\"hljs-number\">2</span>):<br>                <span class=\"hljs-keyword\">return</span> x<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br></code></pre></td></tr></table></figure>\n<p>字典的相关方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">dict</span> = &#123;<span class=\"hljs-string\">&#x27;Name&#x27;</span>: <span class=\"hljs-string\">&#x27;Zara&#x27;</span>, <span class=\"hljs-string\">&#x27;Age&#x27;</span>: <span class=\"hljs-number\">7</span>, <span class=\"hljs-string\">&#x27;Class&#x27;</span>: <span class=\"hljs-string\">&#x27;First&#x27;</span>&#125;<br> <br><span class=\"hljs-keyword\">del</span> <span class=\"hljs-built_in\">dict</span>[<span class=\"hljs-string\">&#x27;Name&#x27;</span>]  <span class=\"hljs-comment\"># 删除键是&#x27;Name&#x27;的条目</span><br><span class=\"hljs-built_in\">dict</span>.clear()      <span class=\"hljs-comment\"># 清空字典所有条目</span><br><span class=\"hljs-keyword\">del</span> <span class=\"hljs-built_in\">dict</span>          <span class=\"hljs-comment\"># 删除字典</span><br></code></pre></td></tr></table></figure>\n<p>Python字典包含了以下内置方法：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">序号</th>\n<th style=\"text-align:left\">函数及描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">1</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-clear.html\">dict.clear()</a> 删除字典内所有元素</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-copy.html\">dict.copy()</a> 返回一个字典的浅复制</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">3</td>\n<td style=\"text-align:left\">[dict.fromkeys(seq<a href=\"https://www.runoob.com/python/att-dictionary-fromkeys.html\">, val])</a> 创建一个新字典，以序列 seq 中元素做字典的键，val 为字典所有键对应的初始值</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">4</td>\n<td style=\"text-align:left\"><strong><a href=\"https://www.runoob.com/python/att-dictionary-get.html\">dict.get(key, default=None)</a> 返回指定键的值，如果值不在字典中返回default值</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">5</td>\n<td style=\"text-align:left\"><strong><a href=\"https://www.runoob.com/python/att-dictionary-has_key.html\">dict.has_key(key)</a> 如果键在字典dict里返回true，否则返回false</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">6</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-items.html\">dict.items()</a> 以列表返回可遍历的(键, 值) 元组数组</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">7</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-keys.html\">dict.keys()</a> 以列表返回一个字典所有的键</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-setdefault.html\">dict.setdefault(key, default=None)</a> 和get()类似, 但如果键不存在于字典中，将会添加键并将值设为default</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">9</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-update.html\">dict.update(dict2)</a> 把字典dict2的键/值对更新到dict里</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">10</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/att-dictionary-values.html\">dict.values()</a> 以列表返回字典中的所有值</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">11</td>\n<td style=\"text-align:left\">[pop(key<a href=\"https://www.runoob.com/python/python-att-dictionary-pop.html\">,default])</a> 删除字典给定键 key 所对应的值，返回值为被删除的值。key值必须给出。 否则，返回default值。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">12</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python/python-att-dictionary-popitem.html\">popitem()</a> 返回并删除字典中的最后一对键和值。</td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"摩尔投票法：核心理念为票数正负抵消，时间复杂度为O-N-空间复杂度为O-1-。\">摩尔投票法：核心理念为票数正负抵消，时间复杂度为O(N),空间复杂度为O(1)。</h5>\n<ul>\n<li>推论1：将指定的众数元素标记为+1，其他元素标记为-1，则所有数字的票数和大于0.</li>\n<li>推论2:  若数组的前a个数字的票数和为0，则剩余的n-a个数字的票数之和一定大于0，即（n-a）个数字的众数仍为x，可以直接不考虑前面a个数字了。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">majorityElement</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        votes = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span> votes == <span class=\"hljs-number\">0</span>: x = num<br>            votes += <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">if</span> num == x <span class=\"hljs-keyword\">else</span> -<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> x<br><br></code></pre></td></tr></table></figure>\n<p><strong>拓展</strong>： 由于题目说明 给定的数组总是存在多数元素 ，因此本题不用考虑 数组不存在众数 的情况。若考虑，需要加入一个 “验证环节” ，遍历数组 nums 统计 x 的数量。</p>\n<p><strong>若 x 的数量超过数组长度一半，则返回 x ；</strong><br>\n否则，返回未找到众数；<br>\n时间和空间复杂度不变，仍为 O(N) 和 O(1) 。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">majorityElement</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        votes, count = <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span> votes == <span class=\"hljs-number\">0</span>: x = num<br>            votes += <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">if</span> num == x <span class=\"hljs-keyword\">else</span> -<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-comment\"># 验证 x 是否为众数</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span> num == x: count += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> x <span class=\"hljs-keyword\">if</span> count &gt; <span class=\"hljs-built_in\">len</span>(nums) // <span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-comment\"># 当无众数时返回 0</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer40 最小的k个数","date":"2021-08-24T13:17:18.000Z","_content":"\n> 最小的k个数\n\n## 题目\n\n输入整数数组 arr ，找出其中最小的 k 个数。例如，输入4、5、1、6、2、7、3、8这8个数字，则最小的4个数字是1、2、3、4。\n\n### 示例 1：\n\n```\n输入：arr = [3,2,1], k = 2\n输出：[1,2] 或者 [2,1]\n```\n\n### 示例 2：\n\n```\n输入：arr = [0,1,2,1], k = 1\n输出：[0]\n```\n\n### 提示：\n\n- 0 <= k <= arr.length <= 10000\n- 0 <= arr[i] <= 10000\n\n## 题解\n\n使用封装的sorted函数，这种方法需要排序O(NlogN)\n\n```python\nclass Solution:\n    def getLeastNumbers(self, arr: List[int], k: int) -> List[int]:\n         return sorted(arr)[0:k]\n```\n\n还有一种方法是采取快速排序的思想，可以将复杂度降到O(N)\n首先复习一下快速排序的代码。K神的方法是i<j的情况下就进行比对，这种方式要注意j的收缩要在i的扩张之前；这样可以保证最后停止的时候i，j指向都是比较小的那个数值。(最后交换时i,j都可以，因为结束时一定有i和j相等)\n\n```python\ndef quicksort(l,r):\n    if l>=r: return\n    pivot = arr[l]\n    i,j = l,r\n    while (i<j):\n        while i<j and arr[j]>=pivot:j -= 1 #在i<j的约束下 j在i的移动前面\n        while i<j and arr[i]<=pivot:i += 1         \n        arr[i],arr[j] = arr[j],arr[i]\n    arr[l], arr[j] = arr[j], arr[l]\n    quicksort(l,j-1)\n    quicksort(j+1,r)\n```\n\n最后交换的时候只能是j并且一定要保证i和j不可越界，也就是说在i和j到临界值的时候就不用移动了\n\n```python\ndef quicksort(l,r):\n    if l>=r: return\n    pivot = arr[l]\n    i,j = l,r\n    while (True):\n        while j>l and arr[j]>=pivot:j -= 1 \n        while i<r and arr[i]<=pivot:i += 1   \n        if(i>=j):break\n        arr[i],arr[j] = arr[j],arr[i]\n    arr[l], arr[j] = arr[j], arr[l]\n    quicksort(l,j-1)\n    quicksort(j+1,r)\n```\n\n那么这个题目借用这种思想只要找到这个pivot他原本所在的位置下标为k，那么他的左边的部分就是要找的部分哦~~:wink:\n\n```python\nclass Solution:\n    def getLeastNumbers(self, arr: List[int], k: int) -> List[int]:\n        def quicksort(l,r):\n            if l>=r: return\n            pivot = arr[l]\n            i,j = l,r\n            while (i<j):\n                while i<j and arr[j]>=pivot:j -= 1 #在i<j的约束下 j在i的移动前面\n                while i<j and arr[i]<=pivot:i += 1         \n                arr[i],arr[j] = arr[j],arr[i]\n            arr[l], arr[j] = arr[j], arr[l]\n            if(k>j):quicksort(j+1,r)\n            if(k<j):quicksort(l,j-1)            \n        quicksort(0,len(arr)-1)\n        return arr[:k]\n```\n\n这种方法的复杂度是N+N/2+N/4+N/8+.... = N(1/2+1/4+1/8+....) ~ 2N\n","source":"_posts/leetcode/leetcode-offer40.md","raw":"---\ntitle: 剑指offer40 最小的k个数\ntags: [剑指,快速排序]\ncategories: [剑指,快速排序]\ndate: 2021-08-24 21:17:18\n---\n\n> 最小的k个数\n\n## 题目\n\n输入整数数组 arr ，找出其中最小的 k 个数。例如，输入4、5、1、6、2、7、3、8这8个数字，则最小的4个数字是1、2、3、4。\n\n### 示例 1：\n\n```\n输入：arr = [3,2,1], k = 2\n输出：[1,2] 或者 [2,1]\n```\n\n### 示例 2：\n\n```\n输入：arr = [0,1,2,1], k = 1\n输出：[0]\n```\n\n### 提示：\n\n- 0 <= k <= arr.length <= 10000\n- 0 <= arr[i] <= 10000\n\n## 题解\n\n使用封装的sorted函数，这种方法需要排序O(NlogN)\n\n```python\nclass Solution:\n    def getLeastNumbers(self, arr: List[int], k: int) -> List[int]:\n         return sorted(arr)[0:k]\n```\n\n还有一种方法是采取快速排序的思想，可以将复杂度降到O(N)\n首先复习一下快速排序的代码。K神的方法是i<j的情况下就进行比对，这种方式要注意j的收缩要在i的扩张之前；这样可以保证最后停止的时候i，j指向都是比较小的那个数值。(最后交换时i,j都可以，因为结束时一定有i和j相等)\n\n```python\ndef quicksort(l,r):\n    if l>=r: return\n    pivot = arr[l]\n    i,j = l,r\n    while (i<j):\n        while i<j and arr[j]>=pivot:j -= 1 #在i<j的约束下 j在i的移动前面\n        while i<j and arr[i]<=pivot:i += 1         \n        arr[i],arr[j] = arr[j],arr[i]\n    arr[l], arr[j] = arr[j], arr[l]\n    quicksort(l,j-1)\n    quicksort(j+1,r)\n```\n\n最后交换的时候只能是j并且一定要保证i和j不可越界，也就是说在i和j到临界值的时候就不用移动了\n\n```python\ndef quicksort(l,r):\n    if l>=r: return\n    pivot = arr[l]\n    i,j = l,r\n    while (True):\n        while j>l and arr[j]>=pivot:j -= 1 \n        while i<r and arr[i]<=pivot:i += 1   \n        if(i>=j):break\n        arr[i],arr[j] = arr[j],arr[i]\n    arr[l], arr[j] = arr[j], arr[l]\n    quicksort(l,j-1)\n    quicksort(j+1,r)\n```\n\n那么这个题目借用这种思想只要找到这个pivot他原本所在的位置下标为k，那么他的左边的部分就是要找的部分哦~~:wink:\n\n```python\nclass Solution:\n    def getLeastNumbers(self, arr: List[int], k: int) -> List[int]:\n        def quicksort(l,r):\n            if l>=r: return\n            pivot = arr[l]\n            i,j = l,r\n            while (i<j):\n                while i<j and arr[j]>=pivot:j -= 1 #在i<j的约束下 j在i的移动前面\n                while i<j and arr[i]<=pivot:i += 1         \n                arr[i],arr[j] = arr[j],arr[i]\n            arr[l], arr[j] = arr[j], arr[l]\n            if(k>j):quicksort(j+1,r)\n            if(k<j):quicksort(l,j-1)            \n        quicksort(0,len(arr)-1)\n        return arr[:k]\n```\n\n这种方法的复杂度是N+N/2+N/4+N/8+.... = N(1/2+1/4+1/8+....) ~ 2N\n","slug":"leetcode/leetcode-offer40","published":1,"updated":"2022-01-18T08:10:17.089Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0aj004oast91465gvc0","content":"<blockquote>\n<p>最小的k个数</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入整数数组 arr ，找出其中最小的 k 个数。例如，输入4、5、1、6、2、7、3、8这8个数字，则最小的4个数字是1、2、3、4。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：arr = <span class=\"hljs-comment\">[3,2,1]</span>, k = 2<br>输出：<span class=\"hljs-comment\">[1,2]</span> 或者 <span class=\"hljs-comment\">[2,1]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：arr = <span class=\"hljs-comment\">[0,1,2,1]</span>, k = 1<br>输出：<span class=\"hljs-comment\">[0]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= k &lt;= arr.length &lt;= 10000</li>\n<li>0 &lt;= arr[i] &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用封装的sorted函数，这种方法需要排序O(NlogN)</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">getLeastNumbers</span>(<span class=\"hljs-params\">self, arr: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], k: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>         <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">sorted</span>(arr)[<span class=\"hljs-number\">0</span>:k]<br></code></pre></td></tr></tbody></table></figure>\n<p>还有一种方法是采取快速排序的思想，可以将复杂度降到O(N)<br>\n首先复习一下快速排序的代码。K神的方法是i&lt;j的情况下就进行比对，这种方式要注意j的收缩要在i的扩张之前；这样可以保证最后停止的时候i，j指向都是比较小的那个数值。(最后交换时i,j都可以，因为结束时一定有i和j相等)</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">quicksort</span>(<span class=\"hljs-params\">l,r</span>):</span><br>    <span class=\"hljs-keyword\">if</span> l&gt;=r: <span class=\"hljs-keyword\">return</span><br>    pivot = arr[l]<br>    i,j = l,r<br>    <span class=\"hljs-keyword\">while</span> (i&lt;j):<br>        <span class=\"hljs-keyword\">while</span> i&lt;j <span class=\"hljs-keyword\">and</span> arr[j]&gt;=pivot:j -= <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#在i&lt;j的约束下 j在i的移动前面</span><br>        <span class=\"hljs-keyword\">while</span> i&lt;j <span class=\"hljs-keyword\">and</span> arr[i]&lt;=pivot:i += <span class=\"hljs-number\">1</span>         <br>        arr[i],arr[j] = arr[j],arr[i]<br>    arr[l], arr[j] = arr[j], arr[l]<br>    quicksort(l,j-<span class=\"hljs-number\">1</span>)<br>    quicksort(j+<span class=\"hljs-number\">1</span>,r)<br></code></pre></td></tr></tbody></table></figure>\n<p>最后交换的时候只能是j并且一定要保证i和j不可越界，也就是说在i和j到临界值的时候就不用移动了</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">quicksort</span>(<span class=\"hljs-params\">l,r</span>):</span><br>    <span class=\"hljs-keyword\">if</span> l&gt;=r: <span class=\"hljs-keyword\">return</span><br>    pivot = arr[l]<br>    i,j = l,r<br>    <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">True</span>):<br>        <span class=\"hljs-keyword\">while</span> j&gt;l <span class=\"hljs-keyword\">and</span> arr[j]&gt;=pivot:j -= <span class=\"hljs-number\">1</span> <br>        <span class=\"hljs-keyword\">while</span> i&lt;r <span class=\"hljs-keyword\">and</span> arr[i]&lt;=pivot:i += <span class=\"hljs-number\">1</span>   <br>        <span class=\"hljs-keyword\">if</span>(i&gt;=j):<span class=\"hljs-keyword\">break</span><br>        arr[i],arr[j] = arr[j],arr[i]<br>    arr[l], arr[j] = arr[j], arr[l]<br>    quicksort(l,j-<span class=\"hljs-number\">1</span>)<br>    quicksort(j+<span class=\"hljs-number\">1</span>,r)<br></code></pre></td></tr></tbody></table></figure>\n<p>那么这个题目借用这种思想只要找到这个pivot他原本所在的位置下标为k，那么他的左边的部分就是要找的部分哦~~😉</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">getLeastNumbers</span>(<span class=\"hljs-params\">self, arr: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], k: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">quicksort</span>(<span class=\"hljs-params\">l,r</span>):</span><br>            <span class=\"hljs-keyword\">if</span> l&gt;=r: <span class=\"hljs-keyword\">return</span><br>            pivot = arr[l]<br>            i,j = l,r<br>            <span class=\"hljs-keyword\">while</span> (i&lt;j):<br>                <span class=\"hljs-keyword\">while</span> i&lt;j <span class=\"hljs-keyword\">and</span> arr[j]&gt;=pivot:j -= <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#在i&lt;j的约束下 j在i的移动前面</span><br>                <span class=\"hljs-keyword\">while</span> i&lt;j <span class=\"hljs-keyword\">and</span> arr[i]&lt;=pivot:i += <span class=\"hljs-number\">1</span>         <br>                arr[i],arr[j] = arr[j],arr[i]<br>            arr[l], arr[j] = arr[j], arr[l]<br>            <span class=\"hljs-keyword\">if</span>(k&gt;j):quicksort(j+<span class=\"hljs-number\">1</span>,r)<br>            <span class=\"hljs-keyword\">if</span>(k&lt;j):quicksort(l,j-<span class=\"hljs-number\">1</span>)            <br>        quicksort(<span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">len</span>(arr)-<span class=\"hljs-number\">1</span>)<br>        <span class=\"hljs-keyword\">return</span> arr[:k]<br></code></pre></td></tr></tbody></table></figure>\n<p>这种方法的复杂度是N+N/2+N/4+N/8+… = N(1/2+1/4+1/8+…) ~ 2N</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>最小的k个数</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入整数数组 arr ，找出其中最小的 k 个数。例如，输入4、5、1、6、2、7、3、8这8个数字，则最小的4个数字是1、2、3、4。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：arr = <span class=\"hljs-comment\">[3,2,1]</span>, k = 2<br>输出：<span class=\"hljs-comment\">[1,2]</span> 或者 <span class=\"hljs-comment\">[2,1]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：arr = <span class=\"hljs-comment\">[0,1,2,1]</span>, k = 1<br>输出：<span class=\"hljs-comment\">[0]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= k &lt;= arr.length &lt;= 10000</li>\n<li>0 &lt;= arr[i] &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用封装的sorted函数，这种方法需要排序O(NlogN)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">getLeastNumbers</span>(<span class=\"hljs-params\">self, arr: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], k: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>         <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">sorted</span>(arr)[<span class=\"hljs-number\">0</span>:k]<br></code></pre></td></tr></table></figure>\n<p>还有一种方法是采取快速排序的思想，可以将复杂度降到O(N)<br>\n首先复习一下快速排序的代码。K神的方法是i&lt;j的情况下就进行比对，这种方式要注意j的收缩要在i的扩张之前；这样可以保证最后停止的时候i，j指向都是比较小的那个数值。(最后交换时i,j都可以，因为结束时一定有i和j相等)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">quicksort</span>(<span class=\"hljs-params\">l,r</span>):</span><br>    <span class=\"hljs-keyword\">if</span> l&gt;=r: <span class=\"hljs-keyword\">return</span><br>    pivot = arr[l]<br>    i,j = l,r<br>    <span class=\"hljs-keyword\">while</span> (i&lt;j):<br>        <span class=\"hljs-keyword\">while</span> i&lt;j <span class=\"hljs-keyword\">and</span> arr[j]&gt;=pivot:j -= <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#在i&lt;j的约束下 j在i的移动前面</span><br>        <span class=\"hljs-keyword\">while</span> i&lt;j <span class=\"hljs-keyword\">and</span> arr[i]&lt;=pivot:i += <span class=\"hljs-number\">1</span>         <br>        arr[i],arr[j] = arr[j],arr[i]<br>    arr[l], arr[j] = arr[j], arr[l]<br>    quicksort(l,j-<span class=\"hljs-number\">1</span>)<br>    quicksort(j+<span class=\"hljs-number\">1</span>,r)<br></code></pre></td></tr></table></figure>\n<p>最后交换的时候只能是j并且一定要保证i和j不可越界，也就是说在i和j到临界值的时候就不用移动了</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">quicksort</span>(<span class=\"hljs-params\">l,r</span>):</span><br>    <span class=\"hljs-keyword\">if</span> l&gt;=r: <span class=\"hljs-keyword\">return</span><br>    pivot = arr[l]<br>    i,j = l,r<br>    <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">True</span>):<br>        <span class=\"hljs-keyword\">while</span> j&gt;l <span class=\"hljs-keyword\">and</span> arr[j]&gt;=pivot:j -= <span class=\"hljs-number\">1</span> <br>        <span class=\"hljs-keyword\">while</span> i&lt;r <span class=\"hljs-keyword\">and</span> arr[i]&lt;=pivot:i += <span class=\"hljs-number\">1</span>   <br>        <span class=\"hljs-keyword\">if</span>(i&gt;=j):<span class=\"hljs-keyword\">break</span><br>        arr[i],arr[j] = arr[j],arr[i]<br>    arr[l], arr[j] = arr[j], arr[l]<br>    quicksort(l,j-<span class=\"hljs-number\">1</span>)<br>    quicksort(j+<span class=\"hljs-number\">1</span>,r)<br></code></pre></td></tr></table></figure>\n<p>那么这个题目借用这种思想只要找到这个pivot他原本所在的位置下标为k，那么他的左边的部分就是要找的部分哦~~😉</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">getLeastNumbers</span>(<span class=\"hljs-params\">self, arr: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], k: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">quicksort</span>(<span class=\"hljs-params\">l,r</span>):</span><br>            <span class=\"hljs-keyword\">if</span> l&gt;=r: <span class=\"hljs-keyword\">return</span><br>            pivot = arr[l]<br>            i,j = l,r<br>            <span class=\"hljs-keyword\">while</span> (i&lt;j):<br>                <span class=\"hljs-keyword\">while</span> i&lt;j <span class=\"hljs-keyword\">and</span> arr[j]&gt;=pivot:j -= <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#在i&lt;j的约束下 j在i的移动前面</span><br>                <span class=\"hljs-keyword\">while</span> i&lt;j <span class=\"hljs-keyword\">and</span> arr[i]&lt;=pivot:i += <span class=\"hljs-number\">1</span>         <br>                arr[i],arr[j] = arr[j],arr[i]<br>            arr[l], arr[j] = arr[j], arr[l]<br>            <span class=\"hljs-keyword\">if</span>(k&gt;j):quicksort(j+<span class=\"hljs-number\">1</span>,r)<br>            <span class=\"hljs-keyword\">if</span>(k&lt;j):quicksort(l,j-<span class=\"hljs-number\">1</span>)            <br>        quicksort(<span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">len</span>(arr)-<span class=\"hljs-number\">1</span>)<br>        <span class=\"hljs-keyword\">return</span> arr[:k]<br></code></pre></td></tr></table></figure>\n<p>这种方法的复杂度是N+N/2+N/4+N/8+… = N(1/2+1/4+1/8+…) ~ 2N</p>\n"},{"title":"剑指offer42 连续子数组最大和","date":"2021-10-06T06:54:54.000Z","_content":"\n>连续子数组最大和\n\n## 题目\n\n输入一个整型数组，数组中的一个或连续多个整数组成一个子数组。求所有子数组的和的最大值。\n\n要求时间复杂度为O(n)。\n\n### 示例 1：\n\n```\n输入: nums = [-2,1,-3,4,-1,2,1,-5,4]\n输出: 6\n解释: 连续子数组 [4,-1,2,1] 的和最大，为 6。\n```\n\n### 提示：\n\n- 1 <= arr.length <= 10^5\n- -100 <= arr[i] <= 100\n\n## 题解\n使用数组dp[i]用来表示从0到i下标元素的子数组中，包含i元素的最大和，例如：原始数列num=[-2,1,-3,4,-1,2,1,-5,4]，dp为[-2, 1, -2, 4, 3, 5, 6, 1, 5]。注意从下标1开始，dp[i] = num[i] + max(0, dp[i-1])，如果前项的最大和(相邻的子数组)对此项**有增益**就添加进去，否则就直接num[i]。\n\n\n```python\nclass Solution:\n    def maxSubArray(self, nums: List[int]) -> int:\n        for i in range(1, len(nums)):\n            nums[i] += max(nums[i - 1], 0)\n        return max(nums)\n```\n\n","source":"_posts/leetcode/leetcode-offer42.md","raw":"---\ntitle: 剑指offer42 连续子数组最大和\ntags: [剑指,动态规划]\ncategories: [剑指,动态规划]\ndate: 2021-10-06 14:54:54\n---\n\n>连续子数组最大和\n\n## 题目\n\n输入一个整型数组，数组中的一个或连续多个整数组成一个子数组。求所有子数组的和的最大值。\n\n要求时间复杂度为O(n)。\n\n### 示例 1：\n\n```\n输入: nums = [-2,1,-3,4,-1,2,1,-5,4]\n输出: 6\n解释: 连续子数组 [4,-1,2,1] 的和最大，为 6。\n```\n\n### 提示：\n\n- 1 <= arr.length <= 10^5\n- -100 <= arr[i] <= 100\n\n## 题解\n使用数组dp[i]用来表示从0到i下标元素的子数组中，包含i元素的最大和，例如：原始数列num=[-2,1,-3,4,-1,2,1,-5,4]，dp为[-2, 1, -2, 4, 3, 5, 6, 1, 5]。注意从下标1开始，dp[i] = num[i] + max(0, dp[i-1])，如果前项的最大和(相邻的子数组)对此项**有增益**就添加进去，否则就直接num[i]。\n\n\n```python\nclass Solution:\n    def maxSubArray(self, nums: List[int]) -> int:\n        for i in range(1, len(nums)):\n            nums[i] += max(nums[i - 1], 0)\n        return max(nums)\n```\n\n","slug":"leetcode/leetcode-offer42","published":1,"updated":"2022-01-18T08:10:17.090Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0al004sast9a3db1lab","content":"<blockquote>\n<p>连续子数组最大和</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个整型数组，数组中的一个或连续多个整数组成一个子数组。求所有子数组的和的最大值。</p>\n<p>要求时间复杂度为O(n)。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight subunit\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs subunit\">输入: nums = [<span class=\"hljs-string\">-2</span>,1,<span class=\"hljs-string\">-3</span>,4,<span class=\"hljs-string\">-1</span>,2,1,<span class=\"hljs-string\">-5</span>,4]<br>输出: 6<br>解释: 连续子数组 [4,<span class=\"hljs-string\">-1</span>,2,1] 的和最大，为 6。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= arr.length &lt;= 10^5</li>\n<li>-100 &lt;= arr[i] &lt;= 100</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用数组dp[i]用来表示从0到i下标元素的子数组中，包含i元素的最大和，例如：原始数列num=[-2,1,-3,4,-1,2,1,-5,4]，dp为[-2, 1, -2, 4, 3, 5, 6, 1, 5]。注意从下标1开始，dp[i] = num[i] + max(0, dp[i-1])，如果前项的最大和(相邻的子数组)对此项<strong>有增益</strong>就添加进去，否则就直接num[i]。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">maxSubArray</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-built_in\">len</span>(nums)):<br>            nums[i] += <span class=\"hljs-built_in\">max</span>(nums[i - <span class=\"hljs-number\">1</span>], <span class=\"hljs-number\">0</span>)<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">max</span>(nums)<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>连续子数组最大和</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个整型数组，数组中的一个或连续多个整数组成一个子数组。求所有子数组的和的最大值。</p>\n<p>要求时间复杂度为O(n)。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs subunit\">输入: nums = [<span class=\"hljs-string\">-2</span>,1,<span class=\"hljs-string\">-3</span>,4,<span class=\"hljs-string\">-1</span>,2,1,<span class=\"hljs-string\">-5</span>,4]<br>输出: 6<br>解释: 连续子数组 [4,<span class=\"hljs-string\">-1</span>,2,1] 的和最大，为 6。<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= arr.length &lt;= 10^5</li>\n<li>-100 &lt;= arr[i] &lt;= 100</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用数组dp[i]用来表示从0到i下标元素的子数组中，包含i元素的最大和，例如：原始数列num=[-2,1,-3,4,-1,2,1,-5,4]，dp为[-2, 1, -2, 4, 3, 5, 6, 1, 5]。注意从下标1开始，dp[i] = num[i] + max(0, dp[i-1])，如果前项的最大和(相邻的子数组)对此项<strong>有增益</strong>就添加进去，否则就直接num[i]。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">maxSubArray</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-built_in\">len</span>(nums)):<br>            nums[i] += <span class=\"hljs-built_in\">max</span>(nums[i - <span class=\"hljs-number\">1</span>], <span class=\"hljs-number\">0</span>)<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">max</span>(nums)<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer45 把数组排成最小的数","date":"2021-12-28T06:07:37.000Z","_content":"\n> 把数组排成最小的数\n\n## 题目\n输入一个非负整数数组，把数组里所有数字拼接起来排成一个数，打印能拼接出的所有数字中最小的一个。\n\n\n### 示例 1：\n\n```\n输入: [10,2]\n输出: \"102\"\n```\n\n### 示例 2：\n\n```\n输入: [3,30,34,5,9]\n输出: \"3033459\"\n```\n\n### 提示：\n\n- 0 < nums.length <= 100\n- 输出结果可能非常大，所以你需要返回一个字符串而不是整数\n- 拼接起来的数字可能会有前导 0，最后结果不需要去掉前导 0\n\n## 题解\n\n方法主要是用到自定义排序；\n在`python3`中的自定义排序要重载`functools.cmp_to_key`函数，但是这里的规则是**默认小的在前面**；所以在比较的时候重载`mycmp`方法，a,b顺序满足条件时返回-1(num<0)\n```python\ndef cmp_to_key(mycmp):\n    \"\"\"Convert a cmp= function into a key= function\"\"\"\n    class K(object):\n        __slots__ = ['obj']\n        def __init__(self, obj):\n            self.obj = obj\n        def __lt__(self, other):\n            return mycmp(self.obj, other.obj) < 0\n        def __gt__(self, other):\n            return mycmp(self.obj, other.obj) > 0\n        def __eq__(self, other):\n            return mycmp(self.obj, other.obj) == 0\n        def __le__(self, other):\n            return mycmp(self.obj, other.obj) <= 0\n        def __ge__(self, other):\n            return mycmp(self.obj, other.obj) >= 0\n        __hash__ = None\n    return K\n```\n\n另外，直接将ab拼接进行比较大小，这里直接使用字符串比较大小更快哦~\n```python\nclass Solution:\n    def minNumber(self, nums: List[int]) -> str:\n        def funccmp(a,b):\n            x,y = a+b,b+a\n            if int(x)<int(y): return -1\n            else: return 1\n\n        def sort_rule(x, y):\n            a, b = x + y, y + x #可以直接对字符串比较，更快\n            if a > b: return 1\n            elif a < b: return -1\n            else: return 0\n\n        s = [str(x) for x in nums]\n        t = sorted(s,key = functools.cmp_to_key(sort_rule))    \n        #重载比较函数，在python的重载cmp_to_key时默认是小的元素排在前面，所以在满足条件时返回-1，其他情况大于-1即可\n        return ''.join(t)\n```\n\n还有两个函数需要掌握\n- `''.join(t)`可以使用指定的字符串连接数组\n- 对列表循环操作创建可以使用`[func(x) for x in nums]` \n- 也可以使用map函数 `list(map(func,nums))`或者lambda函数`list(map(lambda x:...,nums))`","source":"_posts/leetcode/leetcode-offer45.md","raw":"---\ntitle: 剑指offer45 把数组排成最小的数\ntags: [剑指,排序]\ncategories:  [剑指,排序]\ndate: 2021-12-28 14:07:37\n---\n\n> 把数组排成最小的数\n\n## 题目\n输入一个非负整数数组，把数组里所有数字拼接起来排成一个数，打印能拼接出的所有数字中最小的一个。\n\n\n### 示例 1：\n\n```\n输入: [10,2]\n输出: \"102\"\n```\n\n### 示例 2：\n\n```\n输入: [3,30,34,5,9]\n输出: \"3033459\"\n```\n\n### 提示：\n\n- 0 < nums.length <= 100\n- 输出结果可能非常大，所以你需要返回一个字符串而不是整数\n- 拼接起来的数字可能会有前导 0，最后结果不需要去掉前导 0\n\n## 题解\n\n方法主要是用到自定义排序；\n在`python3`中的自定义排序要重载`functools.cmp_to_key`函数，但是这里的规则是**默认小的在前面**；所以在比较的时候重载`mycmp`方法，a,b顺序满足条件时返回-1(num<0)\n```python\ndef cmp_to_key(mycmp):\n    \"\"\"Convert a cmp= function into a key= function\"\"\"\n    class K(object):\n        __slots__ = ['obj']\n        def __init__(self, obj):\n            self.obj = obj\n        def __lt__(self, other):\n            return mycmp(self.obj, other.obj) < 0\n        def __gt__(self, other):\n            return mycmp(self.obj, other.obj) > 0\n        def __eq__(self, other):\n            return mycmp(self.obj, other.obj) == 0\n        def __le__(self, other):\n            return mycmp(self.obj, other.obj) <= 0\n        def __ge__(self, other):\n            return mycmp(self.obj, other.obj) >= 0\n        __hash__ = None\n    return K\n```\n\n另外，直接将ab拼接进行比较大小，这里直接使用字符串比较大小更快哦~\n```python\nclass Solution:\n    def minNumber(self, nums: List[int]) -> str:\n        def funccmp(a,b):\n            x,y = a+b,b+a\n            if int(x)<int(y): return -1\n            else: return 1\n\n        def sort_rule(x, y):\n            a, b = x + y, y + x #可以直接对字符串比较，更快\n            if a > b: return 1\n            elif a < b: return -1\n            else: return 0\n\n        s = [str(x) for x in nums]\n        t = sorted(s,key = functools.cmp_to_key(sort_rule))    \n        #重载比较函数，在python的重载cmp_to_key时默认是小的元素排在前面，所以在满足条件时返回-1，其他情况大于-1即可\n        return ''.join(t)\n```\n\n还有两个函数需要掌握\n- `''.join(t)`可以使用指定的字符串连接数组\n- 对列表循环操作创建可以使用`[func(x) for x in nums]` \n- 也可以使用map函数 `list(map(func,nums))`或者lambda函数`list(map(lambda x:...,nums))`","slug":"leetcode/leetcode-offer45","published":1,"updated":"2022-01-18T08:10:17.090Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0am004uast91q9e0aty","content":"<blockquote>\n<p>把数组排成最小的数</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个非负整数数组，把数组里所有数字拼接起来排成一个数，打印能拼接出的所有数字中最小的一个。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight makefile\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: [10,2]</span><br><span class=\"hljs-section\">输出: \"102\"</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight dns\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入: [<span class=\"hljs-number\">3,30,34,5</span>,<span class=\"hljs-number\">9</span>]<br>输出: \"<span class=\"hljs-number\">3033459</span>\"<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt; nums.length &lt;= 100</li>\n<li>输出结果可能非常大，所以你需要返回一个字符串而不是整数</li>\n<li>拼接起来的数字可能会有前导 0，最后结果不需要去掉前导 0</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>方法主要是用到自定义排序；<br>\n在<code>python3</code>中的自定义排序要重载<code>functools.cmp_to_key</code>函数，但是这里的规则是<strong>默认小的在前面</strong>；所以在比较的时候重载<code>mycmp</code>方法，a,b顺序满足条件时返回-1(num&lt;0)</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">cmp_to_key</span>(<span class=\"hljs-params\">mycmp</span>):</span><br>    <span class=\"hljs-string\">\"\"\"Convert a cmp= function into a key= function\"\"\"</span><br>    <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">K</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">object</span></span>):</span><br>        __slots__ = [<span class=\"hljs-string\">'obj'</span>]<br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, obj</span>):</span><br>            self.obj = obj<br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__lt__</span>(<span class=\"hljs-params\">self, other</span>):</span><br>            <span class=\"hljs-keyword\">return</span> mycmp(self.obj, other.obj) &lt; <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__gt__</span>(<span class=\"hljs-params\">self, other</span>):</span><br>            <span class=\"hljs-keyword\">return</span> mycmp(self.obj, other.obj) &gt; <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__eq__</span>(<span class=\"hljs-params\">self, other</span>):</span><br>            <span class=\"hljs-keyword\">return</span> mycmp(self.obj, other.obj) == <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__le__</span>(<span class=\"hljs-params\">self, other</span>):</span><br>            <span class=\"hljs-keyword\">return</span> mycmp(self.obj, other.obj) &lt;= <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__ge__</span>(<span class=\"hljs-params\">self, other</span>):</span><br>            <span class=\"hljs-keyword\">return</span> mycmp(self.obj, other.obj) &gt;= <span class=\"hljs-number\">0</span><br>        __hash__ = <span class=\"hljs-literal\">None</span><br>    <span class=\"hljs-keyword\">return</span> K<br></code></pre></td></tr></tbody></table></figure>\n<p>另外，直接将ab拼接进行比较大小，这里直接使用字符串比较大小更快哦~</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">minNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">funccmp</span>(<span class=\"hljs-params\">a,b</span>):</span><br>            x,y = a+b,b+a<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">int</span>(x)&lt;<span class=\"hljs-built_in\">int</span>(y): <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span><br><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">sort_rule</span>(<span class=\"hljs-params\">x, y</span>):</span><br>            a, b = x + y, y + x <span class=\"hljs-comment\">#可以直接对字符串比较，更快</span><br>            <span class=\"hljs-keyword\">if</span> a &gt; b: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">elif</span> a &lt; b: <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br><br>        s = [<span class=\"hljs-built_in\">str</span>(x) <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> nums]<br>        t = <span class=\"hljs-built_in\">sorted</span>(s,key = functools.cmp_to_key(sort_rule))    <br>        <span class=\"hljs-comment\">#重载比较函数，在python的重载cmp_to_key时默认是小的元素排在前面，所以在满足条件时返回-1，其他情况大于-1即可</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">''</span>.join(t)<br></code></pre></td></tr></tbody></table></figure>\n<p>还有两个函数需要掌握</p>\n<ul>\n<li><code>''.join(t)</code>可以使用指定的字符串连接数组</li>\n<li>对列表循环操作创建可以使用<code>[func(x) for x in nums]</code></li>\n<li>也可以使用map函数 <code>list(map(func,nums))</code>或者lambda函数<code>list(map(lambda x:...,nums))</code></li>\n</ul>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>把数组排成最小的数</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个非负整数数组，把数组里所有数字拼接起来排成一个数，打印能拼接出的所有数字中最小的一个。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: [10,2]</span><br><span class=\"hljs-section\">输出: &quot;102&quot;</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight dns\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入: [<span class=\"hljs-number\">3,30,34,5</span>,<span class=\"hljs-number\">9</span>]<br>输出: &quot;<span class=\"hljs-number\">3033459</span>&quot;<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt; nums.length &lt;= 100</li>\n<li>输出结果可能非常大，所以你需要返回一个字符串而不是整数</li>\n<li>拼接起来的数字可能会有前导 0，最后结果不需要去掉前导 0</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>方法主要是用到自定义排序；<br>\n在<code>python3</code>中的自定义排序要重载<code>functools.cmp_to_key</code>函数，但是这里的规则是<strong>默认小的在前面</strong>；所以在比较的时候重载<code>mycmp</code>方法，a,b顺序满足条件时返回-1(num&lt;0)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">cmp_to_key</span>(<span class=\"hljs-params\">mycmp</span>):</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;Convert a cmp= function into a key= function&quot;&quot;&quot;</span><br>    <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">K</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">object</span></span>):</span><br>        __slots__ = [<span class=\"hljs-string\">&#x27;obj&#x27;</span>]<br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, obj</span>):</span><br>            self.obj = obj<br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__lt__</span>(<span class=\"hljs-params\">self, other</span>):</span><br>            <span class=\"hljs-keyword\">return</span> mycmp(self.obj, other.obj) &lt; <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__gt__</span>(<span class=\"hljs-params\">self, other</span>):</span><br>            <span class=\"hljs-keyword\">return</span> mycmp(self.obj, other.obj) &gt; <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__eq__</span>(<span class=\"hljs-params\">self, other</span>):</span><br>            <span class=\"hljs-keyword\">return</span> mycmp(self.obj, other.obj) == <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__le__</span>(<span class=\"hljs-params\">self, other</span>):</span><br>            <span class=\"hljs-keyword\">return</span> mycmp(self.obj, other.obj) &lt;= <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__ge__</span>(<span class=\"hljs-params\">self, other</span>):</span><br>            <span class=\"hljs-keyword\">return</span> mycmp(self.obj, other.obj) &gt;= <span class=\"hljs-number\">0</span><br>        __hash__ = <span class=\"hljs-literal\">None</span><br>    <span class=\"hljs-keyword\">return</span> K<br></code></pre></td></tr></table></figure>\n<p>另外，直接将ab拼接进行比较大小，这里直接使用字符串比较大小更快哦~</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">minNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">funccmp</span>(<span class=\"hljs-params\">a,b</span>):</span><br>            x,y = a+b,b+a<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">int</span>(x)&lt;<span class=\"hljs-built_in\">int</span>(y): <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span><br><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">sort_rule</span>(<span class=\"hljs-params\">x, y</span>):</span><br>            a, b = x + y, y + x <span class=\"hljs-comment\">#可以直接对字符串比较，更快</span><br>            <span class=\"hljs-keyword\">if</span> a &gt; b: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">elif</span> a &lt; b: <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br><br>        s = [<span class=\"hljs-built_in\">str</span>(x) <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> nums]<br>        t = <span class=\"hljs-built_in\">sorted</span>(s,key = functools.cmp_to_key(sort_rule))    <br>        <span class=\"hljs-comment\">#重载比较函数，在python的重载cmp_to_key时默认是小的元素排在前面，所以在满足条件时返回-1，其他情况大于-1即可</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;&#x27;</span>.join(t)<br></code></pre></td></tr></table></figure>\n<p>还有两个函数需要掌握</p>\n<ul>\n<li><code>''.join(t)</code>可以使用指定的字符串连接数组</li>\n<li>对列表循环操作创建可以使用<code>[func(x) for x in nums]</code></li>\n<li>也可以使用map函数 <code>list(map(func,nums))</code>或者lambda函数<code>list(map(lambda x:...,nums))</code></li>\n</ul>\n"},{"title":"剑指offer50 第一个只出现一次的字符","date":"2021-11-15T08:55:46.000Z","_content":"\n>  第一个只出现一次的字符\n\n## 题目\n\n在字符串 s 中找出第一个只出现一次的字符。如果没有，返回一个单空格。 s 只包含小写字母。\n\n### 示例 1：\n\n```\n输入：s = \"abaccdeff\"\n输出：'b'\n```\n\n### 示例 2：\n\n```\n输入：s = \"\" \n输出：' '\n```\n\n### 提示：\n\n- 0 <= s 的长度 <= 50000\n\n## 题解\n\n方法是使用哈希表记录字符状态。\n\n```python\nclass Solution:\n    def firstUniqChar(self, s: str) -> str:\n        flag = {}\n        for i in s:\n            # if(i in flag):\n            #     flag[i] += 1\n            # else:\n            #     flag[i] = 1\n            flag[i] = not i in flag #可以直接标记 没出现则为真\n        for x in flag:\n            if(flag[x]): return x\n        return ' '\n```\n在查看字典中是否存在k键时，python2可以使用`dict.has_key(k)`,但是python3已经删除此函数，直接使用`k in dict`，同时如果遍历dict，也是返回的key哦。\n另外，这里无需记录每个字符的个数，只需要标记真假即可。\n","source":"_posts/leetcode/leetcode-offer50.md","raw":"---\ntitle: 剑指offer50 第一个只出现一次的字符\ntags: [剑指,哈希表]\ncategories: [剑指,哈希表]\ndate: 2021-11-15 16:55:46\n---\n\n>  第一个只出现一次的字符\n\n## 题目\n\n在字符串 s 中找出第一个只出现一次的字符。如果没有，返回一个单空格。 s 只包含小写字母。\n\n### 示例 1：\n\n```\n输入：s = \"abaccdeff\"\n输出：'b'\n```\n\n### 示例 2：\n\n```\n输入：s = \"\" \n输出：' '\n```\n\n### 提示：\n\n- 0 <= s 的长度 <= 50000\n\n## 题解\n\n方法是使用哈希表记录字符状态。\n\n```python\nclass Solution:\n    def firstUniqChar(self, s: str) -> str:\n        flag = {}\n        for i in s:\n            # if(i in flag):\n            #     flag[i] += 1\n            # else:\n            #     flag[i] = 1\n            flag[i] = not i in flag #可以直接标记 没出现则为真\n        for x in flag:\n            if(flag[x]): return x\n        return ' '\n```\n在查看字典中是否存在k键时，python2可以使用`dict.has_key(k)`,但是python3已经删除此函数，直接使用`k in dict`，同时如果遍历dict，也是返回的key哦。\n另外，这里无需记录每个字符的个数，只需要标记真假即可。\n","slug":"leetcode/leetcode-offer50","published":1,"updated":"2022-01-18T08:10:17.091Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ao004xast95cyo39wd","content":"<blockquote>\n<p>第一个只出现一次的字符</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>在字符串 s 中找出第一个只出现一次的字符。如果没有，返回一个单空格。 s 只包含小写字母。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight 1c\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs 1c\">输入：s = <span class=\"hljs-string\">\"abaccdeff\"</span><br>输出：'b'<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight 1c\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs 1c\">输入：s = <span class=\"hljs-string\">\"\"</span> <br>输出：' '<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= s 的长度 &lt;= 50000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>方法是使用哈希表记录字符状态。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">firstUniqChar</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>        flag = {}<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> s:<br>            <span class=\"hljs-comment\"># if(i in flag):</span><br>            <span class=\"hljs-comment\">#     flag[i] += 1</span><br>            <span class=\"hljs-comment\"># else:</span><br>            <span class=\"hljs-comment\">#     flag[i] = 1</span><br>            flag[i] = <span class=\"hljs-keyword\">not</span> i <span class=\"hljs-keyword\">in</span> flag <span class=\"hljs-comment\">#可以直接标记 没出现则为真</span><br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> flag:<br>            <span class=\"hljs-keyword\">if</span>(flag[x]): <span class=\"hljs-keyword\">return</span> x<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">' '</span><br></code></pre></td></tr></tbody></table></figure>\n<p>在查看字典中是否存在k键时，python2可以使用<code>dict.has_key(k)</code>,但是python3已经删除此函数，直接使用<code>k in dict</code>，同时如果遍历dict，也是返回的key哦。<br>\n另外，这里无需记录每个字符的个数，只需要标记真假即可。</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>第一个只出现一次的字符</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>在字符串 s 中找出第一个只出现一次的字符。如果没有，返回一个单空格。 s 只包含小写字母。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight 1c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs 1c\">输入：s = <span class=\"hljs-string\">&quot;abaccdeff&quot;</span><br>输出：&#x27;b&#x27;<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight 1c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs 1c\">输入：s = <span class=\"hljs-string\">&quot;&quot;</span> <br>输出：&#x27; &#x27;<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>0 &lt;= s 的长度 &lt;= 50000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>方法是使用哈希表记录字符状态。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">firstUniqChar</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>        flag = &#123;&#125;<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> s:<br>            <span class=\"hljs-comment\"># if(i in flag):</span><br>            <span class=\"hljs-comment\">#     flag[i] += 1</span><br>            <span class=\"hljs-comment\"># else:</span><br>            <span class=\"hljs-comment\">#     flag[i] = 1</span><br>            flag[i] = <span class=\"hljs-keyword\">not</span> i <span class=\"hljs-keyword\">in</span> flag <span class=\"hljs-comment\">#可以直接标记 没出现则为真</span><br>        <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> flag:<br>            <span class=\"hljs-keyword\">if</span>(flag[x]): <span class=\"hljs-keyword\">return</span> x<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27; &#x27;</span><br></code></pre></td></tr></table></figure>\n<p>在查看字典中是否存在k键时，python2可以使用<code>dict.has_key(k)</code>,但是python3已经删除此函数，直接使用<code>k in dict</code>，同时如果遍历dict，也是返回的key哦。<br>\n另外，这里无需记录每个字符的个数，只需要标记真假即可。</p>\n"},{"title":"剑指offer55-Ⅰ 二叉树的深度","date":"2021-11-16T08:47:38.000Z","_content":"\n> 二叉树的深度\n\n## 题目\n\n输入一棵二叉树的根节点，求该树的深度。从根节点到叶节点依次经过的节点（含根、叶节点）形成树的一条路径，最长路径的长度为树的深度。\n\n### 示例 1：\n例如：\n\n给定二叉树` [3,9,20,null,null,15,7]`,\n\n```\n   3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n返回它的最大深度 3 。\n\n\n### 提示：\n\n- 节点总数 <= 10000\n\n## 题解\n\n#### 解法一\n\n直接深度优先遍历即可，直接利用`maxDepth`函数，注意在内部调用`maxDepth`函数时要使用`self`来调用本函数。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def maxDepth(self, root: TreeNode) -> int:\n        if not root:\n            return 0\n        return 1 + max(self.maxDepth(root.left),self.maxDepth(root.right))\n\n```\n#### 解法二\n\n直接使用层序遍历得到深度。使用两个列表`tmp`和`queue`结合实现“队列”的作用。\n\n```python\nclass Solution:\n    def maxDepth(self, root: TreeNode) -> int:\n        if not root: return 0\n        queue, res = [root], 0        #使用列表实现queue\n        while queue:\n            tmp = []                  #初始化 保存一层的信息\n            for node in queue:        #将queue的下一层都添加到tmp中\n                if node.left: tmp.append(node.left)\n                if node.right: tmp.append(node.right)\n            queue = tmp               #更新\n            res += 1\n        return res\n```\n\n","source":"_posts/leetcode/leetcode-offer55-1.md","raw":"---\ntitle: 剑指offer55-Ⅰ 二叉树的深度\ntags: [剑指,树]\ncategories:  [剑指,树]\ndate: 2021-11-16 16:47:38\n---\n\n> 二叉树的深度\n\n## 题目\n\n输入一棵二叉树的根节点，求该树的深度。从根节点到叶节点依次经过的节点（含根、叶节点）形成树的一条路径，最长路径的长度为树的深度。\n\n### 示例 1：\n例如：\n\n给定二叉树` [3,9,20,null,null,15,7]`,\n\n```\n   3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n返回它的最大深度 3 。\n\n\n### 提示：\n\n- 节点总数 <= 10000\n\n## 题解\n\n#### 解法一\n\n直接深度优先遍历即可，直接利用`maxDepth`函数，注意在内部调用`maxDepth`函数时要使用`self`来调用本函数。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, x):\n#         self.val = x\n#         self.left = None\n#         self.right = None\n\nclass Solution:\n    def maxDepth(self, root: TreeNode) -> int:\n        if not root:\n            return 0\n        return 1 + max(self.maxDepth(root.left),self.maxDepth(root.right))\n\n```\n#### 解法二\n\n直接使用层序遍历得到深度。使用两个列表`tmp`和`queue`结合实现“队列”的作用。\n\n```python\nclass Solution:\n    def maxDepth(self, root: TreeNode) -> int:\n        if not root: return 0\n        queue, res = [root], 0        #使用列表实现queue\n        while queue:\n            tmp = []                  #初始化 保存一层的信息\n            for node in queue:        #将queue的下一层都添加到tmp中\n                if node.left: tmp.append(node.left)\n                if node.right: tmp.append(node.right)\n            queue = tmp               #更新\n            res += 1\n        return res\n```\n\n","slug":"leetcode/leetcode-offer55-1","published":1,"updated":"2022-01-18T08:10:17.092Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ar004zast9cn5rek00","content":"<blockquote>\n<p>二叉树的深度</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一棵二叉树的根节点，求该树的深度。从根节点到叶节点依次经过的节点（含根、叶节点）形成树的一条路径，最长路径的长度为树的深度。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p>例如：</p>\n<p>给定二叉树<code> [3,9,20,null,null,15,7]</code>,</p>\n<figure class=\"highlight livescript\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\"> <span class=\"hljs-number\">3</span><br> / <span class=\"hljs-string\">\\</span><br><span class=\"hljs-number\">9</span>  <span class=\"hljs-number\">20</span><br>  /  <span class=\"hljs-string\">\\</span><br> <span class=\"hljs-number\">15</span>   <span class=\"hljs-number\">7</span><br></code></pre></td></tr></tbody></table></figure>\n<p>返回它的最大深度 3 。</p>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>节点总数 &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h4 id=\"解法一\">解法一</h4>\n<p>直接深度优先遍历即可，直接利用<code>maxDepth</code>函数，注意在内部调用<code>maxDepth</code>函数时要使用<code>self</code>来调用本函数。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">maxDepth</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root:<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span> + <span class=\"hljs-built_in\">max</span>(self.maxDepth(root.left),self.maxDepth(root.right))<br><br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"解法二\">解法二</h4>\n<p>直接使用层序遍历得到深度。使用两个列表<code>tmp</code>和<code>queue</code>结合实现“队列”的作用。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">maxDepth</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br>        queue, res = [root], <span class=\"hljs-number\">0</span>        <span class=\"hljs-comment\">#使用列表实现queue</span><br>        <span class=\"hljs-keyword\">while</span> queue:<br>            tmp = []                  <span class=\"hljs-comment\">#初始化 保存一层的信息</span><br>            <span class=\"hljs-keyword\">for</span> node <span class=\"hljs-keyword\">in</span> queue:        <span class=\"hljs-comment\">#将queue的下一层都添加到tmp中</span><br>                <span class=\"hljs-keyword\">if</span> node.left: tmp.append(node.left)<br>                <span class=\"hljs-keyword\">if</span> node.right: tmp.append(node.right)<br>            queue = tmp               <span class=\"hljs-comment\">#更新</span><br>            res += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> res<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>二叉树的深度</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一棵二叉树的根节点，求该树的深度。从根节点到叶节点依次经过的节点（含根、叶节点）形成树的一条路径，最长路径的长度为树的深度。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p>例如：</p>\n<p>给定二叉树<code> [3,9,20,null,null,15,7]</code>,</p>\n<figure class=\"highlight livescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs livescript\"> <span class=\"hljs-number\">3</span><br> / <span class=\"hljs-string\">\\</span><br><span class=\"hljs-number\">9</span>  <span class=\"hljs-number\">20</span><br>  /  <span class=\"hljs-string\">\\</span><br> <span class=\"hljs-number\">15</span>   <span class=\"hljs-number\">7</span><br></code></pre></td></tr></table></figure>\n<p>返回它的最大深度 3 。</p>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>节点总数 &lt;= 10000</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h4 id=\"解法一\">解法一</h4>\n<p>直接深度优先遍历即可，直接利用<code>maxDepth</code>函数，注意在内部调用<code>maxDepth</code>函数时要使用<code>self</code>来调用本函数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, x):</span><br><span class=\"hljs-comment\">#         self.val = x</span><br><span class=\"hljs-comment\">#         self.left = None</span><br><span class=\"hljs-comment\">#         self.right = None</span><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">maxDepth</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root:<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span> + <span class=\"hljs-built_in\">max</span>(self.maxDepth(root.left),self.maxDepth(root.right))<br><br></code></pre></td></tr></table></figure>\n<h4 id=\"解法二\">解法二</h4>\n<p>直接使用层序遍历得到深度。使用两个列表<code>tmp</code>和<code>queue</code>结合实现“队列”的作用。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">maxDepth</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root: <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span><br>        queue, res = [root], <span class=\"hljs-number\">0</span>        <span class=\"hljs-comment\">#使用列表实现queue</span><br>        <span class=\"hljs-keyword\">while</span> queue:<br>            tmp = []                  <span class=\"hljs-comment\">#初始化 保存一层的信息</span><br>            <span class=\"hljs-keyword\">for</span> node <span class=\"hljs-keyword\">in</span> queue:        <span class=\"hljs-comment\">#将queue的下一层都添加到tmp中</span><br>                <span class=\"hljs-keyword\">if</span> node.left: tmp.append(node.left)<br>                <span class=\"hljs-keyword\">if</span> node.right: tmp.append(node.right)<br>            queue = tmp               <span class=\"hljs-comment\">#更新</span><br>            res += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> res<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer53-1 数组中数字出现的次数","date":"2021-12-07T10:12:52.000Z","_content":"\n>数组中数字出现的次数\n\n## 题目\n\n一个整型数组 `nums` 里除两个数字之外，其他数字都出现了两次。请写程序找出这两个只出现一次的数字。要求时间复杂度是O(n)，空间复杂度是O(1)。\n\n### 示例 1：\n\n```\n输入：nums = [4,1,4,6]\n输出：[1,6] 或 [6,1]\n```\n\n### 示例 2：\n\n```\n输入：nums = [1,2,10,4,1,4,3,3]\n输出：[2,10] 或 [10,2]\n```\n\n### 提示：\n\n- `2 <= nums.length <= 10000`\n\n## 题解\n\n利用map来记录每个数出现的次数，再遍历map得到次数为1的数，这样的时间复杂度为O(N),空间复杂度为O(N)；\n\n```python\nclass Solution:\n    def singleNumbers(self, nums: List[int]) -> List[int]:\n        info = {}\n        result = []\n        for num in nums:\n            if not(num in info):info[num]=1\n            else:info[num] += 1\n        for key in info:\n            if(info[key]==1):result.append(key)\n        return result\n        #这样的时间复杂度为O(N),空间复杂度为O(N)\n```\n\n因为要保证空间复杂度为O(1),需要另辟蹊径，注意到一个定理，a⊕a = 0 0⊕a=a，并且满足交换律，因此如果只有一个数字x只出现一次，那么将所有的数字进行异或操作得到的结果就是x\n\n单个数字：\n\n```python\ndef singleNumber(self, nums: List[int]) -> List[int]:\n    x = 0\n    for num in nums:  # 1. 遍历 nums 执行异或运算\n        x ^= num      \n    return x;         # 2. 返回出现一次的数字 x\n```\n\n现在是两个数字，因此所有数字的异或是x⊕y，这两个数字怎么区分呢，可以找到这两个数字不同的一位（利用&）。然后再进行异或分类，找到两个值。\n\n```python\nclass Solution:\n    def singleNumbers(self, nums: List[int]) -> List[int]:\n        #x1异或x2.... 结果可以得到最终的两个不同的数异或 x异或y\n        a,x,y = 0,0,0\n        for num in nums:\n            a = a^num\n        m = 1\n        while m&a==0: m = m<<1 #找到不同位\n        for num in nums:\n            if(m&num):x^=num\n            else:y^=num\n        return [x,y]\n```\n还不清楚的话，可以参考解释代码哦~\n\n```java\nclass Solution {\n    public int[] singleNumbers(int[] nums) {\n        //因为相同的数字异或为0，任何数字与0异或结果是其本身。\n        //所以遍历异或整个数组最后得到的结果就是两个只出现一次的数字异或的结果：即 z = x ^ y\n        int z = 0;  \n        for(int i : nums) z ^= i;\n        //我们根据异或的性质可以知道：z中至少有一位是1，否则x与y就是相等的。\n        //我们通过一个辅助变量m来保存z中哪一位为1.（可能有多个位都为1，我们找到最低位的1即可）。\n        //举个例子：z = 10 ^ 2 = 1010 ^ 0010 = 1000,第四位为1.\n        //我们将m初始化为1，如果（z & m）的结果等于0说明z的最低为是0\n        //我们每次将m左移一位然后跟z做与操作，直到结果不为0.\n        //此时m应该等于1000，同z一样，第四位为1.\n        int m = 1;\n        while((z & m) == 0) m <<= 1;\n        //我们遍历数组，将每个数跟m进行与操作，结果为0的作为一组，结果不为0的作为一组\n        //例如对于数组：[1,2,10,4,1,4,3,3]，我们把每个数字跟1000做与操作，可以分为下面两组：\n        //nums1存放结果为0的: [1, 2, 4, 1, 4, 3, 3]\n        //nums2存放结果不为0的: [10] (碰巧nums2中只有一个10，如果原数组中的数字再大一些就不会这样了)\n        //此时我们发现问题已经退化为数组中有一个数字只出现了一次\n        //分别对nums1和nums2遍历异或就能得到我们预期的x和y\n        int x = 0, y = 0;\n        for(int i : nums) {\n            //这里我们是通过if...else将nums分为了两组，一边遍历一遍异或。\n            //跟我们创建俩数组nums1和nums2原理是一样的。\n            if((i & m) == 0) x ^= i;\n            else y ^= i;\n        }\n        return new int[]{x, y};\n    }\n}\n```\n\n","source":"_posts/leetcode/leetcode-offer53-1.md","raw":"---\ntitle: 剑指offer53-1 数组中数字出现的次数\ntags: [剑指,数组]\ncategories: [剑指,数组]\ndate: 2021-12-07 18:12:52\n---\n\n>数组中数字出现的次数\n\n## 题目\n\n一个整型数组 `nums` 里除两个数字之外，其他数字都出现了两次。请写程序找出这两个只出现一次的数字。要求时间复杂度是O(n)，空间复杂度是O(1)。\n\n### 示例 1：\n\n```\n输入：nums = [4,1,4,6]\n输出：[1,6] 或 [6,1]\n```\n\n### 示例 2：\n\n```\n输入：nums = [1,2,10,4,1,4,3,3]\n输出：[2,10] 或 [10,2]\n```\n\n### 提示：\n\n- `2 <= nums.length <= 10000`\n\n## 题解\n\n利用map来记录每个数出现的次数，再遍历map得到次数为1的数，这样的时间复杂度为O(N),空间复杂度为O(N)；\n\n```python\nclass Solution:\n    def singleNumbers(self, nums: List[int]) -> List[int]:\n        info = {}\n        result = []\n        for num in nums:\n            if not(num in info):info[num]=1\n            else:info[num] += 1\n        for key in info:\n            if(info[key]==1):result.append(key)\n        return result\n        #这样的时间复杂度为O(N),空间复杂度为O(N)\n```\n\n因为要保证空间复杂度为O(1),需要另辟蹊径，注意到一个定理，a⊕a = 0 0⊕a=a，并且满足交换律，因此如果只有一个数字x只出现一次，那么将所有的数字进行异或操作得到的结果就是x\n\n单个数字：\n\n```python\ndef singleNumber(self, nums: List[int]) -> List[int]:\n    x = 0\n    for num in nums:  # 1. 遍历 nums 执行异或运算\n        x ^= num      \n    return x;         # 2. 返回出现一次的数字 x\n```\n\n现在是两个数字，因此所有数字的异或是x⊕y，这两个数字怎么区分呢，可以找到这两个数字不同的一位（利用&）。然后再进行异或分类，找到两个值。\n\n```python\nclass Solution:\n    def singleNumbers(self, nums: List[int]) -> List[int]:\n        #x1异或x2.... 结果可以得到最终的两个不同的数异或 x异或y\n        a,x,y = 0,0,0\n        for num in nums:\n            a = a^num\n        m = 1\n        while m&a==0: m = m<<1 #找到不同位\n        for num in nums:\n            if(m&num):x^=num\n            else:y^=num\n        return [x,y]\n```\n还不清楚的话，可以参考解释代码哦~\n\n```java\nclass Solution {\n    public int[] singleNumbers(int[] nums) {\n        //因为相同的数字异或为0，任何数字与0异或结果是其本身。\n        //所以遍历异或整个数组最后得到的结果就是两个只出现一次的数字异或的结果：即 z = x ^ y\n        int z = 0;  \n        for(int i : nums) z ^= i;\n        //我们根据异或的性质可以知道：z中至少有一位是1，否则x与y就是相等的。\n        //我们通过一个辅助变量m来保存z中哪一位为1.（可能有多个位都为1，我们找到最低位的1即可）。\n        //举个例子：z = 10 ^ 2 = 1010 ^ 0010 = 1000,第四位为1.\n        //我们将m初始化为1，如果（z & m）的结果等于0说明z的最低为是0\n        //我们每次将m左移一位然后跟z做与操作，直到结果不为0.\n        //此时m应该等于1000，同z一样，第四位为1.\n        int m = 1;\n        while((z & m) == 0) m <<= 1;\n        //我们遍历数组，将每个数跟m进行与操作，结果为0的作为一组，结果不为0的作为一组\n        //例如对于数组：[1,2,10,4,1,4,3,3]，我们把每个数字跟1000做与操作，可以分为下面两组：\n        //nums1存放结果为0的: [1, 2, 4, 1, 4, 3, 3]\n        //nums2存放结果不为0的: [10] (碰巧nums2中只有一个10，如果原数组中的数字再大一些就不会这样了)\n        //此时我们发现问题已经退化为数组中有一个数字只出现了一次\n        //分别对nums1和nums2遍历异或就能得到我们预期的x和y\n        int x = 0, y = 0;\n        for(int i : nums) {\n            //这里我们是通过if...else将nums分为了两组，一边遍历一遍异或。\n            //跟我们创建俩数组nums1和nums2原理是一样的。\n            if((i & m) == 0) x ^= i;\n            else y ^= i;\n        }\n        return new int[]{x, y};\n    }\n}\n```\n\n","slug":"leetcode/leetcode-offer53-1","published":1,"updated":"2022-01-18T08:10:17.091Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0au0052ast9dh0obd5v","content":"<blockquote>\n<p>数组中数字出现的次数</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>一个整型数组 <code>nums</code> 里除两个数字之外，其他数字都出现了两次。请写程序找出这两个只出现一次的数字。要求时间复杂度是O(n)，空间复杂度是O(1)。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：nums = <span class=\"hljs-comment\">[4,1,4,6]</span><br>输出：<span class=\"hljs-comment\">[1,6]</span> 或 <span class=\"hljs-comment\">[6,1]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：nums = <span class=\"hljs-comment\">[1,2,10,4,1,4,3,3]</span><br>输出：<span class=\"hljs-comment\">[2,10]</span> 或 <span class=\"hljs-comment\">[10,2]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>2 &lt;= nums.length &lt;= 10000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>利用map来记录每个数出现的次数，再遍历map得到次数为1的数，这样的时间复杂度为O(N),空间复杂度为O(N)；</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">singleNumbers</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        info = {}<br>        result = []<br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(num <span class=\"hljs-keyword\">in</span> info):info[num]=<span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>:info[num] += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> key <span class=\"hljs-keyword\">in</span> info:<br>            <span class=\"hljs-keyword\">if</span>(info[key]==<span class=\"hljs-number\">1</span>):result.append(key)<br>        <span class=\"hljs-keyword\">return</span> result<br>        <span class=\"hljs-comment\">#这样的时间复杂度为O(N),空间复杂度为O(N)</span><br></code></pre></td></tr></tbody></table></figure>\n<p>因为要保证空间复杂度为O(1),需要另辟蹊径，注意到一个定理，a⊕a = 0 0⊕a=a，并且满足交换律，因此如果只有一个数字x只出现一次，那么将所有的数字进行异或操作得到的结果就是x</p>\n<p>单个数字：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">singleNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>    x = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:  <span class=\"hljs-comment\"># 1. 遍历 nums 执行异或运算</span><br>        x ^= num      <br>    <span class=\"hljs-keyword\">return</span> x;         <span class=\"hljs-comment\"># 2. 返回出现一次的数字 x</span><br></code></pre></td></tr></tbody></table></figure>\n<p>现在是两个数字，因此所有数字的异或是x⊕y，这两个数字怎么区分呢，可以找到这两个数字不同的一位（利用&amp;）。然后再进行异或分类，找到两个值。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">singleNumbers</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-comment\">#x1异或x2.... 结果可以得到最终的两个不同的数异或 x异或y</span><br>        a,x,y = <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            a = a^num<br>        m = <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">while</span> m&amp;a==<span class=\"hljs-number\">0</span>: m = m&lt;&lt;<span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#找到不同位</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span>(m&amp;num):x^=num<br>            <span class=\"hljs-keyword\">else</span>:y^=num<br>        <span class=\"hljs-keyword\">return</span> [x,y]<br></code></pre></td></tr></tbody></table></figure>\n<p>还不清楚的话，可以参考解释代码哦~</p>\n<figure class=\"highlight java\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span> </span>{<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span>[] singleNumbers(<span class=\"hljs-keyword\">int</span>[] nums) {<br>        <span class=\"hljs-comment\">//因为相同的数字异或为0，任何数字与0异或结果是其本身。</span><br>        <span class=\"hljs-comment\">//所以遍历异或整个数组最后得到的结果就是两个只出现一次的数字异或的结果：即 z = x ^ y</span><br>        <span class=\"hljs-keyword\">int</span> z = <span class=\"hljs-number\">0</span>;  <br>        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i : nums) z ^= i;<br>        <span class=\"hljs-comment\">//我们根据异或的性质可以知道：z中至少有一位是1，否则x与y就是相等的。</span><br>        <span class=\"hljs-comment\">//我们通过一个辅助变量m来保存z中哪一位为1.（可能有多个位都为1，我们找到最低位的1即可）。</span><br>        <span class=\"hljs-comment\">//举个例子：z = 10 ^ 2 = 1010 ^ 0010 = 1000,第四位为1.</span><br>        <span class=\"hljs-comment\">//我们将m初始化为1，如果（z &amp; m）的结果等于0说明z的最低为是0</span><br>        <span class=\"hljs-comment\">//我们每次将m左移一位然后跟z做与操作，直到结果不为0.</span><br>        <span class=\"hljs-comment\">//此时m应该等于1000，同z一样，第四位为1.</span><br>        <span class=\"hljs-keyword\">int</span> m = <span class=\"hljs-number\">1</span>;<br>        <span class=\"hljs-keyword\">while</span>((z &amp; m) == <span class=\"hljs-number\">0</span>) m &lt;&lt;= <span class=\"hljs-number\">1</span>;<br>        <span class=\"hljs-comment\">//我们遍历数组，将每个数跟m进行与操作，结果为0的作为一组，结果不为0的作为一组</span><br>        <span class=\"hljs-comment\">//例如对于数组：[1,2,10,4,1,4,3,3]，我们把每个数字跟1000做与操作，可以分为下面两组：</span><br>        <span class=\"hljs-comment\">//nums1存放结果为0的: [1, 2, 4, 1, 4, 3, 3]</span><br>        <span class=\"hljs-comment\">//nums2存放结果不为0的: [10] (碰巧nums2中只有一个10，如果原数组中的数字再大一些就不会这样了)</span><br>        <span class=\"hljs-comment\">//此时我们发现问题已经退化为数组中有一个数字只出现了一次</span><br>        <span class=\"hljs-comment\">//分别对nums1和nums2遍历异或就能得到我们预期的x和y</span><br>        <span class=\"hljs-keyword\">int</span> x = <span class=\"hljs-number\">0</span>, y = <span class=\"hljs-number\">0</span>;<br>        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i : nums) {<br>            <span class=\"hljs-comment\">//这里我们是通过if...else将nums分为了两组，一边遍历一遍异或。</span><br>            <span class=\"hljs-comment\">//跟我们创建俩数组nums1和nums2原理是一样的。</span><br>            <span class=\"hljs-keyword\">if</span>((i &amp; m) == <span class=\"hljs-number\">0</span>) x ^= i;<br>            <span class=\"hljs-keyword\">else</span> y ^= i;<br>        }<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-keyword\">int</span>[]{x, y};<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>数组中数字出现的次数</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>一个整型数组 <code>nums</code> 里除两个数字之外，其他数字都出现了两次。请写程序找出这两个只出现一次的数字。要求时间复杂度是O(n)，空间复杂度是O(1)。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：nums = <span class=\"hljs-comment\">[4,1,4,6]</span><br>输出：<span class=\"hljs-comment\">[1,6]</span> 或 <span class=\"hljs-comment\">[6,1]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：nums = <span class=\"hljs-comment\">[1,2,10,4,1,4,3,3]</span><br>输出：<span class=\"hljs-comment\">[2,10]</span> 或 <span class=\"hljs-comment\">[10,2]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>2 &lt;= nums.length &lt;= 10000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>利用map来记录每个数出现的次数，再遍历map得到次数为1的数，这样的时间复杂度为O(N),空间复杂度为O(N)；</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">singleNumbers</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        info = &#123;&#125;<br>        result = []<br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span>(num <span class=\"hljs-keyword\">in</span> info):info[num]=<span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>:info[num] += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> key <span class=\"hljs-keyword\">in</span> info:<br>            <span class=\"hljs-keyword\">if</span>(info[key]==<span class=\"hljs-number\">1</span>):result.append(key)<br>        <span class=\"hljs-keyword\">return</span> result<br>        <span class=\"hljs-comment\">#这样的时间复杂度为O(N),空间复杂度为O(N)</span><br></code></pre></td></tr></table></figure>\n<p>因为要保证空间复杂度为O(1),需要另辟蹊径，注意到一个定理，a⊕a = 0 0⊕a=a，并且满足交换律，因此如果只有一个数字x只出现一次，那么将所有的数字进行异或操作得到的结果就是x</p>\n<p>单个数字：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">singleNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>    x = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:  <span class=\"hljs-comment\"># 1. 遍历 nums 执行异或运算</span><br>        x ^= num      <br>    <span class=\"hljs-keyword\">return</span> x;         <span class=\"hljs-comment\"># 2. 返回出现一次的数字 x</span><br></code></pre></td></tr></table></figure>\n<p>现在是两个数字，因此所有数字的异或是x⊕y，这两个数字怎么区分呢，可以找到这两个数字不同的一位（利用&amp;）。然后再进行异或分类，找到两个值。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">singleNumbers</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-comment\">#x1异或x2.... 结果可以得到最终的两个不同的数异或 x异或y</span><br>        a,x,y = <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            a = a^num<br>        m = <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">while</span> m&amp;a==<span class=\"hljs-number\">0</span>: m = m&lt;&lt;<span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#找到不同位</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">if</span>(m&amp;num):x^=num<br>            <span class=\"hljs-keyword\">else</span>:y^=num<br>        <span class=\"hljs-keyword\">return</span> [x,y]<br></code></pre></td></tr></table></figure>\n<p>还不清楚的话，可以参考解释代码哦~</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span> </span>&#123;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span>[] singleNumbers(<span class=\"hljs-keyword\">int</span>[] nums) &#123;<br>        <span class=\"hljs-comment\">//因为相同的数字异或为0，任何数字与0异或结果是其本身。</span><br>        <span class=\"hljs-comment\">//所以遍历异或整个数组最后得到的结果就是两个只出现一次的数字异或的结果：即 z = x ^ y</span><br>        <span class=\"hljs-keyword\">int</span> z = <span class=\"hljs-number\">0</span>;  <br>        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i : nums) z ^= i;<br>        <span class=\"hljs-comment\">//我们根据异或的性质可以知道：z中至少有一位是1，否则x与y就是相等的。</span><br>        <span class=\"hljs-comment\">//我们通过一个辅助变量m来保存z中哪一位为1.（可能有多个位都为1，我们找到最低位的1即可）。</span><br>        <span class=\"hljs-comment\">//举个例子：z = 10 ^ 2 = 1010 ^ 0010 = 1000,第四位为1.</span><br>        <span class=\"hljs-comment\">//我们将m初始化为1，如果（z &amp; m）的结果等于0说明z的最低为是0</span><br>        <span class=\"hljs-comment\">//我们每次将m左移一位然后跟z做与操作，直到结果不为0.</span><br>        <span class=\"hljs-comment\">//此时m应该等于1000，同z一样，第四位为1.</span><br>        <span class=\"hljs-keyword\">int</span> m = <span class=\"hljs-number\">1</span>;<br>        <span class=\"hljs-keyword\">while</span>((z &amp; m) == <span class=\"hljs-number\">0</span>) m &lt;&lt;= <span class=\"hljs-number\">1</span>;<br>        <span class=\"hljs-comment\">//我们遍历数组，将每个数跟m进行与操作，结果为0的作为一组，结果不为0的作为一组</span><br>        <span class=\"hljs-comment\">//例如对于数组：[1,2,10,4,1,4,3,3]，我们把每个数字跟1000做与操作，可以分为下面两组：</span><br>        <span class=\"hljs-comment\">//nums1存放结果为0的: [1, 2, 4, 1, 4, 3, 3]</span><br>        <span class=\"hljs-comment\">//nums2存放结果不为0的: [10] (碰巧nums2中只有一个10，如果原数组中的数字再大一些就不会这样了)</span><br>        <span class=\"hljs-comment\">//此时我们发现问题已经退化为数组中有一个数字只出现了一次</span><br>        <span class=\"hljs-comment\">//分别对nums1和nums2遍历异或就能得到我们预期的x和y</span><br>        <span class=\"hljs-keyword\">int</span> x = <span class=\"hljs-number\">0</span>, y = <span class=\"hljs-number\">0</span>;<br>        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i : nums) &#123;<br>            <span class=\"hljs-comment\">//这里我们是通过if...else将nums分为了两组，一边遍历一遍异或。</span><br>            <span class=\"hljs-comment\">//跟我们创建俩数组nums1和nums2原理是一样的。</span><br>            <span class=\"hljs-keyword\">if</span>((i &amp; m) == <span class=\"hljs-number\">0</span>) x ^= i;<br>            <span class=\"hljs-keyword\">else</span> y ^= i;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-keyword\">int</span>[]&#123;x, y&#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offerleetcode-offer563 二叉树的坡度","date":"2021-11-18T07:06:37.000Z","_content":"\n> 二叉树的坡度\n\n## 题目\n\n给定一个二叉树，计算 整个树 的坡度 。\n一个树的 节点的坡度 定义即为，该节点左子树的节点之和和右子树节点之和的 差的绝对值 。如果没有左子树的话，左子树的节点之和为 0 ；没有右子树的话也是一样。空结点的坡度是 0 。\n\n整个树 的坡度就是其所有节点的坡度之和。\n\n### 示例 1：\n\n![img](https://assets.leetcode.com/uploads/2020/10/20/tilt1.jpg)\n\n\n\n```\n输入：root = [1,2,3]\n输出：1\n解释：\n节点 2 的坡度：|0-0| = 0（没有子节点）\n节点 3 的坡度：|0-0| = 0（没有子节点）\n节点 1 的坡度：|2-3| = 1（左子树就是左子节点，所以和是 2 ；右子树就是右子节点，所以和是 3 ）\n坡度总和：0 + 0 + 1 = 1\n\n```\n\n### 示例 2：\n\n![img](https://assets.leetcode.com/uploads/2020/10/20/tilt1.jpg)\n\n\n\n```\n输入：root = [4,2,9,3,5,null,7]\n输出：15\n解释：\n节点 3 的坡度：|0-0| = 0（没有子节点）\n节点 5 的坡度：|0-0| = 0（没有子节点）\n节点 7 的坡度：|0-0| = 0（没有子节点）\n节点 2 的坡度：|3-5| = 2（左子树就是左子节点，所以和是 3 ；右子树就是右子节点，所以和是 5 ）\n节点 9 的坡度：|0-7| = 7（没有左子树，所以和是 0 ；右子树正好是右子节点，所以和是 7 ）\n节点 4 的坡度：|(3+5+2)-(9+7)| = |10-16| = 6（左子树值为 3、5 和 2 ，和是 10 ；右子树值为 9 和 7 ，和是 16 ）\n坡度总和：0 + 0 + 0 + 2 + 7 + 6 = 15\n\n\n```\n\n### 示例 3：\n\n![img](https://assets.leetcode.com/uploads/2020/10/20/tilt3.jpg)\n\n```\n输入：root = [21,7,14,1,1,2,2,3,3]\n输出：9\n```\n\n### 提示：\n\n- 树中节点数目的范围在 `[0, 104]` 内\n- `-1000 <= Node.val <= 1000`\n\n## 题解\n\n可以使用两个函数，一个计算树的各个节点的子树之和，一个用于计算对应的差值之和。在计算子树之和时可以直接用后序遍历，**更新节点的val值为子树和**。此时的时间复杂度为O(2N)。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, val=0, left=None, right=None):\n#         self.val = val\n#         self.left = left\n#         self.right = right\nclass Solution:\n    def findTilt(self, root: TreeNode) -> int:\n        def setaddTree(root): #后序遍历\n            if(not root):return \n            setaddTree(root.left)\n            setaddTree(root.right)\n            Tleft = root.left.val if root.left else 0\n            Tright = root.right.val if root.right else 0\n            root.val = root.val + Tleft + Tright\n        def minasTree(root):\n            if(not root): return \n            Tleft = root.left.val if root.left else 0\n            Tright = root.right.val if root.right else 0\n            self.sumResult += abs(Tleft - Tright)\n            minasTree(root.left)\n            minasTree(root.right)\n        self.sumResult = 0\n        setaddTree(root)\n        minasTree(root)\n        return self.sumResult\n```\n\n实际上无需两个函数，**在后序遍历求和的时候就可以得到子树的差值**，将其累加即可。时间复杂度为O(N)，空间复杂度为O(1)。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, val=0, left=None, right=None):\n#         self.val = val\n#         self.left = left\n#         self.right = right\nclass Solution:\n    def findTilt(self, root: TreeNode) -> int:\n        def setaddTree(root): #后序遍历\n            if(not root):return \n            setaddTree(root.left)\n            setaddTree(root.right)\n            Tleft = root.left.val if root.left else 0\n            Tright = root.right.val if root.right else 0\n            root.val = root.val + Tleft + Tright\n            self.sumResult += abs(Tleft - Tright)\n\n        self.sumResult = 0\n        setaddTree(root)\n        return self.sumResult\n```\n\n","source":"_posts/leetcode/leetcode-offer563.md","raw":"---\ntitle: 剑指offerleetcode-offer563 二叉树的坡度\ntags: [剑指,树]\ncategories: [剑指,树]\ndate: 2021-11-18 15:06:37\n---\n\n> 二叉树的坡度\n\n## 题目\n\n给定一个二叉树，计算 整个树 的坡度 。\n一个树的 节点的坡度 定义即为，该节点左子树的节点之和和右子树节点之和的 差的绝对值 。如果没有左子树的话，左子树的节点之和为 0 ；没有右子树的话也是一样。空结点的坡度是 0 。\n\n整个树 的坡度就是其所有节点的坡度之和。\n\n### 示例 1：\n\n![img](https://assets.leetcode.com/uploads/2020/10/20/tilt1.jpg)\n\n\n\n```\n输入：root = [1,2,3]\n输出：1\n解释：\n节点 2 的坡度：|0-0| = 0（没有子节点）\n节点 3 的坡度：|0-0| = 0（没有子节点）\n节点 1 的坡度：|2-3| = 1（左子树就是左子节点，所以和是 2 ；右子树就是右子节点，所以和是 3 ）\n坡度总和：0 + 0 + 1 = 1\n\n```\n\n### 示例 2：\n\n![img](https://assets.leetcode.com/uploads/2020/10/20/tilt1.jpg)\n\n\n\n```\n输入：root = [4,2,9,3,5,null,7]\n输出：15\n解释：\n节点 3 的坡度：|0-0| = 0（没有子节点）\n节点 5 的坡度：|0-0| = 0（没有子节点）\n节点 7 的坡度：|0-0| = 0（没有子节点）\n节点 2 的坡度：|3-5| = 2（左子树就是左子节点，所以和是 3 ；右子树就是右子节点，所以和是 5 ）\n节点 9 的坡度：|0-7| = 7（没有左子树，所以和是 0 ；右子树正好是右子节点，所以和是 7 ）\n节点 4 的坡度：|(3+5+2)-(9+7)| = |10-16| = 6（左子树值为 3、5 和 2 ，和是 10 ；右子树值为 9 和 7 ，和是 16 ）\n坡度总和：0 + 0 + 0 + 2 + 7 + 6 = 15\n\n\n```\n\n### 示例 3：\n\n![img](https://assets.leetcode.com/uploads/2020/10/20/tilt3.jpg)\n\n```\n输入：root = [21,7,14,1,1,2,2,3,3]\n输出：9\n```\n\n### 提示：\n\n- 树中节点数目的范围在 `[0, 104]` 内\n- `-1000 <= Node.val <= 1000`\n\n## 题解\n\n可以使用两个函数，一个计算树的各个节点的子树之和，一个用于计算对应的差值之和。在计算子树之和时可以直接用后序遍历，**更新节点的val值为子树和**。此时的时间复杂度为O(2N)。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, val=0, left=None, right=None):\n#         self.val = val\n#         self.left = left\n#         self.right = right\nclass Solution:\n    def findTilt(self, root: TreeNode) -> int:\n        def setaddTree(root): #后序遍历\n            if(not root):return \n            setaddTree(root.left)\n            setaddTree(root.right)\n            Tleft = root.left.val if root.left else 0\n            Tright = root.right.val if root.right else 0\n            root.val = root.val + Tleft + Tright\n        def minasTree(root):\n            if(not root): return \n            Tleft = root.left.val if root.left else 0\n            Tright = root.right.val if root.right else 0\n            self.sumResult += abs(Tleft - Tright)\n            minasTree(root.left)\n            minasTree(root.right)\n        self.sumResult = 0\n        setaddTree(root)\n        minasTree(root)\n        return self.sumResult\n```\n\n实际上无需两个函数，**在后序遍历求和的时候就可以得到子树的差值**，将其累加即可。时间复杂度为O(N)，空间复杂度为O(1)。\n\n```python\n# Definition for a binary tree node.\n# class TreeNode:\n#     def __init__(self, val=0, left=None, right=None):\n#         self.val = val\n#         self.left = left\n#         self.right = right\nclass Solution:\n    def findTilt(self, root: TreeNode) -> int:\n        def setaddTree(root): #后序遍历\n            if(not root):return \n            setaddTree(root.left)\n            setaddTree(root.right)\n            Tleft = root.left.val if root.left else 0\n            Tright = root.right.val if root.right else 0\n            root.val = root.val + Tleft + Tright\n            self.sumResult += abs(Tleft - Tright)\n\n        self.sumResult = 0\n        setaddTree(root)\n        return self.sumResult\n```\n\n","slug":"leetcode/leetcode-offer563","published":1,"updated":"2022-01-18T08:10:17.093Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0aw0054ast93tm4226o","content":"<blockquote>\n<p>二叉树的坡度</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给定一个二叉树，计算 整个树 的坡度 。<br>\n一个树的 节点的坡度 定义即为，该节点左子树的节点之和和右子树节点之和的 差的绝对值 。如果没有左子树的话，左子树的节点之和为 0 ；没有右子树的话也是一样。空结点的坡度是 0 。</p>\n<p>整个树 的坡度就是其所有节点的坡度之和。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p><img src=\"https://assets.leetcode.com/uploads/2020/10/20/tilt1.jpg\" alt=\"img\"></p>\n<figure class=\"highlight tap\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入：root = [1,2,3]<br>输出：1<br>解释：<br>节点<span class=\"hljs-number\"> 2 </span>的坡度：|0-0| = 0（没有子节点）<br>节点<span class=\"hljs-number\"> 3 </span>的坡度：|0-0| = 0（没有子节点）<br>节点<span class=\"hljs-number\"> 1 </span>的坡度：|2-3| = 1（左子树就是左子节点，所以和是<span class=\"hljs-number\"> 2 </span>；右子树就是右子节点，所以和是<span class=\"hljs-number\"> 3 </span>）<br>坡度总和：0 +<span class=\"hljs-number\"> 0 </span>+<span class=\"hljs-number\"> 1 </span>= 1<br><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<p><img src=\"https://assets.leetcode.com/uploads/2020/10/20/tilt1.jpg\" alt=\"img\"></p>\n<figure class=\"highlight tap\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入：root = [4,2,9,3,5,null,7]<br>输出：15<br>解释：<br>节点<span class=\"hljs-number\"> 3 </span>的坡度：|0-0| = 0（没有子节点）<br>节点<span class=\"hljs-number\"> 5 </span>的坡度：|0-0| = 0（没有子节点）<br>节点<span class=\"hljs-number\"> 7 </span>的坡度：|0-0| = 0（没有子节点）<br>节点<span class=\"hljs-number\"> 2 </span>的坡度：|3-5| = 2（左子树就是左子节点，所以和是<span class=\"hljs-number\"> 3 </span>；右子树就是右子节点，所以和是<span class=\"hljs-number\"> 5 </span>）<br>节点<span class=\"hljs-number\"> 9 </span>的坡度：|0-7| = 7（没有左子树，所以和是<span class=\"hljs-number\"> 0 </span>；右子树正好是右子节点，所以和是<span class=\"hljs-number\"> 7 </span>）<br>节点<span class=\"hljs-number\"> 4 </span>的坡度：|(3+5+2)-(9+7)| = |10-16| = 6（左子树值为 3、5 和<span class=\"hljs-number\"> 2 </span>，和是<span class=\"hljs-number\"> 10 </span>；右子树值为<span class=\"hljs-number\"> 9 </span>和<span class=\"hljs-number\"> 7 </span>，和是<span class=\"hljs-number\"> 16 </span>）<br>坡度总和：0 +<span class=\"hljs-number\"> 0 </span>+<span class=\"hljs-number\"> 0 </span>+<span class=\"hljs-number\"> 2 </span>+<span class=\"hljs-number\"> 7 </span>+<span class=\"hljs-number\"> 6 </span>= 15<br><br><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<p><img src=\"https://assets.leetcode.com/uploads/2020/10/20/tilt3.jpg\" alt=\"img\"></p>\n<figure class=\"highlight dns\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：root = [<span class=\"hljs-number\">21,7,14,1</span>,<span class=\"hljs-number\">1,2,2,3</span>,<span class=\"hljs-number\">3</span>]<br>输出：<span class=\"hljs-number\">9</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>树中节点数目的范围在 <code>[0, 104]</code> 内</li>\n<li><code>-1000 &lt;= Node.val &lt;= 1000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>可以使用两个函数，一个计算树的各个节点的子树之和，一个用于计算对应的差值之和。在计算子树之和时可以直接用后序遍历，<strong>更新节点的val值为子树和</strong>。此时的时间复杂度为O(2N)。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, val=0, left=None, right=None):</span><br><span class=\"hljs-comment\">#         self.val = val</span><br><span class=\"hljs-comment\">#         self.left = left</span><br><span class=\"hljs-comment\">#         self.right = right</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findTilt</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">setaddTree</span>(<span class=\"hljs-params\">root</span>):</span> <span class=\"hljs-comment\">#后序遍历</span><br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root):<span class=\"hljs-keyword\">return</span> <br>            setaddTree(root.left)<br>            setaddTree(root.right)<br>            Tleft = root.left.val <span class=\"hljs-keyword\">if</span> root.left <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            Tright = root.right.val <span class=\"hljs-keyword\">if</span> root.right <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            root.val = root.val + Tleft + Tright<br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">minasTree</span>(<span class=\"hljs-params\">root</span>):</span><br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root): <span class=\"hljs-keyword\">return</span> <br>            Tleft = root.left.val <span class=\"hljs-keyword\">if</span> root.left <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            Tright = root.right.val <span class=\"hljs-keyword\">if</span> root.right <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            self.sumResult += <span class=\"hljs-built_in\">abs</span>(Tleft - Tright)<br>            minasTree(root.left)<br>            minasTree(root.right)<br>        self.sumResult = <span class=\"hljs-number\">0</span><br>        setaddTree(root)<br>        minasTree(root)<br>        <span class=\"hljs-keyword\">return</span> self.sumResult<br></code></pre></td></tr></tbody></table></figure>\n<p>实际上无需两个函数，<strong>在后序遍历求和的时候就可以得到子树的差值</strong>，将其累加即可。时间复杂度为O(N)，空间复杂度为O(1)。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, val=0, left=None, right=None):</span><br><span class=\"hljs-comment\">#         self.val = val</span><br><span class=\"hljs-comment\">#         self.left = left</span><br><span class=\"hljs-comment\">#         self.right = right</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findTilt</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">setaddTree</span>(<span class=\"hljs-params\">root</span>):</span> <span class=\"hljs-comment\">#后序遍历</span><br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root):<span class=\"hljs-keyword\">return</span> <br>            setaddTree(root.left)<br>            setaddTree(root.right)<br>            Tleft = root.left.val <span class=\"hljs-keyword\">if</span> root.left <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            Tright = root.right.val <span class=\"hljs-keyword\">if</span> root.right <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            root.val = root.val + Tleft + Tright<br>            self.sumResult += <span class=\"hljs-built_in\">abs</span>(Tleft - Tright)<br><br>        self.sumResult = <span class=\"hljs-number\">0</span><br>        setaddTree(root)<br>        <span class=\"hljs-keyword\">return</span> self.sumResult<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>二叉树的坡度</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给定一个二叉树，计算 整个树 的坡度 。<br>\n一个树的 节点的坡度 定义即为，该节点左子树的节点之和和右子树节点之和的 差的绝对值 。如果没有左子树的话，左子树的节点之和为 0 ；没有右子树的话也是一样。空结点的坡度是 0 。</p>\n<p>整个树 的坡度就是其所有节点的坡度之和。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<p><img src=\"https://assets.leetcode.com/uploads/2020/10/20/tilt1.jpg\" alt=\"img\"></p>\n<figure class=\"highlight tap\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入：root = [1,2,3]<br>输出：1<br>解释：<br>节点<span class=\"hljs-number\"> 2 </span>的坡度：|0-0| = 0（没有子节点）<br>节点<span class=\"hljs-number\"> 3 </span>的坡度：|0-0| = 0（没有子节点）<br>节点<span class=\"hljs-number\"> 1 </span>的坡度：|2-3| = 1（左子树就是左子节点，所以和是<span class=\"hljs-number\"> 2 </span>；右子树就是右子节点，所以和是<span class=\"hljs-number\"> 3 </span>）<br>坡度总和：0 +<span class=\"hljs-number\"> 0 </span>+<span class=\"hljs-number\"> 1 </span>= 1<br><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<p><img src=\"https://assets.leetcode.com/uploads/2020/10/20/tilt1.jpg\" alt=\"img\"></p>\n<figure class=\"highlight tap\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs tap\">输入：root = [4,2,9,3,5,null,7]<br>输出：15<br>解释：<br>节点<span class=\"hljs-number\"> 3 </span>的坡度：|0-0| = 0（没有子节点）<br>节点<span class=\"hljs-number\"> 5 </span>的坡度：|0-0| = 0（没有子节点）<br>节点<span class=\"hljs-number\"> 7 </span>的坡度：|0-0| = 0（没有子节点）<br>节点<span class=\"hljs-number\"> 2 </span>的坡度：|3-5| = 2（左子树就是左子节点，所以和是<span class=\"hljs-number\"> 3 </span>；右子树就是右子节点，所以和是<span class=\"hljs-number\"> 5 </span>）<br>节点<span class=\"hljs-number\"> 9 </span>的坡度：|0-7| = 7（没有左子树，所以和是<span class=\"hljs-number\"> 0 </span>；右子树正好是右子节点，所以和是<span class=\"hljs-number\"> 7 </span>）<br>节点<span class=\"hljs-number\"> 4 </span>的坡度：|(3+5+2)-(9+7)| = |10-16| = 6（左子树值为 3、5 和<span class=\"hljs-number\"> 2 </span>，和是<span class=\"hljs-number\"> 10 </span>；右子树值为<span class=\"hljs-number\"> 9 </span>和<span class=\"hljs-number\"> 7 </span>，和是<span class=\"hljs-number\"> 16 </span>）<br>坡度总和：0 +<span class=\"hljs-number\"> 0 </span>+<span class=\"hljs-number\"> 0 </span>+<span class=\"hljs-number\"> 2 </span>+<span class=\"hljs-number\"> 7 </span>+<span class=\"hljs-number\"> 6 </span>= 15<br><br><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<p><img src=\"https://assets.leetcode.com/uploads/2020/10/20/tilt3.jpg\" alt=\"img\"></p>\n<figure class=\"highlight dns\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：root = [<span class=\"hljs-number\">21,7,14,1</span>,<span class=\"hljs-number\">1,2,2,3</span>,<span class=\"hljs-number\">3</span>]<br>输出：<span class=\"hljs-number\">9</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>树中节点数目的范围在 <code>[0, 104]</code> 内</li>\n<li><code>-1000 &lt;= Node.val &lt;= 1000</code></li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>可以使用两个函数，一个计算树的各个节点的子树之和，一个用于计算对应的差值之和。在计算子树之和时可以直接用后序遍历，<strong>更新节点的val值为子树和</strong>。此时的时间复杂度为O(2N)。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, val=0, left=None, right=None):</span><br><span class=\"hljs-comment\">#         self.val = val</span><br><span class=\"hljs-comment\">#         self.left = left</span><br><span class=\"hljs-comment\">#         self.right = right</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findTilt</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">setaddTree</span>(<span class=\"hljs-params\">root</span>):</span> <span class=\"hljs-comment\">#后序遍历</span><br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root):<span class=\"hljs-keyword\">return</span> <br>            setaddTree(root.left)<br>            setaddTree(root.right)<br>            Tleft = root.left.val <span class=\"hljs-keyword\">if</span> root.left <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            Tright = root.right.val <span class=\"hljs-keyword\">if</span> root.right <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            root.val = root.val + Tleft + Tright<br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">minasTree</span>(<span class=\"hljs-params\">root</span>):</span><br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root): <span class=\"hljs-keyword\">return</span> <br>            Tleft = root.left.val <span class=\"hljs-keyword\">if</span> root.left <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            Tright = root.right.val <span class=\"hljs-keyword\">if</span> root.right <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            self.sumResult += <span class=\"hljs-built_in\">abs</span>(Tleft - Tright)<br>            minasTree(root.left)<br>            minasTree(root.right)<br>        self.sumResult = <span class=\"hljs-number\">0</span><br>        setaddTree(root)<br>        minasTree(root)<br>        <span class=\"hljs-keyword\">return</span> self.sumResult<br></code></pre></td></tr></table></figure>\n<p>实际上无需两个函数，<strong>在后序遍历求和的时候就可以得到子树的差值</strong>，将其累加即可。时间复杂度为O(N)，空间复杂度为O(1)。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Definition for a binary tree node.</span><br><span class=\"hljs-comment\"># class TreeNode:</span><br><span class=\"hljs-comment\">#     def __init__(self, val=0, left=None, right=None):</span><br><span class=\"hljs-comment\">#         self.val = val</span><br><span class=\"hljs-comment\">#         self.left = left</span><br><span class=\"hljs-comment\">#         self.right = right</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findTilt</span>(<span class=\"hljs-params\">self, root: TreeNode</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">setaddTree</span>(<span class=\"hljs-params\">root</span>):</span> <span class=\"hljs-comment\">#后序遍历</span><br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> root):<span class=\"hljs-keyword\">return</span> <br>            setaddTree(root.left)<br>            setaddTree(root.right)<br>            Tleft = root.left.val <span class=\"hljs-keyword\">if</span> root.left <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            Tright = root.right.val <span class=\"hljs-keyword\">if</span> root.right <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span><br>            root.val = root.val + Tleft + Tright<br>            self.sumResult += <span class=\"hljs-built_in\">abs</span>(Tleft - Tright)<br><br>        self.sumResult = <span class=\"hljs-number\">0</span><br>        setaddTree(root)<br>        <span class=\"hljs-keyword\">return</span> self.sumResult<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer56-2 数组中数字出现的次数Ⅱ","date":"2021-12-08T05:43:59.000Z","_content":"\n>数组中数字出现的次数Ⅱ\n\n## 题目\n\n在一个数组 `nums` 中除一个数字只出现一次之外，其他数字都出现了三次。请找出那个只出现一次的数字。\n\n### 示例 1：\n\n```\n输入：nums = [3,4,3,3]\n输出：4\n```\n\n### 示例 2：\n\n```\n输入：nums = [9,1,7,9,7,9,7]\n输出：1\n```\n\n### 提示：\n\n- `1 <= nums.length <= 10000`\n\n- `1 <= nums[i] < 2^31`\n\n\n## 题解\n\n使用哈希表记录次数，然后再寻找次数为1的数字。此时的时间复杂度为O(N),空间复杂度为O(N)。\n\n```python\nclass Solution:\n    def singleNumber(self, nums: List[int]) -> int:\n        tmap = {}\n        for num in nums:\n            tmap[num] = tmap[num]+1 if num in tmap else 1\n        for num in tmap:\n            if tmap[num] == 1:\n                return num\n```\n\n还有一种方法可以达到时间复杂度为O(N),空间复杂度为O(1);\n\n其思想是每一位的二进制位对于出现3次的数字相加是3的倍数。这样可以把每一位相加对 3 除余数，可以得到出现一次的数字。\n\n![](https://picture.mulindya.com/leetcode-offer56-2.png)\n\n实际上修改余数m，可以得到通用解法：**除了一个数字以外，其余数字都出现 m 次 **\n```python\nclass Solution:\n    def singleNumber(self, nums: List[int]) -> int:\n        counts = [0] * 32 #记录每一位的和\n        for num in nums:\n            for j in range(32):\n                counts[j] += num & 1\n                num >>= 1 #右移1位\n        res, m = 0, 3\n        for i in range(32):\n            res <<= 1\n            res |= counts[31 - i] % m  # 位或运算 从高位开始然后左移运算\n        return res # if counts[31] % m == 0 else ~(res ^ 0xffffffff) #最高位为0则为正数，否则为负数\n```\n\n负数此处的操作没有看懂。经测试，直接return res即可。\n\n> 由于 Python 的存储负数的特殊性，需要先将 0 - 32 位取反（即 res ^ 0xffffffff ），再将所有位取反（即 ~ ）。**^表示二进制异或运算**\n> 两个组合操作实质上是将数字 32 以上位取反， 0 - 32 位不变。\n\n","source":"_posts/leetcode/leetcode-offer56-2.md","raw":"---\ntitle: 剑指offer56-2 数组中数字出现的次数Ⅱ\ntags: [剑指,数组]\ncategories: [剑指,数组]\ndate: 2021-12-08 13:43:59\n---\n\n>数组中数字出现的次数Ⅱ\n\n## 题目\n\n在一个数组 `nums` 中除一个数字只出现一次之外，其他数字都出现了三次。请找出那个只出现一次的数字。\n\n### 示例 1：\n\n```\n输入：nums = [3,4,3,3]\n输出：4\n```\n\n### 示例 2：\n\n```\n输入：nums = [9,1,7,9,7,9,7]\n输出：1\n```\n\n### 提示：\n\n- `1 <= nums.length <= 10000`\n\n- `1 <= nums[i] < 2^31`\n\n\n## 题解\n\n使用哈希表记录次数，然后再寻找次数为1的数字。此时的时间复杂度为O(N),空间复杂度为O(N)。\n\n```python\nclass Solution:\n    def singleNumber(self, nums: List[int]) -> int:\n        tmap = {}\n        for num in nums:\n            tmap[num] = tmap[num]+1 if num in tmap else 1\n        for num in tmap:\n            if tmap[num] == 1:\n                return num\n```\n\n还有一种方法可以达到时间复杂度为O(N),空间复杂度为O(1);\n\n其思想是每一位的二进制位对于出现3次的数字相加是3的倍数。这样可以把每一位相加对 3 除余数，可以得到出现一次的数字。\n\n![](https://picture.mulindya.com/leetcode-offer56-2.png)\n\n实际上修改余数m，可以得到通用解法：**除了一个数字以外，其余数字都出现 m 次 **\n```python\nclass Solution:\n    def singleNumber(self, nums: List[int]) -> int:\n        counts = [0] * 32 #记录每一位的和\n        for num in nums:\n            for j in range(32):\n                counts[j] += num & 1\n                num >>= 1 #右移1位\n        res, m = 0, 3\n        for i in range(32):\n            res <<= 1\n            res |= counts[31 - i] % m  # 位或运算 从高位开始然后左移运算\n        return res # if counts[31] % m == 0 else ~(res ^ 0xffffffff) #最高位为0则为正数，否则为负数\n```\n\n负数此处的操作没有看懂。经测试，直接return res即可。\n\n> 由于 Python 的存储负数的特殊性，需要先将 0 - 32 位取反（即 res ^ 0xffffffff ），再将所有位取反（即 ~ ）。**^表示二进制异或运算**\n> 两个组合操作实质上是将数字 32 以上位取反， 0 - 32 位不变。\n\n","slug":"leetcode/leetcode-offer56-2","published":1,"updated":"2022-01-18T08:10:17.093Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0b00057ast9cb6ldzfr","content":"<blockquote>\n<p>数组中数字出现的次数Ⅱ</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>在一个数组 <code>nums</code> 中除一个数字只出现一次之外，其他数字都出现了三次。请找出那个只出现一次的数字。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight dns\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：nums = [<span class=\"hljs-number\">3,4,3,3</span>]<br>输出：<span class=\"hljs-number\">4</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight accesslog\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs accesslog\">输入：nums = <span class=\"hljs-string\">[9,1,7,9,7,9,7]</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>\n<p><code>1 &lt;= nums.length &lt;= 10000</code></p>\n</li>\n<li>\n<p><code>1 &lt;= nums[i] &lt; 2^31</code></p>\n</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用哈希表记录次数，然后再寻找次数为1的数字。此时的时间复杂度为O(N),空间复杂度为O(N)。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">singleNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        tmap = {}<br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            tmap[num] = tmap[num]+<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">if</span> num <span class=\"hljs-keyword\">in</span> tmap <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> tmap:<br>            <span class=\"hljs-keyword\">if</span> tmap[num] == <span class=\"hljs-number\">1</span>:<br>                <span class=\"hljs-keyword\">return</span> num<br></code></pre></td></tr></tbody></table></figure>\n<p>还有一种方法可以达到时间复杂度为O(N),空间复杂度为O(1);</p>\n<p>其思想是每一位的二进制位对于出现3次的数字相加是3的倍数。这样可以把每一位相加对 3 除余数，可以得到出现一次的数字。</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer56-2.png\" alt=\"\"></p>\n<p>实际上修改余数m，可以得到通用解法：**除了一个数字以外，其余数字都出现 m 次 **</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">singleNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        counts = [<span class=\"hljs-number\">0</span>] * <span class=\"hljs-number\">32</span> <span class=\"hljs-comment\">#记录每一位的和</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">32</span>):<br>                counts[j] += num &amp; <span class=\"hljs-number\">1</span><br>                num &gt;&gt;= <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#右移1位</span><br>        res, m = <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">3</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">32</span>):<br>            res &lt;&lt;= <span class=\"hljs-number\">1</span><br>            res |= counts[<span class=\"hljs-number\">31</span> - i] % m  <span class=\"hljs-comment\"># 位或运算 从高位开始然后左移运算</span><br>        <span class=\"hljs-keyword\">return</span> res <span class=\"hljs-comment\"># if counts[31] % m == 0 else ~(res ^ 0xffffffff) #最高位为0则为正数，否则为负数</span><br></code></pre></td></tr></tbody></table></figure>\n<p>负数此处的操作没有看懂。经测试，直接return res即可。</p>\n<blockquote>\n<p>由于 Python 的存储负数的特殊性，需要先将 0 - 32 位取反（即 res ^ 0xffffffff ），再将所有位取反（即 ~ ）。<strong>^表示二进制异或运算</strong><br>\n两个组合操作实质上是将数字 32 以上位取反， 0 - 32 位不变。</p>\n</blockquote>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>数组中数字出现的次数Ⅱ</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>在一个数组 <code>nums</code> 中除一个数字只出现一次之外，其他数字都出现了三次。请找出那个只出现一次的数字。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight dns\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dns\">输入：nums = [<span class=\"hljs-number\">3,4,3,3</span>]<br>输出：<span class=\"hljs-number\">4</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs accesslog\">输入：nums = <span class=\"hljs-string\">[9,1,7,9,7,9,7]</span><br>输出：<span class=\"hljs-number\">1</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>\n<p><code>1 &lt;= nums.length &lt;= 10000</code></p>\n</li>\n<li>\n<p><code>1 &lt;= nums[i] &lt; 2^31</code></p>\n</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用哈希表记录次数，然后再寻找次数为1的数字。此时的时间复杂度为O(N),空间复杂度为O(N)。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">singleNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        tmap = &#123;&#125;<br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            tmap[num] = tmap[num]+<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">if</span> num <span class=\"hljs-keyword\">in</span> tmap <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> tmap:<br>            <span class=\"hljs-keyword\">if</span> tmap[num] == <span class=\"hljs-number\">1</span>:<br>                <span class=\"hljs-keyword\">return</span> num<br></code></pre></td></tr></table></figure>\n<p>还有一种方法可以达到时间复杂度为O(N),空间复杂度为O(1);</p>\n<p>其思想是每一位的二进制位对于出现3次的数字相加是3的倍数。这样可以把每一位相加对 3 除余数，可以得到出现一次的数字。</p>\n<p><img src=\"https://picture.mulindya.com/leetcode-offer56-2.png\" alt=\"\"></p>\n<p>实际上修改余数m，可以得到通用解法：**除了一个数字以外，其余数字都出现 m 次 **</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">singleNumber</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]</span>) -&gt; <span class=\"hljs-built_in\">int</span>:</span><br>        counts = [<span class=\"hljs-number\">0</span>] * <span class=\"hljs-number\">32</span> <span class=\"hljs-comment\">#记录每一位的和</span><br>        <span class=\"hljs-keyword\">for</span> num <span class=\"hljs-keyword\">in</span> nums:<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">32</span>):<br>                counts[j] += num &amp; <span class=\"hljs-number\">1</span><br>                num &gt;&gt;= <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#右移1位</span><br>        res, m = <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">3</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">32</span>):<br>            res &lt;&lt;= <span class=\"hljs-number\">1</span><br>            res |= counts[<span class=\"hljs-number\">31</span> - i] % m  <span class=\"hljs-comment\"># 位或运算 从高位开始然后左移运算</span><br>        <span class=\"hljs-keyword\">return</span> res <span class=\"hljs-comment\"># if counts[31] % m == 0 else ~(res ^ 0xffffffff) #最高位为0则为正数，否则为负数</span><br></code></pre></td></tr></table></figure>\n<p>负数此处的操作没有看懂。经测试，直接return res即可。</p>\n<blockquote>\n<p>由于 Python 的存储负数的特殊性，需要先将 0 - 32 位取反（即 res ^ 0xffffffff ），再将所有位取反（即 ~ ）。<strong>^表示二进制异或运算</strong><br>\n两个组合操作实质上是将数字 32 以上位取反， 0 - 32 位不变。</p>\n</blockquote>\n"},{"title":"剑指offer57-2 和为s的连续正数序列","date":"2021-12-30T05:08:25.000Z","_content":"\n> 和为s的连续正数序列\n\n## 题目\n输入一个正整数 target ，输出所有和为 target 的连续正整数序列（至少含有两个数）。\n\n序列内的数字由小到大排列，不同序列按照首个数字从小到大排列。\n\n\n### 示例 1：\n\n```\n输入：target = 9\n输出：[[2,3,4],[4,5]]\n```\n\n### 示例 2：\n\n```\n输入：target = 15\n输出：[[1,2,3,4,5],[4,5,6],[7,8]]\n```\n\n### 提示：\n\n- 1 <= target <= 10^5\n\n## 题解\n\n### 遍历解法\n从1到`target//2`为首遍历是否存在连续的序列为target。使用两层循环，外层循环确定首元素，内层循环确定尾元素，如果遍历到的和大于target就终止；\n```python\nclass Solution:\n    def findContinuousSequence(self, target: int) -> List[List[int]]:\n        limit = int(target/2)\n        result = []\n        for head in range(1,limit+1):\n            temp,t,sumt = [head],head+1,head\n            while(1):\n                sumt += t\n                temp.append(t)  \n                if sumt==target:\n                    result.append(temp)\n                    break\n                if sumt>target: break\n                if sumt<target: t += 1\n        return result\n\n```\n### 滑动窗口\n使用滑动窗口来确定序列首尾位置；\n在这里i，j分别表示首尾元素；\n- 序列元素和sumt小于target，就右移j；\n- 序列元素和大于target，就右移i；\n\n这里不存在左移的情况，不左移i好理解，因为i是从头开始查找的嘛，左移不是重复了嘛，何况还要保证首元素的顺序；那么不左移j的原因是什么呢。也是同样的道理，这个窗口只是负责尾节点右移扩大和首节点右移缩小，是可以遍历所有的情况哒。比如`1,2,3,4,5...`,target为5，开始就会到`1,2,3`,然后再到`2,3`;即尾节点只负责增大序列和，首节点只负责缩小序列和。:wink:\n```python\nclass Solution:\n    def findContinuousSequence(self, target: int) -> List[List[int]]:\n        #滑动窗口\n        i,j,sumt,result = 1,1,1,[]\n        while(i<=target//2):\n            if(sumt<target):\n                j += 1\n                sumt += j\n                continue\n            if(sumt==target):result.append(list(range(i,j+1))) #需要list转换\n            sumt -= i\n            i += 1\n        return result\n```\n\n","source":"_posts/leetcode/leetcode-offer57-2.md","raw":"---\ntitle: 剑指offer57-2 和为s的连续正数序列\ntags: [剑指,滑动窗口]\ncategories: [剑指,滑动窗口]\ndate: 2021-12-30 13:08:25\n---\n\n> 和为s的连续正数序列\n\n## 题目\n输入一个正整数 target ，输出所有和为 target 的连续正整数序列（至少含有两个数）。\n\n序列内的数字由小到大排列，不同序列按照首个数字从小到大排列。\n\n\n### 示例 1：\n\n```\n输入：target = 9\n输出：[[2,3,4],[4,5]]\n```\n\n### 示例 2：\n\n```\n输入：target = 15\n输出：[[1,2,3,4,5],[4,5,6],[7,8]]\n```\n\n### 提示：\n\n- 1 <= target <= 10^5\n\n## 题解\n\n### 遍历解法\n从1到`target//2`为首遍历是否存在连续的序列为target。使用两层循环，外层循环确定首元素，内层循环确定尾元素，如果遍历到的和大于target就终止；\n```python\nclass Solution:\n    def findContinuousSequence(self, target: int) -> List[List[int]]:\n        limit = int(target/2)\n        result = []\n        for head in range(1,limit+1):\n            temp,t,sumt = [head],head+1,head\n            while(1):\n                sumt += t\n                temp.append(t)  \n                if sumt==target:\n                    result.append(temp)\n                    break\n                if sumt>target: break\n                if sumt<target: t += 1\n        return result\n\n```\n### 滑动窗口\n使用滑动窗口来确定序列首尾位置；\n在这里i，j分别表示首尾元素；\n- 序列元素和sumt小于target，就右移j；\n- 序列元素和大于target，就右移i；\n\n这里不存在左移的情况，不左移i好理解，因为i是从头开始查找的嘛，左移不是重复了嘛，何况还要保证首元素的顺序；那么不左移j的原因是什么呢。也是同样的道理，这个窗口只是负责尾节点右移扩大和首节点右移缩小，是可以遍历所有的情况哒。比如`1,2,3,4,5...`,target为5，开始就会到`1,2,3`,然后再到`2,3`;即尾节点只负责增大序列和，首节点只负责缩小序列和。:wink:\n```python\nclass Solution:\n    def findContinuousSequence(self, target: int) -> List[List[int]]:\n        #滑动窗口\n        i,j,sumt,result = 1,1,1,[]\n        while(i<=target//2):\n            if(sumt<target):\n                j += 1\n                sumt += j\n                continue\n            if(sumt==target):result.append(list(range(i,j+1))) #需要list转换\n            sumt -= i\n            i += 1\n        return result\n```\n\n","slug":"leetcode/leetcode-offer57-2","published":1,"updated":"2022-01-18T08:10:17.093Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0b20059ast9hcmif6nl","content":"<blockquote>\n<p>和为s的连续正数序列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个正整数 target ，输出所有和为 target 的连续正整数序列（至少含有两个数）。</p>\n<p>序列内的数字由小到大排列，不同序列按照首个数字从小到大排列。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\">输入：target = <span class=\"hljs-number\">9</span><br>输出：<span class=\"hljs-string\">[[2,3,4],[4,5]]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\">输入：target = <span class=\"hljs-number\">15</span><br>输出：<span class=\"hljs-string\">[[1,2,3,4,5],[4,5,6],[7,8]]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= target &lt;= 10^5</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h3 id=\"遍历解法\">遍历解法</h3>\n<p>从1到<code>target//2</code>为首遍历是否存在连续的序列为target。使用两层循环，外层循环确定首元素，内层循环确定尾元素，如果遍历到的和大于target就终止；</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findContinuousSequence</span>(<span class=\"hljs-params\">self, target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        limit = <span class=\"hljs-built_in\">int</span>(target/<span class=\"hljs-number\">2</span>)<br>        result = []<br>        <span class=\"hljs-keyword\">for</span> head <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,limit+<span class=\"hljs-number\">1</span>):<br>            temp,t,sumt = [head],head+<span class=\"hljs-number\">1</span>,head<br>            <span class=\"hljs-keyword\">while</span>(<span class=\"hljs-number\">1</span>):<br>                sumt += t<br>                temp.append(t)  <br>                <span class=\"hljs-keyword\">if</span> sumt==target:<br>                    result.append(temp)<br>                    <span class=\"hljs-keyword\">break</span><br>                <span class=\"hljs-keyword\">if</span> sumt&gt;target: <span class=\"hljs-keyword\">break</span><br>                <span class=\"hljs-keyword\">if</span> sumt&lt;target: t += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> result<br><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"滑动窗口\">滑动窗口</h3>\n<p>使用滑动窗口来确定序列首尾位置；<br>\n在这里i，j分别表示首尾元素；</p>\n<ul>\n<li>序列元素和sumt小于target，就右移j；</li>\n<li>序列元素和大于target，就右移i；</li>\n</ul>\n<p>这里不存在左移的情况，不左移i好理解，因为i是从头开始查找的嘛，左移不是重复了嘛，何况还要保证首元素的顺序；那么不左移j的原因是什么呢。也是同样的道理，这个窗口只是负责尾节点右移扩大和首节点右移缩小，是可以遍历所有的情况哒。比如<code>1,2,3,4,5...</code>,target为5，开始就会到<code>1,2,3</code>,然后再到<code>2,3</code>;即尾节点只负责增大序列和，首节点只负责缩小序列和。😉</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findContinuousSequence</span>(<span class=\"hljs-params\">self, target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-comment\">#滑动窗口</span><br>        i,j,sumt,result = <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,[]<br>        <span class=\"hljs-keyword\">while</span>(i&lt;=target//<span class=\"hljs-number\">2</span>):<br>            <span class=\"hljs-keyword\">if</span>(sumt&lt;target):<br>                j += <span class=\"hljs-number\">1</span><br>                sumt += j<br>                <span class=\"hljs-keyword\">continue</span><br>            <span class=\"hljs-keyword\">if</span>(sumt==target):result.append(<span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">range</span>(i,j+<span class=\"hljs-number\">1</span>))) <span class=\"hljs-comment\">#需要list转换</span><br>            sumt -= i<br>            i += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>和为s的连续正数序列</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个正整数 target ，输出所有和为 target 的连续正整数序列（至少含有两个数）。</p>\n<p>序列内的数字由小到大排列，不同序列按照首个数字从小到大排列。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\">输入：target = <span class=\"hljs-number\">9</span><br>输出：<span class=\"hljs-string\">[[2,3,4],[4,5]]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\">输入：target = <span class=\"hljs-number\">15</span><br>输出：<span class=\"hljs-string\">[[1,2,3,4,5],[4,5,6],[7,8]]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= target &lt;= 10^5</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<h3 id=\"遍历解法\">遍历解法</h3>\n<p>从1到<code>target//2</code>为首遍历是否存在连续的序列为target。使用两层循环，外层循环确定首元素，内层循环确定尾元素，如果遍历到的和大于target就终止；</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findContinuousSequence</span>(<span class=\"hljs-params\">self, target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        limit = <span class=\"hljs-built_in\">int</span>(target/<span class=\"hljs-number\">2</span>)<br>        result = []<br>        <span class=\"hljs-keyword\">for</span> head <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,limit+<span class=\"hljs-number\">1</span>):<br>            temp,t,sumt = [head],head+<span class=\"hljs-number\">1</span>,head<br>            <span class=\"hljs-keyword\">while</span>(<span class=\"hljs-number\">1</span>):<br>                sumt += t<br>                temp.append(t)  <br>                <span class=\"hljs-keyword\">if</span> sumt==target:<br>                    result.append(temp)<br>                    <span class=\"hljs-keyword\">break</span><br>                <span class=\"hljs-keyword\">if</span> sumt&gt;target: <span class=\"hljs-keyword\">break</span><br>                <span class=\"hljs-keyword\">if</span> sumt&lt;target: t += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> result<br><br></code></pre></td></tr></table></figure>\n<h3 id=\"滑动窗口\">滑动窗口</h3>\n<p>使用滑动窗口来确定序列首尾位置；<br>\n在这里i，j分别表示首尾元素；</p>\n<ul>\n<li>序列元素和sumt小于target，就右移j；</li>\n<li>序列元素和大于target，就右移i；</li>\n</ul>\n<p>这里不存在左移的情况，不左移i好理解，因为i是从头开始查找的嘛，左移不是重复了嘛，何况还要保证首元素的顺序；那么不左移j的原因是什么呢。也是同样的道理，这个窗口只是负责尾节点右移扩大和首节点右移缩小，是可以遍历所有的情况哒。比如<code>1,2,3,4,5...</code>,target为5，开始就会到<code>1,2,3</code>,然后再到<code>2,3</code>;即尾节点只负责增大序列和，首节点只负责缩小序列和。😉</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">findContinuousSequence</span>(<span class=\"hljs-params\">self, target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]]:</span><br>        <span class=\"hljs-comment\">#滑动窗口</span><br>        i,j,sumt,result = <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,[]<br>        <span class=\"hljs-keyword\">while</span>(i&lt;=target//<span class=\"hljs-number\">2</span>):<br>            <span class=\"hljs-keyword\">if</span>(sumt&lt;target):<br>                j += <span class=\"hljs-number\">1</span><br>                sumt += j<br>                <span class=\"hljs-keyword\">continue</span><br>            <span class=\"hljs-keyword\">if</span>(sumt==target):result.append(<span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">range</span>(i,j+<span class=\"hljs-number\">1</span>))) <span class=\"hljs-comment\">#需要list转换</span><br>            sumt -= i<br>            i += <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> result<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer57 和为s的两个数字","date":"2021-11-17T03:50:41.000Z","_content":"\n> 和为s的两个数字\n\n## 题目\n输入一个递增排序的数组和一个数字s，在数组中查找两个数，使得它们的和正好是s。如果有多对数字的和等于s，则输出任意一对即可。\n\n\n### 示例 1：\n\n```\n输入：nums = [2,7,11,15], target = 9\n输出：[2,7] 或者 [7,2]\n```\n\n### 示例 2：\n\n```\n输入：nums = [10,26,30,31,47,60], target = 40\n输出：[10,30] 或者 [30,10]\n```\n\n### 提示：\n\n- 1 <= nums.length <= 10^5\n- 1 <= nums[i] <= 10^6\n\n## 题解\n\n因为时单调递增的数组，那么可以直接从两端找起，向中间收缩。可以用递归的双指针，也可以使用while循环遍历，时间复杂度为O(N)。\n\n#### 递归\n\n```python\nclass Solution:\n    def twoSum(self, nums: List[int], target: int) -> List[int]:\n        def find(left,right):\n            if(left>=right): return\n            if(nums[left]+nums[right]==target): \n                self.result = [nums[left],nums[right]]\n                return\n            if(nums[left]+nums[right]>target): find(left,right-1)\n            else: find(left+1,right)\n        self.result = []\n        find(0,len(nums)-1)\n        return self.result\n```\n#### 循环\n\n使用while循环比使用递归的方法，空间复杂度更小，更快。\n```python\nclass Solution:\n    def twoSum(self, nums: List[int], target: int) -> List[int]:\n        left,right = 0,len(nums)-1\n        while(left<right):\n            if(nums[left]+nums[right]==target): return [nums[left],nums[right]]\n            elif(nums[left]+nums[right]<target): left+=1\n            else: right -= 1\n        return []\n```\n","source":"_posts/leetcode/leetcode-offer57.md","raw":"---\ntitle: 剑指offer57 和为s的两个数字\ntags: [剑指,双指针]\ncategories:  [剑指,双指针]\ndate: 2021-11-17 11:50:41\n---\n\n> 和为s的两个数字\n\n## 题目\n输入一个递增排序的数组和一个数字s，在数组中查找两个数，使得它们的和正好是s。如果有多对数字的和等于s，则输出任意一对即可。\n\n\n### 示例 1：\n\n```\n输入：nums = [2,7,11,15], target = 9\n输出：[2,7] 或者 [7,2]\n```\n\n### 示例 2：\n\n```\n输入：nums = [10,26,30,31,47,60], target = 40\n输出：[10,30] 或者 [30,10]\n```\n\n### 提示：\n\n- 1 <= nums.length <= 10^5\n- 1 <= nums[i] <= 10^6\n\n## 题解\n\n因为时单调递增的数组，那么可以直接从两端找起，向中间收缩。可以用递归的双指针，也可以使用while循环遍历，时间复杂度为O(N)。\n\n#### 递归\n\n```python\nclass Solution:\n    def twoSum(self, nums: List[int], target: int) -> List[int]:\n        def find(left,right):\n            if(left>=right): return\n            if(nums[left]+nums[right]==target): \n                self.result = [nums[left],nums[right]]\n                return\n            if(nums[left]+nums[right]>target): find(left,right-1)\n            else: find(left+1,right)\n        self.result = []\n        find(0,len(nums)-1)\n        return self.result\n```\n#### 循环\n\n使用while循环比使用递归的方法，空间复杂度更小，更快。\n```python\nclass Solution:\n    def twoSum(self, nums: List[int], target: int) -> List[int]:\n        left,right = 0,len(nums)-1\n        while(left<right):\n            if(nums[left]+nums[right]==target): return [nums[left],nums[right]]\n            elif(nums[left]+nums[right]<target): left+=1\n            else: right -= 1\n        return []\n```\n","slug":"leetcode/leetcode-offer57","published":1,"updated":"2022-01-18T08:10:17.094Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0b4005bast929fldv7b","content":"<blockquote>\n<p>和为s的两个数字</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个递增排序的数组和一个数字s，在数组中查找两个数，使得它们的和正好是s。如果有多对数字的和等于s，则输出任意一对即可。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：nums = <span class=\"hljs-comment\">[2,7,11,15]</span>, target = 9<br>输出：<span class=\"hljs-comment\">[2,7]</span> 或者 <span class=\"hljs-comment\">[7,2]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：nums = <span class=\"hljs-comment\">[10,26,30,31,47,60]</span>, target = 40<br>输出：<span class=\"hljs-comment\">[10,30]</span> 或者 <span class=\"hljs-comment\">[30,10]</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= nums.length &lt;= 10^5</li>\n<li>1 &lt;= nums[i] &lt;= 10^6</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>因为时单调递增的数组，那么可以直接从两端找起，向中间收缩。可以用递归的双指针，也可以使用while循环遍历，时间复杂度为O(N)。</p>\n<h4 id=\"递归\">递归</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">twoSum</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">find</span>(<span class=\"hljs-params\">left,right</span>):</span><br>            <span class=\"hljs-keyword\">if</span>(left&gt;=right): <span class=\"hljs-keyword\">return</span><br>            <span class=\"hljs-keyword\">if</span>(nums[left]+nums[right]==target): <br>                self.result = [nums[left],nums[right]]<br>                <span class=\"hljs-keyword\">return</span><br>            <span class=\"hljs-keyword\">if</span>(nums[left]+nums[right]&gt;target): find(left,right-<span class=\"hljs-number\">1</span>)<br>            <span class=\"hljs-keyword\">else</span>: find(left+<span class=\"hljs-number\">1</span>,right)<br>        self.result = []<br>        find(<span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">len</span>(nums)-<span class=\"hljs-number\">1</span>)<br>        <span class=\"hljs-keyword\">return</span> self.result<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"循环\">循环</h4>\n<p>使用while循环比使用递归的方法，空间复杂度更小，更快。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">twoSum</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        left,right = <span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">len</span>(nums)-<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">while</span>(left&lt;right):<br>            <span class=\"hljs-keyword\">if</span>(nums[left]+nums[right]==target): <span class=\"hljs-keyword\">return</span> [nums[left],nums[right]]<br>            <span class=\"hljs-keyword\">elif</span>(nums[left]+nums[right]&lt;target): left+=<span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>: right -= <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> []<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>和为s的两个数字</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个递增排序的数组和一个数字s，在数组中查找两个数，使得它们的和正好是s。如果有多对数字的和等于s，则输出任意一对即可。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：nums = <span class=\"hljs-comment\">[2,7,11,15]</span>, target = 9<br>输出：<span class=\"hljs-comment\">[2,7]</span> 或者 <span class=\"hljs-comment\">[7,2]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs inform7\">输入：nums = <span class=\"hljs-comment\">[10,26,30,31,47,60]</span>, target = 40<br>输出：<span class=\"hljs-comment\">[10,30]</span> 或者 <span class=\"hljs-comment\">[30,10]</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= nums.length &lt;= 10^5</li>\n<li>1 &lt;= nums[i] &lt;= 10^6</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>因为时单调递增的数组，那么可以直接从两端找起，向中间收缩。可以用递归的双指针，也可以使用while循环遍历，时间复杂度为O(N)。</p>\n<h4 id=\"递归\">递归</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">twoSum</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">find</span>(<span class=\"hljs-params\">left,right</span>):</span><br>            <span class=\"hljs-keyword\">if</span>(left&gt;=right): <span class=\"hljs-keyword\">return</span><br>            <span class=\"hljs-keyword\">if</span>(nums[left]+nums[right]==target): <br>                self.result = [nums[left],nums[right]]<br>                <span class=\"hljs-keyword\">return</span><br>            <span class=\"hljs-keyword\">if</span>(nums[left]+nums[right]&gt;target): find(left,right-<span class=\"hljs-number\">1</span>)<br>            <span class=\"hljs-keyword\">else</span>: find(left+<span class=\"hljs-number\">1</span>,right)<br>        self.result = []<br>        find(<span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">len</span>(nums)-<span class=\"hljs-number\">1</span>)<br>        <span class=\"hljs-keyword\">return</span> self.result<br></code></pre></td></tr></table></figure>\n<h4 id=\"循环\">循环</h4>\n<p>使用while循环比使用递归的方法，空间复杂度更小，更快。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">twoSum</span>(<span class=\"hljs-params\">self, nums: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], target: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>]:</span><br>        left,right = <span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">len</span>(nums)-<span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">while</span>(left&lt;right):<br>            <span class=\"hljs-keyword\">if</span>(nums[left]+nums[right]==target): <span class=\"hljs-keyword\">return</span> [nums[left],nums[right]]<br>            <span class=\"hljs-keyword\">elif</span>(nums[left]+nums[right]&lt;target): left+=<span class=\"hljs-number\">1</span><br>            <span class=\"hljs-keyword\">else</span>: right -= <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-keyword\">return</span> []<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer58-1 翻转单词的顺序","date":"2022-01-04T02:43:22.000Z","_content":"\n>翻转单词的顺序\n\n## 题目\n\n输入一个英文句子，翻转句子中单词的顺序，但单词内字符的顺序不变。为简单起见，标点符号和普通字母一样处理。例如输入字符串\"I am a student. \"，则输出\"student. a am I\"。\n\n### 示例 1：\n\n```\n输入: \"the sky is blue\"\n输出: \"blue is sky the\"\n```\n\n### 示例 2：\n\n```\n输入: \"  hello world!  \"\n输出: \"world! hello\"\n解释: 输入字符串可以在前面或者后面包含多余的空格，但是反转后的字符不能包括。\n```\n\n### 示例 3：\n\n```\n输入: \"a good   example\"\n输出: \"example good a\"\n解释: 如果两个单词间有多余的空格，将反转后单词间的空格减少到只含一个。\n```\n\n### 提示：\n\n- 无空格字符构成一个单词。\n- 输入字符串可以在前面或者后面包含多余的空格，但是反转后的字符不能包括。\n- 如果两个单词间有多余的空格，将反转后单词间的空格减少到只含一个。\n\n## 题解\n\n使用双指针来定位词首尾位置，由于是倒序因此需要从后往前来搜索，先定位词的起始位置再跳过空格定位j的位置，截取单词到列表中，最后使用join连接字符串。\n\n```python\nclass Solution:\n    def reverseWords(self, s: str) -> str:\n        #从后往前 利用双指针来判断单词块\n        s = s.strip() # 删除首尾空格\n        # Python strip() 方法用于移除字符串头尾指定的字符（默认为空格或换行符）或字符序列。\n        # 注意：该方法只能删除开头或是结尾的字符，不能删除中间部分的字符。\n        i,j = len(s)-1,len(s)-1\n        res = []\n        while(i>=0):\n            while(i>=0 and s[i]!=' '): i -= 1 #确定词的起始位置\n            res.append(s[i+1:j+1])\n            while(i>=0 and s[i]==' '): i -= 1 #确定j的位置\n            j = i\n        return ' '.join(res)\n```\n\n使用内置函数split的话这里直接使用`split()`\n\n因为`s.split(\" \")`解决不了单词间多空格的问题，`s.split()`可以解决。\n\n```python\nclass Solution:\n    def reverseWords(self, s: str) -> str:\n        return ' '.join(s.strip().split()[::-1])\n```\n\n","source":"_posts/leetcode/leetcode-offer58-1.md","raw":"---\ntitle: 剑指offer58-1 翻转单词的顺序\ntags: [剑指,双指针]\ncategories: [剑指,双指针]\ndate: 2022-01-04 10:43:22\n---\n\n>翻转单词的顺序\n\n## 题目\n\n输入一个英文句子，翻转句子中单词的顺序，但单词内字符的顺序不变。为简单起见，标点符号和普通字母一样处理。例如输入字符串\"I am a student. \"，则输出\"student. a am I\"。\n\n### 示例 1：\n\n```\n输入: \"the sky is blue\"\n输出: \"blue is sky the\"\n```\n\n### 示例 2：\n\n```\n输入: \"  hello world!  \"\n输出: \"world! hello\"\n解释: 输入字符串可以在前面或者后面包含多余的空格，但是反转后的字符不能包括。\n```\n\n### 示例 3：\n\n```\n输入: \"a good   example\"\n输出: \"example good a\"\n解释: 如果两个单词间有多余的空格，将反转后单词间的空格减少到只含一个。\n```\n\n### 提示：\n\n- 无空格字符构成一个单词。\n- 输入字符串可以在前面或者后面包含多余的空格，但是反转后的字符不能包括。\n- 如果两个单词间有多余的空格，将反转后单词间的空格减少到只含一个。\n\n## 题解\n\n使用双指针来定位词首尾位置，由于是倒序因此需要从后往前来搜索，先定位词的起始位置再跳过空格定位j的位置，截取单词到列表中，最后使用join连接字符串。\n\n```python\nclass Solution:\n    def reverseWords(self, s: str) -> str:\n        #从后往前 利用双指针来判断单词块\n        s = s.strip() # 删除首尾空格\n        # Python strip() 方法用于移除字符串头尾指定的字符（默认为空格或换行符）或字符序列。\n        # 注意：该方法只能删除开头或是结尾的字符，不能删除中间部分的字符。\n        i,j = len(s)-1,len(s)-1\n        res = []\n        while(i>=0):\n            while(i>=0 and s[i]!=' '): i -= 1 #确定词的起始位置\n            res.append(s[i+1:j+1])\n            while(i>=0 and s[i]==' '): i -= 1 #确定j的位置\n            j = i\n        return ' '.join(res)\n```\n\n使用内置函数split的话这里直接使用`split()`\n\n因为`s.split(\" \")`解决不了单词间多空格的问题，`s.split()`可以解决。\n\n```python\nclass Solution:\n    def reverseWords(self, s: str) -> str:\n        return ' '.join(s.strip().split()[::-1])\n```\n\n","slug":"leetcode/leetcode-offer58-1","published":1,"updated":"2022-01-18T08:10:17.095Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0b5005dast90s3l7hh6","content":"<blockquote>\n<p>翻转单词的顺序</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个英文句子，翻转句子中单词的顺序，但单词内字符的顺序不变。为简单起见，标点符号和普通字母一样处理。例如输入字符串\"I am a student. “，则输出\"student. a am I”。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight smalltalk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs smalltalk\">输入: <span class=\"hljs-comment\">\"the sky is blue\"</span><br>输出: <span class=\"hljs-comment\">\"blue is sky the\"</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight makefile\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: \" &nbsp;hello world! &nbsp;\"</span><br><span class=\"hljs-section\">输出:&nbsp;\"world! hello\"</span><br><span class=\"hljs-section\">解释: 输入字符串可以在前面或者后面包含多余的空格，但是反转后的字符不能包括。</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight smalltalk\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs smalltalk\">输入: <span class=\"hljs-comment\">\"a good &nbsp; example\"</span><br>输出:&nbsp;<span class=\"hljs-comment\">\"example good a\"</span><br>解释: 如果两个单词间有多余的空格，将反转后单词间的空格减少到只含一个。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>无空格字符构成一个单词。</li>\n<li>输入字符串可以在前面或者后面包含多余的空格，但是反转后的字符不能包括。</li>\n<li>如果两个单词间有多余的空格，将反转后单词间的空格减少到只含一个。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用双指针来定位词首尾位置，由于是倒序因此需要从后往前来搜索，先定位词的起始位置再跳过空格定位j的位置，截取单词到列表中，最后使用join连接字符串。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">reverseWords</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>        <span class=\"hljs-comment\">#从后往前 利用双指针来判断单词块</span><br>        s = s.strip() <span class=\"hljs-comment\"># 删除首尾空格</span><br>        <span class=\"hljs-comment\"># Python strip() 方法用于移除字符串头尾指定的字符（默认为空格或换行符）或字符序列。</span><br>        <span class=\"hljs-comment\"># 注意：该方法只能删除开头或是结尾的字符，不能删除中间部分的字符。</span><br>        i,j = <span class=\"hljs-built_in\">len</span>(s)-<span class=\"hljs-number\">1</span>,<span class=\"hljs-built_in\">len</span>(s)-<span class=\"hljs-number\">1</span><br>        res = []<br>        <span class=\"hljs-keyword\">while</span>(i&gt;=<span class=\"hljs-number\">0</span>):<br>            <span class=\"hljs-keyword\">while</span>(i&gt;=<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> s[i]!=<span class=\"hljs-string\">' '</span>): i -= <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#确定词的起始位置</span><br>            res.append(s[i+<span class=\"hljs-number\">1</span>:j+<span class=\"hljs-number\">1</span>])<br>            <span class=\"hljs-keyword\">while</span>(i&gt;=<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> s[i]==<span class=\"hljs-string\">' '</span>): i -= <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#确定j的位置</span><br>            j = i<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">' '</span>.join(res)<br></code></pre></td></tr></tbody></table></figure>\n<p>使用内置函数split的话这里直接使用<code>split()</code></p>\n<p>因为<code>s.split(\" \")</code>解决不了单词间多空格的问题，<code>s.split()</code>可以解决。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">reverseWords</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">' '</span>.join(s.strip().split()[::-<span class=\"hljs-number\">1</span>])<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>翻转单词的顺序</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>输入一个英文句子，翻转句子中单词的顺序，但单词内字符的顺序不变。为简单起见，标点符号和普通字母一样处理。例如输入字符串&quot;I am a student. “，则输出&quot;student. a am I”。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight smalltalk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs smalltalk\">输入: <span class=\"hljs-comment\">&quot;the sky is blue&quot;</span><br>输出: <span class=\"hljs-comment\">&quot;blue is sky the&quot;</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs makefile\"><span class=\"hljs-section\">输入: &quot;  hello world!  &quot;</span><br><span class=\"hljs-section\">输出: &quot;world! hello&quot;</span><br><span class=\"hljs-section\">解释: 输入字符串可以在前面或者后面包含多余的空格，但是反转后的字符不能包括。</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight smalltalk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs smalltalk\">输入: <span class=\"hljs-comment\">&quot;a good   example&quot;</span><br>输出: <span class=\"hljs-comment\">&quot;example good a&quot;</span><br>解释: 如果两个单词间有多余的空格，将反转后单词间的空格减少到只含一个。<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>无空格字符构成一个单词。</li>\n<li>输入字符串可以在前面或者后面包含多余的空格，但是反转后的字符不能包括。</li>\n<li>如果两个单词间有多余的空格，将反转后单词间的空格减少到只含一个。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用双指针来定位词首尾位置，由于是倒序因此需要从后往前来搜索，先定位词的起始位置再跳过空格定位j的位置，截取单词到列表中，最后使用join连接字符串。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">reverseWords</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>        <span class=\"hljs-comment\">#从后往前 利用双指针来判断单词块</span><br>        s = s.strip() <span class=\"hljs-comment\"># 删除首尾空格</span><br>        <span class=\"hljs-comment\"># Python strip() 方法用于移除字符串头尾指定的字符（默认为空格或换行符）或字符序列。</span><br>        <span class=\"hljs-comment\"># 注意：该方法只能删除开头或是结尾的字符，不能删除中间部分的字符。</span><br>        i,j = <span class=\"hljs-built_in\">len</span>(s)-<span class=\"hljs-number\">1</span>,<span class=\"hljs-built_in\">len</span>(s)-<span class=\"hljs-number\">1</span><br>        res = []<br>        <span class=\"hljs-keyword\">while</span>(i&gt;=<span class=\"hljs-number\">0</span>):<br>            <span class=\"hljs-keyword\">while</span>(i&gt;=<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> s[i]!=<span class=\"hljs-string\">&#x27; &#x27;</span>): i -= <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#确定词的起始位置</span><br>            res.append(s[i+<span class=\"hljs-number\">1</span>:j+<span class=\"hljs-number\">1</span>])<br>            <span class=\"hljs-keyword\">while</span>(i&gt;=<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> s[i]==<span class=\"hljs-string\">&#x27; &#x27;</span>): i -= <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">#确定j的位置</span><br>            j = i<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27; &#x27;</span>.join(res)<br></code></pre></td></tr></table></figure>\n<p>使用内置函数split的话这里直接使用<code>split()</code></p>\n<p>因为<code>s.split(&quot; &quot;)</code>解决不了单词间多空格的问题，<code>s.split()</code>可以解决。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">reverseWords</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27; &#x27;</span>.join(s.strip().split()[::-<span class=\"hljs-number\">1</span>])<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer859 亲密字符串","date":"2021-11-23T13:06:51.000Z","_content":"\n>亲密字符串\n\n## 题目\n\n给你两个字符串 s 和 goal ，只要我们可以通过交换 s 中的两个字母得到与 goal 相等的结果，就返回 true ；否则返回 false 。\n\n交换字母的定义是：取两个下标 i 和 j （下标从 0 开始）且满足 i != j ，接着交换 s[i] 和 s[j] 处的字符。\n\n- 例如，在 \"abcd\" 中交换下标 0 和下标 2 的元素可以生成 \"cbad\" 。\n\n\n### 示例 1：\n\n```\n输入：s = \"ab\", goal = \"ba\"\n输出：true\n解释：你可以交换 s[0] = 'a' 和 s[1] = 'b' 生成 \"ba\"，此时 s 和 goal 相等。\n```\n\n### 示例 2：\n\n```\n输入：s = \"ab\", goal = \"ab\"\n输出：false\n解释：你只能交换 s[0] = 'a' 和 s[1] = 'b' 生成 \"ba\"，此时 s 和 goal 不相等。\n```\n\n### 示例 3：\n\n```\n输入：s = \"aa\", goal = \"aa\"\n输出：true\n解释：你可以交换 s[0] = 'a' 和 s[1] = 'a' 生成 \"aa\"，此时 s 和 goal 相等。\n```\n\n### 示例 4：\n\n```\n输入：s = \"aaaaaaabc\", goal = \"aaaaaaacb\"\n输出：true\n```\n\n\n### 提示：\n\n- 1 <= s.length, goal.length <= 2 * 104\n- s 和 goal 由小写英文字母组成\n\n## 题解\n\n首先判断两个字符串的长度，如果长度不一致就直接返回False，diff用来存储两个字符串不同的字符的相应下标；然后判断diff的元素是否满足要求：\n\n1，diff有两个元素并且这两个元素在列表中对应相等；\n\n2，diff中元素为空（两个字符串相等），同时s中有重复字符（使用set来判断）；\n\n```python\nclass Solution:\n    def buddyStrings(self, s: str, goal: str) -> bool:\n        if(len(s)!=len(goal)):return False\n        # if(s==goal and len(set(s))!=len(s)): return True #放在前面会增加判断时间 相当于O(2N)\n        diff = []\n        for i in range(len(s)):\n            if(s[i]!=goal[i]):diff.append(i)\n        if(len(diff)==2 and s[diff[0]]==goal[diff[1]] and s[diff[1]]==goal[diff[0]]): return True\n        if(len(diff)==0 and len(set(s))!=len(s)): return True\n        return False\n```\n\n","source":"_posts/leetcode/leetcode-offer859.md","raw":"---\ntitle: 剑指offer859 亲密字符串\ntags: [剑指,字符串]\ncategories: [剑指,字符串]\ndate: 2021-11-23 21:06:51\n---\n\n>亲密字符串\n\n## 题目\n\n给你两个字符串 s 和 goal ，只要我们可以通过交换 s 中的两个字母得到与 goal 相等的结果，就返回 true ；否则返回 false 。\n\n交换字母的定义是：取两个下标 i 和 j （下标从 0 开始）且满足 i != j ，接着交换 s[i] 和 s[j] 处的字符。\n\n- 例如，在 \"abcd\" 中交换下标 0 和下标 2 的元素可以生成 \"cbad\" 。\n\n\n### 示例 1：\n\n```\n输入：s = \"ab\", goal = \"ba\"\n输出：true\n解释：你可以交换 s[0] = 'a' 和 s[1] = 'b' 生成 \"ba\"，此时 s 和 goal 相等。\n```\n\n### 示例 2：\n\n```\n输入：s = \"ab\", goal = \"ab\"\n输出：false\n解释：你只能交换 s[0] = 'a' 和 s[1] = 'b' 生成 \"ba\"，此时 s 和 goal 不相等。\n```\n\n### 示例 3：\n\n```\n输入：s = \"aa\", goal = \"aa\"\n输出：true\n解释：你可以交换 s[0] = 'a' 和 s[1] = 'a' 生成 \"aa\"，此时 s 和 goal 相等。\n```\n\n### 示例 4：\n\n```\n输入：s = \"aaaaaaabc\", goal = \"aaaaaaacb\"\n输出：true\n```\n\n\n### 提示：\n\n- 1 <= s.length, goal.length <= 2 * 104\n- s 和 goal 由小写英文字母组成\n\n## 题解\n\n首先判断两个字符串的长度，如果长度不一致就直接返回False，diff用来存储两个字符串不同的字符的相应下标；然后判断diff的元素是否满足要求：\n\n1，diff有两个元素并且这两个元素在列表中对应相等；\n\n2，diff中元素为空（两个字符串相等），同时s中有重复字符（使用set来判断）；\n\n```python\nclass Solution:\n    def buddyStrings(self, s: str, goal: str) -> bool:\n        if(len(s)!=len(goal)):return False\n        # if(s==goal and len(set(s))!=len(s)): return True #放在前面会增加判断时间 相当于O(2N)\n        diff = []\n        for i in range(len(s)):\n            if(s[i]!=goal[i]):diff.append(i)\n        if(len(diff)==2 and s[diff[0]]==goal[diff[1]] and s[diff[1]]==goal[diff[0]]): return True\n        if(len(diff)==0 and len(set(s))!=len(s)): return True\n        return False\n```\n\n","slug":"leetcode/leetcode-offer859","published":1,"updated":"2022-01-18T08:10:17.095Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0b8005gast9hnzidd7g","content":"<blockquote>\n<p>亲密字符串</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给你两个字符串 s 和 goal ，只要我们可以通过交换 s 中的两个字母得到与 goal 相等的结果，就返回 true ；否则返回 false 。</p>\n<p>交换字母的定义是：取两个下标 i 和 j （下标从 0 开始）且满足 i != j ，接着交换 s[i] 和 s[j] 处的字符。</p>\n<ul>\n<li>例如，在 “abcd” 中交换下标 0 和下标 2 的元素可以生成 “cbad” 。</li>\n</ul>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight mel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs mel\">输入：s = <span class=\"hljs-string\">\"ab\"</span>, <span class=\"hljs-keyword\">goal</span> = <span class=\"hljs-string\">\"ba\"</span><br>输出：true<br>解释：你可以交换 s[<span class=\"hljs-number\">0</span>] = <span class=\"hljs-string\">'a'</span> 和 s[<span class=\"hljs-number\">1</span>] = <span class=\"hljs-string\">'b'</span> 生成 <span class=\"hljs-string\">\"ba\"</span>，此时 s 和 <span class=\"hljs-keyword\">goal</span> 相等。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight mel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs mel\">输入：s = <span class=\"hljs-string\">\"ab\"</span>, <span class=\"hljs-keyword\">goal</span> = <span class=\"hljs-string\">\"ab\"</span><br>输出：false<br>解释：你只能交换 s[<span class=\"hljs-number\">0</span>] = <span class=\"hljs-string\">'a'</span> 和 s[<span class=\"hljs-number\">1</span>] = <span class=\"hljs-string\">'b'</span> 生成 <span class=\"hljs-string\">\"ba\"</span>，此时 s 和 <span class=\"hljs-keyword\">goal</span> 不相等。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight mel\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs mel\">输入：s = <span class=\"hljs-string\">\"aa\"</span>, <span class=\"hljs-keyword\">goal</span> = <span class=\"hljs-string\">\"aa\"</span><br>输出：true<br>解释：你可以交换 s[<span class=\"hljs-number\">0</span>] = <span class=\"hljs-string\">'a'</span> 和 s[<span class=\"hljs-number\">1</span>] = <span class=\"hljs-string\">'a'</span> 生成 <span class=\"hljs-string\">\"aa\"</span>，此时 s 和 <span class=\"hljs-keyword\">goal</span> 相等。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">\"aaaaaaabc\"</span>, <span class=\"hljs-attr\">goal</span> = <span class=\"hljs-string\">\"aaaaaaacb\"</span><br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= s.length, goal.length &lt;= 2 * 104</li>\n<li>s 和 goal 由小写英文字母组成</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>首先判断两个字符串的长度，如果长度不一致就直接返回False，diff用来存储两个字符串不同的字符的相应下标；然后判断diff的元素是否满足要求：</p>\n<p>1，diff有两个元素并且这两个元素在列表中对应相等；</p>\n<p>2，diff中元素为空（两个字符串相等），同时s中有重复字符（使用set来判断）；</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">buddyStrings</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span>, goal: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(s)!=<span class=\"hljs-built_in\">len</span>(goal)):<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>        <span class=\"hljs-comment\"># if(s==goal and len(set(s))!=len(s)): return True #放在前面会增加判断时间 相当于O(2N)</span><br>        diff = []<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(s)):<br>            <span class=\"hljs-keyword\">if</span>(s[i]!=goal[i]):diff.append(i)<br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(diff)==<span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">and</span> s[diff[<span class=\"hljs-number\">0</span>]]==goal[diff[<span class=\"hljs-number\">1</span>]] <span class=\"hljs-keyword\">and</span> s[diff[<span class=\"hljs-number\">1</span>]]==goal[diff[<span class=\"hljs-number\">0</span>]]): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(diff)==<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-built_in\">len</span>(<span class=\"hljs-built_in\">set</span>(s))!=<span class=\"hljs-built_in\">len</span>(s)): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>亲密字符串</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给你两个字符串 s 和 goal ，只要我们可以通过交换 s 中的两个字母得到与 goal 相等的结果，就返回 true ；否则返回 false 。</p>\n<p>交换字母的定义是：取两个下标 i 和 j （下标从 0 开始）且满足 i != j ，接着交换 s[i] 和 s[j] 处的字符。</p>\n<ul>\n<li>例如，在 “abcd” 中交换下标 0 和下标 2 的元素可以生成 “cbad” 。</li>\n</ul>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight mel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs mel\">输入：s = <span class=\"hljs-string\">&quot;ab&quot;</span>, <span class=\"hljs-keyword\">goal</span> = <span class=\"hljs-string\">&quot;ba&quot;</span><br>输出：true<br>解释：你可以交换 s[<span class=\"hljs-number\">0</span>] = <span class=\"hljs-string\">&#x27;a&#x27;</span> 和 s[<span class=\"hljs-number\">1</span>] = <span class=\"hljs-string\">&#x27;b&#x27;</span> 生成 <span class=\"hljs-string\">&quot;ba&quot;</span>，此时 s 和 <span class=\"hljs-keyword\">goal</span> 相等。<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight mel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs mel\">输入：s = <span class=\"hljs-string\">&quot;ab&quot;</span>, <span class=\"hljs-keyword\">goal</span> = <span class=\"hljs-string\">&quot;ab&quot;</span><br>输出：false<br>解释：你只能交换 s[<span class=\"hljs-number\">0</span>] = <span class=\"hljs-string\">&#x27;a&#x27;</span> 和 s[<span class=\"hljs-number\">1</span>] = <span class=\"hljs-string\">&#x27;b&#x27;</span> 生成 <span class=\"hljs-string\">&quot;ba&quot;</span>，此时 s 和 <span class=\"hljs-keyword\">goal</span> 不相等。<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight mel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs mel\">输入：s = <span class=\"hljs-string\">&quot;aa&quot;</span>, <span class=\"hljs-keyword\">goal</span> = <span class=\"hljs-string\">&quot;aa&quot;</span><br>输出：true<br>解释：你可以交换 s[<span class=\"hljs-number\">0</span>] = <span class=\"hljs-string\">&#x27;a&#x27;</span> 和 s[<span class=\"hljs-number\">1</span>] = <span class=\"hljs-string\">&#x27;a&#x27;</span> 生成 <span class=\"hljs-string\">&quot;aa&quot;</span>，此时 s 和 <span class=\"hljs-keyword\">goal</span> 相等。<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">&quot;aaaaaaabc&quot;</span>, <span class=\"hljs-attr\">goal</span> = <span class=\"hljs-string\">&quot;aaaaaaacb&quot;</span><br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= s.length, goal.length &lt;= 2 * 104</li>\n<li>s 和 goal 由小写英文字母组成</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>首先判断两个字符串的长度，如果长度不一致就直接返回False，diff用来存储两个字符串不同的字符的相应下标；然后判断diff的元素是否满足要求：</p>\n<p>1，diff有两个元素并且这两个元素在列表中对应相等；</p>\n<p>2，diff中元素为空（两个字符串相等），同时s中有重复字符（使用set来判断）；</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">buddyStrings</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span>, goal: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(s)!=<span class=\"hljs-built_in\">len</span>(goal)):<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br>        <span class=\"hljs-comment\"># if(s==goal and len(set(s))!=len(s)): return True #放在前面会增加判断时间 相当于O(2N)</span><br>        diff = []<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(s)):<br>            <span class=\"hljs-keyword\">if</span>(s[i]!=goal[i]):diff.append(i)<br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(diff)==<span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">and</span> s[diff[<span class=\"hljs-number\">0</span>]]==goal[diff[<span class=\"hljs-number\">1</span>]] <span class=\"hljs-keyword\">and</span> s[diff[<span class=\"hljs-number\">1</span>]]==goal[diff[<span class=\"hljs-number\">0</span>]]): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">len</span>(diff)==<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-built_in\">len</span>(<span class=\"hljs-built_in\">set</span>(s))!=<span class=\"hljs-built_in\">len</span>(s)): <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span><br></code></pre></td></tr></table></figure>\n"},{"title":"剑指leetcode14 最长公共前缀","date":"2021-12-26T06:19:08.000Z","_content":"\n>最长公共前缀\n\n## 题目\n\n编写一个函数来查找字符串数组中的最长公共前缀。\n\n如果不存在公共前缀，返回空字符串 `\"\"`。\n\n### 示例 1：\n\n```\n输入：strs = [\"flower\",\"flow\",\"flight\"]\n输出：\"fl\"\n```\n\n### 示例 2：\n\n```\n输入：strs = [\"dog\",\"racecar\",\"car\"]\n输出：\"\"\n解释：输入不存在公共前缀。\n```\n\n### 提示：\n\n- `1 <= strs.length <= 200`\n- `0 <= strs[i].length <= 200`\n- `strs[i]` 仅由小写英文字母组成\n\n## 题解\n\n对每一列进行核对是否是相同，如果不是相同的直接return前面的字符串。\n\n```python\nclass Solution:\n    def longestCommonPrefix(self, strs: List[str]) -> str:\n        if len(strs) == 0:\n           return \"\"\n\n        rows, cols = len(strs), len(strs[0])\n        for i in range(cols):\n            for j in range(rows):\n                if len(strs[j]) == i or strs[j][i] != strs[0][i]:\n                    return strs[0][:i]\n\n        return strs[0]\n```\n\n","source":"_posts/leetcode/leetcode14.md","raw":"---\ntitle: 剑指leetcode14 最长公共前缀\ntags: 剑指\ncategories: 剑指\ndate: 2021-12-26 14:19:08\n---\n\n>最长公共前缀\n\n## 题目\n\n编写一个函数来查找字符串数组中的最长公共前缀。\n\n如果不存在公共前缀，返回空字符串 `\"\"`。\n\n### 示例 1：\n\n```\n输入：strs = [\"flower\",\"flow\",\"flight\"]\n输出：\"fl\"\n```\n\n### 示例 2：\n\n```\n输入：strs = [\"dog\",\"racecar\",\"car\"]\n输出：\"\"\n解释：输入不存在公共前缀。\n```\n\n### 提示：\n\n- `1 <= strs.length <= 200`\n- `0 <= strs[i].length <= 200`\n- `strs[i]` 仅由小写英文字母组成\n\n## 题解\n\n对每一列进行核对是否是相同，如果不是相同的直接return前面的字符串。\n\n```python\nclass Solution:\n    def longestCommonPrefix(self, strs: List[str]) -> str:\n        if len(strs) == 0:\n           return \"\"\n\n        rows, cols = len(strs), len(strs[0])\n        for i in range(cols):\n            for j in range(rows):\n                if len(strs[j]) == i or strs[j][i] != strs[0][i]:\n                    return strs[0][:i]\n\n        return strs[0]\n```\n\n","slug":"leetcode/leetcode14","published":1,"updated":"2022-01-18T08:10:17.096Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ba005iast9go5b6bf1","content":"<blockquote>\n<p>最长公共前缀</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>编写一个函数来查找字符串数组中的最长公共前缀。</p>\n<p>如果不存在公共前缀，返回空字符串 <code>\"\"</code>。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight armasm\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs armasm\">输入：<span class=\"hljs-keyword\">strs</span> = [<span class=\"hljs-string\">\"flower\"</span>,<span class=\"hljs-string\">\"flow\"</span>,<span class=\"hljs-string\">\"flight\"</span>]<br>输出：<span class=\"hljs-string\">\"fl\"</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight armasm\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs armasm\">输入：<span class=\"hljs-keyword\">strs</span> = [<span class=\"hljs-string\">\"dog\"</span>,<span class=\"hljs-string\">\"racecar\"</span>,<span class=\"hljs-string\">\"car\"</span>]<br>输出：<span class=\"hljs-string\">\"\"</span><br>解释：输入不存在公共前缀。<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>1 &lt;= strs.length &lt;= 200</code></li>\n<li><code>0 &lt;= strs[i].length &lt;= 200</code></li>\n<li><code>strs[i]</code> 仅由小写英文字母组成</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>对每一列进行核对是否是相同，如果不是相同的直接return前面的字符串。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">longestCommonPrefix</span>(<span class=\"hljs-params\">self, strs: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">str</span>]</span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(strs) == <span class=\"hljs-number\">0</span>:<br>           <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"\"</span><br><br>        rows, cols = <span class=\"hljs-built_in\">len</span>(strs), <span class=\"hljs-built_in\">len</span>(strs[<span class=\"hljs-number\">0</span>])<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(cols):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(rows):<br>                <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(strs[j]) == i <span class=\"hljs-keyword\">or</span> strs[j][i] != strs[<span class=\"hljs-number\">0</span>][i]:<br>                    <span class=\"hljs-keyword\">return</span> strs[<span class=\"hljs-number\">0</span>][:i]<br><br>        <span class=\"hljs-keyword\">return</span> strs[<span class=\"hljs-number\">0</span>]<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>最长公共前缀</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>编写一个函数来查找字符串数组中的最长公共前缀。</p>\n<p>如果不存在公共前缀，返回空字符串 <code>&quot;&quot;</code>。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight armasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs armasm\">输入：<span class=\"hljs-keyword\">strs</span> = [<span class=\"hljs-string\">&quot;flower&quot;</span>,<span class=\"hljs-string\">&quot;flow&quot;</span>,<span class=\"hljs-string\">&quot;flight&quot;</span>]<br>输出：<span class=\"hljs-string\">&quot;fl&quot;</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight armasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs armasm\">输入：<span class=\"hljs-keyword\">strs</span> = [<span class=\"hljs-string\">&quot;dog&quot;</span>,<span class=\"hljs-string\">&quot;racecar&quot;</span>,<span class=\"hljs-string\">&quot;car&quot;</span>]<br>输出：<span class=\"hljs-string\">&quot;&quot;</span><br>解释：输入不存在公共前缀。<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>1 &lt;= strs.length &lt;= 200</code></li>\n<li><code>0 &lt;= strs[i].length &lt;= 200</code></li>\n<li><code>strs[i]</code> 仅由小写英文字母组成</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>对每一列进行核对是否是相同，如果不是相同的直接return前面的字符串。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">longestCommonPrefix</span>(<span class=\"hljs-params\">self, strs: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">str</span>]</span>) -&gt; <span class=\"hljs-built_in\">str</span>:</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(strs) == <span class=\"hljs-number\">0</span>:<br>           <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;&quot;</span><br><br>        rows, cols = <span class=\"hljs-built_in\">len</span>(strs), <span class=\"hljs-built_in\">len</span>(strs[<span class=\"hljs-number\">0</span>])<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(cols):<br>            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(rows):<br>                <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(strs[j]) == i <span class=\"hljs-keyword\">or</span> strs[j][i] != strs[<span class=\"hljs-number\">0</span>][i]:<br>                    <span class=\"hljs-keyword\">return</span> strs[<span class=\"hljs-number\">0</span>][:i]<br><br>        <span class=\"hljs-keyword\">return</span> strs[<span class=\"hljs-number\">0</span>]<br></code></pre></td></tr></table></figure>\n"},{"title":"leetcode17 电话号码的字母组合","date":"2022-01-05T03:14:25.000Z","_content":"\n>电话号码的字母组合\n\n## 题目\n\n给定一个仅包含数字 2-9 的字符串，返回所有它能表示的字母组合。答案可以按 任意顺序 返回。\n\n给出数字到字母的映射如下（与电话按键相同）。注意 1 不对应任何字母\n\n![](https://picture.mulindya.com/leetcode17-1.png)\n\n### 示例 1：\n\n```\n输入：digits = \"23\"\n输出：[\"ad\",\"ae\",\"af\",\"bd\",\"be\",\"bf\",\"cd\",\"ce\",\"cf\"]\n```\n\n### 示例 2：\n\n```\n输入：digits = \"\"\n输出：[]\n```\n\n### 示例3\n\n```\n输入：digits = \"2\"\n输出：[\"a\",\"b\",\"c\"]\n```\n\n### 提示：\n\n- `0 <= digits.length <= 4`\n- `digits[i]` 是范围 `['2', '9']` 的一个数字。\n\n## 题解\n\n使用树的深度优先遍历算法，digit的字符串相当于给出每一层的节点值（数字对应的字符），按照深度优先算法，遍历到最后一个节点即可添加到result中。\n\n去掉最后一个字符是`word[:-1]`，这里 word[-1]表示最后一个字符。\n\n```python\nclass Solution:\n    def letterCombinations(self, digits: str) -> List[str]:\n        record = {'2':'abc','3':'def','4':'ghi','5':'jkl','6':'mno','7':'pqrs','8':'tuv','9':'wxyz'}\n        if(not digits): return []\n        def dfs(rindex):\n            if rindex==len(digits): \n                self.result.append(self.word)\n            if rindex>=len(digits): return\n            for x in record[digits[rindex]]:\n                self.word += x\n                dfs(rindex+1)\n                self.word = self.word[:-1] #切片去掉最后一个字符\n\n        rindex = 0\n        self.result,self.word = [],\"\"\n        dfs(rindex)\n        return self.result\n```\n\n","source":"_posts/leetcode/leetcode17.md","raw":"---\ntitle: leetcode17 电话号码的字母组合\ntags: [剑指,树]\ncategories: [剑指,树]\ndate: 2022-01-05 11:14:25\n---\n\n>电话号码的字母组合\n\n## 题目\n\n给定一个仅包含数字 2-9 的字符串，返回所有它能表示的字母组合。答案可以按 任意顺序 返回。\n\n给出数字到字母的映射如下（与电话按键相同）。注意 1 不对应任何字母\n\n![](https://picture.mulindya.com/leetcode17-1.png)\n\n### 示例 1：\n\n```\n输入：digits = \"23\"\n输出：[\"ad\",\"ae\",\"af\",\"bd\",\"be\",\"bf\",\"cd\",\"ce\",\"cf\"]\n```\n\n### 示例 2：\n\n```\n输入：digits = \"\"\n输出：[]\n```\n\n### 示例3\n\n```\n输入：digits = \"2\"\n输出：[\"a\",\"b\",\"c\"]\n```\n\n### 提示：\n\n- `0 <= digits.length <= 4`\n- `digits[i]` 是范围 `['2', '9']` 的一个数字。\n\n## 题解\n\n使用树的深度优先遍历算法，digit的字符串相当于给出每一层的节点值（数字对应的字符），按照深度优先算法，遍历到最后一个节点即可添加到result中。\n\n去掉最后一个字符是`word[:-1]`，这里 word[-1]表示最后一个字符。\n\n```python\nclass Solution:\n    def letterCombinations(self, digits: str) -> List[str]:\n        record = {'2':'abc','3':'def','4':'ghi','5':'jkl','6':'mno','7':'pqrs','8':'tuv','9':'wxyz'}\n        if(not digits): return []\n        def dfs(rindex):\n            if rindex==len(digits): \n                self.result.append(self.word)\n            if rindex>=len(digits): return\n            for x in record[digits[rindex]]:\n                self.word += x\n                dfs(rindex+1)\n                self.word = self.word[:-1] #切片去掉最后一个字符\n\n        rindex = 0\n        self.result,self.word = [],\"\"\n        dfs(rindex)\n        return self.result\n```\n\n","slug":"leetcode/leetcode17","published":1,"updated":"2022-01-18T08:10:17.098Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bb005last9hrf63s7t","content":"<blockquote>\n<p>电话号码的字母组合</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给定一个仅包含数字 2-9 的字符串，返回所有它能表示的字母组合。答案可以按 任意顺序 返回。</p>\n<p>给出数字到字母的映射如下（与电话按键相同）。注意 1 不对应任何字母</p>\n<p><img src=\"https://picture.mulindya.com/leetcode17-1.png\" alt=\"\"></p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight ada\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ada\">输入：<span class=\"hljs-keyword\">digits</span> = <span class=\"hljs-string\">\"23\"</span><br>输出：[<span class=\"hljs-string\">\"ad\"</span>,<span class=\"hljs-string\">\"ae\"</span>,<span class=\"hljs-string\">\"af\"</span>,<span class=\"hljs-string\">\"bd\"</span>,<span class=\"hljs-string\">\"be\"</span>,<span class=\"hljs-string\">\"bf\"</span>,<span class=\"hljs-string\">\"cd\"</span>,<span class=\"hljs-string\">\"ce\"</span>,<span class=\"hljs-string\">\"cf\"</span>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight ada\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ada\">输入：<span class=\"hljs-keyword\">digits</span> = <span class=\"hljs-string\">\"\"</span><br>输出：[]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例3\">示例3</h3>\n<figure class=\"highlight ada\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ada\">输入：<span class=\"hljs-keyword\">digits</span> = <span class=\"hljs-string\">\"2\"</span><br>输出：[<span class=\"hljs-string\">\"a\"</span>,<span class=\"hljs-string\">\"b\"</span>,<span class=\"hljs-string\">\"c\"</span>]<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>0 &lt;= digits.length &lt;= 4</code></li>\n<li><code>digits[i]</code> 是范围 <code>['2', '9']</code> 的一个数字。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用树的深度优先遍历算法，digit的字符串相当于给出每一层的节点值（数字对应的字符），按照深度优先算法，遍历到最后一个节点即可添加到result中。</p>\n<p>去掉最后一个字符是<code>word[:-1]</code>，这里 word[-1]表示最后一个字符。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">letterCombinations</span>(<span class=\"hljs-params\">self, digits: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">str</span>]:</span><br>        record = {<span class=\"hljs-string\">'2'</span>:<span class=\"hljs-string\">'abc'</span>,<span class=\"hljs-string\">'3'</span>:<span class=\"hljs-string\">'def'</span>,<span class=\"hljs-string\">'4'</span>:<span class=\"hljs-string\">'ghi'</span>,<span class=\"hljs-string\">'5'</span>:<span class=\"hljs-string\">'jkl'</span>,<span class=\"hljs-string\">'6'</span>:<span class=\"hljs-string\">'mno'</span>,<span class=\"hljs-string\">'7'</span>:<span class=\"hljs-string\">'pqrs'</span>,<span class=\"hljs-string\">'8'</span>:<span class=\"hljs-string\">'tuv'</span>,<span class=\"hljs-string\">'9'</span>:<span class=\"hljs-string\">'wxyz'</span>}<br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> digits): <span class=\"hljs-keyword\">return</span> []<br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">rindex</span>):</span><br>            <span class=\"hljs-keyword\">if</span> rindex==<span class=\"hljs-built_in\">len</span>(digits): <br>                self.result.append(self.word)<br>            <span class=\"hljs-keyword\">if</span> rindex&gt;=<span class=\"hljs-built_in\">len</span>(digits): <span class=\"hljs-keyword\">return</span><br>            <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> record[digits[rindex]]:<br>                self.word += x<br>                dfs(rindex+<span class=\"hljs-number\">1</span>)<br>                self.word = self.word[:-<span class=\"hljs-number\">1</span>] <span class=\"hljs-comment\">#切片去掉最后一个字符</span><br><br>        rindex = <span class=\"hljs-number\">0</span><br>        self.result,self.word = [],<span class=\"hljs-string\">\"\"</span><br>        dfs(rindex)<br>        <span class=\"hljs-keyword\">return</span> self.result<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>电话号码的字母组合</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给定一个仅包含数字 2-9 的字符串，返回所有它能表示的字母组合。答案可以按 任意顺序 返回。</p>\n<p>给出数字到字母的映射如下（与电话按键相同）。注意 1 不对应任何字母</p>\n<p><img src=\"https://picture.mulindya.com/leetcode17-1.png\" alt=\"\"></p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ada\">输入：<span class=\"hljs-keyword\">digits</span> = <span class=\"hljs-string\">&quot;23&quot;</span><br>输出：[<span class=\"hljs-string\">&quot;ad&quot;</span>,<span class=\"hljs-string\">&quot;ae&quot;</span>,<span class=\"hljs-string\">&quot;af&quot;</span>,<span class=\"hljs-string\">&quot;bd&quot;</span>,<span class=\"hljs-string\">&quot;be&quot;</span>,<span class=\"hljs-string\">&quot;bf&quot;</span>,<span class=\"hljs-string\">&quot;cd&quot;</span>,<span class=\"hljs-string\">&quot;ce&quot;</span>,<span class=\"hljs-string\">&quot;cf&quot;</span>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ada\">输入：<span class=\"hljs-keyword\">digits</span> = <span class=\"hljs-string\">&quot;&quot;</span><br>输出：[]<br></code></pre></td></tr></table></figure>\n<h3 id=\"示例3\">示例3</h3>\n<figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ada\">输入：<span class=\"hljs-keyword\">digits</span> = <span class=\"hljs-string\">&quot;2&quot;</span><br>输出：[<span class=\"hljs-string\">&quot;a&quot;</span>,<span class=\"hljs-string\">&quot;b&quot;</span>,<span class=\"hljs-string\">&quot;c&quot;</span>]<br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li><code>0 &lt;= digits.length &lt;= 4</code></li>\n<li><code>digits[i]</code> 是范围 <code>['2', '9']</code> 的一个数字。</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用树的深度优先遍历算法，digit的字符串相当于给出每一层的节点值（数字对应的字符），按照深度优先算法，遍历到最后一个节点即可添加到result中。</p>\n<p>去掉最后一个字符是<code>word[:-1]</code>，这里 word[-1]表示最后一个字符。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">letterCombinations</span>(<span class=\"hljs-params\">self, digits: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">str</span>]:</span><br>        record = &#123;<span class=\"hljs-string\">&#x27;2&#x27;</span>:<span class=\"hljs-string\">&#x27;abc&#x27;</span>,<span class=\"hljs-string\">&#x27;3&#x27;</span>:<span class=\"hljs-string\">&#x27;def&#x27;</span>,<span class=\"hljs-string\">&#x27;4&#x27;</span>:<span class=\"hljs-string\">&#x27;ghi&#x27;</span>,<span class=\"hljs-string\">&#x27;5&#x27;</span>:<span class=\"hljs-string\">&#x27;jkl&#x27;</span>,<span class=\"hljs-string\">&#x27;6&#x27;</span>:<span class=\"hljs-string\">&#x27;mno&#x27;</span>,<span class=\"hljs-string\">&#x27;7&#x27;</span>:<span class=\"hljs-string\">&#x27;pqrs&#x27;</span>,<span class=\"hljs-string\">&#x27;8&#x27;</span>:<span class=\"hljs-string\">&#x27;tuv&#x27;</span>,<span class=\"hljs-string\">&#x27;9&#x27;</span>:<span class=\"hljs-string\">&#x27;wxyz&#x27;</span>&#125;<br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> digits): <span class=\"hljs-keyword\">return</span> []<br>        <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span>(<span class=\"hljs-params\">rindex</span>):</span><br>            <span class=\"hljs-keyword\">if</span> rindex==<span class=\"hljs-built_in\">len</span>(digits): <br>                self.result.append(self.word)<br>            <span class=\"hljs-keyword\">if</span> rindex&gt;=<span class=\"hljs-built_in\">len</span>(digits): <span class=\"hljs-keyword\">return</span><br>            <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> record[digits[rindex]]:<br>                self.word += x<br>                dfs(rindex+<span class=\"hljs-number\">1</span>)<br>                self.word = self.word[:-<span class=\"hljs-number\">1</span>] <span class=\"hljs-comment\">#切片去掉最后一个字符</span><br><br>        rindex = <span class=\"hljs-number\">0</span><br>        self.result,self.word = [],<span class=\"hljs-string\">&quot;&quot;</span><br>        dfs(rindex)<br>        <span class=\"hljs-keyword\">return</span> self.result<br></code></pre></td></tr></table></figure>\n"},{"title":"剑指offer20 有效的括号","date":"2021-11-24T08:10:30.000Z","_content":"\n> 有效的括号\n\n## 题目\n\n给定一个只包括 '('，')'，'{'，'}'，'['，']' 的字符串 s ，判断字符串是否有效。\n\n有效字符串需满足：\n\n左括号必须用相同类型的右括号闭合。\n左括号必须以正确的顺序闭合。\n\n### 示例 1：\n\n```\n输入：s = \"()\"\n输出：true\n```\n\n### 示例 2：\n\n```\n输入：s = \"()[]{}\"\n输出：true\n```\n\n### 示例 3：\n\n```\n输入：s = \"(]\"\n输出：false\n```\n\n### 示例 4：\n\n```\n输入：s = \"([)]\"\n输出：false\n```\n\n### 示例 5：\n\n```\n输入：s = \"{[]}\"\n输出：true\n```\n\n### 提示：\n\n- 1 <= s.length <= 104\n- s 仅由括号 '()[]{}' 组成\n\n## 题解\n\n使用`栈和字典`辅助判断，如果字符是对应括号的右括号，就弹出，否则压入，最后查看栈中是否还剩元素。\n\n```python\nclass Solution:\n    def isValid(self, s: str) -> bool:\n        stack = []\n        mmap = {'(':')',')':'a','{':'}','}':'b','[':']',']':'c'}\n        for ch in s:\n            if(stack):\n                top = stack[len(stack)-1]\n            if(not stack or mmap[top] != ch):\n                stack.append(ch)\n            elif(stack and  mmap[top] == ch):\n                stack.pop()\n        return not stack\n```\n\n","source":"_posts/leetcode/leetcode20.md","raw":"---\ntitle: 剑指offer20 有效的括号\ntags: [剑指,栈]\ncategories: [剑指,栈]\ndate: 2021-11-24 16:10:30\n---\n\n> 有效的括号\n\n## 题目\n\n给定一个只包括 '('，')'，'{'，'}'，'['，']' 的字符串 s ，判断字符串是否有效。\n\n有效字符串需满足：\n\n左括号必须用相同类型的右括号闭合。\n左括号必须以正确的顺序闭合。\n\n### 示例 1：\n\n```\n输入：s = \"()\"\n输出：true\n```\n\n### 示例 2：\n\n```\n输入：s = \"()[]{}\"\n输出：true\n```\n\n### 示例 3：\n\n```\n输入：s = \"(]\"\n输出：false\n```\n\n### 示例 4：\n\n```\n输入：s = \"([)]\"\n输出：false\n```\n\n### 示例 5：\n\n```\n输入：s = \"{[]}\"\n输出：true\n```\n\n### 提示：\n\n- 1 <= s.length <= 104\n- s 仅由括号 '()[]{}' 组成\n\n## 题解\n\n使用`栈和字典`辅助判断，如果字符是对应括号的右括号，就弹出，否则压入，最后查看栈中是否还剩元素。\n\n```python\nclass Solution:\n    def isValid(self, s: str) -> bool:\n        stack = []\n        mmap = {'(':')',')':'a','{':'}','}':'b','[':']',']':'c'}\n        for ch in s:\n            if(stack):\n                top = stack[len(stack)-1]\n            if(not stack or mmap[top] != ch):\n                stack.append(ch)\n            elif(stack and  mmap[top] == ch):\n                stack.pop()\n        return not stack\n```\n\n","slug":"leetcode/leetcode20","published":1,"updated":"2022-01-18T08:10:17.098Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bd005oast9bawsgs6e","content":"<blockquote>\n<p>有效的括号</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给定一个只包括 ‘(’，‘)’，‘{’，‘}’，‘[’，‘]’&nbsp;的字符串 s ，判断字符串是否有效。</p>\n<p>有效字符串需满足：</p>\n<p>左括号必须用相同类型的右括号闭合。<br>\n左括号必须以正确的顺序闭合。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">\"()\"</span><br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">\"()[]{}\"</span><br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">\"(]\"</span><br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">\"([)]\"</span><br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"示例-5：\">示例 5：</h3>\n<figure class=\"highlight nix\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">\"{[]}\"</span><br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= s.length &lt;= 104</li>\n<li>s 仅由括号 ‘()[]{}’ 组成</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用<code>栈和字典</code>辅助判断，如果字符是对应括号的右括号，就弹出，否则压入，最后查看栈中是否还剩元素。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isValid</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        stack = []<br>        mmap = {<span class=\"hljs-string\">'('</span>:<span class=\"hljs-string\">')'</span>,<span class=\"hljs-string\">')'</span>:<span class=\"hljs-string\">'a'</span>,<span class=\"hljs-string\">'{'</span>:<span class=\"hljs-string\">'}'</span>,<span class=\"hljs-string\">'}'</span>:<span class=\"hljs-string\">'b'</span>,<span class=\"hljs-string\">'['</span>:<span class=\"hljs-string\">']'</span>,<span class=\"hljs-string\">']'</span>:<span class=\"hljs-string\">'c'</span>}<br>        <span class=\"hljs-keyword\">for</span> ch <span class=\"hljs-keyword\">in</span> s:<br>            <span class=\"hljs-keyword\">if</span>(stack):<br>                top = stack[<span class=\"hljs-built_in\">len</span>(stack)-<span class=\"hljs-number\">1</span>]<br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> stack <span class=\"hljs-keyword\">or</span> mmap[top] != ch):<br>                stack.append(ch)<br>            <span class=\"hljs-keyword\">elif</span>(stack <span class=\"hljs-keyword\">and</span>  mmap[top] == ch):<br>                stack.pop()<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">not</span> stack<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>有效的括号</p>\n</blockquote>\n<h2 id=\"题目\">题目</h2>\n<p>给定一个只包括 ‘(’，‘)’，‘{’，‘}’，‘[’，‘]’ 的字符串 s ，判断字符串是否有效。</p>\n<p>有效字符串需满足：</p>\n<p>左括号必须用相同类型的右括号闭合。<br>\n左括号必须以正确的顺序闭合。</p>\n<h3 id=\"示例-1：\">示例 1：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">&quot;()&quot;</span><br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-2：\">示例 2：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">&quot;()[]&#123;&#125;&quot;</span><br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-3：\">示例 3：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">&quot;(]&quot;</span><br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-4：\">示例 4：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">&quot;([)]&quot;</span><br>输出：<span class=\"hljs-literal\">false</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"示例-5：\">示例 5：</h3>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nix\">输入：<span class=\"hljs-attr\">s</span> = <span class=\"hljs-string\">&quot;&#123;[]&#125;&quot;</span><br>输出：<span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"提示：\">提示：</h3>\n<ul>\n<li>1 &lt;= s.length &lt;= 104</li>\n<li>s 仅由括号 ‘()[]{}’ 组成</li>\n</ul>\n<h2 id=\"题解\">题解</h2>\n<p>使用<code>栈和字典</code>辅助判断，如果字符是对应括号的右括号，就弹出，否则压入，最后查看栈中是否还剩元素。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isValid</span>(<span class=\"hljs-params\">self, s: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">bool</span>:</span><br>        stack = []<br>        mmap = &#123;<span class=\"hljs-string\">&#x27;(&#x27;</span>:<span class=\"hljs-string\">&#x27;)&#x27;</span>,<span class=\"hljs-string\">&#x27;)&#x27;</span>:<span class=\"hljs-string\">&#x27;a&#x27;</span>,<span class=\"hljs-string\">&#x27;&#123;&#x27;</span>:<span class=\"hljs-string\">&#x27;&#125;&#x27;</span>,<span class=\"hljs-string\">&#x27;&#125;&#x27;</span>:<span class=\"hljs-string\">&#x27;b&#x27;</span>,<span class=\"hljs-string\">&#x27;[&#x27;</span>:<span class=\"hljs-string\">&#x27;]&#x27;</span>,<span class=\"hljs-string\">&#x27;]&#x27;</span>:<span class=\"hljs-string\">&#x27;c&#x27;</span>&#125;<br>        <span class=\"hljs-keyword\">for</span> ch <span class=\"hljs-keyword\">in</span> s:<br>            <span class=\"hljs-keyword\">if</span>(stack):<br>                top = stack[<span class=\"hljs-built_in\">len</span>(stack)-<span class=\"hljs-number\">1</span>]<br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> stack <span class=\"hljs-keyword\">or</span> mmap[top] != ch):<br>                stack.append(ch)<br>            <span class=\"hljs-keyword\">elif</span>(stack <span class=\"hljs-keyword\">and</span>  mmap[top] == ch):<br>                stack.pop()<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">not</span> stack<br></code></pre></td></tr></table></figure>\n"},{"title":"Eckark_young定理","date":"2021-08-09T02:57:16.000Z","math":true,"_content":"\n最佳低秩逼近和奇异值的关系(*Eckart*-*Young定理*)\n### 定理\nSuppose a matrix $A\\in \\mathbb{R}^{m\\times n}$has an SVD-decomposition$A=U\\Sigma V^T$. Let $k < r= \\mathsf{rank}(A)$and truncated matrix\n$$\nA_k = \\sum_{i=1}^k \\sigma_i \\mathbf u_i \\mathbf v_i^T,\n$$\nthen, for any matrix B of rank k , the minimal error is achieved with $A_k$:\n\n{% raw %}\n$$\n\\min_{\\mathsf{rank}(B)=k}||A-B||_2 = || A - A_k||_2 = \\sigma_{k+1}.\n$$\n{% endraw %}\n\nThe same holds for Frobenius norm as well\n\n{% raw %}\n$$\n\\min_{\\mathsf{rank}(B)=k}||A-B||_F = || A - A_k||_F = \\sqrt{\\sigma_{k+1}^2 + \\cdots + \\sigma_p^2}.\n$$\n\n{% endraw %}\n\n### 证明 (2-norm case)\n\nSince $U^\\ A_k V = \\mathrm{diag}(\\sigma_1,\\ldots, \\sigma_k,0,\\ldots,0)$ it means that $A_k$ is rank K. Moreover, $U^T (A-A_k) V =  \\mathrm{diag}(0,\\ldots, 0,\\sigma_{k+1},\\ldots, \\sigma_p)$with the largest singular value is $\\sigma_{k+1}$ and thus {% raw %}$||A-A_k||_2 = \\sigma_{k+1}$.{% endraw %}\n\n### 证明 (Frobenius norm case)\n\n> Lemma: If $A,B \\in \\mathbb{R}^{m\\times n}$ , with B having rank K , then $\\sigma_{k+i}(A) \\le \\sigma_i(A-B) \\text{ for all }\\; i.$\n\nTo prove the lemma, first consider the case i=1, we have proved that $\\sigma_{k+1}(A) \\le \\sigma_1(A-B) = ||A-B||_2$in the 2-norm case. Then we do the general case:\n\n{% raw %}\n$$\n\\begin{aligned} \t\\sigma_i(A-B) = & \\sigma_i(A-B) + \\sigma_1(B-B_k)\\qquad\\text{since } B=B_k\\\\ \t=& \\sigma_1(A-B - (A-B)_{i-1}) + \\sigma_1(B-B_k)\\qquad\\\\ \t\\ge & \\sigma_1(A-B - (A-B)_{i-1}+B-B_k)   \\\\ \t=& \\sigma_1(A  - (A-B)_{i-1} -B_k)\\\\ \t\\ge & \\sigma_1(A - A_{k+i-1})\\\\ \t=& \\sigma_{k+i}(A)   \\end{aligned} \n$$\n{% endraw %}\n\n\n\n> https://zhuanlan.zhihu.com/p/361938622\n>\n> https://zhuanlan.zhihu.com/p/75283604\n","source":"_posts/math/Eckark-young.md","raw":"---\ntitle: Eckark_young定理\ndate: 2021-08-09 10:57:16\ntags: [math,线性代数]\ncategories: [math,线性代数]\nmath: true\n---\n\n最佳低秩逼近和奇异值的关系(*Eckart*-*Young定理*)\n### 定理\nSuppose a matrix $A\\in \\mathbb{R}^{m\\times n}$has an SVD-decomposition$A=U\\Sigma V^T$. Let $k < r= \\mathsf{rank}(A)$and truncated matrix\n$$\nA_k = \\sum_{i=1}^k \\sigma_i \\mathbf u_i \\mathbf v_i^T,\n$$\nthen, for any matrix B of rank k , the minimal error is achieved with $A_k$:\n\n{% raw %}\n$$\n\\min_{\\mathsf{rank}(B)=k}||A-B||_2 = || A - A_k||_2 = \\sigma_{k+1}.\n$$\n{% endraw %}\n\nThe same holds for Frobenius norm as well\n\n{% raw %}\n$$\n\\min_{\\mathsf{rank}(B)=k}||A-B||_F = || A - A_k||_F = \\sqrt{\\sigma_{k+1}^2 + \\cdots + \\sigma_p^2}.\n$$\n\n{% endraw %}\n\n### 证明 (2-norm case)\n\nSince $U^\\ A_k V = \\mathrm{diag}(\\sigma_1,\\ldots, \\sigma_k,0,\\ldots,0)$ it means that $A_k$ is rank K. Moreover, $U^T (A-A_k) V =  \\mathrm{diag}(0,\\ldots, 0,\\sigma_{k+1},\\ldots, \\sigma_p)$with the largest singular value is $\\sigma_{k+1}$ and thus {% raw %}$||A-A_k||_2 = \\sigma_{k+1}$.{% endraw %}\n\n### 证明 (Frobenius norm case)\n\n> Lemma: If $A,B \\in \\mathbb{R}^{m\\times n}$ , with B having rank K , then $\\sigma_{k+i}(A) \\le \\sigma_i(A-B) \\text{ for all }\\; i.$\n\nTo prove the lemma, first consider the case i=1, we have proved that $\\sigma_{k+1}(A) \\le \\sigma_1(A-B) = ||A-B||_2$in the 2-norm case. Then we do the general case:\n\n{% raw %}\n$$\n\\begin{aligned} \t\\sigma_i(A-B) = & \\sigma_i(A-B) + \\sigma_1(B-B_k)\\qquad\\text{since } B=B_k\\\\ \t=& \\sigma_1(A-B - (A-B)_{i-1}) + \\sigma_1(B-B_k)\\qquad\\\\ \t\\ge & \\sigma_1(A-B - (A-B)_{i-1}+B-B_k)   \\\\ \t=& \\sigma_1(A  - (A-B)_{i-1} -B_k)\\\\ \t\\ge & \\sigma_1(A - A_{k+i-1})\\\\ \t=& \\sigma_{k+i}(A)   \\end{aligned} \n$$\n{% endraw %}\n\n\n\n> https://zhuanlan.zhihu.com/p/361938622\n>\n> https://zhuanlan.zhihu.com/p/75283604\n","slug":"math/Eckark-young","published":1,"updated":"2022-01-18T08:10:17.099Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0be005rast91fbm7je6","content":"<p>最佳低秩逼近和奇异值的关系(<em>Eckart</em>-<em>Young定理</em>)</p>\n<h3 id=\"定理\">定理</h3>\n<p>Suppose a matrix $A\\in \\mathbb{R}^{m\\times n}$has an SVD-decomposition$A=U\\Sigma V^T$. Let $k &lt; r= \\mathsf{rank}(A)$and truncated matrix<br>\n$$<br>\nA_k = \\sum_{i=1}^k \\sigma_i \\mathbf u_i \\mathbf v_i^T,<br>\n$$<br>\nthen, for any matrix B of rank k , the minimal error is achieved with $A_k$:</p>\n\n$$\n\\min_{\\mathsf{rank}(B)=k}||A-B||_2 = || A - A_k||_2 = \\sigma_{k+1}.\n$$\n\n<p>The same holds for Frobenius norm as well</p>\n\n$$\n\\min_{\\mathsf{rank}(B)=k}||A-B||_F = || A - A_k||_F = \\sqrt{\\sigma_{k+1}^2 + \\cdots + \\sigma_p^2}.\n$$\n\n\n<h3 id=\"证明-2-norm-case\">证明 (2-norm case)</h3>\n<p>Since $U^\\ A_k V = \\mathrm{diag}(\\sigma_1,\\ldots, \\sigma_k,0,\\ldots,0)$ it means that $A_k$ is rank K. Moreover, $U^T (A-A_k) V =  \\mathrm{diag}(0,\\ldots, 0,\\sigma_{k+1},\\ldots, \\sigma_p)$with the largest singular value is $\\sigma_{k+1}$ and thus $||A-A_k||_2 = \\sigma_{k+1}$.</p>\n<h3 id=\"证明-Frobenius-norm-case\">证明 (Frobenius norm case)</h3>\n<blockquote>\n<p>Lemma: If $A,B \\in \\mathbb{R}^{m\\times n}$ , with B having rank K , then $\\sigma_{k+i}(A) \\le \\sigma_i(A-B) \\text{ for all }; i.$</p>\n</blockquote>\n<p>To prove the lemma, first consider the case i=1, we have proved that $\\sigma_{k+1}(A) \\le \\sigma_1(A-B) = ||A-B||_2$in the 2-norm case. Then we do the general case:</p>\n\n$$\n\\begin{aligned} \t\\sigma_i(A-B) = &amp; \\sigma_i(A-B) + \\sigma_1(B-B_k)\\qquad\\text{since } B=B_k\\\\ \t=&amp; \\sigma_1(A-B - (A-B)_{i-1}) + \\sigma_1(B-B_k)\\qquad\\\\ \t\\ge &amp; \\sigma_1(A-B - (A-B)_{i-1}+B-B_k)   \\\\ \t=&amp; \\sigma_1(A  - (A-B)_{i-1} -B_k)\\\\ \t\\ge &amp; \\sigma_1(A - A_{k+i-1})\\\\ \t=&amp; \\sigma_{k+i}(A)   \\end{aligned} \n$$\n\n<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/361938622\">https://zhuanlan.zhihu.com/p/361938622</a></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/75283604\">https://zhuanlan.zhihu.com/p/75283604</a></p>\n</blockquote>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<p>最佳低秩逼近和奇异值的关系(<em>Eckart</em>-<em>Young定理</em>)</p>\n<h3 id=\"定理\">定理</h3>\n<p>Suppose a matrix $A\\in \\mathbb{R}^{m\\times n}$has an SVD-decomposition$A=U\\Sigma V^T$. Let $k &lt; r= \\mathsf{rank}(A)$and truncated matrix<br>\n$$<br>\nA_k = \\sum_{i=1}^k \\sigma_i \\mathbf u_i \\mathbf v_i^T,<br>\n$$<br>\nthen, for any matrix B of rank k , the minimal error is achieved with $A_k$:</p>\n\n$$\n\\min_{\\mathsf{rank}(B)=k}||A-B||_2 = || A - A_k||_2 = \\sigma_{k+1}.\n$$\n\n<p>The same holds for Frobenius norm as well</p>\n\n$$\n\\min_{\\mathsf{rank}(B)=k}||A-B||_F = || A - A_k||_F = \\sqrt{\\sigma_{k+1}^2 + \\cdots + \\sigma_p^2}.\n$$\n\n\n<h3 id=\"证明-2-norm-case\">证明 (2-norm case)</h3>\n<p>Since $U^\\ A_k V = \\mathrm{diag}(\\sigma_1,\\ldots, \\sigma_k,0,\\ldots,0)$ it means that $A_k$ is rank K. Moreover, $U^T (A-A_k) V =  \\mathrm{diag}(0,\\ldots, 0,\\sigma_{k+1},\\ldots, \\sigma_p)$with the largest singular value is $\\sigma_{k+1}$ and thus $||A-A_k||_2 = \\sigma_{k+1}$.</p>\n<h3 id=\"证明-Frobenius-norm-case\">证明 (Frobenius norm case)</h3>\n<blockquote>\n<p>Lemma: If $A,B \\in \\mathbb{R}^{m\\times n}$ , with B having rank K , then $\\sigma_{k+i}(A) \\le \\sigma_i(A-B) \\text{ for all }; i.$</p>\n</blockquote>\n<p>To prove the lemma, first consider the case i=1, we have proved that $\\sigma_{k+1}(A) \\le \\sigma_1(A-B) = ||A-B||_2$in the 2-norm case. Then we do the general case:</p>\n\n$$\n\\begin{aligned} \t\\sigma_i(A-B) = & \\sigma_i(A-B) + \\sigma_1(B-B_k)\\qquad\\text{since } B=B_k\\\\ \t=& \\sigma_1(A-B - (A-B)_{i-1}) + \\sigma_1(B-B_k)\\qquad\\\\ \t\\ge & \\sigma_1(A-B - (A-B)_{i-1}+B-B_k)   \\\\ \t=& \\sigma_1(A  - (A-B)_{i-1} -B_k)\\\\ \t\\ge & \\sigma_1(A - A_{k+i-1})\\\\ \t=& \\sigma_{k+i}(A)   \\end{aligned} \n$$\n\n<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/361938622\">https://zhuanlan.zhihu.com/p/361938622</a></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/75283604\">https://zhuanlan.zhihu.com/p/75283604</a></p>\n</blockquote>\n"},{"title":"直观理解协方差矩阵","date":"2021-08-05T03:26:21.000Z","math":true,"_content":"\n> 原文出自 https://zhuanlan.zhihu.com/p/349802953\n\n## 1 概率论中的定义\n\n### 随机变量：\n\n随机变量(Random Variable) X 是一个映射，把随机试验的结果与实数建立起了一一对应的关系。而期望与方差是随机变量的两个重要的数字特征。\n\n### 数学期望：\n\n在概率论和统计学中，数学期望(mean)(或均值，亦简称期望(Expectation, or expected value))是试验中每次可能结果的概率乘以其结果的总和，是最基本的数学特征之一。它反映随机变量平均取值的大小。 期望值是该变量输出值的平均数。期望值并不一定包含于变量的输出值集合里。\n\n大数定律规定，随着重复次数接近无穷大，数值的算术平均值几乎肯定地收敛于期望值。\n\n### 方差：\n\n方差(Variance)是在概率论和统计方差衡量随机变量或一组数据时离散程度的度量。概率论中方差用来度量随机变量和其数学期望(即均值)之间的偏离程度。统计中的方差(样本方差)是每个样本值与全体样本值的平均数之差的平方值的平均数。\n\n设$X$为随机变量， 如果$\\mathrm{E}[X]$，则随机变量$X$的方差为：\n$$\n\\mu=\\mathrm{E}[X]\n$$\n\n方差也记为 $\\sigma_{X}^{2}$。\n\n样本方差计算公式：\n\n{% raw %}\n$$\nS^{2}=\\Sigma\\left(X-\\overline{X}\\right)^{2}/\\left(n-1\\right)\n$$\n{% endraw %}\n\n其中，$S^{2}$为样本方差，$X$ 为变量，$\\overline{X}$为样本均值，$n$ 为样本例数。如果要了解为什么要除以$n-1$，请看[这篇文章](https://link.zhihu.com/?target=https%3A//www.visiondummy.com/2014/03/divide-variance-n-1/)。\n\n### 标准差：\n\n标准差(Standard Deviation)是离均差平方的算术平均数(即：方差)的算术平方根，用$\\sigma$表示。标准差也被称为标准偏差，或者实验标准差，在概率统计中最常使用作为统计分布程度上的测量依据。 见下图：\n\n![](https://picture.mulindya.com/covariance-matrix-pic1.jpg)\n\n标准差是方差的算术平方根。标准差能反映一个数据集的离散程度。平均数相同的两组数据，标准差未必相同。\n\n### 协方差：\n\n**协方差(Covariance)在概率论和统计学中用于衡量两个变量的总体误差。而方差是协方差的一种特殊情况，即当两个变量是相同的情况。**\n\n期望值分别为$ E[X]$与$[Y]$的两个实随机变量$X$与$Y$之间的协方差 $\\mathrm{Cov}(X,Y)$ 定义为：\n\n{% raw %}\n$$\n\\begin{aligned}\n\\mathrm{Cov}(X,Y)&=\\mathrm{E}\\left[\\left(X\\mathrm{E}\\left[X\\right]\\right)\\left(Y-\\mathrm{E}\\left[Y\\right]\\right)\\right]  \n\\\\&=\\mathrm{E}\\left[XY\\right]-2\\mathrm{E}\\left[Y\\right]\\mathrm{E}\\left[X\\right]+\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right]\n\\\\&=\\mathrm{E}\\left[XY\\right]-\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right] \n\\\\&=\\mathrm{E}\\left[XY\\right]-\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right]\n\\end{aligned}\n$$\n{% endraw %}\n\n协方差表示的是两个变量总体误差的期望。 如果两个变量的变化趋势一致，也就是说如果其中一个大于自身的期望值，另外一个也大于自身的期望值，那么两个变量之间的协方差就是正值。 如果两个变量的变化趋势相反，即其中一个大于自身的期望值，另外一个却小于自身的期望值，那么两个变量之间的协方差就是负值。\n\n如果$X$与$Y$是统计独立的，那么二者之间的协方差就是0，因为两个独立的随机变量满足$\\mathrm{E}[XY]=\\mathrm{E}[X]\\mathrm{E}[Y]$。但是，反过来并不成立。即如果$X$与$Y$的协方差为0，二者并不一定是统计独立的。\n\n**协方差为0的两个随机变量称为是不相关的。**\n\n### 协方差矩阵：\n\n在统计学与概率论中，协方差矩阵(Covariance matrix)的每个元素是各个向量元素之间的协方差，是从标量随机变量到高维度随机向量的自然推广。\n\n设$X=\\left(X_{1},X_{2},\\ldots,X_{n}\\right)^{\\mathrm{T}}$为$n$ 维随机变量，称矩阵\n\n{% raw %}\n$$\nC=\\left(\\begin{array}{cccc} c_{11} & c_{12} & \\cdots & c_{1n}\\\\ c_{21} & c_{22} & \\cdots & c_{2n}\\\\ \\vdots & \\vdots & \\ddots & \\vdots\\\\ c_{n1} & c_{n2} & \\cdots & c_{nn} \\end{array}\\right)\n$$\n{% endraw %}\n\n为 n 维随机变量x的协方差矩阵，也记为 $D\\left(X\\right)$ ，其中\n$$\nc_{ij}=\\mathrm{Cov}(X_{i},X_{j}),\\quad i,j=1,2,\\ldots,n\n$$\n为X的分量$X_{i}$和$X_{j}$的协方差。*并且对角线上的元素为各个随机变量的方差：*\n\n$$\nc_{ii}=\\mathrm{Cov}(X_{i},X_{i}),\\quad i=1,2,\\ldots,n\n$$\n\n协方差矩阵是对称半正定矩阵。协方差矩阵的对称性，可从定义得知。对于半正定特性，证明如下：\n\n现给定任意一个非零向量$\\boldsymbol{x}$，则\n\n{% raw %}\n$$\n\\begin{aligned}\n\\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\t&=\\boldsymbol{x}^{\\mathrm{T}}\\mathrm{E}\\left[\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\right]\\boldsymbol{x} \t\n\\\\&=\\mathrm{E}\\left[\\boldsymbol{x}^{\\mathrm{T}}\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right] \t\\\\&=\\mathrm{E}\\left[\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)^{\\mathrm{T}}\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)\\right] \t\n\\\\&=\\mathrm{E}\\left(\\left\\Vert \\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right\\Vert ^{2}\\right) \t\n\\\\&=\\sigma_{X}^{2}\n\\end{aligned}\n$$\n{% endraw %}\n\n其中，\n$$\n\\sigma_{X}=\\left(X-\\mu \\right)^{\\mathrm{T}}\\boldsymbol{x}\n$$\n由于 $\\sigma_{X}^{2}\\geq0$，因此$\\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\\geq0$，因此协方差矩阵$C$ 是半正定矩阵。\n\n","source":"_posts/math/covariance-matrix.md","raw":"---\ntitle: 直观理解协方差矩阵\ndate: 2021-08-05 11:26:21\ntags: [math,概率论]\ncategories: [math,概率论]\nmath: true\n---\n\n> 原文出自 https://zhuanlan.zhihu.com/p/349802953\n\n## 1 概率论中的定义\n\n### 随机变量：\n\n随机变量(Random Variable) X 是一个映射，把随机试验的结果与实数建立起了一一对应的关系。而期望与方差是随机变量的两个重要的数字特征。\n\n### 数学期望：\n\n在概率论和统计学中，数学期望(mean)(或均值，亦简称期望(Expectation, or expected value))是试验中每次可能结果的概率乘以其结果的总和，是最基本的数学特征之一。它反映随机变量平均取值的大小。 期望值是该变量输出值的平均数。期望值并不一定包含于变量的输出值集合里。\n\n大数定律规定，随着重复次数接近无穷大，数值的算术平均值几乎肯定地收敛于期望值。\n\n### 方差：\n\n方差(Variance)是在概率论和统计方差衡量随机变量或一组数据时离散程度的度量。概率论中方差用来度量随机变量和其数学期望(即均值)之间的偏离程度。统计中的方差(样本方差)是每个样本值与全体样本值的平均数之差的平方值的平均数。\n\n设$X$为随机变量， 如果$\\mathrm{E}[X]$，则随机变量$X$的方差为：\n$$\n\\mu=\\mathrm{E}[X]\n$$\n\n方差也记为 $\\sigma_{X}^{2}$。\n\n样本方差计算公式：\n\n{% raw %}\n$$\nS^{2}=\\Sigma\\left(X-\\overline{X}\\right)^{2}/\\left(n-1\\right)\n$$\n{% endraw %}\n\n其中，$S^{2}$为样本方差，$X$ 为变量，$\\overline{X}$为样本均值，$n$ 为样本例数。如果要了解为什么要除以$n-1$，请看[这篇文章](https://link.zhihu.com/?target=https%3A//www.visiondummy.com/2014/03/divide-variance-n-1/)。\n\n### 标准差：\n\n标准差(Standard Deviation)是离均差平方的算术平均数(即：方差)的算术平方根，用$\\sigma$表示。标准差也被称为标准偏差，或者实验标准差，在概率统计中最常使用作为统计分布程度上的测量依据。 见下图：\n\n![](https://picture.mulindya.com/covariance-matrix-pic1.jpg)\n\n标准差是方差的算术平方根。标准差能反映一个数据集的离散程度。平均数相同的两组数据，标准差未必相同。\n\n### 协方差：\n\n**协方差(Covariance)在概率论和统计学中用于衡量两个变量的总体误差。而方差是协方差的一种特殊情况，即当两个变量是相同的情况。**\n\n期望值分别为$ E[X]$与$[Y]$的两个实随机变量$X$与$Y$之间的协方差 $\\mathrm{Cov}(X,Y)$ 定义为：\n\n{% raw %}\n$$\n\\begin{aligned}\n\\mathrm{Cov}(X,Y)&=\\mathrm{E}\\left[\\left(X\\mathrm{E}\\left[X\\right]\\right)\\left(Y-\\mathrm{E}\\left[Y\\right]\\right)\\right]  \n\\\\&=\\mathrm{E}\\left[XY\\right]-2\\mathrm{E}\\left[Y\\right]\\mathrm{E}\\left[X\\right]+\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right]\n\\\\&=\\mathrm{E}\\left[XY\\right]-\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right] \n\\\\&=\\mathrm{E}\\left[XY\\right]-\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right]\n\\end{aligned}\n$$\n{% endraw %}\n\n协方差表示的是两个变量总体误差的期望。 如果两个变量的变化趋势一致，也就是说如果其中一个大于自身的期望值，另外一个也大于自身的期望值，那么两个变量之间的协方差就是正值。 如果两个变量的变化趋势相反，即其中一个大于自身的期望值，另外一个却小于自身的期望值，那么两个变量之间的协方差就是负值。\n\n如果$X$与$Y$是统计独立的，那么二者之间的协方差就是0，因为两个独立的随机变量满足$\\mathrm{E}[XY]=\\mathrm{E}[X]\\mathrm{E}[Y]$。但是，反过来并不成立。即如果$X$与$Y$的协方差为0，二者并不一定是统计独立的。\n\n**协方差为0的两个随机变量称为是不相关的。**\n\n### 协方差矩阵：\n\n在统计学与概率论中，协方差矩阵(Covariance matrix)的每个元素是各个向量元素之间的协方差，是从标量随机变量到高维度随机向量的自然推广。\n\n设$X=\\left(X_{1},X_{2},\\ldots,X_{n}\\right)^{\\mathrm{T}}$为$n$ 维随机变量，称矩阵\n\n{% raw %}\n$$\nC=\\left(\\begin{array}{cccc} c_{11} & c_{12} & \\cdots & c_{1n}\\\\ c_{21} & c_{22} & \\cdots & c_{2n}\\\\ \\vdots & \\vdots & \\ddots & \\vdots\\\\ c_{n1} & c_{n2} & \\cdots & c_{nn} \\end{array}\\right)\n$$\n{% endraw %}\n\n为 n 维随机变量x的协方差矩阵，也记为 $D\\left(X\\right)$ ，其中\n$$\nc_{ij}=\\mathrm{Cov}(X_{i},X_{j}),\\quad i,j=1,2,\\ldots,n\n$$\n为X的分量$X_{i}$和$X_{j}$的协方差。*并且对角线上的元素为各个随机变量的方差：*\n\n$$\nc_{ii}=\\mathrm{Cov}(X_{i},X_{i}),\\quad i=1,2,\\ldots,n\n$$\n\n协方差矩阵是对称半正定矩阵。协方差矩阵的对称性，可从定义得知。对于半正定特性，证明如下：\n\n现给定任意一个非零向量$\\boldsymbol{x}$，则\n\n{% raw %}\n$$\n\\begin{aligned}\n\\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\t&=\\boldsymbol{x}^{\\mathrm{T}}\\mathrm{E}\\left[\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\right]\\boldsymbol{x} \t\n\\\\&=\\mathrm{E}\\left[\\boldsymbol{x}^{\\mathrm{T}}\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right] \t\\\\&=\\mathrm{E}\\left[\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)^{\\mathrm{T}}\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)\\right] \t\n\\\\&=\\mathrm{E}\\left(\\left\\Vert \\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right\\Vert ^{2}\\right) \t\n\\\\&=\\sigma_{X}^{2}\n\\end{aligned}\n$$\n{% endraw %}\n\n其中，\n$$\n\\sigma_{X}=\\left(X-\\mu \\right)^{\\mathrm{T}}\\boldsymbol{x}\n$$\n由于 $\\sigma_{X}^{2}\\geq0$，因此$\\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\\geq0$，因此协方差矩阵$C$ 是半正定矩阵。\n\n","slug":"math/covariance-matrix","published":1,"updated":"2022-01-18T08:10:17.100Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bg005uast975so7lzp","content":"<blockquote>\n<p>原文出自 <a href=\"https://zhuanlan.zhihu.com/p/349802953\">https://zhuanlan.zhihu.com/p/349802953</a></p>\n</blockquote>\n<h2 id=\"1-概率论中的定义\">1 概率论中的定义</h2>\n<h3 id=\"随机变量：\">随机变量：</h3>\n<p>随机变量(Random Variable) X 是一个映射，把随机试验的结果与实数建立起了一一对应的关系。而期望与方差是随机变量的两个重要的数字特征。</p>\n<h3 id=\"数学期望：\">数学期望：</h3>\n<p>在概率论和统计学中，数学期望(mean)(或均值，亦简称期望(Expectation, or expected value))是试验中每次可能结果的概率乘以其结果的总和，是最基本的数学特征之一。它反映随机变量平均取值的大小。 期望值是该变量输出值的平均数。期望值并不一定包含于变量的输出值集合里。</p>\n<p>大数定律规定，随着重复次数接近无穷大，数值的算术平均值几乎肯定地收敛于期望值。</p>\n<h3 id=\"方差：\">方差：</h3>\n<p>方差(Variance)是在概率论和统计方差衡量随机变量或一组数据时离散程度的度量。概率论中方差用来度量随机变量和其数学期望(即均值)之间的偏离程度。统计中的方差(样本方差)是每个样本值与全体样本值的平均数之差的平方值的平均数。</p>\n<p>设$X$为随机变量， 如果$\\mathrm{E}[X]$，则随机变量$X$的方差为：<br>\n$$<br>\n\\mu=\\mathrm{E}[X]<br>\n$$</p>\n<p>方差也记为 $\\sigma_{X}^{2}$。</p>\n<p>样本方差计算公式：</p>\n\n$$\nS^{2}=\\Sigma\\left(X-\\overline{X}\\right)^{2}/\\left(n-1\\right)\n$$\n\n<p>其中，$S^{2}$为样本方差，$X$ 为变量，$\\overline{X}$为样本均值，$n$ 为样本例数。如果要了解为什么要除以$n-1$，请看<a href=\"https://link.zhihu.com/?target=https%3A//www.visiondummy.com/2014/03/divide-variance-n-1/\">这篇文章</a>。</p>\n<h3 id=\"标准差：\">标准差：</h3>\n<p>标准差(Standard Deviation)是离均差平方的算术平均数(即：方差)的算术平方根，用$\\sigma$表示。标准差也被称为标准偏差，或者实验标准差，在概率统计中最常使用作为统计分布程度上的测量依据。 见下图：</p>\n<p><img src=\"https://picture.mulindya.com/covariance-matrix-pic1.jpg\" alt=\"\"></p>\n<p>标准差是方差的算术平方根。标准差能反映一个数据集的离散程度。平均数相同的两组数据，标准差未必相同。</p>\n<h3 id=\"协方差：\">协方差：</h3>\n<p><strong>协方差(Covariance)在概率论和统计学中用于衡量两个变量的总体误差。而方差是协方差的一种特殊情况，即当两个变量是相同的情况。</strong></p>\n<p>期望值分别为$ E[X]$与$[Y]$的两个实随机变量$X$与$Y$之间的协方差 $\\mathrm{Cov}(X,Y)$ 定义为：</p>\n\n$$\n\\begin{aligned}\n\\mathrm{Cov}(X,Y)&amp;=\\mathrm{E}\\left[\\left(X\\mathrm{E}\\left[X\\right]\\right)\\left(Y-\\mathrm{E}\\left[Y\\right]\\right)\\right]  \n\\\\&amp;=\\mathrm{E}\\left[XY\\right]-2\\mathrm{E}\\left[Y\\right]\\mathrm{E}\\left[X\\right]+\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right]\n\\\\&amp;=\\mathrm{E}\\left[XY\\right]-\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right] \n\\\\&amp;=\\mathrm{E}\\left[XY\\right]-\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right]\n\\end{aligned}\n$$\n\n<p>协方差表示的是两个变量总体误差的期望。 如果两个变量的变化趋势一致，也就是说如果其中一个大于自身的期望值，另外一个也大于自身的期望值，那么两个变量之间的协方差就是正值。 如果两个变量的变化趋势相反，即其中一个大于自身的期望值，另外一个却小于自身的期望值，那么两个变量之间的协方差就是负值。</p>\n<p>如果$X$与$Y$是统计独立的，那么二者之间的协方差就是0，因为两个独立的随机变量满足$\\mathrm{E}[XY]=\\mathrm{E}[X]\\mathrm{E}[Y]$。但是，反过来并不成立。即如果$X$与$Y$的协方差为0，二者并不一定是统计独立的。</p>\n<p><strong>协方差为0的两个随机变量称为是不相关的。</strong></p>\n<h3 id=\"协方差矩阵：\">协方差矩阵：</h3>\n<p>在统计学与概率论中，协方差矩阵(Covariance matrix)的每个元素是各个向量元素之间的协方差，是从标量随机变量到高维度随机向量的自然推广。</p>\n<p>设$X=\\left(X_{1},X_{2},\\ldots,X_{n}\\right)^{\\mathrm{T}}$为$n$ 维随机变量，称矩阵</p>\n\n$$\nC=\\left(\\begin{array}{cccc} c_{11} &amp; c_{12} &amp; \\cdots &amp; c_{1n}\\\\ c_{21} &amp; c_{22} &amp; \\cdots &amp; c_{2n}\\\\ \\vdots &amp; \\vdots &amp; \\ddots &amp; \\vdots\\\\ c_{n1} &amp; c_{n2} &amp; \\cdots &amp; c_{nn} \\end{array}\\right)\n$$\n\n<p>为 n 维随机变量x的协方差矩阵，也记为 $D\\left(X\\right)$ ，其中<br>\n$$<br>\nc_{ij}=\\mathrm{Cov}(X_{i},X_{j}),\\quad i,j=1,2,\\ldots,n<br>\n$$<br>\n为X的分量$X_{i}$和$X_{j}$的协方差。<em>并且对角线上的元素为各个随机变量的方差：</em></p>\n<p>$$<br>\nc_{ii}=\\mathrm{Cov}(X_{i},X_{i}),\\quad i=1,2,\\ldots,n<br>\n$$</p>\n<p>协方差矩阵是对称半正定矩阵。协方差矩阵的对称性，可从定义得知。对于半正定特性，证明如下：</p>\n<p>现给定任意一个非零向量$\\boldsymbol{x}$，则</p>\n\n$$\n\\begin{aligned}\n\\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\t&amp;=\\boldsymbol{x}^{\\mathrm{T}}\\mathrm{E}\\left[\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\right]\\boldsymbol{x} \t\n\\\\&amp;=\\mathrm{E}\\left[\\boldsymbol{x}^{\\mathrm{T}}\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right] \t\\\\&amp;=\\mathrm{E}\\left[\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)^{\\mathrm{T}}\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)\\right] \t\n\\\\&amp;=\\mathrm{E}\\left(\\left\\Vert \\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right\\Vert ^{2}\\right) \t\n\\\\&amp;=\\sigma_{X}^{2}\n\\end{aligned}\n$$\n\n<p>其中，<br>\n$$<br>\n\\sigma_{X}=\\left(X-\\mu \\right)^{\\mathrm{T}}\\boldsymbol{x}<br>\n$$<br>\n由于 $\\sigma_{X}<sup>{2}\\geq0$，因此$\\boldsymbol{x}</sup>{\\mathrm{T}}C\\boldsymbol{x}\\geq0$，因此协方差矩阵$C$ 是半正定矩阵。</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>原文出自 <a href=\"https://zhuanlan.zhihu.com/p/349802953\">https://zhuanlan.zhihu.com/p/349802953</a></p>\n</blockquote>\n<h2 id=\"1-概率论中的定义\">1 概率论中的定义</h2>\n<h3 id=\"随机变量：\">随机变量：</h3>\n<p>随机变量(Random Variable) X 是一个映射，把随机试验的结果与实数建立起了一一对应的关系。而期望与方差是随机变量的两个重要的数字特征。</p>\n<h3 id=\"数学期望：\">数学期望：</h3>\n<p>在概率论和统计学中，数学期望(mean)(或均值，亦简称期望(Expectation, or expected value))是试验中每次可能结果的概率乘以其结果的总和，是最基本的数学特征之一。它反映随机变量平均取值的大小。 期望值是该变量输出值的平均数。期望值并不一定包含于变量的输出值集合里。</p>\n<p>大数定律规定，随着重复次数接近无穷大，数值的算术平均值几乎肯定地收敛于期望值。</p>\n<h3 id=\"方差：\">方差：</h3>\n<p>方差(Variance)是在概率论和统计方差衡量随机变量或一组数据时离散程度的度量。概率论中方差用来度量随机变量和其数学期望(即均值)之间的偏离程度。统计中的方差(样本方差)是每个样本值与全体样本值的平均数之差的平方值的平均数。</p>\n<p>设$X$为随机变量， 如果$\\mathrm{E}[X]$，则随机变量$X$的方差为：<br>\n$$<br>\n\\mu=\\mathrm{E}[X]<br>\n$$</p>\n<p>方差也记为 $\\sigma_{X}^{2}$。</p>\n<p>样本方差计算公式：</p>\n\n$$\nS^{2}=\\Sigma\\left(X-\\overline{X}\\right)^{2}/\\left(n-1\\right)\n$$\n\n<p>其中，$S^{2}$为样本方差，$X$ 为变量，$\\overline{X}$为样本均值，$n$ 为样本例数。如果要了解为什么要除以$n-1$，请看<a href=\"https://link.zhihu.com/?target=https%3A//www.visiondummy.com/2014/03/divide-variance-n-1/\">这篇文章</a>。</p>\n<h3 id=\"标准差：\">标准差：</h3>\n<p>标准差(Standard Deviation)是离均差平方的算术平均数(即：方差)的算术平方根，用$\\sigma$表示。标准差也被称为标准偏差，或者实验标准差，在概率统计中最常使用作为统计分布程度上的测量依据。 见下图：</p>\n<p><img src=\"https://picture.mulindya.com/covariance-matrix-pic1.jpg\" alt=\"\"></p>\n<p>标准差是方差的算术平方根。标准差能反映一个数据集的离散程度。平均数相同的两组数据，标准差未必相同。</p>\n<h3 id=\"协方差：\">协方差：</h3>\n<p><strong>协方差(Covariance)在概率论和统计学中用于衡量两个变量的总体误差。而方差是协方差的一种特殊情况，即当两个变量是相同的情况。</strong></p>\n<p>期望值分别为$ E[X]$与$[Y]$的两个实随机变量$X$与$Y$之间的协方差 $\\mathrm{Cov}(X,Y)$ 定义为：</p>\n\n$$\n\\begin{aligned}\n\\mathrm{Cov}(X,Y)&=\\mathrm{E}\\left[\\left(X\\mathrm{E}\\left[X\\right]\\right)\\left(Y-\\mathrm{E}\\left[Y\\right]\\right)\\right]  \n\\\\&=\\mathrm{E}\\left[XY\\right]-2\\mathrm{E}\\left[Y\\right]\\mathrm{E}\\left[X\\right]+\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right]\n\\\\&=\\mathrm{E}\\left[XY\\right]-\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right] \n\\\\&=\\mathrm{E}\\left[XY\\right]-\\mathrm{E}\\left[X\\right]\\mathrm{E}\\left[Y\\right]\n\\end{aligned}\n$$\n\n<p>协方差表示的是两个变量总体误差的期望。 如果两个变量的变化趋势一致，也就是说如果其中一个大于自身的期望值，另外一个也大于自身的期望值，那么两个变量之间的协方差就是正值。 如果两个变量的变化趋势相反，即其中一个大于自身的期望值，另外一个却小于自身的期望值，那么两个变量之间的协方差就是负值。</p>\n<p>如果$X$与$Y$是统计独立的，那么二者之间的协方差就是0，因为两个独立的随机变量满足$\\mathrm{E}[XY]=\\mathrm{E}[X]\\mathrm{E}[Y]$。但是，反过来并不成立。即如果$X$与$Y$的协方差为0，二者并不一定是统计独立的。</p>\n<p><strong>协方差为0的两个随机变量称为是不相关的。</strong></p>\n<h3 id=\"协方差矩阵：\">协方差矩阵：</h3>\n<p>在统计学与概率论中，协方差矩阵(Covariance matrix)的每个元素是各个向量元素之间的协方差，是从标量随机变量到高维度随机向量的自然推广。</p>\n<p>设$X=\\left(X_{1},X_{2},\\ldots,X_{n}\\right)^{\\mathrm{T}}$为$n$ 维随机变量，称矩阵</p>\n\n$$\nC=\\left(\\begin{array}{cccc} c_{11} & c_{12} & \\cdots & c_{1n}\\\\ c_{21} & c_{22} & \\cdots & c_{2n}\\\\ \\vdots & \\vdots & \\ddots & \\vdots\\\\ c_{n1} & c_{n2} & \\cdots & c_{nn} \\end{array}\\right)\n$$\n\n<p>为 n 维随机变量x的协方差矩阵，也记为 $D\\left(X\\right)$ ，其中<br>\n$$<br>\nc_{ij}=\\mathrm{Cov}(X_{i},X_{j}),\\quad i,j=1,2,\\ldots,n<br>\n$$<br>\n为X的分量$X_{i}$和$X_{j}$的协方差。<em>并且对角线上的元素为各个随机变量的方差：</em></p>\n<p>$$<br>\nc_{ii}=\\mathrm{Cov}(X_{i},X_{i}),\\quad i=1,2,\\ldots,n<br>\n$$</p>\n<p>协方差矩阵是对称半正定矩阵。协方差矩阵的对称性，可从定义得知。对于半正定特性，证明如下：</p>\n<p>现给定任意一个非零向量$\\boldsymbol{x}$，则</p>\n\n$$\n\\begin{aligned}\n\\boldsymbol{x}^{\\mathrm{T}}C\\boldsymbol{x}\t&=\\boldsymbol{x}^{\\mathrm{T}}\\mathrm{E}\\left[\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\right]\\boldsymbol{x} \t\n\\\\&=\\mathrm{E}\\left[\\boldsymbol{x}^{\\mathrm{T}}\\left(X-\\mu\\right)\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right] \t\\\\&=\\mathrm{E}\\left[\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)^{\\mathrm{T}}\\left(\\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right)\\right] \t\n\\\\&=\\mathrm{E}\\left(\\left\\Vert \\left(X-\\mu\\right)^{\\mathrm{T}}\\boldsymbol{x}\\right\\Vert ^{2}\\right) \t\n\\\\&=\\sigma_{X}^{2}\n\\end{aligned}\n$$\n\n<p>其中，<br>\n$$<br>\n\\sigma_{X}=\\left(X-\\mu \\right)^{\\mathrm{T}}\\boldsymbol{x}<br>\n$$<br>\n由于 $\\sigma_{X}<sup>{2}\\geq0$，因此$\\boldsymbol{x}</sup>{\\mathrm{T}}C\\boldsymbol{x}\\geq0$，因此协方差矩阵$C$ 是半正定矩阵。</p>\n"},{"title":"Mahalanobis_distance","date":"2021-08-09T06:58:56.000Z","math":true,"_content":"\n> 马氏距离(Mahalanobis Distance)是度量学习中一种常用的距离指标，同欧氏距离、曼哈顿距离、汉明距离等一样被用作评定数据之间的相似度指标。但却可以应对高维线性分布的数据中各维度间非独立同分布的问题。\n\n*使用马氏距离，对高维非独立分布的数据进行距离度量。*\n\n**那我们为什么要用马氏距离呢？**\n马氏距离有很多**优点：** **马氏距离不受量纲的影响**，两点之间的马氏距离与原始数据的测量单位无关；由标准化数据和中心化数据(即原始数据与均值之差）计算出的二点之间的马氏距离相同。**马氏距离还可以排除变量之间的相关性的干扰**。\n\n## 什么是马氏距离\n\n马氏距离(Mahalanobis Distance)是一种距离的度量，可以看作是欧氏距离的一种修正，修正了欧式距离中各个维度尺度不一致且相关的问题。\n\n单个数据点的马氏距离\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic1.png)\n\n\n\n数据点x, y之间的马氏距离\n\n\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic2.png)\n\n\n\n*其中Σ是多维随机变量的协方差矩阵，μ为样本均值，如果协方差矩阵是单位向量，也就是各维度独立同分布，马氏距离就变成了欧氏距离。*\n\n## 马氏距离实际意义\n\n那么马氏距离就能能干什么？它比欧氏距离好在哪里？举几个栗子\n\n**欧式距离近就一定相似？**\n\n先举个比较常用的例子，身高和体重，这两个变量拥有不同的单位标准，也就是有不同的scale。比如身高用毫米计算，而体重用千克计算，显然差10mm的身高与差10kg的体重是完全不同的。但在普通的欧氏距离中，这将会算作相同的差距。\n\n**归一化后欧氏距离近就一定相似？**\n\n当然我们可以先做归一化来消除这种维度间scale不同的问题，但是样本分布也会影响分类\n\n举个一维的栗子，现在有两个类别，统一单位，第一个类别均值为0，方差为0.1，第二个类别均值为5，方差为5。那么一个值为2的点属于第一类的概率大还是第二类的概率大？距离上说应该是第一类，但是直觉上显然是第二类，因为第一类不太可能到达2这个位置。\n\n所以，在一个方差较小的维度下很小的差别就有可能成为离群点。就像下图一样，A与B相对于原点的距离是相同的。但是由于样本总体沿着横轴分布，所以B点更有可能是这个样本中的点，而A则更有可能是离群点。\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic3.png)\n\n\n\n**算上维度的方差就够了？**\n\n还有一个问题——如果维度间不独立同分布，样本点一定与欧氏距离近的样本点同类的概率更大吗？\n\n\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic4.png)\n\n\n\n可以看到样本基本服从f(x) = x的线性分布，A与B相对于原点的距离依旧相等，显然A更像是一个离群点\n\n即使数据已经经过了标准化，也不会改变AB与原点间距离大小的相互关系。所以要本质上解决这个问题，就要针对[主成分分析](https://link.zhihu.com/?target=https%3A//www.ph0en1x.space/2018/03/06/PCA/)中的`主成分`来进行标准化。\n\n## 马氏距离的几何意义\n\n上面搞懂了，马氏距离就好理解了，<u>只需要将变量`按照主成分进行旋转`，让维度间相互**独立**，然后进行`标准化`</u>，让维度**同分布**就可以了。\n\n由主成分分析可知，由于主成分就是特征向量方向，每个方向的方差就是对应的特征值，所以只需要按照特征向量的方向旋转，然后缩放特征值倍就可以了，可以得到以下的结果：\n\n\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic5.png)\n\n\n\n离群点就被成功分离，这时候的欧式距离就是马氏距离。\n\n## 马氏距离的推导\n\n首先要对数据点进行*旋转*，旋转至主成分，维度间线性无关，假设新的坐标为\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic6.png)\n\n\n\n又变换后*维度间线性无关且每个维度自己的方差为特征值*，所以满足：\n\n\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic7.png)\n\n\n\n马氏距离是旋转变换缩放之后的欧式距离，所以马氏距离的计算公式为：\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic8.png)\n\n这就是之前提到的马氏距离的公式\n\n## 马氏距离的问题\n\n- 协方差矩阵必须满秩\n\n里面有求逆矩阵的过程，不满秩不行，要求数据要有原维度个特征值，如果没有可以考虑先进行PCA，这种情况下PCA不会损失信息\n\n- 不能处理非线性流形(manifold)上的问题\n\n只对线性空间有效，如果要处理流形，只能在局部定义，可以用来建立KNN图\n\n> 参考：\n>\n> https://zhuanlan.zhihu.com/p/46626607\n","source":"_posts/math/Mahalanobis-distance.md","raw":"---\ntitle: Mahalanobis_distance\ndate: 2021-08-09 14:58:56\ntags: 马氏距离\ncategories: [math,概率论]\nmath: true\n---\n\n> 马氏距离(Mahalanobis Distance)是度量学习中一种常用的距离指标，同欧氏距离、曼哈顿距离、汉明距离等一样被用作评定数据之间的相似度指标。但却可以应对高维线性分布的数据中各维度间非独立同分布的问题。\n\n*使用马氏距离，对高维非独立分布的数据进行距离度量。*\n\n**那我们为什么要用马氏距离呢？**\n马氏距离有很多**优点：** **马氏距离不受量纲的影响**，两点之间的马氏距离与原始数据的测量单位无关；由标准化数据和中心化数据(即原始数据与均值之差）计算出的二点之间的马氏距离相同。**马氏距离还可以排除变量之间的相关性的干扰**。\n\n## 什么是马氏距离\n\n马氏距离(Mahalanobis Distance)是一种距离的度量，可以看作是欧氏距离的一种修正，修正了欧式距离中各个维度尺度不一致且相关的问题。\n\n单个数据点的马氏距离\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic1.png)\n\n\n\n数据点x, y之间的马氏距离\n\n\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic2.png)\n\n\n\n*其中Σ是多维随机变量的协方差矩阵，μ为样本均值，如果协方差矩阵是单位向量，也就是各维度独立同分布，马氏距离就变成了欧氏距离。*\n\n## 马氏距离实际意义\n\n那么马氏距离就能能干什么？它比欧氏距离好在哪里？举几个栗子\n\n**欧式距离近就一定相似？**\n\n先举个比较常用的例子，身高和体重，这两个变量拥有不同的单位标准，也就是有不同的scale。比如身高用毫米计算，而体重用千克计算，显然差10mm的身高与差10kg的体重是完全不同的。但在普通的欧氏距离中，这将会算作相同的差距。\n\n**归一化后欧氏距离近就一定相似？**\n\n当然我们可以先做归一化来消除这种维度间scale不同的问题，但是样本分布也会影响分类\n\n举个一维的栗子，现在有两个类别，统一单位，第一个类别均值为0，方差为0.1，第二个类别均值为5，方差为5。那么一个值为2的点属于第一类的概率大还是第二类的概率大？距离上说应该是第一类，但是直觉上显然是第二类，因为第一类不太可能到达2这个位置。\n\n所以，在一个方差较小的维度下很小的差别就有可能成为离群点。就像下图一样，A与B相对于原点的距离是相同的。但是由于样本总体沿着横轴分布，所以B点更有可能是这个样本中的点，而A则更有可能是离群点。\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic3.png)\n\n\n\n**算上维度的方差就够了？**\n\n还有一个问题——如果维度间不独立同分布，样本点一定与欧氏距离近的样本点同类的概率更大吗？\n\n\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic4.png)\n\n\n\n可以看到样本基本服从f(x) = x的线性分布，A与B相对于原点的距离依旧相等，显然A更像是一个离群点\n\n即使数据已经经过了标准化，也不会改变AB与原点间距离大小的相互关系。所以要本质上解决这个问题，就要针对[主成分分析](https://link.zhihu.com/?target=https%3A//www.ph0en1x.space/2018/03/06/PCA/)中的`主成分`来进行标准化。\n\n## 马氏距离的几何意义\n\n上面搞懂了，马氏距离就好理解了，<u>只需要将变量`按照主成分进行旋转`，让维度间相互**独立**，然后进行`标准化`</u>，让维度**同分布**就可以了。\n\n由主成分分析可知，由于主成分就是特征向量方向，每个方向的方差就是对应的特征值，所以只需要按照特征向量的方向旋转，然后缩放特征值倍就可以了，可以得到以下的结果：\n\n\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic5.png)\n\n\n\n离群点就被成功分离，这时候的欧式距离就是马氏距离。\n\n## 马氏距离的推导\n\n首先要对数据点进行*旋转*，旋转至主成分，维度间线性无关，假设新的坐标为\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic6.png)\n\n\n\n又变换后*维度间线性无关且每个维度自己的方差为特征值*，所以满足：\n\n\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic7.png)\n\n\n\n马氏距离是旋转变换缩放之后的欧式距离，所以马氏距离的计算公式为：\n\n![](https://picture.mulindya.com/Mahalanobis-distance-pic8.png)\n\n这就是之前提到的马氏距离的公式\n\n## 马氏距离的问题\n\n- 协方差矩阵必须满秩\n\n里面有求逆矩阵的过程，不满秩不行，要求数据要有原维度个特征值，如果没有可以考虑先进行PCA，这种情况下PCA不会损失信息\n\n- 不能处理非线性流形(manifold)上的问题\n\n只对线性空间有效，如果要处理流形，只能在局部定义，可以用来建立KNN图\n\n> 参考：\n>\n> https://zhuanlan.zhihu.com/p/46626607\n","slug":"math/Mahalanobis-distance","published":1,"updated":"2022-01-18T08:10:17.099Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bi005xast9bva3aig2","content":"<blockquote>\n<p>马氏距离(Mahalanobis Distance)是度量学习中一种常用的距离指标，同欧氏距离、曼哈顿距离、汉明距离等一样被用作评定数据之间的相似度指标。但却可以应对高维线性分布的数据中各维度间非独立同分布的问题。</p>\n</blockquote>\n<p><em>使用马氏距离，对高维非独立分布的数据进行距离度量。</em></p>\n<p><strong>那我们为什么要用马氏距离呢？</strong><br>\n马氏距离有很多<strong>优点：</strong> <strong>马氏距离不受量纲的影响</strong>，两点之间的马氏距离与原始数据的测量单位无关；由标准化数据和中心化数据(即原始数据与均值之差）计算出的二点之间的马氏距离相同。<strong>马氏距离还可以排除变量之间的相关性的干扰</strong>。</p>\n<h2 id=\"什么是马氏距离\">什么是马氏距离</h2>\n<p>马氏距离(Mahalanobis Distance)是一种距离的度量，可以看作是欧氏距离的一种修正，修正了欧式距离中各个维度尺度不一致且相关的问题。</p>\n<p>单个数据点的马氏距离</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic1.png\" alt=\"\"></p>\n<p>数据点x, y之间的马氏距离</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic2.png\" alt=\"\"></p>\n<p><em>其中Σ是多维随机变量的协方差矩阵，μ为样本均值，如果协方差矩阵是单位向量，也就是各维度独立同分布，马氏距离就变成了欧氏距离。</em></p>\n<h2 id=\"马氏距离实际意义\">马氏距离实际意义</h2>\n<p>那么马氏距离就能能干什么？它比欧氏距离好在哪里？举几个栗子</p>\n<p><strong>欧式距离近就一定相似？</strong></p>\n<p>先举个比较常用的例子，身高和体重，这两个变量拥有不同的单位标准，也就是有不同的scale。比如身高用毫米计算，而体重用千克计算，显然差10mm的身高与差10kg的体重是完全不同的。但在普通的欧氏距离中，这将会算作相同的差距。</p>\n<p><strong>归一化后欧氏距离近就一定相似？</strong></p>\n<p>当然我们可以先做归一化来消除这种维度间scale不同的问题，但是样本分布也会影响分类</p>\n<p>举个一维的栗子，现在有两个类别，统一单位，第一个类别均值为0，方差为0.1，第二个类别均值为5，方差为5。那么一个值为2的点属于第一类的概率大还是第二类的概率大？距离上说应该是第一类，但是直觉上显然是第二类，因为第一类不太可能到达2这个位置。</p>\n<p>所以，在一个方差较小的维度下很小的差别就有可能成为离群点。就像下图一样，A与B相对于原点的距离是相同的。但是由于样本总体沿着横轴分布，所以B点更有可能是这个样本中的点，而A则更有可能是离群点。</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic3.png\" alt=\"\"></p>\n<p><strong>算上维度的方差就够了？</strong></p>\n<p>还有一个问题——如果维度间不独立同分布，样本点一定与欧氏距离近的样本点同类的概率更大吗？</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic4.png\" alt=\"\"></p>\n<p>可以看到样本基本服从f(x) = x的线性分布，A与B相对于原点的距离依旧相等，显然A更像是一个离群点</p>\n<p>即使数据已经经过了标准化，也不会改变AB与原点间距离大小的相互关系。所以要本质上解决这个问题，就要针对<a href=\"https://link.zhihu.com/?target=https%3A//www.ph0en1x.space/2018/03/06/PCA/\">主成分分析</a>中的<code>主成分</code>来进行标准化。</p>\n<h2 id=\"马氏距离的几何意义\">马氏距离的几何意义</h2>\n<p>上面搞懂了，马氏距离就好理解了，<u>只需要将变量<code>按照主成分进行旋转</code>，让维度间相互<strong>独立</strong>，然后进行<code>标准化</code></u>，让维度<strong>同分布</strong>就可以了。</p>\n<p>由主成分分析可知，由于主成分就是特征向量方向，每个方向的方差就是对应的特征值，所以只需要按照特征向量的方向旋转，然后缩放特征值倍就可以了，可以得到以下的结果：</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic5.png\" alt=\"\"></p>\n<p>离群点就被成功分离，这时候的欧式距离就是马氏距离。</p>\n<h2 id=\"马氏距离的推导\">马氏距离的推导</h2>\n<p>首先要对数据点进行<em>旋转</em>，旋转至主成分，维度间线性无关，假设新的坐标为</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic6.png\" alt=\"\"></p>\n<p>又变换后<em>维度间线性无关且每个维度自己的方差为特征值</em>，所以满足：</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic7.png\" alt=\"\"></p>\n<p>马氏距离是旋转变换缩放之后的欧式距离，所以马氏距离的计算公式为：</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic8.png\" alt=\"\"></p>\n<p>这就是之前提到的马氏距离的公式</p>\n<h2 id=\"马氏距离的问题\">马氏距离的问题</h2>\n<ul>\n<li>协方差矩阵必须满秩</li>\n</ul>\n<p>里面有求逆矩阵的过程，不满秩不行，要求数据要有原维度个特征值，如果没有可以考虑先进行PCA，这种情况下PCA不会损失信息</p>\n<ul>\n<li>不能处理非线性流形(manifold)上的问题</li>\n</ul>\n<p>只对线性空间有效，如果要处理流形，只能在局部定义，可以用来建立KNN图</p>\n<blockquote>\n<p>参考：</p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/46626607\">https://zhuanlan.zhihu.com/p/46626607</a></p>\n</blockquote>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>马氏距离(Mahalanobis Distance)是度量学习中一种常用的距离指标，同欧氏距离、曼哈顿距离、汉明距离等一样被用作评定数据之间的相似度指标。但却可以应对高维线性分布的数据中各维度间非独立同分布的问题。</p>\n</blockquote>\n<p><em>使用马氏距离，对高维非独立分布的数据进行距离度量。</em></p>\n<p><strong>那我们为什么要用马氏距离呢？</strong><br>\n马氏距离有很多<strong>优点：</strong> <strong>马氏距离不受量纲的影响</strong>，两点之间的马氏距离与原始数据的测量单位无关；由标准化数据和中心化数据(即原始数据与均值之差）计算出的二点之间的马氏距离相同。<strong>马氏距离还可以排除变量之间的相关性的干扰</strong>。</p>\n<h2 id=\"什么是马氏距离\">什么是马氏距离</h2>\n<p>马氏距离(Mahalanobis Distance)是一种距离的度量，可以看作是欧氏距离的一种修正，修正了欧式距离中各个维度尺度不一致且相关的问题。</p>\n<p>单个数据点的马氏距离</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic1.png\" alt=\"\"></p>\n<p>数据点x, y之间的马氏距离</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic2.png\" alt=\"\"></p>\n<p><em>其中Σ是多维随机变量的协方差矩阵，μ为样本均值，如果协方差矩阵是单位向量，也就是各维度独立同分布，马氏距离就变成了欧氏距离。</em></p>\n<h2 id=\"马氏距离实际意义\">马氏距离实际意义</h2>\n<p>那么马氏距离就能能干什么？它比欧氏距离好在哪里？举几个栗子</p>\n<p><strong>欧式距离近就一定相似？</strong></p>\n<p>先举个比较常用的例子，身高和体重，这两个变量拥有不同的单位标准，也就是有不同的scale。比如身高用毫米计算，而体重用千克计算，显然差10mm的身高与差10kg的体重是完全不同的。但在普通的欧氏距离中，这将会算作相同的差距。</p>\n<p><strong>归一化后欧氏距离近就一定相似？</strong></p>\n<p>当然我们可以先做归一化来消除这种维度间scale不同的问题，但是样本分布也会影响分类</p>\n<p>举个一维的栗子，现在有两个类别，统一单位，第一个类别均值为0，方差为0.1，第二个类别均值为5，方差为5。那么一个值为2的点属于第一类的概率大还是第二类的概率大？距离上说应该是第一类，但是直觉上显然是第二类，因为第一类不太可能到达2这个位置。</p>\n<p>所以，在一个方差较小的维度下很小的差别就有可能成为离群点。就像下图一样，A与B相对于原点的距离是相同的。但是由于样本总体沿着横轴分布，所以B点更有可能是这个样本中的点，而A则更有可能是离群点。</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic3.png\" alt=\"\"></p>\n<p><strong>算上维度的方差就够了？</strong></p>\n<p>还有一个问题——如果维度间不独立同分布，样本点一定与欧氏距离近的样本点同类的概率更大吗？</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic4.png\" alt=\"\"></p>\n<p>可以看到样本基本服从f(x) = x的线性分布，A与B相对于原点的距离依旧相等，显然A更像是一个离群点</p>\n<p>即使数据已经经过了标准化，也不会改变AB与原点间距离大小的相互关系。所以要本质上解决这个问题，就要针对<a href=\"https://link.zhihu.com/?target=https%3A//www.ph0en1x.space/2018/03/06/PCA/\">主成分分析</a>中的<code>主成分</code>来进行标准化。</p>\n<h2 id=\"马氏距离的几何意义\">马氏距离的几何意义</h2>\n<p>上面搞懂了，马氏距离就好理解了，<u>只需要将变量<code>按照主成分进行旋转</code>，让维度间相互<strong>独立</strong>，然后进行<code>标准化</code></u>，让维度<strong>同分布</strong>就可以了。</p>\n<p>由主成分分析可知，由于主成分就是特征向量方向，每个方向的方差就是对应的特征值，所以只需要按照特征向量的方向旋转，然后缩放特征值倍就可以了，可以得到以下的结果：</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic5.png\" alt=\"\"></p>\n<p>离群点就被成功分离，这时候的欧式距离就是马氏距离。</p>\n<h2 id=\"马氏距离的推导\">马氏距离的推导</h2>\n<p>首先要对数据点进行<em>旋转</em>，旋转至主成分，维度间线性无关，假设新的坐标为</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic6.png\" alt=\"\"></p>\n<p>又变换后<em>维度间线性无关且每个维度自己的方差为特征值</em>，所以满足：</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic7.png\" alt=\"\"></p>\n<p>马氏距离是旋转变换缩放之后的欧式距离，所以马氏距离的计算公式为：</p>\n<p><img src=\"https://picture.mulindya.com/Mahalanobis-distance-pic8.png\" alt=\"\"></p>\n<p>这就是之前提到的马氏距离的公式</p>\n<h2 id=\"马氏距离的问题\">马氏距离的问题</h2>\n<ul>\n<li>协方差矩阵必须满秩</li>\n</ul>\n<p>里面有求逆矩阵的过程，不满秩不行，要求数据要有原维度个特征值，如果没有可以考虑先进行PCA，这种情况下PCA不会损失信息</p>\n<ul>\n<li>不能处理非线性流形(manifold)上的问题</li>\n</ul>\n<p>只对线性空间有效，如果要处理流形，只能在局部定义，可以用来建立KNN图</p>\n<blockquote>\n<p>参考：</p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/46626607\">https://zhuanlan.zhihu.com/p/46626607</a></p>\n</blockquote>\n"},{"title":"随机数的总结","date":"2021-09-09T12:48:15.000Z","_content":"\n> 经常会用到随机数，在此，对numpy包中的随机数相关函数进行总结。\n\n- numpy.random.rand(d0, d1, ..., dn)\n 该函数可以指定shape，返回服从0~1均匀分布的随机样本值。\n\n- numpy.random.randint(low, high=None, size=None, dtype='l')\n 该函数返回随机的整数，可以指定随机数组范围和大小；在这里low是包含，high不包含;默认数据类型是long。\n\n- numpy.random.randn(d0, d1, ..., dn)\n 该函数与rand类似，但是分布不同，这里是返回服从标准正态分布的随机样本值。\n  \n- numpy.random.uniform(low=0.0, high=1.0, size=None)\n 该函数与randint类似，可以指定范围和大小，但是这里返回的随机数服从区间的均匀分布。\n   \n- numpy.random.choice(a, size=None, replace=True, p=None)\n 该函数的作用是在给定的数据点中（一维数组）随机不重复的抽取大小为size的样本数据。\n\n- numpy.random.random_sample(size=None)\n 该函数是在[0,1)的范围随机返回指定大小的浮点数。也就是说与numpy.random.rand()类似，但是这里是需要输入size，而rand直接输入维度即可。\n\n","source":"_posts/package_usage/random-summarize.md","raw":"---\ntitle: 随机数的总结\ntags: numpy\ncategories: 包的使用\ndate: 2021-09-09 20:48:15\n---\n\n> 经常会用到随机数，在此，对numpy包中的随机数相关函数进行总结。\n\n- numpy.random.rand(d0, d1, ..., dn)\n 该函数可以指定shape，返回服从0~1均匀分布的随机样本值。\n\n- numpy.random.randint(low, high=None, size=None, dtype='l')\n 该函数返回随机的整数，可以指定随机数组范围和大小；在这里low是包含，high不包含;默认数据类型是long。\n\n- numpy.random.randn(d0, d1, ..., dn)\n 该函数与rand类似，但是分布不同，这里是返回服从标准正态分布的随机样本值。\n  \n- numpy.random.uniform(low=0.0, high=1.0, size=None)\n 该函数与randint类似，可以指定范围和大小，但是这里返回的随机数服从区间的均匀分布。\n   \n- numpy.random.choice(a, size=None, replace=True, p=None)\n 该函数的作用是在给定的数据点中（一维数组）随机不重复的抽取大小为size的样本数据。\n\n- numpy.random.random_sample(size=None)\n 该函数是在[0,1)的范围随机返回指定大小的浮点数。也就是说与numpy.random.rand()类似，但是这里是需要输入size，而rand直接输入维度即可。\n\n","slug":"package_usage/random-summarize","published":1,"updated":"2022-01-18T08:10:17.102Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bk0060ast9b5f392f9","content":"<blockquote>\n<p>经常会用到随机数，在此，对numpy包中的随机数相关函数进行总结。</p>\n</blockquote>\n<ul>\n<li>\n<p>numpy.random.rand(d0, d1, …, dn)<br>\n该函数可以指定shape，返回服从0~1均匀分布的随机样本值。</p>\n</li>\n<li>\n<p>numpy.random.randint(low, high=None, size=None, dtype=‘l’)<br>\n该函数返回随机的整数，可以指定随机数组范围和大小；在这里low是包含，high不包含;默认数据类型是long。</p>\n</li>\n<li>\n<p>numpy.random.randn(d0, d1, …, dn)<br>\n该函数与rand类似，但是分布不同，这里是返回服从标准正态分布的随机样本值。</p>\n</li>\n<li>\n<p>numpy.random.uniform(low=0.0, high=1.0, size=None)<br>\n该函数与randint类似，可以指定范围和大小，但是这里返回的随机数服从区间的均匀分布。</p>\n</li>\n<li>\n<p>numpy.random.choice(a, size=None, replace=True, p=None)<br>\n该函数的作用是在给定的数据点中（一维数组）随机不重复的抽取大小为size的样本数据。</p>\n</li>\n<li>\n<p>numpy.random.random_sample(size=None)<br>\n该函数是在[0,1)的范围随机返回指定大小的浮点数。也就是说与numpy.random.rand()类似，但是这里是需要输入size，而rand直接输入维度即可。</p>\n</li>\n</ul>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>经常会用到随机数，在此，对numpy包中的随机数相关函数进行总结。</p>\n</blockquote>\n<ul>\n<li>\n<p>numpy.random.rand(d0, d1, …, dn)<br>\n该函数可以指定shape，返回服从0~1均匀分布的随机样本值。</p>\n</li>\n<li>\n<p>numpy.random.randint(low, high=None, size=None, dtype=‘l’)<br>\n该函数返回随机的整数，可以指定随机数组范围和大小；在这里low是包含，high不包含;默认数据类型是long。</p>\n</li>\n<li>\n<p>numpy.random.randn(d0, d1, …, dn)<br>\n该函数与rand类似，但是分布不同，这里是返回服从标准正态分布的随机样本值。</p>\n</li>\n<li>\n<p>numpy.random.uniform(low=0.0, high=1.0, size=None)<br>\n该函数与randint类似，可以指定范围和大小，但是这里返回的随机数服从区间的均匀分布。</p>\n</li>\n<li>\n<p>numpy.random.choice(a, size=None, replace=True, p=None)<br>\n该函数的作用是在给定的数据点中（一维数组）随机不重复的抽取大小为size的样本数据。</p>\n</li>\n<li>\n<p>numpy.random.random_sample(size=None)<br>\n该函数是在[0,1)的范围随机返回指定大小的浮点数。也就是说与numpy.random.rand()类似，但是这里是需要输入size，而rand直接输入维度即可。</p>\n</li>\n</ul>\n"},{"title":"低秩逼近的思考","date":"2021-08-06T08:38:25.000Z","math":true,"_content":"\n> 阅读文章**Semi-orthogonal Embedding for Effificient Unsupervised Anomaly Segmentation**时出现一个概念--**Low-rank approximation** ，就此进行相关讨论。\n\n### 低秩（Low-Rank）\n\n如果X是一个m行n列的数值矩阵，rank(X)是X的秩，假如rank (X)远小于m和n，则我们称X是低秩矩阵。低秩矩阵每行或每列都可以用其他的行或列线性表出，可见它包含大量的冗余信息。利用这种冗余信息，可以对缺失数据进行恢复，也可以对数据进行特征提取。\n\n图像处理中，*rank可以理解为图像所包含的信息的丰富程度*，在显示生活中，一张图片中大部分成分是相似的。比如给一张大草原的图片\n\n![](https://picture.mulindya.com/low-rank-app-pic1.png)\n\n\n\n草原是由很多草组成的，而草是相似的，所以如果全是草，那么这张图所包含的信息量是很少的的，因为可以理解为草是草的复制品。而上图的蒙古包，人，马之类的则可以理解为图片所包含的信息，实际上，相对于只有草的草原图片和有草和蒙古包的草原图片，后者的秩是较高的。也就是说，图片中比较突兀的成分，比如蒙古包，比如人像照片中的红眼亮点，会增加图像矩阵的秩。而现实生活中一张不错的图片的秩其实是比较低的，如果图像的秩比较高，往往是因为图像中的噪声比较严重。比如拍照的时候ISO感光度设置过高造成噪点太过泛滥之类的。所以，*图像处理的低秩性其实可以拿来去除照片中的噪点*。\n\n### 低秩和稀疏\n\n我们认为图像有一些公共的模式，所有图像都由这些基本的模式组成。例如，如果图像是一个叉，可以看成是一个正斜线和反斜线的叠加。**只要我们找到了所有的基底（称作字典**，就是上面说的正斜线和反斜线之类的东西）**，就能通过基底的线性组合表示出所有的图像。**这就好像学画画，先学会基本的画正方体、球体、圆柱体等等，就可以组合出各种各样的复杂形状。\n\n**在很多情形下，基底的数量是很少的**，比如一张照片拍的是一面砖墙，那么它显然具有周期重复的特点，换句话说低秩。即使整个图不低秩，往往也能找出一些相似的块，这些块是低秩的。再退一步，就算这也做不到，往往也可以把已有的数据看成一组低维的结果加上噪声，也即原来的数据**可以被低秩矩阵很好的逼近**。**稀疏性**的意思是（以稀疏表示为例），任给一个图像，**字典可能是过完备的**，从而用字典里的基向量表出这幅图有很多种不同的方案。我们希望**选取使用基底数量最少的那种方案**，\n\n应用：\n\n***1）矩阵填充(Matrix Completion)***\n\n***2）鲁棒PCA***\n\n***3）背景建模***\n\n***4）变换不变低秩纹理（TILT）***\n\n> 在论文 **Semi-orthogonal Embedding for Effificient Unsupervised Anomaly Segmentation**中有一段可以参考。\n\n**Low-rank approximation of precision matrix**\n\nThe feature data **X** is subject to low-rank approximation due to the narrower target domain for anomaly-free images than the ImageNet dataset’s. The multi-scale features from different layers may also contribute to it due to the inter-dependency among the features from the layers. Inspired by the truncated SVD of a precision matrix, a low-rank embedding of input features with $W \\in R^{F \\times k}$,where *F > k*, is considered as follows:\n\n{% raw %}\n$$\nd^2_{i,j} = X^TW(W^TC_{i,j}W)^{−1}W^TX\n$$\n{% endraw %}\n\nwhere the below Theorem 1 shows the optimal **W*** is the eigenvectors related to the *k*-smallest eigenvalues of $C_{i,j}$ . Notice that 1) the computational complexity of the equation is cubically reduced to *O*($HWk^3$) set aside the cost of SVD, although which is the concern, 2) PCA embedding would fail to minimize approximation error since it uses the *k*-largest eigenvectors [14], and 3) near-zero eigenvalues may induce substantial anomaly scores.\n\n选取协方差矩阵的k个最小的特征值对应的特征向量，进行低秩逼近\n\n> 参考\n>\n>  https://www.zhihu.com/question/28630628\n>\n> https://blog.csdn.net/zouxy09/article/details/24972869\n","source":"_posts/math/low-rank-app.md","raw":"---\ntitle: 低秩逼近的思考\ndate: 2021-08-06 16:38:25\ntags: [math,线性代数]\ncategories: [math,线性代数]\nmath: true\n---\n\n> 阅读文章**Semi-orthogonal Embedding for Effificient Unsupervised Anomaly Segmentation**时出现一个概念--**Low-rank approximation** ，就此进行相关讨论。\n\n### 低秩（Low-Rank）\n\n如果X是一个m行n列的数值矩阵，rank(X)是X的秩，假如rank (X)远小于m和n，则我们称X是低秩矩阵。低秩矩阵每行或每列都可以用其他的行或列线性表出，可见它包含大量的冗余信息。利用这种冗余信息，可以对缺失数据进行恢复，也可以对数据进行特征提取。\n\n图像处理中，*rank可以理解为图像所包含的信息的丰富程度*，在显示生活中，一张图片中大部分成分是相似的。比如给一张大草原的图片\n\n![](https://picture.mulindya.com/low-rank-app-pic1.png)\n\n\n\n草原是由很多草组成的，而草是相似的，所以如果全是草，那么这张图所包含的信息量是很少的的，因为可以理解为草是草的复制品。而上图的蒙古包，人，马之类的则可以理解为图片所包含的信息，实际上，相对于只有草的草原图片和有草和蒙古包的草原图片，后者的秩是较高的。也就是说，图片中比较突兀的成分，比如蒙古包，比如人像照片中的红眼亮点，会增加图像矩阵的秩。而现实生活中一张不错的图片的秩其实是比较低的，如果图像的秩比较高，往往是因为图像中的噪声比较严重。比如拍照的时候ISO感光度设置过高造成噪点太过泛滥之类的。所以，*图像处理的低秩性其实可以拿来去除照片中的噪点*。\n\n### 低秩和稀疏\n\n我们认为图像有一些公共的模式，所有图像都由这些基本的模式组成。例如，如果图像是一个叉，可以看成是一个正斜线和反斜线的叠加。**只要我们找到了所有的基底（称作字典**，就是上面说的正斜线和反斜线之类的东西）**，就能通过基底的线性组合表示出所有的图像。**这就好像学画画，先学会基本的画正方体、球体、圆柱体等等，就可以组合出各种各样的复杂形状。\n\n**在很多情形下，基底的数量是很少的**，比如一张照片拍的是一面砖墙，那么它显然具有周期重复的特点，换句话说低秩。即使整个图不低秩，往往也能找出一些相似的块，这些块是低秩的。再退一步，就算这也做不到，往往也可以把已有的数据看成一组低维的结果加上噪声，也即原来的数据**可以被低秩矩阵很好的逼近**。**稀疏性**的意思是（以稀疏表示为例），任给一个图像，**字典可能是过完备的**，从而用字典里的基向量表出这幅图有很多种不同的方案。我们希望**选取使用基底数量最少的那种方案**，\n\n应用：\n\n***1）矩阵填充(Matrix Completion)***\n\n***2）鲁棒PCA***\n\n***3）背景建模***\n\n***4）变换不变低秩纹理（TILT）***\n\n> 在论文 **Semi-orthogonal Embedding for Effificient Unsupervised Anomaly Segmentation**中有一段可以参考。\n\n**Low-rank approximation of precision matrix**\n\nThe feature data **X** is subject to low-rank approximation due to the narrower target domain for anomaly-free images than the ImageNet dataset’s. The multi-scale features from different layers may also contribute to it due to the inter-dependency among the features from the layers. Inspired by the truncated SVD of a precision matrix, a low-rank embedding of input features with $W \\in R^{F \\times k}$,where *F > k*, is considered as follows:\n\n{% raw %}\n$$\nd^2_{i,j} = X^TW(W^TC_{i,j}W)^{−1}W^TX\n$$\n{% endraw %}\n\nwhere the below Theorem 1 shows the optimal **W*** is the eigenvectors related to the *k*-smallest eigenvalues of $C_{i,j}$ . Notice that 1) the computational complexity of the equation is cubically reduced to *O*($HWk^3$) set aside the cost of SVD, although which is the concern, 2) PCA embedding would fail to minimize approximation error since it uses the *k*-largest eigenvectors [14], and 3) near-zero eigenvalues may induce substantial anomaly scores.\n\n选取协方差矩阵的k个最小的特征值对应的特征向量，进行低秩逼近\n\n> 参考\n>\n>  https://www.zhihu.com/question/28630628\n>\n> https://blog.csdn.net/zouxy09/article/details/24972869\n","slug":"math/low-rank-app","published":1,"updated":"2022-01-18T08:10:17.101Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bm0063ast9awon0tgq","content":"<blockquote>\n<p>阅读文章<strong>Semi-orthogonal Embedding for Effificient Unsupervised Anomaly Segmentation</strong>时出现一个概念–<strong>Low-rank approximation</strong> ，就此进行相关讨论。</p>\n</blockquote>\n<h3 id=\"低秩（Low-Rank）\">低秩（Low-Rank）</h3>\n<p>如果X是一个m行n列的数值矩阵，rank(X)是X的秩，假如rank (X)远小于m和n，则我们称X是低秩矩阵。低秩矩阵每行或每列都可以用其他的行或列线性表出，可见它包含大量的冗余信息。利用这种冗余信息，可以对缺失数据进行恢复，也可以对数据进行特征提取。</p>\n<p>图像处理中，<em>rank可以理解为图像所包含的信息的丰富程度</em>，在显示生活中，一张图片中大部分成分是相似的。比如给一张大草原的图片</p>\n<p><img src=\"https://picture.mulindya.com/low-rank-app-pic1.png\" alt=\"\"></p>\n<p>草原是由很多草组成的，而草是相似的，所以如果全是草，那么这张图所包含的信息量是很少的的，因为可以理解为草是草的复制品。而上图的蒙古包，人，马之类的则可以理解为图片所包含的信息，实际上，相对于只有草的草原图片和有草和蒙古包的草原图片，后者的秩是较高的。也就是说，图片中比较突兀的成分，比如蒙古包，比如人像照片中的红眼亮点，会增加图像矩阵的秩。而现实生活中一张不错的图片的秩其实是比较低的，如果图像的秩比较高，往往是因为图像中的噪声比较严重。比如拍照的时候ISO感光度设置过高造成噪点太过泛滥之类的。所以，<em>图像处理的低秩性其实可以拿来去除照片中的噪点</em>。</p>\n<h3 id=\"低秩和稀疏\">低秩和稀疏</h3>\n<p>我们认为图像有一些公共的模式，所有图像都由这些基本的模式组成。例如，如果图像是一个叉，可以看成是一个正斜线和反斜线的叠加。<strong>只要我们找到了所有的基底（称作字典</strong>，就是上面说的正斜线和反斜线之类的东西）**，就能通过基底的线性组合表示出所有的图像。**这就好像学画画，先学会基本的画正方体、球体、圆柱体等等，就可以组合出各种各样的复杂形状。</p>\n<p><strong>在很多情形下，基底的数量是很少的</strong>，比如一张照片拍的是一面砖墙，那么它显然具有周期重复的特点，换句话说低秩。即使整个图不低秩，往往也能找出一些相似的块，这些块是低秩的。再退一步，就算这也做不到，往往也可以把已有的数据看成一组低维的结果加上噪声，也即原来的数据<strong>可以被低秩矩阵很好的逼近</strong>。<strong>稀疏性</strong>的意思是（以稀疏表示为例），任给一个图像，<strong>字典可能是过完备的</strong>，从而用字典里的基向量表出这幅图有很多种不同的方案。我们希望<strong>选取使用基底数量最少的那种方案</strong>，</p>\n<p>应用：</p>\n<p><em><strong>1）矩阵填充(Matrix Completion)</strong></em></p>\n<p><em><strong>2）鲁棒PCA</strong></em></p>\n<p><em><strong>3）背景建模</strong></em></p>\n<p><em><strong>4）变换不变低秩纹理（TILT）</strong></em></p>\n<blockquote>\n<p>在论文 <strong>Semi-orthogonal Embedding for Effificient Unsupervised Anomaly Segmentation</strong>中有一段可以参考。</p>\n</blockquote>\n<p><strong>Low-rank approximation of precision matrix</strong></p>\n<p>The feature data <strong>X</strong> is subject to low-rank approximation due to the narrower target domain for anomaly-free images than the ImageNet dataset’s. The multi-scale features from different layers may also contribute to it due to the inter-dependency among the features from the layers. Inspired by the truncated SVD of a precision matrix, a low-rank embedding of input features with $W \\in R^{F \\times k}$,where <em>F &gt; k</em>, is considered as follows:</p>\n\n$$\nd^2_{i,j} = X^TW(W^TC_{i,j}W)^{−1}W^TX\n$$\n\n<p>where the below Theorem 1 shows the optimal <strong>W</strong>* is the eigenvectors related to the <em>k</em>-smallest eigenvalues of $C_{i,j}$ . Notice that 1) the computational complexity of the equation is cubically reduced to <em>O</em>($HWk^3$) set aside the cost of SVD, although which is the concern, 2) PCA embedding would fail to minimize approximation error since it uses the <em>k</em>-largest eigenvectors [14], and 3) near-zero eigenvalues may induce substantial anomaly scores.</p>\n<p>选取协方差矩阵的k个最小的特征值对应的特征向量，进行低秩逼近</p>\n<blockquote>\n<p>参考</p>\n<p><a href=\"https://www.zhihu.com/question/28630628\">https://www.zhihu.com/question/28630628</a></p>\n<p><a href=\"https://blog.csdn.net/zouxy09/article/details/24972869\">https://blog.csdn.net/zouxy09/article/details/24972869</a></p>\n</blockquote>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>阅读文章<strong>Semi-orthogonal Embedding for Effificient Unsupervised Anomaly Segmentation</strong>时出现一个概念–<strong>Low-rank approximation</strong> ，就此进行相关讨论。</p>\n</blockquote>\n<h3 id=\"低秩（Low-Rank）\">低秩（Low-Rank）</h3>\n<p>如果X是一个m行n列的数值矩阵，rank(X)是X的秩，假如rank (X)远小于m和n，则我们称X是低秩矩阵。低秩矩阵每行或每列都可以用其他的行或列线性表出，可见它包含大量的冗余信息。利用这种冗余信息，可以对缺失数据进行恢复，也可以对数据进行特征提取。</p>\n<p>图像处理中，<em>rank可以理解为图像所包含的信息的丰富程度</em>，在显示生活中，一张图片中大部分成分是相似的。比如给一张大草原的图片</p>\n<p><img src=\"https://picture.mulindya.com/low-rank-app-pic1.png\" alt=\"\"></p>\n<p>草原是由很多草组成的，而草是相似的，所以如果全是草，那么这张图所包含的信息量是很少的的，因为可以理解为草是草的复制品。而上图的蒙古包，人，马之类的则可以理解为图片所包含的信息，实际上，相对于只有草的草原图片和有草和蒙古包的草原图片，后者的秩是较高的。也就是说，图片中比较突兀的成分，比如蒙古包，比如人像照片中的红眼亮点，会增加图像矩阵的秩。而现实生活中一张不错的图片的秩其实是比较低的，如果图像的秩比较高，往往是因为图像中的噪声比较严重。比如拍照的时候ISO感光度设置过高造成噪点太过泛滥之类的。所以，<em>图像处理的低秩性其实可以拿来去除照片中的噪点</em>。</p>\n<h3 id=\"低秩和稀疏\">低秩和稀疏</h3>\n<p>我们认为图像有一些公共的模式，所有图像都由这些基本的模式组成。例如，如果图像是一个叉，可以看成是一个正斜线和反斜线的叠加。<strong>只要我们找到了所有的基底（称作字典</strong>，就是上面说的正斜线和反斜线之类的东西）**，就能通过基底的线性组合表示出所有的图像。**这就好像学画画，先学会基本的画正方体、球体、圆柱体等等，就可以组合出各种各样的复杂形状。</p>\n<p><strong>在很多情形下，基底的数量是很少的</strong>，比如一张照片拍的是一面砖墙，那么它显然具有周期重复的特点，换句话说低秩。即使整个图不低秩，往往也能找出一些相似的块，这些块是低秩的。再退一步，就算这也做不到，往往也可以把已有的数据看成一组低维的结果加上噪声，也即原来的数据<strong>可以被低秩矩阵很好的逼近</strong>。<strong>稀疏性</strong>的意思是（以稀疏表示为例），任给一个图像，<strong>字典可能是过完备的</strong>，从而用字典里的基向量表出这幅图有很多种不同的方案。我们希望<strong>选取使用基底数量最少的那种方案</strong>，</p>\n<p>应用：</p>\n<p><em><strong>1）矩阵填充(Matrix Completion)</strong></em></p>\n<p><em><strong>2）鲁棒PCA</strong></em></p>\n<p><em><strong>3）背景建模</strong></em></p>\n<p><em><strong>4）变换不变低秩纹理（TILT）</strong></em></p>\n<blockquote>\n<p>在论文 <strong>Semi-orthogonal Embedding for Effificient Unsupervised Anomaly Segmentation</strong>中有一段可以参考。</p>\n</blockquote>\n<p><strong>Low-rank approximation of precision matrix</strong></p>\n<p>The feature data <strong>X</strong> is subject to low-rank approximation due to the narrower target domain for anomaly-free images than the ImageNet dataset’s. The multi-scale features from different layers may also contribute to it due to the inter-dependency among the features from the layers. Inspired by the truncated SVD of a precision matrix, a low-rank embedding of input features with $W \\in R^{F \\times k}$,where <em>F &gt; k</em>, is considered as follows:</p>\n\n$$\nd^2_{i,j} = X^TW(W^TC_{i,j}W)^{−1}W^TX\n$$\n\n<p>where the below Theorem 1 shows the optimal <strong>W</strong>* is the eigenvectors related to the <em>k</em>-smallest eigenvalues of $C_{i,j}$ . Notice that 1) the computational complexity of the equation is cubically reduced to <em>O</em>($HWk^3$) set aside the cost of SVD, although which is the concern, 2) PCA embedding would fail to minimize approximation error since it uses the <em>k</em>-largest eigenvectors [14], and 3) near-zero eigenvalues may induce substantial anomaly scores.</p>\n<p>选取协方差矩阵的k个最小的特征值对应的特征向量，进行低秩逼近</p>\n<blockquote>\n<p>参考</p>\n<p><a href=\"https://www.zhihu.com/question/28630628\">https://www.zhihu.com/question/28630628</a></p>\n<p><a href=\"https://blog.csdn.net/zouxy09/article/details/24972869\">https://blog.csdn.net/zouxy09/article/details/24972869</a></p>\n</blockquote>\n"},{"title":"足迹检测项目的总结","date":"2021-12-29T13:44:42.000Z","_content":"\n> 总结足迹检测项目\n\n## 简介\n根据刻度尺上的特征对产生畸变的脚印矫正。实现原图打印和标注；\n\n## 技术点\n根据刻度尺上的特征对产生畸变的脚印矫正。\n使用霍夫变换拟合4个圆定位来仿射变换矫正图像\n- 霍夫变换->yolov5\n- 仿射变换\n- pyqt5\n\n## 难点\n使用霍夫变换容易定位到背景的圆，并且可能出现圆不全的情况\n## 解决方案\n使用深度学习的方法目标检测\n使用多个特征融合选择进行仿射变换\n## 成果\n达到不超过15度时，误差在2mm以内\n## 创新点\n使用多个特征融合矫正\n## 展望和改进\n尺子矫正后不均衡\n\n","source":"_posts/project_summary/footprint-summary.md","raw":"---\ntitle: 足迹检测项目的总结\ntags: [项目]\ncategories: [项目]\ndate: 2021-12-29 21:44:42\n---\n\n> 总结足迹检测项目\n\n## 简介\n根据刻度尺上的特征对产生畸变的脚印矫正。实现原图打印和标注；\n\n## 技术点\n根据刻度尺上的特征对产生畸变的脚印矫正。\n使用霍夫变换拟合4个圆定位来仿射变换矫正图像\n- 霍夫变换->yolov5\n- 仿射变换\n- pyqt5\n\n## 难点\n使用霍夫变换容易定位到背景的圆，并且可能出现圆不全的情况\n## 解决方案\n使用深度学习的方法目标检测\n使用多个特征融合选择进行仿射变换\n## 成果\n达到不超过15度时，误差在2mm以内\n## 创新点\n使用多个特征融合矫正\n## 展望和改进\n尺子矫正后不均衡\n\n","slug":"project_summary/footprint-summary","published":1,"updated":"2022-01-18T08:10:17.103Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bn0066ast98rp12by6","content":"<blockquote>\n<p>总结足迹检测项目</p>\n</blockquote>\n<h2 id=\"简介\">简介</h2>\n<p>根据刻度尺上的特征对产生畸变的脚印矫正。实现原图打印和标注；</p>\n<h2 id=\"技术点\">技术点</h2>\n<p>根据刻度尺上的特征对产生畸变的脚印矫正。<br>\n使用霍夫变换拟合4个圆定位来仿射变换矫正图像</p>\n<ul>\n<li>霍夫变换-&gt;yolov5</li>\n<li>仿射变换</li>\n<li>pyqt5</li>\n</ul>\n<h2 id=\"难点\">难点</h2>\n<p>使用霍夫变换容易定位到背景的圆，并且可能出现圆不全的情况</p>\n<h2 id=\"解决方案\">解决方案</h2>\n<p>使用深度学习的方法目标检测<br>\n使用多个特征融合选择进行仿射变换</p>\n<h2 id=\"成果\">成果</h2>\n<p>达到不超过15度时，误差在2mm以内</p>\n<h2 id=\"创新点\">创新点</h2>\n<p>使用多个特征融合矫正</p>\n<h2 id=\"展望和改进\">展望和改进</h2>\n<p>尺子矫正后不均衡</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>总结足迹检测项目</p>\n</blockquote>\n<h2 id=\"简介\">简介</h2>\n<p>根据刻度尺上的特征对产生畸变的脚印矫正。实现原图打印和标注；</p>\n<h2 id=\"技术点\">技术点</h2>\n<p>根据刻度尺上的特征对产生畸变的脚印矫正。<br>\n使用霍夫变换拟合4个圆定位来仿射变换矫正图像</p>\n<ul>\n<li>霍夫变换-&gt;yolov5</li>\n<li>仿射变换</li>\n<li>pyqt5</li>\n</ul>\n<h2 id=\"难点\">难点</h2>\n<p>使用霍夫变换容易定位到背景的圆，并且可能出现圆不全的情况</p>\n<h2 id=\"解决方案\">解决方案</h2>\n<p>使用深度学习的方法目标检测<br>\n使用多个特征融合选择进行仿射变换</p>\n<h2 id=\"成果\">成果</h2>\n<p>达到不超过15度时，误差在2mm以内</p>\n<h2 id=\"创新点\">创新点</h2>\n<p>使用多个特征融合矫正</p>\n<h2 id=\"展望和改进\">展望和改进</h2>\n<p>尺子矫正后不均衡</p>\n"},{"title":"pipenv的安装和使用","date":"2021-10-08T08:51:25.000Z","_content":"\n> pipenv 是Kenneth Reitz大神的作品，能够有效管理Python多个环境，各种包。过去我们一般用virtualenv搭建虚拟环境，管理python版本，但是跨平台的使用不太一致，且有时候处理包之间的依赖总存在问题；过去也常常用 pip进行包的管理，pip已经足够好，但是仍然推荐pipenv，相当于virtualenv和pip的合体，且更加强大。pipenv开源之后，在GitHub上有很高人气（截止于现在有9600多星）。\n\n\n> 在项目打包时，项目文件104M打包之后文件5.8G，有人说，Anaconda里内置了很多库，打包的时候打包了很多不必要的模块进去，要用纯净的Python来打包。于是尝试使用pipenv虚拟环境来打包，emmm最后完成是5.2G，感觉，也，没有，多大改变吖，尤其是torch包直接占到了2.8G(这还是改了from import之后呢)。 哎 :persevere:\n\n**pipenv主要有以下特性：**\n\n　　（1）pipenv集成了pip，virtualenv两者的功能，且完善了两者的一些缺陷。\n\n　　（2）过去用virtualenv管理requirements.txt文件可能会有问题，Pipenv使用Pipfile和Pipfile.lock，后者存放将包的依赖关系，查看依赖关系是十分方便。\n\n　　（3）各个地方使用了哈希校验，无论安装还是卸载包都十分安全，且会自动公开安全漏洞。。\n\n　　（4）通过加载.env文件简化开发工作流程。\n\n　　（5）支持Python2 和 Python3，在各个平台的命令都是一样的。\n\n下面快速介绍pipenv的基本使用，文章末尾有其github链接。本文的测试环境是windows下的Python3.6，对于其他平台同样适用。\n\n## 1 安装pipenv\n\n```python\npip install pipenv\n```\n\n## 2 创建虚拟环境\n\n新建文件夹在文件夹中建立虚拟环境。\n\n```python\nmkdir envfile\ncd envfile\npipenv install\n```\n\n初始化好虚拟环境后，会在项目目录下生成2个文件`Pipfile`和`Pipfile.lock`。为pipenv包的配置文件，代替原来的 requirement.txt。\n\n项目提交时，可将`Pipfile` 文件和`Pipfile.lock`文件一并提交，待其他开发克隆下载，根据此Pipfile 运行命令`pipenv install --dev`生成自己的虚拟环境。\n\n`Pipfile.lock` 文件是通过hash算法将包的名称和版本，及依赖关系生成哈希值，可以保证包的完整性。\n\n## 3 安装包\n\n在虚拟环境下安装包\n\n可以使用\n\n```python\npipenv install package\n```\n\n或者先进入虚拟环境中再安装包。\n\n```python\npipenv shell  #激活虚拟环境\npip install package\n```\n\n也可使用txt文件来安装包\n\n```python\npipenv install -r requirements.txt #通过requirements文件安装包\n```\nrequirements.txt文件形如\n\n```\n# pip install -r requirements.txt\n\n# base ----------------------------------------\nmatplotlib>=3.2.2\nnumpy>=1.18.5\nopencv-python>=4.1.2\nPillow\nPyYAML>=5.3.1\nscipy>=1.4.1\ntorch==1.8.2\ntorchvision>=0.9.2\ntqdm>=4.41.0\nPyQt5\nfpdf\n# logging -------------------------------------\n#tensorboard>=2.4.1\n# wandb\n\n# plotting ------------------------------------\nseaborn>=0.11.0\npandas\nrequests\n```\n\n## 4 相关的命令\n\n```python\npipenv --py    #显示python解释器信息\npipenv --where #显示本地工程路径\npipenv --venv  #显示虚拟环境信息\npipenv graph   #显示目前安装的库以及依赖关系\npipenv uninstrall package #卸载依赖包\npipenv uninstall --all    #卸载全部依赖包\nexit                      #退出虚拟环境\npipenv --rm               #删除虚拟环境\n```\n\n#### 运行代码\n\n```python\npipenv run python XXX.py\n或者\npipenv shell\npython XXX.py\n```\n\n## 5 pyinstaller打包压缩\n\n### 第一次打包\n\n```python\npip install pipenv        #安装pipenv库\npipenv install            #新建环境，cd进入，建立虚拟环境\npipenv shell              #进入虚拟环境\npip install [...]         #安装项目所需的模块\npip install pyinstaller   #安装打包的模块\npyinstaller 参数 [..]      #打包\n```\n\n生成dist文件夹和结果。\n\n### 再次打包\n\n```python\npipenv shell               #cd进入之前创建的虚拟环境文件夹，进入虚拟环境\npip install [new package]  #安装新模块\npyinstaller 参数 [...]      #再次打包\n```\n\n","source":"_posts/project_tool/pipenv.md","raw":"---\ntitle: pipenv的安装和使用\ntags: [项目打包]\ncategories: [工具]\ndate: 2021-10-08 16:51:25\n---\n\n> pipenv 是Kenneth Reitz大神的作品，能够有效管理Python多个环境，各种包。过去我们一般用virtualenv搭建虚拟环境，管理python版本，但是跨平台的使用不太一致，且有时候处理包之间的依赖总存在问题；过去也常常用 pip进行包的管理，pip已经足够好，但是仍然推荐pipenv，相当于virtualenv和pip的合体，且更加强大。pipenv开源之后，在GitHub上有很高人气（截止于现在有9600多星）。\n\n\n> 在项目打包时，项目文件104M打包之后文件5.8G，有人说，Anaconda里内置了很多库，打包的时候打包了很多不必要的模块进去，要用纯净的Python来打包。于是尝试使用pipenv虚拟环境来打包，emmm最后完成是5.2G，感觉，也，没有，多大改变吖，尤其是torch包直接占到了2.8G(这还是改了from import之后呢)。 哎 :persevere:\n\n**pipenv主要有以下特性：**\n\n　　（1）pipenv集成了pip，virtualenv两者的功能，且完善了两者的一些缺陷。\n\n　　（2）过去用virtualenv管理requirements.txt文件可能会有问题，Pipenv使用Pipfile和Pipfile.lock，后者存放将包的依赖关系，查看依赖关系是十分方便。\n\n　　（3）各个地方使用了哈希校验，无论安装还是卸载包都十分安全，且会自动公开安全漏洞。。\n\n　　（4）通过加载.env文件简化开发工作流程。\n\n　　（5）支持Python2 和 Python3，在各个平台的命令都是一样的。\n\n下面快速介绍pipenv的基本使用，文章末尾有其github链接。本文的测试环境是windows下的Python3.6，对于其他平台同样适用。\n\n## 1 安装pipenv\n\n```python\npip install pipenv\n```\n\n## 2 创建虚拟环境\n\n新建文件夹在文件夹中建立虚拟环境。\n\n```python\nmkdir envfile\ncd envfile\npipenv install\n```\n\n初始化好虚拟环境后，会在项目目录下生成2个文件`Pipfile`和`Pipfile.lock`。为pipenv包的配置文件，代替原来的 requirement.txt。\n\n项目提交时，可将`Pipfile` 文件和`Pipfile.lock`文件一并提交，待其他开发克隆下载，根据此Pipfile 运行命令`pipenv install --dev`生成自己的虚拟环境。\n\n`Pipfile.lock` 文件是通过hash算法将包的名称和版本，及依赖关系生成哈希值，可以保证包的完整性。\n\n## 3 安装包\n\n在虚拟环境下安装包\n\n可以使用\n\n```python\npipenv install package\n```\n\n或者先进入虚拟环境中再安装包。\n\n```python\npipenv shell  #激活虚拟环境\npip install package\n```\n\n也可使用txt文件来安装包\n\n```python\npipenv install -r requirements.txt #通过requirements文件安装包\n```\nrequirements.txt文件形如\n\n```\n# pip install -r requirements.txt\n\n# base ----------------------------------------\nmatplotlib>=3.2.2\nnumpy>=1.18.5\nopencv-python>=4.1.2\nPillow\nPyYAML>=5.3.1\nscipy>=1.4.1\ntorch==1.8.2\ntorchvision>=0.9.2\ntqdm>=4.41.0\nPyQt5\nfpdf\n# logging -------------------------------------\n#tensorboard>=2.4.1\n# wandb\n\n# plotting ------------------------------------\nseaborn>=0.11.0\npandas\nrequests\n```\n\n## 4 相关的命令\n\n```python\npipenv --py    #显示python解释器信息\npipenv --where #显示本地工程路径\npipenv --venv  #显示虚拟环境信息\npipenv graph   #显示目前安装的库以及依赖关系\npipenv uninstrall package #卸载依赖包\npipenv uninstall --all    #卸载全部依赖包\nexit                      #退出虚拟环境\npipenv --rm               #删除虚拟环境\n```\n\n#### 运行代码\n\n```python\npipenv run python XXX.py\n或者\npipenv shell\npython XXX.py\n```\n\n## 5 pyinstaller打包压缩\n\n### 第一次打包\n\n```python\npip install pipenv        #安装pipenv库\npipenv install            #新建环境，cd进入，建立虚拟环境\npipenv shell              #进入虚拟环境\npip install [...]         #安装项目所需的模块\npip install pyinstaller   #安装打包的模块\npyinstaller 参数 [..]      #打包\n```\n\n生成dist文件夹和结果。\n\n### 再次打包\n\n```python\npipenv shell               #cd进入之前创建的虚拟环境文件夹，进入虚拟环境\npip install [new package]  #安装新模块\npyinstaller 参数 [...]      #再次打包\n```\n\n","slug":"project_tool/pipenv","published":1,"updated":"2022-01-18T08:10:17.104Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bp0069ast9132u3qej","content":"<blockquote>\n<p>pipenv 是Kenneth Reitz大神的作品，能够有效管理Python多个环境，各种包。过去我们一般用virtualenv搭建虚拟环境，管理python版本，但是跨平台的使用不太一致，且有时候处理包之间的依赖总存在问题；过去也常常用 pip进行包的管理，pip已经足够好，但是仍然推荐pipenv，相当于virtualenv和pip的合体，且更加强大。pipenv开源之后，在GitHub上有很高人气（截止于现在有9600多星）。</p>\n</blockquote>\n<blockquote>\n<p>在项目打包时，项目文件104M打包之后文件5.8G，有人说，Anaconda里内置了很多库，打包的时候打包了很多不必要的模块进去，要用纯净的Python来打包。于是尝试使用pipenv虚拟环境来打包，emmm最后完成是5.2G，感觉，也，没有，多大改变吖，尤其是torch包直接占到了2.8G(这还是改了from import之后呢)。 哎 😣</p>\n</blockquote>\n<p><strong>pipenv主要有以下特性：</strong></p>\n<p>（1）pipenv集成了pip，virtualenv两者的功能，且完善了两者的一些缺陷。</p>\n<p>（2）过去用virtualenv管理requirements.txt文件可能会有问题，Pipenv使用Pipfile和Pipfile.lock，后者存放将包的依赖关系，查看依赖关系是十分方便。</p>\n<p>（3）各个地方使用了哈希校验，无论安装还是卸载包都十分安全，且会自动公开安全漏洞。。</p>\n<p>（4）通过加载.env文件简化开发工作流程。</p>\n<p>（5）支持Python2 和 Python3，在各个平台的命令都是一样的。</p>\n<p>下面快速介绍pipenv的基本使用，文章末尾有其github链接。本文的测试环境是windows下的Python3.6，对于其他平台同样适用。</p>\n<h2 id=\"1-安装pipenv\">1 安装pipenv</h2>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pip install pipenv<br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"2-创建虚拟环境\">2 创建虚拟环境</h2>\n<p>新建文件夹在文件夹中建立虚拟环境。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">mkdir envfile<br>cd envfile<br>pipenv install<br></code></pre></td></tr></tbody></table></figure>\n<p>初始化好虚拟环境后，会在项目目录下生成2个文件<code>Pipfile</code>和<code>Pipfile.lock</code>。为pipenv包的配置文件，代替原来的 requirement.txt。</p>\n<p>项目提交时，可将<code>Pipfile</code> 文件和<code>Pipfile.lock</code>文件一并提交，待其他开发克隆下载，根据此Pipfile 运行命令<code>pipenv install --dev</code>生成自己的虚拟环境。</p>\n<p><code>Pipfile.lock</code> 文件是通过hash算法将包的名称和版本，及依赖关系生成哈希值，可以保证包的完整性。</p>\n<h2 id=\"3-安装包\">3 安装包</h2>\n<p>在虚拟环境下安装包</p>\n<p>可以使用</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv install package<br></code></pre></td></tr></tbody></table></figure>\n<p>或者先进入虚拟环境中再安装包。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv shell  <span class=\"hljs-comment\">#激活虚拟环境</span><br>pip install package<br></code></pre></td></tr></tbody></table></figure>\n<p>也可使用txt文件来安装包</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv install -r requirements.txt <span class=\"hljs-comment\">#通过requirements文件安装包</span><br></code></pre></td></tr></tbody></table></figure>\n<p>requirements.txt文件形如</p>\n<figure class=\"highlight apache\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-comment\"># pip install -r requirements.txt</span><br><br><span class=\"hljs-comment\"># base ----------------------------------------</span><br><span class=\"hljs-attribute\">matplotlib</span>&gt;=<span class=\"hljs-number\">3</span>.<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">2</span><br><span class=\"hljs-attribute\">numpy</span>&gt;=<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">18</span>.<span class=\"hljs-number\">5</span><br><span class=\"hljs-attribute\">opencv</span>-python&gt;=<span class=\"hljs-number\">4</span>.<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">2</span><br><span class=\"hljs-attribute\">Pillow</span><br><span class=\"hljs-attribute\">PyYAML</span>&gt;=<span class=\"hljs-number\">5</span>.<span class=\"hljs-number\">3</span>.<span class=\"hljs-number\">1</span><br><span class=\"hljs-attribute\">scipy</span>&gt;=<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">4</span>.<span class=\"hljs-number\">1</span><br><span class=\"hljs-attribute\">torch</span>==<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">8</span>.<span class=\"hljs-number\">2</span><br><span class=\"hljs-attribute\">torchvision</span>&gt;=<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">9</span>.<span class=\"hljs-number\">2</span><br><span class=\"hljs-attribute\">tqdm</span>&gt;=<span class=\"hljs-number\">4</span>.<span class=\"hljs-number\">41</span>.<span class=\"hljs-number\">0</span><br><span class=\"hljs-attribute\">PyQt5</span><br><span class=\"hljs-attribute\">fpdf</span><br><span class=\"hljs-comment\"># logging -------------------------------------</span><br><span class=\"hljs-comment\">#tensorboard&gt;=2.4.1</span><br><span class=\"hljs-comment\"># wandb</span><br><br><span class=\"hljs-comment\"># plotting ------------------------------------</span><br><span class=\"hljs-attribute\">seaborn</span>&gt;=<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">11</span>.<span class=\"hljs-number\">0</span><br><span class=\"hljs-attribute\">pandas</span><br><span class=\"hljs-attribute\">requests</span><br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"4-相关的命令\">4 相关的命令</h2>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv --py    <span class=\"hljs-comment\">#显示python解释器信息</span><br>pipenv --where <span class=\"hljs-comment\">#显示本地工程路径</span><br>pipenv --venv  <span class=\"hljs-comment\">#显示虚拟环境信息</span><br>pipenv graph   <span class=\"hljs-comment\">#显示目前安装的库以及依赖关系</span><br>pipenv uninstrall package <span class=\"hljs-comment\">#卸载依赖包</span><br>pipenv uninstall --<span class=\"hljs-built_in\">all</span>    <span class=\"hljs-comment\">#卸载全部依赖包</span><br>exit                      <span class=\"hljs-comment\">#退出虚拟环境</span><br>pipenv --rm               <span class=\"hljs-comment\">#删除虚拟环境</span><br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"运行代码\">运行代码</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv run python XXX.py<br>或者<br>pipenv shell<br>python XXX.py<br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"5-pyinstaller打包压缩\">5 pyinstaller打包压缩</h2>\n<h3 id=\"第一次打包\">第一次打包</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pip install pipenv        <span class=\"hljs-comment\">#安装pipenv库</span><br>pipenv install            <span class=\"hljs-comment\">#新建环境，cd进入，建立虚拟环境</span><br>pipenv shell              <span class=\"hljs-comment\">#进入虚拟环境</span><br>pip install [...]         <span class=\"hljs-comment\">#安装项目所需的模块</span><br>pip install pyinstaller   <span class=\"hljs-comment\">#安装打包的模块</span><br>pyinstaller 参数 [..]      <span class=\"hljs-comment\">#打包</span><br></code></pre></td></tr></tbody></table></figure>\n<p>生成dist文件夹和结果。</p>\n<h3 id=\"再次打包\">再次打包</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv shell               <span class=\"hljs-comment\">#cd进入之前创建的虚拟环境文件夹，进入虚拟环境</span><br>pip install [new package]  <span class=\"hljs-comment\">#安装新模块</span><br>pyinstaller 参数 [...]      <span class=\"hljs-comment\">#再次打包</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>pipenv 是Kenneth Reitz大神的作品，能够有效管理Python多个环境，各种包。过去我们一般用virtualenv搭建虚拟环境，管理python版本，但是跨平台的使用不太一致，且有时候处理包之间的依赖总存在问题；过去也常常用 pip进行包的管理，pip已经足够好，但是仍然推荐pipenv，相当于virtualenv和pip的合体，且更加强大。pipenv开源之后，在GitHub上有很高人气（截止于现在有9600多星）。</p>\n</blockquote>\n<blockquote>\n<p>在项目打包时，项目文件104M打包之后文件5.8G，有人说，Anaconda里内置了很多库，打包的时候打包了很多不必要的模块进去，要用纯净的Python来打包。于是尝试使用pipenv虚拟环境来打包，emmm最后完成是5.2G，感觉，也，没有，多大改变吖，尤其是torch包直接占到了2.8G(这还是改了from import之后呢)。 哎 😣</p>\n</blockquote>\n<p><strong>pipenv主要有以下特性：</strong></p>\n<p>（1）pipenv集成了pip，virtualenv两者的功能，且完善了两者的一些缺陷。</p>\n<p>（2）过去用virtualenv管理requirements.txt文件可能会有问题，Pipenv使用Pipfile和Pipfile.lock，后者存放将包的依赖关系，查看依赖关系是十分方便。</p>\n<p>（3）各个地方使用了哈希校验，无论安装还是卸载包都十分安全，且会自动公开安全漏洞。。</p>\n<p>（4）通过加载.env文件简化开发工作流程。</p>\n<p>（5）支持Python2 和 Python3，在各个平台的命令都是一样的。</p>\n<p>下面快速介绍pipenv的基本使用，文章末尾有其github链接。本文的测试环境是windows下的Python3.6，对于其他平台同样适用。</p>\n<h2 id=\"1-安装pipenv\">1 安装pipenv</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pip install pipenv<br></code></pre></td></tr></table></figure>\n<h2 id=\"2-创建虚拟环境\">2 创建虚拟环境</h2>\n<p>新建文件夹在文件夹中建立虚拟环境。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">mkdir envfile<br>cd envfile<br>pipenv install<br></code></pre></td></tr></table></figure>\n<p>初始化好虚拟环境后，会在项目目录下生成2个文件<code>Pipfile</code>和<code>Pipfile.lock</code>。为pipenv包的配置文件，代替原来的 requirement.txt。</p>\n<p>项目提交时，可将<code>Pipfile</code> 文件和<code>Pipfile.lock</code>文件一并提交，待其他开发克隆下载，根据此Pipfile 运行命令<code>pipenv install --dev</code>生成自己的虚拟环境。</p>\n<p><code>Pipfile.lock</code> 文件是通过hash算法将包的名称和版本，及依赖关系生成哈希值，可以保证包的完整性。</p>\n<h2 id=\"3-安装包\">3 安装包</h2>\n<p>在虚拟环境下安装包</p>\n<p>可以使用</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv install package<br></code></pre></td></tr></table></figure>\n<p>或者先进入虚拟环境中再安装包。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv shell  <span class=\"hljs-comment\">#激活虚拟环境</span><br>pip install package<br></code></pre></td></tr></table></figure>\n<p>也可使用txt文件来安装包</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv install -r requirements.txt <span class=\"hljs-comment\">#通过requirements文件安装包</span><br></code></pre></td></tr></table></figure>\n<p>requirements.txt文件形如</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-comment\"># pip install -r requirements.txt</span><br><br><span class=\"hljs-comment\"># base ----------------------------------------</span><br><span class=\"hljs-attribute\">matplotlib</span>&gt;=<span class=\"hljs-number\">3</span>.<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">2</span><br><span class=\"hljs-attribute\">numpy</span>&gt;=<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">18</span>.<span class=\"hljs-number\">5</span><br><span class=\"hljs-attribute\">opencv</span>-python&gt;=<span class=\"hljs-number\">4</span>.<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">2</span><br><span class=\"hljs-attribute\">Pillow</span><br><span class=\"hljs-attribute\">PyYAML</span>&gt;=<span class=\"hljs-number\">5</span>.<span class=\"hljs-number\">3</span>.<span class=\"hljs-number\">1</span><br><span class=\"hljs-attribute\">scipy</span>&gt;=<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">4</span>.<span class=\"hljs-number\">1</span><br><span class=\"hljs-attribute\">torch</span>==<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">8</span>.<span class=\"hljs-number\">2</span><br><span class=\"hljs-attribute\">torchvision</span>&gt;=<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">9</span>.<span class=\"hljs-number\">2</span><br><span class=\"hljs-attribute\">tqdm</span>&gt;=<span class=\"hljs-number\">4</span>.<span class=\"hljs-number\">41</span>.<span class=\"hljs-number\">0</span><br><span class=\"hljs-attribute\">PyQt5</span><br><span class=\"hljs-attribute\">fpdf</span><br><span class=\"hljs-comment\"># logging -------------------------------------</span><br><span class=\"hljs-comment\">#tensorboard&gt;=2.4.1</span><br><span class=\"hljs-comment\"># wandb</span><br><br><span class=\"hljs-comment\"># plotting ------------------------------------</span><br><span class=\"hljs-attribute\">seaborn</span>&gt;=<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">11</span>.<span class=\"hljs-number\">0</span><br><span class=\"hljs-attribute\">pandas</span><br><span class=\"hljs-attribute\">requests</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"4-相关的命令\">4 相关的命令</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv --py    <span class=\"hljs-comment\">#显示python解释器信息</span><br>pipenv --where <span class=\"hljs-comment\">#显示本地工程路径</span><br>pipenv --venv  <span class=\"hljs-comment\">#显示虚拟环境信息</span><br>pipenv graph   <span class=\"hljs-comment\">#显示目前安装的库以及依赖关系</span><br>pipenv uninstrall package <span class=\"hljs-comment\">#卸载依赖包</span><br>pipenv uninstall --<span class=\"hljs-built_in\">all</span>    <span class=\"hljs-comment\">#卸载全部依赖包</span><br>exit                      <span class=\"hljs-comment\">#退出虚拟环境</span><br>pipenv --rm               <span class=\"hljs-comment\">#删除虚拟环境</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"运行代码\">运行代码</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv run python XXX.py<br>或者<br>pipenv shell<br>python XXX.py<br></code></pre></td></tr></table></figure>\n<h2 id=\"5-pyinstaller打包压缩\">5 pyinstaller打包压缩</h2>\n<h3 id=\"第一次打包\">第一次打包</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pip install pipenv        <span class=\"hljs-comment\">#安装pipenv库</span><br>pipenv install            <span class=\"hljs-comment\">#新建环境，cd进入，建立虚拟环境</span><br>pipenv shell              <span class=\"hljs-comment\">#进入虚拟环境</span><br>pip install [...]         <span class=\"hljs-comment\">#安装项目所需的模块</span><br>pip install pyinstaller   <span class=\"hljs-comment\">#安装打包的模块</span><br>pyinstaller 参数 [..]      <span class=\"hljs-comment\">#打包</span><br></code></pre></td></tr></table></figure>\n<p>生成dist文件夹和结果。</p>\n<h3 id=\"再次打包\">再次打包</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pipenv shell               <span class=\"hljs-comment\">#cd进入之前创建的虚拟环境文件夹，进入虚拟环境</span><br>pip install [new package]  <span class=\"hljs-comment\">#安装新模块</span><br>pyinstaller 参数 [...]      <span class=\"hljs-comment\">#再次打包</span><br></code></pre></td></tr></table></figure>\n"},{"title":"pyinstaller打包问题","date":"2021-09-29T07:41:26.000Z","_content":"\n>在使用pyinstaller打包的过程中的坑点，记录一下\n>参考大佬：https://blog.csdn.net/u012219045/article/details/115397646\n\n```\n在使用pyinstaller打包的整个过程中，遇到不少问题，在此总结一下。后面遇到会继续更新！\n\n1. 在64下可运行，不能在32位下运行\n   解决：在32位系统下打包，可以参考 https://blog.csdn.net/u012219045/article/details/115320619\n\n2. RecursionError:maximum recursion depth\n   解决：在xxx.spec文件开始增加两行：\n\n    import sys\n    sys.setrecursionlimit(5000)\n再执行打包：pyinstaller xxx.spec \n\n3. UnicodeDecodeError:'utf-8' codec can't decode byte 0xce in position 122:invalid continuation byte\n   解决：在你打包的命令行中先输入chcp 65001 然后再输入打包命令。\n\n4. 使用了多进程 multiprocessing 模块\n   解决：必须调用 multiprocessing.freeze_support()，直接在“if __name__ == '__main__'”之后调用\n\n5. 打包PyQt5闪退\n   原因：可能未找到某个文件\n   解决办法：\n        1. 把需要读取的文件及其其他资源 都放到dist中。\n        2. 打包成exe的话，需使用 --add-data 附加。可参考：https://blog.csdn.net/u012219045/article/details/114841287\n\n6. WARNING:file already exists but should not：_C.cp37-win_amd64\n   解决：报错内容可能不同，但都是xxx已存在，问题的原因是pyinstaller打包时多打了一次，所以会报已经存在了。\n   这个解决方案就是把多余的去掉。在自动生成的xxx.spec中，在 a 和 PYZ 中间添加如下代码，去掉多余依赖项\n\n    for d in a.datas:\n        if '_C.cp37-win_amd64' in d[0]:\n            a.datas.remove(d)\n            break\n7. Hidden import \"xxx\"  not found!\n    Hidden import \"pkg_resources.markers\" not found!\n    Hidden import \"pkg_resources.py2_warn\" not found!\n    Hidden import \"MySQLdb\" not found!\n    Hidden import \"sqlalchemy.sql.functions.func\" not found!\n    Hidden import \"mx.DateTime\" not found!\n    解决： hiddenimports=['pkg_resources.markers', 'pkg_resources.py2_warn', '...']\n\n8.  打包的时候出现了很多warning：lib not found...dll, 原因是pyinstaller 没有办法识别到这些dll\n    解决办法：copy warning中一些dll文件的名字，再电脑中搜索到他们的路径！添加到环境变量里面\n    WARNING:lib not found:msmpi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_msmpi_ilp64.dll\n    WARNING:lib not found:impi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_intelmpi_lp64.dll\n    WARNING:lib not found:msmpi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_msmpi_lp64.dll\n    WARNING:lib not found:impi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_intelmpi_ilp64.dll\n    WARNING:lib not found:mpich2mpi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_mpich2_lp64.dll\n    WARNING:lib not found:mpich2mpi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_mpich2_ilp64.dll\n    WARNING:lib not found:pgf90.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_pgi_thread.dll\n    WARNING:lib not found:pgf90rtl.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_pgi_thread.dll\n    WARNING:lib not found:pgc14.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_pgi_thread.dll\n    WARNING:lib not found:torch_python.dll dependency of d:\\programdata\\anaconda3\\lib\\site-packages\\torch\\_C.cp37-win_amd64.pyd\n\n9. 切换了虚拟环境打包，报DLL无法导入，实际是打包时还在使用旧的虚拟环境\n    解决： 打包时指定虚拟环境：-p。可参考： https://blog.csdn.net/u012219045/article/details/113612475\n\n10. DecodeEncodeError\n    解决： 检查执行路径中是否有中文，非Acsii码，换成英文路径。Python文件开头加 #-*-coding:utf-8-*-\n\n11. Pyqt5 打包后会出现错误:\"QThread:Destroyed while thread is still running\"\n    解决办法1：启动QThread使用了start(), 改为run() 可解决，但这样会卡主UI线程\n    解决办法2：依然使用start()，再追加一句 exec()。推荐这样！\n\n12. No module named 'sklearn.xx'\n    43852 WARNING: Hidden import \"sklearn.utils.sparsetools._graph_validation\" not found!\n    43854 WARNING: Hidden import \"sklearn.utils.sparsetools._graph_tools\" not found!\n    43866 WARNING: Hidden import \"sklearn.utils.lgamma\" not found!\n    No module named 'sklearn.utils._cython_blas'\n    No module named 'sklearn.neighbors._typedefs'\n    No module named 'sklearn.neighbors._quad_tree'\n    No module named 'sklearn.tree'\n    No module named 'sklearn.tree._utils'\n    解决：hiddenimports=['sklearn', 'sklearn.tree', 'sklearn.tree._utils', 'sklearn.neighbors._quad_tree',\n                       'sklearn.neighbors._typedefs', 'sklearn.utils._cython_blas',\n                       'sklearn.utils.sparsetools._graph_validation',\n                       'sklearn.utils.sparsetools._graph_tools', 'sklearn.utils.lgamma']\n13. No module named 'scipy.special.cython_special'\n   解决: 使用scipy==1.4.1 或者 --hidden-import scipy.special.cython_special\n\n14. No such file or directory: 'xxx\\\\librosa\\\\util\\\\example_data\\\\registry.txt'\n   解决: 使用--add-data或者直接拷贝librosa下的对应文件到dist。\n   \n15. fatal error:zmq.h:No such file or directory\n    解决: sudo apt install libzmq3-dev\n\n16. Error loading \"xxx\\torch\\lib\\caffe2_detectron_ops_gpu.dll\" or one of its dependencies\n    开始使用pytorch==1.6.0 torchvision==0.7.0 cudatoolkit=10.1，后来更换高版本torch1.7.0解决！\n    # pip install torch===1.7.0+cu110 torchvision===0.8.1+cu110 torchaudio===0.7.0 -f https://download.pytorch.org/whl/torch_stable.html\n\n17. unhandled exception \n    Error loading \"xxx\\torch\\lib\\caffe2_nvrtc.dll\" or one of its dependencies\n    开始使用pytorch降版本到1.8\n```\n\n","source":"_posts/project_tool/pyinstaller-spec-problem.md","raw":"---\ntitle: pyinstaller打包问题\ntags: [项目打包]\ncategories: [工具,pyinstaller]\ndate: 2021-09-29 15:41:26\n---\n\n>在使用pyinstaller打包的过程中的坑点，记录一下\n>参考大佬：https://blog.csdn.net/u012219045/article/details/115397646\n\n```\n在使用pyinstaller打包的整个过程中，遇到不少问题，在此总结一下。后面遇到会继续更新！\n\n1. 在64下可运行，不能在32位下运行\n   解决：在32位系统下打包，可以参考 https://blog.csdn.net/u012219045/article/details/115320619\n\n2. RecursionError:maximum recursion depth\n   解决：在xxx.spec文件开始增加两行：\n\n    import sys\n    sys.setrecursionlimit(5000)\n再执行打包：pyinstaller xxx.spec \n\n3. UnicodeDecodeError:'utf-8' codec can't decode byte 0xce in position 122:invalid continuation byte\n   解决：在你打包的命令行中先输入chcp 65001 然后再输入打包命令。\n\n4. 使用了多进程 multiprocessing 模块\n   解决：必须调用 multiprocessing.freeze_support()，直接在“if __name__ == '__main__'”之后调用\n\n5. 打包PyQt5闪退\n   原因：可能未找到某个文件\n   解决办法：\n        1. 把需要读取的文件及其其他资源 都放到dist中。\n        2. 打包成exe的话，需使用 --add-data 附加。可参考：https://blog.csdn.net/u012219045/article/details/114841287\n\n6. WARNING:file already exists but should not：_C.cp37-win_amd64\n   解决：报错内容可能不同，但都是xxx已存在，问题的原因是pyinstaller打包时多打了一次，所以会报已经存在了。\n   这个解决方案就是把多余的去掉。在自动生成的xxx.spec中，在 a 和 PYZ 中间添加如下代码，去掉多余依赖项\n\n    for d in a.datas:\n        if '_C.cp37-win_amd64' in d[0]:\n            a.datas.remove(d)\n            break\n7. Hidden import \"xxx\"  not found!\n    Hidden import \"pkg_resources.markers\" not found!\n    Hidden import \"pkg_resources.py2_warn\" not found!\n    Hidden import \"MySQLdb\" not found!\n    Hidden import \"sqlalchemy.sql.functions.func\" not found!\n    Hidden import \"mx.DateTime\" not found!\n    解决： hiddenimports=['pkg_resources.markers', 'pkg_resources.py2_warn', '...']\n\n8.  打包的时候出现了很多warning：lib not found...dll, 原因是pyinstaller 没有办法识别到这些dll\n    解决办法：copy warning中一些dll文件的名字，再电脑中搜索到他们的路径！添加到环境变量里面\n    WARNING:lib not found:msmpi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_msmpi_ilp64.dll\n    WARNING:lib not found:impi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_intelmpi_lp64.dll\n    WARNING:lib not found:msmpi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_msmpi_lp64.dll\n    WARNING:lib not found:impi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_intelmpi_ilp64.dll\n    WARNING:lib not found:mpich2mpi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_mpich2_lp64.dll\n    WARNING:lib not found:mpich2mpi.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_blacs_mpich2_ilp64.dll\n    WARNING:lib not found:pgf90.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_pgi_thread.dll\n    WARNING:lib not found:pgf90rtl.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_pgi_thread.dll\n    WARNING:lib not found:pgc14.dll dependency of d:\\programdata\\anaconda3\\Library\\bin\\mkl_pgi_thread.dll\n    WARNING:lib not found:torch_python.dll dependency of d:\\programdata\\anaconda3\\lib\\site-packages\\torch\\_C.cp37-win_amd64.pyd\n\n9. 切换了虚拟环境打包，报DLL无法导入，实际是打包时还在使用旧的虚拟环境\n    解决： 打包时指定虚拟环境：-p。可参考： https://blog.csdn.net/u012219045/article/details/113612475\n\n10. DecodeEncodeError\n    解决： 检查执行路径中是否有中文，非Acsii码，换成英文路径。Python文件开头加 #-*-coding:utf-8-*-\n\n11. Pyqt5 打包后会出现错误:\"QThread:Destroyed while thread is still running\"\n    解决办法1：启动QThread使用了start(), 改为run() 可解决，但这样会卡主UI线程\n    解决办法2：依然使用start()，再追加一句 exec()。推荐这样！\n\n12. No module named 'sklearn.xx'\n    43852 WARNING: Hidden import \"sklearn.utils.sparsetools._graph_validation\" not found!\n    43854 WARNING: Hidden import \"sklearn.utils.sparsetools._graph_tools\" not found!\n    43866 WARNING: Hidden import \"sklearn.utils.lgamma\" not found!\n    No module named 'sklearn.utils._cython_blas'\n    No module named 'sklearn.neighbors._typedefs'\n    No module named 'sklearn.neighbors._quad_tree'\n    No module named 'sklearn.tree'\n    No module named 'sklearn.tree._utils'\n    解决：hiddenimports=['sklearn', 'sklearn.tree', 'sklearn.tree._utils', 'sklearn.neighbors._quad_tree',\n                       'sklearn.neighbors._typedefs', 'sklearn.utils._cython_blas',\n                       'sklearn.utils.sparsetools._graph_validation',\n                       'sklearn.utils.sparsetools._graph_tools', 'sklearn.utils.lgamma']\n13. No module named 'scipy.special.cython_special'\n   解决: 使用scipy==1.4.1 或者 --hidden-import scipy.special.cython_special\n\n14. No such file or directory: 'xxx\\\\librosa\\\\util\\\\example_data\\\\registry.txt'\n   解决: 使用--add-data或者直接拷贝librosa下的对应文件到dist。\n   \n15. fatal error:zmq.h:No such file or directory\n    解决: sudo apt install libzmq3-dev\n\n16. Error loading \"xxx\\torch\\lib\\caffe2_detectron_ops_gpu.dll\" or one of its dependencies\n    开始使用pytorch==1.6.0 torchvision==0.7.0 cudatoolkit=10.1，后来更换高版本torch1.7.0解决！\n    # pip install torch===1.7.0+cu110 torchvision===0.8.1+cu110 torchaudio===0.7.0 -f https://download.pytorch.org/whl/torch_stable.html\n\n17. unhandled exception \n    Error loading \"xxx\\torch\\lib\\caffe2_nvrtc.dll\" or one of its dependencies\n    开始使用pytorch降版本到1.8\n```\n\n","slug":"project_tool/pyinstaller-spec-problem","published":1,"updated":"2022-01-18T08:10:17.105Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bq006aast9250aeur4","content":"<blockquote>\n<p>在使用pyinstaller打包的过程中的坑点，记录一下<br>\n参考大佬：<a href=\"https://blog.csdn.net/u012219045/article/details/115397646\">https://blog.csdn.net/u012219045/article/details/115397646</a></p>\n</blockquote>\n<figure class=\"highlight vhdl\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vhdl\">在使用pyinstaller打包的整个过程中，遇到不少问题，在此总结一下。后面遇到会继续更新！<br><br><span class=\"hljs-number\">1</span>. 在<span class=\"hljs-number\">64</span>下可运行，不能在<span class=\"hljs-number\">32</span>位下运行<br>   解决：在<span class=\"hljs-number\">32</span>位系统下打包，可以参考 https://blog.csdn.net/u012219045/article/details/<span class=\"hljs-number\">115320619</span><br><br><span class=\"hljs-number\">2</span>. RecursionError:maximum recursion depth<br>   解决：在xxx.spec文件开始增加两行：<br><br>    import sys<br>    sys.setrecursionlimit(<span class=\"hljs-number\">5000</span>)<br>再执行打包：pyinstaller xxx.spec <br><br><span class=\"hljs-number\">3</span>. UnicodeDecodeError:<span class=\"hljs-symbol\">'utf</span>-<span class=\"hljs-number\">8</span>' codec can<span class=\"hljs-symbol\">'t</span> decode byte <span class=\"hljs-number\">0</span>xce <span class=\"hljs-keyword\">in</span> position <span class=\"hljs-number\">122</span>:invalid continuation byte<br>   解决：在你打包的命令行中先输入chcp <span class=\"hljs-number\">65001</span> 然后再输入打包命令。<br><br><span class=\"hljs-number\">4</span>. 使用了多进程 multiprocessing 模块<br>   解决：必须调用 multiprocessing.freeze_support()，直接在“<span class=\"hljs-keyword\">if</span> __name__ == '__main__'”之后调用<br><br><span class=\"hljs-number\">5</span>. 打包PyQt5闪退<br>   原因：可能未找到某个文件<br>   解决办法：<br>        <span class=\"hljs-number\">1</span>. 把需要读取的文件及其其他资源 都放到dist中。<br>        <span class=\"hljs-number\">2</span>. 打包成exe的话，需使用 <span class=\"hljs-comment\">--add-data 附加。可参考：https://blog.csdn.net/u012219045/article/details/114841287</span><br><br><span class=\"hljs-number\">6</span>. <span class=\"hljs-literal\">WARNING</span>:<span class=\"hljs-keyword\">file</span> already exists but should <span class=\"hljs-keyword\">not</span>：_C.cp37-win_amd64<br>   解决：报错内容可能不同，但都是xxx已存在，问题的原因是pyinstaller打包时多打了一次，所以会报已经存在了。<br>   这个解决方案就是把多余的去掉。在自动生成的xxx.spec中，在 a 和 PYZ 中间添加如下代码，去掉多余依赖项<br><br>    <span class=\"hljs-keyword\">for</span> d <span class=\"hljs-keyword\">in</span> a.datas:<br>        <span class=\"hljs-keyword\">if</span> '_C.cp37-win_amd64' <span class=\"hljs-keyword\">in</span> d[<span class=\"hljs-number\">0</span>]:<br>            a.datas.remove(d)<br>            break<br><span class=\"hljs-number\">7</span>. Hidden import <span class=\"hljs-string\">\"xxx\"</span>  <span class=\"hljs-keyword\">not</span> found!<br>    Hidden import <span class=\"hljs-string\">\"pkg_resources.markers\"</span> <span class=\"hljs-keyword\">not</span> found!<br>    Hidden import <span class=\"hljs-string\">\"pkg_resources.py2_warn\"</span> <span class=\"hljs-keyword\">not</span> found!<br>    Hidden import <span class=\"hljs-string\">\"MySQLdb\"</span> <span class=\"hljs-keyword\">not</span> found!<br>    Hidden import <span class=\"hljs-string\">\"sqlalchemy.sql.functions.func\"</span> <span class=\"hljs-keyword\">not</span> found!<br>    Hidden import <span class=\"hljs-string\">\"mx.DateTime\"</span> <span class=\"hljs-keyword\">not</span> found!<br>    解决： hiddenimports=[<span class=\"hljs-symbol\">'pkg_resources</span>.markers', <span class=\"hljs-symbol\">'pkg_resources</span>.py2_warn', '...']<br><br><span class=\"hljs-number\">8</span>.  打包的时候出现了很多<span class=\"hljs-literal\">warning</span>：lib <span class=\"hljs-keyword\">not</span> found...dll, 原因是pyinstaller 没有办法识别到这些dll<br>    解决办法：copy <span class=\"hljs-literal\">warning</span>中一些dll文件的名字，再电脑中搜索到他们的路径！添加到环境变量里面<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:msmpi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_msmpi_ilp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:impi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_intelmpi_lp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:msmpi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_msmpi_lp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:impi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_intelmpi_ilp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:mpich2mpi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_mpich2_lp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:mpich2mpi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_mpich2_ilp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:pgf90.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_pgi_thread.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:pgf90rtl.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_pgi_thread.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:pgc14.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_pgi_thread.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:torch_python.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\lib\\site-packages\\torch\\_C.cp37-win_amd64.pyd<br><br><span class=\"hljs-number\">9</span>. 切换了虚拟环境打包，报DLL无法导入，实际是打包时还在使用旧的虚拟环境<br>    解决： 打包时指定虚拟环境：-p。可参考： https://blog.csdn.net/u012219045/article/details/<span class=\"hljs-number\">113612475</span><br><br><span class=\"hljs-number\">10</span>. DecodeEncodeError<br>    解决： 检查执行路径中是否有中文，非Acsii码，换成英文路径。Python文件开头加 #-*-coding:utf-<span class=\"hljs-number\">8</span>-*-<br><br><span class=\"hljs-number\">11</span>. Pyqt5 打包后会出现错误:<span class=\"hljs-string\">\"QThread:Destroyed while thread is still running\"</span><br>    解决办法<span class=\"hljs-number\">1</span>：启动QThread使用了start(), 改为run() 可解决，但这样会卡主UI线程<br>    解决办法<span class=\"hljs-number\">2</span>：依然使用start()，再追加一句 exec()。推荐这样！<br><br><span class=\"hljs-number\">12</span>. No module named <span class=\"hljs-symbol\">'sklearn</span>.xx'<br>    <span class=\"hljs-number\">43852</span> <span class=\"hljs-literal\">WARNING</span>: Hidden import <span class=\"hljs-string\">\"sklearn.utils.sparsetools._graph_validation\"</span> <span class=\"hljs-keyword\">not</span> found!<br>    <span class=\"hljs-number\">43854</span> <span class=\"hljs-literal\">WARNING</span>: Hidden import <span class=\"hljs-string\">\"sklearn.utils.sparsetools._graph_tools\"</span> <span class=\"hljs-keyword\">not</span> found!<br>    <span class=\"hljs-number\">43866</span> <span class=\"hljs-literal\">WARNING</span>: Hidden import <span class=\"hljs-string\">\"sklearn.utils.lgamma\"</span> <span class=\"hljs-keyword\">not</span> found!<br>    No module named <span class=\"hljs-symbol\">'sklearn</span>.utils._cython_blas'<br>    No module named <span class=\"hljs-symbol\">'sklearn</span>.neighbors._typedefs'<br>    No module named <span class=\"hljs-symbol\">'sklearn</span>.neighbors._quad_tree'<br>    No module named <span class=\"hljs-symbol\">'sklearn</span>.tree'<br>    No module named <span class=\"hljs-symbol\">'sklearn</span>.tree._utils'<br>    解决：hiddenimports=[<span class=\"hljs-symbol\">'sklearn</span>', <span class=\"hljs-symbol\">'sklearn</span>.tree', <span class=\"hljs-symbol\">'sklearn</span>.tree._utils', <span class=\"hljs-symbol\">'sklearn</span>.neighbors._quad_tree',<br>                       <span class=\"hljs-symbol\">'sklearn</span>.neighbors._typedefs', <span class=\"hljs-symbol\">'sklearn</span>.utils._cython_blas',<br>                       <span class=\"hljs-symbol\">'sklearn</span>.utils.sparsetools._graph_validation',<br>                       <span class=\"hljs-symbol\">'sklearn</span>.utils.sparsetools._graph_tools', <span class=\"hljs-symbol\">'sklearn</span>.utils.lgamma']<br><span class=\"hljs-number\">13</span>. No module named <span class=\"hljs-symbol\">'scipy</span>.special.cython_special'<br>   解决: 使用scipy==<span class=\"hljs-number\">1.4</span>.<span class=\"hljs-number\">1</span> 或者 <span class=\"hljs-comment\">--hidden-import scipy.special.cython_special</span><br><br><span class=\"hljs-number\">14</span>. No such <span class=\"hljs-keyword\">file</span> <span class=\"hljs-keyword\">or</span> directory: <span class=\"hljs-symbol\">'xxx\\\\</span>librosa\\\\util\\\\example_data\\\\registry.txt'<br>   解决: 使用<span class=\"hljs-comment\">--add-data或者直接拷贝librosa下的对应文件到dist。</span><br>   <br><span class=\"hljs-number\">15</span>. fatal <span class=\"hljs-literal\">error</span>:zmq.h:No such <span class=\"hljs-keyword\">file</span> <span class=\"hljs-keyword\">or</span> directory<br>    解决: sudo apt install libzmq3-dev<br><br><span class=\"hljs-number\">16</span>. <span class=\"hljs-literal\">Error</span> loading <span class=\"hljs-string\">\"xxx\\torch\\lib\\caffe2_detectron_ops_gpu.dll\"</span> <span class=\"hljs-keyword\">or</span> one <span class=\"hljs-keyword\">of</span> its dependencies<br>    开始使用pytorch==<span class=\"hljs-number\">1.6</span>.<span class=\"hljs-number\">0</span> torchvision==<span class=\"hljs-number\">0.7</span>.<span class=\"hljs-number\">0</span> cudatoolkit=<span class=\"hljs-number\">10.1</span>，后来更换高版本torch1.<span class=\"hljs-number\">7.0</span>解决！<br>    # pip install torch===<span class=\"hljs-number\">1.7</span>.<span class=\"hljs-number\">0</span>+cu110 torchvision===<span class=\"hljs-number\">0.8</span>.<span class=\"hljs-number\">1</span>+cu110 torchaudio===<span class=\"hljs-number\">0.7</span>.<span class=\"hljs-number\">0</span> -f https://download.pytorch.org/whl/torch_stable.html<br><br><span class=\"hljs-number\">17</span>. unhandled exception <br>    <span class=\"hljs-literal\">Error</span> loading <span class=\"hljs-string\">\"xxx\\torch\\lib\\caffe2_nvrtc.dll\"</span> <span class=\"hljs-keyword\">or</span> one <span class=\"hljs-keyword\">of</span> its dependencies<br>    开始使用pytorch降版本到<span class=\"hljs-number\">1.8</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>在使用pyinstaller打包的过程中的坑点，记录一下<br>\n参考大佬：<a href=\"https://blog.csdn.net/u012219045/article/details/115397646\">https://blog.csdn.net/u012219045/article/details/115397646</a></p>\n</blockquote>\n<figure class=\"highlight vhdl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vhdl\">在使用pyinstaller打包的整个过程中，遇到不少问题，在此总结一下。后面遇到会继续更新！<br><br><span class=\"hljs-number\">1</span>. 在<span class=\"hljs-number\">64</span>下可运行，不能在<span class=\"hljs-number\">32</span>位下运行<br>   解决：在<span class=\"hljs-number\">32</span>位系统下打包，可以参考 https://blog.csdn.net/u012219045/article/details/<span class=\"hljs-number\">115320619</span><br><br><span class=\"hljs-number\">2</span>. RecursionError:maximum recursion depth<br>   解决：在xxx.spec文件开始增加两行：<br><br>    import sys<br>    sys.setrecursionlimit(<span class=\"hljs-number\">5000</span>)<br>再执行打包：pyinstaller xxx.spec <br><br><span class=\"hljs-number\">3</span>. UnicodeDecodeError:<span class=\"hljs-symbol\">&#x27;utf</span>-<span class=\"hljs-number\">8</span>&#x27; codec can<span class=\"hljs-symbol\">&#x27;t</span> decode byte <span class=\"hljs-number\">0</span>xce <span class=\"hljs-keyword\">in</span> position <span class=\"hljs-number\">122</span>:invalid continuation byte<br>   解决：在你打包的命令行中先输入chcp <span class=\"hljs-number\">65001</span> 然后再输入打包命令。<br><br><span class=\"hljs-number\">4</span>. 使用了多进程 multiprocessing 模块<br>   解决：必须调用 multiprocessing.freeze_support()，直接在“<span class=\"hljs-keyword\">if</span> __name__ == &#x27;__main__&#x27;”之后调用<br><br><span class=\"hljs-number\">5</span>. 打包PyQt5闪退<br>   原因：可能未找到某个文件<br>   解决办法：<br>        <span class=\"hljs-number\">1</span>. 把需要读取的文件及其其他资源 都放到dist中。<br>        <span class=\"hljs-number\">2</span>. 打包成exe的话，需使用 <span class=\"hljs-comment\">--add-data 附加。可参考：https://blog.csdn.net/u012219045/article/details/114841287</span><br><br><span class=\"hljs-number\">6</span>. <span class=\"hljs-literal\">WARNING</span>:<span class=\"hljs-keyword\">file</span> already exists but should <span class=\"hljs-keyword\">not</span>：_C.cp37-win_amd64<br>   解决：报错内容可能不同，但都是xxx已存在，问题的原因是pyinstaller打包时多打了一次，所以会报已经存在了。<br>   这个解决方案就是把多余的去掉。在自动生成的xxx.spec中，在 a 和 PYZ 中间添加如下代码，去掉多余依赖项<br><br>    <span class=\"hljs-keyword\">for</span> d <span class=\"hljs-keyword\">in</span> a.datas:<br>        <span class=\"hljs-keyword\">if</span> &#x27;_C.cp37-win_amd64&#x27; <span class=\"hljs-keyword\">in</span> d[<span class=\"hljs-number\">0</span>]:<br>            a.datas.remove(d)<br>            break<br><span class=\"hljs-number\">7</span>. Hidden import <span class=\"hljs-string\">&quot;xxx&quot;</span>  <span class=\"hljs-keyword\">not</span> found!<br>    Hidden import <span class=\"hljs-string\">&quot;pkg_resources.markers&quot;</span> <span class=\"hljs-keyword\">not</span> found!<br>    Hidden import <span class=\"hljs-string\">&quot;pkg_resources.py2_warn&quot;</span> <span class=\"hljs-keyword\">not</span> found!<br>    Hidden import <span class=\"hljs-string\">&quot;MySQLdb&quot;</span> <span class=\"hljs-keyword\">not</span> found!<br>    Hidden import <span class=\"hljs-string\">&quot;sqlalchemy.sql.functions.func&quot;</span> <span class=\"hljs-keyword\">not</span> found!<br>    Hidden import <span class=\"hljs-string\">&quot;mx.DateTime&quot;</span> <span class=\"hljs-keyword\">not</span> found!<br>    解决： hiddenimports=[<span class=\"hljs-symbol\">&#x27;pkg_resources</span>.markers&#x27;, <span class=\"hljs-symbol\">&#x27;pkg_resources</span>.py2_warn&#x27;, &#x27;...&#x27;]<br><br><span class=\"hljs-number\">8</span>.  打包的时候出现了很多<span class=\"hljs-literal\">warning</span>：lib <span class=\"hljs-keyword\">not</span> found...dll, 原因是pyinstaller 没有办法识别到这些dll<br>    解决办法：copy <span class=\"hljs-literal\">warning</span>中一些dll文件的名字，再电脑中搜索到他们的路径！添加到环境变量里面<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:msmpi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_msmpi_ilp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:impi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_intelmpi_lp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:msmpi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_msmpi_lp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:impi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_intelmpi_ilp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:mpich2mpi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_mpich2_lp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:mpich2mpi.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_blacs_mpich2_ilp64.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:pgf90.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_pgi_thread.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:pgf90rtl.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_pgi_thread.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:pgc14.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\<span class=\"hljs-keyword\">Library</span>\\bin\\mkl_pgi_thread.dll<br>    <span class=\"hljs-literal\">WARNING</span>:lib <span class=\"hljs-keyword\">not</span> found:torch_python.dll dependency <span class=\"hljs-keyword\">of</span> d:\\programdata\\anaconda3\\lib\\site-packages\\torch\\_C.cp37-win_amd64.pyd<br><br><span class=\"hljs-number\">9</span>. 切换了虚拟环境打包，报DLL无法导入，实际是打包时还在使用旧的虚拟环境<br>    解决： 打包时指定虚拟环境：-p。可参考： https://blog.csdn.net/u012219045/article/details/<span class=\"hljs-number\">113612475</span><br><br><span class=\"hljs-number\">10</span>. DecodeEncodeError<br>    解决： 检查执行路径中是否有中文，非Acsii码，换成英文路径。Python文件开头加 #-*-coding:utf-<span class=\"hljs-number\">8</span>-*-<br><br><span class=\"hljs-number\">11</span>. Pyqt5 打包后会出现错误:<span class=\"hljs-string\">&quot;QThread:Destroyed while thread is still running&quot;</span><br>    解决办法<span class=\"hljs-number\">1</span>：启动QThread使用了start(), 改为run() 可解决，但这样会卡主UI线程<br>    解决办法<span class=\"hljs-number\">2</span>：依然使用start()，再追加一句 exec()。推荐这样！<br><br><span class=\"hljs-number\">12</span>. No module named <span class=\"hljs-symbol\">&#x27;sklearn</span>.xx&#x27;<br>    <span class=\"hljs-number\">43852</span> <span class=\"hljs-literal\">WARNING</span>: Hidden import <span class=\"hljs-string\">&quot;sklearn.utils.sparsetools._graph_validation&quot;</span> <span class=\"hljs-keyword\">not</span> found!<br>    <span class=\"hljs-number\">43854</span> <span class=\"hljs-literal\">WARNING</span>: Hidden import <span class=\"hljs-string\">&quot;sklearn.utils.sparsetools._graph_tools&quot;</span> <span class=\"hljs-keyword\">not</span> found!<br>    <span class=\"hljs-number\">43866</span> <span class=\"hljs-literal\">WARNING</span>: Hidden import <span class=\"hljs-string\">&quot;sklearn.utils.lgamma&quot;</span> <span class=\"hljs-keyword\">not</span> found!<br>    No module named <span class=\"hljs-symbol\">&#x27;sklearn</span>.utils._cython_blas&#x27;<br>    No module named <span class=\"hljs-symbol\">&#x27;sklearn</span>.neighbors._typedefs&#x27;<br>    No module named <span class=\"hljs-symbol\">&#x27;sklearn</span>.neighbors._quad_tree&#x27;<br>    No module named <span class=\"hljs-symbol\">&#x27;sklearn</span>.tree&#x27;<br>    No module named <span class=\"hljs-symbol\">&#x27;sklearn</span>.tree._utils&#x27;<br>    解决：hiddenimports=[<span class=\"hljs-symbol\">&#x27;sklearn</span>&#x27;, <span class=\"hljs-symbol\">&#x27;sklearn</span>.tree&#x27;, <span class=\"hljs-symbol\">&#x27;sklearn</span>.tree._utils&#x27;, <span class=\"hljs-symbol\">&#x27;sklearn</span>.neighbors._quad_tree&#x27;,<br>                       <span class=\"hljs-symbol\">&#x27;sklearn</span>.neighbors._typedefs&#x27;, <span class=\"hljs-symbol\">&#x27;sklearn</span>.utils._cython_blas&#x27;,<br>                       <span class=\"hljs-symbol\">&#x27;sklearn</span>.utils.sparsetools._graph_validation&#x27;,<br>                       <span class=\"hljs-symbol\">&#x27;sklearn</span>.utils.sparsetools._graph_tools&#x27;, <span class=\"hljs-symbol\">&#x27;sklearn</span>.utils.lgamma&#x27;]<br><span class=\"hljs-number\">13</span>. No module named <span class=\"hljs-symbol\">&#x27;scipy</span>.special.cython_special&#x27;<br>   解决: 使用scipy==<span class=\"hljs-number\">1.4</span>.<span class=\"hljs-number\">1</span> 或者 <span class=\"hljs-comment\">--hidden-import scipy.special.cython_special</span><br><br><span class=\"hljs-number\">14</span>. No such <span class=\"hljs-keyword\">file</span> <span class=\"hljs-keyword\">or</span> directory: <span class=\"hljs-symbol\">&#x27;xxx\\\\</span>librosa\\\\util\\\\example_data\\\\registry.txt&#x27;<br>   解决: 使用<span class=\"hljs-comment\">--add-data或者直接拷贝librosa下的对应文件到dist。</span><br>   <br><span class=\"hljs-number\">15</span>. fatal <span class=\"hljs-literal\">error</span>:zmq.h:No such <span class=\"hljs-keyword\">file</span> <span class=\"hljs-keyword\">or</span> directory<br>    解决: sudo apt install libzmq3-dev<br><br><span class=\"hljs-number\">16</span>. <span class=\"hljs-literal\">Error</span> loading <span class=\"hljs-string\">&quot;xxx\\torch\\lib\\caffe2_detectron_ops_gpu.dll&quot;</span> <span class=\"hljs-keyword\">or</span> one <span class=\"hljs-keyword\">of</span> its dependencies<br>    开始使用pytorch==<span class=\"hljs-number\">1.6</span>.<span class=\"hljs-number\">0</span> torchvision==<span class=\"hljs-number\">0.7</span>.<span class=\"hljs-number\">0</span> cudatoolkit=<span class=\"hljs-number\">10.1</span>，后来更换高版本torch1.<span class=\"hljs-number\">7.0</span>解决！<br>    # pip install torch===<span class=\"hljs-number\">1.7</span>.<span class=\"hljs-number\">0</span>+cu110 torchvision===<span class=\"hljs-number\">0.8</span>.<span class=\"hljs-number\">1</span>+cu110 torchaudio===<span class=\"hljs-number\">0.7</span>.<span class=\"hljs-number\">0</span> -f https://download.pytorch.org/whl/torch_stable.html<br><br><span class=\"hljs-number\">17</span>. unhandled exception <br>    <span class=\"hljs-literal\">Error</span> loading <span class=\"hljs-string\">&quot;xxx\\torch\\lib\\caffe2_nvrtc.dll&quot;</span> <span class=\"hljs-keyword\">or</span> one <span class=\"hljs-keyword\">of</span> its dependencies<br>    开始使用pytorch降版本到<span class=\"hljs-number\">1.8</span><br></code></pre></td></tr></table></figure>\n"},{"title":"pyinstaller打包exe","date":"2021-09-26T12:11:18.000Z","_content":"\n> pyinstaller的作用是可以将python应用程序打包为独立的可执行文件，相对与同类工具而言，其优势在于可以和python配合使用，构建较小的可执行文件并且完全多平台，完全兼容性。\n\n> pyinstaller的主要目标是与第三方软件包兼容，因此在使用pyinstaller会将所有的外部包继承在pyinstaller本身中。\n\n## 安装\n直接从pypi安装pyinstaller：\n\n``` python\npip install pyinstaller\n```\n\n然后在自己的程序目录中运行\n\n``` python\npyinstaller yourprogram.py\n```\n就会生成dist文件夹，在dist文件夹下可以找到对应的exe文件。\n\n## 命令选项说明\nPyInstaller 支持如表所示的常用选项。\n\n| 选项 | 含义 |\n|:----:|:----:|\n| -h，--help                  | 查看该模块的帮助信息                                         |\n| -F，-onefile                | 产生单个的可执行文件                                         |\n| -D，--onedir                | 产生一个目录（包含多个文件）作为可执行程序（默认）               |\n| -a，--ascii                 | 不包含 Unicode 字符集支持                                    |\n| -d，--debug                 | 产生 debug 版本的可执行文件                                  |\n| -w，--windowed，--noconsolc | 指定程序运行时不显示命令行窗口（仅对 Windows 有效）          |\n| -c，--nowindowed，--console | 指定使用命令行窗口运行程序（仅对 Windows 有效）              |\n| -o DIR，--out=DIR           | 指定 spec 文件的生成目录。如果没有指定，则默认使用当前目录来生成 spec 文件 |\n| -p DIR，--path=DIR          | 设置 Python 导入模块的路径（和设置 PYTHONPATH 环境变量的作用相似）。也可使用路径分隔符（Windows 使用分号，Linux 使用冒号）来分隔多个路径 |\n| -n NAME，--name=NAME        | 指定项目（产生的 spec）名字。如果省略该选项，那么第一个脚本的主文件名将作为 spec 的名字 |\n\n在此表列出的只是 PyInstaller 模块所支持的常用选项，如果需要了解 PyInstaller 选项的详细信息，则可通过 pyinstaller -h 或者--help查看帮助\n\n``` python\npyinstaller --help\n```\n\n## 使用pyinstaller\n\n- 打包成一个单一可执行文件\n\n  ```python\n  pyinstaller -F <options> test.py\n  ```\n\n- 打包成一个文件夹\n\n  ```\n  pyinstaller --onefile/-D <options> test.py （默认）\n  ```\n\n默认情况下打包会在当前目录下生成dist和build文件夹以及.spec文件，dist中即打包出来的可执行文件目录，build文件夹下为构建过程临时文件目录，.spec为打包的配置文件。\n\n### 各自的优缺点\n\n- 启动时间\n\n  单一可执行文件比文件夹的启动时间要长很多，因为当程序运行时，单一的可执行文件需要解压程序的第三方依赖文件到临时文件夹，会耗费一定的不必要时间。\n\n- 文件结构\n\n  单一可执行文件的文件结构和工程目录是一样的，其路径与工程目录的效果是一样的，但是生成文件夹就不一样了，若程序中包含相对路径，这个相对路径是基于该文件夹目录的。\n\n## spec文件\n\n.spec文件类似于cmake的.makefile文件，都是用于`控制编译构建过程`的配置文件。正常使用实际上不需要管spec文件的，但是下面几种情况需要修改spec文件：\n\n- 需要打包资源文件\n\n- 需要include一些pyinstaller不知道的run-time库\n\n- 为可执行文件添加run-time选项\n\n- 多程序打包\n\n后面可以直接通过.spec文件来打包\n\n```python\npyinstaller <options> test.spec\n```\n\n当通过spec文件来生成app文件时只有下面参数是有用的：\n\n-  `-upx-dir`  Path to UPX utility (default: search the execution path)\n-  `-distpath`   Where to put the bundled app (default: .\\dist)\n-  `-y –noconfirm`  Replace output directory (default: SPECPATH\\dist\\SPECNAME) without asking for confirmation\n-   `-a –ascii` Do not include unicode encoding support (default: included if available)\n\n","source":"_posts/project_tool/pyinstaller.md","raw":"---\ntitle: pyinstaller打包exe\ntags: [项目打包]\ncategories: [工具,pyinstaller]\ndate: 2021-09-26 20:11:18\n---\n\n> pyinstaller的作用是可以将python应用程序打包为独立的可执行文件，相对与同类工具而言，其优势在于可以和python配合使用，构建较小的可执行文件并且完全多平台，完全兼容性。\n\n> pyinstaller的主要目标是与第三方软件包兼容，因此在使用pyinstaller会将所有的外部包继承在pyinstaller本身中。\n\n## 安装\n直接从pypi安装pyinstaller：\n\n``` python\npip install pyinstaller\n```\n\n然后在自己的程序目录中运行\n\n``` python\npyinstaller yourprogram.py\n```\n就会生成dist文件夹，在dist文件夹下可以找到对应的exe文件。\n\n## 命令选项说明\nPyInstaller 支持如表所示的常用选项。\n\n| 选项 | 含义 |\n|:----:|:----:|\n| -h，--help                  | 查看该模块的帮助信息                                         |\n| -F，-onefile                | 产生单个的可执行文件                                         |\n| -D，--onedir                | 产生一个目录（包含多个文件）作为可执行程序（默认）               |\n| -a，--ascii                 | 不包含 Unicode 字符集支持                                    |\n| -d，--debug                 | 产生 debug 版本的可执行文件                                  |\n| -w，--windowed，--noconsolc | 指定程序运行时不显示命令行窗口（仅对 Windows 有效）          |\n| -c，--nowindowed，--console | 指定使用命令行窗口运行程序（仅对 Windows 有效）              |\n| -o DIR，--out=DIR           | 指定 spec 文件的生成目录。如果没有指定，则默认使用当前目录来生成 spec 文件 |\n| -p DIR，--path=DIR          | 设置 Python 导入模块的路径（和设置 PYTHONPATH 环境变量的作用相似）。也可使用路径分隔符（Windows 使用分号，Linux 使用冒号）来分隔多个路径 |\n| -n NAME，--name=NAME        | 指定项目（产生的 spec）名字。如果省略该选项，那么第一个脚本的主文件名将作为 spec 的名字 |\n\n在此表列出的只是 PyInstaller 模块所支持的常用选项，如果需要了解 PyInstaller 选项的详细信息，则可通过 pyinstaller -h 或者--help查看帮助\n\n``` python\npyinstaller --help\n```\n\n## 使用pyinstaller\n\n- 打包成一个单一可执行文件\n\n  ```python\n  pyinstaller -F <options> test.py\n  ```\n\n- 打包成一个文件夹\n\n  ```\n  pyinstaller --onefile/-D <options> test.py （默认）\n  ```\n\n默认情况下打包会在当前目录下生成dist和build文件夹以及.spec文件，dist中即打包出来的可执行文件目录，build文件夹下为构建过程临时文件目录，.spec为打包的配置文件。\n\n### 各自的优缺点\n\n- 启动时间\n\n  单一可执行文件比文件夹的启动时间要长很多，因为当程序运行时，单一的可执行文件需要解压程序的第三方依赖文件到临时文件夹，会耗费一定的不必要时间。\n\n- 文件结构\n\n  单一可执行文件的文件结构和工程目录是一样的，其路径与工程目录的效果是一样的，但是生成文件夹就不一样了，若程序中包含相对路径，这个相对路径是基于该文件夹目录的。\n\n## spec文件\n\n.spec文件类似于cmake的.makefile文件，都是用于`控制编译构建过程`的配置文件。正常使用实际上不需要管spec文件的，但是下面几种情况需要修改spec文件：\n\n- 需要打包资源文件\n\n- 需要include一些pyinstaller不知道的run-time库\n\n- 为可执行文件添加run-time选项\n\n- 多程序打包\n\n后面可以直接通过.spec文件来打包\n\n```python\npyinstaller <options> test.spec\n```\n\n当通过spec文件来生成app文件时只有下面参数是有用的：\n\n-  `-upx-dir`  Path to UPX utility (default: search the execution path)\n-  `-distpath`   Where to put the bundled app (default: .\\dist)\n-  `-y –noconfirm`  Replace output directory (default: SPECPATH\\dist\\SPECNAME) without asking for confirmation\n-   `-a –ascii` Do not include unicode encoding support (default: included if available)\n\n","slug":"project_tool/pyinstaller","published":1,"updated":"2022-01-18T08:10:17.105Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bs006dast96it4ao11","content":"<blockquote>\n<p>pyinstaller的作用是可以将python应用程序打包为独立的可执行文件，相对与同类工具而言，其优势在于可以和python配合使用，构建较小的可执行文件并且完全多平台，完全兼容性。</p>\n</blockquote>\n<blockquote>\n<p>pyinstaller的主要目标是与第三方软件包兼容，因此在使用pyinstaller会将所有的外部包继承在pyinstaller本身中。</p>\n</blockquote>\n<h2 id=\"安装\">安装</h2>\n<p>直接从pypi安装pyinstaller：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pip install pyinstaller<br></code></pre></td></tr></tbody></table></figure>\n<p>然后在自己的程序目录中运行</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pyinstaller yourprogram.py<br></code></pre></td></tr></tbody></table></figure>\n<p>就会生成dist文件夹，在dist文件夹下可以找到对应的exe文件。</p>\n<h2 id=\"命令选项说明\">命令选项说明</h2>\n<p>PyInstaller 支持如表所示的常用选项。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">选项</th>\n<th style=\"text-align:center\">含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">-h，–help</td>\n<td style=\"text-align:center\">查看该模块的帮助信息</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-F，-onefile</td>\n<td style=\"text-align:center\">产生单个的可执行文件</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-D，–onedir</td>\n<td style=\"text-align:center\">产生一个目录（包含多个文件）作为可执行程序（默认）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-a，–ascii</td>\n<td style=\"text-align:center\">不包含 Unicode 字符集支持</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-d，–debug</td>\n<td style=\"text-align:center\">产生 debug 版本的可执行文件</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-w，–windowed，–noconsolc</td>\n<td style=\"text-align:center\">指定程序运行时不显示命令行窗口（仅对 Windows 有效）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-c，–nowindowed，–console</td>\n<td style=\"text-align:center\">指定使用命令行窗口运行程序（仅对 Windows 有效）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-o DIR，–out=DIR</td>\n<td style=\"text-align:center\">指定 spec 文件的生成目录。如果没有指定，则默认使用当前目录来生成 spec 文件</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-p DIR，–path=DIR</td>\n<td style=\"text-align:center\">设置 Python 导入模块的路径（和设置 PYTHONPATH 环境变量的作用相似）。也可使用路径分隔符（Windows 使用分号，Linux 使用冒号）来分隔多个路径</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-n NAME，–name=NAME</td>\n<td style=\"text-align:center\">指定项目（产生的 spec）名字。如果省略该选项，那么第一个脚本的主文件名将作为 spec 的名字</td>\n</tr>\n</tbody>\n</table>\n<p>在此表列出的只是 PyInstaller 模块所支持的常用选项，如果需要了解 PyInstaller 选项的详细信息，则可通过 pyinstaller -h 或者–help查看帮助</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pyinstaller --<span class=\"hljs-built_in\">help</span><br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"使用pyinstaller\">使用pyinstaller</h2>\n<ul>\n<li>\n<p>打包成一个单一可执行文件</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pyinstaller -F &lt;options&gt; test.py<br></code></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>打包成一个文件夹</p>\n<figure class=\"highlight vim\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vim\">pyinstaller --onefile/-D <span class=\"hljs-symbol\">&lt;options&gt;</span> test.<span class=\"hljs-keyword\">py</span> （默认）<br></code></pre></td></tr></tbody></table></figure>\n</li>\n</ul>\n<p>默认情况下打包会在当前目录下生成dist和build文件夹以及.spec文件，dist中即打包出来的可执行文件目录，build文件夹下为构建过程临时文件目录，.spec为打包的配置文件。</p>\n<h3 id=\"各自的优缺点\">各自的优缺点</h3>\n<ul>\n<li>\n<p>启动时间</p>\n<p>单一可执行文件比文件夹的启动时间要长很多，因为当程序运行时，单一的可执行文件需要解压程序的第三方依赖文件到临时文件夹，会耗费一定的不必要时间。</p>\n</li>\n<li>\n<p>文件结构</p>\n<p>单一可执行文件的文件结构和工程目录是一样的，其路径与工程目录的效果是一样的，但是生成文件夹就不一样了，若程序中包含相对路径，这个相对路径是基于该文件夹目录的。</p>\n</li>\n</ul>\n<h2 id=\"spec文件\">spec文件</h2>\n<p>.spec文件类似于cmake的.makefile文件，都是用于<code>控制编译构建过程</code>的配置文件。正常使用实际上不需要管spec文件的，但是下面几种情况需要修改spec文件：</p>\n<ul>\n<li>\n<p>需要打包资源文件</p>\n</li>\n<li>\n<p>需要include一些pyinstaller不知道的run-time库</p>\n</li>\n<li>\n<p>为可执行文件添加run-time选项</p>\n</li>\n<li>\n<p>多程序打包</p>\n</li>\n</ul>\n<p>后面可以直接通过.spec文件来打包</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pyinstaller &lt;options&gt; test.spec<br></code></pre></td></tr></tbody></table></figure>\n<p>当通过spec文件来生成app文件时只有下面参数是有用的：</p>\n<ul>\n<li><code>-upx-dir</code>  Path to UPX utility (default: search the execution path)</li>\n<li><code>-distpath</code>   Where to put the bundled app (default: .\\dist)</li>\n<li><code>-y –noconfirm</code>  Replace output directory (default: SPECPATH\\dist\\SPECNAME) without asking for confirmation</li>\n<li><code>-a –ascii</code> Do not include unicode encoding support (default: included if available)</li>\n</ul>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>pyinstaller的作用是可以将python应用程序打包为独立的可执行文件，相对与同类工具而言，其优势在于可以和python配合使用，构建较小的可执行文件并且完全多平台，完全兼容性。</p>\n</blockquote>\n<blockquote>\n<p>pyinstaller的主要目标是与第三方软件包兼容，因此在使用pyinstaller会将所有的外部包继承在pyinstaller本身中。</p>\n</blockquote>\n<h2 id=\"安装\">安装</h2>\n<p>直接从pypi安装pyinstaller：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pip install pyinstaller<br></code></pre></td></tr></table></figure>\n<p>然后在自己的程序目录中运行</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pyinstaller yourprogram.py<br></code></pre></td></tr></table></figure>\n<p>就会生成dist文件夹，在dist文件夹下可以找到对应的exe文件。</p>\n<h2 id=\"命令选项说明\">命令选项说明</h2>\n<p>PyInstaller 支持如表所示的常用选项。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">选项</th>\n<th style=\"text-align:center\">含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">-h，–help</td>\n<td style=\"text-align:center\">查看该模块的帮助信息</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-F，-onefile</td>\n<td style=\"text-align:center\">产生单个的可执行文件</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-D，–onedir</td>\n<td style=\"text-align:center\">产生一个目录（包含多个文件）作为可执行程序（默认）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-a，–ascii</td>\n<td style=\"text-align:center\">不包含 Unicode 字符集支持</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-d，–debug</td>\n<td style=\"text-align:center\">产生 debug 版本的可执行文件</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-w，–windowed，–noconsolc</td>\n<td style=\"text-align:center\">指定程序运行时不显示命令行窗口（仅对 Windows 有效）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-c，–nowindowed，–console</td>\n<td style=\"text-align:center\">指定使用命令行窗口运行程序（仅对 Windows 有效）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-o DIR，–out=DIR</td>\n<td style=\"text-align:center\">指定 spec 文件的生成目录。如果没有指定，则默认使用当前目录来生成 spec 文件</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-p DIR，–path=DIR</td>\n<td style=\"text-align:center\">设置 Python 导入模块的路径（和设置 PYTHONPATH 环境变量的作用相似）。也可使用路径分隔符（Windows 使用分号，Linux 使用冒号）来分隔多个路径</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-n NAME，–name=NAME</td>\n<td style=\"text-align:center\">指定项目（产生的 spec）名字。如果省略该选项，那么第一个脚本的主文件名将作为 spec 的名字</td>\n</tr>\n</tbody>\n</table>\n<p>在此表列出的只是 PyInstaller 模块所支持的常用选项，如果需要了解 PyInstaller 选项的详细信息，则可通过 pyinstaller -h 或者–help查看帮助</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pyinstaller --<span class=\"hljs-built_in\">help</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"使用pyinstaller\">使用pyinstaller</h2>\n<ul>\n<li>\n<p>打包成一个单一可执行文件</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pyinstaller -F &lt;options&gt; test.py<br></code></pre></td></tr></table></figure>\n</li>\n<li>\n<p>打包成一个文件夹</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vim\">pyinstaller --onefile/-D <span class=\"hljs-symbol\">&lt;options&gt;</span> test.<span class=\"hljs-keyword\">py</span> （默认）<br></code></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>默认情况下打包会在当前目录下生成dist和build文件夹以及.spec文件，dist中即打包出来的可执行文件目录，build文件夹下为构建过程临时文件目录，.spec为打包的配置文件。</p>\n<h3 id=\"各自的优缺点\">各自的优缺点</h3>\n<ul>\n<li>\n<p>启动时间</p>\n<p>单一可执行文件比文件夹的启动时间要长很多，因为当程序运行时，单一的可执行文件需要解压程序的第三方依赖文件到临时文件夹，会耗费一定的不必要时间。</p>\n</li>\n<li>\n<p>文件结构</p>\n<p>单一可执行文件的文件结构和工程目录是一样的，其路径与工程目录的效果是一样的，但是生成文件夹就不一样了，若程序中包含相对路径，这个相对路径是基于该文件夹目录的。</p>\n</li>\n</ul>\n<h2 id=\"spec文件\">spec文件</h2>\n<p>.spec文件类似于cmake的.makefile文件，都是用于<code>控制编译构建过程</code>的配置文件。正常使用实际上不需要管spec文件的，但是下面几种情况需要修改spec文件：</p>\n<ul>\n<li>\n<p>需要打包资源文件</p>\n</li>\n<li>\n<p>需要include一些pyinstaller不知道的run-time库</p>\n</li>\n<li>\n<p>为可执行文件添加run-time选项</p>\n</li>\n<li>\n<p>多程序打包</p>\n</li>\n</ul>\n<p>后面可以直接通过.spec文件来打包</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pyinstaller &lt;options&gt; test.spec<br></code></pre></td></tr></table></figure>\n<p>当通过spec文件来生成app文件时只有下面参数是有用的：</p>\n<ul>\n<li><code>-upx-dir</code>  Path to UPX utility (default: search the execution path)</li>\n<li><code>-distpath</code>   Where to put the bundled app (default: .\\dist)</li>\n<li><code>-y –noconfirm</code>  Replace output directory (default: SPECPATH\\dist\\SPECNAME) without asking for confirmation</li>\n<li><code>-a –ascii</code> Do not include unicode encoding support (default: included if available)</li>\n</ul>\n"},{"title":"获得电脑的ppi","date":"2021-10-26T06:02:47.000Z","_content":"\n> 获取电脑的分辨率，物理尺寸，PPI\n> 首先介绍一下PPI和DPI：\n> PPI（Pixels Per Inch）每一英寸长度上有多少像素点；计算方式可以使用像素点除以屏幕尺寸。\n> 分辨率DPI（Dots Per Inch）每一英寸有多少点，这里的点是可以改变的，可以是 1Dot = 1Pixel，也可以是 1Dot = N Pixel。在电脑里，分辩率是可以调节的，这里用的就是Dot ，密度用DPI描述；只有当使用屏幕最大分辩率的时候（即 1Dot = 1Pixel），这个时候 DPI = PPI。\n\n  搜集了很多代码和方法，最后找到一个比较精准的方法是使用Tkinter。\n- 可以得到显示屏的尺寸，获取以毫米为单位宽高（winfo_screenmmheight()，winfo_screenmmwidth()），获取显示屏的pixels数目（winfo_screenheight()，winfo_screenwidth()）。\n\n```python\n# tk获取屏幕的分辨率和尺寸\nfrom tkinter import Tk\n# creating tkinter window\nbase = Tk()\n#screen's length and width in pixels and mm\nlength_1= base.winfo_screenheight()\nwidth_1= base.winfo_screenwidth()\nlength_2 = base.winfo_screenmmheight()\nwidth_2 = base.winfo_screenmmwidth()\n#screen Depth\nscreendepth = base.winfo_screendepth()\nprint(\"width x length (in pixels) =\",(width_1,length_1))\nprint(\"width x length (in mm) =\", (width_2, length_2))\nwidth_ppn = width_1/width_2\nlength_ppn = length_1/length_2\nppn = round((width_ppn+length_ppn)/2,2)\nprint(width_1/width_2,length_1/length_2,ppn)\n\n```\n- 使用win32库中的分辨率方法win32print.GetDeviceCaps()，缩放后的分辨率GetSystemMetrics。\n\n```python\n## 获取分辨率\nfrom win32 import win32api, win32gui, win32print\nfrom win32.lib import win32con\n\nfrom win32.win32api import GetSystemMetrics\n\n\ndef get_real_resolution():\n    \"\"\"获取真实的分辨率\"\"\"\n    hDC = win32gui.GetDC(0)\n    # 横向分辨率\n    w = win32print.GetDeviceCaps(hDC, win32con.DESKTOPHORZRES)\n    # 纵向分辨率\n    h = win32print.GetDeviceCaps(hDC, win32con.DESKTOPVERTRES)\n    return w, h\n\n\ndef get_screen_size():\n    \"\"\"获取缩放后的分辨率\"\"\"\n    w = GetSystemMetrics (0)\n    h = GetSystemMetrics (1)\n    return w, h\n\nreal_resolution = get_real_resolution()\nscreen_size = get_screen_size()\nprint(real_resolution)\nprint(screen_size)\n\nscreen_scale_rate = round(real_resolution[0] / screen_size[0], 2)\nprint(screen_scale_rate)\n```\n- 多屏的分辨率获取的方法。\n\n\n```python\n#屏幕的尺寸\n# -*- coding: utf-8 -*-\n\"\"\"\n功能：识别两块显示器各自的分辨率\n\"\"\"\n\"\"\"模块导入\"\"\"\nfrom win32api import GetSystemMetrics\nfrom win32con import SM_CMONITORS, SM_CXVIRTUALSCREEN, SM_CYVIRTUALSCREEN\n\ndef Display_Detection():\n    # 显示器数量检测\n    MonitorNumber = GetSystemMetrics(SM_CMONITORS)\n    # 主屏幕尺寸检测\n    MajorScreenWidth = GetSystemMetrics(0)  # 主屏幕宽\n    MajorScreenHeight = GetSystemMetrics(1)  # 主屏幕高\n    # print(\"主屏幕尺寸：\", GetSystemMetrics(0), \"*\", GetSystemMetrics(1))\n    # 屏幕最大尺寸\n    aScreenWidth = GetSystemMetrics(SM_CXVIRTUALSCREEN)  # 屏幕最大宽度\n    aScreenHeight = GetSystemMetrics(SM_CYVIRTUALSCREEN)  # 屏幕最大高度\n    AllScreen=(aScreenWidth, aScreenHeight)\n    # print(\"屏幕总尺寸:\", aScreenWidth, \"*\", aScreenHeight)\n    # 当前主流的分辨率基数是宽，偶数是高\n    ResolvingPower = [1280, 720, 1920, 1080, 2560, 1440, 3840, 2160, 4096, 2160, 7680, 4320]\n\n    if MonitorNumber > 1:  # 屏幕数量判断print(MonitorNumber)就可以知道有多少块屏幕\n        SecondaryScreenWidth = aScreenWidth - MajorScreenWidth  # 副屏宽=总屏幕宽-当前屏幕宽\n        print(\"副屏宽\",SecondaryScreenWidth)\n\n        # 主屏横竖屏检测\n        if GetSystemMetrics(0) > GetSystemMetrics(1):\n            MianScreen = (GetSystemMetrics(0), GetSystemMetrics(1))\n            print(\"主屏(横屏)尺寸：\", GetSystemMetrics(0), \"*\", GetSystemMetrics(1))\n        else:\n            MianScreen = (GetSystemMetrics(0), GetSystemMetrics(1))\n            print(\"主屏(竖屏)尺寸：\", GetSystemMetrics(0), \"*\", GetSystemMetrics(1))\n\n        # 横屏状态\n        for i in range(0, len(ResolvingPower) - 1, 2):\n            # print(\"i\",ResolvingPower[i])\n            if SecondaryScreenWidth == ResolvingPower[i]:\n                SecondaryScreen = (ResolvingPower[i], ResolvingPower[i + 1])\n                print(\"副屏(横屏)尺寸：\", ResolvingPower[i], ResolvingPower[i + 1])\n                # return \"副屏(竖屏)尺寸：\",SecondaryScreen\n                break\n        # 竖屏状态\n        for i in range(1, len(ResolvingPower) - 1, 2):\n            # print(\"i\",ResolvingPower[i])\n            if SecondaryScreenWidth == ResolvingPower[i]:\n                SecondaryScreen = (ResolvingPower[i], ResolvingPower[i + 1])\n                print(\"副屏(竖屏)尺寸：\", ResolvingPower[i], ResolvingPower[i - 1])\n                # return \"副屏(竖屏)尺寸\",SecondaryScreen\n                break\n    return MonitorNumber,AllScreen,MianScreen,SecondaryScreen\n\n#调用\na=Display_Detection()\nprint(a)#a可以任意遍历其中的内容a[0]代表屏幕数量等等...\n\n主屏(横屏)尺寸： 1920 * 1080\n副屏(竖屏)尺寸： 1440 2560\n(2, (3360, 1080), (1920, 1080), (1440, 3840))\n```","source":"_posts/python/getppi.md","raw":"---\ntitle: 获得电脑的ppi\ntags: python\ncategories: python\ndate: 2021-10-26 14:02:47\n---\n\n> 获取电脑的分辨率，物理尺寸，PPI\n> 首先介绍一下PPI和DPI：\n> PPI（Pixels Per Inch）每一英寸长度上有多少像素点；计算方式可以使用像素点除以屏幕尺寸。\n> 分辨率DPI（Dots Per Inch）每一英寸有多少点，这里的点是可以改变的，可以是 1Dot = 1Pixel，也可以是 1Dot = N Pixel。在电脑里，分辩率是可以调节的，这里用的就是Dot ，密度用DPI描述；只有当使用屏幕最大分辩率的时候（即 1Dot = 1Pixel），这个时候 DPI = PPI。\n\n  搜集了很多代码和方法，最后找到一个比较精准的方法是使用Tkinter。\n- 可以得到显示屏的尺寸，获取以毫米为单位宽高（winfo_screenmmheight()，winfo_screenmmwidth()），获取显示屏的pixels数目（winfo_screenheight()，winfo_screenwidth()）。\n\n```python\n# tk获取屏幕的分辨率和尺寸\nfrom tkinter import Tk\n# creating tkinter window\nbase = Tk()\n#screen's length and width in pixels and mm\nlength_1= base.winfo_screenheight()\nwidth_1= base.winfo_screenwidth()\nlength_2 = base.winfo_screenmmheight()\nwidth_2 = base.winfo_screenmmwidth()\n#screen Depth\nscreendepth = base.winfo_screendepth()\nprint(\"width x length (in pixels) =\",(width_1,length_1))\nprint(\"width x length (in mm) =\", (width_2, length_2))\nwidth_ppn = width_1/width_2\nlength_ppn = length_1/length_2\nppn = round((width_ppn+length_ppn)/2,2)\nprint(width_1/width_2,length_1/length_2,ppn)\n\n```\n- 使用win32库中的分辨率方法win32print.GetDeviceCaps()，缩放后的分辨率GetSystemMetrics。\n\n```python\n## 获取分辨率\nfrom win32 import win32api, win32gui, win32print\nfrom win32.lib import win32con\n\nfrom win32.win32api import GetSystemMetrics\n\n\ndef get_real_resolution():\n    \"\"\"获取真实的分辨率\"\"\"\n    hDC = win32gui.GetDC(0)\n    # 横向分辨率\n    w = win32print.GetDeviceCaps(hDC, win32con.DESKTOPHORZRES)\n    # 纵向分辨率\n    h = win32print.GetDeviceCaps(hDC, win32con.DESKTOPVERTRES)\n    return w, h\n\n\ndef get_screen_size():\n    \"\"\"获取缩放后的分辨率\"\"\"\n    w = GetSystemMetrics (0)\n    h = GetSystemMetrics (1)\n    return w, h\n\nreal_resolution = get_real_resolution()\nscreen_size = get_screen_size()\nprint(real_resolution)\nprint(screen_size)\n\nscreen_scale_rate = round(real_resolution[0] / screen_size[0], 2)\nprint(screen_scale_rate)\n```\n- 多屏的分辨率获取的方法。\n\n\n```python\n#屏幕的尺寸\n# -*- coding: utf-8 -*-\n\"\"\"\n功能：识别两块显示器各自的分辨率\n\"\"\"\n\"\"\"模块导入\"\"\"\nfrom win32api import GetSystemMetrics\nfrom win32con import SM_CMONITORS, SM_CXVIRTUALSCREEN, SM_CYVIRTUALSCREEN\n\ndef Display_Detection():\n    # 显示器数量检测\n    MonitorNumber = GetSystemMetrics(SM_CMONITORS)\n    # 主屏幕尺寸检测\n    MajorScreenWidth = GetSystemMetrics(0)  # 主屏幕宽\n    MajorScreenHeight = GetSystemMetrics(1)  # 主屏幕高\n    # print(\"主屏幕尺寸：\", GetSystemMetrics(0), \"*\", GetSystemMetrics(1))\n    # 屏幕最大尺寸\n    aScreenWidth = GetSystemMetrics(SM_CXVIRTUALSCREEN)  # 屏幕最大宽度\n    aScreenHeight = GetSystemMetrics(SM_CYVIRTUALSCREEN)  # 屏幕最大高度\n    AllScreen=(aScreenWidth, aScreenHeight)\n    # print(\"屏幕总尺寸:\", aScreenWidth, \"*\", aScreenHeight)\n    # 当前主流的分辨率基数是宽，偶数是高\n    ResolvingPower = [1280, 720, 1920, 1080, 2560, 1440, 3840, 2160, 4096, 2160, 7680, 4320]\n\n    if MonitorNumber > 1:  # 屏幕数量判断print(MonitorNumber)就可以知道有多少块屏幕\n        SecondaryScreenWidth = aScreenWidth - MajorScreenWidth  # 副屏宽=总屏幕宽-当前屏幕宽\n        print(\"副屏宽\",SecondaryScreenWidth)\n\n        # 主屏横竖屏检测\n        if GetSystemMetrics(0) > GetSystemMetrics(1):\n            MianScreen = (GetSystemMetrics(0), GetSystemMetrics(1))\n            print(\"主屏(横屏)尺寸：\", GetSystemMetrics(0), \"*\", GetSystemMetrics(1))\n        else:\n            MianScreen = (GetSystemMetrics(0), GetSystemMetrics(1))\n            print(\"主屏(竖屏)尺寸：\", GetSystemMetrics(0), \"*\", GetSystemMetrics(1))\n\n        # 横屏状态\n        for i in range(0, len(ResolvingPower) - 1, 2):\n            # print(\"i\",ResolvingPower[i])\n            if SecondaryScreenWidth == ResolvingPower[i]:\n                SecondaryScreen = (ResolvingPower[i], ResolvingPower[i + 1])\n                print(\"副屏(横屏)尺寸：\", ResolvingPower[i], ResolvingPower[i + 1])\n                # return \"副屏(竖屏)尺寸：\",SecondaryScreen\n                break\n        # 竖屏状态\n        for i in range(1, len(ResolvingPower) - 1, 2):\n            # print(\"i\",ResolvingPower[i])\n            if SecondaryScreenWidth == ResolvingPower[i]:\n                SecondaryScreen = (ResolvingPower[i], ResolvingPower[i + 1])\n                print(\"副屏(竖屏)尺寸：\", ResolvingPower[i], ResolvingPower[i - 1])\n                # return \"副屏(竖屏)尺寸\",SecondaryScreen\n                break\n    return MonitorNumber,AllScreen,MianScreen,SecondaryScreen\n\n#调用\na=Display_Detection()\nprint(a)#a可以任意遍历其中的内容a[0]代表屏幕数量等等...\n\n主屏(横屏)尺寸： 1920 * 1080\n副屏(竖屏)尺寸： 1440 2560\n(2, (3360, 1080), (1920, 1080), (1440, 3840))\n```","slug":"python/getppi","published":1,"updated":"2022-01-18T08:10:17.109Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bu006east90zv33c6f","content":"<blockquote>\n<p>获取电脑的分辨率，物理尺寸，PPI<br>\n首先介绍一下PPI和DPI：<br>\nPPI（Pixels Per Inch）每一英寸长度上有多少像素点；计算方式可以使用像素点除以屏幕尺寸。<br>\n分辨率DPI（Dots Per Inch）每一英寸有多少点，这里的点是可以改变的，可以是 1Dot = 1Pixel，也可以是 1Dot = N Pixel。在电脑里，分辩率是可以调节的，这里用的就是Dot ，密度用DPI描述；只有当使用屏幕最大分辩率的时候（即 1Dot = 1Pixel），这个时候 DPI = PPI。</p>\n</blockquote>\n<p>搜集了很多代码和方法，最后找到一个比较精准的方法是使用Tkinter。</p>\n<ul>\n<li>可以得到显示屏的尺寸，获取以毫米为单位宽高（winfo_screenmmheight()，winfo_screenmmwidth()），获取显示屏的pixels数目（winfo_screenheight()，winfo_screenwidth()）。</li>\n</ul>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># tk获取屏幕的分辨率和尺寸</span><br><span class=\"hljs-keyword\">from</span> tkinter <span class=\"hljs-keyword\">import</span> Tk<br><span class=\"hljs-comment\"># creating tkinter window</span><br>base = Tk()<br><span class=\"hljs-comment\">#screen's length and width in pixels and mm</span><br>length_1= base.winfo_screenheight()<br>width_1= base.winfo_screenwidth()<br>length_2 = base.winfo_screenmmheight()<br>width_2 = base.winfo_screenmmwidth()<br><span class=\"hljs-comment\">#screen Depth</span><br>screendepth = base.winfo_screendepth()<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"width x length (in pixels) =\"</span>,(width_1,length_1))<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"width x length (in mm) =\"</span>, (width_2, length_2))<br>width_ppn = width_1/width_2<br>length_ppn = length_1/length_2<br>ppn = <span class=\"hljs-built_in\">round</span>((width_ppn+length_ppn)/<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">2</span>)<br><span class=\"hljs-built_in\">print</span>(width_1/width_2,length_1/length_2,ppn)<br><br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>使用win32库中的分辨率方法win32print.GetDeviceCaps()，缩放后的分辨率GetSystemMetrics。</li>\n</ul>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">## 获取分辨率</span><br><span class=\"hljs-keyword\">from</span> win32 <span class=\"hljs-keyword\">import</span> win32api, win32gui, win32print<br><span class=\"hljs-keyword\">from</span> win32.lib <span class=\"hljs-keyword\">import</span> win32con<br><br><span class=\"hljs-keyword\">from</span> win32.win32api <span class=\"hljs-keyword\">import</span> GetSystemMetrics<br><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">get_real_resolution</span>():</span><br>    <span class=\"hljs-string\">\"\"\"获取真实的分辨率\"\"\"</span><br>    hDC = win32gui.GetDC(<span class=\"hljs-number\">0</span>)<br>    <span class=\"hljs-comment\"># 横向分辨率</span><br>    w = win32print.GetDeviceCaps(hDC, win32con.DESKTOPHORZRES)<br>    <span class=\"hljs-comment\"># 纵向分辨率</span><br>    h = win32print.GetDeviceCaps(hDC, win32con.DESKTOPVERTRES)<br>    <span class=\"hljs-keyword\">return</span> w, h<br><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">get_screen_size</span>():</span><br>    <span class=\"hljs-string\">\"\"\"获取缩放后的分辨率\"\"\"</span><br>    w = GetSystemMetrics (<span class=\"hljs-number\">0</span>)<br>    h = GetSystemMetrics (<span class=\"hljs-number\">1</span>)<br>    <span class=\"hljs-keyword\">return</span> w, h<br><br>real_resolution = get_real_resolution()<br>screen_size = get_screen_size()<br><span class=\"hljs-built_in\">print</span>(real_resolution)<br><span class=\"hljs-built_in\">print</span>(screen_size)<br><br>screen_scale_rate = <span class=\"hljs-built_in\">round</span>(real_resolution[<span class=\"hljs-number\">0</span>] / screen_size[<span class=\"hljs-number\">0</span>], <span class=\"hljs-number\">2</span>)<br><span class=\"hljs-built_in\">print</span>(screen_scale_rate)<br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>多屏的分辨率获取的方法。</li>\n</ul>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#屏幕的尺寸</span><br><span class=\"hljs-comment\"># -*- coding: utf-8 -*-</span><br><span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\">功能：识别两块显示器各自的分辨率</span><br><span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\">\"\"\"模块导入\"\"\"</span><br><span class=\"hljs-keyword\">from</span> win32api <span class=\"hljs-keyword\">import</span> GetSystemMetrics<br><span class=\"hljs-keyword\">from</span> win32con <span class=\"hljs-keyword\">import</span> SM_CMONITORS, SM_CXVIRTUALSCREEN, SM_CYVIRTUALSCREEN<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">Display_Detection</span>():</span><br>    <span class=\"hljs-comment\"># 显示器数量检测</span><br>    MonitorNumber = GetSystemMetrics(SM_CMONITORS)<br>    <span class=\"hljs-comment\"># 主屏幕尺寸检测</span><br>    MajorScreenWidth = GetSystemMetrics(<span class=\"hljs-number\">0</span>)  <span class=\"hljs-comment\"># 主屏幕宽</span><br>    MajorScreenHeight = GetSystemMetrics(<span class=\"hljs-number\">1</span>)  <span class=\"hljs-comment\"># 主屏幕高</span><br>    <span class=\"hljs-comment\"># print(\"主屏幕尺寸：\", GetSystemMetrics(0), \"*\", GetSystemMetrics(1))</span><br>    <span class=\"hljs-comment\"># 屏幕最大尺寸</span><br>    aScreenWidth = GetSystemMetrics(SM_CXVIRTUALSCREEN)  <span class=\"hljs-comment\"># 屏幕最大宽度</span><br>    aScreenHeight = GetSystemMetrics(SM_CYVIRTUALSCREEN)  <span class=\"hljs-comment\"># 屏幕最大高度</span><br>    AllScreen=(aScreenWidth, aScreenHeight)<br>    <span class=\"hljs-comment\"># print(\"屏幕总尺寸:\", aScreenWidth, \"*\", aScreenHeight)</span><br>    <span class=\"hljs-comment\"># 当前主流的分辨率基数是宽，偶数是高</span><br>    ResolvingPower = [<span class=\"hljs-number\">1280</span>, <span class=\"hljs-number\">720</span>, <span class=\"hljs-number\">1920</span>, <span class=\"hljs-number\">1080</span>, <span class=\"hljs-number\">2560</span>, <span class=\"hljs-number\">1440</span>, <span class=\"hljs-number\">3840</span>, <span class=\"hljs-number\">2160</span>, <span class=\"hljs-number\">4096</span>, <span class=\"hljs-number\">2160</span>, <span class=\"hljs-number\">7680</span>, <span class=\"hljs-number\">4320</span>]<br><br>    <span class=\"hljs-keyword\">if</span> MonitorNumber &gt; <span class=\"hljs-number\">1</span>:  <span class=\"hljs-comment\"># 屏幕数量判断print(MonitorNumber)就可以知道有多少块屏幕</span><br>        SecondaryScreenWidth = aScreenWidth - MajorScreenWidth  <span class=\"hljs-comment\"># 副屏宽=总屏幕宽-当前屏幕宽</span><br>        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"副屏宽\"</span>,SecondaryScreenWidth)<br><br>        <span class=\"hljs-comment\"># 主屏横竖屏检测</span><br>        <span class=\"hljs-keyword\">if</span> GetSystemMetrics(<span class=\"hljs-number\">0</span>) &gt; GetSystemMetrics(<span class=\"hljs-number\">1</span>):<br>            MianScreen = (GetSystemMetrics(<span class=\"hljs-number\">0</span>), GetSystemMetrics(<span class=\"hljs-number\">1</span>))<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"主屏(横屏)尺寸：\"</span>, GetSystemMetrics(<span class=\"hljs-number\">0</span>), <span class=\"hljs-string\">\"*\"</span>, GetSystemMetrics(<span class=\"hljs-number\">1</span>))<br>        <span class=\"hljs-keyword\">else</span>:<br>            MianScreen = (GetSystemMetrics(<span class=\"hljs-number\">0</span>), GetSystemMetrics(<span class=\"hljs-number\">1</span>))<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"主屏(竖屏)尺寸：\"</span>, GetSystemMetrics(<span class=\"hljs-number\">0</span>), <span class=\"hljs-string\">\"*\"</span>, GetSystemMetrics(<span class=\"hljs-number\">1</span>))<br><br>        <span class=\"hljs-comment\"># 横屏状态</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(ResolvingPower) - <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>):<br>            <span class=\"hljs-comment\"># print(\"i\",ResolvingPower[i])</span><br>            <span class=\"hljs-keyword\">if</span> SecondaryScreenWidth == ResolvingPower[i]:<br>                SecondaryScreen = (ResolvingPower[i], ResolvingPower[i + <span class=\"hljs-number\">1</span>])<br>                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"副屏(横屏)尺寸：\"</span>, ResolvingPower[i], ResolvingPower[i + <span class=\"hljs-number\">1</span>])<br>                <span class=\"hljs-comment\"># return \"副屏(竖屏)尺寸：\",SecondaryScreen</span><br>                <span class=\"hljs-keyword\">break</span><br>        <span class=\"hljs-comment\"># 竖屏状态</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-built_in\">len</span>(ResolvingPower) - <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>):<br>            <span class=\"hljs-comment\"># print(\"i\",ResolvingPower[i])</span><br>            <span class=\"hljs-keyword\">if</span> SecondaryScreenWidth == ResolvingPower[i]:<br>                SecondaryScreen = (ResolvingPower[i], ResolvingPower[i + <span class=\"hljs-number\">1</span>])<br>                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"副屏(竖屏)尺寸：\"</span>, ResolvingPower[i], ResolvingPower[i - <span class=\"hljs-number\">1</span>])<br>                <span class=\"hljs-comment\"># return \"副屏(竖屏)尺寸\",SecondaryScreen</span><br>                <span class=\"hljs-keyword\">break</span><br>    <span class=\"hljs-keyword\">return</span> MonitorNumber,AllScreen,MianScreen,SecondaryScreen<br><br><span class=\"hljs-comment\">#调用</span><br>a=Display_Detection()<br><span class=\"hljs-built_in\">print</span>(a)<span class=\"hljs-comment\">#a可以任意遍历其中的内容a[0]代表屏幕数量等等...</span><br><br>主屏(横屏)尺寸： <span class=\"hljs-number\">1920</span> * <span class=\"hljs-number\">1080</span><br>副屏(竖屏)尺寸： <span class=\"hljs-number\">1440</span> <span class=\"hljs-number\">2560</span><br>(<span class=\"hljs-number\">2</span>, (<span class=\"hljs-number\">3360</span>, <span class=\"hljs-number\">1080</span>), (<span class=\"hljs-number\">1920</span>, <span class=\"hljs-number\">1080</span>), (<span class=\"hljs-number\">1440</span>, <span class=\"hljs-number\">3840</span>))<br></code></pre></td></tr></tbody></table></figure>","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>获取电脑的分辨率，物理尺寸，PPI<br>\n首先介绍一下PPI和DPI：<br>\nPPI（Pixels Per Inch）每一英寸长度上有多少像素点；计算方式可以使用像素点除以屏幕尺寸。<br>\n分辨率DPI（Dots Per Inch）每一英寸有多少点，这里的点是可以改变的，可以是 1Dot = 1Pixel，也可以是 1Dot = N Pixel。在电脑里，分辩率是可以调节的，这里用的就是Dot ，密度用DPI描述；只有当使用屏幕最大分辩率的时候（即 1Dot = 1Pixel），这个时候 DPI = PPI。</p>\n</blockquote>\n<p>搜集了很多代码和方法，最后找到一个比较精准的方法是使用Tkinter。</p>\n<ul>\n<li>可以得到显示屏的尺寸，获取以毫米为单位宽高（winfo_screenmmheight()，winfo_screenmmwidth()），获取显示屏的pixels数目（winfo_screenheight()，winfo_screenwidth()）。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># tk获取屏幕的分辨率和尺寸</span><br><span class=\"hljs-keyword\">from</span> tkinter <span class=\"hljs-keyword\">import</span> Tk<br><span class=\"hljs-comment\"># creating tkinter window</span><br>base = Tk()<br><span class=\"hljs-comment\">#screen&#x27;s length and width in pixels and mm</span><br>length_1= base.winfo_screenheight()<br>width_1= base.winfo_screenwidth()<br>length_2 = base.winfo_screenmmheight()<br>width_2 = base.winfo_screenmmwidth()<br><span class=\"hljs-comment\">#screen Depth</span><br>screendepth = base.winfo_screendepth()<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;width x length (in pixels) =&quot;</span>,(width_1,length_1))<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;width x length (in mm) =&quot;</span>, (width_2, length_2))<br>width_ppn = width_1/width_2<br>length_ppn = length_1/length_2<br>ppn = <span class=\"hljs-built_in\">round</span>((width_ppn+length_ppn)/<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">2</span>)<br><span class=\"hljs-built_in\">print</span>(width_1/width_2,length_1/length_2,ppn)<br><br></code></pre></td></tr></table></figure>\n<ul>\n<li>使用win32库中的分辨率方法win32print.GetDeviceCaps()，缩放后的分辨率GetSystemMetrics。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">## 获取分辨率</span><br><span class=\"hljs-keyword\">from</span> win32 <span class=\"hljs-keyword\">import</span> win32api, win32gui, win32print<br><span class=\"hljs-keyword\">from</span> win32.lib <span class=\"hljs-keyword\">import</span> win32con<br><br><span class=\"hljs-keyword\">from</span> win32.win32api <span class=\"hljs-keyword\">import</span> GetSystemMetrics<br><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">get_real_resolution</span>():</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;获取真实的分辨率&quot;&quot;&quot;</span><br>    hDC = win32gui.GetDC(<span class=\"hljs-number\">0</span>)<br>    <span class=\"hljs-comment\"># 横向分辨率</span><br>    w = win32print.GetDeviceCaps(hDC, win32con.DESKTOPHORZRES)<br>    <span class=\"hljs-comment\"># 纵向分辨率</span><br>    h = win32print.GetDeviceCaps(hDC, win32con.DESKTOPVERTRES)<br>    <span class=\"hljs-keyword\">return</span> w, h<br><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">get_screen_size</span>():</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;获取缩放后的分辨率&quot;&quot;&quot;</span><br>    w = GetSystemMetrics (<span class=\"hljs-number\">0</span>)<br>    h = GetSystemMetrics (<span class=\"hljs-number\">1</span>)<br>    <span class=\"hljs-keyword\">return</span> w, h<br><br>real_resolution = get_real_resolution()<br>screen_size = get_screen_size()<br><span class=\"hljs-built_in\">print</span>(real_resolution)<br><span class=\"hljs-built_in\">print</span>(screen_size)<br><br>screen_scale_rate = <span class=\"hljs-built_in\">round</span>(real_resolution[<span class=\"hljs-number\">0</span>] / screen_size[<span class=\"hljs-number\">0</span>], <span class=\"hljs-number\">2</span>)<br><span class=\"hljs-built_in\">print</span>(screen_scale_rate)<br></code></pre></td></tr></table></figure>\n<ul>\n<li>多屏的分辨率获取的方法。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#屏幕的尺寸</span><br><span class=\"hljs-comment\"># -*- coding: utf-8 -*-</span><br><span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">功能：识别两块显示器各自的分辨率</span><br><span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">&quot;&quot;&quot;模块导入&quot;&quot;&quot;</span><br><span class=\"hljs-keyword\">from</span> win32api <span class=\"hljs-keyword\">import</span> GetSystemMetrics<br><span class=\"hljs-keyword\">from</span> win32con <span class=\"hljs-keyword\">import</span> SM_CMONITORS, SM_CXVIRTUALSCREEN, SM_CYVIRTUALSCREEN<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">Display_Detection</span>():</span><br>    <span class=\"hljs-comment\"># 显示器数量检测</span><br>    MonitorNumber = GetSystemMetrics(SM_CMONITORS)<br>    <span class=\"hljs-comment\"># 主屏幕尺寸检测</span><br>    MajorScreenWidth = GetSystemMetrics(<span class=\"hljs-number\">0</span>)  <span class=\"hljs-comment\"># 主屏幕宽</span><br>    MajorScreenHeight = GetSystemMetrics(<span class=\"hljs-number\">1</span>)  <span class=\"hljs-comment\"># 主屏幕高</span><br>    <span class=\"hljs-comment\"># print(&quot;主屏幕尺寸：&quot;, GetSystemMetrics(0), &quot;*&quot;, GetSystemMetrics(1))</span><br>    <span class=\"hljs-comment\"># 屏幕最大尺寸</span><br>    aScreenWidth = GetSystemMetrics(SM_CXVIRTUALSCREEN)  <span class=\"hljs-comment\"># 屏幕最大宽度</span><br>    aScreenHeight = GetSystemMetrics(SM_CYVIRTUALSCREEN)  <span class=\"hljs-comment\"># 屏幕最大高度</span><br>    AllScreen=(aScreenWidth, aScreenHeight)<br>    <span class=\"hljs-comment\"># print(&quot;屏幕总尺寸:&quot;, aScreenWidth, &quot;*&quot;, aScreenHeight)</span><br>    <span class=\"hljs-comment\"># 当前主流的分辨率基数是宽，偶数是高</span><br>    ResolvingPower = [<span class=\"hljs-number\">1280</span>, <span class=\"hljs-number\">720</span>, <span class=\"hljs-number\">1920</span>, <span class=\"hljs-number\">1080</span>, <span class=\"hljs-number\">2560</span>, <span class=\"hljs-number\">1440</span>, <span class=\"hljs-number\">3840</span>, <span class=\"hljs-number\">2160</span>, <span class=\"hljs-number\">4096</span>, <span class=\"hljs-number\">2160</span>, <span class=\"hljs-number\">7680</span>, <span class=\"hljs-number\">4320</span>]<br><br>    <span class=\"hljs-keyword\">if</span> MonitorNumber &gt; <span class=\"hljs-number\">1</span>:  <span class=\"hljs-comment\"># 屏幕数量判断print(MonitorNumber)就可以知道有多少块屏幕</span><br>        SecondaryScreenWidth = aScreenWidth - MajorScreenWidth  <span class=\"hljs-comment\"># 副屏宽=总屏幕宽-当前屏幕宽</span><br>        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;副屏宽&quot;</span>,SecondaryScreenWidth)<br><br>        <span class=\"hljs-comment\"># 主屏横竖屏检测</span><br>        <span class=\"hljs-keyword\">if</span> GetSystemMetrics(<span class=\"hljs-number\">0</span>) &gt; GetSystemMetrics(<span class=\"hljs-number\">1</span>):<br>            MianScreen = (GetSystemMetrics(<span class=\"hljs-number\">0</span>), GetSystemMetrics(<span class=\"hljs-number\">1</span>))<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;主屏(横屏)尺寸：&quot;</span>, GetSystemMetrics(<span class=\"hljs-number\">0</span>), <span class=\"hljs-string\">&quot;*&quot;</span>, GetSystemMetrics(<span class=\"hljs-number\">1</span>))<br>        <span class=\"hljs-keyword\">else</span>:<br>            MianScreen = (GetSystemMetrics(<span class=\"hljs-number\">0</span>), GetSystemMetrics(<span class=\"hljs-number\">1</span>))<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;主屏(竖屏)尺寸：&quot;</span>, GetSystemMetrics(<span class=\"hljs-number\">0</span>), <span class=\"hljs-string\">&quot;*&quot;</span>, GetSystemMetrics(<span class=\"hljs-number\">1</span>))<br><br>        <span class=\"hljs-comment\"># 横屏状态</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(ResolvingPower) - <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>):<br>            <span class=\"hljs-comment\"># print(&quot;i&quot;,ResolvingPower[i])</span><br>            <span class=\"hljs-keyword\">if</span> SecondaryScreenWidth == ResolvingPower[i]:<br>                SecondaryScreen = (ResolvingPower[i], ResolvingPower[i + <span class=\"hljs-number\">1</span>])<br>                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;副屏(横屏)尺寸：&quot;</span>, ResolvingPower[i], ResolvingPower[i + <span class=\"hljs-number\">1</span>])<br>                <span class=\"hljs-comment\"># return &quot;副屏(竖屏)尺寸：&quot;,SecondaryScreen</span><br>                <span class=\"hljs-keyword\">break</span><br>        <span class=\"hljs-comment\"># 竖屏状态</span><br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-built_in\">len</span>(ResolvingPower) - <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>):<br>            <span class=\"hljs-comment\"># print(&quot;i&quot;,ResolvingPower[i])</span><br>            <span class=\"hljs-keyword\">if</span> SecondaryScreenWidth == ResolvingPower[i]:<br>                SecondaryScreen = (ResolvingPower[i], ResolvingPower[i + <span class=\"hljs-number\">1</span>])<br>                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;副屏(竖屏)尺寸：&quot;</span>, ResolvingPower[i], ResolvingPower[i - <span class=\"hljs-number\">1</span>])<br>                <span class=\"hljs-comment\"># return &quot;副屏(竖屏)尺寸&quot;,SecondaryScreen</span><br>                <span class=\"hljs-keyword\">break</span><br>    <span class=\"hljs-keyword\">return</span> MonitorNumber,AllScreen,MianScreen,SecondaryScreen<br><br><span class=\"hljs-comment\">#调用</span><br>a=Display_Detection()<br><span class=\"hljs-built_in\">print</span>(a)<span class=\"hljs-comment\">#a可以任意遍历其中的内容a[0]代表屏幕数量等等...</span><br><br>主屏(横屏)尺寸： <span class=\"hljs-number\">1920</span> * <span class=\"hljs-number\">1080</span><br>副屏(竖屏)尺寸： <span class=\"hljs-number\">1440</span> <span class=\"hljs-number\">2560</span><br>(<span class=\"hljs-number\">2</span>, (<span class=\"hljs-number\">3360</span>, <span class=\"hljs-number\">1080</span>), (<span class=\"hljs-number\">1920</span>, <span class=\"hljs-number\">1080</span>), (<span class=\"hljs-number\">1440</span>, <span class=\"hljs-number\">3840</span>))<br></code></pre></td></tr></table></figure>"},{"title":"利用spec文件打包","date":"2021-09-28T06:09:20.000Z","_content":"\n> pyinstaller打包方式一般可以分为**直接输入指令**和**利用spec文件**进行打包两种方式，直接输入指令就是根据指令生成spec文件，再根据spec文件的内容进行打包操作，因此spec文件就是核心部分，在此对其内容的相关配置进行归纳。\n\n### spec文件参数\n\nspec文件参数：a，pyz，exe，coll，block_cipher;\n|变量  |含义  |\n| :---: | :--- |\n| a | Analysis类的实例,要求传入各种脚本用于分析程序的导入和依赖，a中的内容主要包括四部分：scripts：可以在命令行中输入的python脚本；pure，程序代码文件中的纯python模块；binaries：程序代码文件中需要的非python模块，包括add-binary参数指定的内容；datas：非二进制文件，包括add-data参数指定的内容 |\n| pyz | pyz的实例，是一个.pyz文件，包含了所有pure的所有python模块 |\n| exe | exe类的实例，这个类是用来处理Analysis和PYZ的结果。也是用来生成最后的exe可执行程序 |\n| coll | collect类的实例，用于创建输出目录，在-F模式（单一exe程序）下，是没有collect实例的，并且所有脚本，模块和二进制文件都包含在最终生成的exe文件中|\n| block_cipher | 加密密钥 |\n\n以上内容中修改比较多的是a,exe的内容，coll和pyz基本上没有遇到需要修改的情况。\n\n### 参数a，exe的说明\n下面对a和exe参数内容进行详细介绍：\n| 参数 | 子参数 |具体含义 |\n| :--: | :--: | :--|\n| Analysis参数 | scripts  | 第一个参数，他是一个脚本列表，可以传入多个py脚本，效果与命令行中指定多个py文件相同，比如说“pyinstaller XXX1.py XXX2.py”，pyinstaller会依次分析执行，并且把第一个py文件的名称作为spec和dist下的文件夹及程序名称|\n| Analysis参数 | pathex   | 默认有一个spec目录，当我们有一些模块不在该项目路径下的时候，可以将使用到的模块路径添加到pathex变量中，相当于“-p DIR/-paths DIR”|\n| Analysis参数 | datas    | 作用是将本地文件打包时拷贝到目标路径下。datas是一个元素为元组的列表，每个元组有两个元素，都必须是字符串类型，元组的第一个元素是数据文件（文件夹），元组的第二个元素为运行时这些文件（文件夹）的位置。例如：datas = [('./src/a.txt','./dst')]表示打包时将'./src/a.txt'文件添加到相对exe目录先的dist目录中，也可以使用通配符datas = [('./myfile/*.mp3','sfx')]，表示将myfile下的所有mp3文件都copy到sfx文件夹中，也可以添加整个文件夹：datas = [('./myfile/data','data')]，表示将myfile下的data文件夹下所有文件都copy到data文件夹下，同命令“-add-data” |\n| Analysis参数 | binaries | 添加二进制文件，也是一个列表，定义方式与datas参数一样，同命令“-add-binary” |\n| Analysis参数 | hiddenimports|指定脚本中需要隐式导入的模块，比如在import、imp.find_module()、exec、eval等语句中导入模块，这些模块PyInstaller是找不到的，需要手动指定导入，这个选项可以使用多次。同命令“–hidden-import MODULENAME/–hiddenimport MODULENAME”。|\n| Analysis参数 | hookspath |指定额外的hook文件（可以是py文件）的查找路径，这些文件的作用是在pyinstaller运行时改变一些python或者其他库原有的函数或者变量的执行逻辑（并不会改变这些库本身的代码），以便能顺利的打包完成，这个选项可以使用多次。同命令“–additional-hooks-dir HOOKSPATH”。|\n| Analysis参数 | runtime_hooks |指定自定义的运行hook文件路径（可以时py文件），在打包好的exe程序中，运行这个exe程序时，指定的hook文件会在所有代码和模块之前运行，包括main文件，以满足一些运行环境的特殊要求，这个选项可以使用多次，同命令“-runtime-hook RUNTIME_HOOKS”.|\n| Analysis参数 | excludes |指定可以被忽略的可选的模块或包，因为某些模块只是PyInstaller根据自身的逻辑去查找的，这些模块对于exe程序本身并没有用到，但是在日志中还是会提示“module not found”，这种日志可以不用管，或者使用这个参数选项来指定不用导入，这个选项可以使用多次。同命令“–exclude-module EXCLUDES”。|\n| exe参数 | console |设置是否显示命令行窗口，同命令 “-W/-c”|\n| exe参数 | icon |设置程序图标，默认spec是没有图标的，需要手动添加，参数值就是图片路径的字符串，同命令“-i/-icon”|\n\n### 我的记录\n\n在此记录一下detectui的spec文件呢~~~\n\n```python\n# -*- mode: python ; coding: utf-8 -*-\n\n\nblock_cipher = None\n\n\na = Analysis(['detectui.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\__init__.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\torch_utils.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\autoanchor.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\datasets.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\general.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\google_utils.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\metrics.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\plots.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\__init__.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\common.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\experimental.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\yolo.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\detectInfo.py',\n              ],\n             pathex=['E:\\\\masterProjects\\\\foot\\\\footRevise',\n             'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models',\n             'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils',\n             'D:\\\\anaconda3\\\\envs\\\\torch\\\\Lib\\\\site-packages\\\\scipy\\\\.libs',\n             'D:\\\\anaconda3\\\\envs\\\\torch\\\\Lib\\\\site-packages\\\\torch\\\\lib',\n              ],\n             binaries=[],\n             datas=[\n             ('E:\\\\masterProjects\\\\foot\\\\footRevise\\\\weights\\\\best.pt','.\\\\weights'),\n             ('E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\*.yaml','.\\\\models'),\n             ('E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\hub\\\\*.yaml','.\\\\models\\\\hub'),\n             ('E:\\\\masterProjects\\\\foot\\\\footRevise\\\\icon.jpg','.'),\n             ('E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\__pycache__\\\\torch_utils.pyc','.\\\\utils'),\n             ],\n             hiddenimports=['pkg_resources.py2_warn','pkg_resources.markers'],\n             hookspath=[],\n             hooksconfig={},\n             runtime_hooks=[],\n             excludes=[],\n             win_no_prefer_redirects=False,\n             win_private_assemblies=False,\n             cipher=block_cipher,\n             noarchive=False)\nfor d in a.datas:\n    if '_C.cp38-win_amd64.pyd' in d[0]:\n\t\t    a.datas.remove(d)\n\t\t    break\npyz = PYZ(a.pure, a.zipped_data,\n             cipher=block_cipher)\n\nexe = EXE(pyz,\n          a.scripts,\n          [],\n          exclude_binaries=True,\n          name='detectui',\n          debug=False,\n          bootloader_ignore_signals=False,\n          strip=False,\n          upx=True,\n          console=False,\n          icon='icon.ico')\ncoll = COLLECT(exe,\n               a.binaries,\n               a.zipfiles,\n               a.datas,\n               strip=False,\n               upx=True,\n               name='detectui')\n\n```\n\n","source":"_posts/project_tool/spec.md","raw":"---\ntitle: 利用spec文件打包\ntags: [项目打包]\ncategories: [工具,pyinstaller]\ndate: 2021-09-28 14:09:20\n---\n\n> pyinstaller打包方式一般可以分为**直接输入指令**和**利用spec文件**进行打包两种方式，直接输入指令就是根据指令生成spec文件，再根据spec文件的内容进行打包操作，因此spec文件就是核心部分，在此对其内容的相关配置进行归纳。\n\n### spec文件参数\n\nspec文件参数：a，pyz，exe，coll，block_cipher;\n|变量  |含义  |\n| :---: | :--- |\n| a | Analysis类的实例,要求传入各种脚本用于分析程序的导入和依赖，a中的内容主要包括四部分：scripts：可以在命令行中输入的python脚本；pure，程序代码文件中的纯python模块；binaries：程序代码文件中需要的非python模块，包括add-binary参数指定的内容；datas：非二进制文件，包括add-data参数指定的内容 |\n| pyz | pyz的实例，是一个.pyz文件，包含了所有pure的所有python模块 |\n| exe | exe类的实例，这个类是用来处理Analysis和PYZ的结果。也是用来生成最后的exe可执行程序 |\n| coll | collect类的实例，用于创建输出目录，在-F模式（单一exe程序）下，是没有collect实例的，并且所有脚本，模块和二进制文件都包含在最终生成的exe文件中|\n| block_cipher | 加密密钥 |\n\n以上内容中修改比较多的是a,exe的内容，coll和pyz基本上没有遇到需要修改的情况。\n\n### 参数a，exe的说明\n下面对a和exe参数内容进行详细介绍：\n| 参数 | 子参数 |具体含义 |\n| :--: | :--: | :--|\n| Analysis参数 | scripts  | 第一个参数，他是一个脚本列表，可以传入多个py脚本，效果与命令行中指定多个py文件相同，比如说“pyinstaller XXX1.py XXX2.py”，pyinstaller会依次分析执行，并且把第一个py文件的名称作为spec和dist下的文件夹及程序名称|\n| Analysis参数 | pathex   | 默认有一个spec目录，当我们有一些模块不在该项目路径下的时候，可以将使用到的模块路径添加到pathex变量中，相当于“-p DIR/-paths DIR”|\n| Analysis参数 | datas    | 作用是将本地文件打包时拷贝到目标路径下。datas是一个元素为元组的列表，每个元组有两个元素，都必须是字符串类型，元组的第一个元素是数据文件（文件夹），元组的第二个元素为运行时这些文件（文件夹）的位置。例如：datas = [('./src/a.txt','./dst')]表示打包时将'./src/a.txt'文件添加到相对exe目录先的dist目录中，也可以使用通配符datas = [('./myfile/*.mp3','sfx')]，表示将myfile下的所有mp3文件都copy到sfx文件夹中，也可以添加整个文件夹：datas = [('./myfile/data','data')]，表示将myfile下的data文件夹下所有文件都copy到data文件夹下，同命令“-add-data” |\n| Analysis参数 | binaries | 添加二进制文件，也是一个列表，定义方式与datas参数一样，同命令“-add-binary” |\n| Analysis参数 | hiddenimports|指定脚本中需要隐式导入的模块，比如在import、imp.find_module()、exec、eval等语句中导入模块，这些模块PyInstaller是找不到的，需要手动指定导入，这个选项可以使用多次。同命令“–hidden-import MODULENAME/–hiddenimport MODULENAME”。|\n| Analysis参数 | hookspath |指定额外的hook文件（可以是py文件）的查找路径，这些文件的作用是在pyinstaller运行时改变一些python或者其他库原有的函数或者变量的执行逻辑（并不会改变这些库本身的代码），以便能顺利的打包完成，这个选项可以使用多次。同命令“–additional-hooks-dir HOOKSPATH”。|\n| Analysis参数 | runtime_hooks |指定自定义的运行hook文件路径（可以时py文件），在打包好的exe程序中，运行这个exe程序时，指定的hook文件会在所有代码和模块之前运行，包括main文件，以满足一些运行环境的特殊要求，这个选项可以使用多次，同命令“-runtime-hook RUNTIME_HOOKS”.|\n| Analysis参数 | excludes |指定可以被忽略的可选的模块或包，因为某些模块只是PyInstaller根据自身的逻辑去查找的，这些模块对于exe程序本身并没有用到，但是在日志中还是会提示“module not found”，这种日志可以不用管，或者使用这个参数选项来指定不用导入，这个选项可以使用多次。同命令“–exclude-module EXCLUDES”。|\n| exe参数 | console |设置是否显示命令行窗口，同命令 “-W/-c”|\n| exe参数 | icon |设置程序图标，默认spec是没有图标的，需要手动添加，参数值就是图片路径的字符串，同命令“-i/-icon”|\n\n### 我的记录\n\n在此记录一下detectui的spec文件呢~~~\n\n```python\n# -*- mode: python ; coding: utf-8 -*-\n\n\nblock_cipher = None\n\n\na = Analysis(['detectui.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\__init__.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\torch_utils.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\autoanchor.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\datasets.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\general.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\google_utils.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\metrics.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\plots.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\__init__.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\common.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\experimental.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\yolo.py',\n              'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\detectInfo.py',\n              ],\n             pathex=['E:\\\\masterProjects\\\\foot\\\\footRevise',\n             'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models',\n             'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils',\n             'D:\\\\anaconda3\\\\envs\\\\torch\\\\Lib\\\\site-packages\\\\scipy\\\\.libs',\n             'D:\\\\anaconda3\\\\envs\\\\torch\\\\Lib\\\\site-packages\\\\torch\\\\lib',\n              ],\n             binaries=[],\n             datas=[\n             ('E:\\\\masterProjects\\\\foot\\\\footRevise\\\\weights\\\\best.pt','.\\\\weights'),\n             ('E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\*.yaml','.\\\\models'),\n             ('E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\hub\\\\*.yaml','.\\\\models\\\\hub'),\n             ('E:\\\\masterProjects\\\\foot\\\\footRevise\\\\icon.jpg','.'),\n             ('E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\__pycache__\\\\torch_utils.pyc','.\\\\utils'),\n             ],\n             hiddenimports=['pkg_resources.py2_warn','pkg_resources.markers'],\n             hookspath=[],\n             hooksconfig={},\n             runtime_hooks=[],\n             excludes=[],\n             win_no_prefer_redirects=False,\n             win_private_assemblies=False,\n             cipher=block_cipher,\n             noarchive=False)\nfor d in a.datas:\n    if '_C.cp38-win_amd64.pyd' in d[0]:\n\t\t    a.datas.remove(d)\n\t\t    break\npyz = PYZ(a.pure, a.zipped_data,\n             cipher=block_cipher)\n\nexe = EXE(pyz,\n          a.scripts,\n          [],\n          exclude_binaries=True,\n          name='detectui',\n          debug=False,\n          bootloader_ignore_signals=False,\n          strip=False,\n          upx=True,\n          console=False,\n          icon='icon.ico')\ncoll = COLLECT(exe,\n               a.binaries,\n               a.zipfiles,\n               a.datas,\n               strip=False,\n               upx=True,\n               name='detectui')\n\n```\n\n","slug":"project_tool/spec","published":1,"updated":"2022-01-18T08:10:17.106Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bw006iast92g285gct","content":"<blockquote>\n<p>pyinstaller打包方式一般可以分为<strong>直接输入指令</strong>和<strong>利用spec文件</strong>进行打包两种方式，直接输入指令就是根据指令生成spec文件，再根据spec文件的内容进行打包操作，因此spec文件就是核心部分，在此对其内容的相关配置进行归纳。</p>\n</blockquote>\n<h3 id=\"spec文件参数\">spec文件参数</h3>\n<p>spec文件参数：a，pyz，exe，coll，block_cipher;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">变量</th>\n<th style=\"text-align:left\">含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">a</td>\n<td style=\"text-align:left\">Analysis类的实例,要求传入各种脚本用于分析程序的导入和依赖，a中的内容主要包括四部分：scripts：可以在命令行中输入的python脚本；pure，程序代码文件中的纯python模块；binaries：程序代码文件中需要的非python模块，包括add-binary参数指定的内容；datas：非二进制文件，包括add-data参数指定的内容</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">pyz</td>\n<td style=\"text-align:left\">pyz的实例，是一个.pyz文件，包含了所有pure的所有python模块</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">exe</td>\n<td style=\"text-align:left\">exe类的实例，这个类是用来处理Analysis和PYZ的结果。也是用来生成最后的exe可执行程序</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">coll</td>\n<td style=\"text-align:left\">collect类的实例，用于创建输出目录，在-F模式（单一exe程序）下，是没有collect实例的，并且所有脚本，模块和二进制文件都包含在最终生成的exe文件中</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">block_cipher</td>\n<td style=\"text-align:left\">加密密钥</td>\n</tr>\n</tbody>\n</table>\n<p>以上内容中修改比较多的是a,exe的内容，coll和pyz基本上没有遇到需要修改的情况。</p>\n<h3 id=\"参数a，exe的说明\">参数a，exe的说明</h3>\n<p>下面对a和exe参数内容进行详细介绍：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">参数</th>\n<th style=\"text-align:center\">子参数</th>\n<th style=\"text-align:left\">具体含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">scripts</td>\n<td style=\"text-align:left\">第一个参数，他是一个脚本列表，可以传入多个py脚本，效果与命令行中指定多个py文件相同，比如说“pyinstaller <a href=\"http://XXX1.py\">XXX1.py</a> <a href=\"http://XXX2.py\">XXX2.py</a>”，pyinstaller会依次分析执行，并且把第一个py文件的名称作为spec和dist下的文件夹及程序名称</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">pathex</td>\n<td style=\"text-align:left\">默认有一个spec目录，当我们有一些模块不在该项目路径下的时候，可以将使用到的模块路径添加到pathex变量中，相当于“-p DIR/-paths DIR”</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">datas</td>\n<td style=\"text-align:left\">作用是将本地文件打包时拷贝到目标路径下。datas是一个元素为元组的列表，每个元组有两个元素，都必须是字符串类型，元组的第一个元素是数据文件（文件夹），元组的第二个元素为运行时这些文件（文件夹）的位置。例如：datas = [(‘./src/a.txt’,‘./dst’)]表示打包时将’./src/a.txt’文件添加到相对exe目录先的dist目录中，也可以使用通配符datas = [(‘./myfile/*.mp3’,‘sfx’)]，表示将myfile下的所有mp3文件都copy到sfx文件夹中，也可以添加整个文件夹：datas = [(‘./myfile/data’,‘data’)]，表示将myfile下的data文件夹下所有文件都copy到data文件夹下，同命令“-add-data”</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">binaries</td>\n<td style=\"text-align:left\">添加二进制文件，也是一个列表，定义方式与datas参数一样，同命令“-add-binary”</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">hiddenimports</td>\n<td style=\"text-align:left\">指定脚本中需要隐式导入的模块，比如在import、imp.find_module()、exec、eval等语句中导入模块，这些模块PyInstaller是找不到的，需要手动指定导入，这个选项可以使用多次。同命令“–hidden-import MODULENAME/–hiddenimport MODULENAME”。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">hookspath</td>\n<td style=\"text-align:left\">指定额外的hook文件（可以是py文件）的查找路径，这些文件的作用是在pyinstaller运行时改变一些python或者其他库原有的函数或者变量的执行逻辑（并不会改变这些库本身的代码），以便能顺利的打包完成，这个选项可以使用多次。同命令“–additional-hooks-dir HOOKSPATH”。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">runtime_hooks</td>\n<td style=\"text-align:left\">指定自定义的运行hook文件路径（可以时py文件），在打包好的exe程序中，运行这个exe程序时，指定的hook文件会在所有代码和模块之前运行，包括main文件，以满足一些运行环境的特殊要求，这个选项可以使用多次，同命令“-runtime-hook RUNTIME_HOOKS”.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">excludes</td>\n<td style=\"text-align:left\">指定可以被忽略的可选的模块或包，因为某些模块只是PyInstaller根据自身的逻辑去查找的，这些模块对于exe程序本身并没有用到，但是在日志中还是会提示“module not found”，这种日志可以不用管，或者使用这个参数选项来指定不用导入，这个选项可以使用多次。同命令“–exclude-module EXCLUDES”。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">exe参数</td>\n<td style=\"text-align:center\">console</td>\n<td style=\"text-align:left\">设置是否显示命令行窗口，同命令 “-W/-c”</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">exe参数</td>\n<td style=\"text-align:center\">icon</td>\n<td style=\"text-align:left\">设置程序图标，默认spec是没有图标的，需要手动添加，参数值就是图片路径的字符串，同命令“-i/-icon”</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"我的记录\">我的记录</h3>\n<p>在此记录一下detectui的spec文件呢~~~</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># -*- mode: python ; coding: utf-8 -*-</span><br><br><br>block_cipher = <span class=\"hljs-literal\">None</span><br><br><br>a = Analysis([<span class=\"hljs-string\">'detectui.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\__init__.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\torch_utils.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\autoanchor.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\datasets.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\general.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\google_utils.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\metrics.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\plots.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\__init__.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\common.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\experimental.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\yolo.py'</span>,<br>              <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\detectInfo.py'</span>,<br>              ],<br>             pathex=[<span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise'</span>,<br>             <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models'</span>,<br>             <span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils'</span>,<br>             <span class=\"hljs-string\">'D:\\\\anaconda3\\\\envs\\\\torch\\\\Lib\\\\site-packages\\\\scipy\\\\.libs'</span>,<br>             <span class=\"hljs-string\">'D:\\\\anaconda3\\\\envs\\\\torch\\\\Lib\\\\site-packages\\\\torch\\\\lib'</span>,<br>              ],<br>             binaries=[],<br>             datas=[<br>             (<span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\weights\\\\best.pt'</span>,<span class=\"hljs-string\">'.\\\\weights'</span>),<br>             (<span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\*.yaml'</span>,<span class=\"hljs-string\">'.\\\\models'</span>),<br>             (<span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\hub\\\\*.yaml'</span>,<span class=\"hljs-string\">'.\\\\models\\\\hub'</span>),<br>             (<span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\icon.jpg'</span>,<span class=\"hljs-string\">'.'</span>),<br>             (<span class=\"hljs-string\">'E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\__pycache__\\\\torch_utils.pyc'</span>,<span class=\"hljs-string\">'.\\\\utils'</span>),<br>             ],<br>             hiddenimports=[<span class=\"hljs-string\">'pkg_resources.py2_warn'</span>,<span class=\"hljs-string\">'pkg_resources.markers'</span>],<br>             hookspath=[],<br>             hooksconfig={},<br>             runtime_hooks=[],<br>             excludes=[],<br>             win_no_prefer_redirects=<span class=\"hljs-literal\">False</span>,<br>             win_private_assemblies=<span class=\"hljs-literal\">False</span>,<br>             cipher=block_cipher,<br>             noarchive=<span class=\"hljs-literal\">False</span>)<br><span class=\"hljs-keyword\">for</span> d <span class=\"hljs-keyword\">in</span> a.datas:<br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'_C.cp38-win_amd64.pyd'</span> <span class=\"hljs-keyword\">in</span> d[<span class=\"hljs-number\">0</span>]:<br>\t\t    a.datas.remove(d)<br>\t\t    <span class=\"hljs-keyword\">break</span><br>pyz = PYZ(a.pure, a.zipped_data,<br>             cipher=block_cipher)<br><br>exe = EXE(pyz,<br>          a.scripts,<br>          [],<br>          exclude_binaries=<span class=\"hljs-literal\">True</span>,<br>          name=<span class=\"hljs-string\">'detectui'</span>,<br>          debug=<span class=\"hljs-literal\">False</span>,<br>          bootloader_ignore_signals=<span class=\"hljs-literal\">False</span>,<br>          strip=<span class=\"hljs-literal\">False</span>,<br>          upx=<span class=\"hljs-literal\">True</span>,<br>          console=<span class=\"hljs-literal\">False</span>,<br>          icon=<span class=\"hljs-string\">'icon.ico'</span>)<br>coll = COLLECT(exe,<br>               a.binaries,<br>               a.zipfiles,<br>               a.datas,<br>               strip=<span class=\"hljs-literal\">False</span>,<br>               upx=<span class=\"hljs-literal\">True</span>,<br>               name=<span class=\"hljs-string\">'detectui'</span>)<br><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>pyinstaller打包方式一般可以分为<strong>直接输入指令</strong>和<strong>利用spec文件</strong>进行打包两种方式，直接输入指令就是根据指令生成spec文件，再根据spec文件的内容进行打包操作，因此spec文件就是核心部分，在此对其内容的相关配置进行归纳。</p>\n</blockquote>\n<h3 id=\"spec文件参数\">spec文件参数</h3>\n<p>spec文件参数：a，pyz，exe，coll，block_cipher;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">变量</th>\n<th style=\"text-align:left\">含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">a</td>\n<td style=\"text-align:left\">Analysis类的实例,要求传入各种脚本用于分析程序的导入和依赖，a中的内容主要包括四部分：scripts：可以在命令行中输入的python脚本；pure，程序代码文件中的纯python模块；binaries：程序代码文件中需要的非python模块，包括add-binary参数指定的内容；datas：非二进制文件，包括add-data参数指定的内容</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">pyz</td>\n<td style=\"text-align:left\">pyz的实例，是一个.pyz文件，包含了所有pure的所有python模块</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">exe</td>\n<td style=\"text-align:left\">exe类的实例，这个类是用来处理Analysis和PYZ的结果。也是用来生成最后的exe可执行程序</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">coll</td>\n<td style=\"text-align:left\">collect类的实例，用于创建输出目录，在-F模式（单一exe程序）下，是没有collect实例的，并且所有脚本，模块和二进制文件都包含在最终生成的exe文件中</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">block_cipher</td>\n<td style=\"text-align:left\">加密密钥</td>\n</tr>\n</tbody>\n</table>\n<p>以上内容中修改比较多的是a,exe的内容，coll和pyz基本上没有遇到需要修改的情况。</p>\n<h3 id=\"参数a，exe的说明\">参数a，exe的说明</h3>\n<p>下面对a和exe参数内容进行详细介绍：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">参数</th>\n<th style=\"text-align:center\">子参数</th>\n<th style=\"text-align:left\">具体含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">scripts</td>\n<td style=\"text-align:left\">第一个参数，他是一个脚本列表，可以传入多个py脚本，效果与命令行中指定多个py文件相同，比如说“pyinstaller <a href=\"http://XXX1.py\">XXX1.py</a> <a href=\"http://XXX2.py\">XXX2.py</a>”，pyinstaller会依次分析执行，并且把第一个py文件的名称作为spec和dist下的文件夹及程序名称</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">pathex</td>\n<td style=\"text-align:left\">默认有一个spec目录，当我们有一些模块不在该项目路径下的时候，可以将使用到的模块路径添加到pathex变量中，相当于“-p DIR/-paths DIR”</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">datas</td>\n<td style=\"text-align:left\">作用是将本地文件打包时拷贝到目标路径下。datas是一个元素为元组的列表，每个元组有两个元素，都必须是字符串类型，元组的第一个元素是数据文件（文件夹），元组的第二个元素为运行时这些文件（文件夹）的位置。例如：datas = [(‘./src/a.txt’,‘./dst’)]表示打包时将’./src/a.txt’文件添加到相对exe目录先的dist目录中，也可以使用通配符datas = [(‘./myfile/*.mp3’,‘sfx’)]，表示将myfile下的所有mp3文件都copy到sfx文件夹中，也可以添加整个文件夹：datas = [(‘./myfile/data’,‘data’)]，表示将myfile下的data文件夹下所有文件都copy到data文件夹下，同命令“-add-data”</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">binaries</td>\n<td style=\"text-align:left\">添加二进制文件，也是一个列表，定义方式与datas参数一样，同命令“-add-binary”</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">hiddenimports</td>\n<td style=\"text-align:left\">指定脚本中需要隐式导入的模块，比如在import、imp.find_module()、exec、eval等语句中导入模块，这些模块PyInstaller是找不到的，需要手动指定导入，这个选项可以使用多次。同命令“–hidden-import MODULENAME/–hiddenimport MODULENAME”。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">hookspath</td>\n<td style=\"text-align:left\">指定额外的hook文件（可以是py文件）的查找路径，这些文件的作用是在pyinstaller运行时改变一些python或者其他库原有的函数或者变量的执行逻辑（并不会改变这些库本身的代码），以便能顺利的打包完成，这个选项可以使用多次。同命令“–additional-hooks-dir HOOKSPATH”。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">runtime_hooks</td>\n<td style=\"text-align:left\">指定自定义的运行hook文件路径（可以时py文件），在打包好的exe程序中，运行这个exe程序时，指定的hook文件会在所有代码和模块之前运行，包括main文件，以满足一些运行环境的特殊要求，这个选项可以使用多次，同命令“-runtime-hook RUNTIME_HOOKS”.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Analysis参数</td>\n<td style=\"text-align:center\">excludes</td>\n<td style=\"text-align:left\">指定可以被忽略的可选的模块或包，因为某些模块只是PyInstaller根据自身的逻辑去查找的，这些模块对于exe程序本身并没有用到，但是在日志中还是会提示“module not found”，这种日志可以不用管，或者使用这个参数选项来指定不用导入，这个选项可以使用多次。同命令“–exclude-module EXCLUDES”。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">exe参数</td>\n<td style=\"text-align:center\">console</td>\n<td style=\"text-align:left\">设置是否显示命令行窗口，同命令 “-W/-c”</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">exe参数</td>\n<td style=\"text-align:center\">icon</td>\n<td style=\"text-align:left\">设置程序图标，默认spec是没有图标的，需要手动添加，参数值就是图片路径的字符串，同命令“-i/-icon”</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"我的记录\">我的记录</h3>\n<p>在此记录一下detectui的spec文件呢~~~</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># -*- mode: python ; coding: utf-8 -*-</span><br><br><br>block_cipher = <span class=\"hljs-literal\">None</span><br><br><br>a = Analysis([<span class=\"hljs-string\">&#x27;detectui.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\__init__.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\torch_utils.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\autoanchor.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\datasets.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\general.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\google_utils.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\metrics.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\plots.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\__init__.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\common.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\experimental.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\yolo.py&#x27;</span>,<br>              <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\detectInfo.py&#x27;</span>,<br>              ],<br>             pathex=[<span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise&#x27;</span>,<br>             <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models&#x27;</span>,<br>             <span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils&#x27;</span>,<br>             <span class=\"hljs-string\">&#x27;D:\\\\anaconda3\\\\envs\\\\torch\\\\Lib\\\\site-packages\\\\scipy\\\\.libs&#x27;</span>,<br>             <span class=\"hljs-string\">&#x27;D:\\\\anaconda3\\\\envs\\\\torch\\\\Lib\\\\site-packages\\\\torch\\\\lib&#x27;</span>,<br>              ],<br>             binaries=[],<br>             datas=[<br>             (<span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\weights\\\\best.pt&#x27;</span>,<span class=\"hljs-string\">&#x27;.\\\\weights&#x27;</span>),<br>             (<span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\*.yaml&#x27;</span>,<span class=\"hljs-string\">&#x27;.\\\\models&#x27;</span>),<br>             (<span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\models\\\\hub\\\\*.yaml&#x27;</span>,<span class=\"hljs-string\">&#x27;.\\\\models\\\\hub&#x27;</span>),<br>             (<span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\icon.jpg&#x27;</span>,<span class=\"hljs-string\">&#x27;.&#x27;</span>),<br>             (<span class=\"hljs-string\">&#x27;E:\\\\masterProjects\\\\foot\\\\footRevise\\\\utils\\\\__pycache__\\\\torch_utils.pyc&#x27;</span>,<span class=\"hljs-string\">&#x27;.\\\\utils&#x27;</span>),<br>             ],<br>             hiddenimports=[<span class=\"hljs-string\">&#x27;pkg_resources.py2_warn&#x27;</span>,<span class=\"hljs-string\">&#x27;pkg_resources.markers&#x27;</span>],<br>             hookspath=[],<br>             hooksconfig=&#123;&#125;,<br>             runtime_hooks=[],<br>             excludes=[],<br>             win_no_prefer_redirects=<span class=\"hljs-literal\">False</span>,<br>             win_private_assemblies=<span class=\"hljs-literal\">False</span>,<br>             cipher=block_cipher,<br>             noarchive=<span class=\"hljs-literal\">False</span>)<br><span class=\"hljs-keyword\">for</span> d <span class=\"hljs-keyword\">in</span> a.datas:<br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">&#x27;_C.cp38-win_amd64.pyd&#x27;</span> <span class=\"hljs-keyword\">in</span> d[<span class=\"hljs-number\">0</span>]:<br>\t\t    a.datas.remove(d)<br>\t\t    <span class=\"hljs-keyword\">break</span><br>pyz = PYZ(a.pure, a.zipped_data,<br>             cipher=block_cipher)<br><br>exe = EXE(pyz,<br>          a.scripts,<br>          [],<br>          exclude_binaries=<span class=\"hljs-literal\">True</span>,<br>          name=<span class=\"hljs-string\">&#x27;detectui&#x27;</span>,<br>          debug=<span class=\"hljs-literal\">False</span>,<br>          bootloader_ignore_signals=<span class=\"hljs-literal\">False</span>,<br>          strip=<span class=\"hljs-literal\">False</span>,<br>          upx=<span class=\"hljs-literal\">True</span>,<br>          console=<span class=\"hljs-literal\">False</span>,<br>          icon=<span class=\"hljs-string\">&#x27;icon.ico&#x27;</span>)<br>coll = COLLECT(exe,<br>               a.binaries,<br>               a.zipfiles,<br>               a.datas,<br>               strip=<span class=\"hljs-literal\">False</span>,<br>               upx=<span class=\"hljs-literal\">True</span>,<br>               name=<span class=\"hljs-string\">&#x27;detectui&#x27;</span>)<br><br></code></pre></td></tr></table></figure>\n"},{"title":"python-embeded打包文件生成exe","date":"2021-12-29T01:58:14.000Z","_content":"> 使用pyinstaller打包的文件太大了！！所以！所以！学到了另一招，将所需的环境配置到python-embeded中，然后使用c来调用py的启动文件，再gcc生成exe文件，酱紫工程文件就会小很多；实践证明，pyinstaller打包5.2G，采用这种方式后降低到1.5G哦~ 这种方式主要就是使用python-embeded来配置环境。\n\n## 下载embeded版本\n\n- python37的[embedded版本](https://link.zhihu.com/?target=https%3A//www.python.org/downloads/release/python-373/)\n- 下载zip文件解压到某处，比如`E:\\python_embeded\\`\n\n![](https://picture.mulindya.com/python-embeded1.png)\n\n## 安装pip\n\n- 去[官网](https://link.zhihu.com/?target=https%3A//pip.pypa.io/en/stable/installing/%23id7)下载get-pip.py\n\n- 点击installation,下载[get-pip.py]( https://bootstrap.pypa.io/get-pip.py.)文件到`E:\\python_embeded\\`\n\n- 运行该文件。注意使用emdeded版本的python来运行配置要**带路径**哦！\n\n  ```apl\n  #打开cmd,cd到相应的目录下（E:\\python_embeded\\），运行下载的文件\n  E:\\python_embeded\\python.exe  get-pip.py\n  ```\n  \n## 配置相关环境\n常规配置pytorch时，使用以下代码\n```python\n#cpu 版本\npip install torch==1.8.1 torchvision==0.9.1 torchaudio==0.8.1\n\n# CUDA 10.2\nconda install pytorch==1.8.1 torchvision==0.9.1 torchaudio==0.8.1 cudatoolkit=10.2 -c pytorch\n\n# CUDA 10.2\npip install torch==1.8.1+cu102 torchvision==0.9.1+cu102 torchaudio==0.8.1 -f https://download.pytorch.org/whl/torch_stable.html\n```\n\n在python-embeded中，要带上路径哦！\n\n```python\n#打开cmd,cd到相应的目录下（E:\\python_embeded\\），运行下载的文件\n这里使用cpu的torch版本，够用了并且文件更小。\nE:\\python_embeded\\Scripts\\pip.exe  install 相关配置(torch==1.8.1 torchvision==0.9.1 torchaudio==0.8.1 )\n    \nE:\\python_embeded\\Scripts\\pip.exe  install -r requirements.txt #一样的操作\n```\n\n### 配置tkinter\n\n如果项目使用tkinter的话，就单独配置。由于python embedable是不带tkinter的，而且无法通过pip来安装，解决方法：下载一个与python embedable版本相同的python安装包，安装时不要加入环境变量（如果你电脑上已经有anaconda的话），然后将安装路径下的一些文件复制到python embedable的路径下\n\n> /tcl 拷贝到 /\n>\n> /Lib/tkinter 拷贝到 /Lib/site-packages/\n>\n> /DLLs/_tkinter.pyd 拷贝到 /\n>\n> /DLLs/tcl86t.dll 拷贝到 /\n>\n> /DLLs/tk86t.dll 拷贝到 / \n\n### 打包\n\n然后！把这个配置好的embeded文件直接放进项目文件夹中。把启动程序的py文件头中加入以下代码，它的作用是写入环境变量中，这样如果有自定义的包调用才可以找得到哟。\n\n```python\nimport os\ncwd=os.getcwd()\nimport sys\nsys.path.append(cwd)\n```\n\n#### 新建.bat文件\n\n上面是取消黑框命令行，下面是调用启动程序！双击即可运行！\n\n```apl\n@echo off \nif \"%1\" == \"h\" goto begin \nmshta vbscript:createobject(\"wscript.shell\").run(\"%~nx0 h\",0)(window.close)&&exit \n:begin \n\n%CD%\\python_embeded\\python.exe footprint.py \n```\n\n#### 新建.c文件\n\n使用system来用c调用bat文件，后续把c编译为exe文件大功告成啦！\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\n\nint main()\n{\n    system(\"footprint.bat\");\n    return 0;\n}\n```\n\n#### 新建.rc文件（可选）\n\n这个文件指定exe的icon和exe文件的详细信息\n\n```apl\n2 ICON \"icon.ico\"\n1 VERSIONINFO\n\tFILEVERSION     2,3,3,3\n\tPRODUCTVERSION  2,3,3,3\n\tFILEOS 0x4L\n\tBEGIN\n\tBLOCK \"StringFileInfo\"\n\tBEGIN\n\t\tBLOCK \"080404E4\"\n\t\tBEGIN\n\t\tVALUE \"CompanyName\", \"hust\"\n\t\tVALUE \"FileDescription\", \"Project General Launcher\"\n\t\tVALUE \"FileVersion\", \"1.0\"\n\t\tVALUE \"InternalName\", \"Launcher on Windows\"\n\t\tVALUE \"LegalCopyright\", \"GPLv2\"\n\t\tVALUE \"OriginalFilename\", \"足迹矫正\"\n\t\tVALUE \"ProductName\", \"足迹矫正与标注\"\n\t\tVALUE \"ProductVersion\", \"2.3.3 build 42\"\n\t\tVALUE \"Comments\", \"足迹矫正\"\n\t\tEND\n\tEND\n\t\n\tBLOCK \"VarFileInfo\"\n\tBEGIN\n\t\tVALUE \"Translation\", 0x0804, 1252\n\tEND\n\tEND\n```\n\n### 编译成exe\n\n上面命令会生成demo.o目标文件，链接的时候加上这个目标文件编译出来的exe文件就有图标了呀！okk！结束啦~真是艰辛......\n\n```apl\nwindres -i \"demo.rc\" -o \"demo.o\"\ngcc main.c demo.o -o demo.exe\n```\n#### 安装gcc\n\n```apl\ngcc -v\n```\n如果没有gcc的话，参考这边博客https://zhuanlan.zhihu.com/p/47935258\n简单来说就是安装Mingw，然后添加minge32-gcc-g++,点击apply change就可以下载\n","source":"_posts/project_tool/usePyembeded.md","raw":"---\ntitle: python-embeded打包文件生成exe\ntags: [项目打包]\ncategories: [工具,python-embeded]\ndate: 2021-12-29 09:58:14\n---\n> 使用pyinstaller打包的文件太大了！！所以！所以！学到了另一招，将所需的环境配置到python-embeded中，然后使用c来调用py的启动文件，再gcc生成exe文件，酱紫工程文件就会小很多；实践证明，pyinstaller打包5.2G，采用这种方式后降低到1.5G哦~ 这种方式主要就是使用python-embeded来配置环境。\n\n## 下载embeded版本\n\n- python37的[embedded版本](https://link.zhihu.com/?target=https%3A//www.python.org/downloads/release/python-373/)\n- 下载zip文件解压到某处，比如`E:\\python_embeded\\`\n\n![](https://picture.mulindya.com/python-embeded1.png)\n\n## 安装pip\n\n- 去[官网](https://link.zhihu.com/?target=https%3A//pip.pypa.io/en/stable/installing/%23id7)下载get-pip.py\n\n- 点击installation,下载[get-pip.py]( https://bootstrap.pypa.io/get-pip.py.)文件到`E:\\python_embeded\\`\n\n- 运行该文件。注意使用emdeded版本的python来运行配置要**带路径**哦！\n\n  ```apl\n  #打开cmd,cd到相应的目录下（E:\\python_embeded\\），运行下载的文件\n  E:\\python_embeded\\python.exe  get-pip.py\n  ```\n  \n## 配置相关环境\n常规配置pytorch时，使用以下代码\n```python\n#cpu 版本\npip install torch==1.8.1 torchvision==0.9.1 torchaudio==0.8.1\n\n# CUDA 10.2\nconda install pytorch==1.8.1 torchvision==0.9.1 torchaudio==0.8.1 cudatoolkit=10.2 -c pytorch\n\n# CUDA 10.2\npip install torch==1.8.1+cu102 torchvision==0.9.1+cu102 torchaudio==0.8.1 -f https://download.pytorch.org/whl/torch_stable.html\n```\n\n在python-embeded中，要带上路径哦！\n\n```python\n#打开cmd,cd到相应的目录下（E:\\python_embeded\\），运行下载的文件\n这里使用cpu的torch版本，够用了并且文件更小。\nE:\\python_embeded\\Scripts\\pip.exe  install 相关配置(torch==1.8.1 torchvision==0.9.1 torchaudio==0.8.1 )\n    \nE:\\python_embeded\\Scripts\\pip.exe  install -r requirements.txt #一样的操作\n```\n\n### 配置tkinter\n\n如果项目使用tkinter的话，就单独配置。由于python embedable是不带tkinter的，而且无法通过pip来安装，解决方法：下载一个与python embedable版本相同的python安装包，安装时不要加入环境变量（如果你电脑上已经有anaconda的话），然后将安装路径下的一些文件复制到python embedable的路径下\n\n> /tcl 拷贝到 /\n>\n> /Lib/tkinter 拷贝到 /Lib/site-packages/\n>\n> /DLLs/_tkinter.pyd 拷贝到 /\n>\n> /DLLs/tcl86t.dll 拷贝到 /\n>\n> /DLLs/tk86t.dll 拷贝到 / \n\n### 打包\n\n然后！把这个配置好的embeded文件直接放进项目文件夹中。把启动程序的py文件头中加入以下代码，它的作用是写入环境变量中，这样如果有自定义的包调用才可以找得到哟。\n\n```python\nimport os\ncwd=os.getcwd()\nimport sys\nsys.path.append(cwd)\n```\n\n#### 新建.bat文件\n\n上面是取消黑框命令行，下面是调用启动程序！双击即可运行！\n\n```apl\n@echo off \nif \"%1\" == \"h\" goto begin \nmshta vbscript:createobject(\"wscript.shell\").run(\"%~nx0 h\",0)(window.close)&&exit \n:begin \n\n%CD%\\python_embeded\\python.exe footprint.py \n```\n\n#### 新建.c文件\n\n使用system来用c调用bat文件，后续把c编译为exe文件大功告成啦！\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\n\nint main()\n{\n    system(\"footprint.bat\");\n    return 0;\n}\n```\n\n#### 新建.rc文件（可选）\n\n这个文件指定exe的icon和exe文件的详细信息\n\n```apl\n2 ICON \"icon.ico\"\n1 VERSIONINFO\n\tFILEVERSION     2,3,3,3\n\tPRODUCTVERSION  2,3,3,3\n\tFILEOS 0x4L\n\tBEGIN\n\tBLOCK \"StringFileInfo\"\n\tBEGIN\n\t\tBLOCK \"080404E4\"\n\t\tBEGIN\n\t\tVALUE \"CompanyName\", \"hust\"\n\t\tVALUE \"FileDescription\", \"Project General Launcher\"\n\t\tVALUE \"FileVersion\", \"1.0\"\n\t\tVALUE \"InternalName\", \"Launcher on Windows\"\n\t\tVALUE \"LegalCopyright\", \"GPLv2\"\n\t\tVALUE \"OriginalFilename\", \"足迹矫正\"\n\t\tVALUE \"ProductName\", \"足迹矫正与标注\"\n\t\tVALUE \"ProductVersion\", \"2.3.3 build 42\"\n\t\tVALUE \"Comments\", \"足迹矫正\"\n\t\tEND\n\tEND\n\t\n\tBLOCK \"VarFileInfo\"\n\tBEGIN\n\t\tVALUE \"Translation\", 0x0804, 1252\n\tEND\n\tEND\n```\n\n### 编译成exe\n\n上面命令会生成demo.o目标文件，链接的时候加上这个目标文件编译出来的exe文件就有图标了呀！okk！结束啦~真是艰辛......\n\n```apl\nwindres -i \"demo.rc\" -o \"demo.o\"\ngcc main.c demo.o -o demo.exe\n```\n#### 安装gcc\n\n```apl\ngcc -v\n```\n如果没有gcc的话，参考这边博客https://zhuanlan.zhihu.com/p/47935258\n简单来说就是安装Mingw，然后添加minge32-gcc-g++,点击apply change就可以下载\n","slug":"project_tool/usePyembeded","published":1,"updated":"2022-01-18T08:10:17.106Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0by006kast91uae2erx","content":"<blockquote>\n<p>使用pyinstaller打包的文件太大了！！所以！所以！学到了另一招，将所需的环境配置到python-embeded中，然后使用c来调用py的启动文件，再gcc生成exe文件，酱紫工程文件就会小很多；实践证明，pyinstaller打包5.2G，采用这种方式后降低到1.5G哦~ 这种方式主要就是使用python-embeded来配置环境。</p>\n</blockquote>\n<h2 id=\"下载embeded版本\">下载embeded版本</h2>\n<ul>\n<li>python37的<a href=\"https://link.zhihu.com/?target=https%3A//www.python.org/downloads/release/python-373/\">embedded版本</a></li>\n<li>下载zip文件解压到某处，比如<code>E:\\python_embeded\\</code></li>\n</ul>\n<p><img src=\"https://picture.mulindya.com/python-embeded1.png\" alt=\"\"></p>\n<h2 id=\"安装pip\">安装pip</h2>\n<ul>\n<li>\n<p>去<a href=\"https://link.zhihu.com/?target=https%3A//pip.pypa.io/en/stable/installing/%23id7\">官网</a><a href=\"http://xn--get-pip-nw3k7779b.py\">下载get-pip.py</a></p>\n</li>\n<li>\n<p>点击installation,下载<a href=\"https://bootstrap.pypa.io/get-pip.py.\">get-pip.py</a>文件到<code>E:\\python_embeded\\</code></p>\n</li>\n<li>\n<p>运行该文件。注意使用emdeded版本的python来运行配置要<strong>带路径</strong>哦！</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apl\">#打开cmd,cd到相应的目录下（E:\\python_embeded\\），运行下载的文件<br>E:\\python_embeded\\python.exe  get-pip.py<br></code></pre></td></tr></tbody></table></figure>\n</li>\n</ul>\n<h2 id=\"配置相关环境\">配置相关环境</h2>\n<p>常规配置pytorch时，使用以下代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#cpu 版本</span><br>pip install torch==<span class=\"hljs-number\">1.8</span><span class=\"hljs-number\">.1</span> torchvision==<span class=\"hljs-number\">0.9</span><span class=\"hljs-number\">.1</span> torchaudio==<span class=\"hljs-number\">0.8</span><span class=\"hljs-number\">.1</span><br><br><span class=\"hljs-comment\"># CUDA 10.2</span><br>conda install pytorch==<span class=\"hljs-number\">1.8</span><span class=\"hljs-number\">.1</span> torchvision==<span class=\"hljs-number\">0.9</span><span class=\"hljs-number\">.1</span> torchaudio==<span class=\"hljs-number\">0.8</span><span class=\"hljs-number\">.1</span> cudatoolkit=<span class=\"hljs-number\">10.2</span> -c pytorch<br><br><span class=\"hljs-comment\"># CUDA 10.2</span><br>pip install torch==<span class=\"hljs-number\">1.8</span><span class=\"hljs-number\">.1</span>+cu102 torchvision==<span class=\"hljs-number\">0.9</span><span class=\"hljs-number\">.1</span>+cu102 torchaudio==<span class=\"hljs-number\">0.8</span><span class=\"hljs-number\">.1</span> -f https://download.pytorch.org/whl/torch_stable.html<br></code></pre></td></tr></tbody></table></figure>\n<p>在python-embeded中，要带上路径哦！</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#打开cmd,cd到相应的目录下（E:\\python_embeded\\），运行下载的文件</span><br>这里使用cpu的torch版本，够用了并且文件更小。<br>E:\\python_embeded\\Scripts\\pip.exe  install 相关配置(torch==<span class=\"hljs-number\">1.8</span><span class=\"hljs-number\">.1</span> torchvision==<span class=\"hljs-number\">0.9</span><span class=\"hljs-number\">.1</span> torchaudio==<span class=\"hljs-number\">0.8</span><span class=\"hljs-number\">.1</span> )<br>    <br>E:\\python_embeded\\Scripts\\pip.exe  install -r requirements.txt <span class=\"hljs-comment\">#一样的操作</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"配置tkinter\">配置tkinter</h3>\n<p>如果项目使用tkinter的话，就单独配置。由于python embedable是不带tkinter的，而且无法通过pip来安装，解决方法：下载一个与python embedable版本相同的python安装包，安装时不要加入环境变量（如果你电脑上已经有anaconda的话），然后将安装路径下的一些文件复制到python embedable的路径下</p>\n<blockquote>\n<p>/tcl 拷贝到 /</p>\n<p>/Lib/tkinter 拷贝到 /Lib/site-packages/</p>\n<p>/DLLs/_tkinter.pyd 拷贝到 /</p>\n<p>/DLLs/tcl86t.dll 拷贝到 /</p>\n<p>/DLLs/tk86t.dll 拷贝到 /</p>\n</blockquote>\n<h3 id=\"打包\">打包</h3>\n<p>然后！把这个配置好的embeded文件直接放进项目文件夹中。把启动程序的py文件头中加入以下代码，它的作用是写入环境变量中，这样如果有自定义的包调用才可以找得到哟。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> os<br>cwd=os.getcwd()<br><span class=\"hljs-keyword\">import</span> sys<br>sys.path.append(cwd)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"新建-bat文件\">新建.bat文件</h4>\n<p>上面是取消黑框命令行，下面是调用启动程序！双击即可运行！</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apl\">@echo off <br>if \"%1\" == \"h\" goto begin <br>mshta vbscript:createobject(\"wscript.shell\").run(\"%~nx0 h\",0)(window.close)&amp;&amp;exit <br>:begin <br><br>%CD%\\python_embeded\\python.exe footprint.py <br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"新建-c文件\">新建.c文件</h4>\n<p>使用system来用c调用bat文件，后续把c编译为exe文件大功告成啦！</p>\n<figure class=\"highlight c\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs c\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span><span class=\"hljs-meta-string\">&lt;stdio.h&gt;</span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span><span class=\"hljs-meta-string\">&lt;stdlib.h&gt;</span></span><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span></span><br><span class=\"hljs-function\"></span>{<br>    system(<span class=\"hljs-string\">\"footprint.bat\"</span>);<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"新建-rc文件（可选）\">新建.rc文件（可选）</h4>\n<p>这个文件指定exe的icon和exe文件的详细信息</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apl\">2 ICON \"icon.ico\"<br>1 VERSIONINFO<br>\tFILEVERSION     2,3,3,3<br>\tPRODUCTVERSION  2,3,3,3<br>\tFILEOS 0x4L<br>\tBEGIN<br>\tBLOCK \"StringFileInfo\"<br>\tBEGIN<br>\t\tBLOCK \"080404E4\"<br>\t\tBEGIN<br>\t\tVALUE \"CompanyName\", \"hust\"<br>\t\tVALUE \"FileDescription\", \"Project General Launcher\"<br>\t\tVALUE \"FileVersion\", \"1.0\"<br>\t\tVALUE \"InternalName\", \"Launcher on Windows\"<br>\t\tVALUE \"LegalCopyright\", \"GPLv2\"<br>\t\tVALUE \"OriginalFilename\", \"足迹矫正\"<br>\t\tVALUE \"ProductName\", \"足迹矫正与标注\"<br>\t\tVALUE \"ProductVersion\", \"2.3.3 build 42\"<br>\t\tVALUE \"Comments\", \"足迹矫正\"<br>\t\tEND<br>\tEND<br>\t<br>\tBLOCK \"VarFileInfo\"<br>\tBEGIN<br>\t\tVALUE \"Translation\", 0x0804, 1252<br>\tEND<br>\tEND<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"编译成exe\">编译成exe</h3>\n<p>上面命令会生成demo.o目标文件，链接的时候加上这个目标文件编译出来的exe文件就有图标了呀！okk！结束啦~真是艰辛…</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apl\">windres -i \"demo.rc\" -o \"demo.o\"<br>gcc main.c demo.o -o demo.exe<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"安装gcc\">安装gcc</h4>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apl\">gcc -v<br></code></pre></td></tr></tbody></table></figure>\n<p>如果没有gcc的话，参考这边博客https://zhuanlan.zhihu.com/p/47935258<br>\n简单来说就是安装Mingw，然后添加minge32-gcc-g++,点击apply change就可以下载</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>使用pyinstaller打包的文件太大了！！所以！所以！学到了另一招，将所需的环境配置到python-embeded中，然后使用c来调用py的启动文件，再gcc生成exe文件，酱紫工程文件就会小很多；实践证明，pyinstaller打包5.2G，采用这种方式后降低到1.5G哦~ 这种方式主要就是使用python-embeded来配置环境。</p>\n</blockquote>\n<h2 id=\"下载embeded版本\">下载embeded版本</h2>\n<ul>\n<li>python37的<a href=\"https://link.zhihu.com/?target=https%3A//www.python.org/downloads/release/python-373/\">embedded版本</a></li>\n<li>下载zip文件解压到某处，比如<code>E:\\python_embeded\\</code></li>\n</ul>\n<p><img src=\"https://picture.mulindya.com/python-embeded1.png\" alt=\"\"></p>\n<h2 id=\"安装pip\">安装pip</h2>\n<ul>\n<li>\n<p>去<a href=\"https://link.zhihu.com/?target=https%3A//pip.pypa.io/en/stable/installing/%23id7\">官网</a><a href=\"http://xn--get-pip-nw3k7779b.py\">下载get-pip.py</a></p>\n</li>\n<li>\n<p>点击installation,下载<a href=\"https://bootstrap.pypa.io/get-pip.py.\">get-pip.py</a>文件到<code>E:\\python_embeded\\</code></p>\n</li>\n<li>\n<p>运行该文件。注意使用emdeded版本的python来运行配置要<strong>带路径</strong>哦！</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apl\">#打开cmd,cd到相应的目录下（E:\\python_embeded\\），运行下载的文件<br>E:\\python_embeded\\python.exe  get-pip.py<br></code></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"配置相关环境\">配置相关环境</h2>\n<p>常规配置pytorch时，使用以下代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#cpu 版本</span><br>pip install torch==<span class=\"hljs-number\">1.8</span><span class=\"hljs-number\">.1</span> torchvision==<span class=\"hljs-number\">0.9</span><span class=\"hljs-number\">.1</span> torchaudio==<span class=\"hljs-number\">0.8</span><span class=\"hljs-number\">.1</span><br><br><span class=\"hljs-comment\"># CUDA 10.2</span><br>conda install pytorch==<span class=\"hljs-number\">1.8</span><span class=\"hljs-number\">.1</span> torchvision==<span class=\"hljs-number\">0.9</span><span class=\"hljs-number\">.1</span> torchaudio==<span class=\"hljs-number\">0.8</span><span class=\"hljs-number\">.1</span> cudatoolkit=<span class=\"hljs-number\">10.2</span> -c pytorch<br><br><span class=\"hljs-comment\"># CUDA 10.2</span><br>pip install torch==<span class=\"hljs-number\">1.8</span><span class=\"hljs-number\">.1</span>+cu102 torchvision==<span class=\"hljs-number\">0.9</span><span class=\"hljs-number\">.1</span>+cu102 torchaudio==<span class=\"hljs-number\">0.8</span><span class=\"hljs-number\">.1</span> -f https://download.pytorch.org/whl/torch_stable.html<br></code></pre></td></tr></table></figure>\n<p>在python-embeded中，要带上路径哦！</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#打开cmd,cd到相应的目录下（E:\\python_embeded\\），运行下载的文件</span><br>这里使用cpu的torch版本，够用了并且文件更小。<br>E:\\python_embeded\\Scripts\\pip.exe  install 相关配置(torch==<span class=\"hljs-number\">1.8</span><span class=\"hljs-number\">.1</span> torchvision==<span class=\"hljs-number\">0.9</span><span class=\"hljs-number\">.1</span> torchaudio==<span class=\"hljs-number\">0.8</span><span class=\"hljs-number\">.1</span> )<br>    <br>E:\\python_embeded\\Scripts\\pip.exe  install -r requirements.txt <span class=\"hljs-comment\">#一样的操作</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"配置tkinter\">配置tkinter</h3>\n<p>如果项目使用tkinter的话，就单独配置。由于python embedable是不带tkinter的，而且无法通过pip来安装，解决方法：下载一个与python embedable版本相同的python安装包，安装时不要加入环境变量（如果你电脑上已经有anaconda的话），然后将安装路径下的一些文件复制到python embedable的路径下</p>\n<blockquote>\n<p>/tcl 拷贝到 /</p>\n<p>/Lib/tkinter 拷贝到 /Lib/site-packages/</p>\n<p>/DLLs/_tkinter.pyd 拷贝到 /</p>\n<p>/DLLs/tcl86t.dll 拷贝到 /</p>\n<p>/DLLs/tk86t.dll 拷贝到 /</p>\n</blockquote>\n<h3 id=\"打包\">打包</h3>\n<p>然后！把这个配置好的embeded文件直接放进项目文件夹中。把启动程序的py文件头中加入以下代码，它的作用是写入环境变量中，这样如果有自定义的包调用才可以找得到哟。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> os<br>cwd=os.getcwd()<br><span class=\"hljs-keyword\">import</span> sys<br>sys.path.append(cwd)<br></code></pre></td></tr></table></figure>\n<h4 id=\"新建-bat文件\">新建.bat文件</h4>\n<p>上面是取消黑框命令行，下面是调用启动程序！双击即可运行！</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apl\">@echo off <br>if &quot;%1&quot; == &quot;h&quot; goto begin <br>mshta vbscript:createobject(&quot;wscript.shell&quot;).run(&quot;%~nx0 h&quot;,0)(window.close)&amp;&amp;exit <br>:begin <br><br>%CD%\\python_embeded\\python.exe footprint.py <br></code></pre></td></tr></table></figure>\n<h4 id=\"新建-c文件\">新建.c文件</h4>\n<p>使用system来用c调用bat文件，后续把c编译为exe文件大功告成啦！</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs c\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span><span class=\"hljs-meta-string\">&lt;stdio.h&gt;</span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span><span class=\"hljs-meta-string\">&lt;stdlib.h&gt;</span></span><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span></span><br><span class=\"hljs-function\"></span>&#123;<br>    system(<span class=\"hljs-string\">&quot;footprint.bat&quot;</span>);<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>\n<h4 id=\"新建-rc文件（可选）\">新建.rc文件（可选）</h4>\n<p>这个文件指定exe的icon和exe文件的详细信息</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apl\">2 ICON &quot;icon.ico&quot;<br>1 VERSIONINFO<br>\tFILEVERSION     2,3,3,3<br>\tPRODUCTVERSION  2,3,3,3<br>\tFILEOS 0x4L<br>\tBEGIN<br>\tBLOCK &quot;StringFileInfo&quot;<br>\tBEGIN<br>\t\tBLOCK &quot;080404E4&quot;<br>\t\tBEGIN<br>\t\tVALUE &quot;CompanyName&quot;, &quot;hust&quot;<br>\t\tVALUE &quot;FileDescription&quot;, &quot;Project General Launcher&quot;<br>\t\tVALUE &quot;FileVersion&quot;, &quot;1.0&quot;<br>\t\tVALUE &quot;InternalName&quot;, &quot;Launcher on Windows&quot;<br>\t\tVALUE &quot;LegalCopyright&quot;, &quot;GPLv2&quot;<br>\t\tVALUE &quot;OriginalFilename&quot;, &quot;足迹矫正&quot;<br>\t\tVALUE &quot;ProductName&quot;, &quot;足迹矫正与标注&quot;<br>\t\tVALUE &quot;ProductVersion&quot;, &quot;2.3.3 build 42&quot;<br>\t\tVALUE &quot;Comments&quot;, &quot;足迹矫正&quot;<br>\t\tEND<br>\tEND<br>\t<br>\tBLOCK &quot;VarFileInfo&quot;<br>\tBEGIN<br>\t\tVALUE &quot;Translation&quot;, 0x0804, 1252<br>\tEND<br>\tEND<br></code></pre></td></tr></table></figure>\n<h3 id=\"编译成exe\">编译成exe</h3>\n<p>上面命令会生成demo.o目标文件，链接的时候加上这个目标文件编译出来的exe文件就有图标了呀！okk！结束啦~真是艰辛…</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apl\">windres -i &quot;demo.rc&quot; -o &quot;demo.o&quot;<br>gcc main.c demo.o -o demo.exe<br></code></pre></td></tr></table></figure>\n<h4 id=\"安装gcc\">安装gcc</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apl\">gcc -v<br></code></pre></td></tr></table></figure>\n<p>如果没有gcc的话，参考这边博客https://zhuanlan.zhihu.com/p/47935258<br>\n简单来说就是安装Mingw，然后添加minge32-gcc-g++,点击apply change就可以下载</p>\n"},{"title":"Latex中的空格","date":"2022-01-18T11:27:58.000Z","math":true,"_content":"\n>记录Latex在公式中使用空格。\n\n一般情况下使用空格都是`\\quad` 命令。但最近发现这个空格距离太大了，需要小一点的空格。\n所以改用\\ 命令。\n\n## 一个空格\n\n```\na \\quad b\n```\n\n\n$$\na \\quad b\n$$\n\n## 两个空格\n\n```\na \\qquad b\n```\n\n$$\na \\qquad b\n$$\n\n## 一个m的长度\n\n```\na \\ b\n```\n\n$$\na \\ b\n$$\n\n\n\n","source":"_posts/project_tool/quat.md","raw":"---\ntitle: Latex中的空格\ntags: [Latex]\ncategories: [配置]\ndate: 2022-01-18 19:27:58\nmath: true\n---\n\n>记录Latex在公式中使用空格。\n\n一般情况下使用空格都是`\\quad` 命令。但最近发现这个空格距离太大了，需要小一点的空格。\n所以改用\\ 命令。\n\n## 一个空格\n\n```\na \\quad b\n```\n\n\n$$\na \\quad b\n$$\n\n## 两个空格\n\n```\na \\qquad b\n```\n\n$$\na \\qquad b\n$$\n\n## 一个m的长度\n\n```\na \\ b\n```\n\n$$\na \\ b\n$$\n\n\n\n","slug":"project_tool/quat","published":1,"updated":"2022-01-18T11:37:05.448Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0bz006past95fowbnwo","content":"<blockquote>\n<p>记录Latex在公式中使用空格。</p>\n</blockquote>\n<p>一般情况下使用空格都是<code>\\quad</code> 命令。但最近发现这个空格距离太大了，需要小一点的空格。<br>\n所以改用\\ 命令。</p>\n<h2 id=\"一个空格\">一个空格</h2>\n<figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-tag\">a</span> \\quad <span class=\"hljs-selector-tag\">b</span><br></code></pre></td></tr></tbody></table></figure>\n<p>$$<br>\na \\quad b<br>\n$$</p>\n<h2 id=\"两个空格\">两个空格</h2>\n<figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-tag\">a</span> \\qquad <span class=\"hljs-selector-tag\">b</span><br></code></pre></td></tr></tbody></table></figure>\n<p>$$<br>\na \\qquad b<br>\n$$</p>\n<h2 id=\"一个m的长度\">一个m的长度</h2>\n<figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-tag\">a</span> \\ <span class=\"hljs-selector-tag\">b</span><br></code></pre></td></tr></tbody></table></figure>\n<p>$$<br>\na \\ b<br>\n$$</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>记录Latex在公式中使用空格。</p>\n</blockquote>\n<p>一般情况下使用空格都是<code>\\quad</code> 命令。但最近发现这个空格距离太大了，需要小一点的空格。<br>\n所以改用\\ 命令。</p>\n<h2 id=\"一个空格\">一个空格</h2>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-tag\">a</span> \\quad <span class=\"hljs-selector-tag\">b</span><br></code></pre></td></tr></table></figure>\n<p>$$<br>\na \\quad b<br>\n$$</p>\n<h2 id=\"两个空格\">两个空格</h2>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-tag\">a</span> \\qquad <span class=\"hljs-selector-tag\">b</span><br></code></pre></td></tr></table></figure>\n<p>$$<br>\na \\qquad b<br>\n$$</p>\n<h2 id=\"一个m的长度\">一个m的长度</h2>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-tag\">a</span> \\ <span class=\"hljs-selector-tag\">b</span><br></code></pre></td></tr></table></figure>\n<p>$$<br>\na \\ b<br>\n$$</p>\n"},{"title":"使用python删除文件和文件夹","date":"2021-10-06T07:33:02.000Z","_content":"\n> 总结删除文件和文件夹的相关操作和函数。\n\n### 删除单个文件\n\n```python\nos.remove(path)\n# 如果path是一个目录，抛出OSError错误，如果文件不在或者路径错误，会抛出错误\n```\n\n### 删除文件夹\n\n空文件夹\n```python\nos.rmdir(dirName)\nos.removedirs(dirName)\n# 删除目录 dirName，要求dirName必须是个空目录，否则抛出OSError错误\n```\n\n### 递归删除文件夹\n\n非空文件夹\n```python\nimport shutil\nshutil.rmtree()\n```\n\n遍历一个文件夹，先删除子文件，再删除文件夹。\n\n```python\nfor root, dirs, files in os.walk(\"filename\", topdown=False):\n    for name in files:\n        os.remove(os.path.join(root, name))\n    for name in dirs:\n        os.rmdir(os.path.join(root, name))\n \n# os.walk的第一个参数是要遍历并删除子文件夹和文件的目录\n# 上面的代码运行后，文件夹\"filename\"里的文件夹和文件全被删除，但是文件夹\"filename\"还存在\n# 具体可以查下os.walk()的用法，以及其参数topdown的功能\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/python/file/delete-file.md","raw":"---\ntitle: 使用python删除文件和文件夹\ntags: [python,文件]\ncategories: [python,文件]\ndate: 2021-10-06 15:33:02\n---\n\n> 总结删除文件和文件夹的相关操作和函数。\n\n### 删除单个文件\n\n```python\nos.remove(path)\n# 如果path是一个目录，抛出OSError错误，如果文件不在或者路径错误，会抛出错误\n```\n\n### 删除文件夹\n\n空文件夹\n```python\nos.rmdir(dirName)\nos.removedirs(dirName)\n# 删除目录 dirName，要求dirName必须是个空目录，否则抛出OSError错误\n```\n\n### 递归删除文件夹\n\n非空文件夹\n```python\nimport shutil\nshutil.rmtree()\n```\n\n遍历一个文件夹，先删除子文件，再删除文件夹。\n\n```python\nfor root, dirs, files in os.walk(\"filename\", topdown=False):\n    for name in files:\n        os.remove(os.path.join(root, name))\n    for name in dirs:\n        os.rmdir(os.path.join(root, name))\n \n# os.walk的第一个参数是要遍历并删除子文件夹和文件的目录\n# 上面的代码运行后，文件夹\"filename\"里的文件夹和文件全被删除，但是文件夹\"filename\"还存在\n# 具体可以查下os.walk()的用法，以及其参数topdown的功能\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"python/file/delete-file","published":1,"updated":"2022-01-18T08:10:17.107Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0c1006rast99d6dcewy","content":"<blockquote>\n<p>总结删除文件和文件夹的相关操作和函数。</p>\n</blockquote>\n<h3 id=\"删除单个文件\">删除单个文件</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">os.remove(path)<br><span class=\"hljs-comment\"># 如果path是一个目录，抛出OSError错误，如果文件不在或者路径错误，会抛出错误</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"删除文件夹\">删除文件夹</h3>\n<p>空文件夹</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">os.rmdir(dirName)<br>os.removedirs(dirName)<br><span class=\"hljs-comment\"># 删除目录 dirName，要求dirName必须是个空目录，否则抛出OSError错误</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"递归删除文件夹\">递归删除文件夹</h3>\n<p>非空文件夹</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> shutil<br>shutil.rmtree()<br></code></pre></td></tr></tbody></table></figure>\n<p>遍历一个文件夹，先删除子文件，再删除文件夹。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">for</span> root, dirs, files <span class=\"hljs-keyword\">in</span> os.walk(<span class=\"hljs-string\">\"filename\"</span>, topdown=<span class=\"hljs-literal\">False</span>):<br>    <span class=\"hljs-keyword\">for</span> name <span class=\"hljs-keyword\">in</span> files:<br>        os.remove(os.path.join(root, name))<br>    <span class=\"hljs-keyword\">for</span> name <span class=\"hljs-keyword\">in</span> dirs:<br>        os.rmdir(os.path.join(root, name))<br> <br><span class=\"hljs-comment\"># os.walk的第一个参数是要遍历并删除子文件夹和文件的目录</span><br><span class=\"hljs-comment\"># 上面的代码运行后，文件夹\"filename\"里的文件夹和文件全被删除，但是文件夹\"filename\"还存在</span><br><span class=\"hljs-comment\"># 具体可以查下os.walk()的用法，以及其参数topdown的功能</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>总结删除文件和文件夹的相关操作和函数。</p>\n</blockquote>\n<h3 id=\"删除单个文件\">删除单个文件</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">os.remove(path)<br><span class=\"hljs-comment\"># 如果path是一个目录，抛出OSError错误，如果文件不在或者路径错误，会抛出错误</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"删除文件夹\">删除文件夹</h3>\n<p>空文件夹</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">os.rmdir(dirName)<br>os.removedirs(dirName)<br><span class=\"hljs-comment\"># 删除目录 dirName，要求dirName必须是个空目录，否则抛出OSError错误</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"递归删除文件夹\">递归删除文件夹</h3>\n<p>非空文件夹</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> shutil<br>shutil.rmtree()<br></code></pre></td></tr></table></figure>\n<p>遍历一个文件夹，先删除子文件，再删除文件夹。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">for</span> root, dirs, files <span class=\"hljs-keyword\">in</span> os.walk(<span class=\"hljs-string\">&quot;filename&quot;</span>, topdown=<span class=\"hljs-literal\">False</span>):<br>    <span class=\"hljs-keyword\">for</span> name <span class=\"hljs-keyword\">in</span> files:<br>        os.remove(os.path.join(root, name))<br>    <span class=\"hljs-keyword\">for</span> name <span class=\"hljs-keyword\">in</span> dirs:<br>        os.rmdir(os.path.join(root, name))<br> <br><span class=\"hljs-comment\"># os.walk的第一个参数是要遍历并删除子文件夹和文件的目录</span><br><span class=\"hljs-comment\"># 上面的代码运行后，文件夹&quot;filename&quot;里的文件夹和文件全被删除，但是文件夹&quot;filename&quot;还存在</span><br><span class=\"hljs-comment\"># 具体可以查下os.walk()的用法，以及其参数topdown的功能</span><br></code></pre></td></tr></table></figure>\n"},{"title":"np.squeeze的用法","date":"2021-10-29T02:40:22.000Z","_content":"\n> 记录squeeze() 的相关用法，以及pytorch学习 中 torch.squeeze() 和torch.unsqueeze()的用法。\n\n### numpy的squeeze函数\n\n#### 函数说明\n\n适用于一处数组中的单一维度，也就是去掉数组轴中维度为1的维度，函数说明如下：\n\n```python\nnp.squeeze()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-c5986a7939bf> in <module>\n----> 1 np.squeeze()\n\n<__array_function__ internals> in squeeze(*args, **kwargs)\n\nTypeError: _squeeze_dispatcher() missing 1 required positional argument: 'a'\n\n​\nSignature: np.squeeze(a, axis=None)\nDocstring:\nRemove single-dimensional entries from the shape of an array.\n\nParameters\n----------\na : array_like\n    Input data.\naxis : None or int or tuple of ints, optional\n    .. versionadded:: 1.7.0\n\n    Selects a subset of the single-dimensional entries in the\n    shape. If an axis is selected with shape entry greater than\n    one, an error is raised.\n\nReturns\n-------\nsqueezed : ndarray\n    The input array, but with all or a subset of the\n    dimensions of length 1 removed. This is always `a` itself\n    or a view into `a`.\n\nRaises\n------\nValueError\n    If `axis` is not None, and an axis being squeezed is not of length 1\n\nSee Also\n--------\nexpand_dims : The inverse operation, adding singleton dimensions\nreshape : Insert, remove, and combine dimensions, and resize existing ones\n\nExamples\n--------\n>>> x = np.array([[[0], [1], [2]]])\n>>> x.shape\n(1, 3, 1)\n>>> np.squeeze(x).shape\n(3,)\n>>> np.squeeze(x, axis=0).shape\n(3, 1)\n>>> np.squeeze(x, axis=1).shape\nTraceback (most recent call last):\n...\nValueError: cannot select an axis to squeeze out which has size not equal to one\n>>> np.squeeze(x, axis=2).shape\n(1, 3)\n```\n\n#### 举例\n\n指定轴进行压缩单一的维度，如果指定轴维度不为1，就会返回ValueError。\n\n```python\nb = a.reshape(5,1,2,1) #axis 分别为0，1，2，3\nb\narray([[[[ 1],\n         [ 2]]],\n\n\n       [[[ 3],\n         [ 4]]],\n\n\n       [[[ 5],\n         [ 6]]],\n\n\n       [[[ 7],\n         [ 8]]],\n\n\n       [[[ 9],\n         [10]]]])\nnp.squeeze(b,axis=3) #指定维度为1的axis进行squeeze\narray([[[ 1,  2]],\n\n       [[ 3,  4]],\n\n       [[ 5,  6]],\n\n       [[ 7,  8]],\n\n       [[ 9, 10]]])\n\nnp.squeeze(b,axis=1)\narray([[[ 1],\n        [ 2]],\n\n       [[ 3],\n        [ 4]],\n\n       [[ 5],\n        [ 6]],\n\n       [[ 7],\n        [ 8]],\n\n       [[ 9],\n        [10]]])\n        \n```\n\n```python\n如果指定轴为1，就会报错ValueError\nValueError                                Traceback (most recent call last)\n<ipython-input-27-5187bab4a1cf> in <module>\n----> 1 np.squeeze(b,axis=0)\n\n<__array_function__ internals> in squeeze(*args, **kwargs)\n\nD:\\Anaconda3\\lib\\site-packages\\numpy\\core\\fromnumeric.py in squeeze(a, axis)\n   1481         return squeeze()\n   1482     else:\n-> 1483         return squeeze(axis=axis)\n   1484 \n   1485 \n\nValueError: cannot select an axis to squeeze out which has size not equal to one\n```\n\n### pytorch中的squeeze和unsqueeze函数\n\n在pytorch中也有相关的函数，与numpy中的函数类似。\n\nsqueeze的用法主要就是对数据的维度进行压缩或者解压。\n\n先看`torch.squeeze()` 这个函数主要对数据的维度进行压缩，**去掉维数为1的的维度**，比如是一行或者一列这种，一个一行三列（1,3）的数去掉第一个维数为一的维度之后就变成（3）行。squeeze(a)就是将a中所有为1的维度删掉。不为1的维度没有影响。a.squeeze(N) 就是去掉a中指定的维数为一的维度。还有一种形式就是b=torch.squeeze(a，N) a中去掉指定的定的维数为一的维度。\n\n再看`torch.unsqueeze()`这个函数主要是对数据维度进行扩充。**给指定位置加上维数为一的维度**，比如原本有个三行的数据（3），在0的位置加了一维就变成一行三列（1,3）。a.squeeze(N) 就是在a中指定位置N加上一个维数为1的维度。还有一种形式就是b=torch.squeeze(a，N) a就是在a中指定位置N加上一个维数为1的维度\n\n\n","source":"_posts/python/func/squeeze.md","raw":"---\ntitle: np.squeeze的用法\ntags: python\ncategories: python\ndate: 2021-10-29 10:40:22\n---\n\n> 记录squeeze() 的相关用法，以及pytorch学习 中 torch.squeeze() 和torch.unsqueeze()的用法。\n\n### numpy的squeeze函数\n\n#### 函数说明\n\n适用于一处数组中的单一维度，也就是去掉数组轴中维度为1的维度，函数说明如下：\n\n```python\nnp.squeeze()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-c5986a7939bf> in <module>\n----> 1 np.squeeze()\n\n<__array_function__ internals> in squeeze(*args, **kwargs)\n\nTypeError: _squeeze_dispatcher() missing 1 required positional argument: 'a'\n\n​\nSignature: np.squeeze(a, axis=None)\nDocstring:\nRemove single-dimensional entries from the shape of an array.\n\nParameters\n----------\na : array_like\n    Input data.\naxis : None or int or tuple of ints, optional\n    .. versionadded:: 1.7.0\n\n    Selects a subset of the single-dimensional entries in the\n    shape. If an axis is selected with shape entry greater than\n    one, an error is raised.\n\nReturns\n-------\nsqueezed : ndarray\n    The input array, but with all or a subset of the\n    dimensions of length 1 removed. This is always `a` itself\n    or a view into `a`.\n\nRaises\n------\nValueError\n    If `axis` is not None, and an axis being squeezed is not of length 1\n\nSee Also\n--------\nexpand_dims : The inverse operation, adding singleton dimensions\nreshape : Insert, remove, and combine dimensions, and resize existing ones\n\nExamples\n--------\n>>> x = np.array([[[0], [1], [2]]])\n>>> x.shape\n(1, 3, 1)\n>>> np.squeeze(x).shape\n(3,)\n>>> np.squeeze(x, axis=0).shape\n(3, 1)\n>>> np.squeeze(x, axis=1).shape\nTraceback (most recent call last):\n...\nValueError: cannot select an axis to squeeze out which has size not equal to one\n>>> np.squeeze(x, axis=2).shape\n(1, 3)\n```\n\n#### 举例\n\n指定轴进行压缩单一的维度，如果指定轴维度不为1，就会返回ValueError。\n\n```python\nb = a.reshape(5,1,2,1) #axis 分别为0，1，2，3\nb\narray([[[[ 1],\n         [ 2]]],\n\n\n       [[[ 3],\n         [ 4]]],\n\n\n       [[[ 5],\n         [ 6]]],\n\n\n       [[[ 7],\n         [ 8]]],\n\n\n       [[[ 9],\n         [10]]]])\nnp.squeeze(b,axis=3) #指定维度为1的axis进行squeeze\narray([[[ 1,  2]],\n\n       [[ 3,  4]],\n\n       [[ 5,  6]],\n\n       [[ 7,  8]],\n\n       [[ 9, 10]]])\n\nnp.squeeze(b,axis=1)\narray([[[ 1],\n        [ 2]],\n\n       [[ 3],\n        [ 4]],\n\n       [[ 5],\n        [ 6]],\n\n       [[ 7],\n        [ 8]],\n\n       [[ 9],\n        [10]]])\n        \n```\n\n```python\n如果指定轴为1，就会报错ValueError\nValueError                                Traceback (most recent call last)\n<ipython-input-27-5187bab4a1cf> in <module>\n----> 1 np.squeeze(b,axis=0)\n\n<__array_function__ internals> in squeeze(*args, **kwargs)\n\nD:\\Anaconda3\\lib\\site-packages\\numpy\\core\\fromnumeric.py in squeeze(a, axis)\n   1481         return squeeze()\n   1482     else:\n-> 1483         return squeeze(axis=axis)\n   1484 \n   1485 \n\nValueError: cannot select an axis to squeeze out which has size not equal to one\n```\n\n### pytorch中的squeeze和unsqueeze函数\n\n在pytorch中也有相关的函数，与numpy中的函数类似。\n\nsqueeze的用法主要就是对数据的维度进行压缩或者解压。\n\n先看`torch.squeeze()` 这个函数主要对数据的维度进行压缩，**去掉维数为1的的维度**，比如是一行或者一列这种，一个一行三列（1,3）的数去掉第一个维数为一的维度之后就变成（3）行。squeeze(a)就是将a中所有为1的维度删掉。不为1的维度没有影响。a.squeeze(N) 就是去掉a中指定的维数为一的维度。还有一种形式就是b=torch.squeeze(a，N) a中去掉指定的定的维数为一的维度。\n\n再看`torch.unsqueeze()`这个函数主要是对数据维度进行扩充。**给指定位置加上维数为一的维度**，比如原本有个三行的数据（3），在0的位置加了一维就变成一行三列（1,3）。a.squeeze(N) 就是在a中指定位置N加上一个维数为1的维度。还有一种形式就是b=torch.squeeze(a，N) a就是在a中指定位置N加上一个维数为1的维度\n\n\n","slug":"python/func/squeeze","published":1,"updated":"2022-01-18T08:10:17.109Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0c3006uast9huzg0n8s","content":"<blockquote>\n<p>记录squeeze() 的相关用法，以及pytorch学习 中 torch.squeeze() 和torch.unsqueeze()的用法。</p>\n</blockquote>\n<h3 id=\"numpy的squeeze函数\">numpy的squeeze函数</h3>\n<h4 id=\"函数说明\">函数说明</h4>\n<p>适用于一处数组中的单一维度，也就是去掉数组轴中维度为1的维度，函数说明如下：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">np.squeeze()<br>---------------------------------------------------------------------------<br>TypeError                                 Traceback (most recent call last)<br>&lt;ipython-<span class=\"hljs-built_in\">input</span>-<span class=\"hljs-number\">3</span>-c5986a7939bf&gt; <span class=\"hljs-keyword\">in</span> &lt;module&gt;<br>----&gt; <span class=\"hljs-number\">1</span> np.squeeze()<br><br>&lt;__array_function__ internals&gt; <span class=\"hljs-keyword\">in</span> squeeze(*args, **kwargs)<br><br>TypeError: _squeeze_dispatcher() missing <span class=\"hljs-number\">1</span> required positional argument: <span class=\"hljs-string\">'a'</span><br><br>​<br>Signature: np.squeeze(a, axis=<span class=\"hljs-literal\">None</span>)<br>Docstring:<br>Remove single-dimensional entries <span class=\"hljs-keyword\">from</span> the shape of an array.<br><br>Parameters<br>----------<br>a : array_like<br>    Input data.<br>axis : <span class=\"hljs-literal\">None</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">int</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">tuple</span> of ints, optional<br>    .. versionadded:: <span class=\"hljs-number\">1.7</span><span class=\"hljs-number\">.0</span><br><br>    Selects a subset of the single-dimensional entries <span class=\"hljs-keyword\">in</span> the<br>    shape. If an axis <span class=\"hljs-keyword\">is</span> selected <span class=\"hljs-keyword\">with</span> shape entry greater than<br>    one, an error <span class=\"hljs-keyword\">is</span> raised.<br><br>Returns<br>-------<br>squeezed : ndarray<br>    The <span class=\"hljs-built_in\">input</span> array, but <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">all</span> <span class=\"hljs-keyword\">or</span> a subset of the<br>    dimensions of length <span class=\"hljs-number\">1</span> removed. This <span class=\"hljs-keyword\">is</span> always `a` itself<br>    <span class=\"hljs-keyword\">or</span> a view into `a`.<br><br>Raises<br>------<br>ValueError<br>    If `axis` <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span>, <span class=\"hljs-keyword\">and</span> an axis being squeezed <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> of length <span class=\"hljs-number\">1</span><br><br>See Also<br>--------<br>expand_dims : The inverse operation, adding singleton dimensions<br>reshape : Insert, remove, <span class=\"hljs-keyword\">and</span> combine dimensions, <span class=\"hljs-keyword\">and</span> resize existing ones<br><br>Examples<br>--------<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>x = np.array([[[<span class=\"hljs-number\">0</span>], [<span class=\"hljs-number\">1</span>], [<span class=\"hljs-number\">2</span>]]])<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>x.shape<br>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>)<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>np.squeeze(x).shape<br>(<span class=\"hljs-number\">3</span>,)<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>np.squeeze(x, axis=<span class=\"hljs-number\">0</span>).shape<br>(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>)<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>np.squeeze(x, axis=<span class=\"hljs-number\">1</span>).shape<br>Traceback (most recent call last):<br>...<br>ValueError: cannot select an axis to squeeze out which has size <span class=\"hljs-keyword\">not</span> equal to one<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>np.squeeze(x, axis=<span class=\"hljs-number\">2</span>).shape<br>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">3</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"举例\">举例</h4>\n<p>指定轴进行压缩单一的维度，如果指定轴维度不为1，就会返回ValueError。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">b = a.reshape(<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">#axis 分别为0，1，2，3</span><br>b<br>array([[[[ <span class=\"hljs-number\">1</span>],<br>         [ <span class=\"hljs-number\">2</span>]]],<br><br><br>       [[[ <span class=\"hljs-number\">3</span>],<br>         [ <span class=\"hljs-number\">4</span>]]],<br><br><br>       [[[ <span class=\"hljs-number\">5</span>],<br>         [ <span class=\"hljs-number\">6</span>]]],<br><br><br>       [[[ <span class=\"hljs-number\">7</span>],<br>         [ <span class=\"hljs-number\">8</span>]]],<br><br><br>       [[[ <span class=\"hljs-number\">9</span>],<br>         [<span class=\"hljs-number\">10</span>]]]])<br>np.squeeze(b,axis=<span class=\"hljs-number\">3</span>) <span class=\"hljs-comment\">#指定维度为1的axis进行squeeze</span><br>array([[[ <span class=\"hljs-number\">1</span>,  <span class=\"hljs-number\">2</span>]],<br><br>       [[ <span class=\"hljs-number\">3</span>,  <span class=\"hljs-number\">4</span>]],<br><br>       [[ <span class=\"hljs-number\">5</span>,  <span class=\"hljs-number\">6</span>]],<br><br>       [[ <span class=\"hljs-number\">7</span>,  <span class=\"hljs-number\">8</span>]],<br><br>       [[ <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">10</span>]]])<br><br>np.squeeze(b,axis=<span class=\"hljs-number\">1</span>)<br>array([[[ <span class=\"hljs-number\">1</span>],<br>        [ <span class=\"hljs-number\">2</span>]],<br><br>       [[ <span class=\"hljs-number\">3</span>],<br>        [ <span class=\"hljs-number\">4</span>]],<br><br>       [[ <span class=\"hljs-number\">5</span>],<br>        [ <span class=\"hljs-number\">6</span>]],<br><br>       [[ <span class=\"hljs-number\">7</span>],<br>        [ <span class=\"hljs-number\">8</span>]],<br><br>       [[ <span class=\"hljs-number\">9</span>],<br>        [<span class=\"hljs-number\">10</span>]]])<br>        <br></code></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">如果指定轴为<span class=\"hljs-number\">1</span>，就会报错ValueError<br>ValueError                                Traceback (most recent call last)<br>&lt;ipython-<span class=\"hljs-built_in\">input</span>-<span class=\"hljs-number\">27</span>-5187bab4a1cf&gt; <span class=\"hljs-keyword\">in</span> &lt;module&gt;<br>----&gt; <span class=\"hljs-number\">1</span> np.squeeze(b,axis=<span class=\"hljs-number\">0</span>)<br><br>&lt;__array_function__ internals&gt; <span class=\"hljs-keyword\">in</span> squeeze(*args, **kwargs)<br><br>D:\\Anaconda3\\lib\\site-packages\\numpy\\core\\fromnumeric.py <span class=\"hljs-keyword\">in</span> squeeze(a, axis)<br>   <span class=\"hljs-number\">1481</span>         <span class=\"hljs-keyword\">return</span> squeeze()<br>   <span class=\"hljs-number\">1482</span>     <span class=\"hljs-keyword\">else</span>:<br>-&gt; <span class=\"hljs-number\">1483</span>         <span class=\"hljs-keyword\">return</span> squeeze(axis=axis)<br>   <span class=\"hljs-number\">1484</span> <br>   <span class=\"hljs-number\">1485</span> <br><br>ValueError: cannot select an axis to squeeze out which has size <span class=\"hljs-keyword\">not</span> equal to one<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"pytorch中的squeeze和unsqueeze函数\">pytorch中的squeeze和unsqueeze函数</h3>\n<p>在pytorch中也有相关的函数，与numpy中的函数类似。</p>\n<p>squeeze的用法主要就是对数据的维度进行压缩或者解压。</p>\n<p>先看<code>torch.squeeze()</code> 这个函数主要对数据的维度进行压缩，<strong>去掉维数为1的的维度</strong>，比如是一行或者一列这种，一个一行三列（1,3）的数去掉第一个维数为一的维度之后就变成（3）行。squeeze(a)就是将a中所有为1的维度删掉。不为1的维度没有影响。a.squeeze(N) 就是去掉a中指定的维数为一的维度。还有一种形式就是b=torch.squeeze(a，N) a中去掉指定的定的维数为一的维度。</p>\n<p>再看<code>torch.unsqueeze()</code>这个函数主要是对数据维度进行扩充。<strong>给指定位置加上维数为一的维度</strong>，比如原本有个三行的数据（3），在0的位置加了一维就变成一行三列（1,3）。a.squeeze(N) 就是在a中指定位置N加上一个维数为1的维度。还有一种形式就是b=torch.squeeze(a，N) a就是在a中指定位置N加上一个维数为1的维度</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>记录squeeze() 的相关用法，以及pytorch学习 中 torch.squeeze() 和torch.unsqueeze()的用法。</p>\n</blockquote>\n<h3 id=\"numpy的squeeze函数\">numpy的squeeze函数</h3>\n<h4 id=\"函数说明\">函数说明</h4>\n<p>适用于一处数组中的单一维度，也就是去掉数组轴中维度为1的维度，函数说明如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">np.squeeze()<br>---------------------------------------------------------------------------<br>TypeError                                 Traceback (most recent call last)<br>&lt;ipython-<span class=\"hljs-built_in\">input</span>-<span class=\"hljs-number\">3</span>-c5986a7939bf&gt; <span class=\"hljs-keyword\">in</span> &lt;module&gt;<br>----&gt; <span class=\"hljs-number\">1</span> np.squeeze()<br><br>&lt;__array_function__ internals&gt; <span class=\"hljs-keyword\">in</span> squeeze(*args, **kwargs)<br><br>TypeError: _squeeze_dispatcher() missing <span class=\"hljs-number\">1</span> required positional argument: <span class=\"hljs-string\">&#x27;a&#x27;</span><br><br>​<br>Signature: np.squeeze(a, axis=<span class=\"hljs-literal\">None</span>)<br>Docstring:<br>Remove single-dimensional entries <span class=\"hljs-keyword\">from</span> the shape of an array.<br><br>Parameters<br>----------<br>a : array_like<br>    Input data.<br>axis : <span class=\"hljs-literal\">None</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">int</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">tuple</span> of ints, optional<br>    .. versionadded:: <span class=\"hljs-number\">1.7</span><span class=\"hljs-number\">.0</span><br><br>    Selects a subset of the single-dimensional entries <span class=\"hljs-keyword\">in</span> the<br>    shape. If an axis <span class=\"hljs-keyword\">is</span> selected <span class=\"hljs-keyword\">with</span> shape entry greater than<br>    one, an error <span class=\"hljs-keyword\">is</span> raised.<br><br>Returns<br>-------<br>squeezed : ndarray<br>    The <span class=\"hljs-built_in\">input</span> array, but <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">all</span> <span class=\"hljs-keyword\">or</span> a subset of the<br>    dimensions of length <span class=\"hljs-number\">1</span> removed. This <span class=\"hljs-keyword\">is</span> always `a` itself<br>    <span class=\"hljs-keyword\">or</span> a view into `a`.<br><br>Raises<br>------<br>ValueError<br>    If `axis` <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span>, <span class=\"hljs-keyword\">and</span> an axis being squeezed <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> of length <span class=\"hljs-number\">1</span><br><br>See Also<br>--------<br>expand_dims : The inverse operation, adding singleton dimensions<br>reshape : Insert, remove, <span class=\"hljs-keyword\">and</span> combine dimensions, <span class=\"hljs-keyword\">and</span> resize existing ones<br><br>Examples<br>--------<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>x = np.array([[[<span class=\"hljs-number\">0</span>], [<span class=\"hljs-number\">1</span>], [<span class=\"hljs-number\">2</span>]]])<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>x.shape<br>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>)<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>np.squeeze(x).shape<br>(<span class=\"hljs-number\">3</span>,)<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>np.squeeze(x, axis=<span class=\"hljs-number\">0</span>).shape<br>(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>)<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>np.squeeze(x, axis=<span class=\"hljs-number\">1</span>).shape<br>Traceback (most recent call last):<br>...<br>ValueError: cannot select an axis to squeeze out which has size <span class=\"hljs-keyword\">not</span> equal to one<br><span class=\"hljs-meta\">&gt;&gt;&gt; </span>np.squeeze(x, axis=<span class=\"hljs-number\">2</span>).shape<br>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">3</span>)<br></code></pre></td></tr></table></figure>\n<h4 id=\"举例\">举例</h4>\n<p>指定轴进行压缩单一的维度，如果指定轴维度不为1，就会返回ValueError。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">b = a.reshape(<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">#axis 分别为0，1，2，3</span><br>b<br>array([[[[ <span class=\"hljs-number\">1</span>],<br>         [ <span class=\"hljs-number\">2</span>]]],<br><br><br>       [[[ <span class=\"hljs-number\">3</span>],<br>         [ <span class=\"hljs-number\">4</span>]]],<br><br><br>       [[[ <span class=\"hljs-number\">5</span>],<br>         [ <span class=\"hljs-number\">6</span>]]],<br><br><br>       [[[ <span class=\"hljs-number\">7</span>],<br>         [ <span class=\"hljs-number\">8</span>]]],<br><br><br>       [[[ <span class=\"hljs-number\">9</span>],<br>         [<span class=\"hljs-number\">10</span>]]]])<br>np.squeeze(b,axis=<span class=\"hljs-number\">3</span>) <span class=\"hljs-comment\">#指定维度为1的axis进行squeeze</span><br>array([[[ <span class=\"hljs-number\">1</span>,  <span class=\"hljs-number\">2</span>]],<br><br>       [[ <span class=\"hljs-number\">3</span>,  <span class=\"hljs-number\">4</span>]],<br><br>       [[ <span class=\"hljs-number\">5</span>,  <span class=\"hljs-number\">6</span>]],<br><br>       [[ <span class=\"hljs-number\">7</span>,  <span class=\"hljs-number\">8</span>]],<br><br>       [[ <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">10</span>]]])<br><br>np.squeeze(b,axis=<span class=\"hljs-number\">1</span>)<br>array([[[ <span class=\"hljs-number\">1</span>],<br>        [ <span class=\"hljs-number\">2</span>]],<br><br>       [[ <span class=\"hljs-number\">3</span>],<br>        [ <span class=\"hljs-number\">4</span>]],<br><br>       [[ <span class=\"hljs-number\">5</span>],<br>        [ <span class=\"hljs-number\">6</span>]],<br><br>       [[ <span class=\"hljs-number\">7</span>],<br>        [ <span class=\"hljs-number\">8</span>]],<br><br>       [[ <span class=\"hljs-number\">9</span>],<br>        [<span class=\"hljs-number\">10</span>]]])<br>        <br></code></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">如果指定轴为<span class=\"hljs-number\">1</span>，就会报错ValueError<br>ValueError                                Traceback (most recent call last)<br>&lt;ipython-<span class=\"hljs-built_in\">input</span>-<span class=\"hljs-number\">27</span>-5187bab4a1cf&gt; <span class=\"hljs-keyword\">in</span> &lt;module&gt;<br>----&gt; <span class=\"hljs-number\">1</span> np.squeeze(b,axis=<span class=\"hljs-number\">0</span>)<br><br>&lt;__array_function__ internals&gt; <span class=\"hljs-keyword\">in</span> squeeze(*args, **kwargs)<br><br>D:\\Anaconda3\\lib\\site-packages\\numpy\\core\\fromnumeric.py <span class=\"hljs-keyword\">in</span> squeeze(a, axis)<br>   <span class=\"hljs-number\">1481</span>         <span class=\"hljs-keyword\">return</span> squeeze()<br>   <span class=\"hljs-number\">1482</span>     <span class=\"hljs-keyword\">else</span>:<br>-&gt; <span class=\"hljs-number\">1483</span>         <span class=\"hljs-keyword\">return</span> squeeze(axis=axis)<br>   <span class=\"hljs-number\">1484</span> <br>   <span class=\"hljs-number\">1485</span> <br><br>ValueError: cannot select an axis to squeeze out which has size <span class=\"hljs-keyword\">not</span> equal to one<br></code></pre></td></tr></table></figure>\n<h3 id=\"pytorch中的squeeze和unsqueeze函数\">pytorch中的squeeze和unsqueeze函数</h3>\n<p>在pytorch中也有相关的函数，与numpy中的函数类似。</p>\n<p>squeeze的用法主要就是对数据的维度进行压缩或者解压。</p>\n<p>先看<code>torch.squeeze()</code> 这个函数主要对数据的维度进行压缩，<strong>去掉维数为1的的维度</strong>，比如是一行或者一列这种，一个一行三列（1,3）的数去掉第一个维数为一的维度之后就变成（3）行。squeeze(a)就是将a中所有为1的维度删掉。不为1的维度没有影响。a.squeeze(N) 就是去掉a中指定的维数为一的维度。还有一种形式就是b=torch.squeeze(a，N) a中去掉指定的定的维数为一的维度。</p>\n<p>再看<code>torch.unsqueeze()</code>这个函数主要是对数据维度进行扩充。<strong>给指定位置加上维数为一的维度</strong>，比如原本有个三行的数据（3），在0的位置加了一维就变成一行三列（1,3）。a.squeeze(N) 就是在a中指定位置N加上一个维数为1的维度。还有一种形式就是b=torch.squeeze(a，N) a就是在a中指定位置N加上一个维数为1的维度</p>\n"},{"title":"文件处理（复制，移动）","date":"2021-11-25T03:06:10.000Z","_content":"\n> 整理文件的复制，移动等相关操作。相关的模块涉及shuti和os包，针对这两个包对文件操作进行整理。\n\n## shutil\n\nshutil模块包含了一些用于复制文件和文件夹，和文件压缩的函数. \nos模块是Python标准库中一个重要的模块，里面提供了对目录和文件的一般常用操作。而Python另外一个标准库——shutil库，它作为os模块的补充，提供了复制、移动、删除、压缩、解压等操作，\n\n### 拷贝\n\n#### 常规复制方法\n\n\n|        函数         |                             作用                             |\n| :-----------------: | :----------------------------------------------------------: |\n| copyfile( src, dst) | 从源src复制到dst中去。当然前提是目标地址是具备可写权限。抛出的异常信息为IOException. 当前的dst已存在的话就会被覆盖掉 |\n|   copy( src, dst)   |               复制一个文件到一个文件或一个目录               |\n|  copy2( src, dst)   | 在copy上的基础上再复制文件最后访问时间与修改时间也复制过来了，也就是包含文件的属性信息，类似于cp–p的东西 |\n\n- dst：复制至dst文件夹或文件\n\n 一般dst填写相应的文件夹，就会建立同名文件，就会复制文件到对应的文件夹下，如果要复制文件夹就不能用以上函数了。dst可以是个目录，会在该目录下创建与src同名的文件，**若该目录下存在同名文件，将会报错提示已经存在同名文件**。\n\n#### 复制文件内容\n\n如果是复制文件内容到某文件中，则使用`copyfile`，如果存在同名文件，可以覆盖同名文件夹。\n\n```python\nshutil.copyfile(src, dst)\n功能：将src文件内容复制至dst文件\n\nsrc： 源文件路径\ndst： 复制至dst文件，若dst文件不存在，将会生成一个dst文件；若存在将会被覆盖\nfollow_symlinks：设置为True时，若src为软连接，则当成文件复制；如果设置为False，复制软连接。默认为True。Python3新增参数\n\nimport shutil\nshutil.copyfile(\"./资料/1.txt\",\"./资料/1_empty.txt\")\n```\n\n#### 复制目录\n\n`shutil.copytree(src, dst, symlinks=False, ignore=None)`\n功能：复制整个文件目录(无论文件夹是否为空，均可以复制，而且会复制文件夹中的所有内容)\n\n```\nsrc：源文件夹\ndst：复制至dst文件夹，该文件夹会自动创建，需保证此文件夹不存在，否则将报错\nsymlinks：是否复制软连接，True复制软连接，False不复制，软连接会被当成文件复制过来，默认False\nignore：忽略模式，可传入ignore_patterns()\ncopy_function：拷贝文件的方式，可以传入一个可执行的处理函数，默认为copy2，Python3新增参数\nignore_dangling_symlinks：sysmlinks设置为False时，拷贝指向文件已删除的软连接时，将会报错，如果想消除这个异常，可以设置此值为True。默认为False,Python3新增参数\n```\n\n##### 示例\n\n```python\nimport shutil,os\nshutil.copytree(\"./资料/ceshi\",\"./资料/taiget/\",ignore=shutil.ignore_patterns(\"abc.txt\",\"bcd.txt\"))#忽略哪些文件\n```\n\n### 移动\n\n`shutil.move(src, dst)`\n功能：文件移动,可重命名，会删除原文件，新路径需**指定文件名**，注意需要指定文件名，要么可以剪裁文件夹或者文件，要么可以重命名。\n\n```\nsrc：**源文件夹或文件**\ndst：**移动至dst文件夹，或将文件改名为dst文件。**如果src为文件夹，而dst为文件将会报错\ncopy_function：拷贝文件的方式，可以传入一个可执行的处理函数。默认为copy2，Python3新增参数\n```\n\n##### `示例\n\n```python\nimport shutil\n#重命名文件夹\nshutil.move('./资料/ceshi', './资料/ceshi1')\n#移动文件进入新移动的文件夹\nshutil.move('./资料/1-2.txt', './资料/ceshi1')\n```\n\n### 删除文件夹\n\n函数：shutil.rmtree(src)\n含义：删除文件夹；\n参数：src表示源文件夹；\n注意：区别这里和os模块中remove()、rmdir()的用法，remove()方法**只能删除某个文件**，**rmdir()只能删除某个空文件夹**。但是shutil模块中的rmtree()可以递归彻底**删除非空文件夹；**\n\n```python\n# 将c文件夹彻底删除\nsrc = r\".\\publish\\os模块\\test_shutil_c\"\nshutil.rmtree(src)\n```\n\n### 删除文件\n\n函数：删除文件使用`os.remove()`函数进行操作\n\n```python\nimport os  # 导入模块\n\n# 删除目标文件的根目录\nmovabs_path = \"删除文件的目录\" \n\n# 删除操作\nos.remove(rawabs_path+\"test.txt\")\n```\n\n### 解压和压缩文件\n\n函数：`make_archive(base_name, format, root_dir, …)`\n功能：生成压缩文件\n\n```\nbase_name：压缩文件的文件名，不允许有扩展名，因为会根据压缩格式生成相应的扩展名\nformat：压缩格式\nroot_dir：将制定文件夹进行压缩\nget_archive_formats()： 获取支持的压缩文件格式。目前支持的有：tar、zip、gztar、bztar。在Python3还多支持一种格式xztar\n```\n\n#### 示例\n\n```python\nimport shutil\n#指定要压缩的文件\nbase_name = \"./资料/2.txt\"\n#指定压缩形式\nformat = \"zip\"\n#指定压缩后放在哪里\nroot_dir = \"./资料/\"\n\nshutil.make_archive(base_name, format, root_dir)\n```\n\n函数：`unpack_archive(filename, extract_dir=None, format=None)`\n功能：解压操作\n\n```\nfilename：文件路径\nextract_dir：解压至的文件夹路径。文件夹可以不存在，会自动生成\nformat：解压格式，默认为None，会根据扩展名自动选择解压格式\n```\n\n#### 示例\n\n```python\nimport shutil\n#指定压缩文件的地址\nzip_path = \"./资料/2.txt.zip\"\n#指定解压缩到哪里\nextract_dir = \"./资料/ceshi1/\"\nshutil.unpack_archive(zip_path, extract_dir)\n```\n\n## os\n\n在这里整理os的相关操作哦，粗略记录一下\n\n参考：https://blog.csdn.net/silentwolfyh/article/details/74931123\n\n### os目录操作\n\n1.得到当前工作目录，即当前Python脚本工作的目录路径: os.getcwd()\n\n2.返回指定目录下的所有文件和目录名:os.listdir()\n\n3.函数用来删除一个文件:os.remove()\n\n4.删除多个目录：os.removedirs(r“c：\\python”)\n\n5.检验给出的路径是否是一个文件：os.path.isfile()\n\n6.检验给出的路径是否是一个目录：os.path.isdir()\n\n7.判断是否是绝对路径：os.path.isabs()\n\n8.检验给出的路径是否真地存:os.path.exists()\n\n9.返回一个路径的目录名和文件名:os.path.split() eg os.path.split(‘/home/swaroop/byte/code/poem.txt’) 结果：(‘/home/swaroop/byte/code’, ‘poem.txt’)\n\n10.分离扩展名：os.path.splitext()\n\n11.获取路径名：os.path.dirname()\n\n12.获取文件名：os.path.basename()\n\n13.运行shell命令: os.system()\n\n14.读取和设置环境变量:os.getenv() 与os.putenv()\n\n15.给出当前平台使用的行终止符:os.linesep Windows使用’\\r\\n’，Linux使用’\\n’而Mac使用’\\r’\n\n16.指示你正在使用的平台：os.name 对于Windows，它是’nt’，而对于Linux/Unix用户，它是’posix’\n\n17.重命名：os.rename(old， new)\n\n18.创建多级目录：os.makedirs(r“c：\\python\\test”)\n\n19.创建单个目录：os.mkdir(“test”)\n\n20.获取文件属性：os.stat(file)\n\n21.修改文件权限与时间戳：os.chmod(file)\n\n22.终止当前进程：os.exit()\n\n23.获取文件大小：os.path.getsize(filename)\n\n### 2、文件操作方法大全：\n\n1.os.mknod(“test.txt”) #创建空文件\n\n2.fp = open(“test.txt”,w) #直接打开一个文件，如果文件不存在则创建文件\n\n3.关于open 模式：\n\nw：以写方式打开，\n\na：以追加模式打开 (从 EOF 开始, 必要时创建新文件)\n\nr+：以读写模式打开\n\nw+：以读写模式打开 (参见 w )\n\na+：以读写模式打开 (参见 a )\n\nrb：以二进制读模式打开\n\nwb：以二进制写模式打开 (参见 w )\n\nab：以二进制追加模式打开 (参见 a )\n\nrb+：以二进制读写模式打开 (参见 r+ )\n\nwb+：以二进制读写模式打开 (参见 w+ )\n\nab+：以二进制读写模式打开 (参见 a+ )\n\nfp.read([size]) #size为读取的长度，以byte为单位\n\nfp.readline([size]) #读一行，如果定义了size，有可能返回的只是一行的一部分\n\nfp.readlines([size]) #把文件每一行作为一个list的一个成员，并返回这个list。其实它的内部是通过循环调用readline()来实现的。如果提供size参数，size是表示读取内容的总长，也就是说可能只读到文件的一部分。\n\nfp.write(str) #把str写到文件中，write()并不会在str后加上一个换行符\n\nfp.writelines(seq) #把seq的内容全部写到文件中(多行一次性写入)。这个函数也只是忠实地写入，不会在每行后面加上任何东西。\n\nfp.close() #关闭文件。python会在一个文件不用后自动关闭文件，不过这一功能没有保证，最好还是养成自己关闭的习惯。 如果一个文件在关闭后还对其进行操作会产生ValueError\n\nfp.flush() #把缓冲区的内容写入硬盘\n\nfp.fileno() #返回一个长整型的”文件标签“\n\nfp.isatty() #文件是否是一个终端设备文件(unix系统中的)\n\nfp.tell() #返回文件操作标记的当前位置，以文件的开头为原点\n\nfp.next() #返回下一行，并将文件操作标记位移到下一行。把一个file用于for … in file这样的语句时，就是调用next()函数来实现遍历的。\n\nfp.seek(offset[,whence]) #将文件打操作标记移到offset的位置。这个offset一般是相对于文件的开头来计算的，一般为正数。但如果提供了whence参数就不一定了，whence可以为0表示从头开始计算，1表示以当前位置为原点计算。2表示以文件末尾为原点进行计算。需要注意，如果文件以a或a+的模式打开，每次进行写操作时，文件操作标记会自动返回到文件末尾。\n\n### 3、目录操作方法大全\n\n1.创建目录\n\nos.mkdir(“file”)\n","source":"_posts/python/file/fileprocess.md","raw":"---\ntitle: 文件处理（复制，移动）\ntags: [python,文件]\ncategories: [python,文件]\ndate: 2021-11-25 11:06:10\n---\n\n> 整理文件的复制，移动等相关操作。相关的模块涉及shuti和os包，针对这两个包对文件操作进行整理。\n\n## shutil\n\nshutil模块包含了一些用于复制文件和文件夹，和文件压缩的函数. \nos模块是Python标准库中一个重要的模块，里面提供了对目录和文件的一般常用操作。而Python另外一个标准库——shutil库，它作为os模块的补充，提供了复制、移动、删除、压缩、解压等操作，\n\n### 拷贝\n\n#### 常规复制方法\n\n\n|        函数         |                             作用                             |\n| :-----------------: | :----------------------------------------------------------: |\n| copyfile( src, dst) | 从源src复制到dst中去。当然前提是目标地址是具备可写权限。抛出的异常信息为IOException. 当前的dst已存在的话就会被覆盖掉 |\n|   copy( src, dst)   |               复制一个文件到一个文件或一个目录               |\n|  copy2( src, dst)   | 在copy上的基础上再复制文件最后访问时间与修改时间也复制过来了，也就是包含文件的属性信息，类似于cp–p的东西 |\n\n- dst：复制至dst文件夹或文件\n\n 一般dst填写相应的文件夹，就会建立同名文件，就会复制文件到对应的文件夹下，如果要复制文件夹就不能用以上函数了。dst可以是个目录，会在该目录下创建与src同名的文件，**若该目录下存在同名文件，将会报错提示已经存在同名文件**。\n\n#### 复制文件内容\n\n如果是复制文件内容到某文件中，则使用`copyfile`，如果存在同名文件，可以覆盖同名文件夹。\n\n```python\nshutil.copyfile(src, dst)\n功能：将src文件内容复制至dst文件\n\nsrc： 源文件路径\ndst： 复制至dst文件，若dst文件不存在，将会生成一个dst文件；若存在将会被覆盖\nfollow_symlinks：设置为True时，若src为软连接，则当成文件复制；如果设置为False，复制软连接。默认为True。Python3新增参数\n\nimport shutil\nshutil.copyfile(\"./资料/1.txt\",\"./资料/1_empty.txt\")\n```\n\n#### 复制目录\n\n`shutil.copytree(src, dst, symlinks=False, ignore=None)`\n功能：复制整个文件目录(无论文件夹是否为空，均可以复制，而且会复制文件夹中的所有内容)\n\n```\nsrc：源文件夹\ndst：复制至dst文件夹，该文件夹会自动创建，需保证此文件夹不存在，否则将报错\nsymlinks：是否复制软连接，True复制软连接，False不复制，软连接会被当成文件复制过来，默认False\nignore：忽略模式，可传入ignore_patterns()\ncopy_function：拷贝文件的方式，可以传入一个可执行的处理函数，默认为copy2，Python3新增参数\nignore_dangling_symlinks：sysmlinks设置为False时，拷贝指向文件已删除的软连接时，将会报错，如果想消除这个异常，可以设置此值为True。默认为False,Python3新增参数\n```\n\n##### 示例\n\n```python\nimport shutil,os\nshutil.copytree(\"./资料/ceshi\",\"./资料/taiget/\",ignore=shutil.ignore_patterns(\"abc.txt\",\"bcd.txt\"))#忽略哪些文件\n```\n\n### 移动\n\n`shutil.move(src, dst)`\n功能：文件移动,可重命名，会删除原文件，新路径需**指定文件名**，注意需要指定文件名，要么可以剪裁文件夹或者文件，要么可以重命名。\n\n```\nsrc：**源文件夹或文件**\ndst：**移动至dst文件夹，或将文件改名为dst文件。**如果src为文件夹，而dst为文件将会报错\ncopy_function：拷贝文件的方式，可以传入一个可执行的处理函数。默认为copy2，Python3新增参数\n```\n\n##### `示例\n\n```python\nimport shutil\n#重命名文件夹\nshutil.move('./资料/ceshi', './资料/ceshi1')\n#移动文件进入新移动的文件夹\nshutil.move('./资料/1-2.txt', './资料/ceshi1')\n```\n\n### 删除文件夹\n\n函数：shutil.rmtree(src)\n含义：删除文件夹；\n参数：src表示源文件夹；\n注意：区别这里和os模块中remove()、rmdir()的用法，remove()方法**只能删除某个文件**，**rmdir()只能删除某个空文件夹**。但是shutil模块中的rmtree()可以递归彻底**删除非空文件夹；**\n\n```python\n# 将c文件夹彻底删除\nsrc = r\".\\publish\\os模块\\test_shutil_c\"\nshutil.rmtree(src)\n```\n\n### 删除文件\n\n函数：删除文件使用`os.remove()`函数进行操作\n\n```python\nimport os  # 导入模块\n\n# 删除目标文件的根目录\nmovabs_path = \"删除文件的目录\" \n\n# 删除操作\nos.remove(rawabs_path+\"test.txt\")\n```\n\n### 解压和压缩文件\n\n函数：`make_archive(base_name, format, root_dir, …)`\n功能：生成压缩文件\n\n```\nbase_name：压缩文件的文件名，不允许有扩展名，因为会根据压缩格式生成相应的扩展名\nformat：压缩格式\nroot_dir：将制定文件夹进行压缩\nget_archive_formats()： 获取支持的压缩文件格式。目前支持的有：tar、zip、gztar、bztar。在Python3还多支持一种格式xztar\n```\n\n#### 示例\n\n```python\nimport shutil\n#指定要压缩的文件\nbase_name = \"./资料/2.txt\"\n#指定压缩形式\nformat = \"zip\"\n#指定压缩后放在哪里\nroot_dir = \"./资料/\"\n\nshutil.make_archive(base_name, format, root_dir)\n```\n\n函数：`unpack_archive(filename, extract_dir=None, format=None)`\n功能：解压操作\n\n```\nfilename：文件路径\nextract_dir：解压至的文件夹路径。文件夹可以不存在，会自动生成\nformat：解压格式，默认为None，会根据扩展名自动选择解压格式\n```\n\n#### 示例\n\n```python\nimport shutil\n#指定压缩文件的地址\nzip_path = \"./资料/2.txt.zip\"\n#指定解压缩到哪里\nextract_dir = \"./资料/ceshi1/\"\nshutil.unpack_archive(zip_path, extract_dir)\n```\n\n## os\n\n在这里整理os的相关操作哦，粗略记录一下\n\n参考：https://blog.csdn.net/silentwolfyh/article/details/74931123\n\n### os目录操作\n\n1.得到当前工作目录，即当前Python脚本工作的目录路径: os.getcwd()\n\n2.返回指定目录下的所有文件和目录名:os.listdir()\n\n3.函数用来删除一个文件:os.remove()\n\n4.删除多个目录：os.removedirs(r“c：\\python”)\n\n5.检验给出的路径是否是一个文件：os.path.isfile()\n\n6.检验给出的路径是否是一个目录：os.path.isdir()\n\n7.判断是否是绝对路径：os.path.isabs()\n\n8.检验给出的路径是否真地存:os.path.exists()\n\n9.返回一个路径的目录名和文件名:os.path.split() eg os.path.split(‘/home/swaroop/byte/code/poem.txt’) 结果：(‘/home/swaroop/byte/code’, ‘poem.txt’)\n\n10.分离扩展名：os.path.splitext()\n\n11.获取路径名：os.path.dirname()\n\n12.获取文件名：os.path.basename()\n\n13.运行shell命令: os.system()\n\n14.读取和设置环境变量:os.getenv() 与os.putenv()\n\n15.给出当前平台使用的行终止符:os.linesep Windows使用’\\r\\n’，Linux使用’\\n’而Mac使用’\\r’\n\n16.指示你正在使用的平台：os.name 对于Windows，它是’nt’，而对于Linux/Unix用户，它是’posix’\n\n17.重命名：os.rename(old， new)\n\n18.创建多级目录：os.makedirs(r“c：\\python\\test”)\n\n19.创建单个目录：os.mkdir(“test”)\n\n20.获取文件属性：os.stat(file)\n\n21.修改文件权限与时间戳：os.chmod(file)\n\n22.终止当前进程：os.exit()\n\n23.获取文件大小：os.path.getsize(filename)\n\n### 2、文件操作方法大全：\n\n1.os.mknod(“test.txt”) #创建空文件\n\n2.fp = open(“test.txt”,w) #直接打开一个文件，如果文件不存在则创建文件\n\n3.关于open 模式：\n\nw：以写方式打开，\n\na：以追加模式打开 (从 EOF 开始, 必要时创建新文件)\n\nr+：以读写模式打开\n\nw+：以读写模式打开 (参见 w )\n\na+：以读写模式打开 (参见 a )\n\nrb：以二进制读模式打开\n\nwb：以二进制写模式打开 (参见 w )\n\nab：以二进制追加模式打开 (参见 a )\n\nrb+：以二进制读写模式打开 (参见 r+ )\n\nwb+：以二进制读写模式打开 (参见 w+ )\n\nab+：以二进制读写模式打开 (参见 a+ )\n\nfp.read([size]) #size为读取的长度，以byte为单位\n\nfp.readline([size]) #读一行，如果定义了size，有可能返回的只是一行的一部分\n\nfp.readlines([size]) #把文件每一行作为一个list的一个成员，并返回这个list。其实它的内部是通过循环调用readline()来实现的。如果提供size参数，size是表示读取内容的总长，也就是说可能只读到文件的一部分。\n\nfp.write(str) #把str写到文件中，write()并不会在str后加上一个换行符\n\nfp.writelines(seq) #把seq的内容全部写到文件中(多行一次性写入)。这个函数也只是忠实地写入，不会在每行后面加上任何东西。\n\nfp.close() #关闭文件。python会在一个文件不用后自动关闭文件，不过这一功能没有保证，最好还是养成自己关闭的习惯。 如果一个文件在关闭后还对其进行操作会产生ValueError\n\nfp.flush() #把缓冲区的内容写入硬盘\n\nfp.fileno() #返回一个长整型的”文件标签“\n\nfp.isatty() #文件是否是一个终端设备文件(unix系统中的)\n\nfp.tell() #返回文件操作标记的当前位置，以文件的开头为原点\n\nfp.next() #返回下一行，并将文件操作标记位移到下一行。把一个file用于for … in file这样的语句时，就是调用next()函数来实现遍历的。\n\nfp.seek(offset[,whence]) #将文件打操作标记移到offset的位置。这个offset一般是相对于文件的开头来计算的，一般为正数。但如果提供了whence参数就不一定了，whence可以为0表示从头开始计算，1表示以当前位置为原点计算。2表示以文件末尾为原点进行计算。需要注意，如果文件以a或a+的模式打开，每次进行写操作时，文件操作标记会自动返回到文件末尾。\n\n### 3、目录操作方法大全\n\n1.创建目录\n\nos.mkdir(“file”)\n","slug":"python/file/fileprocess","published":1,"updated":"2022-01-18T08:10:17.108Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0c4006wast9d05e7j6l","content":"<blockquote>\n<p>整理文件的复制，移动等相关操作。相关的模块涉及shuti和os包，针对这两个包对文件操作进行整理。</p>\n</blockquote>\n<h2 id=\"shutil\">shutil</h2>\n<p>shutil模块包含了一些用于复制文件和文件夹，和文件压缩的函数.<br>\nos模块是Python标准库中一个重要的模块，里面提供了对目录和文件的一般常用操作。而Python另外一个标准库——shutil库，它作为os模块的补充，提供了复制、移动、删除、压缩、解压等操作，</p>\n<h3 id=\"拷贝\">拷贝</h3>\n<h4 id=\"常规复制方法\">常规复制方法</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">函数</th>\n<th style=\"text-align:center\">作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">copyfile( src, dst)</td>\n<td style=\"text-align:center\">从源src复制到dst中去。当然前提是目标地址是具备可写权限。抛出的异常信息为IOException. 当前的dst已存在的话就会被覆盖掉</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">copy( src, dst)</td>\n<td style=\"text-align:center\">复制一个文件到一个文件或一个目录</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">copy2( src, dst)</td>\n<td style=\"text-align:center\">在copy上的基础上再复制文件最后访问时间与修改时间也复制过来了，也就是包含文件的属性信息，类似于cp–p的东西</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>dst：复制至dst文件夹或文件</li>\n</ul>\n<p>一般dst填写相应的文件夹，就会建立同名文件，就会复制文件到对应的文件夹下，如果要复制文件夹就不能用以上函数了。dst可以是个目录，会在该目录下创建与src同名的文件，<strong>若该目录下存在同名文件，将会报错提示已经存在同名文件</strong>。</p>\n<h4 id=\"复制文件内容\">复制文件内容</h4>\n<p>如果是复制文件内容到某文件中，则使用<code>copyfile</code>，如果存在同名文件，可以覆盖同名文件夹。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">shutil.copyfile(src, dst)<br>功能：将src文件内容复制至dst文件<br><br>src： 源文件路径<br>dst： 复制至dst文件，若dst文件不存在，将会生成一个dst文件；若存在将会被覆盖<br>follow_symlinks：设置为<span class=\"hljs-literal\">True</span>时，若src为软连接，则当成文件复制；如果设置为<span class=\"hljs-literal\">False</span>，复制软连接。默认为<span class=\"hljs-literal\">True</span>。Python3新增参数<br><br><span class=\"hljs-keyword\">import</span> shutil<br>shutil.copyfile(<span class=\"hljs-string\">\"./资料/1.txt\"</span>,<span class=\"hljs-string\">\"./资料/1_empty.txt\"</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"复制目录\">复制目录</h4>\n<p><code>shutil.copytree(src, dst, symlinks=False, ignore=None)</code><br>\n功能：复制整个文件目录(无论文件夹是否为空，均可以复制，而且会复制文件夹中的所有内容)</p>\n<figure class=\"highlight ada\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ada\">src：源文件夹<br>dst：复制至dst文件夹，该文件夹会自动创建，需保证此文件夹不存在，否则将报错<br>symlinks：是否复制软连接，<span class=\"hljs-literal\">True</span>复制软连接，<span class=\"hljs-literal\">False</span>不复制，软连接会被当成文件复制过来，默认<span class=\"hljs-literal\">False</span><br>ignore：忽略模式，可传入ignore_patterns()<br>copy_function：拷贝文件的方式，可以传入一个可执行的处理函数，默认为copy2，Python3新增参数<br>ignore_dangling_symlinks：sysmlinks设置为<span class=\"hljs-literal\">False</span>时，拷贝指向文件已删除的软连接时，将会报错，如果想消除这个异常，可以设置此值为<span class=\"hljs-literal\">True</span>。默认为<span class=\"hljs-literal\">False</span>,Python3新增参数<br></code></pre></td></tr></tbody></table></figure>\n<h5 id=\"示例\">示例</h5>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> shutil,os<br>shutil.copytree(<span class=\"hljs-string\">\"./资料/ceshi\"</span>,<span class=\"hljs-string\">\"./资料/taiget/\"</span>,ignore=shutil.ignore_patterns(<span class=\"hljs-string\">\"abc.txt\"</span>,<span class=\"hljs-string\">\"bcd.txt\"</span>))<span class=\"hljs-comment\">#忽略哪些文件</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"移动\">移动</h3>\n<p><code>shutil.move(src, dst)</code><br>\n功能：文件移动,可重命名，会删除原文件，新路径需<strong>指定文件名</strong>，注意需要指定文件名，要么可以剪裁文件夹或者文件，要么可以重命名。</p>\n<figure class=\"highlight apache\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">src</span>：**源文件夹或文件**<br><span class=\"hljs-attribute\">dst</span>：**移动至dst文件夹，或将文件改名为dst文件。**如果src为文件夹，而dst为文件将会报错<br><span class=\"hljs-attribute\">copy_function</span>：拷贝文件的方式，可以传入一个可执行的处理函数。默认为copy<span class=\"hljs-number\">2</span>，Python<span class=\"hljs-number\">3</span>新增参数<br></code></pre></td></tr></tbody></table></figure>\n<h5 id=\"示例-2\">`示例</h5>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> shutil<br><span class=\"hljs-comment\">#重命名文件夹</span><br>shutil.move(<span class=\"hljs-string\">'./资料/ceshi'</span>, <span class=\"hljs-string\">'./资料/ceshi1'</span>)<br><span class=\"hljs-comment\">#移动文件进入新移动的文件夹</span><br>shutil.move(<span class=\"hljs-string\">'./资料/1-2.txt'</span>, <span class=\"hljs-string\">'./资料/ceshi1'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"删除文件夹\">删除文件夹</h3>\n<p>函数：shutil.rmtree(src)<br>\n含义：删除文件夹；<br>\n参数：src表示源文件夹；<br>\n注意：区别这里和os模块中remove()、rmdir()的用法，remove()方法<strong>只能删除某个文件</strong>，<strong>rmdir()只能删除某个空文件夹</strong>。但是shutil模块中的rmtree()可以递归彻底<strong>删除非空文件夹；</strong></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># 将c文件夹彻底删除</span><br>src = <span class=\"hljs-string\">r\".\\publish\\os模块\\test_shutil_c\"</span><br>shutil.rmtree(src)<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"删除文件\">删除文件</h3>\n<p>函数：删除文件使用<code>os.remove()</code>函数进行操作</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> os  <span class=\"hljs-comment\"># 导入模块</span><br><br><span class=\"hljs-comment\"># 删除目标文件的根目录</span><br>movabs_path = <span class=\"hljs-string\">\"删除文件的目录\"</span> <br><br><span class=\"hljs-comment\"># 删除操作</span><br>os.remove(rawabs_path+<span class=\"hljs-string\">\"test.txt\"</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"解压和压缩文件\">解压和压缩文件</h3>\n<p>函数：<code>make_archive(base_name, format, root_dir, …)</code><br>\n功能：生成压缩文件</p>\n<figure class=\"highlight stylus\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">base_name：压缩文件的文件名，不允许有扩展名，因为会根据压缩格式生成相应的扩展名<br>format：压缩格式<br>root_dir：将制定文件夹进行压缩<br><span class=\"hljs-function\"><span class=\"hljs-title\">get_archive_formats</span><span class=\"hljs-params\">()</span></span>： 获取支持的压缩文件格式。目前支持的有：tar、zip、gztar、bztar。在Python3还多支持一种格式xztar<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"示例-3\">示例</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> shutil<br><span class=\"hljs-comment\">#指定要压缩的文件</span><br>base_name = <span class=\"hljs-string\">\"./资料/2.txt\"</span><br><span class=\"hljs-comment\">#指定压缩形式</span><br><span class=\"hljs-built_in\">format</span> = <span class=\"hljs-string\">\"zip\"</span><br><span class=\"hljs-comment\">#指定压缩后放在哪里</span><br>root_dir = <span class=\"hljs-string\">\"./资料/\"</span><br><br>shutil.make_archive(base_name, <span class=\"hljs-built_in\">format</span>, root_dir)<br></code></pre></td></tr></tbody></table></figure>\n<p>函数：<code>unpack_archive(filename, extract_dir=None, format=None)</code><br>\n功能：解压操作</p>\n<figure class=\"highlight fortran\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs fortran\">filename：文件路径<br>extract_dir：解压至的文件夹路径。文件夹可以不存在，会自动生成<br><span class=\"hljs-keyword\">format</span>：解压格式，默认为<span class=\"hljs-keyword\">None</span>，会根据扩展名自动选择解压格式<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"示例-4\">示例</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> shutil<br><span class=\"hljs-comment\">#指定压缩文件的地址</span><br>zip_path = <span class=\"hljs-string\">\"./资料/2.txt.zip\"</span><br><span class=\"hljs-comment\">#指定解压缩到哪里</span><br>extract_dir = <span class=\"hljs-string\">\"./资料/ceshi1/\"</span><br>shutil.unpack_archive(zip_path, extract_dir)<br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"os\">os</h2>\n<p>在这里整理os的相关操作哦，粗略记录一下</p>\n<p>参考：<a href=\"https://blog.csdn.net/silentwolfyh/article/details/74931123\">https://blog.csdn.net/silentwolfyh/article/details/74931123</a></p>\n<h3 id=\"os目录操作\">os目录操作</h3>\n<p>1.得到当前工作目录，即当前Python脚本工作的目录路径: os.getcwd()</p>\n<p>2.返回指定目录下的所有文件和目录名:os.listdir()</p>\n<p>3.函数用来删除一个文件:os.remove()</p>\n<p>4.删除多个目录：os.removedirs(r“c：\\python”)</p>\n<p>5.检验给出的路径是否是一个文件：os.path.isfile()</p>\n<p>6.检验给出的路径是否是一个目录：os.path.isdir()</p>\n<p>7.判断是否是绝对路径：os.path.isabs()</p>\n<p>8.检验给出的路径是否真地存:os.path.exists()</p>\n<p>9.返回一个路径的目录名和文件名:os.path.split() eg os.path.split(‘/home/swaroop/byte/code/poem.txt’) 结果：(‘/home/swaroop/byte/code’, ‘poem.txt’)</p>\n<p>10.分离扩展名：os.path.splitext()</p>\n<p>11.获取路径名：os.path.dirname()</p>\n<p>12.获取文件名：os.path.basename()</p>\n<p>13.运行shell命令: os.system()</p>\n<p>14.读取和设置环境变量:os.getenv() 与os.putenv()</p>\n<p>15.给出当前平台使用的行终止符:os.linesep Windows使用’\\r\\n’，Linux使用’\\n’而Mac使用’\\r’</p>\n<p>16.指示你正在使用的平台：<a href=\"http://os.name\">os.name</a> 对于Windows，它是’nt’，而对于Linux/Unix用户，它是’posix’</p>\n<p>17.重命名：os.rename(old， new)</p>\n<p>18.创建多级目录：os.makedirs(r“c：\\python\\test”)</p>\n<p>19.创建单个目录：os.mkdir(“test”)</p>\n<p>20.获取文件属性：os.stat(file)</p>\n<p>21.修改文件权限与时间戳：os.chmod(file)</p>\n<p>22.终止当前进程：os.exit()</p>\n<p>23.获取文件大小：os.path.getsize(filename)</p>\n<h3 id=\"2、文件操作方法大全：\">2、文件操作方法大全：</h3>\n<p>1.os.mknod(“test.txt”) #创建空文件</p>\n<p>2.fp = open(“test.txt”,w) #直接打开一个文件，如果文件不存在则创建文件</p>\n<p>3.关于open 模式：</p>\n<p>w：以写方式打开，</p>\n<p>a：以追加模式打开 (从 EOF 开始, 必要时创建新文件)</p>\n<p>r+：以读写模式打开</p>\n<p>w+：以读写模式打开 (参见 w )</p>\n<p>a+：以读写模式打开 (参见 a )</p>\n<p>rb：以二进制读模式打开</p>\n<p>wb：以二进制写模式打开 (参见 w )</p>\n<p>ab：以二进制追加模式打开 (参见 a )</p>\n<p>rb+：以二进制读写模式打开 (参见 r+ )</p>\n<p>wb+：以二进制读写模式打开 (参见 w+ )</p>\n<p>ab+：以二进制读写模式打开 (参见 a+ )</p>\n<p>fp.read([size]) #size为读取的长度，以byte为单位</p>\n<p>fp.readline([size]) #读一行，如果定义了size，有可能返回的只是一行的一部分</p>\n<p>fp.readlines([size]) #把文件每一行作为一个list的一个成员，并返回这个list。其实它的内部是通过循环调用readline()来实现的。如果提供size参数，size是表示读取内容的总长，也就是说可能只读到文件的一部分。</p>\n<p>fp.write(str) #把str写到文件中，write()并不会在str后加上一个换行符</p>\n<p>fp.writelines(seq) #把seq的内容全部写到文件中(多行一次性写入)。这个函数也只是忠实地写入，不会在每行后面加上任何东西。</p>\n<p>fp.close() #关闭文件。python会在一个文件不用后自动关闭文件，不过这一功能没有保证，最好还是养成自己关闭的习惯。 如果一个文件在关闭后还对其进行操作会产生ValueError</p>\n<p>fp.flush() #把缓冲区的内容写入硬盘</p>\n<p>fp.fileno() #返回一个长整型的”文件标签“</p>\n<p>fp.isatty() #文件是否是一个终端设备文件(unix系统中的)</p>\n<p>fp.tell() #返回文件操作标记的当前位置，以文件的开头为原点</p>\n<p>fp.next() #返回下一行，并将文件操作标记位移到下一行。把一个file用于for … in file这样的语句时，就是调用next()函数来实现遍历的。</p>\n<p>fp.seek(offset[,whence]) #将文件打操作标记移到offset的位置。这个offset一般是相对于文件的开头来计算的，一般为正数。但如果提供了whence参数就不一定了，whence可以为0表示从头开始计算，1表示以当前位置为原点计算。2表示以文件末尾为原点进行计算。需要注意，如果文件以a或a+的模式打开，每次进行写操作时，文件操作标记会自动返回到文件末尾。</p>\n<h3 id=\"3、目录操作方法大全\">3、目录操作方法大全</h3>\n<p>1.创建目录</p>\n<p>os.mkdir(“file”)</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>整理文件的复制，移动等相关操作。相关的模块涉及shuti和os包，针对这两个包对文件操作进行整理。</p>\n</blockquote>\n<h2 id=\"shutil\">shutil</h2>\n<p>shutil模块包含了一些用于复制文件和文件夹，和文件压缩的函数.<br>\nos模块是Python标准库中一个重要的模块，里面提供了对目录和文件的一般常用操作。而Python另外一个标准库——shutil库，它作为os模块的补充，提供了复制、移动、删除、压缩、解压等操作，</p>\n<h3 id=\"拷贝\">拷贝</h3>\n<h4 id=\"常规复制方法\">常规复制方法</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">函数</th>\n<th style=\"text-align:center\">作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">copyfile( src, dst)</td>\n<td style=\"text-align:center\">从源src复制到dst中去。当然前提是目标地址是具备可写权限。抛出的异常信息为IOException. 当前的dst已存在的话就会被覆盖掉</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">copy( src, dst)</td>\n<td style=\"text-align:center\">复制一个文件到一个文件或一个目录</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">copy2( src, dst)</td>\n<td style=\"text-align:center\">在copy上的基础上再复制文件最后访问时间与修改时间也复制过来了，也就是包含文件的属性信息，类似于cp–p的东西</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>dst：复制至dst文件夹或文件</li>\n</ul>\n<p>一般dst填写相应的文件夹，就会建立同名文件，就会复制文件到对应的文件夹下，如果要复制文件夹就不能用以上函数了。dst可以是个目录，会在该目录下创建与src同名的文件，<strong>若该目录下存在同名文件，将会报错提示已经存在同名文件</strong>。</p>\n<h4 id=\"复制文件内容\">复制文件内容</h4>\n<p>如果是复制文件内容到某文件中，则使用<code>copyfile</code>，如果存在同名文件，可以覆盖同名文件夹。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">shutil.copyfile(src, dst)<br>功能：将src文件内容复制至dst文件<br><br>src： 源文件路径<br>dst： 复制至dst文件，若dst文件不存在，将会生成一个dst文件；若存在将会被覆盖<br>follow_symlinks：设置为<span class=\"hljs-literal\">True</span>时，若src为软连接，则当成文件复制；如果设置为<span class=\"hljs-literal\">False</span>，复制软连接。默认为<span class=\"hljs-literal\">True</span>。Python3新增参数<br><br><span class=\"hljs-keyword\">import</span> shutil<br>shutil.copyfile(<span class=\"hljs-string\">&quot;./资料/1.txt&quot;</span>,<span class=\"hljs-string\">&quot;./资料/1_empty.txt&quot;</span>)<br></code></pre></td></tr></table></figure>\n<h4 id=\"复制目录\">复制目录</h4>\n<p><code>shutil.copytree(src, dst, symlinks=False, ignore=None)</code><br>\n功能：复制整个文件目录(无论文件夹是否为空，均可以复制，而且会复制文件夹中的所有内容)</p>\n<figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ada\">src：源文件夹<br>dst：复制至dst文件夹，该文件夹会自动创建，需保证此文件夹不存在，否则将报错<br>symlinks：是否复制软连接，<span class=\"hljs-literal\">True</span>复制软连接，<span class=\"hljs-literal\">False</span>不复制，软连接会被当成文件复制过来，默认<span class=\"hljs-literal\">False</span><br>ignore：忽略模式，可传入ignore_patterns()<br>copy_function：拷贝文件的方式，可以传入一个可执行的处理函数，默认为copy2，Python3新增参数<br>ignore_dangling_symlinks：sysmlinks设置为<span class=\"hljs-literal\">False</span>时，拷贝指向文件已删除的软连接时，将会报错，如果想消除这个异常，可以设置此值为<span class=\"hljs-literal\">True</span>。默认为<span class=\"hljs-literal\">False</span>,Python3新增参数<br></code></pre></td></tr></table></figure>\n<h5 id=\"示例\">示例</h5>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> shutil,os<br>shutil.copytree(<span class=\"hljs-string\">&quot;./资料/ceshi&quot;</span>,<span class=\"hljs-string\">&quot;./资料/taiget/&quot;</span>,ignore=shutil.ignore_patterns(<span class=\"hljs-string\">&quot;abc.txt&quot;</span>,<span class=\"hljs-string\">&quot;bcd.txt&quot;</span>))<span class=\"hljs-comment\">#忽略哪些文件</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"移动\">移动</h3>\n<p><code>shutil.move(src, dst)</code><br>\n功能：文件移动,可重命名，会删除原文件，新路径需<strong>指定文件名</strong>，注意需要指定文件名，要么可以剪裁文件夹或者文件，要么可以重命名。</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">src</span>：**源文件夹或文件**<br><span class=\"hljs-attribute\">dst</span>：**移动至dst文件夹，或将文件改名为dst文件。**如果src为文件夹，而dst为文件将会报错<br><span class=\"hljs-attribute\">copy_function</span>：拷贝文件的方式，可以传入一个可执行的处理函数。默认为copy<span class=\"hljs-number\">2</span>，Python<span class=\"hljs-number\">3</span>新增参数<br></code></pre></td></tr></table></figure>\n<h5 id=\"示例-2\">`示例</h5>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> shutil<br><span class=\"hljs-comment\">#重命名文件夹</span><br>shutil.move(<span class=\"hljs-string\">&#x27;./资料/ceshi&#x27;</span>, <span class=\"hljs-string\">&#x27;./资料/ceshi1&#x27;</span>)<br><span class=\"hljs-comment\">#移动文件进入新移动的文件夹</span><br>shutil.move(<span class=\"hljs-string\">&#x27;./资料/1-2.txt&#x27;</span>, <span class=\"hljs-string\">&#x27;./资料/ceshi1&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<h3 id=\"删除文件夹\">删除文件夹</h3>\n<p>函数：shutil.rmtree(src)<br>\n含义：删除文件夹；<br>\n参数：src表示源文件夹；<br>\n注意：区别这里和os模块中remove()、rmdir()的用法，remove()方法<strong>只能删除某个文件</strong>，<strong>rmdir()只能删除某个空文件夹</strong>。但是shutil模块中的rmtree()可以递归彻底<strong>删除非空文件夹；</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># 将c文件夹彻底删除</span><br>src = <span class=\"hljs-string\">r&quot;.\\publish\\os模块\\test_shutil_c&quot;</span><br>shutil.rmtree(src)<br></code></pre></td></tr></table></figure>\n<h3 id=\"删除文件\">删除文件</h3>\n<p>函数：删除文件使用<code>os.remove()</code>函数进行操作</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> os  <span class=\"hljs-comment\"># 导入模块</span><br><br><span class=\"hljs-comment\"># 删除目标文件的根目录</span><br>movabs_path = <span class=\"hljs-string\">&quot;删除文件的目录&quot;</span> <br><br><span class=\"hljs-comment\"># 删除操作</span><br>os.remove(rawabs_path+<span class=\"hljs-string\">&quot;test.txt&quot;</span>)<br></code></pre></td></tr></table></figure>\n<h3 id=\"解压和压缩文件\">解压和压缩文件</h3>\n<p>函数：<code>make_archive(base_name, format, root_dir, …)</code><br>\n功能：生成压缩文件</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">base_name：压缩文件的文件名，不允许有扩展名，因为会根据压缩格式生成相应的扩展名<br>format：压缩格式<br>root_dir：将制定文件夹进行压缩<br><span class=\"hljs-function\"><span class=\"hljs-title\">get_archive_formats</span><span class=\"hljs-params\">()</span></span>： 获取支持的压缩文件格式。目前支持的有：tar、zip、gztar、bztar。在Python3还多支持一种格式xztar<br></code></pre></td></tr></table></figure>\n<h4 id=\"示例-3\">示例</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> shutil<br><span class=\"hljs-comment\">#指定要压缩的文件</span><br>base_name = <span class=\"hljs-string\">&quot;./资料/2.txt&quot;</span><br><span class=\"hljs-comment\">#指定压缩形式</span><br><span class=\"hljs-built_in\">format</span> = <span class=\"hljs-string\">&quot;zip&quot;</span><br><span class=\"hljs-comment\">#指定压缩后放在哪里</span><br>root_dir = <span class=\"hljs-string\">&quot;./资料/&quot;</span><br><br>shutil.make_archive(base_name, <span class=\"hljs-built_in\">format</span>, root_dir)<br></code></pre></td></tr></table></figure>\n<p>函数：<code>unpack_archive(filename, extract_dir=None, format=None)</code><br>\n功能：解压操作</p>\n<figure class=\"highlight fortran\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs fortran\">filename：文件路径<br>extract_dir：解压至的文件夹路径。文件夹可以不存在，会自动生成<br><span class=\"hljs-keyword\">format</span>：解压格式，默认为<span class=\"hljs-keyword\">None</span>，会根据扩展名自动选择解压格式<br></code></pre></td></tr></table></figure>\n<h4 id=\"示例-4\">示例</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> shutil<br><span class=\"hljs-comment\">#指定压缩文件的地址</span><br>zip_path = <span class=\"hljs-string\">&quot;./资料/2.txt.zip&quot;</span><br><span class=\"hljs-comment\">#指定解压缩到哪里</span><br>extract_dir = <span class=\"hljs-string\">&quot;./资料/ceshi1/&quot;</span><br>shutil.unpack_archive(zip_path, extract_dir)<br></code></pre></td></tr></table></figure>\n<h2 id=\"os\">os</h2>\n<p>在这里整理os的相关操作哦，粗略记录一下</p>\n<p>参考：<a href=\"https://blog.csdn.net/silentwolfyh/article/details/74931123\">https://blog.csdn.net/silentwolfyh/article/details/74931123</a></p>\n<h3 id=\"os目录操作\">os目录操作</h3>\n<p>1.得到当前工作目录，即当前Python脚本工作的目录路径: os.getcwd()</p>\n<p>2.返回指定目录下的所有文件和目录名:os.listdir()</p>\n<p>3.函数用来删除一个文件:os.remove()</p>\n<p>4.删除多个目录：os.removedirs(r“c：\\python”)</p>\n<p>5.检验给出的路径是否是一个文件：os.path.isfile()</p>\n<p>6.检验给出的路径是否是一个目录：os.path.isdir()</p>\n<p>7.判断是否是绝对路径：os.path.isabs()</p>\n<p>8.检验给出的路径是否真地存:os.path.exists()</p>\n<p>9.返回一个路径的目录名和文件名:os.path.split() eg os.path.split(‘/home/swaroop/byte/code/poem.txt’) 结果：(‘/home/swaroop/byte/code’, ‘poem.txt’)</p>\n<p>10.分离扩展名：os.path.splitext()</p>\n<p>11.获取路径名：os.path.dirname()</p>\n<p>12.获取文件名：os.path.basename()</p>\n<p>13.运行shell命令: os.system()</p>\n<p>14.读取和设置环境变量:os.getenv() 与os.putenv()</p>\n<p>15.给出当前平台使用的行终止符:os.linesep Windows使用’\\r\\n’，Linux使用’\\n’而Mac使用’\\r’</p>\n<p>16.指示你正在使用的平台：<a href=\"http://os.name\">os.name</a> 对于Windows，它是’nt’，而对于Linux/Unix用户，它是’posix’</p>\n<p>17.重命名：os.rename(old， new)</p>\n<p>18.创建多级目录：os.makedirs(r“c：\\python\\test”)</p>\n<p>19.创建单个目录：os.mkdir(“test”)</p>\n<p>20.获取文件属性：os.stat(file)</p>\n<p>21.修改文件权限与时间戳：os.chmod(file)</p>\n<p>22.终止当前进程：os.exit()</p>\n<p>23.获取文件大小：os.path.getsize(filename)</p>\n<h3 id=\"2、文件操作方法大全：\">2、文件操作方法大全：</h3>\n<p>1.os.mknod(“test.txt”) #创建空文件</p>\n<p>2.fp = open(“test.txt”,w) #直接打开一个文件，如果文件不存在则创建文件</p>\n<p>3.关于open 模式：</p>\n<p>w：以写方式打开，</p>\n<p>a：以追加模式打开 (从 EOF 开始, 必要时创建新文件)</p>\n<p>r+：以读写模式打开</p>\n<p>w+：以读写模式打开 (参见 w )</p>\n<p>a+：以读写模式打开 (参见 a )</p>\n<p>rb：以二进制读模式打开</p>\n<p>wb：以二进制写模式打开 (参见 w )</p>\n<p>ab：以二进制追加模式打开 (参见 a )</p>\n<p>rb+：以二进制读写模式打开 (参见 r+ )</p>\n<p>wb+：以二进制读写模式打开 (参见 w+ )</p>\n<p>ab+：以二进制读写模式打开 (参见 a+ )</p>\n<p>fp.read([size]) #size为读取的长度，以byte为单位</p>\n<p>fp.readline([size]) #读一行，如果定义了size，有可能返回的只是一行的一部分</p>\n<p>fp.readlines([size]) #把文件每一行作为一个list的一个成员，并返回这个list。其实它的内部是通过循环调用readline()来实现的。如果提供size参数，size是表示读取内容的总长，也就是说可能只读到文件的一部分。</p>\n<p>fp.write(str) #把str写到文件中，write()并不会在str后加上一个换行符</p>\n<p>fp.writelines(seq) #把seq的内容全部写到文件中(多行一次性写入)。这个函数也只是忠实地写入，不会在每行后面加上任何东西。</p>\n<p>fp.close() #关闭文件。python会在一个文件不用后自动关闭文件，不过这一功能没有保证，最好还是养成自己关闭的习惯。 如果一个文件在关闭后还对其进行操作会产生ValueError</p>\n<p>fp.flush() #把缓冲区的内容写入硬盘</p>\n<p>fp.fileno() #返回一个长整型的”文件标签“</p>\n<p>fp.isatty() #文件是否是一个终端设备文件(unix系统中的)</p>\n<p>fp.tell() #返回文件操作标记的当前位置，以文件的开头为原点</p>\n<p>fp.next() #返回下一行，并将文件操作标记位移到下一行。把一个file用于for … in file这样的语句时，就是调用next()函数来实现遍历的。</p>\n<p>fp.seek(offset[,whence]) #将文件打操作标记移到offset的位置。这个offset一般是相对于文件的开头来计算的，一般为正数。但如果提供了whence参数就不一定了，whence可以为0表示从头开始计算，1表示以当前位置为原点计算。2表示以文件末尾为原点进行计算。需要注意，如果文件以a或a+的模式打开，每次进行写操作时，文件操作标记会自动返回到文件末尾。</p>\n<h3 id=\"3、目录操作方法大全\">3、目录操作方法大全</h3>\n<p>1.创建目录</p>\n<p>os.mkdir(“file”)</p>\n"},{"title":"分割文件名相关操作","date":"2021-10-07T02:34:04.000Z","_content":"\n> 对文件名的相关操作总结\n\n### 函数介绍\n\n`os.path`相关函数\n\n```python\nos.path.split() #分割文件名\nos.path.splitdrive() #分割盘符\nos.path.splitext() #分割扩展名\nos.path.basename() #获取文件名，split的后一元素\nos.path.dirname()  #获取路径名，split的前一元素\nos.path.join()     #连接path字符串\n```\n\n`os`相关函数\n\n```python\nos.walk()     #遍历路径下的文件信息和子文件信息（root，dir，file的形式）\nos.listdir()  #返回路径下的文件信息\n```\n\n### 具体介绍\n\n#### os.path.split()\n\n`os.path.split()`函数返回路径的元组信息（父路径，文件名）\n\n```python\nSignature: os.path.split(p)\nDocstring:\nSplit a pathname.\n\nReturn tuple (head, tail) where tail is everything after the final slash.\nEither part may be empty.\nFile:      d:\\anaconda3\\lib\\ntpath.py\nType:      function\n    \n例如：\nspath = \"./a/b/c/name.txt\"\npath,filename = os.path.split(spath)\npath,filename为('./a/b/c', 'name.txt')\n```\n\n#### os.path.splitdrive()\n\n`os.path.splitdrive()`函数返回元组信息（盘符，路径（除去盘符））\n\n```python\nSignature: os.path.splitdrive(p)\nDocstring:\nSplit a pathname into drive/UNC sharepoint and relative path specifiers.\nReturns a 2-tuple (drive_or_unc, path); either part may be empty.\n\nIf you assign\n    result = splitdrive(p)\nIt is always true that:\n    result[0] + result[1] == p\n\nIf the path contained a drive letter, drive_or_unc will contain everything\nup to and including the colon.  e.g. splitdrive(\"c:/dir\") returns (\"c:\", \"/dir\")\n\nIf the path contained a UNC path, the drive_or_unc will contain the host name\nand share up to but not including the fourth directory separator character.\ne.g. splitdrive(\"//host/computer/dir\") returns (\"//host/computer\", \"/dir\")\n\nPaths cannot contain both a drive letter and a UNC path.\nFile:      d:\\anaconda3\\lib\\ntpath.py\nType:      function\n    \n例如：  \ncpath = \"C:/a/b/a.csv\"\nos.path.splitdrive(cpath)\n('C:', '/a/b/a.csv')\n```\n\n#### os.path.splitext()\n\n`os.path.splitext()`返回路径的元组信息（路径及文件名，扩展名）\n\n```python\nSignature: os.path.splitext(p)\nDocstring:\nSplit the extension from a pathname.\n```\n\n#### os.path.dirname()与os.path.basename()\n\n`os.path.dirname()`和`os.path.basename()`分别返回`split`函数的前后元素。\n\n```python\nSignature: os.path.basename(p)\nDocstring: Returns the final component of a pathname\nFile:      d:\\anaconda3\\lib\\ntpath.py\nType:      function\n    \n例如：\ncpath = \"C:/a/b/a.csv\"\nos.path.dirname(cpath) #dirpath\n'C:/a/b'\nos.path.basename(cpath) #filename\n'a.csv'\n相当于split的分解：\nos.path.split(cpath)\n('C:/a/b', 'a.csv')\n```\n\n#### os.path.join()\n\n`os.path.join()`使用特定的分隔符连接路径。Windows下默认使用`\\\\`。Linux下默认使用`/`。\n\n```python\nSignature: os.path.join(path, *paths)\nDocstring: <no docstring>\nFile:      d:\\anaconda3\\lib\\ntpath.py\nType:      function\n    \n例如：\nos.path.join('./a/b/c', \"a123\", 'name.txt') \n'./a/b/c\\\\a123\\\\name.txt'\n```\n\n#### os.walk()\n\n`os.walk()`遍历文件夹下的文件和子文件夹，然后递归遍历下列子文件夹。`for root,dirs,files in os.walk(temp)`\n\n\n```python\nSignature: os.walk(top, topdown=True, onerror=None, followlinks=False)\nDocstring:\nDirectory tree generator.\n\nFor each directory in the directory tree rooted at top (including top\nitself, but excluding '.' and '..'), yields a 3-tuple\n    dirpath, dirnames, filenames\ndirpath is a string, the path to the directory.  dirnames is a list of\nthe names of the subdirectories in dirpath (excluding '.' and '..').\nfilenames is a list of the names of the non-directory files in dirpath.\nNote that the names in the lists are just names, with no path components.\nTo get a full path (which begins with top) to a file or directory in\ndirpath, do os.path.join(dirpath, name).\n\nIf optional arg 'topdown' is true or not specified, the triple for a\ndirectory is generated before the triples for any of its subdirectories\n(directories are generated top down).  If topdown is false, the triple\nfor a directory is generated after the triples for all of its\nsubdirectories (directories are generated bottom up).\n\nCaution:  if you pass a relative pathname for top, don't change the\ncurrent working directory between resumptions of walk.  walk never\nchanges the current directory, and assumes that the client doesn't\neither.\n例如：\ntemp = \"E:\\迅雷下载\"\nfor root,dirs,files in os.walk(temp,topdown=False):\n    #遍历文件夹下的文件和子目录 root,dirs,files,topdown为false时表示从底向上，为true是从顶向下\n    for name in files:\n        print(os.path.join(root,name))\n    for name in dirs:\n        print(os.path.join(root,name))\n        \nE:\\迅雷下载\\Suplicant_for_Campus_Network_For_Windows_V6.61\\Suplicant_for_Campus_Network_For_Windows_V6.61.exe\nE:\\迅雷下载\\cuda_10.2.89_441.22_win10.exe\nE:\\迅雷下载\\Git-2.33.0.2-64-bit.exe\nE:\\迅雷下载\\ide-eval-resetter-2.1.13.zip\nE:\\迅雷下载\\npp.8.1.4.Installer.exe\nE:\\迅雷下载\\sogou_explorer_11.0.0.33862_7793.exe\nE:\\迅雷下载\\windows_v6.61.rar\nE:\\迅雷下载\\Suplicant_for_Campus_Network_For_Windows_V6.61 \n```\n\n#### os.listdir()\n\n`os.listdir()`返回文件夹下的所有一级文件夹和文件。\n\n```python\nSignature: os.listdir(path=None)\nDocstring:\nReturn a list containing the names of the files in the directory.\n\npath can be specified as either str, bytes, or a path-like object.  If path is bytes,\n  the filenames returned will also be bytes; in all other circumstances\n  the filenames returned will be str.\nIf path is None, uses the path='.'.\nOn some platforms, path may also be specified as an open file descriptor;\\\n  the file descriptor must refer to a directory.\n  If this functionality is unavailable, using it raises NotImplementedError.\n\nThe list is in arbitrary order.  It does not include the special\nentries '.' and '..' even if they are present in the directory.\nType:      builtin_function_or_method\n    \n例如：\ntemp = \"E:\\迅雷下载\"\nos.listdir(temp) #列出dirname下的目录和文件\n['cuda_10.2.89_441.22_win10.exe',\n 'Git-2.33.0.2-64-bit.exe',\n 'ide-eval-resetter-2.1.13.zip',\n 'npp.8.1.4.Installer.exe',\n 'sogou_explorer_11.0.0.33862_7793.exe',\n 'Suplicant_for_Campus_Network_For_Windows_V6.61',\n 'windows_v6.61.rar']\n```\n\n","source":"_posts/python/file/split-filename.md","raw":"---\ntitle: 分割文件名相关操作\ntags: [python,文件]\ncategories: [python,文件]\ndate: 2021-10-07 10:34:04\n---\n\n> 对文件名的相关操作总结\n\n### 函数介绍\n\n`os.path`相关函数\n\n```python\nos.path.split() #分割文件名\nos.path.splitdrive() #分割盘符\nos.path.splitext() #分割扩展名\nos.path.basename() #获取文件名，split的后一元素\nos.path.dirname()  #获取路径名，split的前一元素\nos.path.join()     #连接path字符串\n```\n\n`os`相关函数\n\n```python\nos.walk()     #遍历路径下的文件信息和子文件信息（root，dir，file的形式）\nos.listdir()  #返回路径下的文件信息\n```\n\n### 具体介绍\n\n#### os.path.split()\n\n`os.path.split()`函数返回路径的元组信息（父路径，文件名）\n\n```python\nSignature: os.path.split(p)\nDocstring:\nSplit a pathname.\n\nReturn tuple (head, tail) where tail is everything after the final slash.\nEither part may be empty.\nFile:      d:\\anaconda3\\lib\\ntpath.py\nType:      function\n    \n例如：\nspath = \"./a/b/c/name.txt\"\npath,filename = os.path.split(spath)\npath,filename为('./a/b/c', 'name.txt')\n```\n\n#### os.path.splitdrive()\n\n`os.path.splitdrive()`函数返回元组信息（盘符，路径（除去盘符））\n\n```python\nSignature: os.path.splitdrive(p)\nDocstring:\nSplit a pathname into drive/UNC sharepoint and relative path specifiers.\nReturns a 2-tuple (drive_or_unc, path); either part may be empty.\n\nIf you assign\n    result = splitdrive(p)\nIt is always true that:\n    result[0] + result[1] == p\n\nIf the path contained a drive letter, drive_or_unc will contain everything\nup to and including the colon.  e.g. splitdrive(\"c:/dir\") returns (\"c:\", \"/dir\")\n\nIf the path contained a UNC path, the drive_or_unc will contain the host name\nand share up to but not including the fourth directory separator character.\ne.g. splitdrive(\"//host/computer/dir\") returns (\"//host/computer\", \"/dir\")\n\nPaths cannot contain both a drive letter and a UNC path.\nFile:      d:\\anaconda3\\lib\\ntpath.py\nType:      function\n    \n例如：  \ncpath = \"C:/a/b/a.csv\"\nos.path.splitdrive(cpath)\n('C:', '/a/b/a.csv')\n```\n\n#### os.path.splitext()\n\n`os.path.splitext()`返回路径的元组信息（路径及文件名，扩展名）\n\n```python\nSignature: os.path.splitext(p)\nDocstring:\nSplit the extension from a pathname.\n```\n\n#### os.path.dirname()与os.path.basename()\n\n`os.path.dirname()`和`os.path.basename()`分别返回`split`函数的前后元素。\n\n```python\nSignature: os.path.basename(p)\nDocstring: Returns the final component of a pathname\nFile:      d:\\anaconda3\\lib\\ntpath.py\nType:      function\n    \n例如：\ncpath = \"C:/a/b/a.csv\"\nos.path.dirname(cpath) #dirpath\n'C:/a/b'\nos.path.basename(cpath) #filename\n'a.csv'\n相当于split的分解：\nos.path.split(cpath)\n('C:/a/b', 'a.csv')\n```\n\n#### os.path.join()\n\n`os.path.join()`使用特定的分隔符连接路径。Windows下默认使用`\\\\`。Linux下默认使用`/`。\n\n```python\nSignature: os.path.join(path, *paths)\nDocstring: <no docstring>\nFile:      d:\\anaconda3\\lib\\ntpath.py\nType:      function\n    \n例如：\nos.path.join('./a/b/c', \"a123\", 'name.txt') \n'./a/b/c\\\\a123\\\\name.txt'\n```\n\n#### os.walk()\n\n`os.walk()`遍历文件夹下的文件和子文件夹，然后递归遍历下列子文件夹。`for root,dirs,files in os.walk(temp)`\n\n\n```python\nSignature: os.walk(top, topdown=True, onerror=None, followlinks=False)\nDocstring:\nDirectory tree generator.\n\nFor each directory in the directory tree rooted at top (including top\nitself, but excluding '.' and '..'), yields a 3-tuple\n    dirpath, dirnames, filenames\ndirpath is a string, the path to the directory.  dirnames is a list of\nthe names of the subdirectories in dirpath (excluding '.' and '..').\nfilenames is a list of the names of the non-directory files in dirpath.\nNote that the names in the lists are just names, with no path components.\nTo get a full path (which begins with top) to a file or directory in\ndirpath, do os.path.join(dirpath, name).\n\nIf optional arg 'topdown' is true or not specified, the triple for a\ndirectory is generated before the triples for any of its subdirectories\n(directories are generated top down).  If topdown is false, the triple\nfor a directory is generated after the triples for all of its\nsubdirectories (directories are generated bottom up).\n\nCaution:  if you pass a relative pathname for top, don't change the\ncurrent working directory between resumptions of walk.  walk never\nchanges the current directory, and assumes that the client doesn't\neither.\n例如：\ntemp = \"E:\\迅雷下载\"\nfor root,dirs,files in os.walk(temp,topdown=False):\n    #遍历文件夹下的文件和子目录 root,dirs,files,topdown为false时表示从底向上，为true是从顶向下\n    for name in files:\n        print(os.path.join(root,name))\n    for name in dirs:\n        print(os.path.join(root,name))\n        \nE:\\迅雷下载\\Suplicant_for_Campus_Network_For_Windows_V6.61\\Suplicant_for_Campus_Network_For_Windows_V6.61.exe\nE:\\迅雷下载\\cuda_10.2.89_441.22_win10.exe\nE:\\迅雷下载\\Git-2.33.0.2-64-bit.exe\nE:\\迅雷下载\\ide-eval-resetter-2.1.13.zip\nE:\\迅雷下载\\npp.8.1.4.Installer.exe\nE:\\迅雷下载\\sogou_explorer_11.0.0.33862_7793.exe\nE:\\迅雷下载\\windows_v6.61.rar\nE:\\迅雷下载\\Suplicant_for_Campus_Network_For_Windows_V6.61 \n```\n\n#### os.listdir()\n\n`os.listdir()`返回文件夹下的所有一级文件夹和文件。\n\n```python\nSignature: os.listdir(path=None)\nDocstring:\nReturn a list containing the names of the files in the directory.\n\npath can be specified as either str, bytes, or a path-like object.  If path is bytes,\n  the filenames returned will also be bytes; in all other circumstances\n  the filenames returned will be str.\nIf path is None, uses the path='.'.\nOn some platforms, path may also be specified as an open file descriptor;\\\n  the file descriptor must refer to a directory.\n  If this functionality is unavailable, using it raises NotImplementedError.\n\nThe list is in arbitrary order.  It does not include the special\nentries '.' and '..' even if they are present in the directory.\nType:      builtin_function_or_method\n    \n例如：\ntemp = \"E:\\迅雷下载\"\nos.listdir(temp) #列出dirname下的目录和文件\n['cuda_10.2.89_441.22_win10.exe',\n 'Git-2.33.0.2-64-bit.exe',\n 'ide-eval-resetter-2.1.13.zip',\n 'npp.8.1.4.Installer.exe',\n 'sogou_explorer_11.0.0.33862_7793.exe',\n 'Suplicant_for_Campus_Network_For_Windows_V6.61',\n 'windows_v6.61.rar']\n```\n\n","slug":"python/file/split-filename","published":1,"updated":"2022-01-18T08:10:17.108Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0c60071ast98p98ev6t","content":"<blockquote>\n<p>对文件名的相关操作总结</p>\n</blockquote>\n<h3 id=\"函数介绍\">函数介绍</h3>\n<p><code>os.path</code>相关函数</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">os.path.split() <span class=\"hljs-comment\">#分割文件名</span><br>os.path.splitdrive() <span class=\"hljs-comment\">#分割盘符</span><br>os.path.splitext() <span class=\"hljs-comment\">#分割扩展名</span><br>os.path.basename() <span class=\"hljs-comment\">#获取文件名，split的后一元素</span><br>os.path.dirname()  <span class=\"hljs-comment\">#获取路径名，split的前一元素</span><br>os.path.join()     <span class=\"hljs-comment\">#连接path字符串</span><br></code></pre></td></tr></tbody></table></figure>\n<p><code>os</code>相关函数</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">os.walk()     <span class=\"hljs-comment\">#遍历路径下的文件信息和子文件信息（root，dir，file的形式）</span><br>os.listdir()  <span class=\"hljs-comment\">#返回路径下的文件信息</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"具体介绍\">具体介绍</h3>\n<h4 id=\"os-path-split\">os.path.split()</h4>\n<p><code>os.path.split()</code>函数返回路径的元组信息（父路径，文件名）</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.path.split(p)<br>Docstring:<br>Split a pathname.<br><br>Return <span class=\"hljs-built_in\">tuple</span> (head, tail) where tail <span class=\"hljs-keyword\">is</span> everything after the final slash.<br>Either part may be empty.<br>File:      d:\\anaconda3\\lib\\ntpath.py<br><span class=\"hljs-type\">Type</span>:      function<br>    <br>例如：<br>spath = <span class=\"hljs-string\">\"./a/b/c/name.txt\"</span><br>path,filename = os.path.split(spath)<br>path,filename为(<span class=\"hljs-string\">'./a/b/c'</span>, <span class=\"hljs-string\">'name.txt'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"os-path-splitdrive\">os.path.splitdrive()</h4>\n<p><code>os.path.splitdrive()</code>函数返回元组信息（盘符，路径（除去盘符））</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.path.splitdrive(p)<br>Docstring:<br>Split a pathname into drive/UNC sharepoint <span class=\"hljs-keyword\">and</span> relative path specifiers.<br>Returns a <span class=\"hljs-number\">2</span>-<span class=\"hljs-built_in\">tuple</span> (drive_or_unc, path); either part may be empty.<br><br>If you assign<br>    result = splitdrive(p)<br>It <span class=\"hljs-keyword\">is</span> always true that:<br>    result[<span class=\"hljs-number\">0</span>] + result[<span class=\"hljs-number\">1</span>] == p<br><br>If the path contained a drive letter, drive_or_unc will contain everything<br>up to <span class=\"hljs-keyword\">and</span> including the colon.  e.g. splitdrive(<span class=\"hljs-string\">\"c:/dir\"</span>) returns (<span class=\"hljs-string\">\"c:\"</span>, <span class=\"hljs-string\">\"/dir\"</span>)<br><br>If the path contained a UNC path, the drive_or_unc will contain the host name<br><span class=\"hljs-keyword\">and</span> share up to but <span class=\"hljs-keyword\">not</span> including the fourth directory separator character.<br>e.g. splitdrive(<span class=\"hljs-string\">\"//host/computer/dir\"</span>) returns (<span class=\"hljs-string\">\"//host/computer\"</span>, <span class=\"hljs-string\">\"/dir\"</span>)<br><br>Paths cannot contain both a drive letter <span class=\"hljs-keyword\">and</span> a UNC path.<br>File:      d:\\anaconda3\\lib\\ntpath.py<br><span class=\"hljs-type\">Type</span>:      function<br>    <br>例如：  <br>cpath = <span class=\"hljs-string\">\"C:/a/b/a.csv\"</span><br>os.path.splitdrive(cpath)<br>(<span class=\"hljs-string\">'C:'</span>, <span class=\"hljs-string\">'/a/b/a.csv'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"os-path-splitext\">os.path.splitext()</h4>\n<p><code>os.path.splitext()</code>返回路径的元组信息（路径及文件名，扩展名）</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.path.splitext(p)<br>Docstring:<br>Split the extension <span class=\"hljs-keyword\">from</span> a pathname.<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"os-path-dirname-与os-path-basename\">os.path.dirname()与os.path.basename()</h4>\n<p><code>os.path.dirname()</code>和<code>os.path.basename()</code>分别返回<code>split</code>函数的前后元素。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.path.basename(p)<br>Docstring: Returns the final component of a pathname<br>File:      d:\\anaconda3\\lib\\ntpath.py<br><span class=\"hljs-type\">Type</span>:      function<br>    <br>例如：<br>cpath = <span class=\"hljs-string\">\"C:/a/b/a.csv\"</span><br>os.path.dirname(cpath) <span class=\"hljs-comment\">#dirpath</span><br><span class=\"hljs-string\">'C:/a/b'</span><br>os.path.basename(cpath) <span class=\"hljs-comment\">#filename</span><br><span class=\"hljs-string\">'a.csv'</span><br>相当于split的分解：<br>os.path.split(cpath)<br>(<span class=\"hljs-string\">'C:/a/b'</span>, <span class=\"hljs-string\">'a.csv'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"os-path-join\">os.path.join()</h4>\n<p><code>os.path.join()</code>使用特定的分隔符连接路径。Windows下默认使用<code>\\\\</code>。Linux下默认使用<code>/</code>。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.path.join(path, *paths)<br>Docstring: &lt;no docstring&gt;<br>File:      d:\\anaconda3\\lib\\ntpath.py<br><span class=\"hljs-type\">Type</span>:      function<br>    <br>例如：<br>os.path.join(<span class=\"hljs-string\">'./a/b/c'</span>, <span class=\"hljs-string\">\"a123\"</span>, <span class=\"hljs-string\">'name.txt'</span>) <br><span class=\"hljs-string\">'./a/b/c\\\\a123\\\\name.txt'</span><br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"os-walk\">os.walk()</h4>\n<p><code>os.walk()</code>遍历文件夹下的文件和子文件夹，然后递归遍历下列子文件夹。<code>for root,dirs,files in os.walk(temp)</code></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.walk(top, topdown=<span class=\"hljs-literal\">True</span>, onerror=<span class=\"hljs-literal\">None</span>, followlinks=<span class=\"hljs-literal\">False</span>)<br>Docstring:<br>Directory tree generator.<br><br>For each directory <span class=\"hljs-keyword\">in</span> the directory tree rooted at top (including top<br>itself, but excluding <span class=\"hljs-string\">'.'</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-string\">'..'</span>), yields a <span class=\"hljs-number\">3</span>-<span class=\"hljs-built_in\">tuple</span><br>    dirpath, dirnames, filenames<br>dirpath <span class=\"hljs-keyword\">is</span> a string, the path to the directory.  dirnames <span class=\"hljs-keyword\">is</span> a <span class=\"hljs-built_in\">list</span> of<br>the names of the subdirectories <span class=\"hljs-keyword\">in</span> dirpath (excluding <span class=\"hljs-string\">'.'</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-string\">'..'</span>).<br>filenames <span class=\"hljs-keyword\">is</span> a <span class=\"hljs-built_in\">list</span> of the names of the non-directory files <span class=\"hljs-keyword\">in</span> dirpath.<br>Note that the names <span class=\"hljs-keyword\">in</span> the lists are just names, <span class=\"hljs-keyword\">with</span> no path components.<br>To get a full path (which begins <span class=\"hljs-keyword\">with</span> top) to a file <span class=\"hljs-keyword\">or</span> directory <span class=\"hljs-keyword\">in</span><br>dirpath, do os.path.join(dirpath, name).<br><br>If optional arg <span class=\"hljs-string\">'topdown'</span> <span class=\"hljs-keyword\">is</span> true <span class=\"hljs-keyword\">or</span> <span class=\"hljs-keyword\">not</span> specified, the triple <span class=\"hljs-keyword\">for</span> a<br>directory <span class=\"hljs-keyword\">is</span> generated before the triples <span class=\"hljs-keyword\">for</span> <span class=\"hljs-built_in\">any</span> of its subdirectories<br>(directories are generated top down).  If topdown <span class=\"hljs-keyword\">is</span> false, the triple<br><span class=\"hljs-keyword\">for</span> a directory <span class=\"hljs-keyword\">is</span> generated after the triples <span class=\"hljs-keyword\">for</span> <span class=\"hljs-built_in\">all</span> of its<br>subdirectories (directories are generated bottom up).<br><br>Caution:  <span class=\"hljs-keyword\">if</span> you <span class=\"hljs-keyword\">pass</span> a relative pathname <span class=\"hljs-keyword\">for</span> top, don<span class=\"hljs-string\">'t change the</span><br><span class=\"hljs-string\">current working directory between resumptions of walk.  walk never</span><br><span class=\"hljs-string\">changes the current directory, and assumes that the client doesn'</span>t<br>either.<br>例如：<br>temp = <span class=\"hljs-string\">\"E:\\迅雷下载\"</span><br><span class=\"hljs-keyword\">for</span> root,dirs,files <span class=\"hljs-keyword\">in</span> os.walk(temp,topdown=<span class=\"hljs-literal\">False</span>):<br>    <span class=\"hljs-comment\">#遍历文件夹下的文件和子目录 root,dirs,files,topdown为false时表示从底向上，为true是从顶向下</span><br>    <span class=\"hljs-keyword\">for</span> name <span class=\"hljs-keyword\">in</span> files:<br>        <span class=\"hljs-built_in\">print</span>(os.path.join(root,name))<br>    <span class=\"hljs-keyword\">for</span> name <span class=\"hljs-keyword\">in</span> dirs:<br>        <span class=\"hljs-built_in\">print</span>(os.path.join(root,name))<br>        <br>E:\\迅雷下载\\Suplicant_for_Campus_Network_For_Windows_V6<span class=\"hljs-number\">.61</span>\\Suplicant_for_Campus_Network_For_Windows_V6<span class=\"hljs-number\">.61</span>.exe<br>E:\\迅雷下载\\cuda_10<span class=\"hljs-number\">.2</span><span class=\"hljs-number\">.89_441</span><span class=\"hljs-number\">.22</span>_win10.exe<br>E:\\迅雷下载\\Git-<span class=\"hljs-number\">2.33</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.2</span>-<span class=\"hljs-number\">64</span>-bit.exe<br>E:\\迅雷下载\\ide-<span class=\"hljs-built_in\">eval</span>-resetter-<span class=\"hljs-number\">2.1</span><span class=\"hljs-number\">.13</span>.<span class=\"hljs-built_in\">zip</span><br>E:\\迅雷下载\\npp<span class=\"hljs-number\">.8</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.4</span>.Installer.exe<br>E:\\迅雷下载\\sogou_explorer_11<span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.33862_7793</span>.exe<br>E:\\迅雷下载\\windows_v6<span class=\"hljs-number\">.61</span>.rar<br>E:\\迅雷下载\\Suplicant_for_Campus_Network_For_Windows_V6<span class=\"hljs-number\">.61</span> <br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"os-listdir\">os.listdir()</h4>\n<p><code>os.listdir()</code>返回文件夹下的所有一级文件夹和文件。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.listdir(path=<span class=\"hljs-literal\">None</span>)<br>Docstring:<br>Return a <span class=\"hljs-built_in\">list</span> containing the names of the files <span class=\"hljs-keyword\">in</span> the directory.<br><br>path can be specified <span class=\"hljs-keyword\">as</span> either <span class=\"hljs-built_in\">str</span>, <span class=\"hljs-built_in\">bytes</span>, <span class=\"hljs-keyword\">or</span> a path-like <span class=\"hljs-built_in\">object</span>.  If path <span class=\"hljs-keyword\">is</span> <span class=\"hljs-built_in\">bytes</span>,<br>  the filenames returned will also be <span class=\"hljs-built_in\">bytes</span>; <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">all</span> other circumstances<br>  the filenames returned will be <span class=\"hljs-built_in\">str</span>.<br>If path <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">None</span>, uses the path=<span class=\"hljs-string\">'.'</span>.<br>On some platforms, path may also be specified <span class=\"hljs-keyword\">as</span> an <span class=\"hljs-built_in\">open</span> file descriptor;\\<br>  the file descriptor must refer to a directory.<br>  If this functionality <span class=\"hljs-keyword\">is</span> unavailable, using it raises NotImplementedError.<br><br>The <span class=\"hljs-built_in\">list</span> <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">in</span> arbitrary order.  It does <span class=\"hljs-keyword\">not</span> include the special<br>entries <span class=\"hljs-string\">'.'</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-string\">'..'</span> even <span class=\"hljs-keyword\">if</span> they are present <span class=\"hljs-keyword\">in</span> the directory.<br><span class=\"hljs-type\">Type</span>:      builtin_function_or_method<br>    <br>例如：<br>temp = <span class=\"hljs-string\">\"E:\\迅雷下载\"</span><br>os.listdir(temp) <span class=\"hljs-comment\">#列出dirname下的目录和文件</span><br>[<span class=\"hljs-string\">'cuda_10.2.89_441.22_win10.exe'</span>,<br> <span class=\"hljs-string\">'Git-2.33.0.2-64-bit.exe'</span>,<br> <span class=\"hljs-string\">'ide-eval-resetter-2.1.13.zip'</span>,<br> <span class=\"hljs-string\">'npp.8.1.4.Installer.exe'</span>,<br> <span class=\"hljs-string\">'sogou_explorer_11.0.0.33862_7793.exe'</span>,<br> <span class=\"hljs-string\">'Suplicant_for_Campus_Network_For_Windows_V6.61'</span>,<br> <span class=\"hljs-string\">'windows_v6.61.rar'</span>]<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>对文件名的相关操作总结</p>\n</blockquote>\n<h3 id=\"函数介绍\">函数介绍</h3>\n<p><code>os.path</code>相关函数</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">os.path.split() <span class=\"hljs-comment\">#分割文件名</span><br>os.path.splitdrive() <span class=\"hljs-comment\">#分割盘符</span><br>os.path.splitext() <span class=\"hljs-comment\">#分割扩展名</span><br>os.path.basename() <span class=\"hljs-comment\">#获取文件名，split的后一元素</span><br>os.path.dirname()  <span class=\"hljs-comment\">#获取路径名，split的前一元素</span><br>os.path.join()     <span class=\"hljs-comment\">#连接path字符串</span><br></code></pre></td></tr></table></figure>\n<p><code>os</code>相关函数</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">os.walk()     <span class=\"hljs-comment\">#遍历路径下的文件信息和子文件信息（root，dir，file的形式）</span><br>os.listdir()  <span class=\"hljs-comment\">#返回路径下的文件信息</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"具体介绍\">具体介绍</h3>\n<h4 id=\"os-path-split\">os.path.split()</h4>\n<p><code>os.path.split()</code>函数返回路径的元组信息（父路径，文件名）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.path.split(p)<br>Docstring:<br>Split a pathname.<br><br>Return <span class=\"hljs-built_in\">tuple</span> (head, tail) where tail <span class=\"hljs-keyword\">is</span> everything after the final slash.<br>Either part may be empty.<br>File:      d:\\anaconda3\\lib\\ntpath.py<br><span class=\"hljs-type\">Type</span>:      function<br>    <br>例如：<br>spath = <span class=\"hljs-string\">&quot;./a/b/c/name.txt&quot;</span><br>path,filename = os.path.split(spath)<br>path,filename为(<span class=\"hljs-string\">&#x27;./a/b/c&#x27;</span>, <span class=\"hljs-string\">&#x27;name.txt&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<h4 id=\"os-path-splitdrive\">os.path.splitdrive()</h4>\n<p><code>os.path.splitdrive()</code>函数返回元组信息（盘符，路径（除去盘符））</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.path.splitdrive(p)<br>Docstring:<br>Split a pathname into drive/UNC sharepoint <span class=\"hljs-keyword\">and</span> relative path specifiers.<br>Returns a <span class=\"hljs-number\">2</span>-<span class=\"hljs-built_in\">tuple</span> (drive_or_unc, path); either part may be empty.<br><br>If you assign<br>    result = splitdrive(p)<br>It <span class=\"hljs-keyword\">is</span> always true that:<br>    result[<span class=\"hljs-number\">0</span>] + result[<span class=\"hljs-number\">1</span>] == p<br><br>If the path contained a drive letter, drive_or_unc will contain everything<br>up to <span class=\"hljs-keyword\">and</span> including the colon.  e.g. splitdrive(<span class=\"hljs-string\">&quot;c:/dir&quot;</span>) returns (<span class=\"hljs-string\">&quot;c:&quot;</span>, <span class=\"hljs-string\">&quot;/dir&quot;</span>)<br><br>If the path contained a UNC path, the drive_or_unc will contain the host name<br><span class=\"hljs-keyword\">and</span> share up to but <span class=\"hljs-keyword\">not</span> including the fourth directory separator character.<br>e.g. splitdrive(<span class=\"hljs-string\">&quot;//host/computer/dir&quot;</span>) returns (<span class=\"hljs-string\">&quot;//host/computer&quot;</span>, <span class=\"hljs-string\">&quot;/dir&quot;</span>)<br><br>Paths cannot contain both a drive letter <span class=\"hljs-keyword\">and</span> a UNC path.<br>File:      d:\\anaconda3\\lib\\ntpath.py<br><span class=\"hljs-type\">Type</span>:      function<br>    <br>例如：  <br>cpath = <span class=\"hljs-string\">&quot;C:/a/b/a.csv&quot;</span><br>os.path.splitdrive(cpath)<br>(<span class=\"hljs-string\">&#x27;C:&#x27;</span>, <span class=\"hljs-string\">&#x27;/a/b/a.csv&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<h4 id=\"os-path-splitext\">os.path.splitext()</h4>\n<p><code>os.path.splitext()</code>返回路径的元组信息（路径及文件名，扩展名）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.path.splitext(p)<br>Docstring:<br>Split the extension <span class=\"hljs-keyword\">from</span> a pathname.<br></code></pre></td></tr></table></figure>\n<h4 id=\"os-path-dirname-与os-path-basename\">os.path.dirname()与os.path.basename()</h4>\n<p><code>os.path.dirname()</code>和<code>os.path.basename()</code>分别返回<code>split</code>函数的前后元素。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.path.basename(p)<br>Docstring: Returns the final component of a pathname<br>File:      d:\\anaconda3\\lib\\ntpath.py<br><span class=\"hljs-type\">Type</span>:      function<br>    <br>例如：<br>cpath = <span class=\"hljs-string\">&quot;C:/a/b/a.csv&quot;</span><br>os.path.dirname(cpath) <span class=\"hljs-comment\">#dirpath</span><br><span class=\"hljs-string\">&#x27;C:/a/b&#x27;</span><br>os.path.basename(cpath) <span class=\"hljs-comment\">#filename</span><br><span class=\"hljs-string\">&#x27;a.csv&#x27;</span><br>相当于split的分解：<br>os.path.split(cpath)<br>(<span class=\"hljs-string\">&#x27;C:/a/b&#x27;</span>, <span class=\"hljs-string\">&#x27;a.csv&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<h4 id=\"os-path-join\">os.path.join()</h4>\n<p><code>os.path.join()</code>使用特定的分隔符连接路径。Windows下默认使用<code>\\\\</code>。Linux下默认使用<code>/</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.path.join(path, *paths)<br>Docstring: &lt;no docstring&gt;<br>File:      d:\\anaconda3\\lib\\ntpath.py<br><span class=\"hljs-type\">Type</span>:      function<br>    <br>例如：<br>os.path.join(<span class=\"hljs-string\">&#x27;./a/b/c&#x27;</span>, <span class=\"hljs-string\">&quot;a123&quot;</span>, <span class=\"hljs-string\">&#x27;name.txt&#x27;</span>) <br><span class=\"hljs-string\">&#x27;./a/b/c\\\\a123\\\\name.txt&#x27;</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"os-walk\">os.walk()</h4>\n<p><code>os.walk()</code>遍历文件夹下的文件和子文件夹，然后递归遍历下列子文件夹。<code>for root,dirs,files in os.walk(temp)</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.walk(top, topdown=<span class=\"hljs-literal\">True</span>, onerror=<span class=\"hljs-literal\">None</span>, followlinks=<span class=\"hljs-literal\">False</span>)<br>Docstring:<br>Directory tree generator.<br><br>For each directory <span class=\"hljs-keyword\">in</span> the directory tree rooted at top (including top<br>itself, but excluding <span class=\"hljs-string\">&#x27;.&#x27;</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-string\">&#x27;..&#x27;</span>), yields a <span class=\"hljs-number\">3</span>-<span class=\"hljs-built_in\">tuple</span><br>    dirpath, dirnames, filenames<br>dirpath <span class=\"hljs-keyword\">is</span> a string, the path to the directory.  dirnames <span class=\"hljs-keyword\">is</span> a <span class=\"hljs-built_in\">list</span> of<br>the names of the subdirectories <span class=\"hljs-keyword\">in</span> dirpath (excluding <span class=\"hljs-string\">&#x27;.&#x27;</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-string\">&#x27;..&#x27;</span>).<br>filenames <span class=\"hljs-keyword\">is</span> a <span class=\"hljs-built_in\">list</span> of the names of the non-directory files <span class=\"hljs-keyword\">in</span> dirpath.<br>Note that the names <span class=\"hljs-keyword\">in</span> the lists are just names, <span class=\"hljs-keyword\">with</span> no path components.<br>To get a full path (which begins <span class=\"hljs-keyword\">with</span> top) to a file <span class=\"hljs-keyword\">or</span> directory <span class=\"hljs-keyword\">in</span><br>dirpath, do os.path.join(dirpath, name).<br><br>If optional arg <span class=\"hljs-string\">&#x27;topdown&#x27;</span> <span class=\"hljs-keyword\">is</span> true <span class=\"hljs-keyword\">or</span> <span class=\"hljs-keyword\">not</span> specified, the triple <span class=\"hljs-keyword\">for</span> a<br>directory <span class=\"hljs-keyword\">is</span> generated before the triples <span class=\"hljs-keyword\">for</span> <span class=\"hljs-built_in\">any</span> of its subdirectories<br>(directories are generated top down).  If topdown <span class=\"hljs-keyword\">is</span> false, the triple<br><span class=\"hljs-keyword\">for</span> a directory <span class=\"hljs-keyword\">is</span> generated after the triples <span class=\"hljs-keyword\">for</span> <span class=\"hljs-built_in\">all</span> of its<br>subdirectories (directories are generated bottom up).<br><br>Caution:  <span class=\"hljs-keyword\">if</span> you <span class=\"hljs-keyword\">pass</span> a relative pathname <span class=\"hljs-keyword\">for</span> top, don<span class=\"hljs-string\">&#x27;t change the</span><br><span class=\"hljs-string\">current working directory between resumptions of walk.  walk never</span><br><span class=\"hljs-string\">changes the current directory, and assumes that the client doesn&#x27;</span>t<br>either.<br>例如：<br>temp = <span class=\"hljs-string\">&quot;E:\\迅雷下载&quot;</span><br><span class=\"hljs-keyword\">for</span> root,dirs,files <span class=\"hljs-keyword\">in</span> os.walk(temp,topdown=<span class=\"hljs-literal\">False</span>):<br>    <span class=\"hljs-comment\">#遍历文件夹下的文件和子目录 root,dirs,files,topdown为false时表示从底向上，为true是从顶向下</span><br>    <span class=\"hljs-keyword\">for</span> name <span class=\"hljs-keyword\">in</span> files:<br>        <span class=\"hljs-built_in\">print</span>(os.path.join(root,name))<br>    <span class=\"hljs-keyword\">for</span> name <span class=\"hljs-keyword\">in</span> dirs:<br>        <span class=\"hljs-built_in\">print</span>(os.path.join(root,name))<br>        <br>E:\\迅雷下载\\Suplicant_for_Campus_Network_For_Windows_V6<span class=\"hljs-number\">.61</span>\\Suplicant_for_Campus_Network_For_Windows_V6<span class=\"hljs-number\">.61</span>.exe<br>E:\\迅雷下载\\cuda_10<span class=\"hljs-number\">.2</span><span class=\"hljs-number\">.89_441</span><span class=\"hljs-number\">.22</span>_win10.exe<br>E:\\迅雷下载\\Git-<span class=\"hljs-number\">2.33</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.2</span>-<span class=\"hljs-number\">64</span>-bit.exe<br>E:\\迅雷下载\\ide-<span class=\"hljs-built_in\">eval</span>-resetter-<span class=\"hljs-number\">2.1</span><span class=\"hljs-number\">.13</span>.<span class=\"hljs-built_in\">zip</span><br>E:\\迅雷下载\\npp<span class=\"hljs-number\">.8</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.4</span>.Installer.exe<br>E:\\迅雷下载\\sogou_explorer_11<span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.33862_7793</span>.exe<br>E:\\迅雷下载\\windows_v6<span class=\"hljs-number\">.61</span>.rar<br>E:\\迅雷下载\\Suplicant_for_Campus_Network_For_Windows_V6<span class=\"hljs-number\">.61</span> <br></code></pre></td></tr></table></figure>\n<h4 id=\"os-listdir\">os.listdir()</h4>\n<p><code>os.listdir()</code>返回文件夹下的所有一级文件夹和文件。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">Signature: os.listdir(path=<span class=\"hljs-literal\">None</span>)<br>Docstring:<br>Return a <span class=\"hljs-built_in\">list</span> containing the names of the files <span class=\"hljs-keyword\">in</span> the directory.<br><br>path can be specified <span class=\"hljs-keyword\">as</span> either <span class=\"hljs-built_in\">str</span>, <span class=\"hljs-built_in\">bytes</span>, <span class=\"hljs-keyword\">or</span> a path-like <span class=\"hljs-built_in\">object</span>.  If path <span class=\"hljs-keyword\">is</span> <span class=\"hljs-built_in\">bytes</span>,<br>  the filenames returned will also be <span class=\"hljs-built_in\">bytes</span>; <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">all</span> other circumstances<br>  the filenames returned will be <span class=\"hljs-built_in\">str</span>.<br>If path <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">None</span>, uses the path=<span class=\"hljs-string\">&#x27;.&#x27;</span>.<br>On some platforms, path may also be specified <span class=\"hljs-keyword\">as</span> an <span class=\"hljs-built_in\">open</span> file descriptor;\\<br>  the file descriptor must refer to a directory.<br>  If this functionality <span class=\"hljs-keyword\">is</span> unavailable, using it raises NotImplementedError.<br><br>The <span class=\"hljs-built_in\">list</span> <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">in</span> arbitrary order.  It does <span class=\"hljs-keyword\">not</span> include the special<br>entries <span class=\"hljs-string\">&#x27;.&#x27;</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-string\">&#x27;..&#x27;</span> even <span class=\"hljs-keyword\">if</span> they are present <span class=\"hljs-keyword\">in</span> the directory.<br><span class=\"hljs-type\">Type</span>:      builtin_function_or_method<br>    <br>例如：<br>temp = <span class=\"hljs-string\">&quot;E:\\迅雷下载&quot;</span><br>os.listdir(temp) <span class=\"hljs-comment\">#列出dirname下的目录和文件</span><br>[<span class=\"hljs-string\">&#x27;cuda_10.2.89_441.22_win10.exe&#x27;</span>,<br> <span class=\"hljs-string\">&#x27;Git-2.33.0.2-64-bit.exe&#x27;</span>,<br> <span class=\"hljs-string\">&#x27;ide-eval-resetter-2.1.13.zip&#x27;</span>,<br> <span class=\"hljs-string\">&#x27;npp.8.1.4.Installer.exe&#x27;</span>,<br> <span class=\"hljs-string\">&#x27;sogou_explorer_11.0.0.33862_7793.exe&#x27;</span>,<br> <span class=\"hljs-string\">&#x27;Suplicant_for_Campus_Network_For_Windows_V6.61&#x27;</span>,<br> <span class=\"hljs-string\">&#x27;windows_v6.61.rar&#x27;</span>]<br></code></pre></td></tr></table></figure>\n"},{"title":"python将图片存进PDF中","date":"2021-10-06T02:43:13.000Z","_content":"\n> 在公安部足迹项目中，需要将矫正的足迹图片打印出来，所有首先转成pdf文件中再进行打印。就涉及到将图片存入pdf中，这里使用的工具是FPDF。FPDF是一个pdf文件的处理库，我们可以个性化创建和规范设定pdf文件。\n> \n\n### 安装\n\n```python\npip install fpdf\n```\n\n### 具体内容\n\n#### 实现代码\n\n```python\nfrom fpdf import FPDF\nimport glob\ndef imagesTopdf(imagesPath,pdfName):\n    pdf = FPDF()\n    for imagePath in imagesPath:\n        pdf.add_page()\n        pdf.image(imagePath,x=0,y=0,w=170,h=297)\n    pdf.output(pdfName,\"F\")\n\nimages = glob.glob(\"current_revise/\"+\"*.jpg\")\n# jpg_path = \"test.jpg\"\npdf_path = \"test_file3.pdf\"\nimagesTopdf(images,pdf_path)\n```\n\n#### 相关参数\n\n1，其中`pdf = FPDF()`是创建对象，默认是：\n\n2，`orientation`为竖向（P：竖向，L横向）；\n\n3，`unit`为mm毫米。用于表示文档中位置的计量单元。可用的值有以下四种:\n\n- pt: 点\n- mm: 毫米\n- cm: 厘米\n- in: 英寸\n\n4，`format`用于表示创建的PDF文档的纸张类型。可用值可以是用于表示纸的字符串，如\"A4\"、\"A5\"、\"Letter\"等。\n\n```python\nclass FPDF(object):\n    \"PDF Generation class\"\n    def __init__(self, orientation='P',unit='mm',format='A4')\n```\n\n#### 相关函数\n\n`pdf.add_page()`用于创建新页。\n\n` pdf.image(imagePath,x=0,y=0,w=170,h=297)`是用于添加图像，其中`x`和`y`表示图片所在的坐标，`width`和`height`表示图片的宽度和高度。如果需要图片保持原来的大小，只需要将`width`和`height`设置成`0`即可。矫正后的图片是1700，2981；A4纸的尺寸是210*297，所以只能设置为297，也就是说这里误差至少有1.1mm\n\nimage源代码如下：\n\n```python\n    def image(self, name, x=None, y=None, w=0,h=0,type='',link=''):\n        \"Put an image on the page\"\n        if not name in self.images:\n            #First use of image, get info\n            if(type==''):\n                pos=name.rfind('.')\n                if(not pos):\n                    self.error('image file has no extension and no type was specified: '+name)\n                type=substr(name,pos+1)\n            type=type.lower()\n            if(type=='jpg' or type=='jpeg'):\n                info=self._parsejpg(name)\n            elif(type=='png'):\n                info=self._parsepng(name)\n            else:\n                #Allow for additional formats\n                #maybe the image is not showing the correct extension,\n                #but the header is OK,\n                succeed_parsing = False\n                #try all the parsing functions\n                parsing_functions = [self._parsejpg,self._parsepng,self._parsegif]\n                for pf in parsing_functions:\n                    try:\n                        info = pf(name)\n                        succeed_parsing = True\n                        break;\n                    except:\n                        pass\n                #last resource\n                if not succeed_parsing:\n                    mtd='_parse'+type\n                    if not hasattr(self,mtd):\n                        self.error('Unsupported image type: '+type)\n                    info=getattr(self, mtd)(name)\n                mtd='_parse'+type\n                if not hasattr(self,mtd):\n                    self.error('Unsupported image type: '+type)\n                info=getattr(self, mtd)(name)\n            info['i']=len(self.images)+1\n            self.images[name]=info\n        else:\n            info=self.images[name]\n        #Automatic width and height calculation if needed\n        if(w==0 and h==0):\n            #Put image at 72 dpi\n            w=info['w']/self.k\n            h=info['h']/self.k\n        elif(w==0):\n            w=h*info['w']/info['h']\n        elif(h==0):\n            h=w*info['h']/info['w']\n        # Flowing mode\n        if y is None:\n            if (self.y + h > self.page_break_trigger and not self.in_footer and self.accept_page_break()):\n                #Automatic page break\n                x = self.x\n                self.add_page(self.cur_orientation)\n                self.x = x\n            y = self.y\n            self.y += h\n        if x is None:\n            x = self.x\n        self._out(sprintf('q %.2f 0 0 %.2f %.2f %.2f cm /I%d Do Q',w*self.k,h*self.k,x*self.k,(self.h-(y+h))*self.k,info['i']))\n        if(link):\n            self.link(x,y,w,h,link)\n```\n\n","source":"_posts/python/img/FPDF.md","raw":"---\ntitle: python将图片存进PDF中\ntags: [python,图像]\ncategories: [python,图像]\ndate: 2021-10-06 10:43:13\n---\n\n> 在公安部足迹项目中，需要将矫正的足迹图片打印出来，所有首先转成pdf文件中再进行打印。就涉及到将图片存入pdf中，这里使用的工具是FPDF。FPDF是一个pdf文件的处理库，我们可以个性化创建和规范设定pdf文件。\n> \n\n### 安装\n\n```python\npip install fpdf\n```\n\n### 具体内容\n\n#### 实现代码\n\n```python\nfrom fpdf import FPDF\nimport glob\ndef imagesTopdf(imagesPath,pdfName):\n    pdf = FPDF()\n    for imagePath in imagesPath:\n        pdf.add_page()\n        pdf.image(imagePath,x=0,y=0,w=170,h=297)\n    pdf.output(pdfName,\"F\")\n\nimages = glob.glob(\"current_revise/\"+\"*.jpg\")\n# jpg_path = \"test.jpg\"\npdf_path = \"test_file3.pdf\"\nimagesTopdf(images,pdf_path)\n```\n\n#### 相关参数\n\n1，其中`pdf = FPDF()`是创建对象，默认是：\n\n2，`orientation`为竖向（P：竖向，L横向）；\n\n3，`unit`为mm毫米。用于表示文档中位置的计量单元。可用的值有以下四种:\n\n- pt: 点\n- mm: 毫米\n- cm: 厘米\n- in: 英寸\n\n4，`format`用于表示创建的PDF文档的纸张类型。可用值可以是用于表示纸的字符串，如\"A4\"、\"A5\"、\"Letter\"等。\n\n```python\nclass FPDF(object):\n    \"PDF Generation class\"\n    def __init__(self, orientation='P',unit='mm',format='A4')\n```\n\n#### 相关函数\n\n`pdf.add_page()`用于创建新页。\n\n` pdf.image(imagePath,x=0,y=0,w=170,h=297)`是用于添加图像，其中`x`和`y`表示图片所在的坐标，`width`和`height`表示图片的宽度和高度。如果需要图片保持原来的大小，只需要将`width`和`height`设置成`0`即可。矫正后的图片是1700，2981；A4纸的尺寸是210*297，所以只能设置为297，也就是说这里误差至少有1.1mm\n\nimage源代码如下：\n\n```python\n    def image(self, name, x=None, y=None, w=0,h=0,type='',link=''):\n        \"Put an image on the page\"\n        if not name in self.images:\n            #First use of image, get info\n            if(type==''):\n                pos=name.rfind('.')\n                if(not pos):\n                    self.error('image file has no extension and no type was specified: '+name)\n                type=substr(name,pos+1)\n            type=type.lower()\n            if(type=='jpg' or type=='jpeg'):\n                info=self._parsejpg(name)\n            elif(type=='png'):\n                info=self._parsepng(name)\n            else:\n                #Allow for additional formats\n                #maybe the image is not showing the correct extension,\n                #but the header is OK,\n                succeed_parsing = False\n                #try all the parsing functions\n                parsing_functions = [self._parsejpg,self._parsepng,self._parsegif]\n                for pf in parsing_functions:\n                    try:\n                        info = pf(name)\n                        succeed_parsing = True\n                        break;\n                    except:\n                        pass\n                #last resource\n                if not succeed_parsing:\n                    mtd='_parse'+type\n                    if not hasattr(self,mtd):\n                        self.error('Unsupported image type: '+type)\n                    info=getattr(self, mtd)(name)\n                mtd='_parse'+type\n                if not hasattr(self,mtd):\n                    self.error('Unsupported image type: '+type)\n                info=getattr(self, mtd)(name)\n            info['i']=len(self.images)+1\n            self.images[name]=info\n        else:\n            info=self.images[name]\n        #Automatic width and height calculation if needed\n        if(w==0 and h==0):\n            #Put image at 72 dpi\n            w=info['w']/self.k\n            h=info['h']/self.k\n        elif(w==0):\n            w=h*info['w']/info['h']\n        elif(h==0):\n            h=w*info['h']/info['w']\n        # Flowing mode\n        if y is None:\n            if (self.y + h > self.page_break_trigger and not self.in_footer and self.accept_page_break()):\n                #Automatic page break\n                x = self.x\n                self.add_page(self.cur_orientation)\n                self.x = x\n            y = self.y\n            self.y += h\n        if x is None:\n            x = self.x\n        self._out(sprintf('q %.2f 0 0 %.2f %.2f %.2f cm /I%d Do Q',w*self.k,h*self.k,x*self.k,(self.h-(y+h))*self.k,info['i']))\n        if(link):\n            self.link(x,y,w,h,link)\n```\n\n","slug":"python/img/FPDF","published":1,"updated":"2022-01-18T08:10:17.110Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0c70072ast97dgba8ug","content":"<blockquote>\n<p>在公安部足迹项目中，需要将矫正的足迹图片打印出来，所有首先转成pdf文件中再进行打印。就涉及到将图片存入pdf中，这里使用的工具是FPDF。FPDF是一个pdf文件的处理库，我们可以个性化创建和规范设定pdf文件。</p>\n</blockquote>\n<h3 id=\"安装\">安装</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pip install fpdf<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"具体内容\">具体内容</h3>\n<h4 id=\"实现代码\">实现代码</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> fpdf <span class=\"hljs-keyword\">import</span> FPDF<br><span class=\"hljs-keyword\">import</span> glob<br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">imagesTopdf</span>(<span class=\"hljs-params\">imagesPath,pdfName</span>):</span><br>    pdf = FPDF()<br>    <span class=\"hljs-keyword\">for</span> imagePath <span class=\"hljs-keyword\">in</span> imagesPath:<br>        pdf.add_page()<br>        pdf.image(imagePath,x=<span class=\"hljs-number\">0</span>,y=<span class=\"hljs-number\">0</span>,w=<span class=\"hljs-number\">170</span>,h=<span class=\"hljs-number\">297</span>)<br>    pdf.output(pdfName,<span class=\"hljs-string\">\"F\"</span>)<br><br>images = glob.glob(<span class=\"hljs-string\">\"current_revise/\"</span>+<span class=\"hljs-string\">\"*.jpg\"</span>)<br><span class=\"hljs-comment\"># jpg_path = \"test.jpg\"</span><br>pdf_path = <span class=\"hljs-string\">\"test_file3.pdf\"</span><br>imagesTopdf(images,pdf_path)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"相关参数\">相关参数</h4>\n<p>1，其中<code>pdf = FPDF()</code>是创建对象，默认是：</p>\n<p>2，<code>orientation</code>为竖向（P：竖向，L横向）；</p>\n<p>3，<code>unit</code>为mm毫米。用于表示文档中位置的计量单元。可用的值有以下四种:</p>\n<ul>\n<li>pt: 点</li>\n<li>mm: 毫米</li>\n<li>cm: 厘米</li>\n<li>in: 英寸</li>\n</ul>\n<p>4，<code>format</code>用于表示创建的PDF文档的纸张类型。可用值可以是用于表示纸的字符串，如\"A4\"、“A5”、\"Letter\"等。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FPDF</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">object</span></span>):</span><br>    <span class=\"hljs-string\">\"PDF Generation class\"</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, orientation=<span class=\"hljs-string\">'P'</span>,unit=<span class=\"hljs-string\">'mm'</span>,<span class=\"hljs-built_in\">format</span>=<span class=\"hljs-string\">'A4'</span></span>)</span><br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"相关函数\">相关函数</h4>\n<p><code>pdf.add_page()</code>用于创建新页。</p>\n<p><code> pdf.image(imagePath,x=0,y=0,w=170,h=297)</code>是用于添加图像，其中<code>x</code>和<code>y</code>表示图片所在的坐标，<code>width</code>和<code>height</code>表示图片的宽度和高度。如果需要图片保持原来的大小，只需要将<code>width</code>和<code>height</code>设置成<code>0</code>即可。矫正后的图片是1700，2981；A4纸的尺寸是210*297，所以只能设置为297，也就是说这里误差至少有1.1mm</p>\n<p>image源代码如下：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">image</span>(<span class=\"hljs-params\">self, name, x=<span class=\"hljs-literal\">None</span>, y=<span class=\"hljs-literal\">None</span>, w=<span class=\"hljs-number\">0</span>,h=<span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">''</span>,link=<span class=\"hljs-string\">''</span></span>):</span><br>    <span class=\"hljs-string\">\"Put an image on the page\"</span><br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> name <span class=\"hljs-keyword\">in</span> self.images:<br>        <span class=\"hljs-comment\">#First use of image, get info</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">type</span>==<span class=\"hljs-string\">''</span>):<br>            pos=name.rfind(<span class=\"hljs-string\">'.'</span>)<br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> pos):<br>                self.error(<span class=\"hljs-string\">'image file has no extension and no type was specified: '</span>+name)<br>            <span class=\"hljs-built_in\">type</span>=substr(name,pos+<span class=\"hljs-number\">1</span>)<br>        <span class=\"hljs-built_in\">type</span>=<span class=\"hljs-built_in\">type</span>.lower()<br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">type</span>==<span class=\"hljs-string\">'jpg'</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">type</span>==<span class=\"hljs-string\">'jpeg'</span>):<br>            info=self._parsejpg(name)<br>        <span class=\"hljs-keyword\">elif</span>(<span class=\"hljs-built_in\">type</span>==<span class=\"hljs-string\">'png'</span>):<br>            info=self._parsepng(name)<br>        <span class=\"hljs-keyword\">else</span>:<br>            <span class=\"hljs-comment\">#Allow for additional formats</span><br>            <span class=\"hljs-comment\">#maybe the image is not showing the correct extension,</span><br>            <span class=\"hljs-comment\">#but the header is OK,</span><br>            succeed_parsing = <span class=\"hljs-literal\">False</span><br>            <span class=\"hljs-comment\">#try all the parsing functions</span><br>            parsing_functions = [self._parsejpg,self._parsepng,self._parsegif]<br>            <span class=\"hljs-keyword\">for</span> pf <span class=\"hljs-keyword\">in</span> parsing_functions:<br>                <span class=\"hljs-keyword\">try</span>:<br>                    info = pf(name)<br>                    succeed_parsing = <span class=\"hljs-literal\">True</span><br>                    <span class=\"hljs-keyword\">break</span>;<br>                <span class=\"hljs-keyword\">except</span>:<br>                    <span class=\"hljs-keyword\">pass</span><br>            <span class=\"hljs-comment\">#last resource</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> succeed_parsing:<br>                mtd=<span class=\"hljs-string\">'_parse'</span>+<span class=\"hljs-built_in\">type</span><br>                <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">hasattr</span>(self,mtd):<br>                    self.error(<span class=\"hljs-string\">'Unsupported image type: '</span>+<span class=\"hljs-built_in\">type</span>)<br>                info=<span class=\"hljs-built_in\">getattr</span>(self, mtd)(name)<br>            mtd=<span class=\"hljs-string\">'_parse'</span>+<span class=\"hljs-built_in\">type</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">hasattr</span>(self,mtd):<br>                self.error(<span class=\"hljs-string\">'Unsupported image type: '</span>+<span class=\"hljs-built_in\">type</span>)<br>            info=<span class=\"hljs-built_in\">getattr</span>(self, mtd)(name)<br>        info[<span class=\"hljs-string\">'i'</span>]=<span class=\"hljs-built_in\">len</span>(self.images)+<span class=\"hljs-number\">1</span><br>        self.images[name]=info<br>    <span class=\"hljs-keyword\">else</span>:<br>        info=self.images[name]<br>    <span class=\"hljs-comment\">#Automatic width and height calculation if needed</span><br>    <span class=\"hljs-keyword\">if</span>(w==<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> h==<span class=\"hljs-number\">0</span>):<br>        <span class=\"hljs-comment\">#Put image at 72 dpi</span><br>        w=info[<span class=\"hljs-string\">'w'</span>]/self.k<br>        h=info[<span class=\"hljs-string\">'h'</span>]/self.k<br>    <span class=\"hljs-keyword\">elif</span>(w==<span class=\"hljs-number\">0</span>):<br>        w=h*info[<span class=\"hljs-string\">'w'</span>]/info[<span class=\"hljs-string\">'h'</span>]<br>    <span class=\"hljs-keyword\">elif</span>(h==<span class=\"hljs-number\">0</span>):<br>        h=w*info[<span class=\"hljs-string\">'h'</span>]/info[<span class=\"hljs-string\">'w'</span>]<br>    <span class=\"hljs-comment\"># Flowing mode</span><br>    <span class=\"hljs-keyword\">if</span> y <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">None</span>:<br>        <span class=\"hljs-keyword\">if</span> (self.y + h &gt; self.page_break_trigger <span class=\"hljs-keyword\">and</span> <span class=\"hljs-keyword\">not</span> self.in_footer <span class=\"hljs-keyword\">and</span> self.accept_page_break()):<br>            <span class=\"hljs-comment\">#Automatic page break</span><br>            x = self.x<br>            self.add_page(self.cur_orientation)<br>            self.x = x<br>        y = self.y<br>        self.y += h<br>    <span class=\"hljs-keyword\">if</span> x <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">None</span>:<br>        x = self.x<br>    self._out(sprintf(<span class=\"hljs-string\">'q %.2f 0 0 %.2f %.2f %.2f cm /I%d Do Q'</span>,w*self.k,h*self.k,x*self.k,(self.h-(y+h))*self.k,info[<span class=\"hljs-string\">'i'</span>]))<br>    <span class=\"hljs-keyword\">if</span>(link):<br>        self.link(x,y,w,h,link)<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>在公安部足迹项目中，需要将矫正的足迹图片打印出来，所有首先转成pdf文件中再进行打印。就涉及到将图片存入pdf中，这里使用的工具是FPDF。FPDF是一个pdf文件的处理库，我们可以个性化创建和规范设定pdf文件。</p>\n</blockquote>\n<h3 id=\"安装\">安装</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pip install fpdf<br></code></pre></td></tr></table></figure>\n<h3 id=\"具体内容\">具体内容</h3>\n<h4 id=\"实现代码\">实现代码</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> fpdf <span class=\"hljs-keyword\">import</span> FPDF<br><span class=\"hljs-keyword\">import</span> glob<br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">imagesTopdf</span>(<span class=\"hljs-params\">imagesPath,pdfName</span>):</span><br>    pdf = FPDF()<br>    <span class=\"hljs-keyword\">for</span> imagePath <span class=\"hljs-keyword\">in</span> imagesPath:<br>        pdf.add_page()<br>        pdf.image(imagePath,x=<span class=\"hljs-number\">0</span>,y=<span class=\"hljs-number\">0</span>,w=<span class=\"hljs-number\">170</span>,h=<span class=\"hljs-number\">297</span>)<br>    pdf.output(pdfName,<span class=\"hljs-string\">&quot;F&quot;</span>)<br><br>images = glob.glob(<span class=\"hljs-string\">&quot;current_revise/&quot;</span>+<span class=\"hljs-string\">&quot;*.jpg&quot;</span>)<br><span class=\"hljs-comment\"># jpg_path = &quot;test.jpg&quot;</span><br>pdf_path = <span class=\"hljs-string\">&quot;test_file3.pdf&quot;</span><br>imagesTopdf(images,pdf_path)<br></code></pre></td></tr></table></figure>\n<h4 id=\"相关参数\">相关参数</h4>\n<p>1，其中<code>pdf = FPDF()</code>是创建对象，默认是：</p>\n<p>2，<code>orientation</code>为竖向（P：竖向，L横向）；</p>\n<p>3，<code>unit</code>为mm毫米。用于表示文档中位置的计量单元。可用的值有以下四种:</p>\n<ul>\n<li>pt: 点</li>\n<li>mm: 毫米</li>\n<li>cm: 厘米</li>\n<li>in: 英寸</li>\n</ul>\n<p>4，<code>format</code>用于表示创建的PDF文档的纸张类型。可用值可以是用于表示纸的字符串，如&quot;A4&quot;、“A5”、&quot;Letter&quot;等。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FPDF</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">object</span></span>):</span><br>    <span class=\"hljs-string\">&quot;PDF Generation class&quot;</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, orientation=<span class=\"hljs-string\">&#x27;P&#x27;</span>,unit=<span class=\"hljs-string\">&#x27;mm&#x27;</span>,<span class=\"hljs-built_in\">format</span>=<span class=\"hljs-string\">&#x27;A4&#x27;</span></span>)</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"相关函数\">相关函数</h4>\n<p><code>pdf.add_page()</code>用于创建新页。</p>\n<p><code> pdf.image(imagePath,x=0,y=0,w=170,h=297)</code>是用于添加图像，其中<code>x</code>和<code>y</code>表示图片所在的坐标，<code>width</code>和<code>height</code>表示图片的宽度和高度。如果需要图片保持原来的大小，只需要将<code>width</code>和<code>height</code>设置成<code>0</code>即可。矫正后的图片是1700，2981；A4纸的尺寸是210*297，所以只能设置为297，也就是说这里误差至少有1.1mm</p>\n<p>image源代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">image</span>(<span class=\"hljs-params\">self, name, x=<span class=\"hljs-literal\">None</span>, y=<span class=\"hljs-literal\">None</span>, w=<span class=\"hljs-number\">0</span>,h=<span class=\"hljs-number\">0</span>,<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">&#x27;&#x27;</span>,link=<span class=\"hljs-string\">&#x27;&#x27;</span></span>):</span><br>    <span class=\"hljs-string\">&quot;Put an image on the page&quot;</span><br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> name <span class=\"hljs-keyword\">in</span> self.images:<br>        <span class=\"hljs-comment\">#First use of image, get info</span><br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">type</span>==<span class=\"hljs-string\">&#x27;&#x27;</span>):<br>            pos=name.rfind(<span class=\"hljs-string\">&#x27;.&#x27;</span>)<br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">not</span> pos):<br>                self.error(<span class=\"hljs-string\">&#x27;image file has no extension and no type was specified: &#x27;</span>+name)<br>            <span class=\"hljs-built_in\">type</span>=substr(name,pos+<span class=\"hljs-number\">1</span>)<br>        <span class=\"hljs-built_in\">type</span>=<span class=\"hljs-built_in\">type</span>.lower()<br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">type</span>==<span class=\"hljs-string\">&#x27;jpg&#x27;</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">type</span>==<span class=\"hljs-string\">&#x27;jpeg&#x27;</span>):<br>            info=self._parsejpg(name)<br>        <span class=\"hljs-keyword\">elif</span>(<span class=\"hljs-built_in\">type</span>==<span class=\"hljs-string\">&#x27;png&#x27;</span>):<br>            info=self._parsepng(name)<br>        <span class=\"hljs-keyword\">else</span>:<br>            <span class=\"hljs-comment\">#Allow for additional formats</span><br>            <span class=\"hljs-comment\">#maybe the image is not showing the correct extension,</span><br>            <span class=\"hljs-comment\">#but the header is OK,</span><br>            succeed_parsing = <span class=\"hljs-literal\">False</span><br>            <span class=\"hljs-comment\">#try all the parsing functions</span><br>            parsing_functions = [self._parsejpg,self._parsepng,self._parsegif]<br>            <span class=\"hljs-keyword\">for</span> pf <span class=\"hljs-keyword\">in</span> parsing_functions:<br>                <span class=\"hljs-keyword\">try</span>:<br>                    info = pf(name)<br>                    succeed_parsing = <span class=\"hljs-literal\">True</span><br>                    <span class=\"hljs-keyword\">break</span>;<br>                <span class=\"hljs-keyword\">except</span>:<br>                    <span class=\"hljs-keyword\">pass</span><br>            <span class=\"hljs-comment\">#last resource</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> succeed_parsing:<br>                mtd=<span class=\"hljs-string\">&#x27;_parse&#x27;</span>+<span class=\"hljs-built_in\">type</span><br>                <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">hasattr</span>(self,mtd):<br>                    self.error(<span class=\"hljs-string\">&#x27;Unsupported image type: &#x27;</span>+<span class=\"hljs-built_in\">type</span>)<br>                info=<span class=\"hljs-built_in\">getattr</span>(self, mtd)(name)<br>            mtd=<span class=\"hljs-string\">&#x27;_parse&#x27;</span>+<span class=\"hljs-built_in\">type</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">hasattr</span>(self,mtd):<br>                self.error(<span class=\"hljs-string\">&#x27;Unsupported image type: &#x27;</span>+<span class=\"hljs-built_in\">type</span>)<br>            info=<span class=\"hljs-built_in\">getattr</span>(self, mtd)(name)<br>        info[<span class=\"hljs-string\">&#x27;i&#x27;</span>]=<span class=\"hljs-built_in\">len</span>(self.images)+<span class=\"hljs-number\">1</span><br>        self.images[name]=info<br>    <span class=\"hljs-keyword\">else</span>:<br>        info=self.images[name]<br>    <span class=\"hljs-comment\">#Automatic width and height calculation if needed</span><br>    <span class=\"hljs-keyword\">if</span>(w==<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> h==<span class=\"hljs-number\">0</span>):<br>        <span class=\"hljs-comment\">#Put image at 72 dpi</span><br>        w=info[<span class=\"hljs-string\">&#x27;w&#x27;</span>]/self.k<br>        h=info[<span class=\"hljs-string\">&#x27;h&#x27;</span>]/self.k<br>    <span class=\"hljs-keyword\">elif</span>(w==<span class=\"hljs-number\">0</span>):<br>        w=h*info[<span class=\"hljs-string\">&#x27;w&#x27;</span>]/info[<span class=\"hljs-string\">&#x27;h&#x27;</span>]<br>    <span class=\"hljs-keyword\">elif</span>(h==<span class=\"hljs-number\">0</span>):<br>        h=w*info[<span class=\"hljs-string\">&#x27;h&#x27;</span>]/info[<span class=\"hljs-string\">&#x27;w&#x27;</span>]<br>    <span class=\"hljs-comment\"># Flowing mode</span><br>    <span class=\"hljs-keyword\">if</span> y <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">None</span>:<br>        <span class=\"hljs-keyword\">if</span> (self.y + h &gt; self.page_break_trigger <span class=\"hljs-keyword\">and</span> <span class=\"hljs-keyword\">not</span> self.in_footer <span class=\"hljs-keyword\">and</span> self.accept_page_break()):<br>            <span class=\"hljs-comment\">#Automatic page break</span><br>            x = self.x<br>            self.add_page(self.cur_orientation)<br>            self.x = x<br>        y = self.y<br>        self.y += h<br>    <span class=\"hljs-keyword\">if</span> x <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">None</span>:<br>        x = self.x<br>    self._out(sprintf(<span class=\"hljs-string\">&#x27;q %.2f 0 0 %.2f %.2f %.2f cm /I%d Do Q&#x27;</span>,w*self.k,h*self.k,x*self.k,(self.h-(y+h))*self.k,info[<span class=\"hljs-string\">&#x27;i&#x27;</span>]))<br>    <span class=\"hljs-keyword\">if</span>(link):<br>        self.link(x,y,w,h,link)<br></code></pre></td></tr></table></figure>\n"},{"title":"cv读取带有中文路径的图片","date":"2021-10-20T13:12:21.000Z","_content":"\n> 常规在读取图片时使用的代码是`cv.imread(path)`，但是路径中出现中文时就会出现，读取为空的情况，以下给出解决方法。\n\n\n\n## 背景\n\n首先介绍一下`cv2.imread()函数`\n\n```python\ncv2.imread(filepath,flags)\nfilepath:是要读入的图片路径\nflags: 读入图片的格式\ncv2.IMRAED_COLOR:默认选择此参数，读入彩色图片，BGR的格式，忽略了alpha通道，也可以使用数字1代替。\ncv2.IMREAD_GRAYSCALE:读入灰度图片，可以直接写0\ncv2.IMREAD_UNCHANGED:顾名思义，读入完整图片，包括alpha通道，可以直接写-1（BGRA）\n\ncv2.COLOR_BGR2GRAY:可以转换颜色空间，由BGR转换为RGB\ncv2.COLOR_RGB2GRAY:有RGB转换为灰度图格式\n```\n> alpha通道，又称A通道，是一个8位的灰度通道，该通道用256级灰度来记录图像中的透明度复信息，定义透明、不透明和半透明区域，其中黑表示全透明，白表示不透明，灰表示半透明。如果读取的图片没有alpha通道则还是按照三通道读取。\n\n\n\n## 解决方案\n\n**原因：**  在读取含有中文字符的路径图片时会返回None，这是由于opencv不接受non-ascii的路径。\n\n**方法：** 先使用numpy的fromfile将图片读取为np.uint8的格式，再使用cv的imdecode函数解码。 \n\n**具体代码**\n\n```python\nimport cv2\nimport numpy as np\nim_path = './测试数据/temp_long.jpg'\nim = cv2.imdecode(np.fromfile(im_path, dtype=np.uint8))\ncv2.imshow(\"显示图片\",im)\nprint(im.shape)\ncv2.waitKey(0)\n```\n**代码具体分析：**\n先不直接读取图片，而是采用`numpy`中的`fromfile`读取文件，将图片按照int类型读入数据，读入的是一维数组，然后通过cv中`imdecode`来对数组解码得到图片，`imdecode`函数的作用是`从内存缓冲区中读取图像`，如果缓冲区太短或包含无效数据时，函数返回一个空矩阵(Mat::data==NULL)。如果是彩色图像，解码后的图像将按照B G R顺序存储通道。这函数有两个参数`imdecode(buf,flags)`，buf是输入数组或字节向量，flags 与cv::imread相同的flag。\n\n> cv2.IMREAD_COLOR：加载彩色图片，这个是默认参数，可以直接写1 （BGR形式）\n> cv2.IMREAD_GRAYSCALE：以灰度模式加载图片，可以直接写0\n> cv2.IMREAD_UNCHANGED：包括alpha，可以直接写-1\n\n**保存**\n\n\n'.jpg'表示把当前图片img按照jpg格式编码，按照不同格式编码的结果不一样\n\n```python\nimport cv2\nimport numpy as np\nim_path = './测试数据/temp_long.jpg'\nim = cv2.imdecode(np.fromfile(im_path, dtype=np.uint8))\ncv2.imshow(\"显示图片\",im)\ncv2.imencode('.jpg', im)[1].tofile('E:\\测试路径/frameTest.jpg')#英文或中文路径均适用\n```\n\n","source":"_posts/python/img/cvread.md","raw":"---\ntitle: cv读取带有中文路径的图片\ntags: [python,图像]\ncategories: [python,图像]\ndate: 2021-10-20 21:12:21\n---\n\n> 常规在读取图片时使用的代码是`cv.imread(path)`，但是路径中出现中文时就会出现，读取为空的情况，以下给出解决方法。\n\n\n\n## 背景\n\n首先介绍一下`cv2.imread()函数`\n\n```python\ncv2.imread(filepath,flags)\nfilepath:是要读入的图片路径\nflags: 读入图片的格式\ncv2.IMRAED_COLOR:默认选择此参数，读入彩色图片，BGR的格式，忽略了alpha通道，也可以使用数字1代替。\ncv2.IMREAD_GRAYSCALE:读入灰度图片，可以直接写0\ncv2.IMREAD_UNCHANGED:顾名思义，读入完整图片，包括alpha通道，可以直接写-1（BGRA）\n\ncv2.COLOR_BGR2GRAY:可以转换颜色空间，由BGR转换为RGB\ncv2.COLOR_RGB2GRAY:有RGB转换为灰度图格式\n```\n> alpha通道，又称A通道，是一个8位的灰度通道，该通道用256级灰度来记录图像中的透明度复信息，定义透明、不透明和半透明区域，其中黑表示全透明，白表示不透明，灰表示半透明。如果读取的图片没有alpha通道则还是按照三通道读取。\n\n\n\n## 解决方案\n\n**原因：**  在读取含有中文字符的路径图片时会返回None，这是由于opencv不接受non-ascii的路径。\n\n**方法：** 先使用numpy的fromfile将图片读取为np.uint8的格式，再使用cv的imdecode函数解码。 \n\n**具体代码**\n\n```python\nimport cv2\nimport numpy as np\nim_path = './测试数据/temp_long.jpg'\nim = cv2.imdecode(np.fromfile(im_path, dtype=np.uint8))\ncv2.imshow(\"显示图片\",im)\nprint(im.shape)\ncv2.waitKey(0)\n```\n**代码具体分析：**\n先不直接读取图片，而是采用`numpy`中的`fromfile`读取文件，将图片按照int类型读入数据，读入的是一维数组，然后通过cv中`imdecode`来对数组解码得到图片，`imdecode`函数的作用是`从内存缓冲区中读取图像`，如果缓冲区太短或包含无效数据时，函数返回一个空矩阵(Mat::data==NULL)。如果是彩色图像，解码后的图像将按照B G R顺序存储通道。这函数有两个参数`imdecode(buf,flags)`，buf是输入数组或字节向量，flags 与cv::imread相同的flag。\n\n> cv2.IMREAD_COLOR：加载彩色图片，这个是默认参数，可以直接写1 （BGR形式）\n> cv2.IMREAD_GRAYSCALE：以灰度模式加载图片，可以直接写0\n> cv2.IMREAD_UNCHANGED：包括alpha，可以直接写-1\n\n**保存**\n\n\n'.jpg'表示把当前图片img按照jpg格式编码，按照不同格式编码的结果不一样\n\n```python\nimport cv2\nimport numpy as np\nim_path = './测试数据/temp_long.jpg'\nim = cv2.imdecode(np.fromfile(im_path, dtype=np.uint8))\ncv2.imshow(\"显示图片\",im)\ncv2.imencode('.jpg', im)[1].tofile('E:\\测试路径/frameTest.jpg')#英文或中文路径均适用\n```\n\n","slug":"python/img/cvread","published":1,"updated":"2022-01-18T08:10:17.110Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0c90075ast96072gtdi","content":"<blockquote>\n<p>常规在读取图片时使用的代码是<code>cv.imread(path)</code>，但是路径中出现中文时就会出现，读取为空的情况，以下给出解决方法。</p>\n</blockquote>\n<h2 id=\"背景\">背景</h2>\n<p>首先介绍一下<code>cv2.imread()函数</code></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">cv2.imread(filepath,flags)<br>filepath:是要读入的图片路径<br>flags: 读入图片的格式<br>cv2.IMRAED_COLOR:默认选择此参数，读入彩色图片，BGR的格式，忽略了alpha通道，也可以使用数字<span class=\"hljs-number\">1</span>代替。<br>cv2.IMREAD_GRAYSCALE:读入灰度图片，可以直接写<span class=\"hljs-number\">0</span><br>cv2.IMREAD_UNCHANGED:顾名思义，读入完整图片，包括alpha通道，可以直接写-<span class=\"hljs-number\">1</span>（BGRA）<br><br>cv2.COLOR_BGR2GRAY:可以转换颜色空间，由BGR转换为RGB<br>cv2.COLOR_RGB2GRAY:有RGB转换为灰度图格式<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>alpha通道，又称A通道，是一个8位的灰度通道，该通道用256级灰度来记录图像中的透明度复信息，定义透明、不透明和半透明区域，其中黑表示全透明，白表示不透明，灰表示半透明。如果读取的图片没有alpha通道则还是按照三通道读取。</p>\n</blockquote>\n<h2 id=\"解决方案\">解决方案</h2>\n<p><strong>原因：</strong>  在读取含有中文字符的路径图片时会返回None，这是由于opencv不接受non-ascii的路径。</p>\n<p><strong>方法：</strong> 先使用numpy的fromfile将图片读取为np.uint8的格式，再使用cv的imdecode函数解码。</p>\n<p><strong>具体代码</strong></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br>im_path = <span class=\"hljs-string\">'./测试数据/temp_long.jpg'</span><br>im = cv2.imdecode(np.fromfile(im_path, dtype=np.uint8))<br>cv2.imshow(<span class=\"hljs-string\">\"显示图片\"</span>,im)<br><span class=\"hljs-built_in\">print</span>(im.shape)<br>cv2.waitKey(<span class=\"hljs-number\">0</span>)<br></code></pre></td></tr></tbody></table></figure>\n<p><strong>代码具体分析：</strong><br>\n先不直接读取图片，而是采用<code>numpy</code>中的<code>fromfile</code>读取文件，将图片按照int类型读入数据，读入的是一维数组，然后通过cv中<code>imdecode</code>来对数组解码得到图片，<code>imdecode</code>函数的作用是<code>从内存缓冲区中读取图像</code>，如果缓冲区太短或包含无效数据时，函数返回一个空矩阵(Mat::data==NULL)。如果是彩色图像，解码后的图像将按照B G R顺序存储通道。这函数有两个参数<code>imdecode(buf,flags)</code>，buf是输入数组或字节向量，flags 与cv::imread相同的flag。</p>\n<blockquote>\n<p>cv2.IMREAD_COLOR：加载彩色图片，这个是默认参数，可以直接写1 （BGR形式）<br>\ncv2.IMREAD_GRAYSCALE：以灰度模式加载图片，可以直接写0<br>\ncv2.IMREAD_UNCHANGED：包括alpha，可以直接写-1</p>\n</blockquote>\n<p><strong>保存</strong></p>\n<p>'.jpg’表示把当前图片img按照jpg格式编码，按照不同格式编码的结果不一样</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br>im_path = <span class=\"hljs-string\">'./测试数据/temp_long.jpg'</span><br>im = cv2.imdecode(np.fromfile(im_path, dtype=np.uint8))<br>cv2.imshow(<span class=\"hljs-string\">\"显示图片\"</span>,im)<br>cv2.imencode(<span class=\"hljs-string\">'.jpg'</span>, im)[<span class=\"hljs-number\">1</span>].tofile(<span class=\"hljs-string\">'E:\\测试路径/frameTest.jpg'</span>)<span class=\"hljs-comment\">#英文或中文路径均适用</span><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>常规在读取图片时使用的代码是<code>cv.imread(path)</code>，但是路径中出现中文时就会出现，读取为空的情况，以下给出解决方法。</p>\n</blockquote>\n<h2 id=\"背景\">背景</h2>\n<p>首先介绍一下<code>cv2.imread()函数</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">cv2.imread(filepath,flags)<br>filepath:是要读入的图片路径<br>flags: 读入图片的格式<br>cv2.IMRAED_COLOR:默认选择此参数，读入彩色图片，BGR的格式，忽略了alpha通道，也可以使用数字<span class=\"hljs-number\">1</span>代替。<br>cv2.IMREAD_GRAYSCALE:读入灰度图片，可以直接写<span class=\"hljs-number\">0</span><br>cv2.IMREAD_UNCHANGED:顾名思义，读入完整图片，包括alpha通道，可以直接写-<span class=\"hljs-number\">1</span>（BGRA）<br><br>cv2.COLOR_BGR2GRAY:可以转换颜色空间，由BGR转换为RGB<br>cv2.COLOR_RGB2GRAY:有RGB转换为灰度图格式<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>alpha通道，又称A通道，是一个8位的灰度通道，该通道用256级灰度来记录图像中的透明度复信息，定义透明、不透明和半透明区域，其中黑表示全透明，白表示不透明，灰表示半透明。如果读取的图片没有alpha通道则还是按照三通道读取。</p>\n</blockquote>\n<h2 id=\"解决方案\">解决方案</h2>\n<p><strong>原因：</strong>  在读取含有中文字符的路径图片时会返回None，这是由于opencv不接受non-ascii的路径。</p>\n<p><strong>方法：</strong> 先使用numpy的fromfile将图片读取为np.uint8的格式，再使用cv的imdecode函数解码。</p>\n<p><strong>具体代码</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br>im_path = <span class=\"hljs-string\">&#x27;./测试数据/temp_long.jpg&#x27;</span><br>im = cv2.imdecode(np.fromfile(im_path, dtype=np.uint8))<br>cv2.imshow(<span class=\"hljs-string\">&quot;显示图片&quot;</span>,im)<br><span class=\"hljs-built_in\">print</span>(im.shape)<br>cv2.waitKey(<span class=\"hljs-number\">0</span>)<br></code></pre></td></tr></table></figure>\n<p><strong>代码具体分析：</strong><br>\n先不直接读取图片，而是采用<code>numpy</code>中的<code>fromfile</code>读取文件，将图片按照int类型读入数据，读入的是一维数组，然后通过cv中<code>imdecode</code>来对数组解码得到图片，<code>imdecode</code>函数的作用是<code>从内存缓冲区中读取图像</code>，如果缓冲区太短或包含无效数据时，函数返回一个空矩阵(Mat::data==NULL)。如果是彩色图像，解码后的图像将按照B G R顺序存储通道。这函数有两个参数<code>imdecode(buf,flags)</code>，buf是输入数组或字节向量，flags 与cv::imread相同的flag。</p>\n<blockquote>\n<p>cv2.IMREAD_COLOR：加载彩色图片，这个是默认参数，可以直接写1 （BGR形式）<br>\ncv2.IMREAD_GRAYSCALE：以灰度模式加载图片，可以直接写0<br>\ncv2.IMREAD_UNCHANGED：包括alpha，可以直接写-1</p>\n</blockquote>\n<p><strong>保存</strong></p>\n<p>'.jpg’表示把当前图片img按照jpg格式编码，按照不同格式编码的结果不一样</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br>im_path = <span class=\"hljs-string\">&#x27;./测试数据/temp_long.jpg&#x27;</span><br>im = cv2.imdecode(np.fromfile(im_path, dtype=np.uint8))<br>cv2.imshow(<span class=\"hljs-string\">&quot;显示图片&quot;</span>,im)<br>cv2.imencode(<span class=\"hljs-string\">&#x27;.jpg&#x27;</span>, im)[<span class=\"hljs-number\">1</span>].tofile(<span class=\"hljs-string\">&#x27;E:\\测试路径/frameTest.jpg&#x27;</span>)<span class=\"hljs-comment\">#英文或中文路径均适用</span><br></code></pre></td></tr></table></figure>\n"},{"title":"dcm文件转换为3D的nii文件","date":"2021-11-26T03:09:37.000Z","_content":"\n> 记录dcm文件转换为nii文件的代码\n\n# 前言\n\nNIfTI 中的图像原始数据一般被存储成了三维图像，而dicom存储为二维图层，所以相对于DICOM文件，NIFTI文件更加易用于机器学习，因为NIfTI 是三维图像，处理一个单独的NIfTI 文件要比处理成百上千个DICOM文件更加容易一些。\n\n# 医学图像格式\n\nDICOM 和 NIFTI 是最常用的格式，下面对其进行简单介绍。\n\n## DICOM\n\nDICOM 代表的是医疗数字成像和通信。DICOM 是由美国国家电气制造商协会（NEMA）制定的标准。它定义了医疗成像领域中关于信息处理、存储、打印以及传输的标准，这些都是你在扫描仪或者某家医院的图片归档和通信系统（PACS）能够立即得到的文件格式。\n它包括了文件格式和能够接收图像以及 DICOM 格式的病人数据的实体之间使用 TCP/IP 进行通信的协议。\n\n一个 DICOM 文件包含文件头部和同文件名的*.dcm 图像数据。文件头部的大小取决于它所提供的信息的多少。文件头包含以下信息：病人的 ID，病人的姓名，图像的模态以及其他信息。它定义了帧的数量以及图像的精度。这些信息会被图像浏览器在显示图像时用到。对于一个图像采样，会有很多个 DICOM 文件。\n\n## NIFTI\n\nNifti 格式最初是为神经影像学发明的。神经影像信息学技术计划（NIFTI）将 NIfTI 格式预设为 ANALYZE7.5 格式的替代品。它最初的应用领域是神经影像，但是也被用在其他领域。这种格式的主要特点就是它包含两个能够将每个体素的索引（i,j,k）和它的空间位置（x,y,z）关联起来的仿射坐标。\n\n#### 代码\n\n```python\n#coding=utf-8\nimport SimpleITK as sitk\nimport os,glob\n\ndef dcm2nii(dcms_path, nii_path):\n    # 1.构建dicom序列文件阅读器，并执行（即将dicom序列文件“打包整合”）\n    reader = sitk.ImageSeriesReader()\n    dicom_names = reader.GetGDCMSeriesFileNames(dcms_path)\n    reader.SetFileNames(dicom_names)\n    image2 = reader.Execute()\n    # 2.将整合后的数据转为array，并获取dicom文件基本信息\n    image_array = sitk.GetArrayFromImage(image2)  # z, y, x\n    origin = image2.GetOrigin()  # x, y, z\n    spacing = image2.GetSpacing()  # x, y, z\n    direction = image2.GetDirection()  # x, y, z\n    # 3.将array转为img，并保存为.nii.gz\n    image3 = sitk.GetImageFromArray(image_array)\n    image3.SetSpacing(spacing)\n    image3.SetDirection(direction)\n    image3.SetOrigin(origin)\n    sitk.WriteImage(image3, nii_path)\n\n\nif __name__ == '__main__':\n    filelist = glob.glob(\"./data/AD_result/I*\")\n    save_path = \"./data/AD_nii\"\n    os.makedirs(save_path,exist_ok=True)\n    for dcms_path in filelist:\n        dirname = dcms_path.split(os.path.sep)[-1]\n        nii_path = os.path.join(save_path,dirname+ \".nii\")\n        print(nii_path)\n       # r'.\\test.nii.gz'  # 所需.nii.gz文件保存路径\n        dcm2nii(dcms_path, nii_path)\n\n```\n\n# 图像自动处理工具SimpleITK的使用\n\n参考：https://www.ebaina.com/articles/140000012739\n\n#### 安装SimpleITK库\n\n```\n命令行模式下，任意位置输入：\n  pip install SimpleITK\n```\n\n### SimpleITK处理医学图像\n\n做医学图像时，SimpleITK是一个很常用的库。实际上大家往往喜欢把不同类型的数据割裂开，nrrd用pynrrd处理，dicom用dicom处理，nii用nibabel处理……实际上根本没必要，SimpleITK完全可以统一处理，各种类型的读取和保存一步搞定。\n\n#### 读取\n\n##### DICOM\n\n首先是最常见的DICOM。这个文件格式是CT机器直接输出的结果，每个病人会是一个文件夹，里面有若干个DICOM文件，每个DICOM文件都是一个切片，可以被单独查阅（通过SimpleITK的ReadImage）。但是，处理起来一般我们会希望把这些DICOM组合起来形成一个3D的矩阵，这样就可以用到SimpltITK里的`ImageSeriesReader()`来实现：\n\n```python\nimport SimpleITK as sitk\nreader = sitk.ImageSeriesReader() \nimg_names = reader.GetGDCMSeriesFileNames(img_path) \nreader.SetFileNames(img_names) \nimage = reader.Execute() \nimage_array = sitk.GetArrayFromImage(image) # z, y, x \n```\n\n##### MHD\n\n然后还有就是。这种格式的文件由一个MHD文件和一个RAW文件组成，其中MHD里面是病人和CT扫描结果的相关信息，RAW里面存的是真正的数组，对于这种格式，SimpleITK可以这样读取：\n\n```python\nimport SimpleITK as sitk\nitk_img = sitk.ReadImage(filename) \nimg_array = sitk.GetArrayFromImage(itk_img) \n```\n\n##### NII\n\n```python\nimport SimpleITK as sitk\nitk_img = sitk.ReadImage(filename)\nimg_array = sitk.GetArrayFromImage(itk_img) \n```\n不过，对于NII类型的文件，SimpleITK在保存上会有一些问题（读取没问题保存上竟然有问题我真是服了），如果slice的数量很大（之前有碰到过300多个slice的），保存起来会直接报错，所以如果碰到这种情况我会选择保存成nrrd（用pynrrd库）\n\n#### 保存\n\n说到保存，有几个天坑一定要说一下。\n\n首先，保存的通用代码是：\n\n```\nsavedImg = sitk.GetImageFromArray(outputs3D) \nsavedImg.SetSpacing(spacing)\nsavedImg.SetOrigin(origin) \nsitk.WriteImage(savedImg, input_nii[:-4]+'_liverSegResult.nii')\n\n```\n\n这个里面，SetOrigin和SetSpacing我常常会忘记，所以导致保存的CT用ITKsnap看会变形。这里面的spacing和origin均可以从之前ReadImage()返回的对象上通过GetOrigin()和GetSpacing()获取，千万别忘了。当然，除了这两个之外还有个direction也是可以get和set的，不过一般情况下只要你代码没有搞一些矩阵的翻转等操作这个是不用管的。\n\n### 使用SimpleITK读取和保存Nii.gz文件\n\n```python\n## using simpleITK to load and save data.\nimport SimpleITK as sitk\nitk_img = sitk.ReadImage('./nifti.nii.gz')\nimg = sitk.GetArrayFromImage(itk_img)\nprint(\"img shape:\",img.shape)\n\n## save \nout = sitk.GetImageFromArray(img)\n# # out.SetSpacing(itk_img.GetSpacing())\n# # out.SetOrigin(itk_img.GetOrigin())\nsitk.WriteImage(out,'simpleitk_save.nii.gz')\n```\n\n### 可视化一层\n\n下面的程序挑取一层进行可视化，并标注结节位置。\n\n```python\na = image_array.transpose(1,2,0)[:,:,0]  # transpose是将(z,x,y)的三维矩阵转为(x,y,z)的矩阵\nplt.gca().add_patch( plt.Rectangle((147,297), 24,24, fill=False,edgecolor='r', linewidth=3))\nplt.imshow(a[:,:,1]*255)  # 在图中画框\nplt.show()\n```\n\n","source":"_posts/python/img/dcm2nii.md","raw":"---\ntitle: dcm文件转换为3D的nii文件\ntags: [python,图像]\ncategories: [python,图像]\ndate: 2021-11-26 11:09:37\n---\n\n> 记录dcm文件转换为nii文件的代码\n\n# 前言\n\nNIfTI 中的图像原始数据一般被存储成了三维图像，而dicom存储为二维图层，所以相对于DICOM文件，NIFTI文件更加易用于机器学习，因为NIfTI 是三维图像，处理一个单独的NIfTI 文件要比处理成百上千个DICOM文件更加容易一些。\n\n# 医学图像格式\n\nDICOM 和 NIFTI 是最常用的格式，下面对其进行简单介绍。\n\n## DICOM\n\nDICOM 代表的是医疗数字成像和通信。DICOM 是由美国国家电气制造商协会（NEMA）制定的标准。它定义了医疗成像领域中关于信息处理、存储、打印以及传输的标准，这些都是你在扫描仪或者某家医院的图片归档和通信系统（PACS）能够立即得到的文件格式。\n它包括了文件格式和能够接收图像以及 DICOM 格式的病人数据的实体之间使用 TCP/IP 进行通信的协议。\n\n一个 DICOM 文件包含文件头部和同文件名的*.dcm 图像数据。文件头部的大小取决于它所提供的信息的多少。文件头包含以下信息：病人的 ID，病人的姓名，图像的模态以及其他信息。它定义了帧的数量以及图像的精度。这些信息会被图像浏览器在显示图像时用到。对于一个图像采样，会有很多个 DICOM 文件。\n\n## NIFTI\n\nNifti 格式最初是为神经影像学发明的。神经影像信息学技术计划（NIFTI）将 NIfTI 格式预设为 ANALYZE7.5 格式的替代品。它最初的应用领域是神经影像，但是也被用在其他领域。这种格式的主要特点就是它包含两个能够将每个体素的索引（i,j,k）和它的空间位置（x,y,z）关联起来的仿射坐标。\n\n#### 代码\n\n```python\n#coding=utf-8\nimport SimpleITK as sitk\nimport os,glob\n\ndef dcm2nii(dcms_path, nii_path):\n    # 1.构建dicom序列文件阅读器，并执行（即将dicom序列文件“打包整合”）\n    reader = sitk.ImageSeriesReader()\n    dicom_names = reader.GetGDCMSeriesFileNames(dcms_path)\n    reader.SetFileNames(dicom_names)\n    image2 = reader.Execute()\n    # 2.将整合后的数据转为array，并获取dicom文件基本信息\n    image_array = sitk.GetArrayFromImage(image2)  # z, y, x\n    origin = image2.GetOrigin()  # x, y, z\n    spacing = image2.GetSpacing()  # x, y, z\n    direction = image2.GetDirection()  # x, y, z\n    # 3.将array转为img，并保存为.nii.gz\n    image3 = sitk.GetImageFromArray(image_array)\n    image3.SetSpacing(spacing)\n    image3.SetDirection(direction)\n    image3.SetOrigin(origin)\n    sitk.WriteImage(image3, nii_path)\n\n\nif __name__ == '__main__':\n    filelist = glob.glob(\"./data/AD_result/I*\")\n    save_path = \"./data/AD_nii\"\n    os.makedirs(save_path,exist_ok=True)\n    for dcms_path in filelist:\n        dirname = dcms_path.split(os.path.sep)[-1]\n        nii_path = os.path.join(save_path,dirname+ \".nii\")\n        print(nii_path)\n       # r'.\\test.nii.gz'  # 所需.nii.gz文件保存路径\n        dcm2nii(dcms_path, nii_path)\n\n```\n\n# 图像自动处理工具SimpleITK的使用\n\n参考：https://www.ebaina.com/articles/140000012739\n\n#### 安装SimpleITK库\n\n```\n命令行模式下，任意位置输入：\n  pip install SimpleITK\n```\n\n### SimpleITK处理医学图像\n\n做医学图像时，SimpleITK是一个很常用的库。实际上大家往往喜欢把不同类型的数据割裂开，nrrd用pynrrd处理，dicom用dicom处理，nii用nibabel处理……实际上根本没必要，SimpleITK完全可以统一处理，各种类型的读取和保存一步搞定。\n\n#### 读取\n\n##### DICOM\n\n首先是最常见的DICOM。这个文件格式是CT机器直接输出的结果，每个病人会是一个文件夹，里面有若干个DICOM文件，每个DICOM文件都是一个切片，可以被单独查阅（通过SimpleITK的ReadImage）。但是，处理起来一般我们会希望把这些DICOM组合起来形成一个3D的矩阵，这样就可以用到SimpltITK里的`ImageSeriesReader()`来实现：\n\n```python\nimport SimpleITK as sitk\nreader = sitk.ImageSeriesReader() \nimg_names = reader.GetGDCMSeriesFileNames(img_path) \nreader.SetFileNames(img_names) \nimage = reader.Execute() \nimage_array = sitk.GetArrayFromImage(image) # z, y, x \n```\n\n##### MHD\n\n然后还有就是。这种格式的文件由一个MHD文件和一个RAW文件组成，其中MHD里面是病人和CT扫描结果的相关信息，RAW里面存的是真正的数组，对于这种格式，SimpleITK可以这样读取：\n\n```python\nimport SimpleITK as sitk\nitk_img = sitk.ReadImage(filename) \nimg_array = sitk.GetArrayFromImage(itk_img) \n```\n\n##### NII\n\n```python\nimport SimpleITK as sitk\nitk_img = sitk.ReadImage(filename)\nimg_array = sitk.GetArrayFromImage(itk_img) \n```\n不过，对于NII类型的文件，SimpleITK在保存上会有一些问题（读取没问题保存上竟然有问题我真是服了），如果slice的数量很大（之前有碰到过300多个slice的），保存起来会直接报错，所以如果碰到这种情况我会选择保存成nrrd（用pynrrd库）\n\n#### 保存\n\n说到保存，有几个天坑一定要说一下。\n\n首先，保存的通用代码是：\n\n```\nsavedImg = sitk.GetImageFromArray(outputs3D) \nsavedImg.SetSpacing(spacing)\nsavedImg.SetOrigin(origin) \nsitk.WriteImage(savedImg, input_nii[:-4]+'_liverSegResult.nii')\n\n```\n\n这个里面，SetOrigin和SetSpacing我常常会忘记，所以导致保存的CT用ITKsnap看会变形。这里面的spacing和origin均可以从之前ReadImage()返回的对象上通过GetOrigin()和GetSpacing()获取，千万别忘了。当然，除了这两个之外还有个direction也是可以get和set的，不过一般情况下只要你代码没有搞一些矩阵的翻转等操作这个是不用管的。\n\n### 使用SimpleITK读取和保存Nii.gz文件\n\n```python\n## using simpleITK to load and save data.\nimport SimpleITK as sitk\nitk_img = sitk.ReadImage('./nifti.nii.gz')\nimg = sitk.GetArrayFromImage(itk_img)\nprint(\"img shape:\",img.shape)\n\n## save \nout = sitk.GetImageFromArray(img)\n# # out.SetSpacing(itk_img.GetSpacing())\n# # out.SetOrigin(itk_img.GetOrigin())\nsitk.WriteImage(out,'simpleitk_save.nii.gz')\n```\n\n### 可视化一层\n\n下面的程序挑取一层进行可视化，并标注结节位置。\n\n```python\na = image_array.transpose(1,2,0)[:,:,0]  # transpose是将(z,x,y)的三维矩阵转为(x,y,z)的矩阵\nplt.gca().add_patch( plt.Rectangle((147,297), 24,24, fill=False,edgecolor='r', linewidth=3))\nplt.imshow(a[:,:,1]*255)  # 在图中画框\nplt.show()\n```\n\n","slug":"python/img/dcm2nii","published":1,"updated":"2022-01-18T08:10:17.110Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0cb0077ast9da9uf6rk","content":"<blockquote>\n<p>记录dcm文件转换为nii文件的代码</p>\n</blockquote>\n<h1>前言</h1>\n<p>NIfTI 中的图像原始数据一般被存储成了三维图像，而dicom存储为二维图层，所以相对于DICOM文件，NIFTI文件更加易用于机器学习，因为NIfTI 是三维图像，处理一个单独的NIfTI 文件要比处理成百上千个DICOM文件更加容易一些。</p>\n<h1>医学图像格式</h1>\n<p>DICOM 和 NIFTI 是最常用的格式，下面对其进行简单介绍。</p>\n<h2 id=\"DICOM\">DICOM</h2>\n<p>DICOM 代表的是医疗数字成像和通信。DICOM 是由美国国家电气制造商协会（NEMA）制定的标准。它定义了医疗成像领域中关于信息处理、存储、打印以及传输的标准，这些都是你在扫描仪或者某家医院的图片归档和通信系统（PACS）能够立即得到的文件格式。<br>\n它包括了文件格式和能够接收图像以及 DICOM 格式的病人数据的实体之间使用 TCP/IP 进行通信的协议。</p>\n<p>一个 DICOM 文件包含文件头部和同文件名的*.dcm 图像数据。文件头部的大小取决于它所提供的信息的多少。文件头包含以下信息：病人的 ID，病人的姓名，图像的模态以及其他信息。它定义了帧的数量以及图像的精度。这些信息会被图像浏览器在显示图像时用到。对于一个图像采样，会有很多个 DICOM 文件。</p>\n<h2 id=\"NIFTI\">NIFTI</h2>\n<p>Nifti 格式最初是为神经影像学发明的。神经影像信息学技术计划（NIFTI）将 NIfTI 格式预设为 ANALYZE7.5 格式的替代品。它最初的应用领域是神经影像，但是也被用在其他领域。这种格式的主要特点就是它包含两个能够将每个体素的索引（i,j,k）和它的空间位置（x,y,z）关联起来的仿射坐标。</p>\n<h4 id=\"代码\">代码</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#coding=utf-8</span><br><span class=\"hljs-keyword\">import</span> SimpleITK <span class=\"hljs-keyword\">as</span> sitk<br><span class=\"hljs-keyword\">import</span> os,glob<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dcm2nii</span>(<span class=\"hljs-params\">dcms_path, nii_path</span>):</span><br>    <span class=\"hljs-comment\"># 1.构建dicom序列文件阅读器，并执行（即将dicom序列文件“打包整合”）</span><br>    reader = sitk.ImageSeriesReader()<br>    dicom_names = reader.GetGDCMSeriesFileNames(dcms_path)<br>    reader.SetFileNames(dicom_names)<br>    image2 = reader.Execute()<br>    <span class=\"hljs-comment\"># 2.将整合后的数据转为array，并获取dicom文件基本信息</span><br>    image_array = sitk.GetArrayFromImage(image2)  <span class=\"hljs-comment\"># z, y, x</span><br>    origin = image2.GetOrigin()  <span class=\"hljs-comment\"># x, y, z</span><br>    spacing = image2.GetSpacing()  <span class=\"hljs-comment\"># x, y, z</span><br>    direction = image2.GetDirection()  <span class=\"hljs-comment\"># x, y, z</span><br>    <span class=\"hljs-comment\"># 3.将array转为img，并保存为.nii.gz</span><br>    image3 = sitk.GetImageFromArray(image_array)<br>    image3.SetSpacing(spacing)<br>    image3.SetDirection(direction)<br>    image3.SetOrigin(origin)<br>    sitk.WriteImage(image3, nii_path)<br><br><br><span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">'__main__'</span>:<br>    filelist = glob.glob(<span class=\"hljs-string\">\"./data/AD_result/I*\"</span>)<br>    save_path = <span class=\"hljs-string\">\"./data/AD_nii\"</span><br>    os.makedirs(save_path,exist_ok=<span class=\"hljs-literal\">True</span>)<br>    <span class=\"hljs-keyword\">for</span> dcms_path <span class=\"hljs-keyword\">in</span> filelist:<br>        dirname = dcms_path.split(os.path.sep)[-<span class=\"hljs-number\">1</span>]<br>        nii_path = os.path.join(save_path,dirname+ <span class=\"hljs-string\">\".nii\"</span>)<br>        <span class=\"hljs-built_in\">print</span>(nii_path)<br>       <span class=\"hljs-comment\"># r'.\\test.nii.gz'  # 所需.nii.gz文件保存路径</span><br>        dcm2nii(dcms_path, nii_path)<br><br></code></pre></td></tr></tbody></table></figure>\n<h1>图像自动处理工具SimpleITK的使用</h1>\n<p>参考：<a href=\"https://www.ebaina.com/articles/140000012739\">https://www.ebaina.com/articles/140000012739</a></p>\n<h4 id=\"安装SimpleITK库\">安装SimpleITK库</h4>\n<figure class=\"highlight cmake\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs cmake\">命令行模式下，任意位置输入：<br>  pip <span class=\"hljs-keyword\">install</span> SimpleITK<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"SimpleITK处理医学图像\">SimpleITK处理医学图像</h3>\n<p>做医学图像时，SimpleITK是一个很常用的库。实际上大家往往喜欢把不同类型的数据割裂开，nrrd用pynrrd处理，dicom用dicom处理，nii用nibabel处理……实际上根本没必要，SimpleITK完全可以统一处理，各种类型的读取和保存一步搞定。</p>\n<h4 id=\"读取\">读取</h4>\n<h5 id=\"DICOM-2\">DICOM</h5>\n<p>首先是最常见的DICOM。这个文件格式是CT机器直接输出的结果，每个病人会是一个文件夹，里面有若干个DICOM文件，每个DICOM文件都是一个切片，可以被单独查阅（通过SimpleITK的ReadImage）。但是，处理起来一般我们会希望把这些DICOM组合起来形成一个3D的矩阵，这样就可以用到SimpltITK里的<code>ImageSeriesReader()</code>来实现：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> SimpleITK <span class=\"hljs-keyword\">as</span> sitk<br>reader = sitk.ImageSeriesReader() <br>img_names = reader.GetGDCMSeriesFileNames(img_path) <br>reader.SetFileNames(img_names) <br>image = reader.Execute() <br>image_array = sitk.GetArrayFromImage(image) <span class=\"hljs-comment\"># z, y, x </span><br></code></pre></td></tr></tbody></table></figure>\n<h5 id=\"MHD\">MHD</h5>\n<p>然后还有就是。这种格式的文件由一个MHD文件和一个RAW文件组成，其中MHD里面是病人和CT扫描结果的相关信息，RAW里面存的是真正的数组，对于这种格式，SimpleITK可以这样读取：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> SimpleITK <span class=\"hljs-keyword\">as</span> sitk<br>itk_img = sitk.ReadImage(filename) <br>img_array = sitk.GetArrayFromImage(itk_img) <br></code></pre></td></tr></tbody></table></figure>\n<h5 id=\"NII\">NII</h5>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> SimpleITK <span class=\"hljs-keyword\">as</span> sitk<br>itk_img = sitk.ReadImage(filename)<br>img_array = sitk.GetArrayFromImage(itk_img) <br></code></pre></td></tr></tbody></table></figure>\n<p>不过，对于NII类型的文件，SimpleITK在保存上会有一些问题（读取没问题保存上竟然有问题我真是服了），如果slice的数量很大（之前有碰到过300多个slice的），保存起来会直接报错，所以如果碰到这种情况我会选择保存成nrrd（用pynrrd库）</p>\n<h4 id=\"保存\">保存</h4>\n<p>说到保存，有几个天坑一定要说一下。</p>\n<p>首先，保存的通用代码是：</p>\n<figure class=\"highlight reasonml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs reasonml\">savedImg = sitk.<span class=\"hljs-constructor\">GetImageFromArray(<span class=\"hljs-params\">outputs3D</span>)</span> <br>savedImg.<span class=\"hljs-constructor\">SetSpacing(<span class=\"hljs-params\">spacing</span>)</span><br>savedImg.<span class=\"hljs-constructor\">SetOrigin(<span class=\"hljs-params\">origin</span>)</span> <br>sitk.<span class=\"hljs-constructor\">WriteImage(<span class=\"hljs-params\">savedImg</span>, <span class=\"hljs-params\">input_nii</span>[:-4]+'<span class=\"hljs-params\">_liverSegResult</span>.<span class=\"hljs-params\">nii</span>')</span><br><br></code></pre></td></tr></tbody></table></figure>\n<p>这个里面，SetOrigin和SetSpacing我常常会忘记，所以导致保存的CT用ITKsnap看会变形。这里面的spacing和origin均可以从之前ReadImage()返回的对象上通过GetOrigin()和GetSpacing()获取，千万别忘了。当然，除了这两个之外还有个direction也是可以get和set的，不过一般情况下只要你代码没有搞一些矩阵的翻转等操作这个是不用管的。</p>\n<h3 id=\"使用SimpleITK读取和保存Nii-gz文件\">使用SimpleITK读取和保存Nii.gz文件</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">## using simpleITK to load and save data.</span><br><span class=\"hljs-keyword\">import</span> SimpleITK <span class=\"hljs-keyword\">as</span> sitk<br>itk_img = sitk.ReadImage(<span class=\"hljs-string\">'./nifti.nii.gz'</span>)<br>img = sitk.GetArrayFromImage(itk_img)<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"img shape:\"</span>,img.shape)<br><br><span class=\"hljs-comment\">## save </span><br>out = sitk.GetImageFromArray(img)<br><span class=\"hljs-comment\"># # out.SetSpacing(itk_img.GetSpacing())</span><br><span class=\"hljs-comment\"># # out.SetOrigin(itk_img.GetOrigin())</span><br>sitk.WriteImage(out,<span class=\"hljs-string\">'simpleitk_save.nii.gz'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"可视化一层\">可视化一层</h3>\n<p>下面的程序挑取一层进行可视化，并标注结节位置。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">a = image_array.transpose(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">0</span>)[:,:,<span class=\"hljs-number\">0</span>]  <span class=\"hljs-comment\"># transpose是将(z,x,y)的三维矩阵转为(x,y,z)的矩阵</span><br>plt.gca().add_patch( plt.Rectangle((<span class=\"hljs-number\">147</span>,<span class=\"hljs-number\">297</span>), <span class=\"hljs-number\">24</span>,<span class=\"hljs-number\">24</span>, fill=<span class=\"hljs-literal\">False</span>,edgecolor=<span class=\"hljs-string\">'r'</span>, linewidth=<span class=\"hljs-number\">3</span>))<br>plt.imshow(a[:,:,<span class=\"hljs-number\">1</span>]*<span class=\"hljs-number\">255</span>)  <span class=\"hljs-comment\"># 在图中画框</span><br>plt.show()<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>记录dcm文件转换为nii文件的代码</p>\n</blockquote>\n<h1>前言</h1>\n<p>NIfTI 中的图像原始数据一般被存储成了三维图像，而dicom存储为二维图层，所以相对于DICOM文件，NIFTI文件更加易用于机器学习，因为NIfTI 是三维图像，处理一个单独的NIfTI 文件要比处理成百上千个DICOM文件更加容易一些。</p>\n<h1>医学图像格式</h1>\n<p>DICOM 和 NIFTI 是最常用的格式，下面对其进行简单介绍。</p>\n<h2 id=\"DICOM\">DICOM</h2>\n<p>DICOM 代表的是医疗数字成像和通信。DICOM 是由美国国家电气制造商协会（NEMA）制定的标准。它定义了医疗成像领域中关于信息处理、存储、打印以及传输的标准，这些都是你在扫描仪或者某家医院的图片归档和通信系统（PACS）能够立即得到的文件格式。<br>\n它包括了文件格式和能够接收图像以及 DICOM 格式的病人数据的实体之间使用 TCP/IP 进行通信的协议。</p>\n<p>一个 DICOM 文件包含文件头部和同文件名的*.dcm 图像数据。文件头部的大小取决于它所提供的信息的多少。文件头包含以下信息：病人的 ID，病人的姓名，图像的模态以及其他信息。它定义了帧的数量以及图像的精度。这些信息会被图像浏览器在显示图像时用到。对于一个图像采样，会有很多个 DICOM 文件。</p>\n<h2 id=\"NIFTI\">NIFTI</h2>\n<p>Nifti 格式最初是为神经影像学发明的。神经影像信息学技术计划（NIFTI）将 NIfTI 格式预设为 ANALYZE7.5 格式的替代品。它最初的应用领域是神经影像，但是也被用在其他领域。这种格式的主要特点就是它包含两个能够将每个体素的索引（i,j,k）和它的空间位置（x,y,z）关联起来的仿射坐标。</p>\n<h4 id=\"代码\">代码</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#coding=utf-8</span><br><span class=\"hljs-keyword\">import</span> SimpleITK <span class=\"hljs-keyword\">as</span> sitk<br><span class=\"hljs-keyword\">import</span> os,glob<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dcm2nii</span>(<span class=\"hljs-params\">dcms_path, nii_path</span>):</span><br>    <span class=\"hljs-comment\"># 1.构建dicom序列文件阅读器，并执行（即将dicom序列文件“打包整合”）</span><br>    reader = sitk.ImageSeriesReader()<br>    dicom_names = reader.GetGDCMSeriesFileNames(dcms_path)<br>    reader.SetFileNames(dicom_names)<br>    image2 = reader.Execute()<br>    <span class=\"hljs-comment\"># 2.将整合后的数据转为array，并获取dicom文件基本信息</span><br>    image_array = sitk.GetArrayFromImage(image2)  <span class=\"hljs-comment\"># z, y, x</span><br>    origin = image2.GetOrigin()  <span class=\"hljs-comment\"># x, y, z</span><br>    spacing = image2.GetSpacing()  <span class=\"hljs-comment\"># x, y, z</span><br>    direction = image2.GetDirection()  <span class=\"hljs-comment\"># x, y, z</span><br>    <span class=\"hljs-comment\"># 3.将array转为img，并保存为.nii.gz</span><br>    image3 = sitk.GetImageFromArray(image_array)<br>    image3.SetSpacing(spacing)<br>    image3.SetDirection(direction)<br>    image3.SetOrigin(origin)<br>    sitk.WriteImage(image3, nii_path)<br><br><br><span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&#x27;__main__&#x27;</span>:<br>    filelist = glob.glob(<span class=\"hljs-string\">&quot;./data/AD_result/I*&quot;</span>)<br>    save_path = <span class=\"hljs-string\">&quot;./data/AD_nii&quot;</span><br>    os.makedirs(save_path,exist_ok=<span class=\"hljs-literal\">True</span>)<br>    <span class=\"hljs-keyword\">for</span> dcms_path <span class=\"hljs-keyword\">in</span> filelist:<br>        dirname = dcms_path.split(os.path.sep)[-<span class=\"hljs-number\">1</span>]<br>        nii_path = os.path.join(save_path,dirname+ <span class=\"hljs-string\">&quot;.nii&quot;</span>)<br>        <span class=\"hljs-built_in\">print</span>(nii_path)<br>       <span class=\"hljs-comment\"># r&#x27;.\\test.nii.gz&#x27;  # 所需.nii.gz文件保存路径</span><br>        dcm2nii(dcms_path, nii_path)<br><br></code></pre></td></tr></table></figure>\n<h1>图像自动处理工具SimpleITK的使用</h1>\n<p>参考：<a href=\"https://www.ebaina.com/articles/140000012739\">https://www.ebaina.com/articles/140000012739</a></p>\n<h4 id=\"安装SimpleITK库\">安装SimpleITK库</h4>\n<figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs cmake\">命令行模式下，任意位置输入：<br>  pip <span class=\"hljs-keyword\">install</span> SimpleITK<br></code></pre></td></tr></table></figure>\n<h3 id=\"SimpleITK处理医学图像\">SimpleITK处理医学图像</h3>\n<p>做医学图像时，SimpleITK是一个很常用的库。实际上大家往往喜欢把不同类型的数据割裂开，nrrd用pynrrd处理，dicom用dicom处理，nii用nibabel处理……实际上根本没必要，SimpleITK完全可以统一处理，各种类型的读取和保存一步搞定。</p>\n<h4 id=\"读取\">读取</h4>\n<h5 id=\"DICOM-2\">DICOM</h5>\n<p>首先是最常见的DICOM。这个文件格式是CT机器直接输出的结果，每个病人会是一个文件夹，里面有若干个DICOM文件，每个DICOM文件都是一个切片，可以被单独查阅（通过SimpleITK的ReadImage）。但是，处理起来一般我们会希望把这些DICOM组合起来形成一个3D的矩阵，这样就可以用到SimpltITK里的<code>ImageSeriesReader()</code>来实现：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> SimpleITK <span class=\"hljs-keyword\">as</span> sitk<br>reader = sitk.ImageSeriesReader() <br>img_names = reader.GetGDCMSeriesFileNames(img_path) <br>reader.SetFileNames(img_names) <br>image = reader.Execute() <br>image_array = sitk.GetArrayFromImage(image) <span class=\"hljs-comment\"># z, y, x </span><br></code></pre></td></tr></table></figure>\n<h5 id=\"MHD\">MHD</h5>\n<p>然后还有就是。这种格式的文件由一个MHD文件和一个RAW文件组成，其中MHD里面是病人和CT扫描结果的相关信息，RAW里面存的是真正的数组，对于这种格式，SimpleITK可以这样读取：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> SimpleITK <span class=\"hljs-keyword\">as</span> sitk<br>itk_img = sitk.ReadImage(filename) <br>img_array = sitk.GetArrayFromImage(itk_img) <br></code></pre></td></tr></table></figure>\n<h5 id=\"NII\">NII</h5>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> SimpleITK <span class=\"hljs-keyword\">as</span> sitk<br>itk_img = sitk.ReadImage(filename)<br>img_array = sitk.GetArrayFromImage(itk_img) <br></code></pre></td></tr></table></figure>\n<p>不过，对于NII类型的文件，SimpleITK在保存上会有一些问题（读取没问题保存上竟然有问题我真是服了），如果slice的数量很大（之前有碰到过300多个slice的），保存起来会直接报错，所以如果碰到这种情况我会选择保存成nrrd（用pynrrd库）</p>\n<h4 id=\"保存\">保存</h4>\n<p>说到保存，有几个天坑一定要说一下。</p>\n<p>首先，保存的通用代码是：</p>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs reasonml\">savedImg = sitk.<span class=\"hljs-constructor\">GetImageFromArray(<span class=\"hljs-params\">outputs3D</span>)</span> <br>savedImg.<span class=\"hljs-constructor\">SetSpacing(<span class=\"hljs-params\">spacing</span>)</span><br>savedImg.<span class=\"hljs-constructor\">SetOrigin(<span class=\"hljs-params\">origin</span>)</span> <br>sitk.<span class=\"hljs-constructor\">WriteImage(<span class=\"hljs-params\">savedImg</span>, <span class=\"hljs-params\">input_nii</span>[:-4]+&#x27;<span class=\"hljs-params\">_liverSegResult</span>.<span class=\"hljs-params\">nii</span>&#x27;)</span><br><br></code></pre></td></tr></table></figure>\n<p>这个里面，SetOrigin和SetSpacing我常常会忘记，所以导致保存的CT用ITKsnap看会变形。这里面的spacing和origin均可以从之前ReadImage()返回的对象上通过GetOrigin()和GetSpacing()获取，千万别忘了。当然，除了这两个之外还有个direction也是可以get和set的，不过一般情况下只要你代码没有搞一些矩阵的翻转等操作这个是不用管的。</p>\n<h3 id=\"使用SimpleITK读取和保存Nii-gz文件\">使用SimpleITK读取和保存Nii.gz文件</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">## using simpleITK to load and save data.</span><br><span class=\"hljs-keyword\">import</span> SimpleITK <span class=\"hljs-keyword\">as</span> sitk<br>itk_img = sitk.ReadImage(<span class=\"hljs-string\">&#x27;./nifti.nii.gz&#x27;</span>)<br>img = sitk.GetArrayFromImage(itk_img)<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;img shape:&quot;</span>,img.shape)<br><br><span class=\"hljs-comment\">## save </span><br>out = sitk.GetImageFromArray(img)<br><span class=\"hljs-comment\"># # out.SetSpacing(itk_img.GetSpacing())</span><br><span class=\"hljs-comment\"># # out.SetOrigin(itk_img.GetOrigin())</span><br>sitk.WriteImage(out,<span class=\"hljs-string\">&#x27;simpleitk_save.nii.gz&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<h3 id=\"可视化一层\">可视化一层</h3>\n<p>下面的程序挑取一层进行可视化，并标注结节位置。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">a = image_array.transpose(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">0</span>)[:,:,<span class=\"hljs-number\">0</span>]  <span class=\"hljs-comment\"># transpose是将(z,x,y)的三维矩阵转为(x,y,z)的矩阵</span><br>plt.gca().add_patch( plt.Rectangle((<span class=\"hljs-number\">147</span>,<span class=\"hljs-number\">297</span>), <span class=\"hljs-number\">24</span>,<span class=\"hljs-number\">24</span>, fill=<span class=\"hljs-literal\">False</span>,edgecolor=<span class=\"hljs-string\">&#x27;r&#x27;</span>, linewidth=<span class=\"hljs-number\">3</span>))<br>plt.imshow(a[:,:,<span class=\"hljs-number\">1</span>]*<span class=\"hljs-number\">255</span>)  <span class=\"hljs-comment\"># 在图中画框</span><br>plt.show()<br></code></pre></td></tr></table></figure>\n"},{"title":"将图像保存至Word中","date":"2021-12-10T05:20:28.000Z","_content":"\n>利用python，向Word中保存信息，这里主要是记录对图像的保存；\n\n## 按照python-docx\n\npython-docx is a Python library for creating and updating Microsoft Word (.docx) files.\n```\npip install python-docx\n```\n\n## 文档相关操作\n### 插入图片\n```python\n# 导入模块\nfrom docx import Document\n# 此模块中包含 docx 中各类单位方法\nfrom docx import shared\n\ndoc = Document()\ndoc.add_heading('python-docx 基础讲解（二）')\n\n# 在文档中增加图片,并对设置图片大小\n# 当只设置一个方向的长度（宽或高）时，另一方向会自动缩放\ndoc.add_picture('1.png',width=shared.Inches(1))  # 按英寸设置\ndoc.add_picture('1.png',height=shared.Cm(2))  # 按厘米设置\n#也可以按照毫米设置shared.Mm(2)\n\n# 保存文件\ndoc.save('test2.docx')\n```\n### 页面大小设置\n\n```python\nfrom docx import Document # 导入docx包\nfrom docx.shared import Cm, Inches, Pt # 导入单位换算函数\ndocument = Document() # 新建word文档\nsection = document.sections[0] # 获取section对象\nprint('默认页面的宽度和高度：', section.page_width.cm,\nsection.page_height.cm) # 打印默认页面宽度和高度\nsection.page_width = Cm(40)\nsection.page_height = Cm(40)\n\n#A3纸的格式是297*420mm\n```\n\n\n\n## 其他功能\n\n### 打开文档\n\n你需要的第一件事是工作的文档。最简单的方法是：\n\n```python\nfrom docx import Document\ndocument = Document()\n```\n\n这将打开一个基于默认“模板”的空白文档，您可以打开并使用现有的Word文档的工作`python-docx`，我们会让事情变得简单。\n\n \n\n### 增加一段\n\n段落是Word的基础。它们用于正文文本，但也用于标题和列表项目（如项目符号）。\n\n这里是添加一个最简单的方法：\n\n```python\nparagraph = document.add_paragraph('Lorem ipsum dolor sit amet.')\n```\n\n此方法返回对段落的引用，新添加的段落在文档的结尾。新的段落引用被分配给`paragraph` 在这种情况下，我将要离开了这一点在下面的例子中，除非我有一个需要它。在你的代码中，通常你不会对项目做任何事情，在添加它，所以没有什么意义，保持引用它挂在周围。\n\n还可以使用一个段落作为“光标”，并在其上直接插入一个新段落：\n\n```python\nprior_paragraph = paragraph.insert_paragraph_before('Lorem ipsum')\n```\n\n这允许将一个段落插入到文档的中间，这在修改现有文档时通常很重要，而不是从头开始生成。\n\n \n\n### 添加标题\n\n在除了最短文档之外的任何内容中，正文文本被分成多个部分，每个部分以一个标题开始。以下是如何添加一个：\n\n```python\ndocument.add_heading('The REAL meaning of the universe')\n```\n\n默认情况下，这会添加顶级标题，Word中显示为“标题1”。当您需要子节的标题时，只需指定所需的级别为1到9之间的整数：\n\n```python\ndocument.add_heading('The role of dolphins', level=2)\n```\n\n如果指定级别0，将添加“标题”段落。这可以方便地启动一个相对较短的文档，没有单独的标题页。\n\n \n\n### 添加分页符\n\n每隔一段时间，你想要下一个文本在一个单独的页面，即使你所在的一个不是满的。“hard”分页符可以做到这一点：\n\n```python\ndocument.add_page_break()\n```\n\n如果你发现自己经常使用它，这可能是一个标志，你可以通过更好地了解段落样式受益。可设置的一个段落样式属性是在包含该样式的每个段落之前立即断开页面。因此，您可以将标题设置为某个级别，以便始终启动新页面。更多风格后。它们对于真正充分利用Word至关重要。\n\n \n\n### 添加表\n\n一个经常遇到的内容，它自己的表格呈现，排列在整齐的行和列。Word在这方面做得相当不错。以下是添加表格的方法：\n\n```python\ntable = document.add_table(rows=2, cols=2)\n```\n\n表具有几个属性和方法，您将需要它们来填充它们。访问单个单元格可能是一个好的开始的地方。作为基线，您可以始终按其行和列指示访问单元格：\n\n```python\ncell = table.cell(0, 1) #根据行列指定\n```\n\n这就给出了我们刚刚创建的表格最上面一行的右边单元格。注意，行和列指示是基于零的，就像在列表访问中一样。\n\n一旦你有一个单元格，你可以把东西在它：\n\n```python\ncell.text = 'parrot, possibly dead'\n```\n\n通常，一次访问一行单元格更容易，例如，当从数据源填充可变长度的表时。在`.rows` 一个表中的属性提供给单独的行，每个都具有一个 `.cells`属性。该`.cells`两个物业`Row`和`Column` 支持索引访问，就像一个列表：\n\n```python\nrow = table.rows[1]\nrow.cells[0].text = 'Foo bar to you.'\nrow.cells[1].text = 'And a hearty foo bar to you too sir!'\n```\n\n在`.rows`和`.columns`桌子上的集合是可迭代的，这样你就可以直接在使用它们`for`循环。相同的`.cells`上行或列序列：\n\n```python\nfor row in table.rows:\n    for cell in row.cells:\n        print(cell.text)\n```\n\n如果你想在表中的行或列的计数，只要使用`len()`的顺序：\n\n```python\nrow_count = len(table.rows)\ncol_count = len(table.columns)\n```\n\n您还可以以递增方式向表中添加行，如下所示：\n\n```python\nrow = table.add_row()\n```\n\n这对于我们上面提到的可变长度表场景非常方便：\n\n```python\n# get table data -------------\nitems = get_things_from_database_or_something()\n \n# add table ------------------\ntable = document.add_table(1, 3)\n \n# populate header row --------\nheading_cells = table.rows[0].cells\nheading_cells[0].text = 'Qty'\nheading_cells[1].text = 'SKU'\nheading_cells[2].text = 'Description'\n \n# add a data row for each item\nfor item in items:\n    cells = table.add_row().cells\n    cells[0].text = str(item.qty)\n    cells[1].text = item.sku\n    cells[2].text = item.desc\n```\n\n同样的工作对列，虽然我还没有看到它的一个用例。\n\nWord具有一组预格式化的表格样式，您可以从其表格样式库中选择。您可以将其中的一个应用于表格，如下所示：\n\n```python\ntable.style = 'LightShading-Accent1'\n```\n\n通过从表样式名称中删除所有空格形成样式名称。通过将鼠标悬停在Word的表样式库中的缩略图上，可以找到表样式名称。\n\n### 添加图片\n\nWord中，您可以将图像使用的文档中的菜单项。以下是如何做到这一点的：`Insert > Photo > Picture fromfile...``python-docx`\n\n```python\ndocument.add_picture('image-filename.png')\n```\n\n此示例使用路径，从本地文件系统加载图像文件。你也可以使用一个*类文件对象*，本质上就像一个打开的文件的任何对象。如果您从数据库或网络检索图像，并且不想获取涉及的文件系统，这可能很方便。\n\n#### 图像大小\n\n默认情况下，添加图像出现在*本地*的大小。这通常比你想要的更大。本机大小的计算方法。因此，具有300dpi分辨率的300×300像素图像出现在一平方英寸。问题是大多数图像不包含dpi属性，它默认为72 dpi。这将使同一图像在一边，在一半左右的某处出现4.167英寸。`pixels / dpi`\n\n要获得所需的图像大小，您可以以方便的单位指定其宽度或高度，如英寸或厘米：\n\n```python\nfrom docx.shared import Inches\ndocument.add_picture('image-filename.png', width=Inches(1.0))\n```\n\n你可以自由地指定宽度和高度，但通常你不想要。如果仅指定一个，`python-docx`用它来计算出其他的适当换算值。这样的*高宽比*是保留的，你的图像看起来不拉伸。\n\n在`Inches`和`Cm`提供课程，让你指定派上用场单位进行测量。在内部，`python-docx`使用英语公制单位，914400为英寸。所以，如果你忘记了，只是把喜欢的东西`width=2`，你会得到一个非常小的图像:)。你需要从导入`docx.shared` 子包。你可以在算术中使用它们，就像它们是一个整数，事实上它们是。因此，像一个表达式的作品就好了。`width = Inches(3) /thing_count`\n\n### 应用段落样式\n\n如果你不知道一个Word段落风格是你应该肯定检查出来。基本上，它允许您将一整套格式化选项立即应用到段落。这很像CSS样式，如果你知道那些是。\n\n您可以在创建段落时应用段落样式：\n\n```python\ndocument.add_paragraph('Lorem ipsum dolor sit amet.', style='ListBullet')\n```\n\n这种特殊的风格导致段落显示为一个子弹，一个非常方便的东西。您也可以在之后应用样式。这两行相当于上面的一行：\n\n```python\nparagraph = document.add_paragraph('Lorem ipsum dolor sit amet.')\nparagraph.style = 'ListBullet'\n```\n\n在此示例中，样式使用其样式ID“ListBullet”指定。通常，通过去除样式名称中出现在Word用户界面（UI）中的空格来形成样式ID。所以风格'列表3号'将被指定为`'ListNumber3'`。但是，请注意，如果您使用的是本地化版本的Word，则样式ID可能来自英语样式名称，并且可能不会完全对应于其在Word UI中的样式名称。\n\n \n","source":"_posts/python/img/imageTodocx.md","raw":"---\ntitle: 将图像保存至Word中\ntags: [python,图像]\ncategories: [python,图像]\ndate: 2021-12-10 13:20:28\n---\n\n>利用python，向Word中保存信息，这里主要是记录对图像的保存；\n\n## 按照python-docx\n\npython-docx is a Python library for creating and updating Microsoft Word (.docx) files.\n```\npip install python-docx\n```\n\n## 文档相关操作\n### 插入图片\n```python\n# 导入模块\nfrom docx import Document\n# 此模块中包含 docx 中各类单位方法\nfrom docx import shared\n\ndoc = Document()\ndoc.add_heading('python-docx 基础讲解（二）')\n\n# 在文档中增加图片,并对设置图片大小\n# 当只设置一个方向的长度（宽或高）时，另一方向会自动缩放\ndoc.add_picture('1.png',width=shared.Inches(1))  # 按英寸设置\ndoc.add_picture('1.png',height=shared.Cm(2))  # 按厘米设置\n#也可以按照毫米设置shared.Mm(2)\n\n# 保存文件\ndoc.save('test2.docx')\n```\n### 页面大小设置\n\n```python\nfrom docx import Document # 导入docx包\nfrom docx.shared import Cm, Inches, Pt # 导入单位换算函数\ndocument = Document() # 新建word文档\nsection = document.sections[0] # 获取section对象\nprint('默认页面的宽度和高度：', section.page_width.cm,\nsection.page_height.cm) # 打印默认页面宽度和高度\nsection.page_width = Cm(40)\nsection.page_height = Cm(40)\n\n#A3纸的格式是297*420mm\n```\n\n\n\n## 其他功能\n\n### 打开文档\n\n你需要的第一件事是工作的文档。最简单的方法是：\n\n```python\nfrom docx import Document\ndocument = Document()\n```\n\n这将打开一个基于默认“模板”的空白文档，您可以打开并使用现有的Word文档的工作`python-docx`，我们会让事情变得简单。\n\n \n\n### 增加一段\n\n段落是Word的基础。它们用于正文文本，但也用于标题和列表项目（如项目符号）。\n\n这里是添加一个最简单的方法：\n\n```python\nparagraph = document.add_paragraph('Lorem ipsum dolor sit amet.')\n```\n\n此方法返回对段落的引用，新添加的段落在文档的结尾。新的段落引用被分配给`paragraph` 在这种情况下，我将要离开了这一点在下面的例子中，除非我有一个需要它。在你的代码中，通常你不会对项目做任何事情，在添加它，所以没有什么意义，保持引用它挂在周围。\n\n还可以使用一个段落作为“光标”，并在其上直接插入一个新段落：\n\n```python\nprior_paragraph = paragraph.insert_paragraph_before('Lorem ipsum')\n```\n\n这允许将一个段落插入到文档的中间，这在修改现有文档时通常很重要，而不是从头开始生成。\n\n \n\n### 添加标题\n\n在除了最短文档之外的任何内容中，正文文本被分成多个部分，每个部分以一个标题开始。以下是如何添加一个：\n\n```python\ndocument.add_heading('The REAL meaning of the universe')\n```\n\n默认情况下，这会添加顶级标题，Word中显示为“标题1”。当您需要子节的标题时，只需指定所需的级别为1到9之间的整数：\n\n```python\ndocument.add_heading('The role of dolphins', level=2)\n```\n\n如果指定级别0，将添加“标题”段落。这可以方便地启动一个相对较短的文档，没有单独的标题页。\n\n \n\n### 添加分页符\n\n每隔一段时间，你想要下一个文本在一个单独的页面，即使你所在的一个不是满的。“hard”分页符可以做到这一点：\n\n```python\ndocument.add_page_break()\n```\n\n如果你发现自己经常使用它，这可能是一个标志，你可以通过更好地了解段落样式受益。可设置的一个段落样式属性是在包含该样式的每个段落之前立即断开页面。因此，您可以将标题设置为某个级别，以便始终启动新页面。更多风格后。它们对于真正充分利用Word至关重要。\n\n \n\n### 添加表\n\n一个经常遇到的内容，它自己的表格呈现，排列在整齐的行和列。Word在这方面做得相当不错。以下是添加表格的方法：\n\n```python\ntable = document.add_table(rows=2, cols=2)\n```\n\n表具有几个属性和方法，您将需要它们来填充它们。访问单个单元格可能是一个好的开始的地方。作为基线，您可以始终按其行和列指示访问单元格：\n\n```python\ncell = table.cell(0, 1) #根据行列指定\n```\n\n这就给出了我们刚刚创建的表格最上面一行的右边单元格。注意，行和列指示是基于零的，就像在列表访问中一样。\n\n一旦你有一个单元格，你可以把东西在它：\n\n```python\ncell.text = 'parrot, possibly dead'\n```\n\n通常，一次访问一行单元格更容易，例如，当从数据源填充可变长度的表时。在`.rows` 一个表中的属性提供给单独的行，每个都具有一个 `.cells`属性。该`.cells`两个物业`Row`和`Column` 支持索引访问，就像一个列表：\n\n```python\nrow = table.rows[1]\nrow.cells[0].text = 'Foo bar to you.'\nrow.cells[1].text = 'And a hearty foo bar to you too sir!'\n```\n\n在`.rows`和`.columns`桌子上的集合是可迭代的，这样你就可以直接在使用它们`for`循环。相同的`.cells`上行或列序列：\n\n```python\nfor row in table.rows:\n    for cell in row.cells:\n        print(cell.text)\n```\n\n如果你想在表中的行或列的计数，只要使用`len()`的顺序：\n\n```python\nrow_count = len(table.rows)\ncol_count = len(table.columns)\n```\n\n您还可以以递增方式向表中添加行，如下所示：\n\n```python\nrow = table.add_row()\n```\n\n这对于我们上面提到的可变长度表场景非常方便：\n\n```python\n# get table data -------------\nitems = get_things_from_database_or_something()\n \n# add table ------------------\ntable = document.add_table(1, 3)\n \n# populate header row --------\nheading_cells = table.rows[0].cells\nheading_cells[0].text = 'Qty'\nheading_cells[1].text = 'SKU'\nheading_cells[2].text = 'Description'\n \n# add a data row for each item\nfor item in items:\n    cells = table.add_row().cells\n    cells[0].text = str(item.qty)\n    cells[1].text = item.sku\n    cells[2].text = item.desc\n```\n\n同样的工作对列，虽然我还没有看到它的一个用例。\n\nWord具有一组预格式化的表格样式，您可以从其表格样式库中选择。您可以将其中的一个应用于表格，如下所示：\n\n```python\ntable.style = 'LightShading-Accent1'\n```\n\n通过从表样式名称中删除所有空格形成样式名称。通过将鼠标悬停在Word的表样式库中的缩略图上，可以找到表样式名称。\n\n### 添加图片\n\nWord中，您可以将图像使用的文档中的菜单项。以下是如何做到这一点的：`Insert > Photo > Picture fromfile...``python-docx`\n\n```python\ndocument.add_picture('image-filename.png')\n```\n\n此示例使用路径，从本地文件系统加载图像文件。你也可以使用一个*类文件对象*，本质上就像一个打开的文件的任何对象。如果您从数据库或网络检索图像，并且不想获取涉及的文件系统，这可能很方便。\n\n#### 图像大小\n\n默认情况下，添加图像出现在*本地*的大小。这通常比你想要的更大。本机大小的计算方法。因此，具有300dpi分辨率的300×300像素图像出现在一平方英寸。问题是大多数图像不包含dpi属性，它默认为72 dpi。这将使同一图像在一边，在一半左右的某处出现4.167英寸。`pixels / dpi`\n\n要获得所需的图像大小，您可以以方便的单位指定其宽度或高度，如英寸或厘米：\n\n```python\nfrom docx.shared import Inches\ndocument.add_picture('image-filename.png', width=Inches(1.0))\n```\n\n你可以自由地指定宽度和高度，但通常你不想要。如果仅指定一个，`python-docx`用它来计算出其他的适当换算值。这样的*高宽比*是保留的，你的图像看起来不拉伸。\n\n在`Inches`和`Cm`提供课程，让你指定派上用场单位进行测量。在内部，`python-docx`使用英语公制单位，914400为英寸。所以，如果你忘记了，只是把喜欢的东西`width=2`，你会得到一个非常小的图像:)。你需要从导入`docx.shared` 子包。你可以在算术中使用它们，就像它们是一个整数，事实上它们是。因此，像一个表达式的作品就好了。`width = Inches(3) /thing_count`\n\n### 应用段落样式\n\n如果你不知道一个Word段落风格是你应该肯定检查出来。基本上，它允许您将一整套格式化选项立即应用到段落。这很像CSS样式，如果你知道那些是。\n\n您可以在创建段落时应用段落样式：\n\n```python\ndocument.add_paragraph('Lorem ipsum dolor sit amet.', style='ListBullet')\n```\n\n这种特殊的风格导致段落显示为一个子弹，一个非常方便的东西。您也可以在之后应用样式。这两行相当于上面的一行：\n\n```python\nparagraph = document.add_paragraph('Lorem ipsum dolor sit amet.')\nparagraph.style = 'ListBullet'\n```\n\n在此示例中，样式使用其样式ID“ListBullet”指定。通常，通过去除样式名称中出现在Word用户界面（UI）中的空格来形成样式ID。所以风格'列表3号'将被指定为`'ListNumber3'`。但是，请注意，如果您使用的是本地化版本的Word，则样式ID可能来自英语样式名称，并且可能不会完全对应于其在Word UI中的样式名称。\n\n \n","slug":"python/img/imageTodocx","published":1,"updated":"2022-01-18T08:10:17.111Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0cd007bast9ambi5f72","content":"<blockquote>\n<p>利用python，向Word中保存信息，这里主要是记录对图像的保存；</p>\n</blockquote>\n<h2 id=\"按照python-docx\">按照python-docx</h2>\n<p>python-docx is a Python library for creating and updating Microsoft Word (.docx) files.</p>\n<figure class=\"highlight cmake\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs cmake\">pip <span class=\"hljs-keyword\">install</span> python-docx<br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"文档相关操作\">文档相关操作</h2>\n<h3 id=\"插入图片\">插入图片</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># 导入模块</span><br><span class=\"hljs-keyword\">from</span> docx <span class=\"hljs-keyword\">import</span> Document<br><span class=\"hljs-comment\"># 此模块中包含 docx 中各类单位方法</span><br><span class=\"hljs-keyword\">from</span> docx <span class=\"hljs-keyword\">import</span> shared<br><br>doc = Document()<br>doc.add_heading(<span class=\"hljs-string\">'python-docx 基础讲解（二）'</span>)<br><br><span class=\"hljs-comment\"># 在文档中增加图片,并对设置图片大小</span><br><span class=\"hljs-comment\"># 当只设置一个方向的长度（宽或高）时，另一方向会自动缩放</span><br>doc.add_picture(<span class=\"hljs-string\">'1.png'</span>,width=shared.Inches(<span class=\"hljs-number\">1</span>))  <span class=\"hljs-comment\"># 按英寸设置</span><br>doc.add_picture(<span class=\"hljs-string\">'1.png'</span>,height=shared.Cm(<span class=\"hljs-number\">2</span>))  <span class=\"hljs-comment\"># 按厘米设置</span><br><span class=\"hljs-comment\">#也可以按照毫米设置shared.Mm(2)</span><br><br><span class=\"hljs-comment\"># 保存文件</span><br>doc.save(<span class=\"hljs-string\">'test2.docx'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"页面大小设置\">页面大小设置</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> docx <span class=\"hljs-keyword\">import</span> Document <span class=\"hljs-comment\"># 导入docx包</span><br><span class=\"hljs-keyword\">from</span> docx.shared <span class=\"hljs-keyword\">import</span> Cm, Inches, Pt <span class=\"hljs-comment\"># 导入单位换算函数</span><br>document = Document() <span class=\"hljs-comment\"># 新建word文档</span><br>section = document.sections[<span class=\"hljs-number\">0</span>] <span class=\"hljs-comment\"># 获取section对象</span><br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">'默认页面的宽度和高度：'</span>, section.page_width.cm,<br>section.page_height.cm) <span class=\"hljs-comment\"># 打印默认页面宽度和高度</span><br>section.page_width = Cm(<span class=\"hljs-number\">40</span>)<br>section.page_height = Cm(<span class=\"hljs-number\">40</span>)<br><br><span class=\"hljs-comment\">#A3纸的格式是297*420mm</span><br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"其他功能\">其他功能</h2>\n<h3 id=\"打开文档\">打开文档</h3>\n<p>你需要的第一件事是工作的文档。最简单的方法是：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> docx <span class=\"hljs-keyword\">import</span> Document<br>document = Document()<br></code></pre></td></tr></tbody></table></figure>\n<p>这将打开一个基于默认“模板”的空白文档，您可以打开并使用现有的Word文档的工作<code>python-docx</code>，我们会让事情变得简单。</p>\n<h3 id=\"增加一段\">增加一段</h3>\n<p>段落是Word的基础。它们用于正文文本，但也用于标题和列表项目（如项目符号）。</p>\n<p>这里是添加一个最简单的方法：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">paragraph = document.add_paragraph(<span class=\"hljs-string\">'Lorem ipsum dolor sit amet.'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<p>此方法返回对段落的引用，新添加的段落在文档的结尾。新的段落引用被分配给<code>paragraph</code> 在这种情况下，我将要离开了这一点在下面的例子中，除非我有一个需要它。在你的代码中，通常你不会对项目做任何事情，在添加它，所以没有什么意义，保持引用它挂在周围。</p>\n<p>还可以使用一个段落作为“光标”，并在其上直接插入一个新段落：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">prior_paragraph = paragraph.insert_paragraph_before(<span class=\"hljs-string\">'Lorem ipsum'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<p>这允许将一个段落插入到文档的中间，这在修改现有文档时通常很重要，而不是从头开始生成。</p>\n<h3 id=\"添加标题\">添加标题</h3>\n<p>在除了最短文档之外的任何内容中，正文文本被分成多个部分，每个部分以一个标题开始。以下是如何添加一个：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">document.add_heading(<span class=\"hljs-string\">'The REAL meaning of the universe'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<p>默认情况下，这会添加顶级标题，Word中显示为“标题1”。当您需要子节的标题时，只需指定所需的级别为1到9之间的整数：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">document.add_heading(<span class=\"hljs-string\">'The role of dolphins'</span>, level=<span class=\"hljs-number\">2</span>)<br></code></pre></td></tr></tbody></table></figure>\n<p>如果指定级别0，将添加“标题”段落。这可以方便地启动一个相对较短的文档，没有单独的标题页。</p>\n<h3 id=\"添加分页符\">添加分页符</h3>\n<p>每隔一段时间，你想要下一个文本在一个单独的页面，即使你所在的一个不是满的。“hard”分页符可以做到这一点：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">document.add_page_break()<br></code></pre></td></tr></tbody></table></figure>\n<p>如果你发现自己经常使用它，这可能是一个标志，你可以通过更好地了解段落样式受益。可设置的一个段落样式属性是在包含该样式的每个段落之前立即断开页面。因此，您可以将标题设置为某个级别，以便始终启动新页面。更多风格后。它们对于真正充分利用Word至关重要。</p>\n<h3 id=\"添加表\">添加表</h3>\n<p>一个经常遇到的内容，它自己的表格呈现，排列在整齐的行和列。Word在这方面做得相当不错。以下是添加表格的方法：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">table = document.add_table(rows=<span class=\"hljs-number\">2</span>, cols=<span class=\"hljs-number\">2</span>)<br></code></pre></td></tr></tbody></table></figure>\n<p>表具有几个属性和方法，您将需要它们来填充它们。访问单个单元格可能是一个好的开始的地方。作为基线，您可以始终按其行和列指示访问单元格：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">cell = table.cell(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">#根据行列指定</span><br></code></pre></td></tr></tbody></table></figure>\n<p>这就给出了我们刚刚创建的表格最上面一行的右边单元格。注意，行和列指示是基于零的，就像在列表访问中一样。</p>\n<p>一旦你有一个单元格，你可以把东西在它：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">cell.text = <span class=\"hljs-string\">'parrot, possibly dead'</span><br></code></pre></td></tr></tbody></table></figure>\n<p>通常，一次访问一行单元格更容易，例如，当从数据源填充可变长度的表时。在<code>.rows</code> 一个表中的属性提供给单独的行，每个都具有一个 <code>.cells</code>属性。该<code>.cells</code>两个物业<code>Row</code>和<code>Column</code> 支持索引访问，就像一个列表：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">row = table.rows[<span class=\"hljs-number\">1</span>]<br>row.cells[<span class=\"hljs-number\">0</span>].text = <span class=\"hljs-string\">'Foo bar to you.'</span><br>row.cells[<span class=\"hljs-number\">1</span>].text = <span class=\"hljs-string\">'And a hearty foo bar to you too sir!'</span><br></code></pre></td></tr></tbody></table></figure>\n<p>在<code>.rows</code>和<code>.columns</code>桌子上的集合是可迭代的，这样你就可以直接在使用它们<code>for</code>循环。相同的<code>.cells</code>上行或列序列：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">for</span> row <span class=\"hljs-keyword\">in</span> table.rows:<br>    <span class=\"hljs-keyword\">for</span> cell <span class=\"hljs-keyword\">in</span> row.cells:<br>        <span class=\"hljs-built_in\">print</span>(cell.text)<br></code></pre></td></tr></tbody></table></figure>\n<p>如果你想在表中的行或列的计数，只要使用<code>len()</code>的顺序：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">row_count = <span class=\"hljs-built_in\">len</span>(table.rows)<br>col_count = <span class=\"hljs-built_in\">len</span>(table.columns)<br></code></pre></td></tr></tbody></table></figure>\n<p>您还可以以递增方式向表中添加行，如下所示：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">row = table.add_row()<br></code></pre></td></tr></tbody></table></figure>\n<p>这对于我们上面提到的可变长度表场景非常方便：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># get table data -------------</span><br>items = get_things_from_database_or_something()<br> <br><span class=\"hljs-comment\"># add table ------------------</span><br>table = document.add_table(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">3</span>)<br> <br><span class=\"hljs-comment\"># populate header row --------</span><br>heading_cells = table.rows[<span class=\"hljs-number\">0</span>].cells<br>heading_cells[<span class=\"hljs-number\">0</span>].text = <span class=\"hljs-string\">'Qty'</span><br>heading_cells[<span class=\"hljs-number\">1</span>].text = <span class=\"hljs-string\">'SKU'</span><br>heading_cells[<span class=\"hljs-number\">2</span>].text = <span class=\"hljs-string\">'Description'</span><br> <br><span class=\"hljs-comment\"># add a data row for each item</span><br><span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> items:<br>    cells = table.add_row().cells<br>    cells[<span class=\"hljs-number\">0</span>].text = <span class=\"hljs-built_in\">str</span>(item.qty)<br>    cells[<span class=\"hljs-number\">1</span>].text = item.sku<br>    cells[<span class=\"hljs-number\">2</span>].text = item.desc<br></code></pre></td></tr></tbody></table></figure>\n<p>同样的工作对列，虽然我还没有看到它的一个用例。</p>\n<p>Word具有一组预格式化的表格样式，您可以从其表格样式库中选择。您可以将其中的一个应用于表格，如下所示：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">table.style = <span class=\"hljs-string\">'LightShading-Accent1'</span><br></code></pre></td></tr></tbody></table></figure>\n<p>通过从表样式名称中删除所有空格形成样式名称。通过将鼠标悬停在Word的表样式库中的缩略图上，可以找到表样式名称。</p>\n<h3 id=\"添加图片\">添加图片</h3>\n<p>Word中，您可以将图像使用的文档中的菜单项。以下是如何做到这一点的：<code>Insert &gt; Photo &gt; Picture fromfile...``python-docx</code></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">document.add_picture(<span class=\"hljs-string\">'image-filename.png'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<p>此示例使用路径，从本地文件系统加载图像文件。你也可以使用一个<em>类文件对象</em>，本质上就像一个打开的文件的任何对象。如果您从数据库或网络检索图像，并且不想获取涉及的文件系统，这可能很方便。</p>\n<h4 id=\"图像大小\">图像大小</h4>\n<p>默认情况下，添加图像出现在<em>本地</em>的大小。这通常比你想要的更大。本机大小的计算方法。因此，具有300dpi分辨率的300×300像素图像出现在一平方英寸。问题是大多数图像不包含dpi属性，它默认为72 dpi。这将使同一图像在一边，在一半左右的某处出现4.167英寸。<code>pixels / dpi</code></p>\n<p>要获得所需的图像大小，您可以以方便的单位指定其宽度或高度，如英寸或厘米：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> docx.shared <span class=\"hljs-keyword\">import</span> Inches<br>document.add_picture(<span class=\"hljs-string\">'image-filename.png'</span>, width=Inches(<span class=\"hljs-number\">1.0</span>))<br></code></pre></td></tr></tbody></table></figure>\n<p>你可以自由地指定宽度和高度，但通常你不想要。如果仅指定一个，<code>python-docx</code>用它来计算出其他的适当换算值。这样的<em>高宽比</em>是保留的，你的图像看起来不拉伸。</p>\n<p>在<code>Inches</code>和<code>Cm</code>提供课程，让你指定派上用场单位进行测量。在内部，<code>python-docx</code>使用英语公制单位，914400为英寸。所以，如果你忘记了，只是把喜欢的东西<code>width=2</code>，你会得到一个非常小的图像:)。你需要从导入<code>docx.shared</code> 子包。你可以在算术中使用它们，就像它们是一个整数，事实上它们是。因此，像一个表达式的作品就好了。<code>width = Inches(3) /thing_count</code></p>\n<h3 id=\"应用段落样式\">应用段落样式</h3>\n<p>如果你不知道一个Word段落风格是你应该肯定检查出来。基本上，它允许您将一整套格式化选项立即应用到段落。这很像CSS样式，如果你知道那些是。</p>\n<p>您可以在创建段落时应用段落样式：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">document.add_paragraph(<span class=\"hljs-string\">'Lorem ipsum dolor sit amet.'</span>, style=<span class=\"hljs-string\">'ListBullet'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<p>这种特殊的风格导致段落显示为一个子弹，一个非常方便的东西。您也可以在之后应用样式。这两行相当于上面的一行：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">paragraph = document.add_paragraph(<span class=\"hljs-string\">'Lorem ipsum dolor sit amet.'</span>)<br>paragraph.style = <span class=\"hljs-string\">'ListBullet'</span><br></code></pre></td></tr></tbody></table></figure>\n<p>在此示例中，样式使用其样式ID“ListBullet”指定。通常，通过去除样式名称中出现在Word用户界面（UI）中的空格来形成样式ID。所以风格’列表3号’将被指定为<code>'ListNumber3'</code>。但是，请注意，如果您使用的是本地化版本的Word，则样式ID可能来自英语样式名称，并且可能不会完全对应于其在Word UI中的样式名称。</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>利用python，向Word中保存信息，这里主要是记录对图像的保存；</p>\n</blockquote>\n<h2 id=\"按照python-docx\">按照python-docx</h2>\n<p>python-docx is a Python library for creating and updating Microsoft Word (.docx) files.</p>\n<figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs cmake\">pip <span class=\"hljs-keyword\">install</span> python-docx<br></code></pre></td></tr></table></figure>\n<h2 id=\"文档相关操作\">文档相关操作</h2>\n<h3 id=\"插入图片\">插入图片</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># 导入模块</span><br><span class=\"hljs-keyword\">from</span> docx <span class=\"hljs-keyword\">import</span> Document<br><span class=\"hljs-comment\"># 此模块中包含 docx 中各类单位方法</span><br><span class=\"hljs-keyword\">from</span> docx <span class=\"hljs-keyword\">import</span> shared<br><br>doc = Document()<br>doc.add_heading(<span class=\"hljs-string\">&#x27;python-docx 基础讲解（二）&#x27;</span>)<br><br><span class=\"hljs-comment\"># 在文档中增加图片,并对设置图片大小</span><br><span class=\"hljs-comment\"># 当只设置一个方向的长度（宽或高）时，另一方向会自动缩放</span><br>doc.add_picture(<span class=\"hljs-string\">&#x27;1.png&#x27;</span>,width=shared.Inches(<span class=\"hljs-number\">1</span>))  <span class=\"hljs-comment\"># 按英寸设置</span><br>doc.add_picture(<span class=\"hljs-string\">&#x27;1.png&#x27;</span>,height=shared.Cm(<span class=\"hljs-number\">2</span>))  <span class=\"hljs-comment\"># 按厘米设置</span><br><span class=\"hljs-comment\">#也可以按照毫米设置shared.Mm(2)</span><br><br><span class=\"hljs-comment\"># 保存文件</span><br>doc.save(<span class=\"hljs-string\">&#x27;test2.docx&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<h3 id=\"页面大小设置\">页面大小设置</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> docx <span class=\"hljs-keyword\">import</span> Document <span class=\"hljs-comment\"># 导入docx包</span><br><span class=\"hljs-keyword\">from</span> docx.shared <span class=\"hljs-keyword\">import</span> Cm, Inches, Pt <span class=\"hljs-comment\"># 导入单位换算函数</span><br>document = Document() <span class=\"hljs-comment\"># 新建word文档</span><br>section = document.sections[<span class=\"hljs-number\">0</span>] <span class=\"hljs-comment\"># 获取section对象</span><br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&#x27;默认页面的宽度和高度：&#x27;</span>, section.page_width.cm,<br>section.page_height.cm) <span class=\"hljs-comment\"># 打印默认页面宽度和高度</span><br>section.page_width = Cm(<span class=\"hljs-number\">40</span>)<br>section.page_height = Cm(<span class=\"hljs-number\">40</span>)<br><br><span class=\"hljs-comment\">#A3纸的格式是297*420mm</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"其他功能\">其他功能</h2>\n<h3 id=\"打开文档\">打开文档</h3>\n<p>你需要的第一件事是工作的文档。最简单的方法是：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> docx <span class=\"hljs-keyword\">import</span> Document<br>document = Document()<br></code></pre></td></tr></table></figure>\n<p>这将打开一个基于默认“模板”的空白文档，您可以打开并使用现有的Word文档的工作<code>python-docx</code>，我们会让事情变得简单。</p>\n<h3 id=\"增加一段\">增加一段</h3>\n<p>段落是Word的基础。它们用于正文文本，但也用于标题和列表项目（如项目符号）。</p>\n<p>这里是添加一个最简单的方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">paragraph = document.add_paragraph(<span class=\"hljs-string\">&#x27;Lorem ipsum dolor sit amet.&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<p>此方法返回对段落的引用，新添加的段落在文档的结尾。新的段落引用被分配给<code>paragraph</code> 在这种情况下，我将要离开了这一点在下面的例子中，除非我有一个需要它。在你的代码中，通常你不会对项目做任何事情，在添加它，所以没有什么意义，保持引用它挂在周围。</p>\n<p>还可以使用一个段落作为“光标”，并在其上直接插入一个新段落：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">prior_paragraph = paragraph.insert_paragraph_before(<span class=\"hljs-string\">&#x27;Lorem ipsum&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<p>这允许将一个段落插入到文档的中间，这在修改现有文档时通常很重要，而不是从头开始生成。</p>\n<h3 id=\"添加标题\">添加标题</h3>\n<p>在除了最短文档之外的任何内容中，正文文本被分成多个部分，每个部分以一个标题开始。以下是如何添加一个：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">document.add_heading(<span class=\"hljs-string\">&#x27;The REAL meaning of the universe&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<p>默认情况下，这会添加顶级标题，Word中显示为“标题1”。当您需要子节的标题时，只需指定所需的级别为1到9之间的整数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">document.add_heading(<span class=\"hljs-string\">&#x27;The role of dolphins&#x27;</span>, level=<span class=\"hljs-number\">2</span>)<br></code></pre></td></tr></table></figure>\n<p>如果指定级别0，将添加“标题”段落。这可以方便地启动一个相对较短的文档，没有单独的标题页。</p>\n<h3 id=\"添加分页符\">添加分页符</h3>\n<p>每隔一段时间，你想要下一个文本在一个单独的页面，即使你所在的一个不是满的。“hard”分页符可以做到这一点：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">document.add_page_break()<br></code></pre></td></tr></table></figure>\n<p>如果你发现自己经常使用它，这可能是一个标志，你可以通过更好地了解段落样式受益。可设置的一个段落样式属性是在包含该样式的每个段落之前立即断开页面。因此，您可以将标题设置为某个级别，以便始终启动新页面。更多风格后。它们对于真正充分利用Word至关重要。</p>\n<h3 id=\"添加表\">添加表</h3>\n<p>一个经常遇到的内容，它自己的表格呈现，排列在整齐的行和列。Word在这方面做得相当不错。以下是添加表格的方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">table = document.add_table(rows=<span class=\"hljs-number\">2</span>, cols=<span class=\"hljs-number\">2</span>)<br></code></pre></td></tr></table></figure>\n<p>表具有几个属性和方法，您将需要它们来填充它们。访问单个单元格可能是一个好的开始的地方。作为基线，您可以始终按其行和列指示访问单元格：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">cell = table.cell(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">#根据行列指定</span><br></code></pre></td></tr></table></figure>\n<p>这就给出了我们刚刚创建的表格最上面一行的右边单元格。注意，行和列指示是基于零的，就像在列表访问中一样。</p>\n<p>一旦你有一个单元格，你可以把东西在它：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">cell.text = <span class=\"hljs-string\">&#x27;parrot, possibly dead&#x27;</span><br></code></pre></td></tr></table></figure>\n<p>通常，一次访问一行单元格更容易，例如，当从数据源填充可变长度的表时。在<code>.rows</code> 一个表中的属性提供给单独的行，每个都具有一个 <code>.cells</code>属性。该<code>.cells</code>两个物业<code>Row</code>和<code>Column</code> 支持索引访问，就像一个列表：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">row = table.rows[<span class=\"hljs-number\">1</span>]<br>row.cells[<span class=\"hljs-number\">0</span>].text = <span class=\"hljs-string\">&#x27;Foo bar to you.&#x27;</span><br>row.cells[<span class=\"hljs-number\">1</span>].text = <span class=\"hljs-string\">&#x27;And a hearty foo bar to you too sir!&#x27;</span><br></code></pre></td></tr></table></figure>\n<p>在<code>.rows</code>和<code>.columns</code>桌子上的集合是可迭代的，这样你就可以直接在使用它们<code>for</code>循环。相同的<code>.cells</code>上行或列序列：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">for</span> row <span class=\"hljs-keyword\">in</span> table.rows:<br>    <span class=\"hljs-keyword\">for</span> cell <span class=\"hljs-keyword\">in</span> row.cells:<br>        <span class=\"hljs-built_in\">print</span>(cell.text)<br></code></pre></td></tr></table></figure>\n<p>如果你想在表中的行或列的计数，只要使用<code>len()</code>的顺序：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">row_count = <span class=\"hljs-built_in\">len</span>(table.rows)<br>col_count = <span class=\"hljs-built_in\">len</span>(table.columns)<br></code></pre></td></tr></table></figure>\n<p>您还可以以递增方式向表中添加行，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">row = table.add_row()<br></code></pre></td></tr></table></figure>\n<p>这对于我们上面提到的可变长度表场景非常方便：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># get table data -------------</span><br>items = get_things_from_database_or_something()<br> <br><span class=\"hljs-comment\"># add table ------------------</span><br>table = document.add_table(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">3</span>)<br> <br><span class=\"hljs-comment\"># populate header row --------</span><br>heading_cells = table.rows[<span class=\"hljs-number\">0</span>].cells<br>heading_cells[<span class=\"hljs-number\">0</span>].text = <span class=\"hljs-string\">&#x27;Qty&#x27;</span><br>heading_cells[<span class=\"hljs-number\">1</span>].text = <span class=\"hljs-string\">&#x27;SKU&#x27;</span><br>heading_cells[<span class=\"hljs-number\">2</span>].text = <span class=\"hljs-string\">&#x27;Description&#x27;</span><br> <br><span class=\"hljs-comment\"># add a data row for each item</span><br><span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> items:<br>    cells = table.add_row().cells<br>    cells[<span class=\"hljs-number\">0</span>].text = <span class=\"hljs-built_in\">str</span>(item.qty)<br>    cells[<span class=\"hljs-number\">1</span>].text = item.sku<br>    cells[<span class=\"hljs-number\">2</span>].text = item.desc<br></code></pre></td></tr></table></figure>\n<p>同样的工作对列，虽然我还没有看到它的一个用例。</p>\n<p>Word具有一组预格式化的表格样式，您可以从其表格样式库中选择。您可以将其中的一个应用于表格，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">table.style = <span class=\"hljs-string\">&#x27;LightShading-Accent1&#x27;</span><br></code></pre></td></tr></table></figure>\n<p>通过从表样式名称中删除所有空格形成样式名称。通过将鼠标悬停在Word的表样式库中的缩略图上，可以找到表样式名称。</p>\n<h3 id=\"添加图片\">添加图片</h3>\n<p>Word中，您可以将图像使用的文档中的菜单项。以下是如何做到这一点的：<code>Insert &gt; Photo &gt; Picture fromfile...``python-docx</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">document.add_picture(<span class=\"hljs-string\">&#x27;image-filename.png&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<p>此示例使用路径，从本地文件系统加载图像文件。你也可以使用一个<em>类文件对象</em>，本质上就像一个打开的文件的任何对象。如果您从数据库或网络检索图像，并且不想获取涉及的文件系统，这可能很方便。</p>\n<h4 id=\"图像大小\">图像大小</h4>\n<p>默认情况下，添加图像出现在<em>本地</em>的大小。这通常比你想要的更大。本机大小的计算方法。因此，具有300dpi分辨率的300×300像素图像出现在一平方英寸。问题是大多数图像不包含dpi属性，它默认为72 dpi。这将使同一图像在一边，在一半左右的某处出现4.167英寸。<code>pixels / dpi</code></p>\n<p>要获得所需的图像大小，您可以以方便的单位指定其宽度或高度，如英寸或厘米：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> docx.shared <span class=\"hljs-keyword\">import</span> Inches<br>document.add_picture(<span class=\"hljs-string\">&#x27;image-filename.png&#x27;</span>, width=Inches(<span class=\"hljs-number\">1.0</span>))<br></code></pre></td></tr></table></figure>\n<p>你可以自由地指定宽度和高度，但通常你不想要。如果仅指定一个，<code>python-docx</code>用它来计算出其他的适当换算值。这样的<em>高宽比</em>是保留的，你的图像看起来不拉伸。</p>\n<p>在<code>Inches</code>和<code>Cm</code>提供课程，让你指定派上用场单位进行测量。在内部，<code>python-docx</code>使用英语公制单位，914400为英寸。所以，如果你忘记了，只是把喜欢的东西<code>width=2</code>，你会得到一个非常小的图像:)。你需要从导入<code>docx.shared</code> 子包。你可以在算术中使用它们，就像它们是一个整数，事实上它们是。因此，像一个表达式的作品就好了。<code>width = Inches(3) /thing_count</code></p>\n<h3 id=\"应用段落样式\">应用段落样式</h3>\n<p>如果你不知道一个Word段落风格是你应该肯定检查出来。基本上，它允许您将一整套格式化选项立即应用到段落。这很像CSS样式，如果你知道那些是。</p>\n<p>您可以在创建段落时应用段落样式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">document.add_paragraph(<span class=\"hljs-string\">&#x27;Lorem ipsum dolor sit amet.&#x27;</span>, style=<span class=\"hljs-string\">&#x27;ListBullet&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<p>这种特殊的风格导致段落显示为一个子弹，一个非常方便的东西。您也可以在之后应用样式。这两行相当于上面的一行：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">paragraph = document.add_paragraph(<span class=\"hljs-string\">&#x27;Lorem ipsum dolor sit amet.&#x27;</span>)<br>paragraph.style = <span class=\"hljs-string\">&#x27;ListBullet&#x27;</span><br></code></pre></td></tr></table></figure>\n<p>在此示例中，样式使用其样式ID“ListBullet”指定。通常，通过去除样式名称中出现在Word用户界面（UI）中的空格来形成样式ID。所以风格’列表3号’将被指定为<code>'ListNumber3'</code>。但是，请注意，如果您使用的是本地化版本的Word，则样式ID可能来自英语样式名称，并且可能不会完全对应于其在Word UI中的样式名称。</p>\n"},{"title":"pyqt截取窗口","date":"2021-12-16T02:49:22.000Z","_content":"\n> 在painter画笔进行绘制之后，需要保存画布图像。一种方法是使用Qpainter p(pixmap)，在指定的map上绘制后保存，可是此方法我保存图片时还是只有原始图片。绘制的图形无法保存；另一种方法时截取窗口保存图片。\n\n## 介绍QScreen的方法\n\n代码如下：\n```python\npqscreen  = QGuiApplication.primaryScreen()\npixmap2 = pqscreen.grabWindow(self.winId(), self.x0, self.y0, abs(self.x1-self.x0), abs(self.y1-self.y0)) #本控件的id\npixmap2.save('555.png')\n```\n截屏的原理主要还是运用QScreen类中的grabWindow方法。\n\n## grabWindow\n\n`QScreen.grabWindow(WId window, int x = 0, int y = 0, int width = -1, int height = -1)`\n大致意思是创建并返回通过抓取由QRect（x，y，width，height）限制的给定窗口构造的像素图。\n\n### 参数 \n\n参数（x，y）指定窗口中的偏移量，而（宽度，高度）指定要复制的区域。如果宽度为负数，则该函数将所有内容复制到窗口的右边界。如果高度为负数，则该函数将所有内容复制到窗口的底部。\n\n\n### Wid\n\n窗口系统标识符（WId）可以使用QWidget.winId（）函数进行检索。grabWindow（）函数从屏幕抓取像素，而不是从窗口抓取像素，即，如果有另一个窗口部分或全部覆盖抓取的像素，则也会从上面的窗口获取像素。鼠标光标一般不会被抓取。\n\n如果是屏幕截图：id为`QtWidgets.QApplication.desktop().winId()`\n\n## 源代码实现\n```python\n#!/usr/bin/env python\nfrom PyQt5 import QtCore, QtWidgets,QtGui\n\n\nclass Screenshot(QtWidgets.QWidget):\n    def __init__(self):\n        super(Screenshot, self).__init__()\n        self.screenshotLabel = QtWidgets.QLabel()\n        self.screenshotLabel.setSizePolicy(QtWidgets.QSizePolicy.Expanding,\n                QtWidgets.QSizePolicy.Expanding)\n        self.screenshotLabel.setAlignment(QtCore.Qt.AlignCenter)\n        self.screenshotLabel.setMinimumSize(240, 160)\n        self.createOptionsGroupBox()\n        self.createButtonsLayout()\n        mainLayout = QtWidgets.QVBoxLayout()\n        mainLayout.addWidget(self.screenshotLabel)\n        mainLayout.addWidget(self.optionsGroupBox)\n        mainLayout.addLayout(self.buttonsLayout)\n        self.setLayout(mainLayout)\n        self.shootScreen()\n        self.delaySpinBox.setValue(0)#延迟多少秒后截屏\n        self.setWindowTitle(\"Screenshot\")\n        self.resize(300, 200)\n        \n    def resizeEvent(self, event):\n        scaledSize = self.originalPixmap.size()\n        scaledSize.scale(self.screenshotLabel.size(), QtCore.Qt.KeepAspectRatio)\n        if not self.screenshotLabel.pixmap() or scaledSize != self.screenshotLabel.pixmap().size():\n            self.updateScreenshotLabel()\n            \n    def newScreenshot(self):\n        if self.hideThisWindowCheckBox.isChecked():\n            self.hide()\n        self.newScreenshotButton.setDisabled(True)\n        QtCore.QTimer.singleShot(self.delaySpinBox.value() * 1000,\n                self.shootScreen)\n                \n    def saveScreenshot(self):\n        format = 'png'\n        initialPath = QtCore.QDir.currentPath() + \"/untitled.\" + format\n        fileName,filetype = QtWidgets.QFileDialog.getSaveFileName(self, \"Save As\",\n                initialPath,\n                \"%s Files (*.%s);;All Files (*)\" % (format.upper(), format))\n        if fileName:\n            self.originalPixmap.save(fileName, format)\n            print(\"file saved as  %s\" % fileName)\n           \n    def shootScreen(self):\n        if self.delaySpinBox.value() != 0:\n            QtWidgets.qApp.beep()\n        # Garbage collect any existing image first.\n        self.originalPixmap = None\n        #self.originalPixmap = QtGui.QPixmap.grabWindow(QtWidgets.QApplication.desktop().winId())#PyQt4\n       \n        screen= QtWidgets.QApplication.primaryScreen()#PyQt5\n        self.originalPixmap = screen.grabWindow(QtWidgets.QApplication.desktop().winId())#PyQt5\n       \n        self.updateScreenshotLabel()\n        self.newScreenshotButton.setDisabled(False)\n        if self.hideThisWindowCheckBox.isChecked():\n            self.show()\n            \n    def updateCheckBox(self):\n        if self.delaySpinBox.value() == 0:\n            self.hideThisWindowCheckBox.setDisabled(True)\n        else:\n            self.hideThisWindowCheckBox.setDisabled(False)\n            \n    def createOptionsGroupBox(self):\n        self.optionsGroupBox = QtWidgets.QGroupBox(\"Options\")\n        self.delaySpinBox = QtWidgets.QSpinBox()\n        self.delaySpinBox.setSuffix(\" s\")\n        self.delaySpinBox.setMaximum(60)\n        self.delaySpinBox.valueChanged.connect(self.updateCheckBox)\n        self.delaySpinBoxLabel = QtWidgets.QLabel(\"Screenshot Delay:\")\n        self.hideThisWindowCheckBox = QtWidgets.QCheckBox(\"Hide This Window\")\n        optionsGroupBoxLayout = QtWidgets.QGridLayout()\n        optionsGroupBoxLayout.addWidget(self.delaySpinBoxLabel, 0, 0)\n        optionsGroupBoxLayout.addWidget(self.delaySpinBox, 0, 1)\n        optionsGroupBoxLayout.addWidget(self.hideThisWindowCheckBox, 1, 0, 1, 2)\n        self.optionsGroupBox.setLayout(optionsGroupBoxLayout)\n        \n    def createButtonsLayout(self):\n        self.newScreenshotButton = self.createButton(\"New Screenshot\",\n                self.newScreenshot)\n        self.saveScreenshotButton = self.createButton(\"Save Screenshot\",\n                self.saveScreenshot)\n        self.quitScreenshotButton = self.createButton(\"Quit\", self.close)\n        self.buttonsLayout = QtWidgets.QHBoxLayout()\n        self.buttonsLayout.addStretch()\n        self.buttonsLayout.addWidget(self.newScreenshotButton)\n        self.buttonsLayout.addWidget(self.saveScreenshotButton)\n        self.buttonsLayout.addWidget(self.quitScreenshotButton)\n    def createButton(self, text, member):\n        button = QtWidgets.QPushButton(text)\n        button.clicked.connect(member)\n        return button\n    def updateScreenshotLabel(self):\n        self.screenshotLabel.setPixmap(self.originalPixmap.scaled(\n                self.screenshotLabel.size(), QtCore.Qt.KeepAspectRatio,\n                QtCore.Qt.SmoothTransformation))\n\n\nif __name__ == '__main__':\n    import sys\n    app = QtWidgets.QApplication(sys.argv)\n    screenshot = Screenshot()\n    screenshot.show()\n    sys.exit(app.exec_())\n```","source":"_posts/python/pyqt/pyqt-grabwindow.md","raw":"---\ntitle: pyqt截取窗口\ntags: [python,pyqt]\ncategories: [python,pyqt]\ndate: 2021-12-16 10:49:22\n---\n\n> 在painter画笔进行绘制之后，需要保存画布图像。一种方法是使用Qpainter p(pixmap)，在指定的map上绘制后保存，可是此方法我保存图片时还是只有原始图片。绘制的图形无法保存；另一种方法时截取窗口保存图片。\n\n## 介绍QScreen的方法\n\n代码如下：\n```python\npqscreen  = QGuiApplication.primaryScreen()\npixmap2 = pqscreen.grabWindow(self.winId(), self.x0, self.y0, abs(self.x1-self.x0), abs(self.y1-self.y0)) #本控件的id\npixmap2.save('555.png')\n```\n截屏的原理主要还是运用QScreen类中的grabWindow方法。\n\n## grabWindow\n\n`QScreen.grabWindow(WId window, int x = 0, int y = 0, int width = -1, int height = -1)`\n大致意思是创建并返回通过抓取由QRect（x，y，width，height）限制的给定窗口构造的像素图。\n\n### 参数 \n\n参数（x，y）指定窗口中的偏移量，而（宽度，高度）指定要复制的区域。如果宽度为负数，则该函数将所有内容复制到窗口的右边界。如果高度为负数，则该函数将所有内容复制到窗口的底部。\n\n\n### Wid\n\n窗口系统标识符（WId）可以使用QWidget.winId（）函数进行检索。grabWindow（）函数从屏幕抓取像素，而不是从窗口抓取像素，即，如果有另一个窗口部分或全部覆盖抓取的像素，则也会从上面的窗口获取像素。鼠标光标一般不会被抓取。\n\n如果是屏幕截图：id为`QtWidgets.QApplication.desktop().winId()`\n\n## 源代码实现\n```python\n#!/usr/bin/env python\nfrom PyQt5 import QtCore, QtWidgets,QtGui\n\n\nclass Screenshot(QtWidgets.QWidget):\n    def __init__(self):\n        super(Screenshot, self).__init__()\n        self.screenshotLabel = QtWidgets.QLabel()\n        self.screenshotLabel.setSizePolicy(QtWidgets.QSizePolicy.Expanding,\n                QtWidgets.QSizePolicy.Expanding)\n        self.screenshotLabel.setAlignment(QtCore.Qt.AlignCenter)\n        self.screenshotLabel.setMinimumSize(240, 160)\n        self.createOptionsGroupBox()\n        self.createButtonsLayout()\n        mainLayout = QtWidgets.QVBoxLayout()\n        mainLayout.addWidget(self.screenshotLabel)\n        mainLayout.addWidget(self.optionsGroupBox)\n        mainLayout.addLayout(self.buttonsLayout)\n        self.setLayout(mainLayout)\n        self.shootScreen()\n        self.delaySpinBox.setValue(0)#延迟多少秒后截屏\n        self.setWindowTitle(\"Screenshot\")\n        self.resize(300, 200)\n        \n    def resizeEvent(self, event):\n        scaledSize = self.originalPixmap.size()\n        scaledSize.scale(self.screenshotLabel.size(), QtCore.Qt.KeepAspectRatio)\n        if not self.screenshotLabel.pixmap() or scaledSize != self.screenshotLabel.pixmap().size():\n            self.updateScreenshotLabel()\n            \n    def newScreenshot(self):\n        if self.hideThisWindowCheckBox.isChecked():\n            self.hide()\n        self.newScreenshotButton.setDisabled(True)\n        QtCore.QTimer.singleShot(self.delaySpinBox.value() * 1000,\n                self.shootScreen)\n                \n    def saveScreenshot(self):\n        format = 'png'\n        initialPath = QtCore.QDir.currentPath() + \"/untitled.\" + format\n        fileName,filetype = QtWidgets.QFileDialog.getSaveFileName(self, \"Save As\",\n                initialPath,\n                \"%s Files (*.%s);;All Files (*)\" % (format.upper(), format))\n        if fileName:\n            self.originalPixmap.save(fileName, format)\n            print(\"file saved as  %s\" % fileName)\n           \n    def shootScreen(self):\n        if self.delaySpinBox.value() != 0:\n            QtWidgets.qApp.beep()\n        # Garbage collect any existing image first.\n        self.originalPixmap = None\n        #self.originalPixmap = QtGui.QPixmap.grabWindow(QtWidgets.QApplication.desktop().winId())#PyQt4\n       \n        screen= QtWidgets.QApplication.primaryScreen()#PyQt5\n        self.originalPixmap = screen.grabWindow(QtWidgets.QApplication.desktop().winId())#PyQt5\n       \n        self.updateScreenshotLabel()\n        self.newScreenshotButton.setDisabled(False)\n        if self.hideThisWindowCheckBox.isChecked():\n            self.show()\n            \n    def updateCheckBox(self):\n        if self.delaySpinBox.value() == 0:\n            self.hideThisWindowCheckBox.setDisabled(True)\n        else:\n            self.hideThisWindowCheckBox.setDisabled(False)\n            \n    def createOptionsGroupBox(self):\n        self.optionsGroupBox = QtWidgets.QGroupBox(\"Options\")\n        self.delaySpinBox = QtWidgets.QSpinBox()\n        self.delaySpinBox.setSuffix(\" s\")\n        self.delaySpinBox.setMaximum(60)\n        self.delaySpinBox.valueChanged.connect(self.updateCheckBox)\n        self.delaySpinBoxLabel = QtWidgets.QLabel(\"Screenshot Delay:\")\n        self.hideThisWindowCheckBox = QtWidgets.QCheckBox(\"Hide This Window\")\n        optionsGroupBoxLayout = QtWidgets.QGridLayout()\n        optionsGroupBoxLayout.addWidget(self.delaySpinBoxLabel, 0, 0)\n        optionsGroupBoxLayout.addWidget(self.delaySpinBox, 0, 1)\n        optionsGroupBoxLayout.addWidget(self.hideThisWindowCheckBox, 1, 0, 1, 2)\n        self.optionsGroupBox.setLayout(optionsGroupBoxLayout)\n        \n    def createButtonsLayout(self):\n        self.newScreenshotButton = self.createButton(\"New Screenshot\",\n                self.newScreenshot)\n        self.saveScreenshotButton = self.createButton(\"Save Screenshot\",\n                self.saveScreenshot)\n        self.quitScreenshotButton = self.createButton(\"Quit\", self.close)\n        self.buttonsLayout = QtWidgets.QHBoxLayout()\n        self.buttonsLayout.addStretch()\n        self.buttonsLayout.addWidget(self.newScreenshotButton)\n        self.buttonsLayout.addWidget(self.saveScreenshotButton)\n        self.buttonsLayout.addWidget(self.quitScreenshotButton)\n    def createButton(self, text, member):\n        button = QtWidgets.QPushButton(text)\n        button.clicked.connect(member)\n        return button\n    def updateScreenshotLabel(self):\n        self.screenshotLabel.setPixmap(self.originalPixmap.scaled(\n                self.screenshotLabel.size(), QtCore.Qt.KeepAspectRatio,\n                QtCore.Qt.SmoothTransformation))\n\n\nif __name__ == '__main__':\n    import sys\n    app = QtWidgets.QApplication(sys.argv)\n    screenshot = Screenshot()\n    screenshot.show()\n    sys.exit(app.exec_())\n```","slug":"python/pyqt/pyqt-grabwindow","published":1,"updated":"2022-01-18T08:10:17.112Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ce007cast9054u1ppo","content":"<blockquote>\n<p>在painter画笔进行绘制之后，需要保存画布图像。一种方法是使用Qpainter p(pixmap)，在指定的map上绘制后保存，可是此方法我保存图片时还是只有原始图片。绘制的图形无法保存；另一种方法时截取窗口保存图片。</p>\n</blockquote>\n<h2 id=\"介绍QScreen的方法\">介绍QScreen的方法</h2>\n<p>代码如下：</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pqscreen  = QGuiApplication.primaryScreen()<br>pixmap2 = pqscreen.grabWindow(self.winId(), self.x0, self.y0, <span class=\"hljs-built_in\">abs</span>(self.x1-self.x0), <span class=\"hljs-built_in\">abs</span>(self.y1-self.y0)) <span class=\"hljs-comment\">#本控件的id</span><br>pixmap2.save(<span class=\"hljs-string\">'555.png'</span>)<br></code></pre></td></tr></tbody></table></figure>\n<p>截屏的原理主要还是运用QScreen类中的grabWindow方法。</p>\n<h2 id=\"grabWindow\">grabWindow</h2>\n<p><code>QScreen.grabWindow(WId window, int x = 0, int y = 0, int width = -1, int height = -1)</code><br>\n大致意思是创建并返回通过抓取由QRect（x，y，width，height）限制的给定窗口构造的像素图。</p>\n<h3 id=\"参数\">参数</h3>\n<p>参数（x，y）指定窗口中的偏移量，而（宽度，高度）指定要复制的区域。如果宽度为负数，则该函数将所有内容复制到窗口的右边界。如果高度为负数，则该函数将所有内容复制到窗口的底部。</p>\n<h3 id=\"Wid\">Wid</h3>\n<p>窗口系统标识符（WId）可以使用QWidget.winId（）函数进行检索。grabWindow（）函数从屏幕抓取像素，而不是从窗口抓取像素，即，如果有另一个窗口部分或全部覆盖抓取的像素，则也会从上面的窗口获取像素。鼠标光标一般不会被抓取。</p>\n<p>如果是屏幕截图：id为<code>QtWidgets.QApplication.desktop().winId()</code></p>\n<h2 id=\"源代码实现\">源代码实现</h2>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#!/usr/bin/env python</span><br><span class=\"hljs-keyword\">from</span> PyQt5 <span class=\"hljs-keyword\">import</span> QtCore, QtWidgets,QtGui<br><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Screenshot</span>(<span class=\"hljs-params\">QtWidgets.QWidget</span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-built_in\">super</span>(Screenshot, self).__init__()<br>        self.screenshotLabel = QtWidgets.QLabel()<br>        self.screenshotLabel.setSizePolicy(QtWidgets.QSizePolicy.Expanding,<br>                QtWidgets.QSizePolicy.Expanding)<br>        self.screenshotLabel.setAlignment(QtCore.Qt.AlignCenter)<br>        self.screenshotLabel.setMinimumSize(<span class=\"hljs-number\">240</span>, <span class=\"hljs-number\">160</span>)<br>        self.createOptionsGroupBox()<br>        self.createButtonsLayout()<br>        mainLayout = QtWidgets.QVBoxLayout()<br>        mainLayout.addWidget(self.screenshotLabel)<br>        mainLayout.addWidget(self.optionsGroupBox)<br>        mainLayout.addLayout(self.buttonsLayout)<br>        self.setLayout(mainLayout)<br>        self.shootScreen()<br>        self.delaySpinBox.setValue(<span class=\"hljs-number\">0</span>)<span class=\"hljs-comment\">#延迟多少秒后截屏</span><br>        self.setWindowTitle(<span class=\"hljs-string\">\"Screenshot\"</span>)<br>        self.resize(<span class=\"hljs-number\">300</span>, <span class=\"hljs-number\">200</span>)<br>        <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">resizeEvent</span>(<span class=\"hljs-params\">self, event</span>):</span><br>        scaledSize = self.originalPixmap.size()<br>        scaledSize.scale(self.screenshotLabel.size(), QtCore.Qt.KeepAspectRatio)<br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> self.screenshotLabel.pixmap() <span class=\"hljs-keyword\">or</span> scaledSize != self.screenshotLabel.pixmap().size():<br>            self.updateScreenshotLabel()<br>            <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">newScreenshot</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-keyword\">if</span> self.hideThisWindowCheckBox.isChecked():<br>            self.hide()<br>        self.newScreenshotButton.setDisabled(<span class=\"hljs-literal\">True</span>)<br>        QtCore.QTimer.singleShot(self.delaySpinBox.value() * <span class=\"hljs-number\">1000</span>,<br>                self.shootScreen)<br>                <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">saveScreenshot</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-built_in\">format</span> = <span class=\"hljs-string\">'png'</span><br>        initialPath = QtCore.QDir.currentPath() + <span class=\"hljs-string\">\"/untitled.\"</span> + <span class=\"hljs-built_in\">format</span><br>        fileName,filetype = QtWidgets.QFileDialog.getSaveFileName(self, <span class=\"hljs-string\">\"Save As\"</span>,<br>                initialPath,<br>                <span class=\"hljs-string\">\"%s Files (*.%s);;All Files (*)\"</span> % (<span class=\"hljs-built_in\">format</span>.upper(), <span class=\"hljs-built_in\">format</span>))<br>        <span class=\"hljs-keyword\">if</span> fileName:<br>            self.originalPixmap.save(fileName, <span class=\"hljs-built_in\">format</span>)<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"file saved as  %s\"</span> % fileName)<br>           <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">shootScreen</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-keyword\">if</span> self.delaySpinBox.value() != <span class=\"hljs-number\">0</span>:<br>            QtWidgets.qApp.beep()<br>        <span class=\"hljs-comment\"># Garbage collect any existing image first.</span><br>        self.originalPixmap = <span class=\"hljs-literal\">None</span><br>        <span class=\"hljs-comment\">#self.originalPixmap = QtGui.QPixmap.grabWindow(QtWidgets.QApplication.desktop().winId())#PyQt4</span><br>       <br>        screen= QtWidgets.QApplication.primaryScreen()<span class=\"hljs-comment\">#PyQt5</span><br>        self.originalPixmap = screen.grabWindow(QtWidgets.QApplication.desktop().winId())<span class=\"hljs-comment\">#PyQt5</span><br>       <br>        self.updateScreenshotLabel()<br>        self.newScreenshotButton.setDisabled(<span class=\"hljs-literal\">False</span>)<br>        <span class=\"hljs-keyword\">if</span> self.hideThisWindowCheckBox.isChecked():<br>            self.show()<br>            <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">updateCheckBox</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-keyword\">if</span> self.delaySpinBox.value() == <span class=\"hljs-number\">0</span>:<br>            self.hideThisWindowCheckBox.setDisabled(<span class=\"hljs-literal\">True</span>)<br>        <span class=\"hljs-keyword\">else</span>:<br>            self.hideThisWindowCheckBox.setDisabled(<span class=\"hljs-literal\">False</span>)<br>            <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">createOptionsGroupBox</span>(<span class=\"hljs-params\">self</span>):</span><br>        self.optionsGroupBox = QtWidgets.QGroupBox(<span class=\"hljs-string\">\"Options\"</span>)<br>        self.delaySpinBox = QtWidgets.QSpinBox()<br>        self.delaySpinBox.setSuffix(<span class=\"hljs-string\">\" s\"</span>)<br>        self.delaySpinBox.setMaximum(<span class=\"hljs-number\">60</span>)<br>        self.delaySpinBox.valueChanged.connect(self.updateCheckBox)<br>        self.delaySpinBoxLabel = QtWidgets.QLabel(<span class=\"hljs-string\">\"Screenshot Delay:\"</span>)<br>        self.hideThisWindowCheckBox = QtWidgets.QCheckBox(<span class=\"hljs-string\">\"Hide This Window\"</span>)<br>        optionsGroupBoxLayout = QtWidgets.QGridLayout()<br>        optionsGroupBoxLayout.addWidget(self.delaySpinBoxLabel, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>)<br>        optionsGroupBoxLayout.addWidget(self.delaySpinBox, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>)<br>        optionsGroupBoxLayout.addWidget(self.hideThisWindowCheckBox, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>)<br>        self.optionsGroupBox.setLayout(optionsGroupBoxLayout)<br>        <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">createButtonsLayout</span>(<span class=\"hljs-params\">self</span>):</span><br>        self.newScreenshotButton = self.createButton(<span class=\"hljs-string\">\"New Screenshot\"</span>,<br>                self.newScreenshot)<br>        self.saveScreenshotButton = self.createButton(<span class=\"hljs-string\">\"Save Screenshot\"</span>,<br>                self.saveScreenshot)<br>        self.quitScreenshotButton = self.createButton(<span class=\"hljs-string\">\"Quit\"</span>, self.close)<br>        self.buttonsLayout = QtWidgets.QHBoxLayout()<br>        self.buttonsLayout.addStretch()<br>        self.buttonsLayout.addWidget(self.newScreenshotButton)<br>        self.buttonsLayout.addWidget(self.saveScreenshotButton)<br>        self.buttonsLayout.addWidget(self.quitScreenshotButton)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">createButton</span>(<span class=\"hljs-params\">self, text, member</span>):</span><br>        button = QtWidgets.QPushButton(text)<br>        button.clicked.connect(member)<br>        <span class=\"hljs-keyword\">return</span> button<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">updateScreenshotLabel</span>(<span class=\"hljs-params\">self</span>):</span><br>        self.screenshotLabel.setPixmap(self.originalPixmap.scaled(<br>                self.screenshotLabel.size(), QtCore.Qt.KeepAspectRatio,<br>                QtCore.Qt.SmoothTransformation))<br><br><br><span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">'__main__'</span>:<br>    <span class=\"hljs-keyword\">import</span> sys<br>    app = QtWidgets.QApplication(sys.argv)<br>    screenshot = Screenshot()<br>    screenshot.show()<br>    sys.exit(app.exec_())<br></code></pre></td></tr></tbody></table></figure>","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>在painter画笔进行绘制之后，需要保存画布图像。一种方法是使用Qpainter p(pixmap)，在指定的map上绘制后保存，可是此方法我保存图片时还是只有原始图片。绘制的图形无法保存；另一种方法时截取窗口保存图片。</p>\n</blockquote>\n<h2 id=\"介绍QScreen的方法\">介绍QScreen的方法</h2>\n<p>代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">pqscreen  = QGuiApplication.primaryScreen()<br>pixmap2 = pqscreen.grabWindow(self.winId(), self.x0, self.y0, <span class=\"hljs-built_in\">abs</span>(self.x1-self.x0), <span class=\"hljs-built_in\">abs</span>(self.y1-self.y0)) <span class=\"hljs-comment\">#本控件的id</span><br>pixmap2.save(<span class=\"hljs-string\">&#x27;555.png&#x27;</span>)<br></code></pre></td></tr></table></figure>\n<p>截屏的原理主要还是运用QScreen类中的grabWindow方法。</p>\n<h2 id=\"grabWindow\">grabWindow</h2>\n<p><code>QScreen.grabWindow(WId window, int x = 0, int y = 0, int width = -1, int height = -1)</code><br>\n大致意思是创建并返回通过抓取由QRect（x，y，width，height）限制的给定窗口构造的像素图。</p>\n<h3 id=\"参数\">参数</h3>\n<p>参数（x，y）指定窗口中的偏移量，而（宽度，高度）指定要复制的区域。如果宽度为负数，则该函数将所有内容复制到窗口的右边界。如果高度为负数，则该函数将所有内容复制到窗口的底部。</p>\n<h3 id=\"Wid\">Wid</h3>\n<p>窗口系统标识符（WId）可以使用QWidget.winId（）函数进行检索。grabWindow（）函数从屏幕抓取像素，而不是从窗口抓取像素，即，如果有另一个窗口部分或全部覆盖抓取的像素，则也会从上面的窗口获取像素。鼠标光标一般不会被抓取。</p>\n<p>如果是屏幕截图：id为<code>QtWidgets.QApplication.desktop().winId()</code></p>\n<h2 id=\"源代码实现\">源代码实现</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#!/usr/bin/env python</span><br><span class=\"hljs-keyword\">from</span> PyQt5 <span class=\"hljs-keyword\">import</span> QtCore, QtWidgets,QtGui<br><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Screenshot</span>(<span class=\"hljs-params\">QtWidgets.QWidget</span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-built_in\">super</span>(Screenshot, self).__init__()<br>        self.screenshotLabel = QtWidgets.QLabel()<br>        self.screenshotLabel.setSizePolicy(QtWidgets.QSizePolicy.Expanding,<br>                QtWidgets.QSizePolicy.Expanding)<br>        self.screenshotLabel.setAlignment(QtCore.Qt.AlignCenter)<br>        self.screenshotLabel.setMinimumSize(<span class=\"hljs-number\">240</span>, <span class=\"hljs-number\">160</span>)<br>        self.createOptionsGroupBox()<br>        self.createButtonsLayout()<br>        mainLayout = QtWidgets.QVBoxLayout()<br>        mainLayout.addWidget(self.screenshotLabel)<br>        mainLayout.addWidget(self.optionsGroupBox)<br>        mainLayout.addLayout(self.buttonsLayout)<br>        self.setLayout(mainLayout)<br>        self.shootScreen()<br>        self.delaySpinBox.setValue(<span class=\"hljs-number\">0</span>)<span class=\"hljs-comment\">#延迟多少秒后截屏</span><br>        self.setWindowTitle(<span class=\"hljs-string\">&quot;Screenshot&quot;</span>)<br>        self.resize(<span class=\"hljs-number\">300</span>, <span class=\"hljs-number\">200</span>)<br>        <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">resizeEvent</span>(<span class=\"hljs-params\">self, event</span>):</span><br>        scaledSize = self.originalPixmap.size()<br>        scaledSize.scale(self.screenshotLabel.size(), QtCore.Qt.KeepAspectRatio)<br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> self.screenshotLabel.pixmap() <span class=\"hljs-keyword\">or</span> scaledSize != self.screenshotLabel.pixmap().size():<br>            self.updateScreenshotLabel()<br>            <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">newScreenshot</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-keyword\">if</span> self.hideThisWindowCheckBox.isChecked():<br>            self.hide()<br>        self.newScreenshotButton.setDisabled(<span class=\"hljs-literal\">True</span>)<br>        QtCore.QTimer.singleShot(self.delaySpinBox.value() * <span class=\"hljs-number\">1000</span>,<br>                self.shootScreen)<br>                <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">saveScreenshot</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-built_in\">format</span> = <span class=\"hljs-string\">&#x27;png&#x27;</span><br>        initialPath = QtCore.QDir.currentPath() + <span class=\"hljs-string\">&quot;/untitled.&quot;</span> + <span class=\"hljs-built_in\">format</span><br>        fileName,filetype = QtWidgets.QFileDialog.getSaveFileName(self, <span class=\"hljs-string\">&quot;Save As&quot;</span>,<br>                initialPath,<br>                <span class=\"hljs-string\">&quot;%s Files (*.%s);;All Files (*)&quot;</span> % (<span class=\"hljs-built_in\">format</span>.upper(), <span class=\"hljs-built_in\">format</span>))<br>        <span class=\"hljs-keyword\">if</span> fileName:<br>            self.originalPixmap.save(fileName, <span class=\"hljs-built_in\">format</span>)<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;file saved as  %s&quot;</span> % fileName)<br>           <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">shootScreen</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-keyword\">if</span> self.delaySpinBox.value() != <span class=\"hljs-number\">0</span>:<br>            QtWidgets.qApp.beep()<br>        <span class=\"hljs-comment\"># Garbage collect any existing image first.</span><br>        self.originalPixmap = <span class=\"hljs-literal\">None</span><br>        <span class=\"hljs-comment\">#self.originalPixmap = QtGui.QPixmap.grabWindow(QtWidgets.QApplication.desktop().winId())#PyQt4</span><br>       <br>        screen= QtWidgets.QApplication.primaryScreen()<span class=\"hljs-comment\">#PyQt5</span><br>        self.originalPixmap = screen.grabWindow(QtWidgets.QApplication.desktop().winId())<span class=\"hljs-comment\">#PyQt5</span><br>       <br>        self.updateScreenshotLabel()<br>        self.newScreenshotButton.setDisabled(<span class=\"hljs-literal\">False</span>)<br>        <span class=\"hljs-keyword\">if</span> self.hideThisWindowCheckBox.isChecked():<br>            self.show()<br>            <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">updateCheckBox</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-keyword\">if</span> self.delaySpinBox.value() == <span class=\"hljs-number\">0</span>:<br>            self.hideThisWindowCheckBox.setDisabled(<span class=\"hljs-literal\">True</span>)<br>        <span class=\"hljs-keyword\">else</span>:<br>            self.hideThisWindowCheckBox.setDisabled(<span class=\"hljs-literal\">False</span>)<br>            <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">createOptionsGroupBox</span>(<span class=\"hljs-params\">self</span>):</span><br>        self.optionsGroupBox = QtWidgets.QGroupBox(<span class=\"hljs-string\">&quot;Options&quot;</span>)<br>        self.delaySpinBox = QtWidgets.QSpinBox()<br>        self.delaySpinBox.setSuffix(<span class=\"hljs-string\">&quot; s&quot;</span>)<br>        self.delaySpinBox.setMaximum(<span class=\"hljs-number\">60</span>)<br>        self.delaySpinBox.valueChanged.connect(self.updateCheckBox)<br>        self.delaySpinBoxLabel = QtWidgets.QLabel(<span class=\"hljs-string\">&quot;Screenshot Delay:&quot;</span>)<br>        self.hideThisWindowCheckBox = QtWidgets.QCheckBox(<span class=\"hljs-string\">&quot;Hide This Window&quot;</span>)<br>        optionsGroupBoxLayout = QtWidgets.QGridLayout()<br>        optionsGroupBoxLayout.addWidget(self.delaySpinBoxLabel, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>)<br>        optionsGroupBoxLayout.addWidget(self.delaySpinBox, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>)<br>        optionsGroupBoxLayout.addWidget(self.hideThisWindowCheckBox, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>)<br>        self.optionsGroupBox.setLayout(optionsGroupBoxLayout)<br>        <br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">createButtonsLayout</span>(<span class=\"hljs-params\">self</span>):</span><br>        self.newScreenshotButton = self.createButton(<span class=\"hljs-string\">&quot;New Screenshot&quot;</span>,<br>                self.newScreenshot)<br>        self.saveScreenshotButton = self.createButton(<span class=\"hljs-string\">&quot;Save Screenshot&quot;</span>,<br>                self.saveScreenshot)<br>        self.quitScreenshotButton = self.createButton(<span class=\"hljs-string\">&quot;Quit&quot;</span>, self.close)<br>        self.buttonsLayout = QtWidgets.QHBoxLayout()<br>        self.buttonsLayout.addStretch()<br>        self.buttonsLayout.addWidget(self.newScreenshotButton)<br>        self.buttonsLayout.addWidget(self.saveScreenshotButton)<br>        self.buttonsLayout.addWidget(self.quitScreenshotButton)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">createButton</span>(<span class=\"hljs-params\">self, text, member</span>):</span><br>        button = QtWidgets.QPushButton(text)<br>        button.clicked.connect(member)<br>        <span class=\"hljs-keyword\">return</span> button<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">updateScreenshotLabel</span>(<span class=\"hljs-params\">self</span>):</span><br>        self.screenshotLabel.setPixmap(self.originalPixmap.scaled(<br>                self.screenshotLabel.size(), QtCore.Qt.KeepAspectRatio,<br>                QtCore.Qt.SmoothTransformation))<br><br><br><span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&#x27;__main__&#x27;</span>:<br>    <span class=\"hljs-keyword\">import</span> sys<br>    app = QtWidgets.QApplication(sys.argv)<br>    screenshot = Screenshot()<br>    screenshot.show()<br>    sys.exit(app.exec_())<br></code></pre></td></tr></table></figure>"},{"title":"PyQt5中放置图片","date":"2021-10-21T01:56:23.000Z","_content":"\n> 在pyqt中使用label显示图片，或者使用继承了QLabel的类显示图片，实现在图片上进行长度，角度测量，标注，画板等功能。\n\n## QLabel\nQlabel部件时用于提供文本或者图像显示。Qlabel可以包含纯文本（将字符串传递给setText），富文本（将富文本传递给setText），图像（将QPixmap对象传递setPixmap），动画（将QMovie对象传递给setMovie），数字（将int或在double数字传递给setNum），空（默认，由clear设置）。\n\n- 当Qlabel使用setText设置文本内容，因为Qlabel会判断其为纯文本还是作为HTML标记的富文本，想明确显示文本格式，则调用setTextFormat。\n\n## 图片插入\n首先使用QPixmap()创建一个QPixmap对象，使用setPixmap函数插入图片，若使用setScaledContents（True）可以设置将图片填充该label的所有可用空间，此参数默认是False。\n\n```python\nclass Example(QWidget):\n    def initUI(self):\n\t\t#lb1是直接插入；lb2是缩放图片填充label区域；\n        pix = QPixmap('sexy.jpg')\n\n        lb1 = QLabel(self)\n        lb1.setGeometry(0,0,300,200)\n        lb1.setStyleSheet(\"border: 2px solid red\")\n        lb1.setPixmap(pix)\n\n        lb2 = QLabel(self)\n        lb2.setGeometry(0,250,300,200)\n        lb2.setPixmap(pix)\n        lb2.setStyleSheet(\"border: 2px solid red\")\n        lb2.setScaledContents(True)\n```\n\n## 项目实例\n\n在项目代码中有\n\n```python\nself.lab = MyLabel(self.widget)\n# self.lab.setStyleSheet(\"QLabel{background:black;}\")\nimg_width = 1102\nimg_height = 629\nself.image_list = [\"./temp.jpg\"]\nself.image = QPixmap(self.image_list[0])\nself.image = self.image.scaled(img_width, img_height)\nself.lab.setPixmap(self.image)\nself.lab.setMinimumSize(img_width, img_height)\n```\n\n- 首先创建Qpixmap(path)\n\n- 对Qpixmap对象scaled调整图片大小\n\n- 我们通常会使用Qt自带的scaled()函数；QImage、QPixmap等绘图设备类都提供scaled()函数。\n\n     scaled()是一个重载函数，按照指定的宽和高，根据给的size和aspectRatioMode从原有图像返回一个经过比例转换的图像，如果宽高为0，返回一个空图像\n  所以，获取控件的改变后的宽高，就能设定图像转换的宽高转换比例，用scaled()的返回重新进行绘图即可自适应窗口。\n  \n  项目中这里使用 `Qt.IgnoreAspectRatio`\n\n```python\nQPixmap::scaled(const QSize & size, Qt::AspectRatioMode aspectRatioMode = Qt::IgnoreAspectRatio, Qt::TransformationMode transformMode = Qt::FastTransformation) const\n其中aspectRatioMode\nIgnoreAspectRatio  #矩形框有多大，图片就缩放成多大，不限制原图片的长宽比\nKeepAspectRatio    #保持原图片的长宽比，且不超过矩形框的大小\nKeepAspectRatioByExpanding   #根据矩形框的大小最大缩放图片\ndef scaled(self, *__args): # real signature unknown; restored from __doc__ with multiple overloads\n    \"\"\"\n        scaled(self, int, int, aspectRatioMode: Qt.AspectRatioMode = Qt.IgnoreAspectRatio, transformMode: Qt.TransformationMode = Qt.FastTransformation) -> QPixmap\n        scaled(self, QSize, aspectRatioMode: Qt.AspectRatioMode = Qt.IgnoreAspectRatio, transformMode: Qt.TransformationMode = Qt.FastTransformation) -> QPixmap\n        \"\"\"\n    return QPixmap\n\n```\n\n","source":"_posts/python/pyqt/pyqtimg.md","raw":"---\ntitle: PyQt5中放置图片\ntags: python\ncategories: python\ndate: 2021-10-21 09:56:23\n---\n\n> 在pyqt中使用label显示图片，或者使用继承了QLabel的类显示图片，实现在图片上进行长度，角度测量，标注，画板等功能。\n\n## QLabel\nQlabel部件时用于提供文本或者图像显示。Qlabel可以包含纯文本（将字符串传递给setText），富文本（将富文本传递给setText），图像（将QPixmap对象传递setPixmap），动画（将QMovie对象传递给setMovie），数字（将int或在double数字传递给setNum），空（默认，由clear设置）。\n\n- 当Qlabel使用setText设置文本内容，因为Qlabel会判断其为纯文本还是作为HTML标记的富文本，想明确显示文本格式，则调用setTextFormat。\n\n## 图片插入\n首先使用QPixmap()创建一个QPixmap对象，使用setPixmap函数插入图片，若使用setScaledContents（True）可以设置将图片填充该label的所有可用空间，此参数默认是False。\n\n```python\nclass Example(QWidget):\n    def initUI(self):\n\t\t#lb1是直接插入；lb2是缩放图片填充label区域；\n        pix = QPixmap('sexy.jpg')\n\n        lb1 = QLabel(self)\n        lb1.setGeometry(0,0,300,200)\n        lb1.setStyleSheet(\"border: 2px solid red\")\n        lb1.setPixmap(pix)\n\n        lb2 = QLabel(self)\n        lb2.setGeometry(0,250,300,200)\n        lb2.setPixmap(pix)\n        lb2.setStyleSheet(\"border: 2px solid red\")\n        lb2.setScaledContents(True)\n```\n\n## 项目实例\n\n在项目代码中有\n\n```python\nself.lab = MyLabel(self.widget)\n# self.lab.setStyleSheet(\"QLabel{background:black;}\")\nimg_width = 1102\nimg_height = 629\nself.image_list = [\"./temp.jpg\"]\nself.image = QPixmap(self.image_list[0])\nself.image = self.image.scaled(img_width, img_height)\nself.lab.setPixmap(self.image)\nself.lab.setMinimumSize(img_width, img_height)\n```\n\n- 首先创建Qpixmap(path)\n\n- 对Qpixmap对象scaled调整图片大小\n\n- 我们通常会使用Qt自带的scaled()函数；QImage、QPixmap等绘图设备类都提供scaled()函数。\n\n     scaled()是一个重载函数，按照指定的宽和高，根据给的size和aspectRatioMode从原有图像返回一个经过比例转换的图像，如果宽高为0，返回一个空图像\n  所以，获取控件的改变后的宽高，就能设定图像转换的宽高转换比例，用scaled()的返回重新进行绘图即可自适应窗口。\n  \n  项目中这里使用 `Qt.IgnoreAspectRatio`\n\n```python\nQPixmap::scaled(const QSize & size, Qt::AspectRatioMode aspectRatioMode = Qt::IgnoreAspectRatio, Qt::TransformationMode transformMode = Qt::FastTransformation) const\n其中aspectRatioMode\nIgnoreAspectRatio  #矩形框有多大，图片就缩放成多大，不限制原图片的长宽比\nKeepAspectRatio    #保持原图片的长宽比，且不超过矩形框的大小\nKeepAspectRatioByExpanding   #根据矩形框的大小最大缩放图片\ndef scaled(self, *__args): # real signature unknown; restored from __doc__ with multiple overloads\n    \"\"\"\n        scaled(self, int, int, aspectRatioMode: Qt.AspectRatioMode = Qt.IgnoreAspectRatio, transformMode: Qt.TransformationMode = Qt.FastTransformation) -> QPixmap\n        scaled(self, QSize, aspectRatioMode: Qt.AspectRatioMode = Qt.IgnoreAspectRatio, transformMode: Qt.TransformationMode = Qt.FastTransformation) -> QPixmap\n        \"\"\"\n    return QPixmap\n\n```\n\n","slug":"python/pyqt/pyqtimg","published":1,"updated":"2022-01-18T08:10:17.113Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0cf007fast9hloy111a","content":"<blockquote>\n<p>在pyqt中使用label显示图片，或者使用继承了QLabel的类显示图片，实现在图片上进行长度，角度测量，标注，画板等功能。</p>\n</blockquote>\n<h2 id=\"QLabel\">QLabel</h2>\n<p>Qlabel部件时用于提供文本或者图像显示。Qlabel可以包含纯文本（将字符串传递给setText），富文本（将富文本传递给setText），图像（将QPixmap对象传递setPixmap），动画（将QMovie对象传递给setMovie），数字（将int或在double数字传递给setNum），空（默认，由clear设置）。</p>\n<ul>\n<li>当Qlabel使用setText设置文本内容，因为Qlabel会判断其为纯文本还是作为HTML标记的富文本，想明确显示文本格式，则调用setTextFormat。</li>\n</ul>\n<h2 id=\"图片插入\">图片插入</h2>\n<p>首先使用QPixmap()创建一个QPixmap对象，使用setPixmap函数插入图片，若使用setScaledContents（True）可以设置将图片填充该label的所有可用空间，此参数默认是False。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Example</span>(<span class=\"hljs-params\">QWidget</span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">initUI</span>(<span class=\"hljs-params\">self</span>):</span><br>\t\t<span class=\"hljs-comment\">#lb1是直接插入；lb2是缩放图片填充label区域；</span><br>        pix = QPixmap(<span class=\"hljs-string\">'sexy.jpg'</span>)<br><br>        lb1 = QLabel(self)<br>        lb1.setGeometry(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">300</span>,<span class=\"hljs-number\">200</span>)<br>        lb1.setStyleSheet(<span class=\"hljs-string\">\"border: 2px solid red\"</span>)<br>        lb1.setPixmap(pix)<br><br>        lb2 = QLabel(self)<br>        lb2.setGeometry(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">250</span>,<span class=\"hljs-number\">300</span>,<span class=\"hljs-number\">200</span>)<br>        lb2.setPixmap(pix)<br>        lb2.setStyleSheet(<span class=\"hljs-string\">\"border: 2px solid red\"</span>)<br>        lb2.setScaledContents(<span class=\"hljs-literal\">True</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"项目实例\">项目实例</h2>\n<p>在项目代码中有</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">self.lab = MyLabel(self.widget)<br><span class=\"hljs-comment\"># self.lab.setStyleSheet(\"QLabel{background:black;}\")</span><br>img_width = <span class=\"hljs-number\">1102</span><br>img_height = <span class=\"hljs-number\">629</span><br>self.image_list = [<span class=\"hljs-string\">\"./temp.jpg\"</span>]<br>self.image = QPixmap(self.image_list[<span class=\"hljs-number\">0</span>])<br>self.image = self.image.scaled(img_width, img_height)<br>self.lab.setPixmap(self.image)<br>self.lab.setMinimumSize(img_width, img_height)<br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>\n<p>首先创建Qpixmap(path)</p>\n</li>\n<li>\n<p>对Qpixmap对象scaled调整图片大小</p>\n</li>\n<li>\n<p>我们通常会使用Qt自带的scaled()函数；QImage、QPixmap等绘图设备类都提供scaled()函数。</p>\n<p>scaled()是一个重载函数，按照指定的宽和高，根据给的size和aspectRatioMode从原有图像返回一个经过比例转换的图像，如果宽高为0，返回一个空图像<br>\n所以，获取控件的改变后的宽高，就能设定图像转换的宽高转换比例，用scaled()的返回重新进行绘图即可自适应窗口。</p>\n<p>项目中这里使用 <code>Qt.IgnoreAspectRatio</code></p>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">QPixmap::scaled(const QSize &amp; size, Qt::AspectRatioMode aspectRatioMode = Qt::IgnoreAspectRatio, Qt::TransformationMode transformMode = Qt::FastTransformation) const<br>其中aspectRatioMode<br>IgnoreAspectRatio  <span class=\"hljs-comment\">#矩形框有多大，图片就缩放成多大，不限制原图片的长宽比</span><br>KeepAspectRatio    <span class=\"hljs-comment\">#保持原图片的长宽比，且不超过矩形框的大小</span><br>KeepAspectRatioByExpanding   <span class=\"hljs-comment\">#根据矩形框的大小最大缩放图片</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">scaled</span>(<span class=\"hljs-params\">self, *__args</span>):</span> <span class=\"hljs-comment\"># real signature unknown; restored from __doc__ with multiple overloads</span><br>    <span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\">        scaled(self, int, int, aspectRatioMode: Qt.AspectRatioMode = Qt.IgnoreAspectRatio, transformMode: Qt.TransformationMode = Qt.FastTransformation) -&gt; QPixmap</span><br><span class=\"hljs-string\">        scaled(self, QSize, aspectRatioMode: Qt.AspectRatioMode = Qt.IgnoreAspectRatio, transformMode: Qt.TransformationMode = Qt.FastTransformation) -&gt; QPixmap</span><br><span class=\"hljs-string\">        \"\"\"</span><br>    <span class=\"hljs-keyword\">return</span> QPixmap<br><br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>在pyqt中使用label显示图片，或者使用继承了QLabel的类显示图片，实现在图片上进行长度，角度测量，标注，画板等功能。</p>\n</blockquote>\n<h2 id=\"QLabel\">QLabel</h2>\n<p>Qlabel部件时用于提供文本或者图像显示。Qlabel可以包含纯文本（将字符串传递给setText），富文本（将富文本传递给setText），图像（将QPixmap对象传递setPixmap），动画（将QMovie对象传递给setMovie），数字（将int或在double数字传递给setNum），空（默认，由clear设置）。</p>\n<ul>\n<li>当Qlabel使用setText设置文本内容，因为Qlabel会判断其为纯文本还是作为HTML标记的富文本，想明确显示文本格式，则调用setTextFormat。</li>\n</ul>\n<h2 id=\"图片插入\">图片插入</h2>\n<p>首先使用QPixmap()创建一个QPixmap对象，使用setPixmap函数插入图片，若使用setScaledContents（True）可以设置将图片填充该label的所有可用空间，此参数默认是False。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Example</span>(<span class=\"hljs-params\">QWidget</span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">initUI</span>(<span class=\"hljs-params\">self</span>):</span><br>\t\t<span class=\"hljs-comment\">#lb1是直接插入；lb2是缩放图片填充label区域；</span><br>        pix = QPixmap(<span class=\"hljs-string\">&#x27;sexy.jpg&#x27;</span>)<br><br>        lb1 = QLabel(self)<br>        lb1.setGeometry(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">300</span>,<span class=\"hljs-number\">200</span>)<br>        lb1.setStyleSheet(<span class=\"hljs-string\">&quot;border: 2px solid red&quot;</span>)<br>        lb1.setPixmap(pix)<br><br>        lb2 = QLabel(self)<br>        lb2.setGeometry(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">250</span>,<span class=\"hljs-number\">300</span>,<span class=\"hljs-number\">200</span>)<br>        lb2.setPixmap(pix)<br>        lb2.setStyleSheet(<span class=\"hljs-string\">&quot;border: 2px solid red&quot;</span>)<br>        lb2.setScaledContents(<span class=\"hljs-literal\">True</span>)<br></code></pre></td></tr></table></figure>\n<h2 id=\"项目实例\">项目实例</h2>\n<p>在项目代码中有</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">self.lab = MyLabel(self.widget)<br><span class=\"hljs-comment\"># self.lab.setStyleSheet(&quot;QLabel&#123;background:black;&#125;&quot;)</span><br>img_width = <span class=\"hljs-number\">1102</span><br>img_height = <span class=\"hljs-number\">629</span><br>self.image_list = [<span class=\"hljs-string\">&quot;./temp.jpg&quot;</span>]<br>self.image = QPixmap(self.image_list[<span class=\"hljs-number\">0</span>])<br>self.image = self.image.scaled(img_width, img_height)<br>self.lab.setPixmap(self.image)<br>self.lab.setMinimumSize(img_width, img_height)<br></code></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>首先创建Qpixmap(path)</p>\n</li>\n<li>\n<p>对Qpixmap对象scaled调整图片大小</p>\n</li>\n<li>\n<p>我们通常会使用Qt自带的scaled()函数；QImage、QPixmap等绘图设备类都提供scaled()函数。</p>\n<p>scaled()是一个重载函数，按照指定的宽和高，根据给的size和aspectRatioMode从原有图像返回一个经过比例转换的图像，如果宽高为0，返回一个空图像<br>\n所以，获取控件的改变后的宽高，就能设定图像转换的宽高转换比例，用scaled()的返回重新进行绘图即可自适应窗口。</p>\n<p>项目中这里使用 <code>Qt.IgnoreAspectRatio</code></p>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">QPixmap::scaled(const QSize &amp; size, Qt::AspectRatioMode aspectRatioMode = Qt::IgnoreAspectRatio, Qt::TransformationMode transformMode = Qt::FastTransformation) const<br>其中aspectRatioMode<br>IgnoreAspectRatio  <span class=\"hljs-comment\">#矩形框有多大，图片就缩放成多大，不限制原图片的长宽比</span><br>KeepAspectRatio    <span class=\"hljs-comment\">#保持原图片的长宽比，且不超过矩形框的大小</span><br>KeepAspectRatioByExpanding   <span class=\"hljs-comment\">#根据矩形框的大小最大缩放图片</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">scaled</span>(<span class=\"hljs-params\">self, *__args</span>):</span> <span class=\"hljs-comment\"># real signature unknown; restored from __doc__ with multiple overloads</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">        scaled(self, int, int, aspectRatioMode: Qt.AspectRatioMode = Qt.IgnoreAspectRatio, transformMode: Qt.TransformationMode = Qt.FastTransformation) -&gt; QPixmap</span><br><span class=\"hljs-string\">        scaled(self, QSize, aspectRatioMode: Qt.AspectRatioMode = Qt.IgnoreAspectRatio, transformMode: Qt.TransformationMode = Qt.FastTransformation) -&gt; QPixmap</span><br><span class=\"hljs-string\">        &quot;&quot;&quot;</span><br>    <span class=\"hljs-keyword\">return</span> QPixmap<br><br></code></pre></td></tr></table></figure>\n"},{"title":"正则表达式中的括号","date":"2021-12-15T02:31:13.000Z","_content":"\n> 总结正则表达式中的各种括号，主要是小括号，方括号，大括号的区别。\n\n## 小括号\n小括号（）：多个匹配，**将括号中的内容作为一组来处理**，限制多选的范围。譬如`*.(png|jpg)`可标识末尾为png，jpg结尾的字符串，只能是png或者jpg，将括号中内容作为一组。\n\n## 方括号\n方括号【】：方括号是**单个匹配**，比如[abc]的含义是匹配abc其中的一个字符，并不是作为一组；\n常见的用法：[a-zA-Z0-9]可以匹配所有英文字母和数字。\n\n## 大括号\n大括号{}：大括号的用法是填入数字，**表示匹配次数**，他需要和其他有意义的正则表达式一起使用。\n比如\n\n- [a-c]{2} : 含义是匹配a到c之间的一个字母出现同时至出现两次；\n- (com){1}: 含义是匹配出现一次的com；\n- \\W{1,3}: 含义是非字母数字的字符最少出现1次，最多出现3次，匹配的字符串出现此类字符的个数也就是1到3次；\n\n","source":"_posts/python/re/re-bracket.md","raw":"---\ntitle: 正则表达式中的括号\ntags: [python,re]\ncategories: [python,re]\ndate: 2021-12-15 10:31:13\n---\n\n> 总结正则表达式中的各种括号，主要是小括号，方括号，大括号的区别。\n\n## 小括号\n小括号（）：多个匹配，**将括号中的内容作为一组来处理**，限制多选的范围。譬如`*.(png|jpg)`可标识末尾为png，jpg结尾的字符串，只能是png或者jpg，将括号中内容作为一组。\n\n## 方括号\n方括号【】：方括号是**单个匹配**，比如[abc]的含义是匹配abc其中的一个字符，并不是作为一组；\n常见的用法：[a-zA-Z0-9]可以匹配所有英文字母和数字。\n\n## 大括号\n大括号{}：大括号的用法是填入数字，**表示匹配次数**，他需要和其他有意义的正则表达式一起使用。\n比如\n\n- [a-c]{2} : 含义是匹配a到c之间的一个字母出现同时至出现两次；\n- (com){1}: 含义是匹配出现一次的com；\n- \\W{1,3}: 含义是非字母数字的字符最少出现1次，最多出现3次，匹配的字符串出现此类字符的个数也就是1到3次；\n\n","slug":"python/re/re-bracket","published":1,"updated":"2022-01-18T08:10:17.113Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ch007gast9bvx946ak","content":"<blockquote>\n<p>总结正则表达式中的各种括号，主要是小括号，方括号，大括号的区别。</p>\n</blockquote>\n<h2 id=\"小括号\">小括号</h2>\n<p>小括号（）：多个匹配，<strong>将括号中的内容作为一组来处理</strong>，限制多选的范围。譬如<code>*.(png|jpg)</code>可标识末尾为png，jpg结尾的字符串，只能是png或者jpg，将括号中内容作为一组。</p>\n<h2 id=\"方括号\">方括号</h2>\n<p>方括号【】：方括号是<strong>单个匹配</strong>，比如[abc]的含义是匹配abc其中的一个字符，并不是作为一组；<br>\n常见的用法：[a-zA-Z0-9]可以匹配所有英文字母和数字。</p>\n<h2 id=\"大括号\">大括号</h2>\n<p>大括号{}：大括号的用法是填入数字，<strong>表示匹配次数</strong>，他需要和其他有意义的正则表达式一起使用。<br>\n比如</p>\n<ul>\n<li>[a-c]{2} : 含义是匹配a到c之间的一个字母出现同时至出现两次；</li>\n<li>(com){1}: 含义是匹配出现一次的com；</li>\n<li>\\W{1,3}: 含义是非字母数字的字符最少出现1次，最多出现3次，匹配的字符串出现此类字符的个数也就是1到3次；</li>\n</ul>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>总结正则表达式中的各种括号，主要是小括号，方括号，大括号的区别。</p>\n</blockquote>\n<h2 id=\"小括号\">小括号</h2>\n<p>小括号（）：多个匹配，<strong>将括号中的内容作为一组来处理</strong>，限制多选的范围。譬如<code>*.(png|jpg)</code>可标识末尾为png，jpg结尾的字符串，只能是png或者jpg，将括号中内容作为一组。</p>\n<h2 id=\"方括号\">方括号</h2>\n<p>方括号【】：方括号是<strong>单个匹配</strong>，比如[abc]的含义是匹配abc其中的一个字符，并不是作为一组；<br>\n常见的用法：[a-zA-Z0-9]可以匹配所有英文字母和数字。</p>\n<h2 id=\"大括号\">大括号</h2>\n<p>大括号{}：大括号的用法是填入数字，<strong>表示匹配次数</strong>，他需要和其他有意义的正则表达式一起使用。<br>\n比如</p>\n<ul>\n<li>[a-c]{2} : 含义是匹配a到c之间的一个字母出现同时至出现两次；</li>\n<li>(com){1}: 含义是匹配出现一次的com；</li>\n<li>\\W{1,3}: 含义是非字母数字的字符最少出现1次，最多出现3次，匹配的字符串出现此类字符的个数也就是1到3次；</li>\n</ul>\n"},{"title":"NIPS-2014-generative-adversarial-nets-Paper","date":"2022-01-04T07:48:20.000Z","_content":"\n> 笔记记录再pdf中，所以就直接放pdf在此处叭~ :wink:\n\n### 学习视频链接\n\nhttps://www.bilibili.com/video/BV1rb4y187vD?spm_id_from=333.999.0.0\n\n### pdf链接\n\nhttps://paper.mulindya.com/NIPS-2014-generative-adversarial-nets-Paper.pdf\n\n### 论文学习链接\n\n更多论文请见：https://github.com/mli/paper-reading\n\n### 论文pdf\n\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/NIPS-2014-generative-adversarial-nets-Paper.pdf' width=100% height=600></iframe>","source":"_posts/学习笔记/paper/paper-gan.md","raw":"---\ntitle: NIPS-2014-generative-adversarial-nets-Paper\ntags: [学习笔记,paper]\ncategories: [学习笔记,paper]\ndate: 2022-01-04 15:48:20\n---\n\n> 笔记记录再pdf中，所以就直接放pdf在此处叭~ :wink:\n\n### 学习视频链接\n\nhttps://www.bilibili.com/video/BV1rb4y187vD?spm_id_from=333.999.0.0\n\n### pdf链接\n\nhttps://paper.mulindya.com/NIPS-2014-generative-adversarial-nets-Paper.pdf\n\n### 论文学习链接\n\n更多论文请见：https://github.com/mli/paper-reading\n\n### 论文pdf\n\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/NIPS-2014-generative-adversarial-nets-Paper.pdf' width=100% height=600></iframe>","slug":"学习笔记/paper/paper-gan","published":1,"updated":"2022-01-18T08:10:17.115Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0cj007jast91puhezvb","content":"<blockquote>\n<p>笔记记录再pdf中，所以就直接放pdf在此处叭~ 😉</p>\n</blockquote>\n<h3 id=\"学习视频链接\">学习视频链接</h3>\n<p><a href=\"https://www.bilibili.com/video/BV1rb4y187vD?spm_id_from=333.999.0.0\">https://www.bilibili.com/video/BV1rb4y187vD?spm_id_from=333.999.0.0</a></p>\n<h3 id=\"pdf链接\">pdf链接</h3>\n<p><a href=\"https://paper.mulindya.com/NIPS-2014-generative-adversarial-nets-Paper.pdf\">https://paper.mulindya.com/NIPS-2014-generative-adversarial-nets-Paper.pdf</a></p>\n<h3 id=\"论文学习链接\">论文学习链接</h3>\n<p>更多论文请见：<a href=\"https://github.com/mli/paper-reading\">https://github.com/mli/paper-reading</a></p>\n<h3 id=\"论文pdf\">论文pdf</h3>\n<iframe src=\"/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/NIPS-2014-generative-adversarial-nets-Paper.pdf\" width=\"100%\" height=\"600\"></iframe>","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>笔记记录再pdf中，所以就直接放pdf在此处叭~ 😉</p>\n</blockquote>\n<h3 id=\"学习视频链接\">学习视频链接</h3>\n<p><a href=\"https://www.bilibili.com/video/BV1rb4y187vD?spm_id_from=333.999.0.0\">https://www.bilibili.com/video/BV1rb4y187vD?spm_id_from=333.999.0.0</a></p>\n<h3 id=\"pdf链接\">pdf链接</h3>\n<p><a href=\"https://paper.mulindya.com/NIPS-2014-generative-adversarial-nets-Paper.pdf\">https://paper.mulindya.com/NIPS-2014-generative-adversarial-nets-Paper.pdf</a></p>\n<h3 id=\"论文学习链接\">论文学习链接</h3>\n<p>更多论文请见：<a href=\"https://github.com/mli/paper-reading\">https://github.com/mli/paper-reading</a></p>\n<h3 id=\"论文pdf\">论文pdf</h3>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/NIPS-2014-generative-adversarial-nets-Paper.pdf' width=100% height=600></iframe>"},{"title":"文献整理笔记","date":"2021-08-13T07:18:31.000Z","_content":"\n> 查找文献的网站\n> https://www.thecvf.com/\n> https://arxiv.org/list/cs/recent\n> https://www.researchgate.net/\n\n\n> 超宝藏博主： [科技猛兽](https://www.zhihu.com/people/wang-jia-hao-53-3)  \n> 宝藏公众号： 极市平台\n> 系列学习： [VIT学习](https://zhuanlan.zhihu.com/p/348593638)\n\n###  微调技巧\n\n[**Accurate, Large Minibatch SGD Training ImageNet in 1 Hour.pdf**](https://paper.mulindya.com/Accurate%2C%20Large%20Minibatch%20SGD%20Training%20ImageNet%20in%201%20Hour.pdf)\n\n[**BIT : General Visual Representation Learning.pdf**](https://paper.mulindya.com/BITGeneral%20Visual%20Representation%20Learning.pdf)\n\n[**Co-Tuning for Transfer Learning.pdf**](https://paper.mulindya.com/Co-Tuning%20for%20Transfer%20Learning.pdf)\n\n[**EfficientNet Rethinking Model Scaling for Convolutional Neural Networks.pdf**](https://paper.mulindya.com/EfficientNet%20Rethinking%20Model%20Scaling%20for%20Convolutional%20Neural%20Networks.pdf)\n\n[**He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf**](https://paper.mulindya.com/He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf)\n\n[**Simple Copy-Paste is a Strong Data Augmentation Method.pdf**](https://paper.mulindya.com/Simple%20Copy-Paste%20is%20a%20Strong%20Data%20Augmentation%20Method.pdf)\n\n[**Discriminative Feature Alignment Improving Transferability of.pdf**](https://paper.mulindya.com/Discriminative%20Feature%20Alignment%20Improving%20Transferability%20of.pdf)\n\n[**Movement Pruning adaptive sparsity by fine-tuning.pdf**](https://paper.mulindya.com/Movement%20Pruning%20adaptive%20sparsity%20by%20fine-tuning.pdf)\n\n### FPN\n\n[**Feature Pyramid Networks for Object Detection**](https://paper.mulindya.com/Feature%20Pyramid%20Networks%20for%20Object%20Detection.pdf)（FPN目标检测 解读https://zhuanlan.zhihu.com/p/36461718）\n\n### Transformer\n\n[**Attention Is All You Need**](https://paper.mulindya.com/Feature%20Pyramid%20Networks%20for%20Object%20Detection.pdf) (讲解Attention机制)\n\n[**A Survey of Transformers**](https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf)（Transformer的总结）\n\n### VIT\n\n[**AN IMAGE IS WORTH 16X16 WORDS: TRANSFORMERS FOR IMAGE RECOGNITION AT**](https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf)（将transformer应用于图像分类）\n\n[**How to train your ViT? Data, Augmentation,and Regularization in Vision Transformers**](https://paper.mulindya.com/How%20to%20train%20your%20ViT.pdf)（训练技巧）\n\n[**Scaling Vision Transformers**](https://paper.mulindya.com/Scaling%20Vision%20Transformers.pdf)（精炼VIT）\n\n[**LeViT: a Vision Transformer in ConvNet’s Clothing for Faster Inference**](https://paper.mulindya.com/levit.pdf) （混合网络）\n\n[**End-to-End Video Instance Segmentation with Transformers**](https://paper.mulindya.com/End-to-End%20Semi-Supervised%20Object%20Detection%20with%20Soft%20Teacher.pdf)（使用transformer进行实例分割）\n\n[**A Survey on Visual Transformer**](https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf) （总结）\n\n### EfficientNet\n\n[**EfficientNet Rethinking Model Scaling for Convolutional Neural Networks.pdf**](https://paper.mulindya.com/EfficientNet%20Rethinking%20Model%20Scaling%20for%20Convolutional%20Neural%20Networks.pdf)\n\n### BIT\n\n[**BIT : General Visual Representation Learning.pdf**](https://paper.mulindya.com/BITGeneral%20Visual%20Representation%20Learning.pdf)\n\n### YOLOv4\n\n[**YOLOv4: Optimal Speed and Accuracy of Object Detection**](https://paper.mulindya.com/yolo4.pdf)\n\n### PaDim\n\n[**PaDiM: a Patch Distribution Modeling Framework for Anomaly Detection and Localization**](https://paper.mulindya.com/PaDiM_a%20Patch%20Distribution%20Modeling%20Framework.pdf) (使用马氏距离)\n\n[**Semi-orthogonal Embedding for Efficient Unsupervised Anomaly Segmentation**](https://paper.mulindya.com/Semi-orthogonal%20Embedding%20for%20Efficient%20Unsupervised%20Anomaly%20Segmentation.pdf) （很多数学知识）\n\n### Swin\n\n[**Swin Transformer: Hierarchical Vision Transformer using Shifted Windows**](https://paper.mulindya.com/Swin%20Transformer%20Hierarchical%20Vision%20Transformer%20using%20Shifted%20Windows.pdf)\n\n### 其他\n\n谷歌提出的使用MPL代替Transformer，CNN（[也引发了一些争议](https://zhuanlan.zhihu.com/p/370780575)）\n\n[**MLP-Mixer: An all-MLP Architecture for Vision**](https://paper.mulindya.com/MLP-Mixer_An%20all-MLP%20Architecture%20for%20Vision.pdf)\n\n","source":"_posts/学习笔记/paper/paper-site.md","raw":"---\ntitle: 文献整理笔记\ntags: [文献]\ncategories: [文献]\ndate: 2021-08-13 15:18:31\n---\n\n> 查找文献的网站\n> https://www.thecvf.com/\n> https://arxiv.org/list/cs/recent\n> https://www.researchgate.net/\n\n\n> 超宝藏博主： [科技猛兽](https://www.zhihu.com/people/wang-jia-hao-53-3)  \n> 宝藏公众号： 极市平台\n> 系列学习： [VIT学习](https://zhuanlan.zhihu.com/p/348593638)\n\n###  微调技巧\n\n[**Accurate, Large Minibatch SGD Training ImageNet in 1 Hour.pdf**](https://paper.mulindya.com/Accurate%2C%20Large%20Minibatch%20SGD%20Training%20ImageNet%20in%201%20Hour.pdf)\n\n[**BIT : General Visual Representation Learning.pdf**](https://paper.mulindya.com/BITGeneral%20Visual%20Representation%20Learning.pdf)\n\n[**Co-Tuning for Transfer Learning.pdf**](https://paper.mulindya.com/Co-Tuning%20for%20Transfer%20Learning.pdf)\n\n[**EfficientNet Rethinking Model Scaling for Convolutional Neural Networks.pdf**](https://paper.mulindya.com/EfficientNet%20Rethinking%20Model%20Scaling%20for%20Convolutional%20Neural%20Networks.pdf)\n\n[**He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf**](https://paper.mulindya.com/He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf)\n\n[**Simple Copy-Paste is a Strong Data Augmentation Method.pdf**](https://paper.mulindya.com/Simple%20Copy-Paste%20is%20a%20Strong%20Data%20Augmentation%20Method.pdf)\n\n[**Discriminative Feature Alignment Improving Transferability of.pdf**](https://paper.mulindya.com/Discriminative%20Feature%20Alignment%20Improving%20Transferability%20of.pdf)\n\n[**Movement Pruning adaptive sparsity by fine-tuning.pdf**](https://paper.mulindya.com/Movement%20Pruning%20adaptive%20sparsity%20by%20fine-tuning.pdf)\n\n### FPN\n\n[**Feature Pyramid Networks for Object Detection**](https://paper.mulindya.com/Feature%20Pyramid%20Networks%20for%20Object%20Detection.pdf)（FPN目标检测 解读https://zhuanlan.zhihu.com/p/36461718）\n\n### Transformer\n\n[**Attention Is All You Need**](https://paper.mulindya.com/Feature%20Pyramid%20Networks%20for%20Object%20Detection.pdf) (讲解Attention机制)\n\n[**A Survey of Transformers**](https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf)（Transformer的总结）\n\n### VIT\n\n[**AN IMAGE IS WORTH 16X16 WORDS: TRANSFORMERS FOR IMAGE RECOGNITION AT**](https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf)（将transformer应用于图像分类）\n\n[**How to train your ViT? Data, Augmentation,and Regularization in Vision Transformers**](https://paper.mulindya.com/How%20to%20train%20your%20ViT.pdf)（训练技巧）\n\n[**Scaling Vision Transformers**](https://paper.mulindya.com/Scaling%20Vision%20Transformers.pdf)（精炼VIT）\n\n[**LeViT: a Vision Transformer in ConvNet’s Clothing for Faster Inference**](https://paper.mulindya.com/levit.pdf) （混合网络）\n\n[**End-to-End Video Instance Segmentation with Transformers**](https://paper.mulindya.com/End-to-End%20Semi-Supervised%20Object%20Detection%20with%20Soft%20Teacher.pdf)（使用transformer进行实例分割）\n\n[**A Survey on Visual Transformer**](https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf) （总结）\n\n### EfficientNet\n\n[**EfficientNet Rethinking Model Scaling for Convolutional Neural Networks.pdf**](https://paper.mulindya.com/EfficientNet%20Rethinking%20Model%20Scaling%20for%20Convolutional%20Neural%20Networks.pdf)\n\n### BIT\n\n[**BIT : General Visual Representation Learning.pdf**](https://paper.mulindya.com/BITGeneral%20Visual%20Representation%20Learning.pdf)\n\n### YOLOv4\n\n[**YOLOv4: Optimal Speed and Accuracy of Object Detection**](https://paper.mulindya.com/yolo4.pdf)\n\n### PaDim\n\n[**PaDiM: a Patch Distribution Modeling Framework for Anomaly Detection and Localization**](https://paper.mulindya.com/PaDiM_a%20Patch%20Distribution%20Modeling%20Framework.pdf) (使用马氏距离)\n\n[**Semi-orthogonal Embedding for Efficient Unsupervised Anomaly Segmentation**](https://paper.mulindya.com/Semi-orthogonal%20Embedding%20for%20Efficient%20Unsupervised%20Anomaly%20Segmentation.pdf) （很多数学知识）\n\n### Swin\n\n[**Swin Transformer: Hierarchical Vision Transformer using Shifted Windows**](https://paper.mulindya.com/Swin%20Transformer%20Hierarchical%20Vision%20Transformer%20using%20Shifted%20Windows.pdf)\n\n### 其他\n\n谷歌提出的使用MPL代替Transformer，CNN（[也引发了一些争议](https://zhuanlan.zhihu.com/p/370780575)）\n\n[**MLP-Mixer: An all-MLP Architecture for Vision**](https://paper.mulindya.com/MLP-Mixer_An%20all-MLP%20Architecture%20for%20Vision.pdf)\n\n","slug":"学习笔记/paper/paper-site","published":1,"updated":"2022-01-18T08:10:17.116Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ck007last90wrv47lx","content":"<blockquote>\n<p>查找文献的网站<br>\n<a href=\"https://www.thecvf.com/\">https://www.thecvf.com/</a><br>\n<a href=\"https://arxiv.org/list/cs/recent\">https://arxiv.org/list/cs/recent</a><br>\n<a href=\"https://www.researchgate.net/\">https://www.researchgate.net/</a></p>\n</blockquote>\n<blockquote>\n<p>超宝藏博主： <a href=\"https://www.zhihu.com/people/wang-jia-hao-53-3\">科技猛兽</a><br>\n宝藏公众号： 极市平台<br>\n系列学习： <a href=\"https://zhuanlan.zhihu.com/p/348593638\">VIT学习</a></p>\n</blockquote>\n<h3 id=\"微调技巧\">微调技巧</h3>\n<p><a href=\"https://paper.mulindya.com/Accurate%2C%20Large%20Minibatch%20SGD%20Training%20ImageNet%20in%201%20Hour.pdf\"><strong>Accurate, Large Minibatch SGD Training ImageNet in 1 Hour.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/BITGeneral%20Visual%20Representation%20Learning.pdf\"><strong>BIT : General Visual Representation Learning.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/Co-Tuning%20for%20Transfer%20Learning.pdf\"><strong>Co-Tuning for Transfer Learning.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/EfficientNet%20Rethinking%20Model%20Scaling%20for%20Convolutional%20Neural%20Networks.pdf\"><strong>EfficientNet Rethinking Model Scaling for Convolutional Neural Networks.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf\"><strong>He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/Simple%20Copy-Paste%20is%20a%20Strong%20Data%20Augmentation%20Method.pdf\"><strong>Simple Copy-Paste is a Strong Data Augmentation Method.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/Discriminative%20Feature%20Alignment%20Improving%20Transferability%20of.pdf\"><strong>Discriminative Feature Alignment Improving Transferability of.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/Movement%20Pruning%20adaptive%20sparsity%20by%20fine-tuning.pdf\"><strong>Movement Pruning adaptive sparsity by fine-tuning.pdf</strong></a></p>\n<h3 id=\"FPN\">FPN</h3>\n<p><a href=\"https://paper.mulindya.com/Feature%20Pyramid%20Networks%20for%20Object%20Detection.pdf\"><strong>Feature Pyramid Networks for Object Detection</strong></a>（FPN目标检测 解读https://zhuanlan.zhihu.com/p/36461718）</p>\n<h3 id=\"Transformer\">Transformer</h3>\n<p><a href=\"https://paper.mulindya.com/Feature%20Pyramid%20Networks%20for%20Object%20Detection.pdf\"><strong>Attention Is All You Need</strong></a> (讲解Attention机制)</p>\n<p><a href=\"https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf\"><strong>A Survey of Transformers</strong></a>（Transformer的总结）</p>\n<h3 id=\"VIT\">VIT</h3>\n<p><a href=\"https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf\"><strong>AN IMAGE IS WORTH 16X16 WORDS: TRANSFORMERS FOR IMAGE RECOGNITION AT</strong></a>（将transformer应用于图像分类）</p>\n<p><a href=\"https://paper.mulindya.com/How%20to%20train%20your%20ViT.pdf\"><strong>How to train your ViT? Data, Augmentation,and Regularization in Vision Transformers</strong></a>（训练技巧）</p>\n<p><a href=\"https://paper.mulindya.com/Scaling%20Vision%20Transformers.pdf\"><strong>Scaling Vision Transformers</strong></a>（精炼VIT）</p>\n<p><a href=\"https://paper.mulindya.com/levit.pdf\"><strong>LeViT: a Vision Transformer in ConvNet’s Clothing for Faster Inference</strong></a> （混合网络）</p>\n<p><a href=\"https://paper.mulindya.com/End-to-End%20Semi-Supervised%20Object%20Detection%20with%20Soft%20Teacher.pdf\"><strong>End-to-End Video Instance Segmentation with Transformers</strong></a>（使用transformer进行实例分割）</p>\n<p><a href=\"https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf\"><strong>A Survey on Visual Transformer</strong></a> （总结）</p>\n<h3 id=\"EfficientNet\">EfficientNet</h3>\n<p><a href=\"https://paper.mulindya.com/EfficientNet%20Rethinking%20Model%20Scaling%20for%20Convolutional%20Neural%20Networks.pdf\"><strong>EfficientNet Rethinking Model Scaling for Convolutional Neural Networks.pdf</strong></a></p>\n<h3 id=\"BIT\">BIT</h3>\n<p><a href=\"https://paper.mulindya.com/BITGeneral%20Visual%20Representation%20Learning.pdf\"><strong>BIT : General Visual Representation Learning.pdf</strong></a></p>\n<h3 id=\"YOLOv4\">YOLOv4</h3>\n<p><a href=\"https://paper.mulindya.com/yolo4.pdf\"><strong>YOLOv4: Optimal Speed and Accuracy of Object Detection</strong></a></p>\n<h3 id=\"PaDim\">PaDim</h3>\n<p><a href=\"https://paper.mulindya.com/PaDiM_a%20Patch%20Distribution%20Modeling%20Framework.pdf\"><strong>PaDiM: a Patch Distribution Modeling Framework for Anomaly Detection and Localization</strong></a> (使用马氏距离)</p>\n<p><a href=\"https://paper.mulindya.com/Semi-orthogonal%20Embedding%20for%20Efficient%20Unsupervised%20Anomaly%20Segmentation.pdf\"><strong>Semi-orthogonal Embedding for Efficient Unsupervised Anomaly Segmentation</strong></a> （很多数学知识）</p>\n<h3 id=\"Swin\">Swin</h3>\n<p><a href=\"https://paper.mulindya.com/Swin%20Transformer%20Hierarchical%20Vision%20Transformer%20using%20Shifted%20Windows.pdf\"><strong>Swin Transformer: Hierarchical Vision Transformer using Shifted Windows</strong></a></p>\n<h3 id=\"其他\">其他</h3>\n<p>谷歌提出的使用MPL代替Transformer，CNN（<a href=\"https://zhuanlan.zhihu.com/p/370780575\">也引发了一些争议</a>）</p>\n<p><a href=\"https://paper.mulindya.com/MLP-Mixer_An%20all-MLP%20Architecture%20for%20Vision.pdf\"><strong>MLP-Mixer: An all-MLP Architecture for Vision</strong></a></p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>查找文献的网站<br>\n<a href=\"https://www.thecvf.com/\">https://www.thecvf.com/</a><br>\n<a href=\"https://arxiv.org/list/cs/recent\">https://arxiv.org/list/cs/recent</a><br>\n<a href=\"https://www.researchgate.net/\">https://www.researchgate.net/</a></p>\n</blockquote>\n<blockquote>\n<p>超宝藏博主： <a href=\"https://www.zhihu.com/people/wang-jia-hao-53-3\">科技猛兽</a><br>\n宝藏公众号： 极市平台<br>\n系列学习： <a href=\"https://zhuanlan.zhihu.com/p/348593638\">VIT学习</a></p>\n</blockquote>\n<h3 id=\"微调技巧\">微调技巧</h3>\n<p><a href=\"https://paper.mulindya.com/Accurate%2C%20Large%20Minibatch%20SGD%20Training%20ImageNet%20in%201%20Hour.pdf\"><strong>Accurate, Large Minibatch SGD Training ImageNet in 1 Hour.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/BITGeneral%20Visual%20Representation%20Learning.pdf\"><strong>BIT : General Visual Representation Learning.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/Co-Tuning%20for%20Transfer%20Learning.pdf\"><strong>Co-Tuning for Transfer Learning.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/EfficientNet%20Rethinking%20Model%20Scaling%20for%20Convolutional%20Neural%20Networks.pdf\"><strong>EfficientNet Rethinking Model Scaling for Convolutional Neural Networks.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf\"><strong>He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/Simple%20Copy-Paste%20is%20a%20Strong%20Data%20Augmentation%20Method.pdf\"><strong>Simple Copy-Paste is a Strong Data Augmentation Method.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/Discriminative%20Feature%20Alignment%20Improving%20Transferability%20of.pdf\"><strong>Discriminative Feature Alignment Improving Transferability of.pdf</strong></a></p>\n<p><a href=\"https://paper.mulindya.com/Movement%20Pruning%20adaptive%20sparsity%20by%20fine-tuning.pdf\"><strong>Movement Pruning adaptive sparsity by fine-tuning.pdf</strong></a></p>\n<h3 id=\"FPN\">FPN</h3>\n<p><a href=\"https://paper.mulindya.com/Feature%20Pyramid%20Networks%20for%20Object%20Detection.pdf\"><strong>Feature Pyramid Networks for Object Detection</strong></a>（FPN目标检测 解读https://zhuanlan.zhihu.com/p/36461718）</p>\n<h3 id=\"Transformer\">Transformer</h3>\n<p><a href=\"https://paper.mulindya.com/Feature%20Pyramid%20Networks%20for%20Object%20Detection.pdf\"><strong>Attention Is All You Need</strong></a> (讲解Attention机制)</p>\n<p><a href=\"https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf\"><strong>A Survey of Transformers</strong></a>（Transformer的总结）</p>\n<h3 id=\"VIT\">VIT</h3>\n<p><a href=\"https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf\"><strong>AN IMAGE IS WORTH 16X16 WORDS: TRANSFORMERS FOR IMAGE RECOGNITION AT</strong></a>（将transformer应用于图像分类）</p>\n<p><a href=\"https://paper.mulindya.com/How%20to%20train%20your%20ViT.pdf\"><strong>How to train your ViT? Data, Augmentation,and Regularization in Vision Transformers</strong></a>（训练技巧）</p>\n<p><a href=\"https://paper.mulindya.com/Scaling%20Vision%20Transformers.pdf\"><strong>Scaling Vision Transformers</strong></a>（精炼VIT）</p>\n<p><a href=\"https://paper.mulindya.com/levit.pdf\"><strong>LeViT: a Vision Transformer in ConvNet’s Clothing for Faster Inference</strong></a> （混合网络）</p>\n<p><a href=\"https://paper.mulindya.com/End-to-End%20Semi-Supervised%20Object%20Detection%20with%20Soft%20Teacher.pdf\"><strong>End-to-End Video Instance Segmentation with Transformers</strong></a>（使用transformer进行实例分割）</p>\n<p><a href=\"https://paper.mulindya.com/A%20Survey%20on%20Visual%20Transformer.pdf\"><strong>A Survey on Visual Transformer</strong></a> （总结）</p>\n<h3 id=\"EfficientNet\">EfficientNet</h3>\n<p><a href=\"https://paper.mulindya.com/EfficientNet%20Rethinking%20Model%20Scaling%20for%20Convolutional%20Neural%20Networks.pdf\"><strong>EfficientNet Rethinking Model Scaling for Convolutional Neural Networks.pdf</strong></a></p>\n<h3 id=\"BIT\">BIT</h3>\n<p><a href=\"https://paper.mulindya.com/BITGeneral%20Visual%20Representation%20Learning.pdf\"><strong>BIT : General Visual Representation Learning.pdf</strong></a></p>\n<h3 id=\"YOLOv4\">YOLOv4</h3>\n<p><a href=\"https://paper.mulindya.com/yolo4.pdf\"><strong>YOLOv4: Optimal Speed and Accuracy of Object Detection</strong></a></p>\n<h3 id=\"PaDim\">PaDim</h3>\n<p><a href=\"https://paper.mulindya.com/PaDiM_a%20Patch%20Distribution%20Modeling%20Framework.pdf\"><strong>PaDiM: a Patch Distribution Modeling Framework for Anomaly Detection and Localization</strong></a> (使用马氏距离)</p>\n<p><a href=\"https://paper.mulindya.com/Semi-orthogonal%20Embedding%20for%20Efficient%20Unsupervised%20Anomaly%20Segmentation.pdf\"><strong>Semi-orthogonal Embedding for Efficient Unsupervised Anomaly Segmentation</strong></a> （很多数学知识）</p>\n<h3 id=\"Swin\">Swin</h3>\n<p><a href=\"https://paper.mulindya.com/Swin%20Transformer%20Hierarchical%20Vision%20Transformer%20using%20Shifted%20Windows.pdf\"><strong>Swin Transformer: Hierarchical Vision Transformer using Shifted Windows</strong></a></p>\n<h3 id=\"其他\">其他</h3>\n<p>谷歌提出的使用MPL代替Transformer，CNN（<a href=\"https://zhuanlan.zhihu.com/p/370780575\">也引发了一些争议</a>）</p>\n<p><a href=\"https://paper.mulindya.com/MLP-Mixer_An%20all-MLP%20Architecture%20for%20Vision.pdf\"><strong>MLP-Mixer: An all-MLP Architecture for Vision</strong></a></p>\n"},{"title":"PracticeML第二章房价实例笔记","date":"2022-01-02T07:45:41.000Z","_content":"\n> 斯坦福2021秋季的实用机器学习上线啦~ :wink: 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。\n\n> 本篇笔记主要是实例分析，还有一些小知识点\n>\n> 1. 字符串前加f，r，b，u\n> 2. | & 和 or and\n\n# 房价数据分析实例\n\n使用`numpy，pandas，matplotlib，seaborn`来处理和可视化。\n\n## 实例（波士顿房价）\n\n### 读取\n\n```python\n# !pip install seaborn pandas matplotlib numpy\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n#绘图画质更好\nfrom IPython import display\ndisplay.set_matplotlib_formats('svg')\n# Alternative to set svg for newer versions\n# import matplotlib_inline\n# matplotlib_inline.backend_inline.set_matplotlib_formats('svg')\n```\n\n```python\ndata = pd.read_csv('house_sales.zip') #可以直接用csv格式读取zip文件\n#对于文本会快很多\n```\n\n### 数据清理\n\nWe drop columns that at least 30% values are null to simplify our EDA.\n\n```python\n#缺失数据\nnull_sum = data.isnull().sum() #缺失数据个数 为空的个数 是一个键值对\ndata.columns[null_sum < len(data) * 0.3]  # columns will keep #键值对 返回值满足条件的键\n```\n\n> ```\n> Index(['Id', 'Address', 'Sold Price', 'Sold On', 'Summary', 'Type',\n>        'Year built', 'Heating', 'Cooling', 'Parking', 'Bedrooms', 'Bathrooms',\n>        'Total interior livable area', 'Total spaces', 'Garage spaces',\n>        'Home type', 'Region', 'Elementary School', 'Elementary School Score',\n>        'Elementary School Distance', 'High School', 'High School Score',\n>        'High School Distance', 'Heating features', 'Parking features',\n>        'Lot size', 'Parcel number', 'Tax assessed value', 'Annual tax amount',\n>        'Listed On', 'Listed Price', 'Zip'],\n>       dtype='object')\n> ```\n\n```python\ndata.drop(columns=data.columns[null_sum > len(data) * 0.3], inplace=True) #inplace直接修改\n```\n\n#### 核对数据类型\n\n```python\ndata.dtypes #核对数据类型\n```\n\n> ```\n> Id                               int64\n> Address                         object\n> Sold Price                      object\n> Sold On                         object\n> Summary                         object\n> Type                            object\n> Year built                      object\n> Heating                         object\n> Cooling                         object\n> Parking                         object\n> Bedrooms                        object\n> Bathrooms                      float64\n> Total interior livable area     object\n> Total spaces                   float64\n> Garage spaces                  float64\n> Home type                       object\n> Region                          object\n> Elementary School               object\n> Elementary School Score        float64\n> Elementary School Distance     float64\n> High School                     object\n> High School Score              float64\n> High School Distance           float64\n> Heating features                object\n> Parking features                object\n> Lot size                        object\n> Parcel number                   object\n> Tax assessed value              object\n> Annual tax amount               object\n> Listed On                       object\n> Listed Price                    object\n> Zip                              int64\n> dtype: object\n> ```\n\n#### 修改数据类型\n\n金额为object这是不合常理的\n\nConvert currency from string format such as `$1,000,000` to float.\n\n```python\ncurrency = ['Sold Price', 'Listed Price', 'Tax assessed value', 'Annual tax amount']\n# r'[$,-]' r的作用是：去除转义字符，replace可以用正则形式\nfor c in currency:\n    data[c] = data[c].replace(\n        r'[$,-]', '', regex=True).replace( \n        r'^\\s*$', np.nan, regex=True).astype(float)\n```\n\nConvert currency from string format such as `$1,000,000` to float.\n\n```python\nareas = ['Total interior livable area', 'Lot size']\nfor c in areas:\n    acres = data[c].str.contains('Acres') == True\n    col = data[c].replace(r'\\b sqft\\b|\\b Acres\\b|\\b,\\b','', regex=True).astype(float)\n    col[acres] *= 43560\n    data[c] = col\n```\n\n> tips :wink:\n>\n> 字符串前加f，r，b，u\n>\n> 加f作用：相当于 format() 函数f“{变量名}”\n>\n> 加r的作用是：去除转义字符； 场景：想复制某个文件夹的目录。\n>\n> 加b的作用是：后面字符串是bytes 类型bytes；应用场景：像图片、音视频等文件的读写就是用bytes数据。\n>\n> 加u的作用：后面字符串以 Unicode 格式 进行编码；实际场景：一般用在中文字符串前面，防止因为源码储存格式问题，导致再次使用时出现乱码。\n\n```python\n#Now we can check values of the numerical columns. You could see the min and max values for several columns do not make sense.\ndata.describe()\n```\n\n可以查看一些不太正常的字段。。。\n\n#### 数据清理数值\n\nWe filter out houses whose living areas are too small or too hard to simplify the visualization later.\n\n> | & 和 or and\n>\n> DataFrame中切片需要求得满足多个逻辑条件的数据时，要使用& 和|，在某些条件下用and/ or会报错\n>\n> 一般情况下：\n>\n> - **如果a，b是数值变量**， 则&， |表示[位运算](https://so.csdn.net/so/search?q=位运算)， and，or则依据是否非0来决定输出\n>\n> - **如何a, b是逻辑变量**， 则两类的用法基本一致\n\n```python\nabnormal = (data[areas[1]] < 10) | (data[areas[1]] > 1e4) #不正常的数据\ndata = data[~abnormal] #使用~来求反\nsum(abnormal)\n```\n\n#### 查看价格类别图像\n\nLet's check the histogram of the `'Sold Price'`, which is the target we want to predict.\n\n```python\nax = sns.histplot(np.log10(data['Sold Price'])) #直方图绘制 取log10 这样分布更加均匀\nax.set_xlim([3, 8])\nax.set_xticks(range(3, 9))\nax.set_xticklabels(['%.0e'%a for a in 10**ax.get_xticks()]);\n#前面的可能有租房噪音\n```\n\n![](https://picture.mulindya.com/pML2-1.png)\n\nA house has different types. Here are the top types:\n\n```python\ndata['Type'].value_counts()[0:20] #value_counts对应值的个数\n```\n\n> ```\n> SingleFamily            74318\n> Condo                   18749\n> MultiFamily              6586\n> VacantLand               6199\n> Townhouse                5846\n> Unknown                  5390\n> MobileManufactured       2588\n> Apartment                1416\n> Cooperative               161\n> Residential Lot            75\n> Single Family              69\n> Single Family Lot          56\n> Acreage                    48\n> 2 Story                    39\n> 3 Story                    25\n> Hi-Rise (9+), Luxury       21\n> RESIDENTIAL                19\n> Condominium                19\n> Duplex                     19\n> Mid-Rise (4-8)             17\n> Name: Type, dtype: int64\n> 下面的一些均为噪音\n> ```\n\nPrice density for different house types.\n\n```python\ntypes = data['Type'].isin(['SingleFamily', 'Condo', 'MultiFamily', 'Townhouse'])\nsns.displot(pd.DataFrame({'Sold Price':np.log10(data[types]['Sold Price']),\n                          'Type':data[types]['Type']}),\n            x='Sold Price', hue='Type', kind='kde'); #kde是密度分布，hue指定线颜色按照Type分类\n```\n\n![](https://picture.mulindya.com/pML2-2.png)\n\nAnother important measurement is the sale price per living sqft. Let's check the differences between different house types.\n\n`boxplot`中间横线表示均值，箱型图上四分和下四分，还有max和min值；适合用于表示分布的对比\n\n```python\ndata['Price per living sqft'] = data['Sold Price'] / data['Total interior livable area'] #每平米价格\nax = sns.boxplot(x='Type', y='Price per living sqft', data=data[types], fliersize=0)\nax.set_ylim([0, 2000]);\n```\n\n![](https://picture.mulindya.com/pML2-3.png)\n\n\nWe know the location affect the price. Let's check the price for the top 20 zip codes.\n```python\nd = data[data['Zip'].isin(data['Zip'].value_counts()[:20].keys())]\nax = sns.boxplot(x='Zip', y='Price per living sqft', data=d, fliersize=0)\nax.set_ylim([0, 2000])\nax.set_xticklabels(ax.get_xticklabels(), rotation=90);\n```\n\n![](https://picture.mulindya.com/pML2-4.png)\n\n### 查看协方差\n\nLast, we visualize the correlation matrix of several columns.\n\n`挑选某些列分布计算计算协方差使用corr()`可以查看关联度\n\n```python\n_, ax = plt.subplots(figsize=(4,4))\ncolumns = ['Sold Price', 'Listed Price', 'Annual tax amount', 'Price per living sqft']\nsns.heatmap(data[columns].corr(),annot=True,cmap='RdYlGn', ax=ax);\n#使用热力图绘制\n```\n\n![](https://picture.mulindya.com/pML2-5.png)\n\n## Summary\n\nThis notebook demonstrates the basic technologies for EDA, including\n\n- Understanding column data types, values, and distributions\n- Understanding the interactions between columns\n\n\n\nWe only explored a small aspect of the data. You are welcome to dive deep into more details.\n","source":"_posts/学习笔记/实用机器学习/PracticeML2-1.md","raw":"---\ntitle: PracticeML第二章房价实例笔记\ndate: 2022-01-02 15:45:41\ntags: [李沐,机器学习]\ncategories: [学习笔记,机器学习]\n---\n\n> 斯坦福2021秋季的实用机器学习上线啦~ :wink: 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。\n\n> 本篇笔记主要是实例分析，还有一些小知识点\n>\n> 1. 字符串前加f，r，b，u\n> 2. | & 和 or and\n\n# 房价数据分析实例\n\n使用`numpy，pandas，matplotlib，seaborn`来处理和可视化。\n\n## 实例（波士顿房价）\n\n### 读取\n\n```python\n# !pip install seaborn pandas matplotlib numpy\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n#绘图画质更好\nfrom IPython import display\ndisplay.set_matplotlib_formats('svg')\n# Alternative to set svg for newer versions\n# import matplotlib_inline\n# matplotlib_inline.backend_inline.set_matplotlib_formats('svg')\n```\n\n```python\ndata = pd.read_csv('house_sales.zip') #可以直接用csv格式读取zip文件\n#对于文本会快很多\n```\n\n### 数据清理\n\nWe drop columns that at least 30% values are null to simplify our EDA.\n\n```python\n#缺失数据\nnull_sum = data.isnull().sum() #缺失数据个数 为空的个数 是一个键值对\ndata.columns[null_sum < len(data) * 0.3]  # columns will keep #键值对 返回值满足条件的键\n```\n\n> ```\n> Index(['Id', 'Address', 'Sold Price', 'Sold On', 'Summary', 'Type',\n>        'Year built', 'Heating', 'Cooling', 'Parking', 'Bedrooms', 'Bathrooms',\n>        'Total interior livable area', 'Total spaces', 'Garage spaces',\n>        'Home type', 'Region', 'Elementary School', 'Elementary School Score',\n>        'Elementary School Distance', 'High School', 'High School Score',\n>        'High School Distance', 'Heating features', 'Parking features',\n>        'Lot size', 'Parcel number', 'Tax assessed value', 'Annual tax amount',\n>        'Listed On', 'Listed Price', 'Zip'],\n>       dtype='object')\n> ```\n\n```python\ndata.drop(columns=data.columns[null_sum > len(data) * 0.3], inplace=True) #inplace直接修改\n```\n\n#### 核对数据类型\n\n```python\ndata.dtypes #核对数据类型\n```\n\n> ```\n> Id                               int64\n> Address                         object\n> Sold Price                      object\n> Sold On                         object\n> Summary                         object\n> Type                            object\n> Year built                      object\n> Heating                         object\n> Cooling                         object\n> Parking                         object\n> Bedrooms                        object\n> Bathrooms                      float64\n> Total interior livable area     object\n> Total spaces                   float64\n> Garage spaces                  float64\n> Home type                       object\n> Region                          object\n> Elementary School               object\n> Elementary School Score        float64\n> Elementary School Distance     float64\n> High School                     object\n> High School Score              float64\n> High School Distance           float64\n> Heating features                object\n> Parking features                object\n> Lot size                        object\n> Parcel number                   object\n> Tax assessed value              object\n> Annual tax amount               object\n> Listed On                       object\n> Listed Price                    object\n> Zip                              int64\n> dtype: object\n> ```\n\n#### 修改数据类型\n\n金额为object这是不合常理的\n\nConvert currency from string format such as `$1,000,000` to float.\n\n```python\ncurrency = ['Sold Price', 'Listed Price', 'Tax assessed value', 'Annual tax amount']\n# r'[$,-]' r的作用是：去除转义字符，replace可以用正则形式\nfor c in currency:\n    data[c] = data[c].replace(\n        r'[$,-]', '', regex=True).replace( \n        r'^\\s*$', np.nan, regex=True).astype(float)\n```\n\nConvert currency from string format such as `$1,000,000` to float.\n\n```python\nareas = ['Total interior livable area', 'Lot size']\nfor c in areas:\n    acres = data[c].str.contains('Acres') == True\n    col = data[c].replace(r'\\b sqft\\b|\\b Acres\\b|\\b,\\b','', regex=True).astype(float)\n    col[acres] *= 43560\n    data[c] = col\n```\n\n> tips :wink:\n>\n> 字符串前加f，r，b，u\n>\n> 加f作用：相当于 format() 函数f“{变量名}”\n>\n> 加r的作用是：去除转义字符； 场景：想复制某个文件夹的目录。\n>\n> 加b的作用是：后面字符串是bytes 类型bytes；应用场景：像图片、音视频等文件的读写就是用bytes数据。\n>\n> 加u的作用：后面字符串以 Unicode 格式 进行编码；实际场景：一般用在中文字符串前面，防止因为源码储存格式问题，导致再次使用时出现乱码。\n\n```python\n#Now we can check values of the numerical columns. You could see the min and max values for several columns do not make sense.\ndata.describe()\n```\n\n可以查看一些不太正常的字段。。。\n\n#### 数据清理数值\n\nWe filter out houses whose living areas are too small or too hard to simplify the visualization later.\n\n> | & 和 or and\n>\n> DataFrame中切片需要求得满足多个逻辑条件的数据时，要使用& 和|，在某些条件下用and/ or会报错\n>\n> 一般情况下：\n>\n> - **如果a，b是数值变量**， 则&， |表示[位运算](https://so.csdn.net/so/search?q=位运算)， and，or则依据是否非0来决定输出\n>\n> - **如何a, b是逻辑变量**， 则两类的用法基本一致\n\n```python\nabnormal = (data[areas[1]] < 10) | (data[areas[1]] > 1e4) #不正常的数据\ndata = data[~abnormal] #使用~来求反\nsum(abnormal)\n```\n\n#### 查看价格类别图像\n\nLet's check the histogram of the `'Sold Price'`, which is the target we want to predict.\n\n```python\nax = sns.histplot(np.log10(data['Sold Price'])) #直方图绘制 取log10 这样分布更加均匀\nax.set_xlim([3, 8])\nax.set_xticks(range(3, 9))\nax.set_xticklabels(['%.0e'%a for a in 10**ax.get_xticks()]);\n#前面的可能有租房噪音\n```\n\n![](https://picture.mulindya.com/pML2-1.png)\n\nA house has different types. Here are the top types:\n\n```python\ndata['Type'].value_counts()[0:20] #value_counts对应值的个数\n```\n\n> ```\n> SingleFamily            74318\n> Condo                   18749\n> MultiFamily              6586\n> VacantLand               6199\n> Townhouse                5846\n> Unknown                  5390\n> MobileManufactured       2588\n> Apartment                1416\n> Cooperative               161\n> Residential Lot            75\n> Single Family              69\n> Single Family Lot          56\n> Acreage                    48\n> 2 Story                    39\n> 3 Story                    25\n> Hi-Rise (9+), Luxury       21\n> RESIDENTIAL                19\n> Condominium                19\n> Duplex                     19\n> Mid-Rise (4-8)             17\n> Name: Type, dtype: int64\n> 下面的一些均为噪音\n> ```\n\nPrice density for different house types.\n\n```python\ntypes = data['Type'].isin(['SingleFamily', 'Condo', 'MultiFamily', 'Townhouse'])\nsns.displot(pd.DataFrame({'Sold Price':np.log10(data[types]['Sold Price']),\n                          'Type':data[types]['Type']}),\n            x='Sold Price', hue='Type', kind='kde'); #kde是密度分布，hue指定线颜色按照Type分类\n```\n\n![](https://picture.mulindya.com/pML2-2.png)\n\nAnother important measurement is the sale price per living sqft. Let's check the differences between different house types.\n\n`boxplot`中间横线表示均值，箱型图上四分和下四分，还有max和min值；适合用于表示分布的对比\n\n```python\ndata['Price per living sqft'] = data['Sold Price'] / data['Total interior livable area'] #每平米价格\nax = sns.boxplot(x='Type', y='Price per living sqft', data=data[types], fliersize=0)\nax.set_ylim([0, 2000]);\n```\n\n![](https://picture.mulindya.com/pML2-3.png)\n\n\nWe know the location affect the price. Let's check the price for the top 20 zip codes.\n```python\nd = data[data['Zip'].isin(data['Zip'].value_counts()[:20].keys())]\nax = sns.boxplot(x='Zip', y='Price per living sqft', data=d, fliersize=0)\nax.set_ylim([0, 2000])\nax.set_xticklabels(ax.get_xticklabels(), rotation=90);\n```\n\n![](https://picture.mulindya.com/pML2-4.png)\n\n### 查看协方差\n\nLast, we visualize the correlation matrix of several columns.\n\n`挑选某些列分布计算计算协方差使用corr()`可以查看关联度\n\n```python\n_, ax = plt.subplots(figsize=(4,4))\ncolumns = ['Sold Price', 'Listed Price', 'Annual tax amount', 'Price per living sqft']\nsns.heatmap(data[columns].corr(),annot=True,cmap='RdYlGn', ax=ax);\n#使用热力图绘制\n```\n\n![](https://picture.mulindya.com/pML2-5.png)\n\n## Summary\n\nThis notebook demonstrates the basic technologies for EDA, including\n\n- Understanding column data types, values, and distributions\n- Understanding the interactions between columns\n\n\n\nWe only explored a small aspect of the data. You are welcome to dive deep into more details.\n","slug":"学习笔记/实用机器学习/PracticeML2-1","published":1,"updated":"2022-01-18T08:10:17.117Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0cq007past94nyqhw48","content":"<blockquote>\n<p>斯坦福2021秋季的实用机器学习上线啦~ 😉 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。</p>\n</blockquote>\n<blockquote>\n<p>本篇笔记主要是实例分析，还有一些小知识点</p>\n<ol>\n<li>字符串前加f，r，b，u</li>\n<li>| &amp; 和 or and</li>\n</ol>\n</blockquote>\n<h1>房价数据分析实例</h1>\n<p>使用<code>numpy，pandas，matplotlib，seaborn</code>来处理和可视化。</p>\n<h2 id=\"实例（波士顿房价）\">实例（波士顿房价）</h2>\n<h3 id=\"读取\">读取</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># !pip install seaborn pandas matplotlib numpy</span><br><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd<br><span class=\"hljs-keyword\">import</span> matplotlib.pyplot <span class=\"hljs-keyword\">as</span> plt<br><span class=\"hljs-keyword\">import</span> seaborn <span class=\"hljs-keyword\">as</span> sns<br><br><span class=\"hljs-comment\">#绘图画质更好</span><br><span class=\"hljs-keyword\">from</span> IPython <span class=\"hljs-keyword\">import</span> display<br>display.set_matplotlib_formats(<span class=\"hljs-string\">'svg'</span>)<br><span class=\"hljs-comment\"># Alternative to set svg for newer versions</span><br><span class=\"hljs-comment\"># import matplotlib_inline</span><br><span class=\"hljs-comment\"># matplotlib_inline.backend_inline.set_matplotlib_formats('svg')</span><br></code></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">data = pd.read_csv(<span class=\"hljs-string\">'house_sales.zip'</span>) <span class=\"hljs-comment\">#可以直接用csv格式读取zip文件</span><br><span class=\"hljs-comment\">#对于文本会快很多</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"数据清理\">数据清理</h3>\n<p>We drop columns that at least 30% values are null to simplify our EDA.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#缺失数据</span><br>null_sum = data.isnull().<span class=\"hljs-built_in\">sum</span>() <span class=\"hljs-comment\">#缺失数据个数 为空的个数 是一个键值对</span><br>data.columns[null_sum &lt; <span class=\"hljs-built_in\">len</span>(data) * <span class=\"hljs-number\">0.3</span>]  <span class=\"hljs-comment\"># columns will keep #键值对 返回值满足条件的键</span><br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<figure class=\"highlight sml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sml\"><span class=\"hljs-type\">Index</span>([<span class=\"hljs-symbol\">'Id'</span>, <span class=\"hljs-symbol\">'Address'</span>, <span class=\"hljs-symbol\">'Sold</span> <span class=\"hljs-type\">Price'</span>, <span class=\"hljs-symbol\">'Sold</span> <span class=\"hljs-type\">On'</span>, <span class=\"hljs-symbol\">'Summary'</span>, <span class=\"hljs-symbol\">'Type'</span>,<br>       <span class=\"hljs-symbol\">'Year</span> built', <span class=\"hljs-symbol\">'Heating'</span>, <span class=\"hljs-symbol\">'Cooling'</span>, <span class=\"hljs-symbol\">'Parking'</span>, <span class=\"hljs-symbol\">'Bedrooms'</span>, <span class=\"hljs-symbol\">'Bathrooms'</span>,<br>       <span class=\"hljs-symbol\">'Total</span> interior livable area', <span class=\"hljs-symbol\">'Total</span> spaces', <span class=\"hljs-symbol\">'Garage</span> spaces',<br>       <span class=\"hljs-symbol\">'Home</span> type', <span class=\"hljs-symbol\">'Region'</span>, <span class=\"hljs-symbol\">'Elementary</span> <span class=\"hljs-type\">School'</span>, <span class=\"hljs-symbol\">'Elementary</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Score'</span>,<br>       <span class=\"hljs-symbol\">'Elementary</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Distance'</span>, <span class=\"hljs-symbol\">'High</span> <span class=\"hljs-type\">School'</span>, <span class=\"hljs-symbol\">'High</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Score'</span>,<br>       <span class=\"hljs-symbol\">'High</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Distance'</span>, <span class=\"hljs-symbol\">'Heating</span> features', <span class=\"hljs-symbol\">'Parking</span> features',<br>       <span class=\"hljs-symbol\">'Lot</span> size', <span class=\"hljs-symbol\">'Parcel</span> number', <span class=\"hljs-symbol\">'Tax</span> assessed value', <span class=\"hljs-symbol\">'Annual</span> tax amount',<br>       <span class=\"hljs-symbol\">'Listed</span> <span class=\"hljs-type\">On'</span>, <span class=\"hljs-symbol\">'Listed</span> <span class=\"hljs-type\">Price'</span>, <span class=\"hljs-symbol\">'Zip'</span>],<br>      dtype=<span class=\"hljs-symbol\">'object'</span>)<br></code></pre></td></tr></tbody></table></figure>\n</blockquote>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">data.drop(columns=data.columns[null_sum &gt; <span class=\"hljs-built_in\">len</span>(data) * <span class=\"hljs-number\">0.3</span>], inplace=<span class=\"hljs-literal\">True</span>) <span class=\"hljs-comment\">#inplace直接修改</span><br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"核对数据类型\">核对数据类型</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">data.dtypes <span class=\"hljs-comment\">#核对数据类型</span><br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<figure class=\"highlight nim\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nim\"><span class=\"hljs-type\">Id</span>                               <span class=\"hljs-built_in\">int64</span><br><span class=\"hljs-type\">Address</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Sold</span> <span class=\"hljs-type\">Price</span>                      <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Sold</span> <span class=\"hljs-type\">On</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Summary</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Type</span>                            <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Year</span> built                      <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Heating</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Cooling</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Parking</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Bedrooms</span>                        <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Bathrooms</span>                      <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">Total</span> interior livable area     <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Total</span> spaces                   <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">Garage</span> spaces                  <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">Home</span> <span class=\"hljs-keyword\">type</span>                       <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Region</span>                          <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Elementary</span> <span class=\"hljs-type\">School</span>               <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Elementary</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Score</span>        <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">Elementary</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Distance</span>     <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">High</span> <span class=\"hljs-type\">School</span>                     <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">High</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Score</span>              <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">High</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Distance</span>           <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">Heating</span> features                <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Parking</span> features                <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Lot</span> size                        <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Parcel</span> number                   <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Tax</span> assessed value              <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Annual</span> tax amount               <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Listed</span> <span class=\"hljs-type\">On</span>                       <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Listed</span> <span class=\"hljs-type\">Price</span>                    <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Zip</span>                              <span class=\"hljs-built_in\">int64</span><br>dtype: <span class=\"hljs-keyword\">object</span><br></code></pre></td></tr></tbody></table></figure>\n</blockquote>\n<h4 id=\"修改数据类型\">修改数据类型</h4>\n<p>金额为object这是不合常理的</p>\n<p>Convert currency from string format such as <code>$1,000,000</code> to float.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">currency = [<span class=\"hljs-string\">'Sold Price'</span>, <span class=\"hljs-string\">'Listed Price'</span>, <span class=\"hljs-string\">'Tax assessed value'</span>, <span class=\"hljs-string\">'Annual tax amount'</span>]<br><span class=\"hljs-comment\"># r'[$,-]' r的作用是：去除转义字符，replace可以用正则形式</span><br><span class=\"hljs-keyword\">for</span> c <span class=\"hljs-keyword\">in</span> currency:<br>    data[c] = data[c].replace(<br>        <span class=\"hljs-string\">r'[$,-]'</span>, <span class=\"hljs-string\">''</span>, regex=<span class=\"hljs-literal\">True</span>).replace( <br>        <span class=\"hljs-string\">r'^\\s*$'</span>, np.nan, regex=<span class=\"hljs-literal\">True</span>).astype(<span class=\"hljs-built_in\">float</span>)<br></code></pre></td></tr></tbody></table></figure>\n<p>Convert currency from string format such as <code>$1,000,000</code> to float.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">areas = [<span class=\"hljs-string\">'Total interior livable area'</span>, <span class=\"hljs-string\">'Lot size'</span>]<br><span class=\"hljs-keyword\">for</span> c <span class=\"hljs-keyword\">in</span> areas:<br>    acres = data[c].<span class=\"hljs-built_in\">str</span>.contains(<span class=\"hljs-string\">'Acres'</span>) == <span class=\"hljs-literal\">True</span><br>    col = data[c].replace(<span class=\"hljs-string\">r'\\b sqft\\b|\\b Acres\\b|\\b,\\b'</span>,<span class=\"hljs-string\">''</span>, regex=<span class=\"hljs-literal\">True</span>).astype(<span class=\"hljs-built_in\">float</span>)<br>    col[acres] *= <span class=\"hljs-number\">43560</span><br>    data[c] = col<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>tips 😉</p>\n<p>字符串前加f，r，b，u</p>\n<p>加f作用：相当于 format() 函数f“{变量名}”</p>\n<p>加r的作用是：去除转义字符； 场景：想复制某个文件夹的目录。</p>\n<p>加b的作用是：后面字符串是bytes 类型bytes；应用场景：像图片、音视频等文件的读写就是用bytes数据。</p>\n<p>加u的作用：后面字符串以 Unicode 格式 进行编码；实际场景：一般用在中文字符串前面，防止因为源码储存格式问题，导致再次使用时出现乱码。</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#Now we can check values of the numerical columns. You could see the min and max values for several columns do not make sense.</span><br>data.describe()<br></code></pre></td></tr></tbody></table></figure>\n<p>可以查看一些不太正常的字段。。。</p>\n<h4 id=\"数据清理数值\">数据清理数值</h4>\n<p>We filter out houses whose living areas are too small or too hard to simplify the visualization later.</p>\n<blockquote>\n<p>| &amp; 和 or and</p>\n<p>DataFrame中切片需要求得满足多个逻辑条件的数据时，要使用&amp; 和|，在某些条件下用and/ or会报错</p>\n<p>一般情况下：</p>\n<ul>\n<li>\n<p><strong>如果a，b是数值变量</strong>， 则&amp;， |表示<a href=\"https://so.csdn.net/so/search?q=%E4%BD%8D%E8%BF%90%E7%AE%97\">位运算</a>， and，or则依据是否非0来决定输出</p>\n</li>\n<li>\n<p><strong>如何a, b是逻辑变量</strong>， 则两类的用法基本一致</p>\n</li>\n</ul>\n</blockquote>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">abnormal = (data[areas[<span class=\"hljs-number\">1</span>]] &lt; <span class=\"hljs-number\">10</span>) | (data[areas[<span class=\"hljs-number\">1</span>]] &gt; <span class=\"hljs-number\">1e4</span>) <span class=\"hljs-comment\">#不正常的数据</span><br>data = data[~abnormal] <span class=\"hljs-comment\">#使用~来求反</span><br><span class=\"hljs-built_in\">sum</span>(abnormal)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"查看价格类别图像\">查看价格类别图像</h4>\n<p>Let’s check the histogram of the <code>'Sold Price'</code>, which is the target we want to predict.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">ax = sns.histplot(np.log10(data[<span class=\"hljs-string\">'Sold Price'</span>])) <span class=\"hljs-comment\">#直方图绘制 取log10 这样分布更加均匀</span><br>ax.set_xlim([<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">8</span>])<br>ax.set_xticks(<span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">9</span>))<br>ax.set_xticklabels([<span class=\"hljs-string\">'%.0e'</span>%a <span class=\"hljs-keyword\">for</span> a <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">10</span>**ax.get_xticks()]);<br><span class=\"hljs-comment\">#前面的可能有租房噪音</span><br></code></pre></td></tr></tbody></table></figure>\n<p><img src=\"https://picture.mulindya.com/pML2-1.png\" alt=\"\"></p>\n<p>A house has different types. Here are the top types:</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">data[<span class=\"hljs-string\">'Type'</span>].value_counts()[<span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">20</span>] <span class=\"hljs-comment\">#value_counts对应值的个数</span><br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<figure class=\"highlight yaml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-string\">SingleFamily</span>            <span class=\"hljs-number\">74318</span><br><span class=\"hljs-string\">Condo</span>                   <span class=\"hljs-number\">18749</span><br><span class=\"hljs-string\">MultiFamily</span>              <span class=\"hljs-number\">6586</span><br><span class=\"hljs-string\">VacantLand</span>               <span class=\"hljs-number\">6199</span><br><span class=\"hljs-string\">Townhouse</span>                <span class=\"hljs-number\">5846</span><br><span class=\"hljs-string\">Unknown</span>                  <span class=\"hljs-number\">5390</span><br><span class=\"hljs-string\">MobileManufactured</span>       <span class=\"hljs-number\">2588</span><br><span class=\"hljs-string\">Apartment</span>                <span class=\"hljs-number\">1416</span><br><span class=\"hljs-string\">Cooperative</span>               <span class=\"hljs-number\">161</span><br><span class=\"hljs-string\">Residential</span> <span class=\"hljs-string\">Lot</span>            <span class=\"hljs-number\">75</span><br><span class=\"hljs-string\">Single</span> <span class=\"hljs-string\">Family</span>              <span class=\"hljs-number\">69</span><br><span class=\"hljs-string\">Single</span> <span class=\"hljs-string\">Family</span> <span class=\"hljs-string\">Lot</span>          <span class=\"hljs-number\">56</span><br><span class=\"hljs-string\">Acreage</span>                    <span class=\"hljs-number\">48</span><br><span class=\"hljs-number\">2</span> <span class=\"hljs-string\">Story</span>                    <span class=\"hljs-number\">39</span><br><span class=\"hljs-number\">3</span> <span class=\"hljs-string\">Story</span>                    <span class=\"hljs-number\">25</span><br><span class=\"hljs-string\">Hi-Rise</span> <span class=\"hljs-string\">(9+),</span> <span class=\"hljs-string\">Luxury</span>       <span class=\"hljs-number\">21</span><br><span class=\"hljs-string\">RESIDENTIAL</span>                <span class=\"hljs-number\">19</span><br><span class=\"hljs-string\">Condominium</span>                <span class=\"hljs-number\">19</span><br><span class=\"hljs-string\">Duplex</span>                     <span class=\"hljs-number\">19</span><br><span class=\"hljs-string\">Mid-Rise</span> <span class=\"hljs-string\">(4-8)</span>             <span class=\"hljs-number\">17</span><br><span class=\"hljs-attr\">Name:</span> <span class=\"hljs-string\">Type,</span> <span class=\"hljs-attr\">dtype:</span> <span class=\"hljs-string\">int64</span><br><span class=\"hljs-string\">下面的一些均为噪音</span><br></code></pre></td></tr></tbody></table></figure>\n</blockquote>\n<p>Price density for different house types.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">types = data[<span class=\"hljs-string\">'Type'</span>].isin([<span class=\"hljs-string\">'SingleFamily'</span>, <span class=\"hljs-string\">'Condo'</span>, <span class=\"hljs-string\">'MultiFamily'</span>, <span class=\"hljs-string\">'Townhouse'</span>])<br>sns.displot(pd.DataFrame({<span class=\"hljs-string\">'Sold Price'</span>:np.log10(data[types][<span class=\"hljs-string\">'Sold Price'</span>]),<br>                          <span class=\"hljs-string\">'Type'</span>:data[types][<span class=\"hljs-string\">'Type'</span>]}),<br>            x=<span class=\"hljs-string\">'Sold Price'</span>, hue=<span class=\"hljs-string\">'Type'</span>, kind=<span class=\"hljs-string\">'kde'</span>); <span class=\"hljs-comment\">#kde是密度分布，hue指定线颜色按照Type分类</span><br></code></pre></td></tr></tbody></table></figure>\n<p><img src=\"https://picture.mulindya.com/pML2-2.png\" alt=\"\"></p>\n<p>Another important measurement is the sale price per living sqft. Let’s check the differences between different house types.</p>\n<p><code>boxplot</code>中间横线表示均值，箱型图上四分和下四分，还有max和min值；适合用于表示分布的对比</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">data[<span class=\"hljs-string\">'Price per living sqft'</span>] = data[<span class=\"hljs-string\">'Sold Price'</span>] / data[<span class=\"hljs-string\">'Total interior livable area'</span>] <span class=\"hljs-comment\">#每平米价格</span><br>ax = sns.boxplot(x=<span class=\"hljs-string\">'Type'</span>, y=<span class=\"hljs-string\">'Price per living sqft'</span>, data=data[types], fliersize=<span class=\"hljs-number\">0</span>)<br>ax.set_ylim([<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">2000</span>]);<br></code></pre></td></tr></tbody></table></figure>\n<p><img src=\"https://picture.mulindya.com/pML2-3.png\" alt=\"\"></p>\n<p>We know the location affect the price. Let’s check the price for the top 20 zip codes.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">d = data[data[<span class=\"hljs-string\">'Zip'</span>].isin(data[<span class=\"hljs-string\">'Zip'</span>].value_counts()[:<span class=\"hljs-number\">20</span>].keys())]<br>ax = sns.boxplot(x=<span class=\"hljs-string\">'Zip'</span>, y=<span class=\"hljs-string\">'Price per living sqft'</span>, data=d, fliersize=<span class=\"hljs-number\">0</span>)<br>ax.set_ylim([<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">2000</span>])<br>ax.set_xticklabels(ax.get_xticklabels(), rotation=<span class=\"hljs-number\">90</span>);<br></code></pre></td></tr></tbody></table></figure>\n<p><img src=\"https://picture.mulindya.com/pML2-4.png\" alt=\"\"></p>\n<h3 id=\"查看协方差\">查看协方差</h3>\n<p>Last, we visualize the correlation matrix of several columns.</p>\n<p><code>挑选某些列分布计算计算协方差使用corr()</code>可以查看关联度</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">_, ax = plt.subplots(figsize=(<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">4</span>))<br>columns = [<span class=\"hljs-string\">'Sold Price'</span>, <span class=\"hljs-string\">'Listed Price'</span>, <span class=\"hljs-string\">'Annual tax amount'</span>, <span class=\"hljs-string\">'Price per living sqft'</span>]<br>sns.heatmap(data[columns].corr(),annot=<span class=\"hljs-literal\">True</span>,cmap=<span class=\"hljs-string\">'RdYlGn'</span>, ax=ax);<br><span class=\"hljs-comment\">#使用热力图绘制</span><br></code></pre></td></tr></tbody></table></figure>\n<p><img src=\"https://picture.mulindya.com/pML2-5.png\" alt=\"\"></p>\n<h2 id=\"Summary\">Summary</h2>\n<p>This notebook demonstrates the basic technologies for EDA, including</p>\n<ul>\n<li>Understanding column data types, values, and distributions</li>\n<li>Understanding the interactions between columns</li>\n</ul>\n<p>We only explored a small aspect of the data. You are welcome to dive deep into more details.</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>斯坦福2021秋季的实用机器学习上线啦~ 😉 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。</p>\n</blockquote>\n<blockquote>\n<p>本篇笔记主要是实例分析，还有一些小知识点</p>\n<ol>\n<li>字符串前加f，r，b，u</li>\n<li>| &amp; 和 or and</li>\n</ol>\n</blockquote>\n<h1>房价数据分析实例</h1>\n<p>使用<code>numpy，pandas，matplotlib，seaborn</code>来处理和可视化。</p>\n<h2 id=\"实例（波士顿房价）\">实例（波士顿房价）</h2>\n<h3 id=\"读取\">读取</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># !pip install seaborn pandas matplotlib numpy</span><br><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd<br><span class=\"hljs-keyword\">import</span> matplotlib.pyplot <span class=\"hljs-keyword\">as</span> plt<br><span class=\"hljs-keyword\">import</span> seaborn <span class=\"hljs-keyword\">as</span> sns<br><br><span class=\"hljs-comment\">#绘图画质更好</span><br><span class=\"hljs-keyword\">from</span> IPython <span class=\"hljs-keyword\">import</span> display<br>display.set_matplotlib_formats(<span class=\"hljs-string\">&#x27;svg&#x27;</span>)<br><span class=\"hljs-comment\"># Alternative to set svg for newer versions</span><br><span class=\"hljs-comment\"># import matplotlib_inline</span><br><span class=\"hljs-comment\"># matplotlib_inline.backend_inline.set_matplotlib_formats(&#x27;svg&#x27;)</span><br></code></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">data = pd.read_csv(<span class=\"hljs-string\">&#x27;house_sales.zip&#x27;</span>) <span class=\"hljs-comment\">#可以直接用csv格式读取zip文件</span><br><span class=\"hljs-comment\">#对于文本会快很多</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"数据清理\">数据清理</h3>\n<p>We drop columns that at least 30% values are null to simplify our EDA.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#缺失数据</span><br>null_sum = data.isnull().<span class=\"hljs-built_in\">sum</span>() <span class=\"hljs-comment\">#缺失数据个数 为空的个数 是一个键值对</span><br>data.columns[null_sum &lt; <span class=\"hljs-built_in\">len</span>(data) * <span class=\"hljs-number\">0.3</span>]  <span class=\"hljs-comment\"># columns will keep #键值对 返回值满足条件的键</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<figure class=\"highlight sml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sml\"><span class=\"hljs-type\">Index</span>([<span class=\"hljs-symbol\">&#x27;Id&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Address&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Sold</span> <span class=\"hljs-type\">Price&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Sold</span> <span class=\"hljs-type\">On&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Summary&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Type&#x27;</span>,<br>       <span class=\"hljs-symbol\">&#x27;Year</span> built&#x27;, <span class=\"hljs-symbol\">&#x27;Heating&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Cooling&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Parking&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Bedrooms&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Bathrooms&#x27;</span>,<br>       <span class=\"hljs-symbol\">&#x27;Total</span> interior livable area&#x27;, <span class=\"hljs-symbol\">&#x27;Total</span> spaces&#x27;, <span class=\"hljs-symbol\">&#x27;Garage</span> spaces&#x27;,<br>       <span class=\"hljs-symbol\">&#x27;Home</span> type&#x27;, <span class=\"hljs-symbol\">&#x27;Region&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Elementary</span> <span class=\"hljs-type\">School&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Elementary</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Score&#x27;</span>,<br>       <span class=\"hljs-symbol\">&#x27;Elementary</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Distance&#x27;</span>, <span class=\"hljs-symbol\">&#x27;High</span> <span class=\"hljs-type\">School&#x27;</span>, <span class=\"hljs-symbol\">&#x27;High</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Score&#x27;</span>,<br>       <span class=\"hljs-symbol\">&#x27;High</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Distance&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Heating</span> features&#x27;, <span class=\"hljs-symbol\">&#x27;Parking</span> features&#x27;,<br>       <span class=\"hljs-symbol\">&#x27;Lot</span> size&#x27;, <span class=\"hljs-symbol\">&#x27;Parcel</span> number&#x27;, <span class=\"hljs-symbol\">&#x27;Tax</span> assessed value&#x27;, <span class=\"hljs-symbol\">&#x27;Annual</span> tax amount&#x27;,<br>       <span class=\"hljs-symbol\">&#x27;Listed</span> <span class=\"hljs-type\">On&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Listed</span> <span class=\"hljs-type\">Price&#x27;</span>, <span class=\"hljs-symbol\">&#x27;Zip&#x27;</span>],<br>      dtype=<span class=\"hljs-symbol\">&#x27;object&#x27;</span>)<br></code></pre></td></tr></table></figure>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">data.drop(columns=data.columns[null_sum &gt; <span class=\"hljs-built_in\">len</span>(data) * <span class=\"hljs-number\">0.3</span>], inplace=<span class=\"hljs-literal\">True</span>) <span class=\"hljs-comment\">#inplace直接修改</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"核对数据类型\">核对数据类型</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">data.dtypes <span class=\"hljs-comment\">#核对数据类型</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<figure class=\"highlight nim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nim\"><span class=\"hljs-type\">Id</span>                               <span class=\"hljs-built_in\">int64</span><br><span class=\"hljs-type\">Address</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Sold</span> <span class=\"hljs-type\">Price</span>                      <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Sold</span> <span class=\"hljs-type\">On</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Summary</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Type</span>                            <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Year</span> built                      <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Heating</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Cooling</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Parking</span>                         <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Bedrooms</span>                        <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Bathrooms</span>                      <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">Total</span> interior livable area     <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Total</span> spaces                   <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">Garage</span> spaces                  <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">Home</span> <span class=\"hljs-keyword\">type</span>                       <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Region</span>                          <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Elementary</span> <span class=\"hljs-type\">School</span>               <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Elementary</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Score</span>        <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">Elementary</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Distance</span>     <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">High</span> <span class=\"hljs-type\">School</span>                     <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">High</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Score</span>              <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">High</span> <span class=\"hljs-type\">School</span> <span class=\"hljs-type\">Distance</span>           <span class=\"hljs-built_in\">float64</span><br><span class=\"hljs-type\">Heating</span> features                <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Parking</span> features                <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Lot</span> size                        <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Parcel</span> number                   <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Tax</span> assessed value              <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Annual</span> tax amount               <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Listed</span> <span class=\"hljs-type\">On</span>                       <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Listed</span> <span class=\"hljs-type\">Price</span>                    <span class=\"hljs-keyword\">object</span><br><span class=\"hljs-type\">Zip</span>                              <span class=\"hljs-built_in\">int64</span><br>dtype: <span class=\"hljs-keyword\">object</span><br></code></pre></td></tr></table></figure>\n</blockquote>\n<h4 id=\"修改数据类型\">修改数据类型</h4>\n<p>金额为object这是不合常理的</p>\n<p>Convert currency from string format such as <code>$1,000,000</code> to float.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">currency = [<span class=\"hljs-string\">&#x27;Sold Price&#x27;</span>, <span class=\"hljs-string\">&#x27;Listed Price&#x27;</span>, <span class=\"hljs-string\">&#x27;Tax assessed value&#x27;</span>, <span class=\"hljs-string\">&#x27;Annual tax amount&#x27;</span>]<br><span class=\"hljs-comment\"># r&#x27;[$,-]&#x27; r的作用是：去除转义字符，replace可以用正则形式</span><br><span class=\"hljs-keyword\">for</span> c <span class=\"hljs-keyword\">in</span> currency:<br>    data[c] = data[c].replace(<br>        <span class=\"hljs-string\">r&#x27;[$,-]&#x27;</span>, <span class=\"hljs-string\">&#x27;&#x27;</span>, regex=<span class=\"hljs-literal\">True</span>).replace( <br>        <span class=\"hljs-string\">r&#x27;^\\s*$&#x27;</span>, np.nan, regex=<span class=\"hljs-literal\">True</span>).astype(<span class=\"hljs-built_in\">float</span>)<br></code></pre></td></tr></table></figure>\n<p>Convert currency from string format such as <code>$1,000,000</code> to float.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">areas = [<span class=\"hljs-string\">&#x27;Total interior livable area&#x27;</span>, <span class=\"hljs-string\">&#x27;Lot size&#x27;</span>]<br><span class=\"hljs-keyword\">for</span> c <span class=\"hljs-keyword\">in</span> areas:<br>    acres = data[c].<span class=\"hljs-built_in\">str</span>.contains(<span class=\"hljs-string\">&#x27;Acres&#x27;</span>) == <span class=\"hljs-literal\">True</span><br>    col = data[c].replace(<span class=\"hljs-string\">r&#x27;\\b sqft\\b|\\b Acres\\b|\\b,\\b&#x27;</span>,<span class=\"hljs-string\">&#x27;&#x27;</span>, regex=<span class=\"hljs-literal\">True</span>).astype(<span class=\"hljs-built_in\">float</span>)<br>    col[acres] *= <span class=\"hljs-number\">43560</span><br>    data[c] = col<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>tips 😉</p>\n<p>字符串前加f，r，b，u</p>\n<p>加f作用：相当于 format() 函数f“{变量名}”</p>\n<p>加r的作用是：去除转义字符； 场景：想复制某个文件夹的目录。</p>\n<p>加b的作用是：后面字符串是bytes 类型bytes；应用场景：像图片、音视频等文件的读写就是用bytes数据。</p>\n<p>加u的作用：后面字符串以 Unicode 格式 进行编码；实际场景：一般用在中文字符串前面，防止因为源码储存格式问题，导致再次使用时出现乱码。</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#Now we can check values of the numerical columns. You could see the min and max values for several columns do not make sense.</span><br>data.describe()<br></code></pre></td></tr></table></figure>\n<p>可以查看一些不太正常的字段。。。</p>\n<h4 id=\"数据清理数值\">数据清理数值</h4>\n<p>We filter out houses whose living areas are too small or too hard to simplify the visualization later.</p>\n<blockquote>\n<p>| &amp; 和 or and</p>\n<p>DataFrame中切片需要求得满足多个逻辑条件的数据时，要使用&amp; 和|，在某些条件下用and/ or会报错</p>\n<p>一般情况下：</p>\n<ul>\n<li>\n<p><strong>如果a，b是数值变量</strong>， 则&amp;， |表示<a href=\"https://so.csdn.net/so/search?q=%E4%BD%8D%E8%BF%90%E7%AE%97\">位运算</a>， and，or则依据是否非0来决定输出</p>\n</li>\n<li>\n<p><strong>如何a, b是逻辑变量</strong>， 则两类的用法基本一致</p>\n</li>\n</ul>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">abnormal = (data[areas[<span class=\"hljs-number\">1</span>]] &lt; <span class=\"hljs-number\">10</span>) | (data[areas[<span class=\"hljs-number\">1</span>]] &gt; <span class=\"hljs-number\">1e4</span>) <span class=\"hljs-comment\">#不正常的数据</span><br>data = data[~abnormal] <span class=\"hljs-comment\">#使用~来求反</span><br><span class=\"hljs-built_in\">sum</span>(abnormal)<br></code></pre></td></tr></table></figure>\n<h4 id=\"查看价格类别图像\">查看价格类别图像</h4>\n<p>Let’s check the histogram of the <code>'Sold Price'</code>, which is the target we want to predict.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">ax = sns.histplot(np.log10(data[<span class=\"hljs-string\">&#x27;Sold Price&#x27;</span>])) <span class=\"hljs-comment\">#直方图绘制 取log10 这样分布更加均匀</span><br>ax.set_xlim([<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">8</span>])<br>ax.set_xticks(<span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">9</span>))<br>ax.set_xticklabels([<span class=\"hljs-string\">&#x27;%.0e&#x27;</span>%a <span class=\"hljs-keyword\">for</span> a <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">10</span>**ax.get_xticks()]);<br><span class=\"hljs-comment\">#前面的可能有租房噪音</span><br></code></pre></td></tr></table></figure>\n<p><img src=\"https://picture.mulindya.com/pML2-1.png\" alt=\"\"></p>\n<p>A house has different types. Here are the top types:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">data[<span class=\"hljs-string\">&#x27;Type&#x27;</span>].value_counts()[<span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">20</span>] <span class=\"hljs-comment\">#value_counts对应值的个数</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-string\">SingleFamily</span>            <span class=\"hljs-number\">74318</span><br><span class=\"hljs-string\">Condo</span>                   <span class=\"hljs-number\">18749</span><br><span class=\"hljs-string\">MultiFamily</span>              <span class=\"hljs-number\">6586</span><br><span class=\"hljs-string\">VacantLand</span>               <span class=\"hljs-number\">6199</span><br><span class=\"hljs-string\">Townhouse</span>                <span class=\"hljs-number\">5846</span><br><span class=\"hljs-string\">Unknown</span>                  <span class=\"hljs-number\">5390</span><br><span class=\"hljs-string\">MobileManufactured</span>       <span class=\"hljs-number\">2588</span><br><span class=\"hljs-string\">Apartment</span>                <span class=\"hljs-number\">1416</span><br><span class=\"hljs-string\">Cooperative</span>               <span class=\"hljs-number\">161</span><br><span class=\"hljs-string\">Residential</span> <span class=\"hljs-string\">Lot</span>            <span class=\"hljs-number\">75</span><br><span class=\"hljs-string\">Single</span> <span class=\"hljs-string\">Family</span>              <span class=\"hljs-number\">69</span><br><span class=\"hljs-string\">Single</span> <span class=\"hljs-string\">Family</span> <span class=\"hljs-string\">Lot</span>          <span class=\"hljs-number\">56</span><br><span class=\"hljs-string\">Acreage</span>                    <span class=\"hljs-number\">48</span><br><span class=\"hljs-number\">2</span> <span class=\"hljs-string\">Story</span>                    <span class=\"hljs-number\">39</span><br><span class=\"hljs-number\">3</span> <span class=\"hljs-string\">Story</span>                    <span class=\"hljs-number\">25</span><br><span class=\"hljs-string\">Hi-Rise</span> <span class=\"hljs-string\">(9+),</span> <span class=\"hljs-string\">Luxury</span>       <span class=\"hljs-number\">21</span><br><span class=\"hljs-string\">RESIDENTIAL</span>                <span class=\"hljs-number\">19</span><br><span class=\"hljs-string\">Condominium</span>                <span class=\"hljs-number\">19</span><br><span class=\"hljs-string\">Duplex</span>                     <span class=\"hljs-number\">19</span><br><span class=\"hljs-string\">Mid-Rise</span> <span class=\"hljs-string\">(4-8)</span>             <span class=\"hljs-number\">17</span><br><span class=\"hljs-attr\">Name:</span> <span class=\"hljs-string\">Type,</span> <span class=\"hljs-attr\">dtype:</span> <span class=\"hljs-string\">int64</span><br><span class=\"hljs-string\">下面的一些均为噪音</span><br></code></pre></td></tr></table></figure>\n</blockquote>\n<p>Price density for different house types.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">types = data[<span class=\"hljs-string\">&#x27;Type&#x27;</span>].isin([<span class=\"hljs-string\">&#x27;SingleFamily&#x27;</span>, <span class=\"hljs-string\">&#x27;Condo&#x27;</span>, <span class=\"hljs-string\">&#x27;MultiFamily&#x27;</span>, <span class=\"hljs-string\">&#x27;Townhouse&#x27;</span>])<br>sns.displot(pd.DataFrame(&#123;<span class=\"hljs-string\">&#x27;Sold Price&#x27;</span>:np.log10(data[types][<span class=\"hljs-string\">&#x27;Sold Price&#x27;</span>]),<br>                          <span class=\"hljs-string\">&#x27;Type&#x27;</span>:data[types][<span class=\"hljs-string\">&#x27;Type&#x27;</span>]&#125;),<br>            x=<span class=\"hljs-string\">&#x27;Sold Price&#x27;</span>, hue=<span class=\"hljs-string\">&#x27;Type&#x27;</span>, kind=<span class=\"hljs-string\">&#x27;kde&#x27;</span>); <span class=\"hljs-comment\">#kde是密度分布，hue指定线颜色按照Type分类</span><br></code></pre></td></tr></table></figure>\n<p><img src=\"https://picture.mulindya.com/pML2-2.png\" alt=\"\"></p>\n<p>Another important measurement is the sale price per living sqft. Let’s check the differences between different house types.</p>\n<p><code>boxplot</code>中间横线表示均值，箱型图上四分和下四分，还有max和min值；适合用于表示分布的对比</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">data[<span class=\"hljs-string\">&#x27;Price per living sqft&#x27;</span>] = data[<span class=\"hljs-string\">&#x27;Sold Price&#x27;</span>] / data[<span class=\"hljs-string\">&#x27;Total interior livable area&#x27;</span>] <span class=\"hljs-comment\">#每平米价格</span><br>ax = sns.boxplot(x=<span class=\"hljs-string\">&#x27;Type&#x27;</span>, y=<span class=\"hljs-string\">&#x27;Price per living sqft&#x27;</span>, data=data[types], fliersize=<span class=\"hljs-number\">0</span>)<br>ax.set_ylim([<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">2000</span>]);<br></code></pre></td></tr></table></figure>\n<p><img src=\"https://picture.mulindya.com/pML2-3.png\" alt=\"\"></p>\n<p>We know the location affect the price. Let’s check the price for the top 20 zip codes.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">d = data[data[<span class=\"hljs-string\">&#x27;Zip&#x27;</span>].isin(data[<span class=\"hljs-string\">&#x27;Zip&#x27;</span>].value_counts()[:<span class=\"hljs-number\">20</span>].keys())]<br>ax = sns.boxplot(x=<span class=\"hljs-string\">&#x27;Zip&#x27;</span>, y=<span class=\"hljs-string\">&#x27;Price per living sqft&#x27;</span>, data=d, fliersize=<span class=\"hljs-number\">0</span>)<br>ax.set_ylim([<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">2000</span>])<br>ax.set_xticklabels(ax.get_xticklabels(), rotation=<span class=\"hljs-number\">90</span>);<br></code></pre></td></tr></table></figure>\n<p><img src=\"https://picture.mulindya.com/pML2-4.png\" alt=\"\"></p>\n<h3 id=\"查看协方差\">查看协方差</h3>\n<p>Last, we visualize the correlation matrix of several columns.</p>\n<p><code>挑选某些列分布计算计算协方差使用corr()</code>可以查看关联度</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">_, ax = plt.subplots(figsize=(<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">4</span>))<br>columns = [<span class=\"hljs-string\">&#x27;Sold Price&#x27;</span>, <span class=\"hljs-string\">&#x27;Listed Price&#x27;</span>, <span class=\"hljs-string\">&#x27;Annual tax amount&#x27;</span>, <span class=\"hljs-string\">&#x27;Price per living sqft&#x27;</span>]<br>sns.heatmap(data[columns].corr(),annot=<span class=\"hljs-literal\">True</span>,cmap=<span class=\"hljs-string\">&#x27;RdYlGn&#x27;</span>, ax=ax);<br><span class=\"hljs-comment\">#使用热力图绘制</span><br></code></pre></td></tr></table></figure>\n<p><img src=\"https://picture.mulindya.com/pML2-5.png\" alt=\"\"></p>\n<h2 id=\"Summary\">Summary</h2>\n<p>This notebook demonstrates the basic technologies for EDA, including</p>\n<ul>\n<li>Understanding column data types, values, and distributions</li>\n<li>Understanding the interactions between columns</li>\n</ul>\n<p>We only explored a small aspect of the data. You are welcome to dive deep into more details.</p>\n"},{"title":"praticalML第二章笔记","date":"2022-01-02T09:52:57.000Z","_content":"\n> 斯坦福2021秋季的实用机器学习上线啦~ :wink: 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。\n\n# 第二章 提升数据质量\n\n> - 噪声多？\n>\n> - yes ->数据清理\n>\n> - no？ 格式对吗？\n>\n> - No ->数据变换\n> - yes 适合学习嘛？\n> - No ->特征提取\n\n## 2.1 数据清理\n\n### 2.1.1 outlier检测（异常）\n\n![](https://picture.mulindya.com/pML2-6.png)\n\n### 2.1.2 基于规则的检测\n\n比如已知x决定y，但是出现了x->z那么z是一个异常情况。\n\n### 2.1.3 基于模式的检测\n\n-  Syntactic patterns  （语法模式）\n\n  比如说大多数都是数字，少数是￥+数字，那么可以转换这些少数的字段为数字\n\n  • e.g. Map a column to the most prominent data type and identify values do not fit \n  • eng, en, english -> English \n\n-  Semantic patterns （语义模式）\n  • e.g. Add rules through knowledge graph \n  • Values in column “Country” need have capitals, so a value “Stanford” is invalid、\n\n### 2.1.4 总结\n\n-  Types of data errors: outliers, rule violations, pattern violations \n-  Multiple tools exist to help data cleaning \n  • Graphic interface for interactive cleaning \n  • Automatically detect and fix\n\n> 现在也有很多数据清理的工具，有图形化界面，也可以自动分析处理。\n\n## 2.2 数据变换\n\n**机器学习的流程：数据收集-数据标注-数据变换-特征工程-模型构建及训练**\n\n• ML algorithms prefer well defined fixed length, well-conditioned, nicely distributed input \n• Next, data transformation methods for different data types\n\n![](https://picture.mulindya.com/pML2-7.png)\n\n### 2.2.1 对实数归一化（Normalization）\n\n• Normalization makes training more stable\n\n![](https://picture.mulindya.com/pML2-8.png)\n\n- Min-max normalization: linearly map to a new min a and max b也就是通过线性变换把数值变换到a到b之间，先通过min，max的变换到0-1之间然后进行扩增和移动。\n- Z-score normalization: 0 mean, 1 standard deviation 其目的是将分布变为均值为0方差为1，减去均值除以标准差。\n- Decimal scaling 将数字转换为0.XX (到0-1)\n- Log scaling 原始数据比较大（正数）时可以变换到log'空间'，在log中的加减是原始数据的乘除，所以比值类的数据可以变换到这种形式\n\n### 2.2.2 图像变换\n\n-  Our previous web scraping will scrape 15 TB images for a year  \n  • 5 millions houses sold in US per year, ~20 images/house, ~153KB per image, ~1041x732 resolution \n\n- cropping, downsampling, compression \n  • Save storage cost, faster loading at training \n       • At ~320x224 resolution, 15 TB -> 1.4TB \n  • ML is good at low-resolution images \n  • Be aware of lossy compression \n       • Medium (80%-90%) jpeg compression may lead to 1% acc drop in ImageNet\n\n- Image whitening（数据白化 可以理解为降维）\n  •make input less redundent\n  •model converages faster\n\n机器学习对于低分辨的图片可以做的挺好的。所以剪裁，下采样是可以接受的。**但是要注意下采样之后要使用较高质量的图片格式不要用jpeg。**   \n\n白化的目的是去除输入数据的冗余信息。假设训练数据是图像，由于图像中相邻像素之间具有很强的相关性，所以用于训练时输入是冗余的；白化的目的就是降低输入的冗余性。白化分为PCA白化、ZCA白化.\n输入数据集X，经过白化处理后，新的数据X'满足两个性质：\n(1)特征之间相关性较低；\n(2)所有特征具有相同的方差。\n\n### 2.2.3 视频变换\n\n-  Input variability high  \n  • Average video length: Movies ~2h, YouTube videos ~11min, Tiktok short videos ~15sec \n-  Tractable ML problems with short video clips (<10sec)  \n  • Ideally each clip is a coherent event (e.g. a human action) \n  • Semantic segmentation is extremely hard.. \n-  Preprocessing to tradeoff storage, quality and loading speed \n-  Common practice: decode a playable video clip, sample a sequence of  frames, compute spectrograms for audio \n  • Easy to load to model, increased storage space\n\n采样关键的帧，图片不需要所有的信息，使用gpu来采样，需要权衡存储和解码。\n\n### 2.2.3 文本变换\n\n-  Stemming and lemmatization: a word ->  a common base form \n  • E.g. am, are, is   -> be        car, cars, car's, cars'  ->  car \n  • Example: Topic modeling \n-  Tokenization: text string  a list of tokens (smallest unit to ML algorithms) \n  • By word: text.split(' ') \n  • By char: text.split(‘') \n  • By subwords:  \n      • e.g. “a new gpu!”   “a”, “new”, “gp”, “##u”, “!”  \n      • Custom vocabulary learned from the text corpus  (Unigram, WordPiece)\n\n方法是忽略语法，词根化，词源化，子词。\n\n### 2.2.4 总结\n\n主要是格式的转换，需要权衡数据大小，数据质量，存储的方式。\n\n- •Transform data into formats preferred by ML algorithms \n  • Tabular: normalize real value features \n  • Images: cropping, downsampling, whitening \n  • Videos: clipping, sampling frames \n  • Text: stemming, lemmatization, tokenization \n-  Need to balance storage, quality, and loading speed\n\n## 2.3 特征工程\n\n-  Before deep learning (DL), feature engineering (FE) was critical to using ML models \n  • Traditional CV: detect corners / interest points.. \n\n- DL train deep neural networks to automatically extract features  \n  • Train CNN to replace feature extractor \n  • Features are more relevant to the final task \n  • Limitation: data hungry, computation heavy\n\n![](https://picture.mulindya.com/pML2-9.png)\n\n深度学习出现之前主要是研究特征工程抽取特征；\n\n深度学习没有改变流程但是现在并不是手动的过程，现在是自动抽取特征。\n\n### 2.3.1 Tabular Data Features\n\n- Tabular data are in the form of a table,  feature columns of numeric / categorical / string type \n-  Int/float: directly use or or bin to   unique int values \n-  Categorical data: one-hot encoding （独热编码）\n  • Map rare categories into “Unknown” \n-  Date-time: a feature list such as  日期特征\n  • [year, month, day, day_of_year, week_of_year, day_of_week] \n-  Feature combination: Cartesian product of two feature groups  特征组合\n  • [cat, dog] x [male, female] ->  [(cat, male), (cat, female), (dog, male), (dog, female)]\n\n### 2.3.2 文本特征\n\n将词源的独热编码加起来\n\n词表示为向量来表示语义信息\n\n使用预训练好的语言模型来特定表示（通过自监督学习来训练，可以抽取时序信息）\n\n![](https://picture.mulindya.com/pML2-10.png)\n\n### 2.3.3 图像/视频特征\n\n预训练的模型来抽取特征\n\n![](https://picture.mulindya.com/pML2-11.png)\n\n### 2.3.4 总结\n\n-  Features are representations of raw data that are relevant to the target task \n- Feature engineering VS Feature learning \n  • The latter is preferred if available (images/videos/audio/text) \n  • Will cover more later in “transfer learning”\n","source":"_posts/学习笔记/实用机器学习/PracticeML2-2.md","raw":"---\ntitle: praticalML第二章笔记\ntags: [李沐,机器学习]\ncategories: [学习笔记,机器学习]\ndate: 2022-01-02 17:52:57\n---\n\n> 斯坦福2021秋季的实用机器学习上线啦~ :wink: 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。\n\n# 第二章 提升数据质量\n\n> - 噪声多？\n>\n> - yes ->数据清理\n>\n> - no？ 格式对吗？\n>\n> - No ->数据变换\n> - yes 适合学习嘛？\n> - No ->特征提取\n\n## 2.1 数据清理\n\n### 2.1.1 outlier检测（异常）\n\n![](https://picture.mulindya.com/pML2-6.png)\n\n### 2.1.2 基于规则的检测\n\n比如已知x决定y，但是出现了x->z那么z是一个异常情况。\n\n### 2.1.3 基于模式的检测\n\n-  Syntactic patterns  （语法模式）\n\n  比如说大多数都是数字，少数是￥+数字，那么可以转换这些少数的字段为数字\n\n  • e.g. Map a column to the most prominent data type and identify values do not fit \n  • eng, en, english -> English \n\n-  Semantic patterns （语义模式）\n  • e.g. Add rules through knowledge graph \n  • Values in column “Country” need have capitals, so a value “Stanford” is invalid、\n\n### 2.1.4 总结\n\n-  Types of data errors: outliers, rule violations, pattern violations \n-  Multiple tools exist to help data cleaning \n  • Graphic interface for interactive cleaning \n  • Automatically detect and fix\n\n> 现在也有很多数据清理的工具，有图形化界面，也可以自动分析处理。\n\n## 2.2 数据变换\n\n**机器学习的流程：数据收集-数据标注-数据变换-特征工程-模型构建及训练**\n\n• ML algorithms prefer well defined fixed length, well-conditioned, nicely distributed input \n• Next, data transformation methods for different data types\n\n![](https://picture.mulindya.com/pML2-7.png)\n\n### 2.2.1 对实数归一化（Normalization）\n\n• Normalization makes training more stable\n\n![](https://picture.mulindya.com/pML2-8.png)\n\n- Min-max normalization: linearly map to a new min a and max b也就是通过线性变换把数值变换到a到b之间，先通过min，max的变换到0-1之间然后进行扩增和移动。\n- Z-score normalization: 0 mean, 1 standard deviation 其目的是将分布变为均值为0方差为1，减去均值除以标准差。\n- Decimal scaling 将数字转换为0.XX (到0-1)\n- Log scaling 原始数据比较大（正数）时可以变换到log'空间'，在log中的加减是原始数据的乘除，所以比值类的数据可以变换到这种形式\n\n### 2.2.2 图像变换\n\n-  Our previous web scraping will scrape 15 TB images for a year  \n  • 5 millions houses sold in US per year, ~20 images/house, ~153KB per image, ~1041x732 resolution \n\n- cropping, downsampling, compression \n  • Save storage cost, faster loading at training \n       • At ~320x224 resolution, 15 TB -> 1.4TB \n  • ML is good at low-resolution images \n  • Be aware of lossy compression \n       • Medium (80%-90%) jpeg compression may lead to 1% acc drop in ImageNet\n\n- Image whitening（数据白化 可以理解为降维）\n  •make input less redundent\n  •model converages faster\n\n机器学习对于低分辨的图片可以做的挺好的。所以剪裁，下采样是可以接受的。**但是要注意下采样之后要使用较高质量的图片格式不要用jpeg。**   \n\n白化的目的是去除输入数据的冗余信息。假设训练数据是图像，由于图像中相邻像素之间具有很强的相关性，所以用于训练时输入是冗余的；白化的目的就是降低输入的冗余性。白化分为PCA白化、ZCA白化.\n输入数据集X，经过白化处理后，新的数据X'满足两个性质：\n(1)特征之间相关性较低；\n(2)所有特征具有相同的方差。\n\n### 2.2.3 视频变换\n\n-  Input variability high  \n  • Average video length: Movies ~2h, YouTube videos ~11min, Tiktok short videos ~15sec \n-  Tractable ML problems with short video clips (<10sec)  \n  • Ideally each clip is a coherent event (e.g. a human action) \n  • Semantic segmentation is extremely hard.. \n-  Preprocessing to tradeoff storage, quality and loading speed \n-  Common practice: decode a playable video clip, sample a sequence of  frames, compute spectrograms for audio \n  • Easy to load to model, increased storage space\n\n采样关键的帧，图片不需要所有的信息，使用gpu来采样，需要权衡存储和解码。\n\n### 2.2.3 文本变换\n\n-  Stemming and lemmatization: a word ->  a common base form \n  • E.g. am, are, is   -> be        car, cars, car's, cars'  ->  car \n  • Example: Topic modeling \n-  Tokenization: text string  a list of tokens (smallest unit to ML algorithms) \n  • By word: text.split(' ') \n  • By char: text.split(‘') \n  • By subwords:  \n      • e.g. “a new gpu!”   “a”, “new”, “gp”, “##u”, “!”  \n      • Custom vocabulary learned from the text corpus  (Unigram, WordPiece)\n\n方法是忽略语法，词根化，词源化，子词。\n\n### 2.2.4 总结\n\n主要是格式的转换，需要权衡数据大小，数据质量，存储的方式。\n\n- •Transform data into formats preferred by ML algorithms \n  • Tabular: normalize real value features \n  • Images: cropping, downsampling, whitening \n  • Videos: clipping, sampling frames \n  • Text: stemming, lemmatization, tokenization \n-  Need to balance storage, quality, and loading speed\n\n## 2.3 特征工程\n\n-  Before deep learning (DL), feature engineering (FE) was critical to using ML models \n  • Traditional CV: detect corners / interest points.. \n\n- DL train deep neural networks to automatically extract features  \n  • Train CNN to replace feature extractor \n  • Features are more relevant to the final task \n  • Limitation: data hungry, computation heavy\n\n![](https://picture.mulindya.com/pML2-9.png)\n\n深度学习出现之前主要是研究特征工程抽取特征；\n\n深度学习没有改变流程但是现在并不是手动的过程，现在是自动抽取特征。\n\n### 2.3.1 Tabular Data Features\n\n- Tabular data are in the form of a table,  feature columns of numeric / categorical / string type \n-  Int/float: directly use or or bin to   unique int values \n-  Categorical data: one-hot encoding （独热编码）\n  • Map rare categories into “Unknown” \n-  Date-time: a feature list such as  日期特征\n  • [year, month, day, day_of_year, week_of_year, day_of_week] \n-  Feature combination: Cartesian product of two feature groups  特征组合\n  • [cat, dog] x [male, female] ->  [(cat, male), (cat, female), (dog, male), (dog, female)]\n\n### 2.3.2 文本特征\n\n将词源的独热编码加起来\n\n词表示为向量来表示语义信息\n\n使用预训练好的语言模型来特定表示（通过自监督学习来训练，可以抽取时序信息）\n\n![](https://picture.mulindya.com/pML2-10.png)\n\n### 2.3.3 图像/视频特征\n\n预训练的模型来抽取特征\n\n![](https://picture.mulindya.com/pML2-11.png)\n\n### 2.3.4 总结\n\n-  Features are representations of raw data that are relevant to the target task \n- Feature engineering VS Feature learning \n  • The latter is preferred if available (images/videos/audio/text) \n  • Will cover more later in “transfer learning”\n","slug":"学习笔记/实用机器学习/PracticeML2-2","published":1,"updated":"2022-01-18T08:10:17.117Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0cs007rast99s04gtis","content":"<blockquote>\n<p>斯坦福2021秋季的实用机器学习上线啦~ 😉 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。</p>\n</blockquote>\n<h1>第二章 提升数据质量</h1>\n<blockquote>\n<ul>\n<li>\n<p>噪声多？</p>\n</li>\n<li>\n<p>yes -&gt;数据清理</p>\n</li>\n<li>\n<p>no？ 格式对吗？</p>\n</li>\n<li>\n<p>No -&gt;数据变换</p>\n</li>\n<li>\n<p>yes 适合学习嘛？</p>\n</li>\n<li>\n<p>No -&gt;特征提取</p>\n</li>\n</ul>\n</blockquote>\n<h2 id=\"2-1-数据清理\">2.1 数据清理</h2>\n<h3 id=\"2-1-1-outlier检测（异常）\">2.1.1 outlier检测（异常）</h3>\n<p><img src=\"https://picture.mulindya.com/pML2-6.png\" alt=\"\"></p>\n<h3 id=\"2-1-2-基于规则的检测\">2.1.2 基于规则的检测</h3>\n<p>比如已知x决定y，但是出现了x-&gt;z那么z是一个异常情况。</p>\n<h3 id=\"2-1-3-基于模式的检测\">2.1.3 基于模式的检测</h3>\n<ul>\n<li>Syntactic patterns  （语法模式）</li>\n</ul>\n<p>比如说大多数都是数字，少数是￥+数字，那么可以转换这些少数的字段为数字</p>\n<p>• e.g. Map a column to the most prominent data type and identify values do not fit<br>\n• eng, en, english -&gt; English</p>\n<ul>\n<li>Semantic patterns （语义模式）<br>\n• e.g. Add rules through knowledge graph<br>\n• Values in column “Country” need have capitals, so a value “Stanford” is invalid、</li>\n</ul>\n<h3 id=\"2-1-4-总结\">2.1.4 总结</h3>\n<ul>\n<li>Types of data errors: outliers, rule violations, pattern violations</li>\n<li>Multiple tools exist to help data cleaning<br>\n• Graphic interface for interactive cleaning<br>\n• Automatically detect and fix</li>\n</ul>\n<blockquote>\n<p>现在也有很多数据清理的工具，有图形化界面，也可以自动分析处理。</p>\n</blockquote>\n<h2 id=\"2-2-数据变换\">2.2 数据变换</h2>\n<p><strong>机器学习的流程：数据收集-数据标注-数据变换-特征工程-模型构建及训练</strong></p>\n<p>• ML algorithms prefer well defined fixed length, well-conditioned, nicely distributed input<br>\n• Next, data transformation methods for different data types</p>\n<p><img src=\"https://picture.mulindya.com/pML2-7.png\" alt=\"\"></p>\n<h3 id=\"2-2-1-对实数归一化（Normalization）\">2.2.1 对实数归一化（Normalization）</h3>\n<p>• Normalization makes training more stable</p>\n<p><img src=\"https://picture.mulindya.com/pML2-8.png\" alt=\"\"></p>\n<ul>\n<li>Min-max normalization: linearly map to a new min a and max b也就是通过线性变换把数值变换到a到b之间，先通过min，max的变换到0-1之间然后进行扩增和移动。</li>\n<li>Z-score normalization: 0 mean, 1 standard deviation 其目的是将分布变为均值为0方差为1，减去均值除以标准差。</li>\n<li>Decimal scaling 将数字转换为0.XX (到0-1)</li>\n<li>Log scaling 原始数据比较大（正数）时可以变换到log’空间’，在log中的加减是原始数据的乘除，所以比值类的数据可以变换到这种形式</li>\n</ul>\n<h3 id=\"2-2-2-图像变换\">2.2.2 图像变换</h3>\n<ul>\n<li>\n<p>Our previous web scraping will scrape 15 TB images for a year<br>\n• 5 millions houses sold in US per year, ~20 images/house, ~153KB per image, ~1041x732 resolution</p>\n</li>\n<li>\n<p>cropping, downsampling, compression<br>\n• Save storage cost, faster loading at training<br>\n• At ~320x224 resolution, 15 TB -&gt; 1.4TB<br>\n• ML is good at low-resolution images<br>\n• Be aware of lossy compression<br>\n• Medium (80%-90%) jpeg compression may lead to 1% acc drop in ImageNet</p>\n</li>\n<li>\n<p>Image whitening（数据白化 可以理解为降维）<br>\n•make input less redundent<br>\n•model converages faster</p>\n</li>\n</ul>\n<p>机器学习对于低分辨的图片可以做的挺好的。所以剪裁，下采样是可以接受的。<strong>但是要注意下采样之后要使用较高质量的图片格式不要用jpeg。</strong></p>\n<p>白化的目的是去除输入数据的冗余信息。假设训练数据是图像，由于图像中相邻像素之间具有很强的相关性，所以用于训练时输入是冗余的；白化的目的就是降低输入的冗余性。白化分为PCA白化、ZCA白化.<br>\n输入数据集X，经过白化处理后，新的数据X’满足两个性质：<br>\n(1)特征之间相关性较低；<br>\n(2)所有特征具有相同的方差。</p>\n<h3 id=\"2-2-3-视频变换\">2.2.3 视频变换</h3>\n<ul>\n<li>Input variability high<br>\n• Average video length: Movies ~2h, YouTube videos ~11min, Tiktok short videos ~15sec</li>\n<li>Tractable ML problems with short video clips (&lt;10sec)<br>\n• Ideally each clip is a coherent event (e.g. a human action)<br>\n• Semantic segmentation is extremely hard…</li>\n<li>Preprocessing to tradeoff storage, quality and loading speed</li>\n<li>Common practice: decode a playable video clip, sample a sequence of  frames, compute spectrograms for audio<br>\n• Easy to load to model, increased storage space</li>\n</ul>\n<p>采样关键的帧，图片不需要所有的信息，使用gpu来采样，需要权衡存储和解码。</p>\n<h3 id=\"2-2-3-文本变换\">2.2.3 文本变换</h3>\n<ul>\n<li>Stemming and lemmatization: a word -&gt;  a common base form<br>\n• E.g. am, are, is   -&gt; be        car, cars, car’s, cars’  -&gt;  car<br>\n• Example: Topic modeling</li>\n<li>Tokenization: text string  a list of tokens (smallest unit to ML algorithms)<br>\n• By word: text.split(’ ‘)<br>\n• By char: text.split(‘’)<br>\n• By subwords:<br>\n• e.g. “a new gpu!”   “a”, “new”, “gp”, “##u”, “!”<br>\n• Custom vocabulary learned from the text corpus  (Unigram, WordPiece)</li>\n</ul>\n<p>方法是忽略语法，词根化，词源化，子词。</p>\n<h3 id=\"2-2-4-总结\">2.2.4 总结</h3>\n<p>主要是格式的转换，需要权衡数据大小，数据质量，存储的方式。</p>\n<ul>\n<li>•Transform data into formats preferred by ML algorithms<br>\n• Tabular: normalize real value features<br>\n• Images: cropping, downsampling, whitening<br>\n• Videos: clipping, sampling frames<br>\n• Text: stemming, lemmatization, tokenization</li>\n<li>Need to balance storage, quality, and loading speed</li>\n</ul>\n<h2 id=\"2-3-特征工程\">2.3 特征工程</h2>\n<ul>\n<li>\n<p>Before deep learning (DL), feature engineering (FE) was critical to using ML models<br>\n• Traditional CV: detect corners / interest points…</p>\n</li>\n<li>\n<p>DL train deep neural networks to automatically extract features<br>\n• Train CNN to replace feature extractor<br>\n• Features are more relevant to the final task<br>\n• Limitation: data hungry, computation heavy</p>\n</li>\n</ul>\n<p><img src=\"https://picture.mulindya.com/pML2-9.png\" alt=\"\"></p>\n<p>深度学习出现之前主要是研究特征工程抽取特征；</p>\n<p>深度学习没有改变流程但是现在并不是手动的过程，现在是自动抽取特征。</p>\n<h3 id=\"2-3-1-Tabular-Data-Features\">2.3.1 Tabular Data Features</h3>\n<ul>\n<li>Tabular data are in the form of a table,  feature columns of numeric / categorical / string type</li>\n<li>Int/float: directly use or or bin to   unique int values</li>\n<li>Categorical data: one-hot encoding （独热编码）<br>\n• Map rare categories into “Unknown”</li>\n<li>Date-time: a feature list such as  日期特征<br>\n• [year, month, day, day_of_year, week_of_year, day_of_week]</li>\n<li>Feature combination: Cartesian product of two feature groups  特征组合<br>\n• [cat, dog] x [male, female] -&gt;  [(cat, male), (cat, female), (dog, male), (dog, female)]</li>\n</ul>\n<h3 id=\"2-3-2-文本特征\">2.3.2 文本特征</h3>\n<p>将词源的独热编码加起来</p>\n<p>词表示为向量来表示语义信息</p>\n<p>使用预训练好的语言模型来特定表示（通过自监督学习来训练，可以抽取时序信息）</p>\n<p><img src=\"https://picture.mulindya.com/pML2-10.png\" alt=\"\"></p>\n<h3 id=\"2-3-3-图像-视频特征\">2.3.3 图像/视频特征</h3>\n<p>预训练的模型来抽取特征</p>\n<p><img src=\"https://picture.mulindya.com/pML2-11.png\" alt=\"\"></p>\n<h3 id=\"2-3-4-总结\">2.3.4 总结</h3>\n<ul>\n<li>Features are representations of raw data that are relevant to the target task</li>\n<li>Feature engineering VS Feature learning<br>\n• The latter is preferred if available (images/videos/audio/text)<br>\n• Will cover more later in “transfer learning”</li>\n</ul>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>斯坦福2021秋季的实用机器学习上线啦~ 😉 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。</p>\n</blockquote>\n<h1>第二章 提升数据质量</h1>\n<blockquote>\n<ul>\n<li>\n<p>噪声多？</p>\n</li>\n<li>\n<p>yes -&gt;数据清理</p>\n</li>\n<li>\n<p>no？ 格式对吗？</p>\n</li>\n<li>\n<p>No -&gt;数据变换</p>\n</li>\n<li>\n<p>yes 适合学习嘛？</p>\n</li>\n<li>\n<p>No -&gt;特征提取</p>\n</li>\n</ul>\n</blockquote>\n<h2 id=\"2-1-数据清理\">2.1 数据清理</h2>\n<h3 id=\"2-1-1-outlier检测（异常）\">2.1.1 outlier检测（异常）</h3>\n<p><img src=\"https://picture.mulindya.com/pML2-6.png\" alt=\"\"></p>\n<h3 id=\"2-1-2-基于规则的检测\">2.1.2 基于规则的检测</h3>\n<p>比如已知x决定y，但是出现了x-&gt;z那么z是一个异常情况。</p>\n<h3 id=\"2-1-3-基于模式的检测\">2.1.3 基于模式的检测</h3>\n<ul>\n<li>Syntactic patterns  （语法模式）</li>\n</ul>\n<p>比如说大多数都是数字，少数是￥+数字，那么可以转换这些少数的字段为数字</p>\n<p>• e.g. Map a column to the most prominent data type and identify values do not fit<br>\n• eng, en, english -&gt; English</p>\n<ul>\n<li>Semantic patterns （语义模式）<br>\n• e.g. Add rules through knowledge graph<br>\n• Values in column “Country” need have capitals, so a value “Stanford” is invalid、</li>\n</ul>\n<h3 id=\"2-1-4-总结\">2.1.4 总结</h3>\n<ul>\n<li>Types of data errors: outliers, rule violations, pattern violations</li>\n<li>Multiple tools exist to help data cleaning<br>\n• Graphic interface for interactive cleaning<br>\n• Automatically detect and fix</li>\n</ul>\n<blockquote>\n<p>现在也有很多数据清理的工具，有图形化界面，也可以自动分析处理。</p>\n</blockquote>\n<h2 id=\"2-2-数据变换\">2.2 数据变换</h2>\n<p><strong>机器学习的流程：数据收集-数据标注-数据变换-特征工程-模型构建及训练</strong></p>\n<p>• ML algorithms prefer well defined fixed length, well-conditioned, nicely distributed input<br>\n• Next, data transformation methods for different data types</p>\n<p><img src=\"https://picture.mulindya.com/pML2-7.png\" alt=\"\"></p>\n<h3 id=\"2-2-1-对实数归一化（Normalization）\">2.2.1 对实数归一化（Normalization）</h3>\n<p>• Normalization makes training more stable</p>\n<p><img src=\"https://picture.mulindya.com/pML2-8.png\" alt=\"\"></p>\n<ul>\n<li>Min-max normalization: linearly map to a new min a and max b也就是通过线性变换把数值变换到a到b之间，先通过min，max的变换到0-1之间然后进行扩增和移动。</li>\n<li>Z-score normalization: 0 mean, 1 standard deviation 其目的是将分布变为均值为0方差为1，减去均值除以标准差。</li>\n<li>Decimal scaling 将数字转换为0.XX (到0-1)</li>\n<li>Log scaling 原始数据比较大（正数）时可以变换到log’空间’，在log中的加减是原始数据的乘除，所以比值类的数据可以变换到这种形式</li>\n</ul>\n<h3 id=\"2-2-2-图像变换\">2.2.2 图像变换</h3>\n<ul>\n<li>\n<p>Our previous web scraping will scrape 15 TB images for a year<br>\n• 5 millions houses sold in US per year, ~20 images/house, ~153KB per image, ~1041x732 resolution</p>\n</li>\n<li>\n<p>cropping, downsampling, compression<br>\n• Save storage cost, faster loading at training<br>\n• At ~320x224 resolution, 15 TB -&gt; 1.4TB<br>\n• ML is good at low-resolution images<br>\n• Be aware of lossy compression<br>\n• Medium (80%-90%) jpeg compression may lead to 1% acc drop in ImageNet</p>\n</li>\n<li>\n<p>Image whitening（数据白化 可以理解为降维）<br>\n•make input less redundent<br>\n•model converages faster</p>\n</li>\n</ul>\n<p>机器学习对于低分辨的图片可以做的挺好的。所以剪裁，下采样是可以接受的。<strong>但是要注意下采样之后要使用较高质量的图片格式不要用jpeg。</strong></p>\n<p>白化的目的是去除输入数据的冗余信息。假设训练数据是图像，由于图像中相邻像素之间具有很强的相关性，所以用于训练时输入是冗余的；白化的目的就是降低输入的冗余性。白化分为PCA白化、ZCA白化.<br>\n输入数据集X，经过白化处理后，新的数据X’满足两个性质：<br>\n(1)特征之间相关性较低；<br>\n(2)所有特征具有相同的方差。</p>\n<h3 id=\"2-2-3-视频变换\">2.2.3 视频变换</h3>\n<ul>\n<li>Input variability high<br>\n• Average video length: Movies ~2h, YouTube videos ~11min, Tiktok short videos ~15sec</li>\n<li>Tractable ML problems with short video clips (&lt;10sec)<br>\n• Ideally each clip is a coherent event (e.g. a human action)<br>\n• Semantic segmentation is extremely hard…</li>\n<li>Preprocessing to tradeoff storage, quality and loading speed</li>\n<li>Common practice: decode a playable video clip, sample a sequence of  frames, compute spectrograms for audio<br>\n• Easy to load to model, increased storage space</li>\n</ul>\n<p>采样关键的帧，图片不需要所有的信息，使用gpu来采样，需要权衡存储和解码。</p>\n<h3 id=\"2-2-3-文本变换\">2.2.3 文本变换</h3>\n<ul>\n<li>Stemming and lemmatization: a word -&gt;  a common base form<br>\n• E.g. am, are, is   -&gt; be        car, cars, car’s, cars’  -&gt;  car<br>\n• Example: Topic modeling</li>\n<li>Tokenization: text string  a list of tokens (smallest unit to ML algorithms)<br>\n• By word: text.split(’ ‘)<br>\n• By char: text.split(‘’)<br>\n• By subwords:<br>\n• e.g. “a new gpu!”   “a”, “new”, “gp”, “##u”, “!”<br>\n• Custom vocabulary learned from the text corpus  (Unigram, WordPiece)</li>\n</ul>\n<p>方法是忽略语法，词根化，词源化，子词。</p>\n<h3 id=\"2-2-4-总结\">2.2.4 总结</h3>\n<p>主要是格式的转换，需要权衡数据大小，数据质量，存储的方式。</p>\n<ul>\n<li>•Transform data into formats preferred by ML algorithms<br>\n• Tabular: normalize real value features<br>\n• Images: cropping, downsampling, whitening<br>\n• Videos: clipping, sampling frames<br>\n• Text: stemming, lemmatization, tokenization</li>\n<li>Need to balance storage, quality, and loading speed</li>\n</ul>\n<h2 id=\"2-3-特征工程\">2.3 特征工程</h2>\n<ul>\n<li>\n<p>Before deep learning (DL), feature engineering (FE) was critical to using ML models<br>\n• Traditional CV: detect corners / interest points…</p>\n</li>\n<li>\n<p>DL train deep neural networks to automatically extract features<br>\n• Train CNN to replace feature extractor<br>\n• Features are more relevant to the final task<br>\n• Limitation: data hungry, computation heavy</p>\n</li>\n</ul>\n<p><img src=\"https://picture.mulindya.com/pML2-9.png\" alt=\"\"></p>\n<p>深度学习出现之前主要是研究特征工程抽取特征；</p>\n<p>深度学习没有改变流程但是现在并不是手动的过程，现在是自动抽取特征。</p>\n<h3 id=\"2-3-1-Tabular-Data-Features\">2.3.1 Tabular Data Features</h3>\n<ul>\n<li>Tabular data are in the form of a table,  feature columns of numeric / categorical / string type</li>\n<li>Int/float: directly use or or bin to   unique int values</li>\n<li>Categorical data: one-hot encoding （独热编码）<br>\n• Map rare categories into “Unknown”</li>\n<li>Date-time: a feature list such as  日期特征<br>\n• [year, month, day, day_of_year, week_of_year, day_of_week]</li>\n<li>Feature combination: Cartesian product of two feature groups  特征组合<br>\n• [cat, dog] x [male, female] -&gt;  [(cat, male), (cat, female), (dog, male), (dog, female)]</li>\n</ul>\n<h3 id=\"2-3-2-文本特征\">2.3.2 文本特征</h3>\n<p>将词源的独热编码加起来</p>\n<p>词表示为向量来表示语义信息</p>\n<p>使用预训练好的语言模型来特定表示（通过自监督学习来训练，可以抽取时序信息）</p>\n<p><img src=\"https://picture.mulindya.com/pML2-10.png\" alt=\"\"></p>\n<h3 id=\"2-3-3-图像-视频特征\">2.3.3 图像/视频特征</h3>\n<p>预训练的模型来抽取特征</p>\n<p><img src=\"https://picture.mulindya.com/pML2-11.png\" alt=\"\"></p>\n<h3 id=\"2-3-4-总结\">2.3.4 总结</h3>\n<ul>\n<li>Features are representations of raw data that are relevant to the target task</li>\n<li>Feature engineering VS Feature learning<br>\n• The latter is preferred if available (images/videos/audio/text)<br>\n• Will cover more later in “transfer learning”</li>\n</ul>\n"},{"title":"praticalML第三章笔记","date":"2022-01-10T06:27:22.000Z","math":true,"_content":"\n> 斯坦福2021秋季的实用机器学习上线啦~ :wink: 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。\n> 这一章的内容是对各种机器学习模型的介绍，包括有决策树，线性模型，多层感知机，卷积神经网络，循环神经网络。\n\n# 第三章 机器学习模型\n\n## 3.1 机器学习介绍:balloon:\n\n分类可以分成：\n\n1. 监督学习（Surprised）：有标号的数据上来训练模型来预测标号\n   - 衍生出现self-supervised 自监督学习：可以产生标号，只是其标号是来自数据本身（eg:word2vec,BERT）\n2. 半监督学习（Semi-superised）存在小部分有标号的数据，还有大部分没有标号的数据。\n   - eg：self-training 使用自训练的过程来预测标号再一起训练。\n3. 无监督学习（Unsuperised）在没有标号的数据上训练\n   - eg：clustering，density estimation（GAN）\n4. 强化学习（Reinforce）在一个环境中交互，并且基于观察点来学习，类似人类学习的方法。Use observations from the interaction with the environment to take actions to maximize reward。\n\n### 3.1.1 监督学习中的Components\n\n- Model（模型） 从输入中得到输出\n- Loss（损失函数）评估真实样本和预测结果的差距\n- Objective（目标函数对象）The goal to optimize model params for\n- Optimization（优化算法）he algorithm for solving the objective\n\n### 3.1.2 监督学习模型\n\n- **Decision trees**  • Use trees to make decisions \n- **Linear methods** • Decision is made from a linear combination of input features（做决策的输出是输入的线性组合） \n- **Kernel machines** • Use kernel functions to compute feature similarities  （核函数来衡量两个样本特征之间的相似度，指定不同的核函数，特征相似度不同，达到非线性的效果）\n- **Neural Networks** • Use neural networks to learn feature representations\n\n### 3.1.3 总结\n\n![](https://picture.mulindya.com/pML3-1.png)\n\n## 3.2 决策树 :palm_tree:\n\n包括有分类树，回归树（此时叶子节点不是类别而是实数值）\n\n##### 好处（pros）：\n\n- 可解释（可应用于银行业，保险业）；\n- 可以用于数值或类别特征；\n\n##### 缺点（cons）：\n\n- 鲁棒性差（可以用集成学习改善）；\n- 数据很复杂时可能产生过拟合（可以使用剪枝）；\n- 难以使用并行计算\n\n### 3.2.1 生成决策树\n\n![](https://picture.mulindya.com/pML3-2.png)\n\n### 3.2.2 随机森林\n\n训练多个决策树来增强并行性，分类时使用投票机制，回归时使用多个树的平均；对整个树的稳定性有好处。\n\n- Train multiple decision trees to improve robustness  \n  • Trees are trained independently in parallel   \n  • Majority voting for classification, average for regression \n-  Where is the randomness from? \n  • Bagging: randomly sample training examples with replacement  \n      • E.g. [1,2,3,4,5]   [1,2,2,3,4] \n  • Randomly select a subset of features \n\n这里的随机森林中的随机来自于两个方面哦~\n\n一个是Bagging，训练一棵树在训练集中随机采样一些样本出来（可重复采样），所以在训练集中会出现重复样本，继续重复训练其他树；\n\n另一个是对于获取的训练集是随机进行采样特征列（此时是无重复的特征列采样）；\n\n### 3.2.3 Gradient Boosting Decision Trees\n\n训练多棵树，但是这里不是独立完成决策，而是顺序的完成，利用这些树来合成一个大的模型出来，在t时刻 $ F_t(x) $ 表示是对前面训练的t-1棵树求和，训练的这颗树需要和所有的树的结果加起来，利用残差的思想训练$f_t(x)$（也就是“不准”的部分）\n\n同时这里的残差（$y_i-F_t(x_i)$）就等于梯度值($ -\\frac{\\alpha L}{\\alpha F} $)（使用均方误差作为loss）\n\n![](https://picture.mulindya.com/pML3-3.png)\n\n### 3.2.3 总结\n\n- Decision tree: an explainable model for classification/regression \n- Easy to train and tune, widely used in industry\n-  Sensitive to data \n  • Ensemble can help (more on bagging and boosting latter)\n\n决策树是一个为数不多的可解释性模型，对数据的噪音很敏感所以可以使用很多树一起训练来降低偏移和方差。可以用树模型时尽量用树模型哟。\n\n## 3.3 线性回归 :chart_with_upwards_trend:\n\n### 3.3.1 概念\n\n ![](https://picture.mulindya.com/pML3-4.png)\n\nx*w是按元素来做乘积得到还是一个向量（list）\n\n### 3.3.2 目标函数\n\n![](https://picture.mulindya.com/pML3-5.png)\n\n学习参数w，b；在所有样本中求均方误差，最小化MSE。\n\n### 3.3.3 使用线性回归来分类\n\n![](https://picture.mulindya.com/pML3-6.png)\n\n使用线性回归的二分类称为逻辑回归；\n\n这里类别数为m，真实标号y是one-hot向量，Oi也是一个长度为m的向量，Wi为矩阵形式，目标函数依然是最小化均方误差。类似没有隐藏层的”神经网络“。\n\n### 3.3.4 Softmax Regression\n\n![](https://picture.mulindya.com/pML3-7.png)\n\n这种方法的侧重点是最大化one-hot中正确样本的值，对其他样本点值置信度不会强制逼近为0。避免精力集中于one-hot中其他样本为0的拟合；首先把输出转化为概率分布的形式，这里虽然出现了非线性变换（使用softmax），但是此决策方法还是线性模型。\n\n此时比较两个概率分布，使用交叉熵来衡量向量的差别，只用关注真实类的值，让其越大越好。\n\n## 3.4 随机梯度下降 :chart_with_downwards_trend:\n\n![](https://picture.mulindya.com/pML3-8.png)\n\n求解最优解的方法可以使用随机梯度下降的方法，线性回归中的b是在输入的X中增加一行1,所以这里的b表示批量大小。\n$$\nO = W^TX+b \n$$\n在X中加一行全1数据\n$$\nO = W^TX\n$$\n可以解决除了决策树以外的其他算法（课内）的收敛，超参数是b和n；\n\n### 3.4.1 代码\n\n• Train a linear regression model with min-batch SGD \n• Hyperparameters \n\t• batch_size \n\t• learning_rate \n\t• num_epochs\n\n这里是输出一个结果值而非向量，因为这里是回归哟~   \n\n```python\n# `features` shape is (n, p),样本数 特征数 `labels` shape is (n, 1) \ndef data_iter(batch_size, features, labels): #小批量的读取\n    num_examples = len(features)  #样本数\n    indices = list(range(num_examples)) \n    random.shuffle(indices)  # read examples at random  随机采样\n    for i in range(0, num_examples, batch_size): \n        batch_indices = torch.tensor( \n            indices[i:min(i + batch_size, num_examples)]) \n        yield features[batch_indices], labels[batch_indices] #yield是一个反复的操作，会创建迭代器，可以用for来遍历\nw = torch.normal(0, 0.01, size=(p, 1), requires_grad=True) \nb = torch.zeros(1, requires_grad=True) \nfor epoch in range(num_epochs): \n    for X, y in data_iter(batch_size, features, labels): \n        y_hat = X @ w + b  #@是用来对tensor进行矩阵相乘的；*用来对tensor进行矩阵进行逐元素相乘；\n        loss = ((y_hat - y)**2 / 2).mean() #均方误差\n        loss.backward()  #求导\n        for param in [w, b]: # 对w，b更新\n            param -= learning_rate * param.grad   #梯度更新\n            param.grad.zero_()  #梯度清零\n```\n\n### 3.4.2 总结\n\n• Linear methods linearly combine inputs to obtain predictions \n• Linear regression uses MSE as the loss function \n• Softmax regression is used for multiclass classification \n\t• Turn predictions into probabilities and use cross-entropy as loss \n\t• Cross entropy loss between two probability distribution \n• Mini-batch SGD can learn both models (and later neural networks as well)\n\n## 3.5 神经网络 :pencil2:\n\n• NN usually requires more data and more computation \n• NN architectures to model data structures \n\t• Multilayer perceptions \n\t• Convolutional neural networks \n\t• Recurrent neural networks \n\t• Transformer\n• Design NN to incorporate prior knowledge about the data\n\n使用机器来提取特征比手动提取特征要好，但是需要更多的数据，可能数据集大了1000倍。\n\n### 3.5.1 多层感知机\n\n![](https://picture.mulindya.com/pML3-9.png)\n\n- 线性回归相当于是m=1的全连接层\n\n- Softmax回归是m为m的全连接层\n\n#### MLP\n\n通过激活函数来构建非线性模型\n\n- Activation is a elemental-wise non-linear function \n\n  eg:\n\n$$\nsigmoid(x) = \\frac{1}{1+e^{(-x)}}\n$$\n\n\n$$\nRelu(x) = max(x,0)\n$$\n​\t• It leads to non-linear models \n\n- Stack multiple hidden layers  (dense + activation) to get deeper models 堆叠隐藏层\n- Hyper-parameters: \n  \\# hidden layers, # outputs of each hidden layer \n-  Universal approximation theorem\n\n#### code\n\n• MLP with 1 hidden layer \n• Hyperparameter: num_hiddens \n\n一个隐藏层H 最后做一个线性映射输出。\n\n```python\ndef relu(X): \n    return torch.max(X, 0) \nW1 = nn.Parameter(torch.randn(num_inputs, num_hiddens) * 0.01) \nb1 = nn.Parameter(torch.zeros(num_hiddens)) \nW2 = nn.Parameter(torch.randn(num_hiddens, num_outputs) * 0.01) \nb2 = nn.Parameter(torch.zeros(num_outputs)) \nH = relu(X @ W1 + b1) \nY = H @ W2 + b2 \n```\n\n### 3.5.2 卷积神经网络\n\n#### 引入\n\n-  Learn ImageNet (300x300 images with 1K classes) by a MLP with a single hidden layer with 10K outputs  \n  • It leads to 1 billion learnable parameters, that’s too big! \n  • Fully connected: an output is a weighted sum over all inputs \n- Recognize objects in images \n  • **Translation invariance**: similar output  no matter where the object is \n  • **Locality**: pixels are more related to  near neighbors  \n-  Build the prior knowledge into the model structure \n  • Achieve same model capacity with less # params\n\n由于全连接层的参数量为m*n，纯用MLP参数量太大了，引用卷积层\n\n对于图像有两大特性\n\n1. 变换不变性：表示同一object在图像区域的变换对结果没有影响；\n2. 本地性：某一像素与附近的像素点的关联度较高，远处的关联度比较低；\n\n#### 具体机制\n\n![](https://picture.mulindya.com/pML3-10.png)\n\n- 本地性：卷积层的一个输出只是来源于k*k的一个像素块进行局部计算；\n\n- 平移（/变换）不变性：在一个feature map的channel上使用相同卷积核，权重共享，因为和位置无关。\n\n所以模型的参数量只与k有关，与输入输出的大小无关；卷积核通常是会被学习成去识别一个图像中的pattern。\n\n#### 代码\n\n单通道卷积的实现，k是kernel的权重，Y是最后的输出，其维度是X的宽高减去对应的k宽高再加1。\n\n```python\n# both input `X` and weight `K` are matrices \nh, w = K.shape \nY = torch.zeros((X.shape[0] - h + 1, X.shape[1] - w + 1)) \n# stride = 1 \nfor i in range(Y.shape[0]):   \n    for j in range(Y.shape[1]): \n        Y[i, j] = (X[i : i+h, j : j+w] * K).sum() #点乘再求和的计算称为交叉相关\n```\n\n#### Pooling Layer 汇聚层\n\n卷积层对输入的位置敏感，如果输入的object移动一个微小距离对应的输出也会出现移动，这样鲁棒性会降低，通过池化层（汇聚层）可以解决这个问题。\n\n每一次在K*K的窗口中使用平均汇聚或者最大汇聚，这样对K个像素的偏移就不会太大影响。\n\n- Convolution is sensitive to location  \n  \t• A translation/rotation of a pattern in the input results similar changes of a pattern in the output \n- A pooling layer computes mean/max in windows of size k × k\n\n```python\n# h, w: pooling window height and width \n# mode: max or avg \nY = torch.zeros((X.shape[0] - h + 1, X.shape[1] - w + 1)) \nfor i in range(Y.shape[0]): \n    for j in range(Y.shape[1]): \n        if mode == 'max': \n            Y[i, j] = X[i : i+h, j : j+w].max() \n        elif mode == 'avg': \n            Y[i, j] = X[i : i+h, j : j+w].mean()\n```\n\n#### 卷积神经网络\n\n-  Stacking convolution layers to extract features \n  • Activation is applied after each convolution layer \n  • Using pooling to reduce location sensitivity  \n- Modern CNNs are deep neural network with various hyper-parameters and layer connections (AlexNet, VGG, Inceptions, ResNet, MobileNet)\n\n卷积神经网络把卷积层堆叠起来，使用卷积层抽取空间信息，满足变换不变性和本地性的特征。激活层在卷积层之后，卷积层是一种特殊的全连接层（每次只看小窗口，其他权重为0），本质上还是线性变换，所以需要激活层来非线性化；同时使用汇聚层来降低卷积层对位置的敏感性。\n\n> lenet = nn.Sequential( \n>     nn.Conv2d(...), \n>     nn.Sigmoid(), \n>     nn.AvgPool2d(...), \n>     nn.Conv2d(), \n>     nn.Sigmoid(), \n>     nn.AvgPool2d(...), \n>     nn.Flatten(), \n>     nn.Linear(...), \n>     nn.Sigmoid(), \n>     nn.Linear(...), \n>     nn.Sigmoid(), \n>     nn.Linear(...))\n\n### 3.5.3 循环神经网络 \n\n语言模型中设计循环神经网络，通过前面的信息来预测当前信息，时间序列信息中通过前面几个项来预测后一个项。\n\n使用Dense时由前一个词作为输入预测当前词，当时无法获取时间序列信息，因为输入长度维度不可随意变化。所以这里需要对时序信息添加到输入中，也就是RNN，可以将前面的输出（隐藏层）添加进入当前层的输入。**注意这里的对每个词权重是一样的**（后续代码中也可以看到）。\n\n#### Dense与Recurrent networks\n\n![](https://picture.mulindya.com/pML3-11.png)\n\n#### RNN和变种\n\n![](https://picture.mulindya.com/pML3-12.png)\n\n注意隐藏层是经过激活层激活之后再输入，增加前向隐藏层。\n$$\nh_t = \\sigma(W_{hh}h_{t-1}+W_{hx}x_t+b_h)\n$$\n有些变种会涉及门来抑制某些信息比如LSTM，GRU，会对信息流进行细致的控制，比如对过去或者现在的信息采取遗忘、抑制，这种操作也是通过一组权重来学习决定是否对特定信息抑制。\n\n#### 代码\n\n实现简单的RNN。\n\n```python\nW_xh = nn.Parameter(torch.randn(num_inputs, num_hiddens) * 0.01) \nW_hh = nn.Parameter(torch.randn(num_hiddens, num_hiddens) * 0.01)  #多出来的\nb_h = nn.Parameter(torch.zeros(num_hiddens)) \nH = torch.zeros(num_hiddens) \noutputs = [] \n#把每个词放入作为输入\nfor X in inputs:  # `inputs` shape : (num_steps, batch_size, num_inputs)  num_steps表示一组输入 各个词\n    H = torch.tanh(X @ W_xh + H @ W_hh + b_h)  #对每个词其实权重是一样的，只是绘图的时候方便表示展开拉长\n    outputs.append(H)\n```\n\n#### Bi-RNN and Deep RNN\n\n![](https://picture.mulindya.com/pML3-13.png)\n\n可以从双向来检索，这样yt的信息来源是它两侧的信息，比如完形填空，是可以获取双向信息哦。\n\n#### 模型选择\n\n不同的模型使用与不同数据，表格数据使用一般树模型，线性模型，神经网络。Transformer对文本和图像都可以处理，实际上文本信息和图像信息有相似的内部特性，只是维度不一样而已。\n\n![](https://picture.mulindya.com/pML3-14.png)\n\n### 3.5.4 总结\n\n• MLP: stack dense layers with non-linear activations \n• CNN: stack convolution activation and pooling layers to efficient extract spatial information \n• RNN: stack recurrent layers to pass temporal information through hidden state\n\nCNN：高效抓取空间信息\n\nRNN：持续信息的数据，比如对时序信息。\n","source":"_posts/学习笔记/实用机器学习/PracticeML3.md","raw":"---\n\ntitle: praticalML第三章笔记\ntags: [李沐,机器学习] \ncategories: [ 学习笔记,机器学习]\ndate: 2022-01-10 14:27:22\nmath: True\n---\n\n> 斯坦福2021秋季的实用机器学习上线啦~ :wink: 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。\n> 这一章的内容是对各种机器学习模型的介绍，包括有决策树，线性模型，多层感知机，卷积神经网络，循环神经网络。\n\n# 第三章 机器学习模型\n\n## 3.1 机器学习介绍:balloon:\n\n分类可以分成：\n\n1. 监督学习（Surprised）：有标号的数据上来训练模型来预测标号\n   - 衍生出现self-supervised 自监督学习：可以产生标号，只是其标号是来自数据本身（eg:word2vec,BERT）\n2. 半监督学习（Semi-superised）存在小部分有标号的数据，还有大部分没有标号的数据。\n   - eg：self-training 使用自训练的过程来预测标号再一起训练。\n3. 无监督学习（Unsuperised）在没有标号的数据上训练\n   - eg：clustering，density estimation（GAN）\n4. 强化学习（Reinforce）在一个环境中交互，并且基于观察点来学习，类似人类学习的方法。Use observations from the interaction with the environment to take actions to maximize reward。\n\n### 3.1.1 监督学习中的Components\n\n- Model（模型） 从输入中得到输出\n- Loss（损失函数）评估真实样本和预测结果的差距\n- Objective（目标函数对象）The goal to optimize model params for\n- Optimization（优化算法）he algorithm for solving the objective\n\n### 3.1.2 监督学习模型\n\n- **Decision trees**  • Use trees to make decisions \n- **Linear methods** • Decision is made from a linear combination of input features（做决策的输出是输入的线性组合） \n- **Kernel machines** • Use kernel functions to compute feature similarities  （核函数来衡量两个样本特征之间的相似度，指定不同的核函数，特征相似度不同，达到非线性的效果）\n- **Neural Networks** • Use neural networks to learn feature representations\n\n### 3.1.3 总结\n\n![](https://picture.mulindya.com/pML3-1.png)\n\n## 3.2 决策树 :palm_tree:\n\n包括有分类树，回归树（此时叶子节点不是类别而是实数值）\n\n##### 好处（pros）：\n\n- 可解释（可应用于银行业，保险业）；\n- 可以用于数值或类别特征；\n\n##### 缺点（cons）：\n\n- 鲁棒性差（可以用集成学习改善）；\n- 数据很复杂时可能产生过拟合（可以使用剪枝）；\n- 难以使用并行计算\n\n### 3.2.1 生成决策树\n\n![](https://picture.mulindya.com/pML3-2.png)\n\n### 3.2.2 随机森林\n\n训练多个决策树来增强并行性，分类时使用投票机制，回归时使用多个树的平均；对整个树的稳定性有好处。\n\n- Train multiple decision trees to improve robustness  \n  • Trees are trained independently in parallel   \n  • Majority voting for classification, average for regression \n-  Where is the randomness from? \n  • Bagging: randomly sample training examples with replacement  \n      • E.g. [1,2,3,4,5]   [1,2,2,3,4] \n  • Randomly select a subset of features \n\n这里的随机森林中的随机来自于两个方面哦~\n\n一个是Bagging，训练一棵树在训练集中随机采样一些样本出来（可重复采样），所以在训练集中会出现重复样本，继续重复训练其他树；\n\n另一个是对于获取的训练集是随机进行采样特征列（此时是无重复的特征列采样）；\n\n### 3.2.3 Gradient Boosting Decision Trees\n\n训练多棵树，但是这里不是独立完成决策，而是顺序的完成，利用这些树来合成一个大的模型出来，在t时刻 $ F_t(x) $ 表示是对前面训练的t-1棵树求和，训练的这颗树需要和所有的树的结果加起来，利用残差的思想训练$f_t(x)$（也就是“不准”的部分）\n\n同时这里的残差（$y_i-F_t(x_i)$）就等于梯度值($ -\\frac{\\alpha L}{\\alpha F} $)（使用均方误差作为loss）\n\n![](https://picture.mulindya.com/pML3-3.png)\n\n### 3.2.3 总结\n\n- Decision tree: an explainable model for classification/regression \n- Easy to train and tune, widely used in industry\n-  Sensitive to data \n  • Ensemble can help (more on bagging and boosting latter)\n\n决策树是一个为数不多的可解释性模型，对数据的噪音很敏感所以可以使用很多树一起训练来降低偏移和方差。可以用树模型时尽量用树模型哟。\n\n## 3.3 线性回归 :chart_with_upwards_trend:\n\n### 3.3.1 概念\n\n ![](https://picture.mulindya.com/pML3-4.png)\n\nx*w是按元素来做乘积得到还是一个向量（list）\n\n### 3.3.2 目标函数\n\n![](https://picture.mulindya.com/pML3-5.png)\n\n学习参数w，b；在所有样本中求均方误差，最小化MSE。\n\n### 3.3.3 使用线性回归来分类\n\n![](https://picture.mulindya.com/pML3-6.png)\n\n使用线性回归的二分类称为逻辑回归；\n\n这里类别数为m，真实标号y是one-hot向量，Oi也是一个长度为m的向量，Wi为矩阵形式，目标函数依然是最小化均方误差。类似没有隐藏层的”神经网络“。\n\n### 3.3.4 Softmax Regression\n\n![](https://picture.mulindya.com/pML3-7.png)\n\n这种方法的侧重点是最大化one-hot中正确样本的值，对其他样本点值置信度不会强制逼近为0。避免精力集中于one-hot中其他样本为0的拟合；首先把输出转化为概率分布的形式，这里虽然出现了非线性变换（使用softmax），但是此决策方法还是线性模型。\n\n此时比较两个概率分布，使用交叉熵来衡量向量的差别，只用关注真实类的值，让其越大越好。\n\n## 3.4 随机梯度下降 :chart_with_downwards_trend:\n\n![](https://picture.mulindya.com/pML3-8.png)\n\n求解最优解的方法可以使用随机梯度下降的方法，线性回归中的b是在输入的X中增加一行1,所以这里的b表示批量大小。\n$$\nO = W^TX+b \n$$\n在X中加一行全1数据\n$$\nO = W^TX\n$$\n可以解决除了决策树以外的其他算法（课内）的收敛，超参数是b和n；\n\n### 3.4.1 代码\n\n• Train a linear regression model with min-batch SGD \n• Hyperparameters \n\t• batch_size \n\t• learning_rate \n\t• num_epochs\n\n这里是输出一个结果值而非向量，因为这里是回归哟~   \n\n```python\n# `features` shape is (n, p),样本数 特征数 `labels` shape is (n, 1) \ndef data_iter(batch_size, features, labels): #小批量的读取\n    num_examples = len(features)  #样本数\n    indices = list(range(num_examples)) \n    random.shuffle(indices)  # read examples at random  随机采样\n    for i in range(0, num_examples, batch_size): \n        batch_indices = torch.tensor( \n            indices[i:min(i + batch_size, num_examples)]) \n        yield features[batch_indices], labels[batch_indices] #yield是一个反复的操作，会创建迭代器，可以用for来遍历\nw = torch.normal(0, 0.01, size=(p, 1), requires_grad=True) \nb = torch.zeros(1, requires_grad=True) \nfor epoch in range(num_epochs): \n    for X, y in data_iter(batch_size, features, labels): \n        y_hat = X @ w + b  #@是用来对tensor进行矩阵相乘的；*用来对tensor进行矩阵进行逐元素相乘；\n        loss = ((y_hat - y)**2 / 2).mean() #均方误差\n        loss.backward()  #求导\n        for param in [w, b]: # 对w，b更新\n            param -= learning_rate * param.grad   #梯度更新\n            param.grad.zero_()  #梯度清零\n```\n\n### 3.4.2 总结\n\n• Linear methods linearly combine inputs to obtain predictions \n• Linear regression uses MSE as the loss function \n• Softmax regression is used for multiclass classification \n\t• Turn predictions into probabilities and use cross-entropy as loss \n\t• Cross entropy loss between two probability distribution \n• Mini-batch SGD can learn both models (and later neural networks as well)\n\n## 3.5 神经网络 :pencil2:\n\n• NN usually requires more data and more computation \n• NN architectures to model data structures \n\t• Multilayer perceptions \n\t• Convolutional neural networks \n\t• Recurrent neural networks \n\t• Transformer\n• Design NN to incorporate prior knowledge about the data\n\n使用机器来提取特征比手动提取特征要好，但是需要更多的数据，可能数据集大了1000倍。\n\n### 3.5.1 多层感知机\n\n![](https://picture.mulindya.com/pML3-9.png)\n\n- 线性回归相当于是m=1的全连接层\n\n- Softmax回归是m为m的全连接层\n\n#### MLP\n\n通过激活函数来构建非线性模型\n\n- Activation is a elemental-wise non-linear function \n\n  eg:\n\n$$\nsigmoid(x) = \\frac{1}{1+e^{(-x)}}\n$$\n\n\n$$\nRelu(x) = max(x,0)\n$$\n​\t• It leads to non-linear models \n\n- Stack multiple hidden layers  (dense + activation) to get deeper models 堆叠隐藏层\n- Hyper-parameters: \n  \\# hidden layers, # outputs of each hidden layer \n-  Universal approximation theorem\n\n#### code\n\n• MLP with 1 hidden layer \n• Hyperparameter: num_hiddens \n\n一个隐藏层H 最后做一个线性映射输出。\n\n```python\ndef relu(X): \n    return torch.max(X, 0) \nW1 = nn.Parameter(torch.randn(num_inputs, num_hiddens) * 0.01) \nb1 = nn.Parameter(torch.zeros(num_hiddens)) \nW2 = nn.Parameter(torch.randn(num_hiddens, num_outputs) * 0.01) \nb2 = nn.Parameter(torch.zeros(num_outputs)) \nH = relu(X @ W1 + b1) \nY = H @ W2 + b2 \n```\n\n### 3.5.2 卷积神经网络\n\n#### 引入\n\n-  Learn ImageNet (300x300 images with 1K classes) by a MLP with a single hidden layer with 10K outputs  \n  • It leads to 1 billion learnable parameters, that’s too big! \n  • Fully connected: an output is a weighted sum over all inputs \n- Recognize objects in images \n  • **Translation invariance**: similar output  no matter where the object is \n  • **Locality**: pixels are more related to  near neighbors  \n-  Build the prior knowledge into the model structure \n  • Achieve same model capacity with less # params\n\n由于全连接层的参数量为m*n，纯用MLP参数量太大了，引用卷积层\n\n对于图像有两大特性\n\n1. 变换不变性：表示同一object在图像区域的变换对结果没有影响；\n2. 本地性：某一像素与附近的像素点的关联度较高，远处的关联度比较低；\n\n#### 具体机制\n\n![](https://picture.mulindya.com/pML3-10.png)\n\n- 本地性：卷积层的一个输出只是来源于k*k的一个像素块进行局部计算；\n\n- 平移（/变换）不变性：在一个feature map的channel上使用相同卷积核，权重共享，因为和位置无关。\n\n所以模型的参数量只与k有关，与输入输出的大小无关；卷积核通常是会被学习成去识别一个图像中的pattern。\n\n#### 代码\n\n单通道卷积的实现，k是kernel的权重，Y是最后的输出，其维度是X的宽高减去对应的k宽高再加1。\n\n```python\n# both input `X` and weight `K` are matrices \nh, w = K.shape \nY = torch.zeros((X.shape[0] - h + 1, X.shape[1] - w + 1)) \n# stride = 1 \nfor i in range(Y.shape[0]):   \n    for j in range(Y.shape[1]): \n        Y[i, j] = (X[i : i+h, j : j+w] * K).sum() #点乘再求和的计算称为交叉相关\n```\n\n#### Pooling Layer 汇聚层\n\n卷积层对输入的位置敏感，如果输入的object移动一个微小距离对应的输出也会出现移动，这样鲁棒性会降低，通过池化层（汇聚层）可以解决这个问题。\n\n每一次在K*K的窗口中使用平均汇聚或者最大汇聚，这样对K个像素的偏移就不会太大影响。\n\n- Convolution is sensitive to location  \n  \t• A translation/rotation of a pattern in the input results similar changes of a pattern in the output \n- A pooling layer computes mean/max in windows of size k × k\n\n```python\n# h, w: pooling window height and width \n# mode: max or avg \nY = torch.zeros((X.shape[0] - h + 1, X.shape[1] - w + 1)) \nfor i in range(Y.shape[0]): \n    for j in range(Y.shape[1]): \n        if mode == 'max': \n            Y[i, j] = X[i : i+h, j : j+w].max() \n        elif mode == 'avg': \n            Y[i, j] = X[i : i+h, j : j+w].mean()\n```\n\n#### 卷积神经网络\n\n-  Stacking convolution layers to extract features \n  • Activation is applied after each convolution layer \n  • Using pooling to reduce location sensitivity  \n- Modern CNNs are deep neural network with various hyper-parameters and layer connections (AlexNet, VGG, Inceptions, ResNet, MobileNet)\n\n卷积神经网络把卷积层堆叠起来，使用卷积层抽取空间信息，满足变换不变性和本地性的特征。激活层在卷积层之后，卷积层是一种特殊的全连接层（每次只看小窗口，其他权重为0），本质上还是线性变换，所以需要激活层来非线性化；同时使用汇聚层来降低卷积层对位置的敏感性。\n\n> lenet = nn.Sequential( \n>     nn.Conv2d(...), \n>     nn.Sigmoid(), \n>     nn.AvgPool2d(...), \n>     nn.Conv2d(), \n>     nn.Sigmoid(), \n>     nn.AvgPool2d(...), \n>     nn.Flatten(), \n>     nn.Linear(...), \n>     nn.Sigmoid(), \n>     nn.Linear(...), \n>     nn.Sigmoid(), \n>     nn.Linear(...))\n\n### 3.5.3 循环神经网络 \n\n语言模型中设计循环神经网络，通过前面的信息来预测当前信息，时间序列信息中通过前面几个项来预测后一个项。\n\n使用Dense时由前一个词作为输入预测当前词，当时无法获取时间序列信息，因为输入长度维度不可随意变化。所以这里需要对时序信息添加到输入中，也就是RNN，可以将前面的输出（隐藏层）添加进入当前层的输入。**注意这里的对每个词权重是一样的**（后续代码中也可以看到）。\n\n#### Dense与Recurrent networks\n\n![](https://picture.mulindya.com/pML3-11.png)\n\n#### RNN和变种\n\n![](https://picture.mulindya.com/pML3-12.png)\n\n注意隐藏层是经过激活层激活之后再输入，增加前向隐藏层。\n$$\nh_t = \\sigma(W_{hh}h_{t-1}+W_{hx}x_t+b_h)\n$$\n有些变种会涉及门来抑制某些信息比如LSTM，GRU，会对信息流进行细致的控制，比如对过去或者现在的信息采取遗忘、抑制，这种操作也是通过一组权重来学习决定是否对特定信息抑制。\n\n#### 代码\n\n实现简单的RNN。\n\n```python\nW_xh = nn.Parameter(torch.randn(num_inputs, num_hiddens) * 0.01) \nW_hh = nn.Parameter(torch.randn(num_hiddens, num_hiddens) * 0.01)  #多出来的\nb_h = nn.Parameter(torch.zeros(num_hiddens)) \nH = torch.zeros(num_hiddens) \noutputs = [] \n#把每个词放入作为输入\nfor X in inputs:  # `inputs` shape : (num_steps, batch_size, num_inputs)  num_steps表示一组输入 各个词\n    H = torch.tanh(X @ W_xh + H @ W_hh + b_h)  #对每个词其实权重是一样的，只是绘图的时候方便表示展开拉长\n    outputs.append(H)\n```\n\n#### Bi-RNN and Deep RNN\n\n![](https://picture.mulindya.com/pML3-13.png)\n\n可以从双向来检索，这样yt的信息来源是它两侧的信息，比如完形填空，是可以获取双向信息哦。\n\n#### 模型选择\n\n不同的模型使用与不同数据，表格数据使用一般树模型，线性模型，神经网络。Transformer对文本和图像都可以处理，实际上文本信息和图像信息有相似的内部特性，只是维度不一样而已。\n\n![](https://picture.mulindya.com/pML3-14.png)\n\n### 3.5.4 总结\n\n• MLP: stack dense layers with non-linear activations \n• CNN: stack convolution activation and pooling layers to efficient extract spatial information \n• RNN: stack recurrent layers to pass temporal information through hidden state\n\nCNN：高效抓取空间信息\n\nRNN：持续信息的数据，比如对时序信息。\n","slug":"学习笔记/实用机器学习/PracticeML3","published":1,"updated":"2022-01-18T08:10:17.118Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ct007tast9c0c23e7b","content":"<blockquote>\n<p>斯坦福2021秋季的实用机器学习上线啦~ 😉 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。<br>\n这一章的内容是对各种机器学习模型的介绍，包括有决策树，线性模型，多层感知机，卷积神经网络，循环神经网络。</p>\n</blockquote>\n<h1>第三章 机器学习模型</h1>\n<h2 id=\"3-1-机器学习介绍🎈\">3.1 机器学习介绍🎈</h2>\n<p>分类可以分成：</p>\n<ol>\n<li>监督学习（Surprised）：有标号的数据上来训练模型来预测标号\n<ul>\n<li>衍生出现self-supervised 自监督学习：可以产生标号，只是其标号是来自数据本身（eg:word2vec,BERT）</li>\n</ul>\n</li>\n<li>半监督学习（Semi-superised）存在小部分有标号的数据，还有大部分没有标号的数据。\n<ul>\n<li>eg：self-training 使用自训练的过程来预测标号再一起训练。</li>\n</ul>\n</li>\n<li>无监督学习（Unsuperised）在没有标号的数据上训练\n<ul>\n<li>eg：clustering，density estimation（GAN）</li>\n</ul>\n</li>\n<li>强化学习（Reinforce）在一个环境中交互，并且基于观察点来学习，类似人类学习的方法。Use observations from the interaction with the environment to take actions to maximize reward。</li>\n</ol>\n<h3 id=\"3-1-1-监督学习中的Components\">3.1.1 监督学习中的Components</h3>\n<ul>\n<li>Model（模型） 从输入中得到输出</li>\n<li>Loss（损失函数）评估真实样本和预测结果的差距</li>\n<li>Objective（目标函数对象）The goal to optimize model params for</li>\n<li>Optimization（优化算法）he algorithm for solving the objective</li>\n</ul>\n<h3 id=\"3-1-2-监督学习模型\">3.1.2 监督学习模型</h3>\n<ul>\n<li><strong>Decision trees</strong>  • Use trees to make decisions</li>\n<li><strong>Linear methods</strong> • Decision is made from a linear combination of input features（做决策的输出是输入的线性组合）</li>\n<li><strong>Kernel machines</strong> • Use kernel functions to compute feature similarities  （核函数来衡量两个样本特征之间的相似度，指定不同的核函数，特征相似度不同，达到非线性的效果）</li>\n<li><strong>Neural Networks</strong> • Use neural networks to learn feature representations</li>\n</ul>\n<h3 id=\"3-1-3-总结\">3.1.3 总结</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-1.png\" alt=\"\"></p>\n<h2 id=\"3-2-决策树-🌴\">3.2 决策树 🌴</h2>\n<p>包括有分类树，回归树（此时叶子节点不是类别而是实数值）</p>\n<h5 id=\"好处（pros）：\">好处（pros）：</h5>\n<ul>\n<li>可解释（可应用于银行业，保险业）；</li>\n<li>可以用于数值或类别特征；</li>\n</ul>\n<h5 id=\"缺点（cons）：\">缺点（cons）：</h5>\n<ul>\n<li>鲁棒性差（可以用集成学习改善）；</li>\n<li>数据很复杂时可能产生过拟合（可以使用剪枝）；</li>\n<li>难以使用并行计算</li>\n</ul>\n<h3 id=\"3-2-1-生成决策树\">3.2.1 生成决策树</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-2.png\" alt=\"\"></p>\n<h3 id=\"3-2-2-随机森林\">3.2.2 随机森林</h3>\n<p>训练多个决策树来增强并行性，分类时使用投票机制，回归时使用多个树的平均；对整个树的稳定性有好处。</p>\n<ul>\n<li>Train multiple decision trees to improve robustness<br>\n• Trees are trained independently in parallel<br>\n• Majority voting for classification, average for regression</li>\n<li>Where is the randomness from?<br>\n• Bagging: randomly sample training examples with replacement<br>\n• E.g. [1,2,3,4,5]   [1,2,2,3,4]<br>\n• Randomly select a subset of features</li>\n</ul>\n<p>这里的随机森林中的随机来自于两个方面哦~</p>\n<p>一个是Bagging，训练一棵树在训练集中随机采样一些样本出来（可重复采样），所以在训练集中会出现重复样本，继续重复训练其他树；</p>\n<p>另一个是对于获取的训练集是随机进行采样特征列（此时是无重复的特征列采样）；</p>\n<h3 id=\"3-2-3-Gradient-Boosting-Decision-Trees\">3.2.3 Gradient Boosting Decision Trees</h3>\n<p>训练多棵树，但是这里不是独立完成决策，而是顺序的完成，利用这些树来合成一个大的模型出来，在t时刻 $ F_t(x) $ 表示是对前面训练的t-1棵树求和，训练的这颗树需要和所有的树的结果加起来，利用残差的思想训练$f_t(x)$（也就是“不准”的部分）</p>\n<p>同时这里的残差（$y_i-F_t(x_i)$）就等于梯度值($ -\\frac{\\alpha L}{\\alpha F} $)（使用均方误差作为loss）</p>\n<p><img src=\"https://picture.mulindya.com/pML3-3.png\" alt=\"\"></p>\n<h3 id=\"3-2-3-总结\">3.2.3 总结</h3>\n<ul>\n<li>Decision tree: an explainable model for classification/regression</li>\n<li>Easy to train and tune, widely used in industry</li>\n<li>Sensitive to data<br>\n• Ensemble can help (more on bagging and boosting latter)</li>\n</ul>\n<p>决策树是一个为数不多的可解释性模型，对数据的噪音很敏感所以可以使用很多树一起训练来降低偏移和方差。可以用树模型时尽量用树模型哟。</p>\n<h2 id=\"3-3-线性回归-📈\">3.3 线性回归 📈</h2>\n<h3 id=\"3-3-1-概念\">3.3.1 概念</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-4.png\" alt=\"\"></p>\n<p>x*w是按元素来做乘积得到还是一个向量（list）</p>\n<h3 id=\"3-3-2-目标函数\">3.3.2 目标函数</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-5.png\" alt=\"\"></p>\n<p>学习参数w，b；在所有样本中求均方误差，最小化MSE。</p>\n<h3 id=\"3-3-3-使用线性回归来分类\">3.3.3 使用线性回归来分类</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-6.png\" alt=\"\"></p>\n<p>使用线性回归的二分类称为逻辑回归；</p>\n<p>这里类别数为m，真实标号y是one-hot向量，Oi也是一个长度为m的向量，Wi为矩阵形式，目标函数依然是最小化均方误差。类似没有隐藏层的”神经网络“。</p>\n<h3 id=\"3-3-4-Softmax-Regression\">3.3.4 Softmax Regression</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-7.png\" alt=\"\"></p>\n<p>这种方法的侧重点是最大化one-hot中正确样本的值，对其他样本点值置信度不会强制逼近为0。避免精力集中于one-hot中其他样本为0的拟合；首先把输出转化为概率分布的形式，这里虽然出现了非线性变换（使用softmax），但是此决策方法还是线性模型。</p>\n<p>此时比较两个概率分布，使用交叉熵来衡量向量的差别，只用关注真实类的值，让其越大越好。</p>\n<h2 id=\"3-4-随机梯度下降-📉\">3.4 随机梯度下降 📉</h2>\n<p><img src=\"https://picture.mulindya.com/pML3-8.png\" alt=\"\"></p>\n<p>求解最优解的方法可以使用随机梯度下降的方法，线性回归中的b是在输入的X中增加一行1,所以这里的b表示批量大小。<br>\n$$<br>\nO = W^TX+b<br>\n$$<br>\n在X中加一行全1数据<br>\n$$<br>\nO = W^TX<br>\n$$<br>\n可以解决除了决策树以外的其他算法（课内）的收敛，超参数是b和n；</p>\n<h3 id=\"3-4-1-代码\">3.4.1 代码</h3>\n<p>• Train a linear regression model with min-batch SGD<br>\n• Hyperparameters<br>\n• batch_size<br>\n• learning_rate<br>\n• num_epochs</p>\n<p>这里是输出一个结果值而非向量，因为这里是回归哟~</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># `features` shape is (n, p),样本数 特征数 `labels` shape is (n, 1) </span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">data_iter</span>(<span class=\"hljs-params\">batch_size, features, labels</span>):</span> <span class=\"hljs-comment\">#小批量的读取</span><br>    num_examples = <span class=\"hljs-built_in\">len</span>(features)  <span class=\"hljs-comment\">#样本数</span><br>    indices = <span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">range</span>(num_examples)) <br>    random.shuffle(indices)  <span class=\"hljs-comment\"># read examples at random  随机采样</span><br>    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>, num_examples, batch_size): <br>        batch_indices = torch.tensor( <br>            indices[i:<span class=\"hljs-built_in\">min</span>(i + batch_size, num_examples)]) <br>        <span class=\"hljs-keyword\">yield</span> features[batch_indices], labels[batch_indices] <span class=\"hljs-comment\">#yield是一个反复的操作，会创建迭代器，可以用for来遍历</span><br>w = torch.normal(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.01</span>, size=(p, <span class=\"hljs-number\">1</span>), requires_grad=<span class=\"hljs-literal\">True</span>) <br>b = torch.zeros(<span class=\"hljs-number\">1</span>, requires_grad=<span class=\"hljs-literal\">True</span>) <br><span class=\"hljs-keyword\">for</span> epoch <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(num_epochs): <br>    <span class=\"hljs-keyword\">for</span> X, y <span class=\"hljs-keyword\">in</span> data_iter(batch_size, features, labels): <br>        y_hat = X @ w + b  <span class=\"hljs-comment\">#@是用来对tensor进行矩阵相乘的；*用来对tensor进行矩阵进行逐元素相乘；</span><br>        loss = ((y_hat - y)**<span class=\"hljs-number\">2</span> / <span class=\"hljs-number\">2</span>).mean() <span class=\"hljs-comment\">#均方误差</span><br>        loss.backward()  <span class=\"hljs-comment\">#求导</span><br>        <span class=\"hljs-keyword\">for</span> param <span class=\"hljs-keyword\">in</span> [w, b]: <span class=\"hljs-comment\"># 对w，b更新</span><br>            param -= learning_rate * param.grad   <span class=\"hljs-comment\">#梯度更新</span><br>            param.grad.zero_()  <span class=\"hljs-comment\">#梯度清零</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"3-4-2-总结\">3.4.2 总结</h3>\n<p>• Linear methods linearly combine inputs to obtain predictions<br>\n• Linear regression uses MSE as the loss function<br>\n• Softmax regression is used for multiclass classification<br>\n• Turn predictions into probabilities and use cross-entropy as loss<br>\n• Cross entropy loss between two probability distribution<br>\n• Mini-batch SGD can learn both models (and later neural networks as well)</p>\n<h2 id=\"3-5-神经网络-✏️\">3.5 神经网络 ✏️</h2>\n<p>• NN usually requires more data and more computation<br>\n• NN architectures to model data structures<br>\n• Multilayer perceptions<br>\n• Convolutional neural networks<br>\n• Recurrent neural networks<br>\n• Transformer<br>\n• Design NN to incorporate prior knowledge about the data</p>\n<p>使用机器来提取特征比手动提取特征要好，但是需要更多的数据，可能数据集大了1000倍。</p>\n<h3 id=\"3-5-1-多层感知机\">3.5.1 多层感知机</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-9.png\" alt=\"\"></p>\n<ul>\n<li>\n<p>线性回归相当于是m=1的全连接层</p>\n</li>\n<li>\n<p>Softmax回归是m为m的全连接层</p>\n</li>\n</ul>\n<h4 id=\"MLP\">MLP</h4>\n<p>通过激活函数来构建非线性模型</p>\n<ul>\n<li>\n<p>Activation is a elemental-wise non-linear function</p>\n<p>eg:</p>\n</li>\n</ul>\n<p>$$<br>\nsigmoid(x) = \\frac{1}{1+e^{(-x)}}<br>\n$$</p>\n<p>$$<br>\nRelu(x) = max(x,0)<br>\n$$<br>\n​\t• It leads to non-linear models</p>\n<ul>\n<li>Stack multiple hidden layers  (dense + activation) to get deeper models 堆叠隐藏层</li>\n<li>Hyper-parameters:<br>\n# hidden layers, # outputs of each hidden layer</li>\n<li>Universal approximation theorem</li>\n</ul>\n<h4 id=\"code\">code</h4>\n<p>• MLP with 1 hidden layer<br>\n• Hyperparameter: num_hiddens</p>\n<p>一个隐藏层H 最后做一个线性映射输出。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">relu</span>(<span class=\"hljs-params\">X</span>):</span> <br>    <span class=\"hljs-keyword\">return</span> torch.<span class=\"hljs-built_in\">max</span>(X, <span class=\"hljs-number\">0</span>) <br>W1 = nn.Parameter(torch.randn(num_inputs, num_hiddens) * <span class=\"hljs-number\">0.01</span>) <br>b1 = nn.Parameter(torch.zeros(num_hiddens)) <br>W2 = nn.Parameter(torch.randn(num_hiddens, num_outputs) * <span class=\"hljs-number\">0.01</span>) <br>b2 = nn.Parameter(torch.zeros(num_outputs)) <br>H = relu(X @ W1 + b1) <br>Y = H @ W2 + b2 <br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"3-5-2-卷积神经网络\">3.5.2 卷积神经网络</h3>\n<h4 id=\"引入\">引入</h4>\n<ul>\n<li>Learn ImageNet (300x300 images with 1K classes) by a MLP with a single hidden layer with 10K outputs<br>\n• It leads to 1 billion learnable parameters, that’s too big!<br>\n• Fully connected: an output is a weighted sum over all inputs</li>\n<li>Recognize objects in images<br>\n• <strong>Translation invariance</strong>: similar output  no matter where the object is<br>\n• <strong>Locality</strong>: pixels are more related to  near neighbors</li>\n<li>Build the prior knowledge into the model structure<br>\n• Achieve same model capacity with less # params</li>\n</ul>\n<p>由于全连接层的参数量为m*n，纯用MLP参数量太大了，引用卷积层</p>\n<p>对于图像有两大特性</p>\n<ol>\n<li>变换不变性：表示同一object在图像区域的变换对结果没有影响；</li>\n<li>本地性：某一像素与附近的像素点的关联度较高，远处的关联度比较低；</li>\n</ol>\n<h4 id=\"具体机制\">具体机制</h4>\n<p><img src=\"https://picture.mulindya.com/pML3-10.png\" alt=\"\"></p>\n<ul>\n<li>\n<p>本地性：卷积层的一个输出只是来源于k*k的一个像素块进行局部计算；</p>\n</li>\n<li>\n<p>平移（/变换）不变性：在一个feature map的channel上使用相同卷积核，权重共享，因为和位置无关。</p>\n</li>\n</ul>\n<p>所以模型的参数量只与k有关，与输入输出的大小无关；卷积核通常是会被学习成去识别一个图像中的pattern。</p>\n<h4 id=\"代码\">代码</h4>\n<p>单通道卷积的实现，k是kernel的权重，Y是最后的输出，其维度是X的宽高减去对应的k宽高再加1。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># both input `X` and weight `K` are matrices </span><br>h, w = K.shape <br>Y = torch.zeros((X.shape[<span class=\"hljs-number\">0</span>] - h + <span class=\"hljs-number\">1</span>, X.shape[<span class=\"hljs-number\">1</span>] - w + <span class=\"hljs-number\">1</span>)) <br><span class=\"hljs-comment\"># stride = 1 </span><br><span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(Y.shape[<span class=\"hljs-number\">0</span>]):   <br>    <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(Y.shape[<span class=\"hljs-number\">1</span>]): <br>        Y[i, j] = (X[i : i+h, j : j+w] * K).<span class=\"hljs-built_in\">sum</span>() <span class=\"hljs-comment\">#点乘再求和的计算称为交叉相关</span><br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"Pooling-Layer-汇聚层\">Pooling Layer 汇聚层</h4>\n<p>卷积层对输入的位置敏感，如果输入的object移动一个微小距离对应的输出也会出现移动，这样鲁棒性会降低，通过池化层（汇聚层）可以解决这个问题。</p>\n<p>每一次在K*K的窗口中使用平均汇聚或者最大汇聚，这样对K个像素的偏移就不会太大影响。</p>\n<ul>\n<li>Convolution is sensitive to location<br>\n• A translation/rotation of a pattern in the input results similar changes of a pattern in the output</li>\n<li>A pooling layer computes mean/max in windows of size k × k</li>\n</ul>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># h, w: pooling window height and width </span><br><span class=\"hljs-comment\"># mode: max or avg </span><br>Y = torch.zeros((X.shape[<span class=\"hljs-number\">0</span>] - h + <span class=\"hljs-number\">1</span>, X.shape[<span class=\"hljs-number\">1</span>] - w + <span class=\"hljs-number\">1</span>)) <br><span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(Y.shape[<span class=\"hljs-number\">0</span>]): <br>    <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(Y.shape[<span class=\"hljs-number\">1</span>]): <br>        <span class=\"hljs-keyword\">if</span> mode == <span class=\"hljs-string\">'max'</span>: <br>            Y[i, j] = X[i : i+h, j : j+w].<span class=\"hljs-built_in\">max</span>() <br>        <span class=\"hljs-keyword\">elif</span> mode == <span class=\"hljs-string\">'avg'</span>: <br>            Y[i, j] = X[i : i+h, j : j+w].mean()<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"卷积神经网络\">卷积神经网络</h4>\n<ul>\n<li>Stacking convolution layers to extract features<br>\n• Activation is applied after each convolution layer<br>\n• Using pooling to reduce location sensitivity</li>\n<li>Modern CNNs are deep neural network with various hyper-parameters and layer connections (AlexNet, VGG, Inceptions, ResNet, MobileNet)</li>\n</ul>\n<p>卷积神经网络把卷积层堆叠起来，使用卷积层抽取空间信息，满足变换不变性和本地性的特征。激活层在卷积层之后，卷积层是一种特殊的全连接层（每次只看小窗口，其他权重为0），本质上还是线性变换，所以需要激活层来非线性化；同时使用汇聚层来降低卷积层对位置的敏感性。</p>\n<blockquote>\n<p>lenet = nn.Sequential(<br>\nnn.Conv2d(…),<br>\nnn.Sigmoid(),<br>\nnn.AvgPool2d(…),<br>\nnn.Conv2d(),<br>\nnn.Sigmoid(),<br>\nnn.AvgPool2d(…),<br>\nnn.Flatten(),<br>\nnn.Linear(…),<br>\nnn.Sigmoid(),<br>\nnn.Linear(…),<br>\nnn.Sigmoid(),<br>\nnn.Linear(…))</p>\n</blockquote>\n<h3 id=\"3-5-3-循环神经网络\">3.5.3 循环神经网络</h3>\n<p>语言模型中设计循环神经网络，通过前面的信息来预测当前信息，时间序列信息中通过前面几个项来预测后一个项。</p>\n<p>使用Dense时由前一个词作为输入预测当前词，当时无法获取时间序列信息，因为输入长度维度不可随意变化。所以这里需要对时序信息添加到输入中，也就是RNN，可以将前面的输出（隐藏层）添加进入当前层的输入。<strong>注意这里的对每个词权重是一样的</strong>（后续代码中也可以看到）。</p>\n<h4 id=\"Dense与Recurrent-networks\">Dense与Recurrent networks</h4>\n<p><img src=\"https://picture.mulindya.com/pML3-11.png\" alt=\"\"></p>\n<h4 id=\"RNN和变种\">RNN和变种</h4>\n<p><img src=\"https://picture.mulindya.com/pML3-12.png\" alt=\"\"></p>\n<p>注意隐藏层是经过激活层激活之后再输入，增加前向隐藏层。<br>\n$$<br>\nh_t = \\sigma(W_{hh}h_{t-1}+W_{hx}x_t+b_h)<br>\n$$<br>\n有些变种会涉及门来抑制某些信息比如LSTM，GRU，会对信息流进行细致的控制，比如对过去或者现在的信息采取遗忘、抑制，这种操作也是通过一组权重来学习决定是否对特定信息抑制。</p>\n<h4 id=\"代码-2\">代码</h4>\n<p>实现简单的RNN。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">W_xh = nn.Parameter(torch.randn(num_inputs, num_hiddens) * <span class=\"hljs-number\">0.01</span>) <br>W_hh = nn.Parameter(torch.randn(num_hiddens, num_hiddens) * <span class=\"hljs-number\">0.01</span>)  <span class=\"hljs-comment\">#多出来的</span><br>b_h = nn.Parameter(torch.zeros(num_hiddens)) <br>H = torch.zeros(num_hiddens) <br>outputs = [] <br><span class=\"hljs-comment\">#把每个词放入作为输入</span><br><span class=\"hljs-keyword\">for</span> X <span class=\"hljs-keyword\">in</span> inputs:  <span class=\"hljs-comment\"># `inputs` shape : (num_steps, batch_size, num_inputs)  num_steps表示一组输入 各个词</span><br>    H = torch.tanh(X @ W_xh + H @ W_hh + b_h)  <span class=\"hljs-comment\">#对每个词其实权重是一样的，只是绘图的时候方便表示展开拉长</span><br>    outputs.append(H)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"Bi-RNN-and-Deep-RNN\">Bi-RNN and Deep RNN</h4>\n<p><img src=\"https://picture.mulindya.com/pML3-13.png\" alt=\"\"></p>\n<p>可以从双向来检索，这样yt的信息来源是它两侧的信息，比如完形填空，是可以获取双向信息哦。</p>\n<h4 id=\"模型选择\">模型选择</h4>\n<p>不同的模型使用与不同数据，表格数据使用一般树模型，线性模型，神经网络。Transformer对文本和图像都可以处理，实际上文本信息和图像信息有相似的内部特性，只是维度不一样而已。</p>\n<p><img src=\"https://picture.mulindya.com/pML3-14.png\" alt=\"\"></p>\n<h3 id=\"3-5-4-总结\">3.5.4 总结</h3>\n<p>• MLP: stack dense layers with non-linear activations<br>\n• CNN: stack convolution activation and pooling layers to efficient extract spatial information<br>\n• RNN: stack recurrent layers to pass temporal information through hidden state</p>\n<p>CNN：高效抓取空间信息</p>\n<p>RNN：持续信息的数据，比如对时序信息。</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>斯坦福2021秋季的实用机器学习上线啦~ 😉 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。<br>\n这一章的内容是对各种机器学习模型的介绍，包括有决策树，线性模型，多层感知机，卷积神经网络，循环神经网络。</p>\n</blockquote>\n<h1>第三章 机器学习模型</h1>\n<h2 id=\"3-1-机器学习介绍🎈\">3.1 机器学习介绍🎈</h2>\n<p>分类可以分成：</p>\n<ol>\n<li>监督学习（Surprised）：有标号的数据上来训练模型来预测标号\n<ul>\n<li>衍生出现self-supervised 自监督学习：可以产生标号，只是其标号是来自数据本身（eg:word2vec,BERT）</li>\n</ul>\n</li>\n<li>半监督学习（Semi-superised）存在小部分有标号的数据，还有大部分没有标号的数据。\n<ul>\n<li>eg：self-training 使用自训练的过程来预测标号再一起训练。</li>\n</ul>\n</li>\n<li>无监督学习（Unsuperised）在没有标号的数据上训练\n<ul>\n<li>eg：clustering，density estimation（GAN）</li>\n</ul>\n</li>\n<li>强化学习（Reinforce）在一个环境中交互，并且基于观察点来学习，类似人类学习的方法。Use observations from the interaction with the environment to take actions to maximize reward。</li>\n</ol>\n<h3 id=\"3-1-1-监督学习中的Components\">3.1.1 监督学习中的Components</h3>\n<ul>\n<li>Model（模型） 从输入中得到输出</li>\n<li>Loss（损失函数）评估真实样本和预测结果的差距</li>\n<li>Objective（目标函数对象）The goal to optimize model params for</li>\n<li>Optimization（优化算法）he algorithm for solving the objective</li>\n</ul>\n<h3 id=\"3-1-2-监督学习模型\">3.1.2 监督学习模型</h3>\n<ul>\n<li><strong>Decision trees</strong>  • Use trees to make decisions</li>\n<li><strong>Linear methods</strong> • Decision is made from a linear combination of input features（做决策的输出是输入的线性组合）</li>\n<li><strong>Kernel machines</strong> • Use kernel functions to compute feature similarities  （核函数来衡量两个样本特征之间的相似度，指定不同的核函数，特征相似度不同，达到非线性的效果）</li>\n<li><strong>Neural Networks</strong> • Use neural networks to learn feature representations</li>\n</ul>\n<h3 id=\"3-1-3-总结\">3.1.3 总结</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-1.png\" alt=\"\"></p>\n<h2 id=\"3-2-决策树-🌴\">3.2 决策树 🌴</h2>\n<p>包括有分类树，回归树（此时叶子节点不是类别而是实数值）</p>\n<h5 id=\"好处（pros）：\">好处（pros）：</h5>\n<ul>\n<li>可解释（可应用于银行业，保险业）；</li>\n<li>可以用于数值或类别特征；</li>\n</ul>\n<h5 id=\"缺点（cons）：\">缺点（cons）：</h5>\n<ul>\n<li>鲁棒性差（可以用集成学习改善）；</li>\n<li>数据很复杂时可能产生过拟合（可以使用剪枝）；</li>\n<li>难以使用并行计算</li>\n</ul>\n<h3 id=\"3-2-1-生成决策树\">3.2.1 生成决策树</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-2.png\" alt=\"\"></p>\n<h3 id=\"3-2-2-随机森林\">3.2.2 随机森林</h3>\n<p>训练多个决策树来增强并行性，分类时使用投票机制，回归时使用多个树的平均；对整个树的稳定性有好处。</p>\n<ul>\n<li>Train multiple decision trees to improve robustness<br>\n• Trees are trained independently in parallel<br>\n• Majority voting for classification, average for regression</li>\n<li>Where is the randomness from?<br>\n• Bagging: randomly sample training examples with replacement<br>\n• E.g. [1,2,3,4,5]   [1,2,2,3,4]<br>\n• Randomly select a subset of features</li>\n</ul>\n<p>这里的随机森林中的随机来自于两个方面哦~</p>\n<p>一个是Bagging，训练一棵树在训练集中随机采样一些样本出来（可重复采样），所以在训练集中会出现重复样本，继续重复训练其他树；</p>\n<p>另一个是对于获取的训练集是随机进行采样特征列（此时是无重复的特征列采样）；</p>\n<h3 id=\"3-2-3-Gradient-Boosting-Decision-Trees\">3.2.3 Gradient Boosting Decision Trees</h3>\n<p>训练多棵树，但是这里不是独立完成决策，而是顺序的完成，利用这些树来合成一个大的模型出来，在t时刻 $ F_t(x) $ 表示是对前面训练的t-1棵树求和，训练的这颗树需要和所有的树的结果加起来，利用残差的思想训练$f_t(x)$（也就是“不准”的部分）</p>\n<p>同时这里的残差（$y_i-F_t(x_i)$）就等于梯度值($ -\\frac{\\alpha L}{\\alpha F} $)（使用均方误差作为loss）</p>\n<p><img src=\"https://picture.mulindya.com/pML3-3.png\" alt=\"\"></p>\n<h3 id=\"3-2-3-总结\">3.2.3 总结</h3>\n<ul>\n<li>Decision tree: an explainable model for classification/regression</li>\n<li>Easy to train and tune, widely used in industry</li>\n<li>Sensitive to data<br>\n• Ensemble can help (more on bagging and boosting latter)</li>\n</ul>\n<p>决策树是一个为数不多的可解释性模型，对数据的噪音很敏感所以可以使用很多树一起训练来降低偏移和方差。可以用树模型时尽量用树模型哟。</p>\n<h2 id=\"3-3-线性回归-📈\">3.3 线性回归 📈</h2>\n<h3 id=\"3-3-1-概念\">3.3.1 概念</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-4.png\" alt=\"\"></p>\n<p>x*w是按元素来做乘积得到还是一个向量（list）</p>\n<h3 id=\"3-3-2-目标函数\">3.3.2 目标函数</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-5.png\" alt=\"\"></p>\n<p>学习参数w，b；在所有样本中求均方误差，最小化MSE。</p>\n<h3 id=\"3-3-3-使用线性回归来分类\">3.3.3 使用线性回归来分类</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-6.png\" alt=\"\"></p>\n<p>使用线性回归的二分类称为逻辑回归；</p>\n<p>这里类别数为m，真实标号y是one-hot向量，Oi也是一个长度为m的向量，Wi为矩阵形式，目标函数依然是最小化均方误差。类似没有隐藏层的”神经网络“。</p>\n<h3 id=\"3-3-4-Softmax-Regression\">3.3.4 Softmax Regression</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-7.png\" alt=\"\"></p>\n<p>这种方法的侧重点是最大化one-hot中正确样本的值，对其他样本点值置信度不会强制逼近为0。避免精力集中于one-hot中其他样本为0的拟合；首先把输出转化为概率分布的形式，这里虽然出现了非线性变换（使用softmax），但是此决策方法还是线性模型。</p>\n<p>此时比较两个概率分布，使用交叉熵来衡量向量的差别，只用关注真实类的值，让其越大越好。</p>\n<h2 id=\"3-4-随机梯度下降-📉\">3.4 随机梯度下降 📉</h2>\n<p><img src=\"https://picture.mulindya.com/pML3-8.png\" alt=\"\"></p>\n<p>求解最优解的方法可以使用随机梯度下降的方法，线性回归中的b是在输入的X中增加一行1,所以这里的b表示批量大小。<br>\n$$<br>\nO = W^TX+b<br>\n$$<br>\n在X中加一行全1数据<br>\n$$<br>\nO = W^TX<br>\n$$<br>\n可以解决除了决策树以外的其他算法（课内）的收敛，超参数是b和n；</p>\n<h3 id=\"3-4-1-代码\">3.4.1 代码</h3>\n<p>• Train a linear regression model with min-batch SGD<br>\n• Hyperparameters<br>\n• batch_size<br>\n• learning_rate<br>\n• num_epochs</p>\n<p>这里是输出一个结果值而非向量，因为这里是回归哟~</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># `features` shape is (n, p),样本数 特征数 `labels` shape is (n, 1) </span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">data_iter</span>(<span class=\"hljs-params\">batch_size, features, labels</span>):</span> <span class=\"hljs-comment\">#小批量的读取</span><br>    num_examples = <span class=\"hljs-built_in\">len</span>(features)  <span class=\"hljs-comment\">#样本数</span><br>    indices = <span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">range</span>(num_examples)) <br>    random.shuffle(indices)  <span class=\"hljs-comment\"># read examples at random  随机采样</span><br>    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>, num_examples, batch_size): <br>        batch_indices = torch.tensor( <br>            indices[i:<span class=\"hljs-built_in\">min</span>(i + batch_size, num_examples)]) <br>        <span class=\"hljs-keyword\">yield</span> features[batch_indices], labels[batch_indices] <span class=\"hljs-comment\">#yield是一个反复的操作，会创建迭代器，可以用for来遍历</span><br>w = torch.normal(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.01</span>, size=(p, <span class=\"hljs-number\">1</span>), requires_grad=<span class=\"hljs-literal\">True</span>) <br>b = torch.zeros(<span class=\"hljs-number\">1</span>, requires_grad=<span class=\"hljs-literal\">True</span>) <br><span class=\"hljs-keyword\">for</span> epoch <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(num_epochs): <br>    <span class=\"hljs-keyword\">for</span> X, y <span class=\"hljs-keyword\">in</span> data_iter(batch_size, features, labels): <br>        y_hat = X @ w + b  <span class=\"hljs-comment\">#@是用来对tensor进行矩阵相乘的；*用来对tensor进行矩阵进行逐元素相乘；</span><br>        loss = ((y_hat - y)**<span class=\"hljs-number\">2</span> / <span class=\"hljs-number\">2</span>).mean() <span class=\"hljs-comment\">#均方误差</span><br>        loss.backward()  <span class=\"hljs-comment\">#求导</span><br>        <span class=\"hljs-keyword\">for</span> param <span class=\"hljs-keyword\">in</span> [w, b]: <span class=\"hljs-comment\"># 对w，b更新</span><br>            param -= learning_rate * param.grad   <span class=\"hljs-comment\">#梯度更新</span><br>            param.grad.zero_()  <span class=\"hljs-comment\">#梯度清零</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"3-4-2-总结\">3.4.2 总结</h3>\n<p>• Linear methods linearly combine inputs to obtain predictions<br>\n• Linear regression uses MSE as the loss function<br>\n• Softmax regression is used for multiclass classification<br>\n• Turn predictions into probabilities and use cross-entropy as loss<br>\n• Cross entropy loss between two probability distribution<br>\n• Mini-batch SGD can learn both models (and later neural networks as well)</p>\n<h2 id=\"3-5-神经网络-✏️\">3.5 神经网络 ✏️</h2>\n<p>• NN usually requires more data and more computation<br>\n• NN architectures to model data structures<br>\n• Multilayer perceptions<br>\n• Convolutional neural networks<br>\n• Recurrent neural networks<br>\n• Transformer<br>\n• Design NN to incorporate prior knowledge about the data</p>\n<p>使用机器来提取特征比手动提取特征要好，但是需要更多的数据，可能数据集大了1000倍。</p>\n<h3 id=\"3-5-1-多层感知机\">3.5.1 多层感知机</h3>\n<p><img src=\"https://picture.mulindya.com/pML3-9.png\" alt=\"\"></p>\n<ul>\n<li>\n<p>线性回归相当于是m=1的全连接层</p>\n</li>\n<li>\n<p>Softmax回归是m为m的全连接层</p>\n</li>\n</ul>\n<h4 id=\"MLP\">MLP</h4>\n<p>通过激活函数来构建非线性模型</p>\n<ul>\n<li>\n<p>Activation is a elemental-wise non-linear function</p>\n<p>eg:</p>\n</li>\n</ul>\n<p>$$<br>\nsigmoid(x) = \\frac{1}{1+e^{(-x)}}<br>\n$$</p>\n<p>$$<br>\nRelu(x) = max(x,0)<br>\n$$<br>\n​\t• It leads to non-linear models</p>\n<ul>\n<li>Stack multiple hidden layers  (dense + activation) to get deeper models 堆叠隐藏层</li>\n<li>Hyper-parameters:<br>\n# hidden layers, # outputs of each hidden layer</li>\n<li>Universal approximation theorem</li>\n</ul>\n<h4 id=\"code\">code</h4>\n<p>• MLP with 1 hidden layer<br>\n• Hyperparameter: num_hiddens</p>\n<p>一个隐藏层H 最后做一个线性映射输出。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">relu</span>(<span class=\"hljs-params\">X</span>):</span> <br>    <span class=\"hljs-keyword\">return</span> torch.<span class=\"hljs-built_in\">max</span>(X, <span class=\"hljs-number\">0</span>) <br>W1 = nn.Parameter(torch.randn(num_inputs, num_hiddens) * <span class=\"hljs-number\">0.01</span>) <br>b1 = nn.Parameter(torch.zeros(num_hiddens)) <br>W2 = nn.Parameter(torch.randn(num_hiddens, num_outputs) * <span class=\"hljs-number\">0.01</span>) <br>b2 = nn.Parameter(torch.zeros(num_outputs)) <br>H = relu(X @ W1 + b1) <br>Y = H @ W2 + b2 <br></code></pre></td></tr></table></figure>\n<h3 id=\"3-5-2-卷积神经网络\">3.5.2 卷积神经网络</h3>\n<h4 id=\"引入\">引入</h4>\n<ul>\n<li>Learn ImageNet (300x300 images with 1K classes) by a MLP with a single hidden layer with 10K outputs<br>\n• It leads to 1 billion learnable parameters, that’s too big!<br>\n• Fully connected: an output is a weighted sum over all inputs</li>\n<li>Recognize objects in images<br>\n• <strong>Translation invariance</strong>: similar output  no matter where the object is<br>\n• <strong>Locality</strong>: pixels are more related to  near neighbors</li>\n<li>Build the prior knowledge into the model structure<br>\n• Achieve same model capacity with less # params</li>\n</ul>\n<p>由于全连接层的参数量为m*n，纯用MLP参数量太大了，引用卷积层</p>\n<p>对于图像有两大特性</p>\n<ol>\n<li>变换不变性：表示同一object在图像区域的变换对结果没有影响；</li>\n<li>本地性：某一像素与附近的像素点的关联度较高，远处的关联度比较低；</li>\n</ol>\n<h4 id=\"具体机制\">具体机制</h4>\n<p><img src=\"https://picture.mulindya.com/pML3-10.png\" alt=\"\"></p>\n<ul>\n<li>\n<p>本地性：卷积层的一个输出只是来源于k*k的一个像素块进行局部计算；</p>\n</li>\n<li>\n<p>平移（/变换）不变性：在一个feature map的channel上使用相同卷积核，权重共享，因为和位置无关。</p>\n</li>\n</ul>\n<p>所以模型的参数量只与k有关，与输入输出的大小无关；卷积核通常是会被学习成去识别一个图像中的pattern。</p>\n<h4 id=\"代码\">代码</h4>\n<p>单通道卷积的实现，k是kernel的权重，Y是最后的输出，其维度是X的宽高减去对应的k宽高再加1。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># both input `X` and weight `K` are matrices </span><br>h, w = K.shape <br>Y = torch.zeros((X.shape[<span class=\"hljs-number\">0</span>] - h + <span class=\"hljs-number\">1</span>, X.shape[<span class=\"hljs-number\">1</span>] - w + <span class=\"hljs-number\">1</span>)) <br><span class=\"hljs-comment\"># stride = 1 </span><br><span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(Y.shape[<span class=\"hljs-number\">0</span>]):   <br>    <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(Y.shape[<span class=\"hljs-number\">1</span>]): <br>        Y[i, j] = (X[i : i+h, j : j+w] * K).<span class=\"hljs-built_in\">sum</span>() <span class=\"hljs-comment\">#点乘再求和的计算称为交叉相关</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"Pooling-Layer-汇聚层\">Pooling Layer 汇聚层</h4>\n<p>卷积层对输入的位置敏感，如果输入的object移动一个微小距离对应的输出也会出现移动，这样鲁棒性会降低，通过池化层（汇聚层）可以解决这个问题。</p>\n<p>每一次在K*K的窗口中使用平均汇聚或者最大汇聚，这样对K个像素的偏移就不会太大影响。</p>\n<ul>\n<li>Convolution is sensitive to location<br>\n• A translation/rotation of a pattern in the input results similar changes of a pattern in the output</li>\n<li>A pooling layer computes mean/max in windows of size k × k</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># h, w: pooling window height and width </span><br><span class=\"hljs-comment\"># mode: max or avg </span><br>Y = torch.zeros((X.shape[<span class=\"hljs-number\">0</span>] - h + <span class=\"hljs-number\">1</span>, X.shape[<span class=\"hljs-number\">1</span>] - w + <span class=\"hljs-number\">1</span>)) <br><span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(Y.shape[<span class=\"hljs-number\">0</span>]): <br>    <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(Y.shape[<span class=\"hljs-number\">1</span>]): <br>        <span class=\"hljs-keyword\">if</span> mode == <span class=\"hljs-string\">&#x27;max&#x27;</span>: <br>            Y[i, j] = X[i : i+h, j : j+w].<span class=\"hljs-built_in\">max</span>() <br>        <span class=\"hljs-keyword\">elif</span> mode == <span class=\"hljs-string\">&#x27;avg&#x27;</span>: <br>            Y[i, j] = X[i : i+h, j : j+w].mean()<br></code></pre></td></tr></table></figure>\n<h4 id=\"卷积神经网络\">卷积神经网络</h4>\n<ul>\n<li>Stacking convolution layers to extract features<br>\n• Activation is applied after each convolution layer<br>\n• Using pooling to reduce location sensitivity</li>\n<li>Modern CNNs are deep neural network with various hyper-parameters and layer connections (AlexNet, VGG, Inceptions, ResNet, MobileNet)</li>\n</ul>\n<p>卷积神经网络把卷积层堆叠起来，使用卷积层抽取空间信息，满足变换不变性和本地性的特征。激活层在卷积层之后，卷积层是一种特殊的全连接层（每次只看小窗口，其他权重为0），本质上还是线性变换，所以需要激活层来非线性化；同时使用汇聚层来降低卷积层对位置的敏感性。</p>\n<blockquote>\n<p>lenet = nn.Sequential(<br>\nnn.Conv2d(…),<br>\nnn.Sigmoid(),<br>\nnn.AvgPool2d(…),<br>\nnn.Conv2d(),<br>\nnn.Sigmoid(),<br>\nnn.AvgPool2d(…),<br>\nnn.Flatten(),<br>\nnn.Linear(…),<br>\nnn.Sigmoid(),<br>\nnn.Linear(…),<br>\nnn.Sigmoid(),<br>\nnn.Linear(…))</p>\n</blockquote>\n<h3 id=\"3-5-3-循环神经网络\">3.5.3 循环神经网络</h3>\n<p>语言模型中设计循环神经网络，通过前面的信息来预测当前信息，时间序列信息中通过前面几个项来预测后一个项。</p>\n<p>使用Dense时由前一个词作为输入预测当前词，当时无法获取时间序列信息，因为输入长度维度不可随意变化。所以这里需要对时序信息添加到输入中，也就是RNN，可以将前面的输出（隐藏层）添加进入当前层的输入。<strong>注意这里的对每个词权重是一样的</strong>（后续代码中也可以看到）。</p>\n<h4 id=\"Dense与Recurrent-networks\">Dense与Recurrent networks</h4>\n<p><img src=\"https://picture.mulindya.com/pML3-11.png\" alt=\"\"></p>\n<h4 id=\"RNN和变种\">RNN和变种</h4>\n<p><img src=\"https://picture.mulindya.com/pML3-12.png\" alt=\"\"></p>\n<p>注意隐藏层是经过激活层激活之后再输入，增加前向隐藏层。<br>\n$$<br>\nh_t = \\sigma(W_{hh}h_{t-1}+W_{hx}x_t+b_h)<br>\n$$<br>\n有些变种会涉及门来抑制某些信息比如LSTM，GRU，会对信息流进行细致的控制，比如对过去或者现在的信息采取遗忘、抑制，这种操作也是通过一组权重来学习决定是否对特定信息抑制。</p>\n<h4 id=\"代码-2\">代码</h4>\n<p>实现简单的RNN。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">W_xh = nn.Parameter(torch.randn(num_inputs, num_hiddens) * <span class=\"hljs-number\">0.01</span>) <br>W_hh = nn.Parameter(torch.randn(num_hiddens, num_hiddens) * <span class=\"hljs-number\">0.01</span>)  <span class=\"hljs-comment\">#多出来的</span><br>b_h = nn.Parameter(torch.zeros(num_hiddens)) <br>H = torch.zeros(num_hiddens) <br>outputs = [] <br><span class=\"hljs-comment\">#把每个词放入作为输入</span><br><span class=\"hljs-keyword\">for</span> X <span class=\"hljs-keyword\">in</span> inputs:  <span class=\"hljs-comment\"># `inputs` shape : (num_steps, batch_size, num_inputs)  num_steps表示一组输入 各个词</span><br>    H = torch.tanh(X @ W_xh + H @ W_hh + b_h)  <span class=\"hljs-comment\">#对每个词其实权重是一样的，只是绘图的时候方便表示展开拉长</span><br>    outputs.append(H)<br></code></pre></td></tr></table></figure>\n<h4 id=\"Bi-RNN-and-Deep-RNN\">Bi-RNN and Deep RNN</h4>\n<p><img src=\"https://picture.mulindya.com/pML3-13.png\" alt=\"\"></p>\n<p>可以从双向来检索，这样yt的信息来源是它两侧的信息，比如完形填空，是可以获取双向信息哦。</p>\n<h4 id=\"模型选择\">模型选择</h4>\n<p>不同的模型使用与不同数据，表格数据使用一般树模型，线性模型，神经网络。Transformer对文本和图像都可以处理，实际上文本信息和图像信息有相似的内部特性，只是维度不一样而已。</p>\n<p><img src=\"https://picture.mulindya.com/pML3-14.png\" alt=\"\"></p>\n<h3 id=\"3-5-4-总结\">3.5.4 总结</h3>\n<p>• MLP: stack dense layers with non-linear activations<br>\n• CNN: stack convolution activation and pooling layers to efficient extract spatial information<br>\n• RNN: stack recurrent layers to pass temporal information through hidden state</p>\n<p>CNN：高效抓取空间信息</p>\n<p>RNN：持续信息的数据，比如对时序信息。</p>\n"},{"title":"praticalML第一章笔记","date":"2021-12-30T07:35:09.000Z","_content":"\n> 斯坦福2021秋季的实用机器学习上线啦~ :wink: 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。\n\n# 第一章\n## 1.1 课程介绍\n介绍机器学习balabala 工业界的机器学习哦\n### Role\nSDE , 领域专家 -> 数据科学家 机器学习专家\n\n### Skill\n\n数据科学家需要的技能：\n- **数据**： 收集处理数据，独立同分布\n- **训练**： 模型融合，微调，迁移学习，多模态\n- **部署**： 蒸馏，模型性能优化\n- **监控** ：模型公平性，可解释性\n\n\n\n## 1.2 数据获取\n\n第一步是找数据，一般情况数据不够，问两个问题：\n\n- 是否能到不同的数据源来融合\n\n- 是否可以数据生成\n\n### Discover what data is available\n\n1. 判断公用数据集\n2. 非常大的数据集\n3. 采集新的数据\n\n### Source\n\n- mnist\n- imageNet\n- AudioSet：youtube sound\n- Kinetics：youtube video\n- KIITI：traffic senarios 自动驾驶\n- Amazon Rewiew：用户评论\n- SQuAD：维基百科的问答\n- LibriSpeech：有声读物 文字<->语音\n- 更多数据获取：https://en.wikipedia.org/wiki/List_of_datasets_for_machine-learning_research\n\n### Where to Find Datasets\n\n• [Paperswithcodes Datasets](https://paperswithcode.com/datasets): academic datasets with leaderboard\n• [Kaggle Datasets](https://www.kaggle.com/datasets): ML datasets uploaded by data scientists \n• [Google Dataset search](https://datasetsearch.research.google.com/): search datasets in the Web \n• Various toolkits datasets: [tensorflow](https://www.tensorflow.org/datasets), [huggingface](https://huggingface.co/docs/datasets/)(专注于文本transformer的数据集)\n• Various conference/company ML competitions \n• [Open Data on AWS](https://registry.opendata.aws/): 100+ large-scale raw data \n• Data lakes in your own organization\n\n### 数据集比较\n\n| 数据集类别 | 优点 | 缺点 |\n| :----: | :----: | :----: |\n|学术| 干净，难度适中 | 选择面小，小数据集 |\n|竞赛| 接近应用 | 偏向于简单，专注于热门业务 |\n|原始| 应用灵活 | 需要很多精力预处理 |\n\n### 数据融合\n\n- Combine data from multiple sources into a coherent dataset \n- Product data is often stored in multiple tables \n\t• E.g. a table for house information, a table for sales, a table for listing agents  \n- Join tables by keys, which are often entity IDs \n- Key issues: identify IDs, missing rows, redundant columns, value conflicts \n\n### 数据生成\n\n- Use GANs\n- 数据增强\n  - image augmentation\n  - Back Translation（中文-英文-中文）\n\n## 1.3 网页数据抓取\n\n### Web Scraping\n\n•The goal is to extract data from website \n\t• Noisy, weak labels, can be spammy \n\t• Available at scale \n\t• E.g. price comparison/tracking website \n• Many ML datasets are obtained by web scraping \n\t• E.g. ImageNet, Kinetics \n• Web crawling VS scrapping \n\t• Crawling: indexing whole pages on Internet  爬取所有信息\n\t• Scraping: scraping particular data from web pages of a website 网页数据提取 ；特定的网站 ；特定数据\n\n### Web Scraping tools\n\n- “curl” often doesn’t work  \n  • Website owners use various ways to stop bots \n- Use headless browser: a web browser without a GUI \n\n    python中可以使用selenium中的webdriver来模拟搜索，取消图形化界面使用命令行:happy:\n    ```python\n    from selenium import webdriver\n    chrome_options = webdriver.Chromeoptions()\n    chrome_options.headless = True\n    chrome = webdriver.Chrome(chrome_options = chrome_options) \n\n    page = chrome.get(url)\n    ```\n\n-  You need a lot of new IPs, easy to get through public clouds \n  • In all IPv4 IPs, AWS owns 1.75%, Azure 0.55%, GCP 0.25% \n\n最后一点，要注意版权问题哦~\n\n## 1.4 数据标注\n\n### 情况描述\n\n![](https://picture.mulindya.com/pML1.4-1.png)\n\n### 三种方案\n\n### 1. 半监督学习(Semi-supervised learning SSL)\n\n小部分数据标注了，还有大部分没有标注\n\n- Focus on the scenario where there is a small amount of labeled data, along with large amount of unlabeled data \n-  Make assumptions on data distribution to use unlabeled data 两者分布假设\n  • **Continuity assumption**（连续性假设）: examples with similar **features** are more likely to have the same **label** \n  • **Cluster assumption**（聚类假设）: data have **inherent cluster structure**, examples in the same cluster tend to have the same label   \n  • **Manifold assumption**（流型假设）: data lie on a manifold of **much lower dimension** than the input space 降维\n\n#### 典型算法\n\n##### 自学习（self-training）\n\n![](https://picture.mulindya.com/pML1.4-2.png)\n\n用现有标号的样本训练模型来预测未标号的样本，将所得标号进行筛选，选择置信度高的样本合并继续训练，直到筛掉的剩余样本获得较高的置信度或者某个阈值范围。这个模型可以不计成本同时模型融合。\n\n### 2. label through crowdsourcing 众包\n\n简单来说就是花钱找人标注。:confused:\n\n#### 典型算法\n\n##### 主动学习 active learning\n\n-  Focus on same scenario as SSL but with human in the loop \n  • Self training: Model helps propagate labels to unlabeled data \n  • Active learning: Model select the most “interesting” data for labelers \n\n-  **Uncertainty sampling**  \n  • Select examples whose predictions are most uncertain \n  • The highest class prediction score is close to random ( 1/n) \n\n  模型选择置信度偏向于随机的样本让人来判断。然后放进模型区训练再预测再判断‘难’的数据。\n\n-  **Query-by-committee** \n  • Trains multiple models and select samples that models disagree with 1/n\n\n  多个模型投票来确定哪些数据比较‘难’  \n\n### 3 Active Learning + Self-training\n\n混合使用\n\n![](https://picture.mulindya.com/pML1.4-3.png)\n\n### 质量控制\n\n可能出现误标或者出现标注并不精确的情况\n\n#### Weak Supervision 弱监督学习\n\n-  Semi-automatically generate labels \n  • Less accurate than manual ones, but good enough for training \n\n-  **Data programming**:\n\n  总结规律规则编程  \n  • Domain specific heuristics to assign labels \n  • Keyword search, pattern matching, third-party models \n  • E.g. rules to check if YouTube comments are spam or ham\n\n> 什么是弱监督学习呢？弱监督学习可以分为三种典型的类型，不完全监督（Incomplete supervision），不确切监督（Inexact supervision），不精确监督（Inaccurate supervision）。\n>\n> - 不完全监督是指，训练数据中只有一部分数据被给了标签，有一些数据是没有标签的。\n>\n> - 不确切监督是指，训练数据只给出了粗粒度标签。我们可以把输入想象成一个包，这个包里面有一些示例，我们只知道这个包的标签，Y或N，但是我们不知道每个示例的标签。\n>\n> - 不精确监督是指，给出的标签不总是正确的，比如本来应该是Y的标签被错误标记成了N。\n>\n> ##### 解决方案\n>\n> - 为了解决不完全监督，我们可以考虑两种主要技术，主动学习和半监督学习。一种是有人类干预的，一种是没有人类干预的。\n> - 为了解决不确切监督，我们可以考虑多示例学习。\n> - 为了解决不精确监督，我们考虑带噪学习。\n","source":"_posts/学习笔记/实用机器学习/praticalML1.md","raw":"---\ntitle: praticalML第一章笔记\ndate: 2021-12-30 15:35:09\ntags: [李沐,机器学习]\ncategories: [学习笔记,机器学习]\n---\n\n> 斯坦福2021秋季的实用机器学习上线啦~ :wink: 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。\n\n# 第一章\n## 1.1 课程介绍\n介绍机器学习balabala 工业界的机器学习哦\n### Role\nSDE , 领域专家 -> 数据科学家 机器学习专家\n\n### Skill\n\n数据科学家需要的技能：\n- **数据**： 收集处理数据，独立同分布\n- **训练**： 模型融合，微调，迁移学习，多模态\n- **部署**： 蒸馏，模型性能优化\n- **监控** ：模型公平性，可解释性\n\n\n\n## 1.2 数据获取\n\n第一步是找数据，一般情况数据不够，问两个问题：\n\n- 是否能到不同的数据源来融合\n\n- 是否可以数据生成\n\n### Discover what data is available\n\n1. 判断公用数据集\n2. 非常大的数据集\n3. 采集新的数据\n\n### Source\n\n- mnist\n- imageNet\n- AudioSet：youtube sound\n- Kinetics：youtube video\n- KIITI：traffic senarios 自动驾驶\n- Amazon Rewiew：用户评论\n- SQuAD：维基百科的问答\n- LibriSpeech：有声读物 文字<->语音\n- 更多数据获取：https://en.wikipedia.org/wiki/List_of_datasets_for_machine-learning_research\n\n### Where to Find Datasets\n\n• [Paperswithcodes Datasets](https://paperswithcode.com/datasets): academic datasets with leaderboard\n• [Kaggle Datasets](https://www.kaggle.com/datasets): ML datasets uploaded by data scientists \n• [Google Dataset search](https://datasetsearch.research.google.com/): search datasets in the Web \n• Various toolkits datasets: [tensorflow](https://www.tensorflow.org/datasets), [huggingface](https://huggingface.co/docs/datasets/)(专注于文本transformer的数据集)\n• Various conference/company ML competitions \n• [Open Data on AWS](https://registry.opendata.aws/): 100+ large-scale raw data \n• Data lakes in your own organization\n\n### 数据集比较\n\n| 数据集类别 | 优点 | 缺点 |\n| :----: | :----: | :----: |\n|学术| 干净，难度适中 | 选择面小，小数据集 |\n|竞赛| 接近应用 | 偏向于简单，专注于热门业务 |\n|原始| 应用灵活 | 需要很多精力预处理 |\n\n### 数据融合\n\n- Combine data from multiple sources into a coherent dataset \n- Product data is often stored in multiple tables \n\t• E.g. a table for house information, a table for sales, a table for listing agents  \n- Join tables by keys, which are often entity IDs \n- Key issues: identify IDs, missing rows, redundant columns, value conflicts \n\n### 数据生成\n\n- Use GANs\n- 数据增强\n  - image augmentation\n  - Back Translation（中文-英文-中文）\n\n## 1.3 网页数据抓取\n\n### Web Scraping\n\n•The goal is to extract data from website \n\t• Noisy, weak labels, can be spammy \n\t• Available at scale \n\t• E.g. price comparison/tracking website \n• Many ML datasets are obtained by web scraping \n\t• E.g. ImageNet, Kinetics \n• Web crawling VS scrapping \n\t• Crawling: indexing whole pages on Internet  爬取所有信息\n\t• Scraping: scraping particular data from web pages of a website 网页数据提取 ；特定的网站 ；特定数据\n\n### Web Scraping tools\n\n- “curl” often doesn’t work  \n  • Website owners use various ways to stop bots \n- Use headless browser: a web browser without a GUI \n\n    python中可以使用selenium中的webdriver来模拟搜索，取消图形化界面使用命令行:happy:\n    ```python\n    from selenium import webdriver\n    chrome_options = webdriver.Chromeoptions()\n    chrome_options.headless = True\n    chrome = webdriver.Chrome(chrome_options = chrome_options) \n\n    page = chrome.get(url)\n    ```\n\n-  You need a lot of new IPs, easy to get through public clouds \n  • In all IPv4 IPs, AWS owns 1.75%, Azure 0.55%, GCP 0.25% \n\n最后一点，要注意版权问题哦~\n\n## 1.4 数据标注\n\n### 情况描述\n\n![](https://picture.mulindya.com/pML1.4-1.png)\n\n### 三种方案\n\n### 1. 半监督学习(Semi-supervised learning SSL)\n\n小部分数据标注了，还有大部分没有标注\n\n- Focus on the scenario where there is a small amount of labeled data, along with large amount of unlabeled data \n-  Make assumptions on data distribution to use unlabeled data 两者分布假设\n  • **Continuity assumption**（连续性假设）: examples with similar **features** are more likely to have the same **label** \n  • **Cluster assumption**（聚类假设）: data have **inherent cluster structure**, examples in the same cluster tend to have the same label   \n  • **Manifold assumption**（流型假设）: data lie on a manifold of **much lower dimension** than the input space 降维\n\n#### 典型算法\n\n##### 自学习（self-training）\n\n![](https://picture.mulindya.com/pML1.4-2.png)\n\n用现有标号的样本训练模型来预测未标号的样本，将所得标号进行筛选，选择置信度高的样本合并继续训练，直到筛掉的剩余样本获得较高的置信度或者某个阈值范围。这个模型可以不计成本同时模型融合。\n\n### 2. label through crowdsourcing 众包\n\n简单来说就是花钱找人标注。:confused:\n\n#### 典型算法\n\n##### 主动学习 active learning\n\n-  Focus on same scenario as SSL but with human in the loop \n  • Self training: Model helps propagate labels to unlabeled data \n  • Active learning: Model select the most “interesting” data for labelers \n\n-  **Uncertainty sampling**  \n  • Select examples whose predictions are most uncertain \n  • The highest class prediction score is close to random ( 1/n) \n\n  模型选择置信度偏向于随机的样本让人来判断。然后放进模型区训练再预测再判断‘难’的数据。\n\n-  **Query-by-committee** \n  • Trains multiple models and select samples that models disagree with 1/n\n\n  多个模型投票来确定哪些数据比较‘难’  \n\n### 3 Active Learning + Self-training\n\n混合使用\n\n![](https://picture.mulindya.com/pML1.4-3.png)\n\n### 质量控制\n\n可能出现误标或者出现标注并不精确的情况\n\n#### Weak Supervision 弱监督学习\n\n-  Semi-automatically generate labels \n  • Less accurate than manual ones, but good enough for training \n\n-  **Data programming**:\n\n  总结规律规则编程  \n  • Domain specific heuristics to assign labels \n  • Keyword search, pattern matching, third-party models \n  • E.g. rules to check if YouTube comments are spam or ham\n\n> 什么是弱监督学习呢？弱监督学习可以分为三种典型的类型，不完全监督（Incomplete supervision），不确切监督（Inexact supervision），不精确监督（Inaccurate supervision）。\n>\n> - 不完全监督是指，训练数据中只有一部分数据被给了标签，有一些数据是没有标签的。\n>\n> - 不确切监督是指，训练数据只给出了粗粒度标签。我们可以把输入想象成一个包，这个包里面有一些示例，我们只知道这个包的标签，Y或N，但是我们不知道每个示例的标签。\n>\n> - 不精确监督是指，给出的标签不总是正确的，比如本来应该是Y的标签被错误标记成了N。\n>\n> ##### 解决方案\n>\n> - 为了解决不完全监督，我们可以考虑两种主要技术，主动学习和半监督学习。一种是有人类干预的，一种是没有人类干预的。\n> - 为了解决不确切监督，我们可以考虑多示例学习。\n> - 为了解决不精确监督，我们考虑带噪学习。\n","slug":"学习笔记/实用机器学习/praticalML1","published":1,"updated":"2022-01-18T08:10:17.118Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0cw007wast91j661h52","content":"<blockquote>\n<p>斯坦福2021秋季的实用机器学习上线啦~ 😉 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。</p>\n</blockquote>\n<h1>第一章</h1>\n<h2 id=\"1-1-课程介绍\">1.1 课程介绍</h2>\n<p>介绍机器学习balabala 工业界的机器学习哦</p>\n<h3 id=\"Role\">Role</h3>\n<p>SDE , 领域专家 -&gt; 数据科学家 机器学习专家</p>\n<h3 id=\"Skill\">Skill</h3>\n<p>数据科学家需要的技能：</p>\n<ul>\n<li><strong>数据</strong>： 收集处理数据，独立同分布</li>\n<li><strong>训练</strong>： 模型融合，微调，迁移学习，多模态</li>\n<li><strong>部署</strong>： 蒸馏，模型性能优化</li>\n<li><strong>监控</strong> ：模型公平性，可解释性</li>\n</ul>\n<h2 id=\"1-2-数据获取\">1.2 数据获取</h2>\n<p>第一步是找数据，一般情况数据不够，问两个问题：</p>\n<ul>\n<li>\n<p>是否能到不同的数据源来融合</p>\n</li>\n<li>\n<p>是否可以数据生成</p>\n</li>\n</ul>\n<h3 id=\"Discover-what-data-is-available\">Discover what data is available</h3>\n<ol>\n<li>判断公用数据集</li>\n<li>非常大的数据集</li>\n<li>采集新的数据</li>\n</ol>\n<h3 id=\"Source\">Source</h3>\n<ul>\n<li>mnist</li>\n<li>imageNet</li>\n<li>AudioSet：youtube sound</li>\n<li>Kinetics：youtube video</li>\n<li>KIITI：traffic senarios 自动驾驶</li>\n<li>Amazon Rewiew：用户评论</li>\n<li>SQuAD：维基百科的问答</li>\n<li>LibriSpeech：有声读物 文字&lt;-&gt;语音</li>\n<li>更多数据获取：<a href=\"https://en.wikipedia.org/wiki/List_of_datasets_for_machine-learning_research\">https://en.wikipedia.org/wiki/List_of_datasets_for_machine-learning_research</a></li>\n</ul>\n<h3 id=\"Where-to-Find-Datasets\">Where to Find Datasets</h3>\n<p>• <a href=\"https://paperswithcode.com/datasets\">Paperswithcodes Datasets</a>: academic datasets with leaderboard<br>\n• <a href=\"https://www.kaggle.com/datasets\">Kaggle Datasets</a>: ML datasets uploaded by data scientists<br>\n• <a href=\"https://datasetsearch.research.google.com/\">Google Dataset search</a>: search datasets in the Web<br>\n• Various toolkits datasets: <a href=\"https://www.tensorflow.org/datasets\">tensorflow</a>, <a href=\"https://huggingface.co/docs/datasets/\">huggingface</a>(专注于文本transformer的数据集)<br>\n• Various conference/company ML competitions<br>\n• <a href=\"https://registry.opendata.aws/\">Open Data on AWS</a>: 100+ large-scale raw data<br>\n• Data lakes in your own organization</p>\n<h3 id=\"数据集比较\">数据集比较</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">数据集类别</th>\n<th style=\"text-align:center\">优点</th>\n<th style=\"text-align:center\">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">学术</td>\n<td style=\"text-align:center\">干净，难度适中</td>\n<td style=\"text-align:center\">选择面小，小数据集</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">竞赛</td>\n<td style=\"text-align:center\">接近应用</td>\n<td style=\"text-align:center\">偏向于简单，专注于热门业务</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">原始</td>\n<td style=\"text-align:center\">应用灵活</td>\n<td style=\"text-align:center\">需要很多精力预处理</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"数据融合\">数据融合</h3>\n<ul>\n<li>Combine data from multiple sources into a coherent dataset</li>\n<li>Product data is often stored in multiple tables<br>\n• E.g. a table for house information, a table for sales, a table for listing agents</li>\n<li>Join tables by keys, which are often entity IDs</li>\n<li>Key issues: identify IDs, missing rows, redundant columns, value conflicts</li>\n</ul>\n<h3 id=\"数据生成\">数据生成</h3>\n<ul>\n<li>Use GANs</li>\n<li>数据增强\n<ul>\n<li>image augmentation</li>\n<li>Back Translation（中文-英文-中文）</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"1-3-网页数据抓取\">1.3 网页数据抓取</h2>\n<h3 id=\"Web-Scraping\">Web Scraping</h3>\n<p>•The goal is to extract data from website<br>\n• Noisy, weak labels, can be spammy<br>\n• Available at scale<br>\n• E.g. price comparison/tracking website<br>\n• Many ML datasets are obtained by web scraping<br>\n• E.g. ImageNet, Kinetics<br>\n• Web crawling VS scrapping<br>\n• Crawling: indexing whole pages on Internet  爬取所有信息<br>\n• Scraping: scraping particular data from web pages of a website 网页数据提取 ；特定的网站 ；特定数据</p>\n<h3 id=\"Web-Scraping-tools\">Web Scraping tools</h3>\n<ul>\n<li>\n<p>“curl” often doesn’t work<br>\n• Website owners use various ways to stop bots</p>\n</li>\n<li>\n<p>Use headless browser: a web browser without a GUI</p>\n<p>python中可以使用selenium中的webdriver来模拟搜索，取消图形化界面使用命令行:happy:</p>\n  <figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> selenium <span class=\"hljs-keyword\">import</span> webdriver<br>chrome_options = webdriver.Chromeoptions()<br>chrome_options.headless = <span class=\"hljs-literal\">True</span><br>chrome = webdriver.Chrome(chrome_options = chrome_options) <br><br>page = chrome.get(url)<br></code></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>You need a lot of new IPs, easy to get through public clouds<br>\n• In all IPv4 IPs, AWS owns 1.75%, Azure 0.55%, GCP 0.25%</p>\n</li>\n</ul>\n<p>最后一点，要注意版权问题哦~</p>\n<h2 id=\"1-4-数据标注\">1.4 数据标注</h2>\n<h3 id=\"情况描述\">情况描述</h3>\n<p><img src=\"https://picture.mulindya.com/pML1.4-1.png\" alt=\"\"></p>\n<h3 id=\"三种方案\">三种方案</h3>\n<h3 id=\"1-半监督学习-Semi-supervised-learning-SSL\">1. 半监督学习(Semi-supervised learning SSL)</h3>\n<p>小部分数据标注了，还有大部分没有标注</p>\n<ul>\n<li>Focus on the scenario where there is a small amount of labeled data, along with large amount of unlabeled data</li>\n<li>Make assumptions on data distribution to use unlabeled data 两者分布假设<br>\n• <strong>Continuity assumption</strong>（连续性假设）: examples with similar <strong>features</strong> are more likely to have the same <strong>label</strong><br>\n• <strong>Cluster assumption</strong>（聚类假设）: data have <strong>inherent cluster structure</strong>, examples in the same cluster tend to have the same label<br>\n• <strong>Manifold assumption</strong>（流型假设）: data lie on a manifold of <strong>much lower dimension</strong> than the input space 降维</li>\n</ul>\n<h4 id=\"典型算法\">典型算法</h4>\n<h5 id=\"自学习（self-training）\">自学习（self-training）</h5>\n<p><img src=\"https://picture.mulindya.com/pML1.4-2.png\" alt=\"\"></p>\n<p>用现有标号的样本训练模型来预测未标号的样本，将所得标号进行筛选，选择置信度高的样本合并继续训练，直到筛掉的剩余样本获得较高的置信度或者某个阈值范围。这个模型可以不计成本同时模型融合。</p>\n<h3 id=\"2-label-through-crowdsourcing-众包\">2. label through crowdsourcing 众包</h3>\n<p>简单来说就是花钱找人标注。😕</p>\n<h4 id=\"典型算法-2\">典型算法</h4>\n<h5 id=\"主动学习-active-learning\">主动学习 active learning</h5>\n<ul>\n<li>\n<p>Focus on same scenario as SSL but with human in the loop<br>\n• Self training: Model helps propagate labels to unlabeled data<br>\n• Active learning: Model select the most “interesting” data for labelers</p>\n</li>\n<li>\n<p><strong>Uncertainty sampling</strong><br>\n• Select examples whose predictions are most uncertain<br>\n• The highest class prediction score is close to random ( 1/n)</p>\n</li>\n</ul>\n<p>模型选择置信度偏向于随机的样本让人来判断。然后放进模型区训练再预测再判断‘难’的数据。</p>\n<ul>\n<li><strong>Query-by-committee</strong><br>\n• Trains multiple models and select samples that models disagree with 1/n</li>\n</ul>\n<p>多个模型投票来确定哪些数据比较‘难’</p>\n<h3 id=\"3-Active-Learning-Self-training\">3 Active Learning + Self-training</h3>\n<p>混合使用</p>\n<p><img src=\"https://picture.mulindya.com/pML1.4-3.png\" alt=\"\"></p>\n<h3 id=\"质量控制\">质量控制</h3>\n<p>可能出现误标或者出现标注并不精确的情况</p>\n<h4 id=\"Weak-Supervision-弱监督学习\">Weak Supervision 弱监督学习</h4>\n<ul>\n<li>\n<p>Semi-automatically generate labels<br>\n• Less accurate than manual ones, but good enough for training</p>\n</li>\n<li>\n<p><strong>Data programming</strong>:</p>\n</li>\n</ul>\n<p>总结规律规则编程<br>\n• Domain specific heuristics to assign labels<br>\n• Keyword search, pattern matching, third-party models<br>\n• E.g. rules to check if YouTube comments are spam or ham</p>\n<blockquote>\n<p>什么是弱监督学习呢？弱监督学习可以分为三种典型的类型，不完全监督（Incomplete supervision），不确切监督（Inexact supervision），不精确监督（Inaccurate supervision）。</p>\n<ul>\n<li>\n<p>不完全监督是指，训练数据中只有一部分数据被给了标签，有一些数据是没有标签的。</p>\n</li>\n<li>\n<p>不确切监督是指，训练数据只给出了粗粒度标签。我们可以把输入想象成一个包，这个包里面有一些示例，我们只知道这个包的标签，Y或N，但是我们不知道每个示例的标签。</p>\n</li>\n<li>\n<p>不精确监督是指，给出的标签不总是正确的，比如本来应该是Y的标签被错误标记成了N。</p>\n</li>\n</ul>\n<h5 id=\"解决方案\">解决方案</h5>\n<ul>\n<li>为了解决不完全监督，我们可以考虑两种主要技术，主动学习和半监督学习。一种是有人类干预的，一种是没有人类干预的。</li>\n<li>为了解决不确切监督，我们可以考虑多示例学习。</li>\n<li>为了解决不精确监督，我们考虑带噪学习。</li>\n</ul>\n</blockquote>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>斯坦福2021秋季的实用机器学习上线啦~ 😉 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。</p>\n</blockquote>\n<h1>第一章</h1>\n<h2 id=\"1-1-课程介绍\">1.1 课程介绍</h2>\n<p>介绍机器学习balabala 工业界的机器学习哦</p>\n<h3 id=\"Role\">Role</h3>\n<p>SDE , 领域专家 -&gt; 数据科学家 机器学习专家</p>\n<h3 id=\"Skill\">Skill</h3>\n<p>数据科学家需要的技能：</p>\n<ul>\n<li><strong>数据</strong>： 收集处理数据，独立同分布</li>\n<li><strong>训练</strong>： 模型融合，微调，迁移学习，多模态</li>\n<li><strong>部署</strong>： 蒸馏，模型性能优化</li>\n<li><strong>监控</strong> ：模型公平性，可解释性</li>\n</ul>\n<h2 id=\"1-2-数据获取\">1.2 数据获取</h2>\n<p>第一步是找数据，一般情况数据不够，问两个问题：</p>\n<ul>\n<li>\n<p>是否能到不同的数据源来融合</p>\n</li>\n<li>\n<p>是否可以数据生成</p>\n</li>\n</ul>\n<h3 id=\"Discover-what-data-is-available\">Discover what data is available</h3>\n<ol>\n<li>判断公用数据集</li>\n<li>非常大的数据集</li>\n<li>采集新的数据</li>\n</ol>\n<h3 id=\"Source\">Source</h3>\n<ul>\n<li>mnist</li>\n<li>imageNet</li>\n<li>AudioSet：youtube sound</li>\n<li>Kinetics：youtube video</li>\n<li>KIITI：traffic senarios 自动驾驶</li>\n<li>Amazon Rewiew：用户评论</li>\n<li>SQuAD：维基百科的问答</li>\n<li>LibriSpeech：有声读物 文字&lt;-&gt;语音</li>\n<li>更多数据获取：<a href=\"https://en.wikipedia.org/wiki/List_of_datasets_for_machine-learning_research\">https://en.wikipedia.org/wiki/List_of_datasets_for_machine-learning_research</a></li>\n</ul>\n<h3 id=\"Where-to-Find-Datasets\">Where to Find Datasets</h3>\n<p>• <a href=\"https://paperswithcode.com/datasets\">Paperswithcodes Datasets</a>: academic datasets with leaderboard<br>\n• <a href=\"https://www.kaggle.com/datasets\">Kaggle Datasets</a>: ML datasets uploaded by data scientists<br>\n• <a href=\"https://datasetsearch.research.google.com/\">Google Dataset search</a>: search datasets in the Web<br>\n• Various toolkits datasets: <a href=\"https://www.tensorflow.org/datasets\">tensorflow</a>, <a href=\"https://huggingface.co/docs/datasets/\">huggingface</a>(专注于文本transformer的数据集)<br>\n• Various conference/company ML competitions<br>\n• <a href=\"https://registry.opendata.aws/\">Open Data on AWS</a>: 100+ large-scale raw data<br>\n• Data lakes in your own organization</p>\n<h3 id=\"数据集比较\">数据集比较</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">数据集类别</th>\n<th style=\"text-align:center\">优点</th>\n<th style=\"text-align:center\">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">学术</td>\n<td style=\"text-align:center\">干净，难度适中</td>\n<td style=\"text-align:center\">选择面小，小数据集</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">竞赛</td>\n<td style=\"text-align:center\">接近应用</td>\n<td style=\"text-align:center\">偏向于简单，专注于热门业务</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">原始</td>\n<td style=\"text-align:center\">应用灵活</td>\n<td style=\"text-align:center\">需要很多精力预处理</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"数据融合\">数据融合</h3>\n<ul>\n<li>Combine data from multiple sources into a coherent dataset</li>\n<li>Product data is often stored in multiple tables<br>\n• E.g. a table for house information, a table for sales, a table for listing agents</li>\n<li>Join tables by keys, which are often entity IDs</li>\n<li>Key issues: identify IDs, missing rows, redundant columns, value conflicts</li>\n</ul>\n<h3 id=\"数据生成\">数据生成</h3>\n<ul>\n<li>Use GANs</li>\n<li>数据增强\n<ul>\n<li>image augmentation</li>\n<li>Back Translation（中文-英文-中文）</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"1-3-网页数据抓取\">1.3 网页数据抓取</h2>\n<h3 id=\"Web-Scraping\">Web Scraping</h3>\n<p>•The goal is to extract data from website<br>\n• Noisy, weak labels, can be spammy<br>\n• Available at scale<br>\n• E.g. price comparison/tracking website<br>\n• Many ML datasets are obtained by web scraping<br>\n• E.g. ImageNet, Kinetics<br>\n• Web crawling VS scrapping<br>\n• Crawling: indexing whole pages on Internet  爬取所有信息<br>\n• Scraping: scraping particular data from web pages of a website 网页数据提取 ；特定的网站 ；特定数据</p>\n<h3 id=\"Web-Scraping-tools\">Web Scraping tools</h3>\n<ul>\n<li>\n<p>“curl” often doesn’t work<br>\n• Website owners use various ways to stop bots</p>\n</li>\n<li>\n<p>Use headless browser: a web browser without a GUI</p>\n<p>python中可以使用selenium中的webdriver来模拟搜索，取消图形化界面使用命令行:happy:</p>\n  <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> selenium <span class=\"hljs-keyword\">import</span> webdriver<br>chrome_options = webdriver.Chromeoptions()<br>chrome_options.headless = <span class=\"hljs-literal\">True</span><br>chrome = webdriver.Chrome(chrome_options = chrome_options) <br><br>page = chrome.get(url)<br></code></pre></td></tr></table></figure>\n</li>\n<li>\n<p>You need a lot of new IPs, easy to get through public clouds<br>\n• In all IPv4 IPs, AWS owns 1.75%, Azure 0.55%, GCP 0.25%</p>\n</li>\n</ul>\n<p>最后一点，要注意版权问题哦~</p>\n<h2 id=\"1-4-数据标注\">1.4 数据标注</h2>\n<h3 id=\"情况描述\">情况描述</h3>\n<p><img src=\"https://picture.mulindya.com/pML1.4-1.png\" alt=\"\"></p>\n<h3 id=\"三种方案\">三种方案</h3>\n<h3 id=\"1-半监督学习-Semi-supervised-learning-SSL\">1. 半监督学习(Semi-supervised learning SSL)</h3>\n<p>小部分数据标注了，还有大部分没有标注</p>\n<ul>\n<li>Focus on the scenario where there is a small amount of labeled data, along with large amount of unlabeled data</li>\n<li>Make assumptions on data distribution to use unlabeled data 两者分布假设<br>\n• <strong>Continuity assumption</strong>（连续性假设）: examples with similar <strong>features</strong> are more likely to have the same <strong>label</strong><br>\n• <strong>Cluster assumption</strong>（聚类假设）: data have <strong>inherent cluster structure</strong>, examples in the same cluster tend to have the same label<br>\n• <strong>Manifold assumption</strong>（流型假设）: data lie on a manifold of <strong>much lower dimension</strong> than the input space 降维</li>\n</ul>\n<h4 id=\"典型算法\">典型算法</h4>\n<h5 id=\"自学习（self-training）\">自学习（self-training）</h5>\n<p><img src=\"https://picture.mulindya.com/pML1.4-2.png\" alt=\"\"></p>\n<p>用现有标号的样本训练模型来预测未标号的样本，将所得标号进行筛选，选择置信度高的样本合并继续训练，直到筛掉的剩余样本获得较高的置信度或者某个阈值范围。这个模型可以不计成本同时模型融合。</p>\n<h3 id=\"2-label-through-crowdsourcing-众包\">2. label through crowdsourcing 众包</h3>\n<p>简单来说就是花钱找人标注。😕</p>\n<h4 id=\"典型算法-2\">典型算法</h4>\n<h5 id=\"主动学习-active-learning\">主动学习 active learning</h5>\n<ul>\n<li>\n<p>Focus on same scenario as SSL but with human in the loop<br>\n• Self training: Model helps propagate labels to unlabeled data<br>\n• Active learning: Model select the most “interesting” data for labelers</p>\n</li>\n<li>\n<p><strong>Uncertainty sampling</strong><br>\n• Select examples whose predictions are most uncertain<br>\n• The highest class prediction score is close to random ( 1/n)</p>\n</li>\n</ul>\n<p>模型选择置信度偏向于随机的样本让人来判断。然后放进模型区训练再预测再判断‘难’的数据。</p>\n<ul>\n<li><strong>Query-by-committee</strong><br>\n• Trains multiple models and select samples that models disagree with 1/n</li>\n</ul>\n<p>多个模型投票来确定哪些数据比较‘难’</p>\n<h3 id=\"3-Active-Learning-Self-training\">3 Active Learning + Self-training</h3>\n<p>混合使用</p>\n<p><img src=\"https://picture.mulindya.com/pML1.4-3.png\" alt=\"\"></p>\n<h3 id=\"质量控制\">质量控制</h3>\n<p>可能出现误标或者出现标注并不精确的情况</p>\n<h4 id=\"Weak-Supervision-弱监督学习\">Weak Supervision 弱监督学习</h4>\n<ul>\n<li>\n<p>Semi-automatically generate labels<br>\n• Less accurate than manual ones, but good enough for training</p>\n</li>\n<li>\n<p><strong>Data programming</strong>:</p>\n</li>\n</ul>\n<p>总结规律规则编程<br>\n• Domain specific heuristics to assign labels<br>\n• Keyword search, pattern matching, third-party models<br>\n• E.g. rules to check if YouTube comments are spam or ham</p>\n<blockquote>\n<p>什么是弱监督学习呢？弱监督学习可以分为三种典型的类型，不完全监督（Incomplete supervision），不确切监督（Inexact supervision），不精确监督（Inaccurate supervision）。</p>\n<ul>\n<li>\n<p>不完全监督是指，训练数据中只有一部分数据被给了标签，有一些数据是没有标签的。</p>\n</li>\n<li>\n<p>不确切监督是指，训练数据只给出了粗粒度标签。我们可以把输入想象成一个包，这个包里面有一些示例，我们只知道这个包的标签，Y或N，但是我们不知道每个示例的标签。</p>\n</li>\n<li>\n<p>不精确监督是指，给出的标签不总是正确的，比如本来应该是Y的标签被错误标记成了N。</p>\n</li>\n</ul>\n<h5 id=\"解决方案\">解决方案</h5>\n<ul>\n<li>为了解决不完全监督，我们可以考虑两种主要技术，主动学习和半监督学习。一种是有人类干预的，一种是没有人类干预的。</li>\n<li>为了解决不确切监督，我们可以考虑多示例学习。</li>\n<li>为了解决不精确监督，我们考虑带噪学习。</li>\n</ul>\n</blockquote>\n"},{"title":"praticalML第四章笔记","date":"2022-01-17T07:31:26.000Z","math":true,"_content":"\n> 斯坦福2021秋季的实用机器学习上线啦~ :wink: 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。\n\n# 第四章\n\n## 4.1 模型评估\n\nP来源于data采样得到模型之后得到预测，这个新的预测是更加关心的。\n\n给定数据给定 超参数 已经获取到模型\n\n- **Loss measures** how good the model in predicting the outcome in supervised learning \n-  Other metrics to evaluate the model performance \n  • Model specific: e.g. accuracy for classification, mAP for object detection \n  • Business specific: e.g. revenue, inference latency \n-  We select models by multiple metrics  \n  • Just like how you choose cars\n\n在监督学习中损失value是一个好的指标，除此之外，还有其他的精度比如acc，mAP，商业相关指标（营收增长，流量），我们会衡量多个指标来判断模型好坏。\n\n### 4.1.1 常见分类指标\n\n- 准确率Accuracy: # correct predictions / # examples  得到的y中有多少正确预测了\t\n\n    ```python\n    sum(y==y_hat)/y.size\n    ```\n\n- 精度Precision: # True positive / # (True positive + False positive) \n\n  负类数据远大于正类，并且更关注正类时，acc就不适用了。\n\n  precision对于预测具体真实类别（正例），哪些被正确预测了。判断为正例的置信度很大，也就是对正例判断越严谨精度越大。\n\n    ```python\n    sum((y_hat==1)&(y==1))/sum(y_hat==1)\n    ```\n\n- 召回率Recall: # True positive / # Positive examples \n\n  在所有的正类中有多少被预测出来了，也就是考虑覆盖性的问题，是否所有的正例都被预测出来了。\n\n  ```python\n  sum((y_hat==1)&(y==1))/sum(y==1)\n  ```\n\n- One metric that balances precision and recall  精度和召回率的权衡\n\n    • **F1**: the harmonic mean of precision and recall: **2pr /( p + r)**\n\n#### AUC-ROC\n\n-  AUC，the area uder ROC curve，measures the chance a  model can distinguish classees.\n\n- choose various $\\theta$,predict as pos if $\\hat{y} \\geq \\theta$ else neg\n\n  实际生产当中，$ \\theta $是需要选取调节的\n\n  ROC曲线的\n\n  x轴是 分母是负例样本 分子是预测成正例的负例样本数\n\n  y轴是 正例的召回率 分母是所有的正类 分子是预测正确的正类样本数\n\n  ![](https://picture.mulindya.com/pML4-1.png)\n\nAUC是表示ROC下的面积，取值范围是[0,1]\n\n![](https://picture.mulindya.com/pML4-2.png)\n\n#### 商业指标\n\n-  Optimize both revenue and customer experience \n  • Latency: ads should be shown to users at the same time as others   \n  • ASN: average #ads shown in a page \n  • CTR: actual user click through rate \n  • ACP: average price advertiser pays per click \n-  revenue = #pageviews   ASN   CTR   ACP\n\nLatency表示在多久在页面显示，一般控制在500ms之内，包括模型计算预测部署的时间\n\nASN 每一页投放的广告数量\n\nCTR 上线之后点击频率\n\nACP 每一个广告点击，广告主的支付费用\n\n#### 4.1.2 模型->商业评估\n\n-  The key model metric is AUC \n-  A new model with increased AUC may harm business metrics, possible reasons: \n  • Lower estimated CTR   less ads displayed \n  • Lower real CTR because we trained and evaluated on past data \n  • Lower prices \n- Online experiment: deploy models to evaluate on real traffic data\n\n实际上只看auc是不够的，需要各种权衡和模拟。\n\n### 4.1.3 总结\n\n-  We evaluate models with multiple metrics \n-  Model metrics evaluate model performance on examples \n  • E.g. accuracy, precision, recall, F1, AUC for classification models  \n-  Business metrics measure how models impact the product\n\n## 4.2 过拟合&欠拟合\n\n### 4.2.1 训练误差 泛化误差\n\n• **Training error**: model error on the training data \n• **Generalization error**: model error on new data\n\n![](https://picture.mulindya.com/pML4-3.png)\n\n### 4.2.2 原因\n\n![](https://picture.mulindya.com/pML4-4.png)\n\n数据复杂性 VS 模型复杂性\n\n两者的复杂性越对等越好；\n\n![](https://picture.mulindya.com/pML4-5.png)\n\n数据简单 and 模型复杂就会导致过拟合\n\n数据比模型更复杂，模型不能拟合数据，就会导致欠拟合。\n\n### 4.2.3 模型复杂度\n\n- The capacity of a set of function to fit data points \n- In ML, model complexity usually refers to: \n  • The number of learnable parameters  \n  • The value range for those parameters \n-  It’s hard to compare between different types of ML models \n  • E.g. trees vs neural network \n-  More precisely measure of complexity: VC dimension \n  • VC dim for classification model: the maximum number of examples the model can shatter\n\n模型复杂性可以描述为拟合各种函数的能力，很难比较模型之间的复杂度(比如树和神经网络)，通常参数越多，每层的参数范围越大，模型越复杂.\n\n### 4.2.4 产生的影响\n\n![](https://picture.mulindya.com/ParacticeML4-1-1.png)\n\n固定数据，选取不同的复杂性的模型，可以看到模型越复杂越容易过拟合，越简单会导致欠拟合，最好的情况是泛化误差最小的时候，但是在最优解处也是存在过拟合的。\n\n#### 具体例子\n\n将买房的数据切分得到训练集和验证集，使用`scikit-learn`中的`DecisionTreeRegressor`（决策树回归器）树的深度为x轴，y为错误率。\n\n![](https://picture.mulindya.com/ParacticeML4-1-2.png)\n\n\n\n### 4.2.5 数据复杂度\n\n-  Multiple factors matters\n\n  • # of examples\n\n  • # of features in each example\n\n  • time/space structure\n\n  • diversity\n\n-  Again, hard to compare among very different data\n\n  • E.g a char vs a pixel \n\n-  More precisely, Kolmogorov complexity \n\n  • A data is simple if it can be generated by a short program\n\n多样性，时序结构，空间结构的复杂性；一般可以比较类似的数据集的复杂度；\n\n### 4.2.6 Data VS Model\n\n![](https://picture.mulindya.com/ParacticeML4-1-3.png)\n\n随着数据的复杂性都会使得模型的泛化能力增加，误差减少。\n\n蓝色是简单模型，绿色是复杂模型；在起始状态，复杂模型容易过拟合，所以泛化能力较差；但是数据越复杂复杂模型训练会比简单的模型效果更好。因此当数据比较简单时，使用简单模型就可以了，随着数据量变大，可以来匹配更复杂的模型这样泛化误差更小。\n\n#### 泛化误差\n\n-  Generalization error bound (an informal statement)\n\n  {% raw %}\n  $$\n  |error \\ on \\ unseen \\ data - training \\ error| \\le \\sqrt{\\frac{D}{N}(log(\\frac{2N}{D}+1))}\n  $$\n  {% endraw %}\n\n  • D: VC-dim, N: number of training examples\n\n- Generalization error also depends on the training algorithm\n\n  • Adding regularization can penalize complex models\n\n  • Model trained with stochastic gradient methods generalizes better\n\n泛化误差与训练误差之间的差距不超过某个值，这个值和训练算法有关，可以加入正则化项和惩罚模型，可以使用SGD的方法来训练。\n\n### 4.2.7 模型选择\n\n- Pick a model with a proper complexity for your data\n\n  • Minimize the generalization error \n\n  • Also consider business metrics\n\n-  Pick up a model family, then select proper hyper-parameters 调参\n\n   • Trees: #trees, maximal depths \n\n  • Neural networks: architecture, depth (#layers), width (#hidden units), regularizations\n\n需要选择和数据合适复杂度的模型，同时考虑商业指标。\n\n### 4.2.8 总结\n\n- 我们更关注泛化误差而不是训练误差；\n- 复杂度：函数/信息量越大，复杂度越高；\n- 模型选择：数据复杂度和模型复杂度的匹配。\n\n## 4.3 模型验证\n\n主要讲解了validate数据集和test数据集，评估泛化误差使用验证集，最后使用测试集。\n\n数据足够多，可以选取一半的数据作为验证；\n\n数据不多可以选取10%，20%作为验证集；\n\n### 4.3.1 非独立同分布数据切分\n\n一般随机分数据不可行，除非数据独立同分布。\n\n- Random data splitting may lead to underestimate of generalization error\n\n- Sequential data 买房，股票信息都有时序信息的 \n\n​\t• e.g. house sales, stock prices\n\n​\t• Valid set should not overlap with train set in time 重复信息 比如人脸识别，在分数据的时候同一张脸出现在训练集和测试集之中，这是不符合规范的。\n\n- Examples are highly clustered 类别数量不均衡\n\n  • e.g. photos of the same person, clips of the same video\n\n   • Split clusters instead of examples\n\n-  Highly imbalanced label classes\n\n  • Sample more from minor classes\n\n需要保证验证集样本在训练集之后，同时保证数据集没有重复的（可以首先在组信息分割）。\n\n#### 反向实例\n\n![](https://picture.mulindya.com/ParacticeML4-3-1.png)\n\n\n\n第一幅图是前面一半的时间的样本数据训练，后面的时间样本数据预测；\n\n第二幅图是随机挑选数据来训练和预测。\n\n通过决策树查看训练，分析过拟合的出现；比较两者，在随机挑选得数据中过拟合发生得晚一些，它可以获取更加整体得细节，前者过度拟合了局部信息。\n\n在线性回归上更加明显，使用顺序的数据在验证集上偏差很大。\n\n### 4.3.2 K-fold Cross Validation\n\n![](https://picture.mulindya.com/ParacticeML4-3-2.png)\n\n当数据不充足时可以使用K折交叉验证。把数据切成K份，然后选取k-1份训练另外一份来验证，再去k个验证误差来做平均得到验证集误差。一般K选择5或则10。比如K为5时，80%数据训练，20%数据验证，重复5次得到验证集误差。数据比较少的时候可以选择10，也就是在90%数据训练，10%数据验证。代价是重复更多的次数。\n\n### 4.3.3 Bug\n\n• If your ML model performance is too good to be true, very likely there is a bug, and contaminated valid set is the #1 reason\n\n- Valid set has examples from train set\n\n  • duplicated examples from original set\n\n  • Often happens when integrating multiple datasets\n\n  ​\t• Scrape images from search engine to evaluate models trained on ImageNet \n\n-  Information leaking from train set to valid set\n\n  • Often happens for non I.I.D data\n\n  • use future to predict past, see a person’s face before\n\n  • Excessive use of valid set for hyper param tuning is cheating\n\n表现效果特别好，有时可能出现了bug；需要检查一下：\n\n1. 验证集和训练集可能会有重叠；\n2. 在数据融合时出现了数据泄露；\n\n### 4.3.4 总结\n\n-  The test data is used once to evaluate your model\n\n- One can hold out a validation set from the training data to estimate the test data\n\n   • You can use valid set multiple times for model selections and hyper param tuning\n\n  • Validation data should be close to the test data\n\n  • Improper valid set is a common mistake that lead to over estimate of the model performance\n\n验证集要尽量的选取真实数据。\n","source":"_posts/学习笔记/实用机器学习/PracticeML4.md","raw":"---\ntitle: praticalML第四章笔记\ntags: [李沐,机器学习]\ncategories: [学习笔记，机器学习]\ndate: 2022-01-17 15:31:26\nmath: true\n---\n\n> 斯坦福2021秋季的实用机器学习上线啦~ :wink: 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。\n\n# 第四章\n\n## 4.1 模型评估\n\nP来源于data采样得到模型之后得到预测，这个新的预测是更加关心的。\n\n给定数据给定 超参数 已经获取到模型\n\n- **Loss measures** how good the model in predicting the outcome in supervised learning \n-  Other metrics to evaluate the model performance \n  • Model specific: e.g. accuracy for classification, mAP for object detection \n  • Business specific: e.g. revenue, inference latency \n-  We select models by multiple metrics  \n  • Just like how you choose cars\n\n在监督学习中损失value是一个好的指标，除此之外，还有其他的精度比如acc，mAP，商业相关指标（营收增长，流量），我们会衡量多个指标来判断模型好坏。\n\n### 4.1.1 常见分类指标\n\n- 准确率Accuracy: # correct predictions / # examples  得到的y中有多少正确预测了\t\n\n    ```python\n    sum(y==y_hat)/y.size\n    ```\n\n- 精度Precision: # True positive / # (True positive + False positive) \n\n  负类数据远大于正类，并且更关注正类时，acc就不适用了。\n\n  precision对于预测具体真实类别（正例），哪些被正确预测了。判断为正例的置信度很大，也就是对正例判断越严谨精度越大。\n\n    ```python\n    sum((y_hat==1)&(y==1))/sum(y_hat==1)\n    ```\n\n- 召回率Recall: # True positive / # Positive examples \n\n  在所有的正类中有多少被预测出来了，也就是考虑覆盖性的问题，是否所有的正例都被预测出来了。\n\n  ```python\n  sum((y_hat==1)&(y==1))/sum(y==1)\n  ```\n\n- One metric that balances precision and recall  精度和召回率的权衡\n\n    • **F1**: the harmonic mean of precision and recall: **2pr /( p + r)**\n\n#### AUC-ROC\n\n-  AUC，the area uder ROC curve，measures the chance a  model can distinguish classees.\n\n- choose various $\\theta$,predict as pos if $\\hat{y} \\geq \\theta$ else neg\n\n  实际生产当中，$ \\theta $是需要选取调节的\n\n  ROC曲线的\n\n  x轴是 分母是负例样本 分子是预测成正例的负例样本数\n\n  y轴是 正例的召回率 分母是所有的正类 分子是预测正确的正类样本数\n\n  ![](https://picture.mulindya.com/pML4-1.png)\n\nAUC是表示ROC下的面积，取值范围是[0,1]\n\n![](https://picture.mulindya.com/pML4-2.png)\n\n#### 商业指标\n\n-  Optimize both revenue and customer experience \n  • Latency: ads should be shown to users at the same time as others   \n  • ASN: average #ads shown in a page \n  • CTR: actual user click through rate \n  • ACP: average price advertiser pays per click \n-  revenue = #pageviews   ASN   CTR   ACP\n\nLatency表示在多久在页面显示，一般控制在500ms之内，包括模型计算预测部署的时间\n\nASN 每一页投放的广告数量\n\nCTR 上线之后点击频率\n\nACP 每一个广告点击，广告主的支付费用\n\n#### 4.1.2 模型->商业评估\n\n-  The key model metric is AUC \n-  A new model with increased AUC may harm business metrics, possible reasons: \n  • Lower estimated CTR   less ads displayed \n  • Lower real CTR because we trained and evaluated on past data \n  • Lower prices \n- Online experiment: deploy models to evaluate on real traffic data\n\n实际上只看auc是不够的，需要各种权衡和模拟。\n\n### 4.1.3 总结\n\n-  We evaluate models with multiple metrics \n-  Model metrics evaluate model performance on examples \n  • E.g. accuracy, precision, recall, F1, AUC for classification models  \n-  Business metrics measure how models impact the product\n\n## 4.2 过拟合&欠拟合\n\n### 4.2.1 训练误差 泛化误差\n\n• **Training error**: model error on the training data \n• **Generalization error**: model error on new data\n\n![](https://picture.mulindya.com/pML4-3.png)\n\n### 4.2.2 原因\n\n![](https://picture.mulindya.com/pML4-4.png)\n\n数据复杂性 VS 模型复杂性\n\n两者的复杂性越对等越好；\n\n![](https://picture.mulindya.com/pML4-5.png)\n\n数据简单 and 模型复杂就会导致过拟合\n\n数据比模型更复杂，模型不能拟合数据，就会导致欠拟合。\n\n### 4.2.3 模型复杂度\n\n- The capacity of a set of function to fit data points \n- In ML, model complexity usually refers to: \n  • The number of learnable parameters  \n  • The value range for those parameters \n-  It’s hard to compare between different types of ML models \n  • E.g. trees vs neural network \n-  More precisely measure of complexity: VC dimension \n  • VC dim for classification model: the maximum number of examples the model can shatter\n\n模型复杂性可以描述为拟合各种函数的能力，很难比较模型之间的复杂度(比如树和神经网络)，通常参数越多，每层的参数范围越大，模型越复杂.\n\n### 4.2.4 产生的影响\n\n![](https://picture.mulindya.com/ParacticeML4-1-1.png)\n\n固定数据，选取不同的复杂性的模型，可以看到模型越复杂越容易过拟合，越简单会导致欠拟合，最好的情况是泛化误差最小的时候，但是在最优解处也是存在过拟合的。\n\n#### 具体例子\n\n将买房的数据切分得到训练集和验证集，使用`scikit-learn`中的`DecisionTreeRegressor`（决策树回归器）树的深度为x轴，y为错误率。\n\n![](https://picture.mulindya.com/ParacticeML4-1-2.png)\n\n\n\n### 4.2.5 数据复杂度\n\n-  Multiple factors matters\n\n  • # of examples\n\n  • # of features in each example\n\n  • time/space structure\n\n  • diversity\n\n-  Again, hard to compare among very different data\n\n  • E.g a char vs a pixel \n\n-  More precisely, Kolmogorov complexity \n\n  • A data is simple if it can be generated by a short program\n\n多样性，时序结构，空间结构的复杂性；一般可以比较类似的数据集的复杂度；\n\n### 4.2.6 Data VS Model\n\n![](https://picture.mulindya.com/ParacticeML4-1-3.png)\n\n随着数据的复杂性都会使得模型的泛化能力增加，误差减少。\n\n蓝色是简单模型，绿色是复杂模型；在起始状态，复杂模型容易过拟合，所以泛化能力较差；但是数据越复杂复杂模型训练会比简单的模型效果更好。因此当数据比较简单时，使用简单模型就可以了，随着数据量变大，可以来匹配更复杂的模型这样泛化误差更小。\n\n#### 泛化误差\n\n-  Generalization error bound (an informal statement)\n\n  {% raw %}\n  $$\n  |error \\ on \\ unseen \\ data - training \\ error| \\le \\sqrt{\\frac{D}{N}(log(\\frac{2N}{D}+1))}\n  $$\n  {% endraw %}\n\n  • D: VC-dim, N: number of training examples\n\n- Generalization error also depends on the training algorithm\n\n  • Adding regularization can penalize complex models\n\n  • Model trained with stochastic gradient methods generalizes better\n\n泛化误差与训练误差之间的差距不超过某个值，这个值和训练算法有关，可以加入正则化项和惩罚模型，可以使用SGD的方法来训练。\n\n### 4.2.7 模型选择\n\n- Pick a model with a proper complexity for your data\n\n  • Minimize the generalization error \n\n  • Also consider business metrics\n\n-  Pick up a model family, then select proper hyper-parameters 调参\n\n   • Trees: #trees, maximal depths \n\n  • Neural networks: architecture, depth (#layers), width (#hidden units), regularizations\n\n需要选择和数据合适复杂度的模型，同时考虑商业指标。\n\n### 4.2.8 总结\n\n- 我们更关注泛化误差而不是训练误差；\n- 复杂度：函数/信息量越大，复杂度越高；\n- 模型选择：数据复杂度和模型复杂度的匹配。\n\n## 4.3 模型验证\n\n主要讲解了validate数据集和test数据集，评估泛化误差使用验证集，最后使用测试集。\n\n数据足够多，可以选取一半的数据作为验证；\n\n数据不多可以选取10%，20%作为验证集；\n\n### 4.3.1 非独立同分布数据切分\n\n一般随机分数据不可行，除非数据独立同分布。\n\n- Random data splitting may lead to underestimate of generalization error\n\n- Sequential data 买房，股票信息都有时序信息的 \n\n​\t• e.g. house sales, stock prices\n\n​\t• Valid set should not overlap with train set in time 重复信息 比如人脸识别，在分数据的时候同一张脸出现在训练集和测试集之中，这是不符合规范的。\n\n- Examples are highly clustered 类别数量不均衡\n\n  • e.g. photos of the same person, clips of the same video\n\n   • Split clusters instead of examples\n\n-  Highly imbalanced label classes\n\n  • Sample more from minor classes\n\n需要保证验证集样本在训练集之后，同时保证数据集没有重复的（可以首先在组信息分割）。\n\n#### 反向实例\n\n![](https://picture.mulindya.com/ParacticeML4-3-1.png)\n\n\n\n第一幅图是前面一半的时间的样本数据训练，后面的时间样本数据预测；\n\n第二幅图是随机挑选数据来训练和预测。\n\n通过决策树查看训练，分析过拟合的出现；比较两者，在随机挑选得数据中过拟合发生得晚一些，它可以获取更加整体得细节，前者过度拟合了局部信息。\n\n在线性回归上更加明显，使用顺序的数据在验证集上偏差很大。\n\n### 4.3.2 K-fold Cross Validation\n\n![](https://picture.mulindya.com/ParacticeML4-3-2.png)\n\n当数据不充足时可以使用K折交叉验证。把数据切成K份，然后选取k-1份训练另外一份来验证，再去k个验证误差来做平均得到验证集误差。一般K选择5或则10。比如K为5时，80%数据训练，20%数据验证，重复5次得到验证集误差。数据比较少的时候可以选择10，也就是在90%数据训练，10%数据验证。代价是重复更多的次数。\n\n### 4.3.3 Bug\n\n• If your ML model performance is too good to be true, very likely there is a bug, and contaminated valid set is the #1 reason\n\n- Valid set has examples from train set\n\n  • duplicated examples from original set\n\n  • Often happens when integrating multiple datasets\n\n  ​\t• Scrape images from search engine to evaluate models trained on ImageNet \n\n-  Information leaking from train set to valid set\n\n  • Often happens for non I.I.D data\n\n  • use future to predict past, see a person’s face before\n\n  • Excessive use of valid set for hyper param tuning is cheating\n\n表现效果特别好，有时可能出现了bug；需要检查一下：\n\n1. 验证集和训练集可能会有重叠；\n2. 在数据融合时出现了数据泄露；\n\n### 4.3.4 总结\n\n-  The test data is used once to evaluate your model\n\n- One can hold out a validation set from the training data to estimate the test data\n\n   • You can use valid set multiple times for model selections and hyper param tuning\n\n  • Validation data should be close to the test data\n\n  • Improper valid set is a common mistake that lead to over estimate of the model performance\n\n验证集要尽量的选取真实数据。\n","slug":"学习笔记/实用机器学习/PracticeML4","published":1,"updated":"2022-01-18T11:25:58.365Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0cx007zast916k1bln1","content":"<blockquote>\n<p>斯坦福2021秋季的实用机器学习上线啦~ 😉 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。</p>\n</blockquote>\n<h1>第四章</h1>\n<h2 id=\"4-1-模型评估\">4.1 模型评估</h2>\n<p>P来源于data采样得到模型之后得到预测，这个新的预测是更加关心的。</p>\n<p>给定数据给定 超参数 已经获取到模型</p>\n<ul>\n<li><strong>Loss measures</strong> how good the model in predicting the outcome in supervised learning</li>\n<li>Other metrics to evaluate the model performance<br>\n• Model specific: e.g. accuracy for classification, mAP for object detection<br>\n• Business specific: e.g. revenue, inference latency</li>\n<li>We select models by multiple metrics<br>\n• Just like how you choose cars</li>\n</ul>\n<p>在监督学习中损失value是一个好的指标，除此之外，还有其他的精度比如acc，mAP，商业相关指标（营收增长，流量），我们会衡量多个指标来判断模型好坏。</p>\n<h3 id=\"4-1-1-常见分类指标\">4.1.1 常见分类指标</h3>\n<ul>\n<li>\n<p>准确率Accuracy: # correct predictions / # examples  得到的y中有多少正确预测了</p>\n  <figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">sum</span>(y==y_hat)/y.size<br></code></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>精度Precision: # True positive / # (True positive + False positive)</p>\n<p>负类数据远大于正类，并且更关注正类时，acc就不适用了。</p>\n<p>precision对于预测具体真实类别（正例），哪些被正确预测了。判断为正例的置信度很大，也就是对正例判断越严谨精度越大。</p>\n  <figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">sum</span>((y_hat==<span class=\"hljs-number\">1</span>)&amp;(y==<span class=\"hljs-number\">1</span>))/<span class=\"hljs-built_in\">sum</span>(y_hat==<span class=\"hljs-number\">1</span>)<br></code></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>召回率Recall: # True positive / # Positive examples</p>\n<p>在所有的正类中有多少被预测出来了，也就是考虑覆盖性的问题，是否所有的正例都被预测出来了。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">sum</span>((y_hat==<span class=\"hljs-number\">1</span>)&amp;(y==<span class=\"hljs-number\">1</span>))/<span class=\"hljs-built_in\">sum</span>(y==<span class=\"hljs-number\">1</span>)<br></code></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>One metric that balances precision and recall  精度和召回率的权衡</p>\n<p>• <strong>F1</strong>: the harmonic mean of precision and recall: <strong>2pr /( p + r)</strong></p>\n</li>\n</ul>\n<h4 id=\"AUC-ROC\">AUC-ROC</h4>\n<ul>\n<li>\n<p>AUC，the area uder ROC curve，measures the chance a  model can distinguish classees.</p>\n</li>\n<li>\n<p>choose various $\\theta$,predict as pos if $\\hat{y} \\geq \\theta$ else neg</p>\n<p>实际生产当中，$ \\theta $是需要选取调节的</p>\n<p>ROC曲线的</p>\n<p>x轴是 分母是负例样本 分子是预测成正例的负例样本数</p>\n<p>y轴是 正例的召回率 分母是所有的正类 分子是预测正确的正类样本数</p>\n<p><img src=\"https://picture.mulindya.com/pML4-1.png\" alt=\"\"></p>\n</li>\n</ul>\n<p>AUC是表示ROC下的面积，取值范围是[0,1]</p>\n<p><img src=\"https://picture.mulindya.com/pML4-2.png\" alt=\"\"></p>\n<h4 id=\"商业指标\">商业指标</h4>\n<ul>\n<li>Optimize both revenue and customer experience<br>\n• Latency: ads should be shown to users at the same time as others<br>\n• ASN: average #ads shown in a page<br>\n• CTR: actual user click through rate<br>\n• ACP: average price advertiser pays per click</li>\n<li>revenue = #pageviews   ASN   CTR   ACP</li>\n</ul>\n<p>Latency表示在多久在页面显示，一般控制在500ms之内，包括模型计算预测部署的时间</p>\n<p>ASN 每一页投放的广告数量</p>\n<p>CTR 上线之后点击频率</p>\n<p>ACP 每一个广告点击，广告主的支付费用</p>\n<h4 id=\"4-1-2-模型-商业评估\">4.1.2 模型-&gt;商业评估</h4>\n<ul>\n<li>The key model metric is AUC</li>\n<li>A new model with increased AUC may harm business metrics, possible reasons:<br>\n• Lower estimated CTR   less ads displayed<br>\n• Lower real CTR because we trained and evaluated on past data<br>\n• Lower prices</li>\n<li>Online experiment: deploy models to evaluate on real traffic data</li>\n</ul>\n<p>实际上只看auc是不够的，需要各种权衡和模拟。</p>\n<h3 id=\"4-1-3-总结\">4.1.3 总结</h3>\n<ul>\n<li>We evaluate models with multiple metrics</li>\n<li>Model metrics evaluate model performance on examples<br>\n• E.g. accuracy, precision, recall, F1, AUC for classification models</li>\n<li>Business metrics measure how models impact the product</li>\n</ul>\n<h2 id=\"4-2-过拟合-欠拟合\">4.2 过拟合&amp;欠拟合</h2>\n<h3 id=\"4-2-1-训练误差-泛化误差\">4.2.1 训练误差 泛化误差</h3>\n<p>• <strong>Training error</strong>: model error on the training data<br>\n• <strong>Generalization error</strong>: model error on new data</p>\n<p><img src=\"https://picture.mulindya.com/pML4-3.png\" alt=\"\"></p>\n<h3 id=\"4-2-2-原因\">4.2.2 原因</h3>\n<p><img src=\"https://picture.mulindya.com/pML4-4.png\" alt=\"\"></p>\n<p>数据复杂性 VS 模型复杂性</p>\n<p>两者的复杂性越对等越好；</p>\n<p><img src=\"https://picture.mulindya.com/pML4-5.png\" alt=\"\"></p>\n<p>数据简单 and 模型复杂就会导致过拟合</p>\n<p>数据比模型更复杂，模型不能拟合数据，就会导致欠拟合。</p>\n<h3 id=\"4-2-3-模型复杂度\">4.2.3 模型复杂度</h3>\n<ul>\n<li>The capacity of a set of function to fit data points</li>\n<li>In ML, model complexity usually refers to:<br>\n• The number of learnable parameters<br>\n• The value range for those parameters</li>\n<li>It’s hard to compare between different types of ML models<br>\n• E.g. trees vs neural network</li>\n<li>More precisely measure of complexity: VC dimension<br>\n• VC dim for classification model: the maximum number of examples the model can shatter</li>\n</ul>\n<p>模型复杂性可以描述为拟合各种函数的能力，很难比较模型之间的复杂度(比如树和神经网络)，通常参数越多，每层的参数范围越大，模型越复杂.</p>\n<h3 id=\"4-2-4-产生的影响\">4.2.4 产生的影响</h3>\n<p><img src=\"https://picture.mulindya.com/ParacticeML4-1-1.png\" alt=\"\"></p>\n<p>固定数据，选取不同的复杂性的模型，可以看到模型越复杂越容易过拟合，越简单会导致欠拟合，最好的情况是泛化误差最小的时候，但是在最优解处也是存在过拟合的。</p>\n<h4 id=\"具体例子\">具体例子</h4>\n<p>将买房的数据切分得到训练集和验证集，使用<code>scikit-learn</code>中的<code>DecisionTreeRegressor</code>（决策树回归器）树的深度为x轴，y为错误率。</p>\n<p><img src=\"https://picture.mulindya.com/ParacticeML4-1-2.png\" alt=\"\"></p>\n<h3 id=\"4-2-5-数据复杂度\">4.2.5 数据复杂度</h3>\n<ul>\n<li>Multiple factors matters</li>\n</ul>\n<p>• # of examples</p>\n<p>• # of features in each example</p>\n<p>• time/space structure</p>\n<p>• diversity</p>\n<ul>\n<li>Again, hard to compare among very different data</li>\n</ul>\n<p>• E.g a char vs a pixel</p>\n<ul>\n<li>More precisely, Kolmogorov complexity</li>\n</ul>\n<p>• A data is simple if it can be generated by a short program</p>\n<p>多样性，时序结构，空间结构的复杂性；一般可以比较类似的数据集的复杂度；</p>\n<h3 id=\"4-2-6-Data-VS-Model\">4.2.6 Data VS Model</h3>\n<p><img src=\"https://picture.mulindya.com/ParacticeML4-1-3.png\" alt=\"\"></p>\n<p>随着数据的复杂性都会使得模型的泛化能力增加，误差减少。</p>\n<p>蓝色是简单模型，绿色是复杂模型；在起始状态，复杂模型容易过拟合，所以泛化能力较差；但是数据越复杂复杂模型训练会比简单的模型效果更好。因此当数据比较简单时，使用简单模型就可以了，随着数据量变大，可以来匹配更复杂的模型这样泛化误差更小。</p>\n<h4 id=\"泛化误差\">泛化误差</h4>\n<ul>\n<li>Generalization error bound (an informal statement)</li>\n</ul>\n  \n  $$\n  |error \\ on \\ unseen \\ data - training \\ error| \\le \\sqrt{\\frac{D}{N}(log(\\frac{2N}{D}+1))}\n  $$\n  \n<p>• D: VC-dim, N: number of training examples</p>\n<ul>\n<li>\n<p>Generalization error also depends on the training algorithm</p>\n<p>• Adding regularization can penalize complex models</p>\n<p>• Model trained with stochastic gradient methods generalizes better</p>\n</li>\n</ul>\n<p>泛化误差与训练误差之间的差距不超过某个值，这个值和训练算法有关，可以加入正则化项和惩罚模型，可以使用SGD的方法来训练。</p>\n<h3 id=\"4-2-7-模型选择\">4.2.7 模型选择</h3>\n<ul>\n<li>\n<p>Pick a model with a proper complexity for your data</p>\n<p>• Minimize the generalization error</p>\n<p>• Also consider business metrics</p>\n</li>\n<li>\n<p>Pick up a model family, then select proper hyper-parameters 调参</p>\n<p>• Trees: #trees, maximal depths</p>\n</li>\n</ul>\n<p>• Neural networks: architecture, depth (#layers), width (#hidden units), regularizations</p>\n<p>需要选择和数据合适复杂度的模型，同时考虑商业指标。</p>\n<h3 id=\"4-2-8-总结\">4.2.8 总结</h3>\n<ul>\n<li>我们更关注泛化误差而不是训练误差；</li>\n<li>复杂度：函数/信息量越大，复杂度越高；</li>\n<li>模型选择：数据复杂度和模型复杂度的匹配。</li>\n</ul>\n<h2 id=\"4-3-模型验证\">4.3 模型验证</h2>\n<p>主要讲解了validate数据集和test数据集，评估泛化误差使用验证集，最后使用测试集。</p>\n<p>数据足够多，可以选取一半的数据作为验证；</p>\n<p>数据不多可以选取10%，20%作为验证集；</p>\n<h3 id=\"4-3-1-非独立同分布数据切分\">4.3.1 非独立同分布数据切分</h3>\n<p>一般随机分数据不可行，除非数据独立同分布。</p>\n<ul>\n<li>\n<p>Random data splitting may lead to underestimate of generalization error</p>\n</li>\n<li>\n<p>Sequential data 买房，股票信息都有时序信息的</p>\n</li>\n</ul>\n<p>​\t• e.g. house sales, stock prices</p>\n<p>​\t• Valid set should not overlap with train set in time 重复信息 比如人脸识别，在分数据的时候同一张脸出现在训练集和测试集之中，这是不符合规范的。</p>\n<ul>\n<li>\n<p>Examples are highly clustered 类别数量不均衡</p>\n<p>• e.g. photos of the same person, clips of the same video</p>\n<p>• Split clusters instead of examples</p>\n</li>\n<li>\n<p>Highly imbalanced label classes</p>\n</li>\n</ul>\n<p>• Sample more from minor classes</p>\n<p>需要保证验证集样本在训练集之后，同时保证数据集没有重复的（可以首先在组信息分割）。</p>\n<h4 id=\"反向实例\">反向实例</h4>\n<p><img src=\"https://picture.mulindya.com/ParacticeML4-3-1.png\" alt=\"\"></p>\n<p>第一幅图是前面一半的时间的样本数据训练，后面的时间样本数据预测；</p>\n<p>第二幅图是随机挑选数据来训练和预测。</p>\n<p>通过决策树查看训练，分析过拟合的出现；比较两者，在随机挑选得数据中过拟合发生得晚一些，它可以获取更加整体得细节，前者过度拟合了局部信息。</p>\n<p>在线性回归上更加明显，使用顺序的数据在验证集上偏差很大。</p>\n<h3 id=\"4-3-2-K-fold-Cross-Validation\">4.3.2 K-fold Cross Validation</h3>\n<p><img src=\"https://picture.mulindya.com/ParacticeML4-3-2.png\" alt=\"\"></p>\n<p>当数据不充足时可以使用K折交叉验证。把数据切成K份，然后选取k-1份训练另外一份来验证，再去k个验证误差来做平均得到验证集误差。一般K选择5或则10。比如K为5时，80%数据训练，20%数据验证，重复5次得到验证集误差。数据比较少的时候可以选择10，也就是在90%数据训练，10%数据验证。代价是重复更多的次数。</p>\n<h3 id=\"4-3-3-Bug\">4.3.3 Bug</h3>\n<p>• If your ML model performance is too good to be true, very likely there is a bug, and contaminated valid set is the #1 reason</p>\n<ul>\n<li>\n<p>Valid set has examples from train set</p>\n<p>• duplicated examples from original set</p>\n<p>• Often happens when integrating multiple datasets</p>\n<p>​\t• Scrape images from search engine to evaluate models trained on ImageNet</p>\n</li>\n<li>\n<p>Information leaking from train set to valid set</p>\n</li>\n</ul>\n<p>• Often happens for non I.I.D data</p>\n<p>• use future to predict past, see a person’s face before</p>\n<p>• Excessive use of valid set for hyper param tuning is cheating</p>\n<p>表现效果特别好，有时可能出现了bug；需要检查一下：</p>\n<ol>\n<li>验证集和训练集可能会有重叠；</li>\n<li>在数据融合时出现了数据泄露；</li>\n</ol>\n<h3 id=\"4-3-4-总结\">4.3.4 总结</h3>\n<ul>\n<li>\n<p>The test data is used once to evaluate your model</p>\n</li>\n<li>\n<p>One can hold out a validation set from the training data to estimate the test data</p>\n<p>• You can use valid set multiple times for model selections and hyper param tuning</p>\n<p>• Validation data should be close to the test data</p>\n<p>• Improper valid set is a common mistake that lead to over estimate of the model performance</p>\n</li>\n</ul>\n<p>验证集要尽量的选取真实数据。</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>斯坦福2021秋季的实用机器学习上线啦~ 😉 跟着沐神复习机器学习冲冲冲！ 记录一下笔记和重点，不一定很全哦~，只是记录自我感觉的重点。</p>\n</blockquote>\n<h1>第四章</h1>\n<h2 id=\"4-1-模型评估\">4.1 模型评估</h2>\n<p>P来源于data采样得到模型之后得到预测，这个新的预测是更加关心的。</p>\n<p>给定数据给定 超参数 已经获取到模型</p>\n<ul>\n<li><strong>Loss measures</strong> how good the model in predicting the outcome in supervised learning</li>\n<li>Other metrics to evaluate the model performance<br>\n• Model specific: e.g. accuracy for classification, mAP for object detection<br>\n• Business specific: e.g. revenue, inference latency</li>\n<li>We select models by multiple metrics<br>\n• Just like how you choose cars</li>\n</ul>\n<p>在监督学习中损失value是一个好的指标，除此之外，还有其他的精度比如acc，mAP，商业相关指标（营收增长，流量），我们会衡量多个指标来判断模型好坏。</p>\n<h3 id=\"4-1-1-常见分类指标\">4.1.1 常见分类指标</h3>\n<ul>\n<li>\n<p>准确率Accuracy: # correct predictions / # examples  得到的y中有多少正确预测了</p>\n  <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">sum</span>(y==y_hat)/y.size<br></code></pre></td></tr></table></figure>\n</li>\n<li>\n<p>精度Precision: # True positive / # (True positive + False positive)</p>\n<p>负类数据远大于正类，并且更关注正类时，acc就不适用了。</p>\n<p>precision对于预测具体真实类别（正例），哪些被正确预测了。判断为正例的置信度很大，也就是对正例判断越严谨精度越大。</p>\n  <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">sum</span>((y_hat==<span class=\"hljs-number\">1</span>)&amp;(y==<span class=\"hljs-number\">1</span>))/<span class=\"hljs-built_in\">sum</span>(y_hat==<span class=\"hljs-number\">1</span>)<br></code></pre></td></tr></table></figure>\n</li>\n<li>\n<p>召回率Recall: # True positive / # Positive examples</p>\n<p>在所有的正类中有多少被预测出来了，也就是考虑覆盖性的问题，是否所有的正例都被预测出来了。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">sum</span>((y_hat==<span class=\"hljs-number\">1</span>)&amp;(y==<span class=\"hljs-number\">1</span>))/<span class=\"hljs-built_in\">sum</span>(y==<span class=\"hljs-number\">1</span>)<br></code></pre></td></tr></table></figure>\n</li>\n<li>\n<p>One metric that balances precision and recall  精度和召回率的权衡</p>\n<p>• <strong>F1</strong>: the harmonic mean of precision and recall: <strong>2pr /( p + r)</strong></p>\n</li>\n</ul>\n<h4 id=\"AUC-ROC\">AUC-ROC</h4>\n<ul>\n<li>\n<p>AUC，the area uder ROC curve，measures the chance a  model can distinguish classees.</p>\n</li>\n<li>\n<p>choose various $\\theta$,predict as pos if $\\hat{y} \\geq \\theta$ else neg</p>\n<p>实际生产当中，$ \\theta $是需要选取调节的</p>\n<p>ROC曲线的</p>\n<p>x轴是 分母是负例样本 分子是预测成正例的负例样本数</p>\n<p>y轴是 正例的召回率 分母是所有的正类 分子是预测正确的正类样本数</p>\n<p><img src=\"https://picture.mulindya.com/pML4-1.png\" alt=\"\"></p>\n</li>\n</ul>\n<p>AUC是表示ROC下的面积，取值范围是[0,1]</p>\n<p><img src=\"https://picture.mulindya.com/pML4-2.png\" alt=\"\"></p>\n<h4 id=\"商业指标\">商业指标</h4>\n<ul>\n<li>Optimize both revenue and customer experience<br>\n• Latency: ads should be shown to users at the same time as others<br>\n• ASN: average #ads shown in a page<br>\n• CTR: actual user click through rate<br>\n• ACP: average price advertiser pays per click</li>\n<li>revenue = #pageviews   ASN   CTR   ACP</li>\n</ul>\n<p>Latency表示在多久在页面显示，一般控制在500ms之内，包括模型计算预测部署的时间</p>\n<p>ASN 每一页投放的广告数量</p>\n<p>CTR 上线之后点击频率</p>\n<p>ACP 每一个广告点击，广告主的支付费用</p>\n<h4 id=\"4-1-2-模型-商业评估\">4.1.2 模型-&gt;商业评估</h4>\n<ul>\n<li>The key model metric is AUC</li>\n<li>A new model with increased AUC may harm business metrics, possible reasons:<br>\n• Lower estimated CTR   less ads displayed<br>\n• Lower real CTR because we trained and evaluated on past data<br>\n• Lower prices</li>\n<li>Online experiment: deploy models to evaluate on real traffic data</li>\n</ul>\n<p>实际上只看auc是不够的，需要各种权衡和模拟。</p>\n<h3 id=\"4-1-3-总结\">4.1.3 总结</h3>\n<ul>\n<li>We evaluate models with multiple metrics</li>\n<li>Model metrics evaluate model performance on examples<br>\n• E.g. accuracy, precision, recall, F1, AUC for classification models</li>\n<li>Business metrics measure how models impact the product</li>\n</ul>\n<h2 id=\"4-2-过拟合-欠拟合\">4.2 过拟合&amp;欠拟合</h2>\n<h3 id=\"4-2-1-训练误差-泛化误差\">4.2.1 训练误差 泛化误差</h3>\n<p>• <strong>Training error</strong>: model error on the training data<br>\n• <strong>Generalization error</strong>: model error on new data</p>\n<p><img src=\"https://picture.mulindya.com/pML4-3.png\" alt=\"\"></p>\n<h3 id=\"4-2-2-原因\">4.2.2 原因</h3>\n<p><img src=\"https://picture.mulindya.com/pML4-4.png\" alt=\"\"></p>\n<p>数据复杂性 VS 模型复杂性</p>\n<p>两者的复杂性越对等越好；</p>\n<p><img src=\"https://picture.mulindya.com/pML4-5.png\" alt=\"\"></p>\n<p>数据简单 and 模型复杂就会导致过拟合</p>\n<p>数据比模型更复杂，模型不能拟合数据，就会导致欠拟合。</p>\n<h3 id=\"4-2-3-模型复杂度\">4.2.3 模型复杂度</h3>\n<ul>\n<li>The capacity of a set of function to fit data points</li>\n<li>In ML, model complexity usually refers to:<br>\n• The number of learnable parameters<br>\n• The value range for those parameters</li>\n<li>It’s hard to compare between different types of ML models<br>\n• E.g. trees vs neural network</li>\n<li>More precisely measure of complexity: VC dimension<br>\n• VC dim for classification model: the maximum number of examples the model can shatter</li>\n</ul>\n<p>模型复杂性可以描述为拟合各种函数的能力，很难比较模型之间的复杂度(比如树和神经网络)，通常参数越多，每层的参数范围越大，模型越复杂.</p>\n<h3 id=\"4-2-4-产生的影响\">4.2.4 产生的影响</h3>\n<p><img src=\"https://picture.mulindya.com/ParacticeML4-1-1.png\" alt=\"\"></p>\n<p>固定数据，选取不同的复杂性的模型，可以看到模型越复杂越容易过拟合，越简单会导致欠拟合，最好的情况是泛化误差最小的时候，但是在最优解处也是存在过拟合的。</p>\n<h4 id=\"具体例子\">具体例子</h4>\n<p>将买房的数据切分得到训练集和验证集，使用<code>scikit-learn</code>中的<code>DecisionTreeRegressor</code>（决策树回归器）树的深度为x轴，y为错误率。</p>\n<p><img src=\"https://picture.mulindya.com/ParacticeML4-1-2.png\" alt=\"\"></p>\n<h3 id=\"4-2-5-数据复杂度\">4.2.5 数据复杂度</h3>\n<ul>\n<li>Multiple factors matters</li>\n</ul>\n<p>• # of examples</p>\n<p>• # of features in each example</p>\n<p>• time/space structure</p>\n<p>• diversity</p>\n<ul>\n<li>Again, hard to compare among very different data</li>\n</ul>\n<p>• E.g a char vs a pixel</p>\n<ul>\n<li>More precisely, Kolmogorov complexity</li>\n</ul>\n<p>• A data is simple if it can be generated by a short program</p>\n<p>多样性，时序结构，空间结构的复杂性；一般可以比较类似的数据集的复杂度；</p>\n<h3 id=\"4-2-6-Data-VS-Model\">4.2.6 Data VS Model</h3>\n<p><img src=\"https://picture.mulindya.com/ParacticeML4-1-3.png\" alt=\"\"></p>\n<p>随着数据的复杂性都会使得模型的泛化能力增加，误差减少。</p>\n<p>蓝色是简单模型，绿色是复杂模型；在起始状态，复杂模型容易过拟合，所以泛化能力较差；但是数据越复杂复杂模型训练会比简单的模型效果更好。因此当数据比较简单时，使用简单模型就可以了，随着数据量变大，可以来匹配更复杂的模型这样泛化误差更小。</p>\n<h4 id=\"泛化误差\">泛化误差</h4>\n<ul>\n<li>Generalization error bound (an informal statement)</li>\n</ul>\n  \n  $$\n  |error \\ on \\ unseen \\ data - training \\ error| \\le \\sqrt{\\frac{D}{N}(log(\\frac{2N}{D}+1))}\n  $$\n  \n<p>• D: VC-dim, N: number of training examples</p>\n<ul>\n<li>\n<p>Generalization error also depends on the training algorithm</p>\n<p>• Adding regularization can penalize complex models</p>\n<p>• Model trained with stochastic gradient methods generalizes better</p>\n</li>\n</ul>\n<p>泛化误差与训练误差之间的差距不超过某个值，这个值和训练算法有关，可以加入正则化项和惩罚模型，可以使用SGD的方法来训练。</p>\n<h3 id=\"4-2-7-模型选择\">4.2.7 模型选择</h3>\n<ul>\n<li>\n<p>Pick a model with a proper complexity for your data</p>\n<p>• Minimize the generalization error</p>\n<p>• Also consider business metrics</p>\n</li>\n<li>\n<p>Pick up a model family, then select proper hyper-parameters 调参</p>\n<p>• Trees: #trees, maximal depths</p>\n</li>\n</ul>\n<p>• Neural networks: architecture, depth (#layers), width (#hidden units), regularizations</p>\n<p>需要选择和数据合适复杂度的模型，同时考虑商业指标。</p>\n<h3 id=\"4-2-8-总结\">4.2.8 总结</h3>\n<ul>\n<li>我们更关注泛化误差而不是训练误差；</li>\n<li>复杂度：函数/信息量越大，复杂度越高；</li>\n<li>模型选择：数据复杂度和模型复杂度的匹配。</li>\n</ul>\n<h2 id=\"4-3-模型验证\">4.3 模型验证</h2>\n<p>主要讲解了validate数据集和test数据集，评估泛化误差使用验证集，最后使用测试集。</p>\n<p>数据足够多，可以选取一半的数据作为验证；</p>\n<p>数据不多可以选取10%，20%作为验证集；</p>\n<h3 id=\"4-3-1-非独立同分布数据切分\">4.3.1 非独立同分布数据切分</h3>\n<p>一般随机分数据不可行，除非数据独立同分布。</p>\n<ul>\n<li>\n<p>Random data splitting may lead to underestimate of generalization error</p>\n</li>\n<li>\n<p>Sequential data 买房，股票信息都有时序信息的</p>\n</li>\n</ul>\n<p>​\t• e.g. house sales, stock prices</p>\n<p>​\t• Valid set should not overlap with train set in time 重复信息 比如人脸识别，在分数据的时候同一张脸出现在训练集和测试集之中，这是不符合规范的。</p>\n<ul>\n<li>\n<p>Examples are highly clustered 类别数量不均衡</p>\n<p>• e.g. photos of the same person, clips of the same video</p>\n<p>• Split clusters instead of examples</p>\n</li>\n<li>\n<p>Highly imbalanced label classes</p>\n</li>\n</ul>\n<p>• Sample more from minor classes</p>\n<p>需要保证验证集样本在训练集之后，同时保证数据集没有重复的（可以首先在组信息分割）。</p>\n<h4 id=\"反向实例\">反向实例</h4>\n<p><img src=\"https://picture.mulindya.com/ParacticeML4-3-1.png\" alt=\"\"></p>\n<p>第一幅图是前面一半的时间的样本数据训练，后面的时间样本数据预测；</p>\n<p>第二幅图是随机挑选数据来训练和预测。</p>\n<p>通过决策树查看训练，分析过拟合的出现；比较两者，在随机挑选得数据中过拟合发生得晚一些，它可以获取更加整体得细节，前者过度拟合了局部信息。</p>\n<p>在线性回归上更加明显，使用顺序的数据在验证集上偏差很大。</p>\n<h3 id=\"4-3-2-K-fold-Cross-Validation\">4.3.2 K-fold Cross Validation</h3>\n<p><img src=\"https://picture.mulindya.com/ParacticeML4-3-2.png\" alt=\"\"></p>\n<p>当数据不充足时可以使用K折交叉验证。把数据切成K份，然后选取k-1份训练另外一份来验证，再去k个验证误差来做平均得到验证集误差。一般K选择5或则10。比如K为5时，80%数据训练，20%数据验证，重复5次得到验证集误差。数据比较少的时候可以选择10，也就是在90%数据训练，10%数据验证。代价是重复更多的次数。</p>\n<h3 id=\"4-3-3-Bug\">4.3.3 Bug</h3>\n<p>• If your ML model performance is too good to be true, very likely there is a bug, and contaminated valid set is the #1 reason</p>\n<ul>\n<li>\n<p>Valid set has examples from train set</p>\n<p>• duplicated examples from original set</p>\n<p>• Often happens when integrating multiple datasets</p>\n<p>​\t• Scrape images from search engine to evaluate models trained on ImageNet</p>\n</li>\n<li>\n<p>Information leaking from train set to valid set</p>\n</li>\n</ul>\n<p>• Often happens for non I.I.D data</p>\n<p>• use future to predict past, see a person’s face before</p>\n<p>• Excessive use of valid set for hyper param tuning is cheating</p>\n<p>表现效果特别好，有时可能出现了bug；需要检查一下：</p>\n<ol>\n<li>验证集和训练集可能会有重叠；</li>\n<li>在数据融合时出现了数据泄露；</li>\n</ol>\n<h3 id=\"4-3-4-总结\">4.3.4 总结</h3>\n<ul>\n<li>\n<p>The test data is used once to evaluate your model</p>\n</li>\n<li>\n<p>One can hold out a validation set from the training data to estimate the test data</p>\n<p>• You can use valid set multiple times for model selections and hyper param tuning</p>\n<p>• Validation data should be close to the test data</p>\n<p>• Improper valid set is a common mistake that lead to over estimate of the model performance</p>\n</li>\n</ul>\n<p>验证集要尽量的选取真实数据。</p>\n"},{"title":"Knowledge Distillation笔记","date":"2022-01-05T08:38:33.000Z","math":true,"_content":"\n> 因为项目中要使用到知识蒸馏来训练网络，所以先好好学一下它的原理。在网上找到了李宏毅机器学习的模型压缩中讲到了这个，那，就开始学习叭:wink:\n\n# 知识蒸馏:milky_way:\n\n## 概念\n\n先训练一个大的network（teacher），再根据这个network来制造小的network（student），同时student是根据teacher的结构做一些修剪得到的小网络，student network是根据teacher network来学习的哦。\n\n![](https://picture.mulindya.com/kDistillation-1.png)\n\nstudent network是去拟合teacher的结果，可以使用Ensemble的网络作为teacher，这样表现得结果更好。\n\n![](https://picture.mulindya.com/kDistillation-2.png)\n\n在使用知识蒸馏时有一个小技巧，可以稍微改一下Softmax的函数，T是一个超参数，可以使得函数点更加平滑。因为student要学习teacher给的结果，并且teacher给的结果要告诉student，哪些类别比较相似，而不是直接给出1，0，0（和真实结果没有差别），所以teacher 的输出不应该过度集中，需要更加平滑。这样分类结果不同，但是student学习更加有意义。同时不一定要用softmax之后的结果去拟合student，完全可以使用之前的，或者类似student的第6层拟合teacher的12层，第3层拟合teacher的第6层，这样结果往往会更好。\n\n## 实例:sunflower:\n\n### Intuition\n\n通常模型Teacher比模型Student更强，在模型Teacher的帮助下，模型student可以\"青出于蓝而胜于蓝\":wink:,因为从计算资源的角度上庞大的模型部署有很多问题，所以通过知识蒸馏可以训练一个相似的小模型去拟合大模型的训练效果，这样预测和部署会便捷很多。同时使用知识蒸馏的方法可以让小模型学到样本之间的相似关系。\n\n![](https://picture.mulindya.com/kDistillation-9.png)\n\n这里不仅仅知道西红柿是真实标签，还可以知道这个样本和柿子这个标签很相似，这样可以获取更多信息，这是蒸馏更有价值的地方。\n\n### Loss Function in Pytorch\n\n- `Softmax`：将一个数值序列映射到概率空间（每个元素分布并且所有和为1）\n- `log_softmax`：在softmax的基础上取对数\n- `NLLLoss`：对log_softmax与one-hot进行计算\n- `CrossEntropy`：衡量两个概率分布的差别（交叉熵）\n\n#### 代码实证\n\n```python\nimport torch\nimport torch.nn.functional as F\n'''\ntorch.nn.functional 涉及了所有 torch.nn 需要 类 和 方法 ，torch.nn 构建的模块通常就是调用 torch.nn.functional 里的方法实现的.\n'''\ntorch.manual_seed(0)\n```\n\n```python\noutput = torch.randn(2, 3)\nprint(output)\n#tensor([[ 1.5410, -0.2934, -2.1788],\n#        [ 0.5684, -1.0845, -1.3986]])\nprint(F.softmax(output, dim=1))\n# 这里dim的意思是计算Softmax的维度，这里设置dim=1，可以看到每一行的加和为1。0是对列 1 是对行\n#tensor([[0.8446, 0.1349, 0.0205],\n#       [0.7511, 0.1438, 0.1051]])\n```\n#### What is log_softmax\n\n这个很好理解，其实就是对`softmax`处理之后的结果执行一次对数运算。可以理解为 `log(softmax(output))`\n\n```python\nprint(F.log_softmax(output, dim=1))\nprint(torch.log(F.softmax(output, dim=1)))\n# 输出结果是一致的\n```\n\n> tensor([[-0.1689, -2.0033, -3.8886],        [-0.2862, -1.9392, -2.2532]]) tensor([[-0.1689, -2.0033, -3.8886],        [-0.2862, -1.9392, -2.2532]])\n>\n\n#### 损失函数\n\n#### What is NLLLoss？\n\n该函数的全称是`negative log likelihood loss`. 若$x_i=[q_1, q_2, ..., q_N]$ 为神经网络对第i个样本的输出值，$y_i$为真实标签。则：\n$$\nf(x_i,y_i)=-q_{y_i}\n$$\n其中输入：log_softmax(output), target\n\n```python\nprint(F.nll_loss(torch.tensor([[-1.2, -2, -3]]), torch.tensor([0])))\n#结果是tensor(1.2000) 就是取第0个的负数\n```\n\n**通常我们结合 log_softmax 和 nll_loss一起用** :wave:。\n\n#### CrossEntropy交叉熵\n\n**在分类问题中，CrossEntropy等价于log_softmax 结合 nll_loss**\n\n$N$分类问题，对于一个特定的样本，已知其真实标签，`CrossEntropy`的计算公式为：\n\n$$\ncross\\_entropy=-\\sum_{k=1}^{N}\\left(p_{k} * \\log q_{k}\\right)\n$$\n\n其中p表示真实值，在这个公式中是one-hot形式；q是经过`softmax`计算后的结果， $q_k$为神经网络认为该样本为第$k$类的概率。\n\n仔细观察可以知道，因为p的元素不是0就是1，而且又是乘法，所以很自然地我们如果知道1所对应的index，那么就不用做其他无意义的运算了。所以在pytorch代码中target不是以one-hot形式表示的，而是直接用scalar表示。若该样本的真实标签为$y$,则交叉熵的公式可变形为：\n\n$$cross\\_entropy=-\\sum_{k=1}^{N}\\left(p_{k} * \\log q_{k}\\right)=-log \\, q_{y}$$\n\n```python\noutput = torch.tensor([[1.2, 2, 3]])\ntarget = torch.tensor([0])\n\nlog_sm_output = F.log_softmax(output, dim=1)\nnll_loss_of_log_sm_output = F.nll_loss(log_sm_output, target)\nprint(nll_loss_of_log_sm_output)\n```\n\n```python\noutput = torch.tensor([[1.2, 2, 3]])\ntarget = torch.tensor([0])\n\nce_loss = F.cross_entropy(output, target)\nprint(ce_loss)\n\nF.cross_entropy 《==》 F.log_softmax(output, dim=1)+F.nll_loss(log_sm_output, target)\n```\n\n这两者是等价的哦~\n\n#### T-softmax\n\nT-softmax的目的是平滑分布，不让分布太过于极端。比如可以看下面的实例哈。\n\n```python\nimport numpy as np\n\ndef softmax(x):\n    x_exp = np.exp(x)\n    return x_exp / np.sum(x_exp)\n\noutput = np.array([0.1, 1.6, 3.6])\nprint(softmax(output))\n#[0.02590865 0.11611453 0.85797681]\n```\n\n```python\ndef softmax_t(x, t):\n    x_exp = np.exp(x / t)\n    return x_exp / np.sum(x_exp)\n\noutput = np.array([0.1, 1.6, 3.6])\nprint(softmax_t(output, 5))\n#[0.22916797 0.3093444  0.46148762]\n```\n\n设置为5可以看到分布在【0，1】的数更加平滑了哦~\n\n## KD训练代码\n\n### 导入包\n\n```python\nimport math\nimport torch\nimport torch.nn as nn\nimport torch.nn.functional as F\nfrom torchvision import datasets, transforms\nimport torch.utils.data\ntorch.manual_seed(0)\ntorch.cuda.manual_seed(0) #设置GPU生成随机数的种子，方便下次复现实验结果。\n```\n\n### 网络架构\n#### teacher网络\n\n```python\nclass TeacherNet(nn.Module): #继承Module\n    def __init__(self):\n        super(TeacherNet, self).__init__()\n        self.conv1 = nn.Conv2d(1, 32, 3, 1)\n        self.conv2 = nn.Conv2d(32, 64, 3, 1)\n        self.dropout1 = nn.Dropout2d(0.3)\n        self.dropout2 = nn.Dropout2d(0.5)\n        self.fc1 = nn.Linear(9216, 128)\n        self.fc2 = nn.Linear(128, 10)\n\n    def forward(self, x):\n        x = self.conv1(x)\n        x = F.relu(x)\n        x = self.conv2(x)\n        x = F.relu(x)\n        x = F.max_pool2d(x, 2)\n        x = self.dropout1(x)\n        x = torch.flatten(x, 1)\n        x = self.fc1(x)\n        x = F.relu(x)\n        x = self.dropout2(x)\n        output = self.fc2(x)\n        return output\n```\n#### student网络\n\n```python\nclass StudentNet(nn.Module):\n    def __init__(self):\n        super(StudentNet, self).__init__()\n        self.fc1 = nn.Linear(28 * 28, 128)\n        self.fc2 = nn.Linear(128, 64)\n        self.fc3 = nn.Linear(64, 10)\n\n    def forward(self, x):\n        x = torch.flatten(x, 1)\n        x = F.relu(self.fc1(x))\n        x = F.relu(self.fc2(x))\n        output = F.relu(self.fc3(x))\n        return output\n```\n\n### teacher网络训练\n#### 定义基本函数\n\n```python\ndef train_teacher(model, device, train_loader, optimizer, epoch):\n    model.train() #train过程model.train()的作用是启用 Batch Normalization 和 Dropout。model.train()是保证BN层能够用到每一批数据的均值和方差\n    trained_samples = 0\n    for batch_idx, (data, target) in enumerate(train_loader):\n        data, target = data.to(device), target.to(device) #放到GPU\n        optimizer.zero_grad() #归0\n        output = model(data) #得到结果\n        loss = F.cross_entropy(output, target) #计算损失 使用交叉熵\n        loss.backward() #后向传播更新参数\n        optimizer.step() #优化器调整超参数\n\n        trained_samples += len(data)\n        progress = math.ceil(batch_idx / len(train_loader) * 50)\n        print(\"\\rTrain epoch %d: %d/%d, [%-51s] %d%%\" %\n              (epoch, trained_samples, len(train_loader.dataset),\n               '-' * progress + '>', progress * 2), end='')\n\n\ndef test_teacher(model, device, test_loader):\n    model.eval() #保证BN层能够用全部训练数据的均值和方差\n    test_loss = 0\n    correct = 0\n    with torch.no_grad(): #冻结参数\n        for data, target in test_loader:\n            data, target = data.to(device), target.to(device)\n            output = model(data) #模型得到结果\n            test_loss += F.cross_entropy(output, target, reduction='sum').item()  # 统计所有的losssum up batch loss\n            pred = output.argmax(dim=1, keepdim=True)  # get the index of the max log-probability 得到每一行的最大值下标\n            correct += pred.eq(target.view_as(pred)).sum().item() #eq是一个判断函数 view_as是拉成一列\n\n    test_loss /= len(test_loader.dataset) #得到平均loss\n\n    print('\\nTest: average loss: {:.4f}, accuracy: {}/{} ({:.0f}%)'.format(\n        test_loss, correct, len(test_loader.dataset),\n        100. * correct / len(test_loader.dataset)))\n    return test_loss, correct / len(test_loader.dataset)\n\n```\n#### 训练主函数\n\n```python\ndef teacher_main():\n    epochs = 10\n    batch_size = 64\n    torch.manual_seed(0) #设置CPU生成随机数的种子，方便下次复现实验结果。\n\n    device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n\n    train_loader = torch.utils.data.DataLoader(\n        datasets.MNIST('../data/MNIST', train=True, download=True,\n                       transform=transforms.Compose([\n                           transforms.ToTensor(),\n                           transforms.Normalize((0.1307,), (0.3081,))\n                       ])),\n        batch_size=batch_size, shuffle=True)\n    test_loader = torch.utils.data.DataLoader(\n        datasets.MNIST('../data/MNIST', train=False, download=True, transform=transforms.Compose([\n            transforms.ToTensor(),\n            transforms.Normalize((0.1307,), (0.3081,))\n        ])),\n        batch_size=1000, shuffle=True)\n\n    model = TeacherNet().to(device) #模型装进GPU中\n    optimizer = torch.optim.Adadelta(model.parameters()) #定义优化器 其实需要传入模型参数让优化器知道参数空间\n    '''\n    optimzier优化器的作用：优化器就是需要根据网络反向传播的梯度信息来\n    再次更新网络的参数，以起到降低loss函数计算值的作用。\n    '''\n    \n    teacher_history = [] #保存历史数据\n\n    for epoch in range(1, epochs + 1):\n        train_teacher(model, device, train_loader, optimizer, epoch)\n        loss, acc = test_teacher(model, device, test_loader) #相当于验证集作用 也可以绘图\n        \n        teacher_history.append((loss, acc))\n\n    torch.save(model.state_dict(), \"teacher.pt\")\n    return model, teacher_history\n```\n\n```python\n# 训练教师网络\nteacher_model, teacher_history = teacher_main()\n```\n\n### student网络训练（重点）:cherry_blossom:\n\n#### 理论部分\n\n![](https://picture.mulindya.com/kDistillation-10.png)\n\n这里的q是经过了`softmax`之后的分布\n\nstudent的loss来源于两个部分，Loss将两个loss相加\n\n- studet的HARD Loss是根据one-hot的真实样本p分布得到（和一般的loss一样）\n- student的SOFT loss是来源于teacher的分布q’‘（是将q’蒸馏平滑后的结果）\n\n#### 定义kd的loss\n\n\n```python\n# 这里定义的是SOFT Loss + 交叉熵（HARD Loss）\ndef distillation(y, labels, teacher_scores, temp, alpha):\n    return nn.KLDivLoss()(F.log_softmax(y / temp, dim=1), F.softmax(teacher_scores / temp, dim=1)) * (\n            temp * temp * 2.0 * alpha) + F.cross_entropy(y, labels) * (1. - alpha) #两个分布都是T_softmax来求相对熵\n\n```\n\n> nn.KLDivLoss()(input,target)相对熵损失 通过求散度得到Loss值\n>\n>  用于衡量两个分布的相似性，越小越相似\n\n\n{% raw %}\n$$\nl_{n}=y_{n} \\cdot\\left(\\log y_{n}-x_{n}\\right)\n$$\n{% endraw %}\n\n可以指定loss function的reduction参数，来设置每个样本loss的最后得到数据loss计算方式；\n\n{% raw%}\n$$\n\\ell(x, y)=\\left\\{\\begin{array}{ll}L, & \\text { if reduction }=\\text { 'none' } \\\\ \\operatorname{mean}(L), & \\text { if reduction }=\\text { 'mean' } \\\\ N*\\operatorname {mean}(L), & \\text { if reduction }=\\text { 'batchmean' } \\\\ \\operatorname{sum}(L), & \\text { if reduction }=\\text { 'sum' }\\end{array} \\right.\n$$\n{% endraw %}\n\n#### 定义基本函数\n\n```python\ndef train_student_kd(model, device, train_loader, optimizer, epoch):\n    model.train()\n    trained_samples = 0\n    for batch_idx, (data, target) in enumerate(train_loader):\n        data, target = data.to(device), target.to(device)\n        optimizer.zero_grad()\n        output = model(data)\n        teacher_output = teacher_model(data)  #得到teacher网络的推断用于后续计算student的loss\n        teacher_output = teacher_output.detach()  # 切断老师网络的反向传播\n        loss = distillation(output, target, teacher_output, temp=5.0, alpha=0.7)\n        loss.backward()\n        optimizer.step()\n\n        trained_samples += len(data)\n        progress = math.ceil(batch_idx / len(train_loader) * 50)\n        print(\"\\rTrain epoch %d: %d/%d, [%-51s] %d%%\" %\n              (epoch, trained_samples, len(train_loader.dataset),\n               '-' * progress + '>', progress * 2), end='')\n\n\ndef test_student_kd(model, device, test_loader):\n    model.eval()\n    test_loss = 0\n    correct = 0\n    with torch.no_grad():\n        for data, target in test_loader:\n            data, target = data.to(device), target.to(device)\n            output = model(data)\n            test_loss += F.cross_entropy(output, target, reduction='sum').item()  # sum up batch loss item()函数可以理解为得到纯粹的数值\n            pred = output.argmax(dim=1, keepdim=True)  # get the index of the max log-probability\n            correct += pred.eq(target.view_as(pred)).sum().item()\n\n    test_loss /= len(test_loader.dataset)\n\n    print('\\nTest: average loss: {:.4f}, accuracy: {}/{} ({:.0f}%)'.format(\n        test_loss, correct, len(test_loader.dataset),\n        100. * correct / len(test_loader.dataset)))\n    return test_loss, correct / len(test_loader.dataset)\n```\n\n#### 训练主函数\n\n\n```python\ndef student_kd_main():\n    epochs = 10\n    batch_size = 64\n    torch.manual_seed(0)\n\n    device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n\n    train_loader = torch.utils.data.DataLoader(\n        datasets.MNIST('../data/MNIST', train=True, download=True,\n                       transform=transforms.Compose([\n                           transforms.ToTensor(),\n                           transforms.Normalize((0.1307,), (0.3081,))\n                       ])),\n        batch_size=batch_size, shuffle=True)\n    test_loader = torch.utils.data.DataLoader(\n        datasets.MNIST('../data/MNIST', train=False, download=True, transform=transforms.Compose([\n            transforms.ToTensor(),\n            transforms.Normalize((0.1307,), (0.3081,))\n        ])),\n        batch_size=1000, shuffle=True)\n\n    model = StudentNet().to(device)\n    optimizer = torch.optim.Adadelta(model.parameters())\n    \n    student_history = []\n    for epoch in range(1, epochs + 1):\n        train_student_kd(model, device, train_loader, optimizer, epoch)\n        loss, acc = test_student_kd(model, device, test_loader)\n        student_history.append((loss, acc))\n\n    torch.save(model.state_dict(), \"student_kd.pt\")\n    return model, student_history\n```\n\n\n```python\nstudent_kd_model, student_kd_history = student_kd_main()\n```\n\n### 绘制结果\n\n```python\nimport matplotlib.pyplot as plt\nepochs = 10\nx = list(range(1, epochs+1))\n\nplt.subplot(2, 1, 1)\nplt.plot(x, [teacher_history[i][1] for i in range(epochs)], label='teacher')\nplt.plot(x, [student_kd_history[i][1] for i in range(epochs)], label='student with KD')\nplt.plot(x, [student_simple_history[i][1] for i in range(epochs)], label='student without KD')\n\nplt.title('Test accuracy')\nplt.legend()\n\n\nplt.subplot(2, 1, 2)\nplt.plot(x, [teacher_history[i][0] for i in range(epochs)], label='teacher')\nplt.plot(x, [student_kd_history[i][0] for i in range(epochs)], label='student with KD')\nplt.plot(x, [student_simple_history[i][0] for i in range(epochs)], label='student without KD')\n\nplt.title('Test loss')\nplt.legend()\n```\n\n![](https://picture.mulindya.com/kDistillation-13.png)\n\n可以看到在teacher的帮助下，student可以学得更好:cat:\n\n### teacher网络的暗知识:bamboo:\n\n#### softmax_t\n\n```python\nimport numpy as np\nfrom matplotlib import pyplot as plt\n\ndef softmax_t(x, t):\n    x_exp = np.exp(x / t)\n    return x_exp / np.sum(x_exp)\n\ntest_loader_bs1 = torch.utils.data.DataLoader(\n    datasets.MNIST('../data/MNIST', train=False, download=True, transform=transforms.Compose([\n        transforms.ToTensor(),\n        transforms.Normalize((0.1307,), (0.3081,))\n    ])),\n    batch_size=1, shuffle=True)\n```\n#### 推断\n\n```python\nteacher_model.eval()\nwith torch.no_grad():\n    data, target = next(iter(test_loader_bs1))\n    data, target = data.to('cuda'), target.to('cuda')\n    output = teacher_model(data)\n\ntest_x = data.cpu().numpy() #放进cpu转换成numpy\ny_out = output.cpu().numpy()\ny_out = y_out[0, ::]\nprint('Output (NO softmax):', y_out)\n\n\n\nplt.subplot(3, 1, 1)\nplt.imshow(test_x[0, 0, ::])\n\nplt.subplot(3, 1, 2)\nplt.bar(list(range(10)), softmax_t(y_out, 1), width=0.3) #直方图\n\nplt.subplot(3, 1, 3)\nplt.bar(list(range(10)), softmax_t(y_out, 10), width=0.3)\nplt.show()\n```\n> Output (NO softmax): [-31.14481   -30.600847   -3.2787514 -20.624037  -31.863455  -37.684086 -35.177486  -22.72263   -16.028662  -26.460657 ]\n\n![](https://picture.mulindya.com/kDistillation-12.png)\n\n可以看到数据更加平滑，并且可以体现出这个数字不仅是2还和8有些类似:snowman:。\n\n## 本质:balloon:\n\n![](https://picture.mulindya.com/kDistillation-11.png)\n\n在知识蒸馏中，本质上就是使用SOFT Loss来替代正则化项，去拟合teacher的效果。\n\nL2左边是极大似然，右边是先验知识（人为设置）\n\n这里用teacher的知识去正则化作为先验知识，嗯！nice！\n\n\n\n\n\n","source":"_posts/deep_learning/KnowledgeDistillation.md","raw":"---\ntitle: Knowledge Distillation笔记\ntags: [李宏毅,知识蒸馏]\ncategories: [学习笔记,深度学习]\ndate: 2022-01-05 16:38:33\nmath: true\n---\n\n> 因为项目中要使用到知识蒸馏来训练网络，所以先好好学一下它的原理。在网上找到了李宏毅机器学习的模型压缩中讲到了这个，那，就开始学习叭:wink:\n\n# 知识蒸馏:milky_way:\n\n## 概念\n\n先训练一个大的network（teacher），再根据这个network来制造小的network（student），同时student是根据teacher的结构做一些修剪得到的小网络，student network是根据teacher network来学习的哦。\n\n![](https://picture.mulindya.com/kDistillation-1.png)\n\nstudent network是去拟合teacher的结果，可以使用Ensemble的网络作为teacher，这样表现得结果更好。\n\n![](https://picture.mulindya.com/kDistillation-2.png)\n\n在使用知识蒸馏时有一个小技巧，可以稍微改一下Softmax的函数，T是一个超参数，可以使得函数点更加平滑。因为student要学习teacher给的结果，并且teacher给的结果要告诉student，哪些类别比较相似，而不是直接给出1，0，0（和真实结果没有差别），所以teacher 的输出不应该过度集中，需要更加平滑。这样分类结果不同，但是student学习更加有意义。同时不一定要用softmax之后的结果去拟合student，完全可以使用之前的，或者类似student的第6层拟合teacher的12层，第3层拟合teacher的第6层，这样结果往往会更好。\n\n## 实例:sunflower:\n\n### Intuition\n\n通常模型Teacher比模型Student更强，在模型Teacher的帮助下，模型student可以\"青出于蓝而胜于蓝\":wink:,因为从计算资源的角度上庞大的模型部署有很多问题，所以通过知识蒸馏可以训练一个相似的小模型去拟合大模型的训练效果，这样预测和部署会便捷很多。同时使用知识蒸馏的方法可以让小模型学到样本之间的相似关系。\n\n![](https://picture.mulindya.com/kDistillation-9.png)\n\n这里不仅仅知道西红柿是真实标签，还可以知道这个样本和柿子这个标签很相似，这样可以获取更多信息，这是蒸馏更有价值的地方。\n\n### Loss Function in Pytorch\n\n- `Softmax`：将一个数值序列映射到概率空间（每个元素分布并且所有和为1）\n- `log_softmax`：在softmax的基础上取对数\n- `NLLLoss`：对log_softmax与one-hot进行计算\n- `CrossEntropy`：衡量两个概率分布的差别（交叉熵）\n\n#### 代码实证\n\n```python\nimport torch\nimport torch.nn.functional as F\n'''\ntorch.nn.functional 涉及了所有 torch.nn 需要 类 和 方法 ，torch.nn 构建的模块通常就是调用 torch.nn.functional 里的方法实现的.\n'''\ntorch.manual_seed(0)\n```\n\n```python\noutput = torch.randn(2, 3)\nprint(output)\n#tensor([[ 1.5410, -0.2934, -2.1788],\n#        [ 0.5684, -1.0845, -1.3986]])\nprint(F.softmax(output, dim=1))\n# 这里dim的意思是计算Softmax的维度，这里设置dim=1，可以看到每一行的加和为1。0是对列 1 是对行\n#tensor([[0.8446, 0.1349, 0.0205],\n#       [0.7511, 0.1438, 0.1051]])\n```\n#### What is log_softmax\n\n这个很好理解，其实就是对`softmax`处理之后的结果执行一次对数运算。可以理解为 `log(softmax(output))`\n\n```python\nprint(F.log_softmax(output, dim=1))\nprint(torch.log(F.softmax(output, dim=1)))\n# 输出结果是一致的\n```\n\n> tensor([[-0.1689, -2.0033, -3.8886],        [-0.2862, -1.9392, -2.2532]]) tensor([[-0.1689, -2.0033, -3.8886],        [-0.2862, -1.9392, -2.2532]])\n>\n\n#### 损失函数\n\n#### What is NLLLoss？\n\n该函数的全称是`negative log likelihood loss`. 若$x_i=[q_1, q_2, ..., q_N]$ 为神经网络对第i个样本的输出值，$y_i$为真实标签。则：\n$$\nf(x_i,y_i)=-q_{y_i}\n$$\n其中输入：log_softmax(output), target\n\n```python\nprint(F.nll_loss(torch.tensor([[-1.2, -2, -3]]), torch.tensor([0])))\n#结果是tensor(1.2000) 就是取第0个的负数\n```\n\n**通常我们结合 log_softmax 和 nll_loss一起用** :wave:。\n\n#### CrossEntropy交叉熵\n\n**在分类问题中，CrossEntropy等价于log_softmax 结合 nll_loss**\n\n$N$分类问题，对于一个特定的样本，已知其真实标签，`CrossEntropy`的计算公式为：\n\n$$\ncross\\_entropy=-\\sum_{k=1}^{N}\\left(p_{k} * \\log q_{k}\\right)\n$$\n\n其中p表示真实值，在这个公式中是one-hot形式；q是经过`softmax`计算后的结果， $q_k$为神经网络认为该样本为第$k$类的概率。\n\n仔细观察可以知道，因为p的元素不是0就是1，而且又是乘法，所以很自然地我们如果知道1所对应的index，那么就不用做其他无意义的运算了。所以在pytorch代码中target不是以one-hot形式表示的，而是直接用scalar表示。若该样本的真实标签为$y$,则交叉熵的公式可变形为：\n\n$$cross\\_entropy=-\\sum_{k=1}^{N}\\left(p_{k} * \\log q_{k}\\right)=-log \\, q_{y}$$\n\n```python\noutput = torch.tensor([[1.2, 2, 3]])\ntarget = torch.tensor([0])\n\nlog_sm_output = F.log_softmax(output, dim=1)\nnll_loss_of_log_sm_output = F.nll_loss(log_sm_output, target)\nprint(nll_loss_of_log_sm_output)\n```\n\n```python\noutput = torch.tensor([[1.2, 2, 3]])\ntarget = torch.tensor([0])\n\nce_loss = F.cross_entropy(output, target)\nprint(ce_loss)\n\nF.cross_entropy 《==》 F.log_softmax(output, dim=1)+F.nll_loss(log_sm_output, target)\n```\n\n这两者是等价的哦~\n\n#### T-softmax\n\nT-softmax的目的是平滑分布，不让分布太过于极端。比如可以看下面的实例哈。\n\n```python\nimport numpy as np\n\ndef softmax(x):\n    x_exp = np.exp(x)\n    return x_exp / np.sum(x_exp)\n\noutput = np.array([0.1, 1.6, 3.6])\nprint(softmax(output))\n#[0.02590865 0.11611453 0.85797681]\n```\n\n```python\ndef softmax_t(x, t):\n    x_exp = np.exp(x / t)\n    return x_exp / np.sum(x_exp)\n\noutput = np.array([0.1, 1.6, 3.6])\nprint(softmax_t(output, 5))\n#[0.22916797 0.3093444  0.46148762]\n```\n\n设置为5可以看到分布在【0，1】的数更加平滑了哦~\n\n## KD训练代码\n\n### 导入包\n\n```python\nimport math\nimport torch\nimport torch.nn as nn\nimport torch.nn.functional as F\nfrom torchvision import datasets, transforms\nimport torch.utils.data\ntorch.manual_seed(0)\ntorch.cuda.manual_seed(0) #设置GPU生成随机数的种子，方便下次复现实验结果。\n```\n\n### 网络架构\n#### teacher网络\n\n```python\nclass TeacherNet(nn.Module): #继承Module\n    def __init__(self):\n        super(TeacherNet, self).__init__()\n        self.conv1 = nn.Conv2d(1, 32, 3, 1)\n        self.conv2 = nn.Conv2d(32, 64, 3, 1)\n        self.dropout1 = nn.Dropout2d(0.3)\n        self.dropout2 = nn.Dropout2d(0.5)\n        self.fc1 = nn.Linear(9216, 128)\n        self.fc2 = nn.Linear(128, 10)\n\n    def forward(self, x):\n        x = self.conv1(x)\n        x = F.relu(x)\n        x = self.conv2(x)\n        x = F.relu(x)\n        x = F.max_pool2d(x, 2)\n        x = self.dropout1(x)\n        x = torch.flatten(x, 1)\n        x = self.fc1(x)\n        x = F.relu(x)\n        x = self.dropout2(x)\n        output = self.fc2(x)\n        return output\n```\n#### student网络\n\n```python\nclass StudentNet(nn.Module):\n    def __init__(self):\n        super(StudentNet, self).__init__()\n        self.fc1 = nn.Linear(28 * 28, 128)\n        self.fc2 = nn.Linear(128, 64)\n        self.fc3 = nn.Linear(64, 10)\n\n    def forward(self, x):\n        x = torch.flatten(x, 1)\n        x = F.relu(self.fc1(x))\n        x = F.relu(self.fc2(x))\n        output = F.relu(self.fc3(x))\n        return output\n```\n\n### teacher网络训练\n#### 定义基本函数\n\n```python\ndef train_teacher(model, device, train_loader, optimizer, epoch):\n    model.train() #train过程model.train()的作用是启用 Batch Normalization 和 Dropout。model.train()是保证BN层能够用到每一批数据的均值和方差\n    trained_samples = 0\n    for batch_idx, (data, target) in enumerate(train_loader):\n        data, target = data.to(device), target.to(device) #放到GPU\n        optimizer.zero_grad() #归0\n        output = model(data) #得到结果\n        loss = F.cross_entropy(output, target) #计算损失 使用交叉熵\n        loss.backward() #后向传播更新参数\n        optimizer.step() #优化器调整超参数\n\n        trained_samples += len(data)\n        progress = math.ceil(batch_idx / len(train_loader) * 50)\n        print(\"\\rTrain epoch %d: %d/%d, [%-51s] %d%%\" %\n              (epoch, trained_samples, len(train_loader.dataset),\n               '-' * progress + '>', progress * 2), end='')\n\n\ndef test_teacher(model, device, test_loader):\n    model.eval() #保证BN层能够用全部训练数据的均值和方差\n    test_loss = 0\n    correct = 0\n    with torch.no_grad(): #冻结参数\n        for data, target in test_loader:\n            data, target = data.to(device), target.to(device)\n            output = model(data) #模型得到结果\n            test_loss += F.cross_entropy(output, target, reduction='sum').item()  # 统计所有的losssum up batch loss\n            pred = output.argmax(dim=1, keepdim=True)  # get the index of the max log-probability 得到每一行的最大值下标\n            correct += pred.eq(target.view_as(pred)).sum().item() #eq是一个判断函数 view_as是拉成一列\n\n    test_loss /= len(test_loader.dataset) #得到平均loss\n\n    print('\\nTest: average loss: {:.4f}, accuracy: {}/{} ({:.0f}%)'.format(\n        test_loss, correct, len(test_loader.dataset),\n        100. * correct / len(test_loader.dataset)))\n    return test_loss, correct / len(test_loader.dataset)\n\n```\n#### 训练主函数\n\n```python\ndef teacher_main():\n    epochs = 10\n    batch_size = 64\n    torch.manual_seed(0) #设置CPU生成随机数的种子，方便下次复现实验结果。\n\n    device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n\n    train_loader = torch.utils.data.DataLoader(\n        datasets.MNIST('../data/MNIST', train=True, download=True,\n                       transform=transforms.Compose([\n                           transforms.ToTensor(),\n                           transforms.Normalize((0.1307,), (0.3081,))\n                       ])),\n        batch_size=batch_size, shuffle=True)\n    test_loader = torch.utils.data.DataLoader(\n        datasets.MNIST('../data/MNIST', train=False, download=True, transform=transforms.Compose([\n            transforms.ToTensor(),\n            transforms.Normalize((0.1307,), (0.3081,))\n        ])),\n        batch_size=1000, shuffle=True)\n\n    model = TeacherNet().to(device) #模型装进GPU中\n    optimizer = torch.optim.Adadelta(model.parameters()) #定义优化器 其实需要传入模型参数让优化器知道参数空间\n    '''\n    optimzier优化器的作用：优化器就是需要根据网络反向传播的梯度信息来\n    再次更新网络的参数，以起到降低loss函数计算值的作用。\n    '''\n    \n    teacher_history = [] #保存历史数据\n\n    for epoch in range(1, epochs + 1):\n        train_teacher(model, device, train_loader, optimizer, epoch)\n        loss, acc = test_teacher(model, device, test_loader) #相当于验证集作用 也可以绘图\n        \n        teacher_history.append((loss, acc))\n\n    torch.save(model.state_dict(), \"teacher.pt\")\n    return model, teacher_history\n```\n\n```python\n# 训练教师网络\nteacher_model, teacher_history = teacher_main()\n```\n\n### student网络训练（重点）:cherry_blossom:\n\n#### 理论部分\n\n![](https://picture.mulindya.com/kDistillation-10.png)\n\n这里的q是经过了`softmax`之后的分布\n\nstudent的loss来源于两个部分，Loss将两个loss相加\n\n- studet的HARD Loss是根据one-hot的真实样本p分布得到（和一般的loss一样）\n- student的SOFT loss是来源于teacher的分布q’‘（是将q’蒸馏平滑后的结果）\n\n#### 定义kd的loss\n\n\n```python\n# 这里定义的是SOFT Loss + 交叉熵（HARD Loss）\ndef distillation(y, labels, teacher_scores, temp, alpha):\n    return nn.KLDivLoss()(F.log_softmax(y / temp, dim=1), F.softmax(teacher_scores / temp, dim=1)) * (\n            temp * temp * 2.0 * alpha) + F.cross_entropy(y, labels) * (1. - alpha) #两个分布都是T_softmax来求相对熵\n\n```\n\n> nn.KLDivLoss()(input,target)相对熵损失 通过求散度得到Loss值\n>\n>  用于衡量两个分布的相似性，越小越相似\n\n\n{% raw %}\n$$\nl_{n}=y_{n} \\cdot\\left(\\log y_{n}-x_{n}\\right)\n$$\n{% endraw %}\n\n可以指定loss function的reduction参数，来设置每个样本loss的最后得到数据loss计算方式；\n\n{% raw%}\n$$\n\\ell(x, y)=\\left\\{\\begin{array}{ll}L, & \\text { if reduction }=\\text { 'none' } \\\\ \\operatorname{mean}(L), & \\text { if reduction }=\\text { 'mean' } \\\\ N*\\operatorname {mean}(L), & \\text { if reduction }=\\text { 'batchmean' } \\\\ \\operatorname{sum}(L), & \\text { if reduction }=\\text { 'sum' }\\end{array} \\right.\n$$\n{% endraw %}\n\n#### 定义基本函数\n\n```python\ndef train_student_kd(model, device, train_loader, optimizer, epoch):\n    model.train()\n    trained_samples = 0\n    for batch_idx, (data, target) in enumerate(train_loader):\n        data, target = data.to(device), target.to(device)\n        optimizer.zero_grad()\n        output = model(data)\n        teacher_output = teacher_model(data)  #得到teacher网络的推断用于后续计算student的loss\n        teacher_output = teacher_output.detach()  # 切断老师网络的反向传播\n        loss = distillation(output, target, teacher_output, temp=5.0, alpha=0.7)\n        loss.backward()\n        optimizer.step()\n\n        trained_samples += len(data)\n        progress = math.ceil(batch_idx / len(train_loader) * 50)\n        print(\"\\rTrain epoch %d: %d/%d, [%-51s] %d%%\" %\n              (epoch, trained_samples, len(train_loader.dataset),\n               '-' * progress + '>', progress * 2), end='')\n\n\ndef test_student_kd(model, device, test_loader):\n    model.eval()\n    test_loss = 0\n    correct = 0\n    with torch.no_grad():\n        for data, target in test_loader:\n            data, target = data.to(device), target.to(device)\n            output = model(data)\n            test_loss += F.cross_entropy(output, target, reduction='sum').item()  # sum up batch loss item()函数可以理解为得到纯粹的数值\n            pred = output.argmax(dim=1, keepdim=True)  # get the index of the max log-probability\n            correct += pred.eq(target.view_as(pred)).sum().item()\n\n    test_loss /= len(test_loader.dataset)\n\n    print('\\nTest: average loss: {:.4f}, accuracy: {}/{} ({:.0f}%)'.format(\n        test_loss, correct, len(test_loader.dataset),\n        100. * correct / len(test_loader.dataset)))\n    return test_loss, correct / len(test_loader.dataset)\n```\n\n#### 训练主函数\n\n\n```python\ndef student_kd_main():\n    epochs = 10\n    batch_size = 64\n    torch.manual_seed(0)\n\n    device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n\n    train_loader = torch.utils.data.DataLoader(\n        datasets.MNIST('../data/MNIST', train=True, download=True,\n                       transform=transforms.Compose([\n                           transforms.ToTensor(),\n                           transforms.Normalize((0.1307,), (0.3081,))\n                       ])),\n        batch_size=batch_size, shuffle=True)\n    test_loader = torch.utils.data.DataLoader(\n        datasets.MNIST('../data/MNIST', train=False, download=True, transform=transforms.Compose([\n            transforms.ToTensor(),\n            transforms.Normalize((0.1307,), (0.3081,))\n        ])),\n        batch_size=1000, shuffle=True)\n\n    model = StudentNet().to(device)\n    optimizer = torch.optim.Adadelta(model.parameters())\n    \n    student_history = []\n    for epoch in range(1, epochs + 1):\n        train_student_kd(model, device, train_loader, optimizer, epoch)\n        loss, acc = test_student_kd(model, device, test_loader)\n        student_history.append((loss, acc))\n\n    torch.save(model.state_dict(), \"student_kd.pt\")\n    return model, student_history\n```\n\n\n```python\nstudent_kd_model, student_kd_history = student_kd_main()\n```\n\n### 绘制结果\n\n```python\nimport matplotlib.pyplot as plt\nepochs = 10\nx = list(range(1, epochs+1))\n\nplt.subplot(2, 1, 1)\nplt.plot(x, [teacher_history[i][1] for i in range(epochs)], label='teacher')\nplt.plot(x, [student_kd_history[i][1] for i in range(epochs)], label='student with KD')\nplt.plot(x, [student_simple_history[i][1] for i in range(epochs)], label='student without KD')\n\nplt.title('Test accuracy')\nplt.legend()\n\n\nplt.subplot(2, 1, 2)\nplt.plot(x, [teacher_history[i][0] for i in range(epochs)], label='teacher')\nplt.plot(x, [student_kd_history[i][0] for i in range(epochs)], label='student with KD')\nplt.plot(x, [student_simple_history[i][0] for i in range(epochs)], label='student without KD')\n\nplt.title('Test loss')\nplt.legend()\n```\n\n![](https://picture.mulindya.com/kDistillation-13.png)\n\n可以看到在teacher的帮助下，student可以学得更好:cat:\n\n### teacher网络的暗知识:bamboo:\n\n#### softmax_t\n\n```python\nimport numpy as np\nfrom matplotlib import pyplot as plt\n\ndef softmax_t(x, t):\n    x_exp = np.exp(x / t)\n    return x_exp / np.sum(x_exp)\n\ntest_loader_bs1 = torch.utils.data.DataLoader(\n    datasets.MNIST('../data/MNIST', train=False, download=True, transform=transforms.Compose([\n        transforms.ToTensor(),\n        transforms.Normalize((0.1307,), (0.3081,))\n    ])),\n    batch_size=1, shuffle=True)\n```\n#### 推断\n\n```python\nteacher_model.eval()\nwith torch.no_grad():\n    data, target = next(iter(test_loader_bs1))\n    data, target = data.to('cuda'), target.to('cuda')\n    output = teacher_model(data)\n\ntest_x = data.cpu().numpy() #放进cpu转换成numpy\ny_out = output.cpu().numpy()\ny_out = y_out[0, ::]\nprint('Output (NO softmax):', y_out)\n\n\n\nplt.subplot(3, 1, 1)\nplt.imshow(test_x[0, 0, ::])\n\nplt.subplot(3, 1, 2)\nplt.bar(list(range(10)), softmax_t(y_out, 1), width=0.3) #直方图\n\nplt.subplot(3, 1, 3)\nplt.bar(list(range(10)), softmax_t(y_out, 10), width=0.3)\nplt.show()\n```\n> Output (NO softmax): [-31.14481   -30.600847   -3.2787514 -20.624037  -31.863455  -37.684086 -35.177486  -22.72263   -16.028662  -26.460657 ]\n\n![](https://picture.mulindya.com/kDistillation-12.png)\n\n可以看到数据更加平滑，并且可以体现出这个数字不仅是2还和8有些类似:snowman:。\n\n## 本质:balloon:\n\n![](https://picture.mulindya.com/kDistillation-11.png)\n\n在知识蒸馏中，本质上就是使用SOFT Loss来替代正则化项，去拟合teacher的效果。\n\nL2左边是极大似然，右边是先验知识（人为设置）\n\n这里用teacher的知识去正则化作为先验知识，嗯！nice！\n\n\n\n\n\n","slug":"deep_learning/KnowledgeDistillation","published":1,"updated":"2022-01-18T08:10:17.047Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0l500npast9hruc5j0u","content":"<blockquote>\n<p>因为项目中要使用到知识蒸馏来训练网络，所以先好好学一下它的原理。在网上找到了李宏毅机器学习的模型压缩中讲到了这个，那，就开始学习叭😉</p>\n</blockquote>\n<h1>知识蒸馏🌌</h1>\n<h2 id=\"概念\">概念</h2>\n<p>先训练一个大的network（teacher），再根据这个network来制造小的network（student），同时student是根据teacher的结构做一些修剪得到的小网络，student network是根据teacher network来学习的哦。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-1.png\" alt=\"\"></p>\n<p>student network是去拟合teacher的结果，可以使用Ensemble的网络作为teacher，这样表现得结果更好。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-2.png\" alt=\"\"></p>\n<p>在使用知识蒸馏时有一个小技巧，可以稍微改一下Softmax的函数，T是一个超参数，可以使得函数点更加平滑。因为student要学习teacher给的结果，并且teacher给的结果要告诉student，哪些类别比较相似，而不是直接给出1，0，0（和真实结果没有差别），所以teacher 的输出不应该过度集中，需要更加平滑。这样分类结果不同，但是student学习更加有意义。同时不一定要用softmax之后的结果去拟合student，完全可以使用之前的，或者类似student的第6层拟合teacher的12层，第3层拟合teacher的第6层，这样结果往往会更好。</p>\n<h2 id=\"实例🌻\">实例🌻</h2>\n<h3 id=\"Intuition\">Intuition</h3>\n<p>通常模型Teacher比模型Student更强，在模型Teacher的帮助下，模型student可以\"青出于蓝而胜于蓝\"😉,因为从计算资源的角度上庞大的模型部署有很多问题，所以通过知识蒸馏可以训练一个相似的小模型去拟合大模型的训练效果，这样预测和部署会便捷很多。同时使用知识蒸馏的方法可以让小模型学到样本之间的相似关系。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-9.png\" alt=\"\"></p>\n<p>这里不仅仅知道西红柿是真实标签，还可以知道这个样本和柿子这个标签很相似，这样可以获取更多信息，这是蒸馏更有价值的地方。</p>\n<h3 id=\"Loss-Function-in-Pytorch\">Loss Function in Pytorch</h3>\n<ul>\n<li><code>Softmax</code>：将一个数值序列映射到概率空间（每个元素分布并且所有和为1）</li>\n<li><code>log_softmax</code>：在softmax的基础上取对数</li>\n<li><code>NLLLoss</code>：对log_softmax与one-hot进行计算</li>\n<li><code>CrossEntropy</code>：衡量两个概率分布的差别（交叉熵）</li>\n</ul>\n<h4 id=\"代码实证\">代码实证</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> torch<br><span class=\"hljs-keyword\">import</span> torch.nn.functional <span class=\"hljs-keyword\">as</span> F<br><span class=\"hljs-string\">'''</span><br><span class=\"hljs-string\">torch.nn.functional 涉及了所有 torch.nn 需要 类 和 方法 ，torch.nn 构建的模块通常就是调用 torch.nn.functional 里的方法实现的.</span><br><span class=\"hljs-string\">'''</span><br>torch.manual_seed(<span class=\"hljs-number\">0</span>)<br></code></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">output = torch.randn(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>)<br><span class=\"hljs-built_in\">print</span>(output)<br><span class=\"hljs-comment\">#tensor([[ 1.5410, -0.2934, -2.1788],</span><br><span class=\"hljs-comment\">#        [ 0.5684, -1.0845, -1.3986]])</span><br><span class=\"hljs-built_in\">print</span>(F.softmax(output, dim=<span class=\"hljs-number\">1</span>))<br><span class=\"hljs-comment\"># 这里dim的意思是计算Softmax的维度，这里设置dim=1，可以看到每一行的加和为1。0是对列 1 是对行</span><br><span class=\"hljs-comment\">#tensor([[0.8446, 0.1349, 0.0205],</span><br><span class=\"hljs-comment\">#       [0.7511, 0.1438, 0.1051]])</span><br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"What-is-log-softmax\">What is log_softmax</h4>\n<p>这个很好理解，其实就是对<code>softmax</code>处理之后的结果执行一次对数运算。可以理解为 <code>log(softmax(output))</code></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">print</span>(F.log_softmax(output, dim=<span class=\"hljs-number\">1</span>))<br><span class=\"hljs-built_in\">print</span>(torch.log(F.softmax(output, dim=<span class=\"hljs-number\">1</span>)))<br><span class=\"hljs-comment\"># 输出结果是一致的</span><br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>tensor([[-0.1689, -2.0033, -3.8886],        [-0.2862, -1.9392, -2.2532]]) tensor([[-0.1689, -2.0033, -3.8886],        [-0.2862, -1.9392, -2.2532]])</p>\n</blockquote>\n<h4 id=\"损失函数\">损失函数</h4>\n<h4 id=\"What-is-NLLLoss？\">What is NLLLoss？</h4>\n<p>该函数的全称是<code>negative log likelihood loss</code>. 若$x_i=[q_1, q_2, …, q_N]$ 为神经网络对第i个样本的输出值，$y_i$为真实标签。则：<br>\n$$<br>\nf(x_i,y_i)=-q_{y_i}<br>\n$$<br>\n其中输入：log_softmax(output), target</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">print</span>(F.nll_loss(torch.tensor([[-<span class=\"hljs-number\">1.2</span>, -<span class=\"hljs-number\">2</span>, -<span class=\"hljs-number\">3</span>]]), torch.tensor([<span class=\"hljs-number\">0</span>])))<br><span class=\"hljs-comment\">#结果是tensor(1.2000) 就是取第0个的负数</span><br></code></pre></td></tr></tbody></table></figure>\n<p><strong>通常我们结合 log_softmax 和 nll_loss一起用</strong> 👋。</p>\n<h4 id=\"CrossEntropy交叉熵\">CrossEntropy交叉熵</h4>\n<p><strong>在分类问题中，CrossEntropy等价于log_softmax 结合 nll_loss</strong></p>\n<p>$N$分类问题，对于一个特定的样本，已知其真实标签，<code>CrossEntropy</code>的计算公式为：</p>\n<p>$$<br>\ncross_entropy=-\\sum_{k=1}^{N}\\left(p_{k} * \\log q_{k}\\right)<br>\n$$</p>\n<p>其中p表示真实值，在这个公式中是one-hot形式；q是经过<code>softmax</code>计算后的结果， $q_k$为神经网络认为该样本为第$k$类的概率。</p>\n<p>仔细观察可以知道，因为p的元素不是0就是1，而且又是乘法，所以很自然地我们如果知道1所对应的index，那么就不用做其他无意义的运算了。所以在pytorch代码中target不是以one-hot形式表示的，而是直接用scalar表示。若该样本的真实标签为$y$,则交叉熵的公式可变形为：</p>\n<p>$$cross_entropy=-\\sum_{k=1}^{N}\\left(p_{k} * \\log q_{k}\\right)=-log , q_{y}$$</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">output = torch.tensor([[<span class=\"hljs-number\">1.2</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>]])<br>target = torch.tensor([<span class=\"hljs-number\">0</span>])<br><br>log_sm_output = F.log_softmax(output, dim=<span class=\"hljs-number\">1</span>)<br>nll_loss_of_log_sm_output = F.nll_loss(log_sm_output, target)<br><span class=\"hljs-built_in\">print</span>(nll_loss_of_log_sm_output)<br></code></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">output = torch.tensor([[<span class=\"hljs-number\">1.2</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>]])<br>target = torch.tensor([<span class=\"hljs-number\">0</span>])<br><br>ce_loss = F.cross_entropy(output, target)<br><span class=\"hljs-built_in\">print</span>(ce_loss)<br><br>F.cross_entropy 《==》 F.log_softmax(output, dim=<span class=\"hljs-number\">1</span>)+F.nll_loss(log_sm_output, target)<br></code></pre></td></tr></tbody></table></figure>\n<p>这两者是等价的哦~</p>\n<h4 id=\"T-softmax\">T-softmax</h4>\n<p>T-softmax的目的是平滑分布，不让分布太过于极端。比如可以看下面的实例哈。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">softmax</span>(<span class=\"hljs-params\">x</span>):</span><br>    x_exp = np.exp(x)<br>    <span class=\"hljs-keyword\">return</span> x_exp / np.<span class=\"hljs-built_in\">sum</span>(x_exp)<br><br>output = np.array([<span class=\"hljs-number\">0.1</span>, <span class=\"hljs-number\">1.6</span>, <span class=\"hljs-number\">3.6</span>])<br><span class=\"hljs-built_in\">print</span>(softmax(output))<br><span class=\"hljs-comment\">#[0.02590865 0.11611453 0.85797681]</span><br></code></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">softmax_t</span>(<span class=\"hljs-params\">x, t</span>):</span><br>    x_exp = np.exp(x / t)<br>    <span class=\"hljs-keyword\">return</span> x_exp / np.<span class=\"hljs-built_in\">sum</span>(x_exp)<br><br>output = np.array([<span class=\"hljs-number\">0.1</span>, <span class=\"hljs-number\">1.6</span>, <span class=\"hljs-number\">3.6</span>])<br><span class=\"hljs-built_in\">print</span>(softmax_t(output, <span class=\"hljs-number\">5</span>))<br><span class=\"hljs-comment\">#[0.22916797 0.3093444  0.46148762]</span><br></code></pre></td></tr></tbody></table></figure>\n<p>设置为5可以看到分布在【0，1】的数更加平滑了哦~</p>\n<h2 id=\"KD训练代码\">KD训练代码</h2>\n<h3 id=\"导入包\">导入包</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> math<br><span class=\"hljs-keyword\">import</span> torch<br><span class=\"hljs-keyword\">import</span> torch.nn <span class=\"hljs-keyword\">as</span> nn<br><span class=\"hljs-keyword\">import</span> torch.nn.functional <span class=\"hljs-keyword\">as</span> F<br><span class=\"hljs-keyword\">from</span> torchvision <span class=\"hljs-keyword\">import</span> datasets, transforms<br><span class=\"hljs-keyword\">import</span> torch.utils.data<br>torch.manual_seed(<span class=\"hljs-number\">0</span>)<br>torch.cuda.manual_seed(<span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\">#设置GPU生成随机数的种子，方便下次复现实验结果。</span><br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"网络架构\">网络架构</h3>\n<h4 id=\"teacher网络\">teacher网络</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TeacherNet</span>(<span class=\"hljs-params\">nn.Module</span>):</span> <span class=\"hljs-comment\">#继承Module</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-built_in\">super</span>(TeacherNet, self).__init__()<br>        self.conv1 = nn.Conv2d(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">32</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>)<br>        self.conv2 = nn.Conv2d(<span class=\"hljs-number\">32</span>, <span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>)<br>        self.dropout1 = nn.Dropout2d(<span class=\"hljs-number\">0.3</span>)<br>        self.dropout2 = nn.Dropout2d(<span class=\"hljs-number\">0.5</span>)<br>        self.fc1 = nn.Linear(<span class=\"hljs-number\">9216</span>, <span class=\"hljs-number\">128</span>)<br>        self.fc2 = nn.Linear(<span class=\"hljs-number\">128</span>, <span class=\"hljs-number\">10</span>)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">forward</span>(<span class=\"hljs-params\">self, x</span>):</span><br>        x = self.conv1(x)<br>        x = F.relu(x)<br>        x = self.conv2(x)<br>        x = F.relu(x)<br>        x = F.max_pool2d(x, <span class=\"hljs-number\">2</span>)<br>        x = self.dropout1(x)<br>        x = torch.flatten(x, <span class=\"hljs-number\">1</span>)<br>        x = self.fc1(x)<br>        x = F.relu(x)<br>        x = self.dropout2(x)<br>        output = self.fc2(x)<br>        <span class=\"hljs-keyword\">return</span> output<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"student网络\">student网络</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">StudentNet</span>(<span class=\"hljs-params\">nn.Module</span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-built_in\">super</span>(StudentNet, self).__init__()<br>        self.fc1 = nn.Linear(<span class=\"hljs-number\">28</span> * <span class=\"hljs-number\">28</span>, <span class=\"hljs-number\">128</span>)<br>        self.fc2 = nn.Linear(<span class=\"hljs-number\">128</span>, <span class=\"hljs-number\">64</span>)<br>        self.fc3 = nn.Linear(<span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">10</span>)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">forward</span>(<span class=\"hljs-params\">self, x</span>):</span><br>        x = torch.flatten(x, <span class=\"hljs-number\">1</span>)<br>        x = F.relu(self.fc1(x))<br>        x = F.relu(self.fc2(x))<br>        output = F.relu(self.fc3(x))<br>        <span class=\"hljs-keyword\">return</span> output<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"teacher网络训练\">teacher网络训练</h3>\n<h4 id=\"定义基本函数\">定义基本函数</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">train_teacher</span>(<span class=\"hljs-params\">model, device, train_loader, optimizer, epoch</span>):</span><br>    model.train() <span class=\"hljs-comment\">#train过程model.train()的作用是启用 Batch Normalization 和 Dropout。model.train()是保证BN层能够用到每一批数据的均值和方差</span><br>    trained_samples = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">for</span> batch_idx, (data, target) <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(train_loader):<br>        data, target = data.to(device), target.to(device) <span class=\"hljs-comment\">#放到GPU</span><br>        optimizer.zero_grad() <span class=\"hljs-comment\">#归0</span><br>        output = model(data) <span class=\"hljs-comment\">#得到结果</span><br>        loss = F.cross_entropy(output, target) <span class=\"hljs-comment\">#计算损失 使用交叉熵</span><br>        loss.backward() <span class=\"hljs-comment\">#后向传播更新参数</span><br>        optimizer.step() <span class=\"hljs-comment\">#优化器调整超参数</span><br><br>        trained_samples += <span class=\"hljs-built_in\">len</span>(data)<br>        progress = math.ceil(batch_idx / <span class=\"hljs-built_in\">len</span>(train_loader) * <span class=\"hljs-number\">50</span>)<br>        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"\\rTrain epoch %d: %d/%d, [%-51s] %d%%\"</span> %<br>              (epoch, trained_samples, <span class=\"hljs-built_in\">len</span>(train_loader.dataset),<br>               <span class=\"hljs-string\">'-'</span> * progress + <span class=\"hljs-string\">'&gt;'</span>, progress * <span class=\"hljs-number\">2</span>), end=<span class=\"hljs-string\">''</span>)<br><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">test_teacher</span>(<span class=\"hljs-params\">model, device, test_loader</span>):</span><br>    model.<span class=\"hljs-built_in\">eval</span>() <span class=\"hljs-comment\">#保证BN层能够用全部训练数据的均值和方差</span><br>    test_loss = <span class=\"hljs-number\">0</span><br>    correct = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">with</span> torch.no_grad(): <span class=\"hljs-comment\">#冻结参数</span><br>        <span class=\"hljs-keyword\">for</span> data, target <span class=\"hljs-keyword\">in</span> test_loader:<br>            data, target = data.to(device), target.to(device)<br>            output = model(data) <span class=\"hljs-comment\">#模型得到结果</span><br>            test_loss += F.cross_entropy(output, target, reduction=<span class=\"hljs-string\">'sum'</span>).item()  <span class=\"hljs-comment\"># 统计所有的losssum up batch loss</span><br>            pred = output.argmax(dim=<span class=\"hljs-number\">1</span>, keepdim=<span class=\"hljs-literal\">True</span>)  <span class=\"hljs-comment\"># get the index of the max log-probability 得到每一行的最大值下标</span><br>            correct += pred.eq(target.view_as(pred)).<span class=\"hljs-built_in\">sum</span>().item() <span class=\"hljs-comment\">#eq是一个判断函数 view_as是拉成一列</span><br><br>    test_loss /= <span class=\"hljs-built_in\">len</span>(test_loader.dataset) <span class=\"hljs-comment\">#得到平均loss</span><br><br>    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">'\\nTest: average loss: {:.4f}, accuracy: {}/{} ({:.0f}%)'</span>.<span class=\"hljs-built_in\">format</span>(<br>        test_loss, correct, <span class=\"hljs-built_in\">len</span>(test_loader.dataset),<br>        <span class=\"hljs-number\">100.</span> * correct / <span class=\"hljs-built_in\">len</span>(test_loader.dataset)))<br>    <span class=\"hljs-keyword\">return</span> test_loss, correct / <span class=\"hljs-built_in\">len</span>(test_loader.dataset)<br><br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"训练主函数\">训练主函数</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">teacher_main</span>():</span><br>    epochs = <span class=\"hljs-number\">10</span><br>    batch_size = <span class=\"hljs-number\">64</span><br>    torch.manual_seed(<span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\">#设置CPU生成随机数的种子，方便下次复现实验结果。</span><br><br>    device = torch.device(<span class=\"hljs-string\">\"cuda\"</span> <span class=\"hljs-keyword\">if</span> torch.cuda.is_available() <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">\"cpu\"</span>)<br><br>    train_loader = torch.utils.data.DataLoader(<br>        datasets.MNIST(<span class=\"hljs-string\">'../data/MNIST'</span>, train=<span class=\"hljs-literal\">True</span>, download=<span class=\"hljs-literal\">True</span>,<br>                       transform=transforms.Compose([<br>                           transforms.ToTensor(),<br>                           transforms.Normalize((<span class=\"hljs-number\">0.1307</span>,), (<span class=\"hljs-number\">0.3081</span>,))<br>                       ])),<br>        batch_size=batch_size, shuffle=<span class=\"hljs-literal\">True</span>)<br>    test_loader = torch.utils.data.DataLoader(<br>        datasets.MNIST(<span class=\"hljs-string\">'../data/MNIST'</span>, train=<span class=\"hljs-literal\">False</span>, download=<span class=\"hljs-literal\">True</span>, transform=transforms.Compose([<br>            transforms.ToTensor(),<br>            transforms.Normalize((<span class=\"hljs-number\">0.1307</span>,), (<span class=\"hljs-number\">0.3081</span>,))<br>        ])),<br>        batch_size=<span class=\"hljs-number\">1000</span>, shuffle=<span class=\"hljs-literal\">True</span>)<br><br>    model = TeacherNet().to(device) <span class=\"hljs-comment\">#模型装进GPU中</span><br>    optimizer = torch.optim.Adadelta(model.parameters()) <span class=\"hljs-comment\">#定义优化器 其实需要传入模型参数让优化器知道参数空间</span><br>    <span class=\"hljs-string\">'''</span><br><span class=\"hljs-string\">    optimzier优化器的作用：优化器就是需要根据网络反向传播的梯度信息来</span><br><span class=\"hljs-string\">    再次更新网络的参数，以起到降低loss函数计算值的作用。</span><br><span class=\"hljs-string\">    '''</span><br>    <br>    teacher_history = [] <span class=\"hljs-comment\">#保存历史数据</span><br><br>    <span class=\"hljs-keyword\">for</span> epoch <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>, epochs + <span class=\"hljs-number\">1</span>):<br>        train_teacher(model, device, train_loader, optimizer, epoch)<br>        loss, acc = test_teacher(model, device, test_loader) <span class=\"hljs-comment\">#相当于验证集作用 也可以绘图</span><br>        <br>        teacher_history.append((loss, acc))<br><br>    torch.save(model.state_dict(), <span class=\"hljs-string\">\"teacher.pt\"</span>)<br>    <span class=\"hljs-keyword\">return</span> model, teacher_history<br></code></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># 训练教师网络</span><br>teacher_model, teacher_history = teacher_main()<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"student网络训练（重点）🌸\">student网络训练（重点）🌸</h3>\n<h4 id=\"理论部分\">理论部分</h4>\n<p><img src=\"https://picture.mulindya.com/kDistillation-10.png\" alt=\"\"></p>\n<p>这里的q是经过了<code>softmax</code>之后的分布</p>\n<p>student的loss来源于两个部分，Loss将两个loss相加</p>\n<ul>\n<li>studet的HARD Loss是根据one-hot的真实样本p分布得到（和一般的loss一样）</li>\n<li>student的SOFT loss是来源于teacher的分布q’‘（是将q’蒸馏平滑后的结果）</li>\n</ul>\n<h4 id=\"定义kd的loss\">定义kd的loss</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># 这里定义的是SOFT Loss + 交叉熵（HARD Loss）</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">distillation</span>(<span class=\"hljs-params\">y, labels, teacher_scores, temp, alpha</span>):</span><br>    <span class=\"hljs-keyword\">return</span> nn.KLDivLoss()(F.log_softmax(y / temp, dim=<span class=\"hljs-number\">1</span>), F.softmax(teacher_scores / temp, dim=<span class=\"hljs-number\">1</span>)) * (<br>            temp * temp * <span class=\"hljs-number\">2.0</span> * alpha) + F.cross_entropy(y, labels) * (<span class=\"hljs-number\">1.</span> - alpha) <span class=\"hljs-comment\">#两个分布都是T_softmax来求相对熵</span><br><br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>nn.KLDivLoss()(input,target)相对熵损失 通过求散度得到Loss值</p>\n<p>用于衡量两个分布的相似性，越小越相似</p>\n</blockquote>\n\n$$\nl_{n}=y_{n} \\cdot\\left(\\log y_{n}-x_{n}\\right)\n$$\n\n<p>可以指定loss function的reduction参数，来设置每个样本loss的最后得到数据loss计算方式；</p>\n\n$$\n\\ell(x, y)=\\left\\{\\begin{array}{ll}L, &amp; \\text { if reduction }=\\text { 'none' } \\\\ \\operatorname{mean}(L), &amp; \\text { if reduction }=\\text { 'mean' } \\\\ N*\\operatorname {mean}(L), &amp; \\text { if reduction }=\\text { 'batchmean' } \\\\ \\operatorname{sum}(L), &amp; \\text { if reduction }=\\text { 'sum' }\\end{array} \\right.\n$$\n\n<h4 id=\"定义基本函数-2\">定义基本函数</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">train_student_kd</span>(<span class=\"hljs-params\">model, device, train_loader, optimizer, epoch</span>):</span><br>    model.train()<br>    trained_samples = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">for</span> batch_idx, (data, target) <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(train_loader):<br>        data, target = data.to(device), target.to(device)<br>        optimizer.zero_grad()<br>        output = model(data)<br>        teacher_output = teacher_model(data)  <span class=\"hljs-comment\">#得到teacher网络的推断用于后续计算student的loss</span><br>        teacher_output = teacher_output.detach()  <span class=\"hljs-comment\"># 切断老师网络的反向传播</span><br>        loss = distillation(output, target, teacher_output, temp=<span class=\"hljs-number\">5.0</span>, alpha=<span class=\"hljs-number\">0.7</span>)<br>        loss.backward()<br>        optimizer.step()<br><br>        trained_samples += <span class=\"hljs-built_in\">len</span>(data)<br>        progress = math.ceil(batch_idx / <span class=\"hljs-built_in\">len</span>(train_loader) * <span class=\"hljs-number\">50</span>)<br>        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"\\rTrain epoch %d: %d/%d, [%-51s] %d%%\"</span> %<br>              (epoch, trained_samples, <span class=\"hljs-built_in\">len</span>(train_loader.dataset),<br>               <span class=\"hljs-string\">'-'</span> * progress + <span class=\"hljs-string\">'&gt;'</span>, progress * <span class=\"hljs-number\">2</span>), end=<span class=\"hljs-string\">''</span>)<br><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">test_student_kd</span>(<span class=\"hljs-params\">model, device, test_loader</span>):</span><br>    model.<span class=\"hljs-built_in\">eval</span>()<br>    test_loss = <span class=\"hljs-number\">0</span><br>    correct = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">with</span> torch.no_grad():<br>        <span class=\"hljs-keyword\">for</span> data, target <span class=\"hljs-keyword\">in</span> test_loader:<br>            data, target = data.to(device), target.to(device)<br>            output = model(data)<br>            test_loss += F.cross_entropy(output, target, reduction=<span class=\"hljs-string\">'sum'</span>).item()  <span class=\"hljs-comment\"># sum up batch loss item()函数可以理解为得到纯粹的数值</span><br>            pred = output.argmax(dim=<span class=\"hljs-number\">1</span>, keepdim=<span class=\"hljs-literal\">True</span>)  <span class=\"hljs-comment\"># get the index of the max log-probability</span><br>            correct += pred.eq(target.view_as(pred)).<span class=\"hljs-built_in\">sum</span>().item()<br><br>    test_loss /= <span class=\"hljs-built_in\">len</span>(test_loader.dataset)<br><br>    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">'\\nTest: average loss: {:.4f}, accuracy: {}/{} ({:.0f}%)'</span>.<span class=\"hljs-built_in\">format</span>(<br>        test_loss, correct, <span class=\"hljs-built_in\">len</span>(test_loader.dataset),<br>        <span class=\"hljs-number\">100.</span> * correct / <span class=\"hljs-built_in\">len</span>(test_loader.dataset)))<br>    <span class=\"hljs-keyword\">return</span> test_loss, correct / <span class=\"hljs-built_in\">len</span>(test_loader.dataset)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"训练主函数-2\">训练主函数</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">student_kd_main</span>():</span><br>    epochs = <span class=\"hljs-number\">10</span><br>    batch_size = <span class=\"hljs-number\">64</span><br>    torch.manual_seed(<span class=\"hljs-number\">0</span>)<br><br>    device = torch.device(<span class=\"hljs-string\">\"cuda\"</span> <span class=\"hljs-keyword\">if</span> torch.cuda.is_available() <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">\"cpu\"</span>)<br><br>    train_loader = torch.utils.data.DataLoader(<br>        datasets.MNIST(<span class=\"hljs-string\">'../data/MNIST'</span>, train=<span class=\"hljs-literal\">True</span>, download=<span class=\"hljs-literal\">True</span>,<br>                       transform=transforms.Compose([<br>                           transforms.ToTensor(),<br>                           transforms.Normalize((<span class=\"hljs-number\">0.1307</span>,), (<span class=\"hljs-number\">0.3081</span>,))<br>                       ])),<br>        batch_size=batch_size, shuffle=<span class=\"hljs-literal\">True</span>)<br>    test_loader = torch.utils.data.DataLoader(<br>        datasets.MNIST(<span class=\"hljs-string\">'../data/MNIST'</span>, train=<span class=\"hljs-literal\">False</span>, download=<span class=\"hljs-literal\">True</span>, transform=transforms.Compose([<br>            transforms.ToTensor(),<br>            transforms.Normalize((<span class=\"hljs-number\">0.1307</span>,), (<span class=\"hljs-number\">0.3081</span>,))<br>        ])),<br>        batch_size=<span class=\"hljs-number\">1000</span>, shuffle=<span class=\"hljs-literal\">True</span>)<br><br>    model = StudentNet().to(device)<br>    optimizer = torch.optim.Adadelta(model.parameters())<br>    <br>    student_history = []<br>    <span class=\"hljs-keyword\">for</span> epoch <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>, epochs + <span class=\"hljs-number\">1</span>):<br>        train_student_kd(model, device, train_loader, optimizer, epoch)<br>        loss, acc = test_student_kd(model, device, test_loader)<br>        student_history.append((loss, acc))<br><br>    torch.save(model.state_dict(), <span class=\"hljs-string\">\"student_kd.pt\"</span>)<br>    <span class=\"hljs-keyword\">return</span> model, student_history<br></code></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">student_kd_model, student_kd_history = student_kd_main()<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"绘制结果\">绘制结果</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> matplotlib.pyplot <span class=\"hljs-keyword\">as</span> plt<br>epochs = <span class=\"hljs-number\">10</span><br>x = <span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>, epochs+<span class=\"hljs-number\">1</span>))<br><br>plt.subplot(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>)<br>plt.plot(x, [teacher_history[i][<span class=\"hljs-number\">1</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">'teacher'</span>)<br>plt.plot(x, [student_kd_history[i][<span class=\"hljs-number\">1</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">'student with KD'</span>)<br>plt.plot(x, [student_simple_history[i][<span class=\"hljs-number\">1</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">'student without KD'</span>)<br><br>plt.title(<span class=\"hljs-string\">'Test accuracy'</span>)<br>plt.legend()<br><br><br>plt.subplot(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>)<br>plt.plot(x, [teacher_history[i][<span class=\"hljs-number\">0</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">'teacher'</span>)<br>plt.plot(x, [student_kd_history[i][<span class=\"hljs-number\">0</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">'student with KD'</span>)<br>plt.plot(x, [student_simple_history[i][<span class=\"hljs-number\">0</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">'student without KD'</span>)<br><br>plt.title(<span class=\"hljs-string\">'Test loss'</span>)<br>plt.legend()<br></code></pre></td></tr></tbody></table></figure>\n<p><img src=\"https://picture.mulindya.com/kDistillation-13.png\" alt=\"\"></p>\n<p>可以看到在teacher的帮助下，student可以学得更好🐱</p>\n<h3 id=\"teacher网络的暗知识🎍\">teacher网络的暗知识🎍</h3>\n<h4 id=\"softmax-t\">softmax_t</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><span class=\"hljs-keyword\">from</span> matplotlib <span class=\"hljs-keyword\">import</span> pyplot <span class=\"hljs-keyword\">as</span> plt<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">softmax_t</span>(<span class=\"hljs-params\">x, t</span>):</span><br>    x_exp = np.exp(x / t)<br>    <span class=\"hljs-keyword\">return</span> x_exp / np.<span class=\"hljs-built_in\">sum</span>(x_exp)<br><br>test_loader_bs1 = torch.utils.data.DataLoader(<br>    datasets.MNIST(<span class=\"hljs-string\">'../data/MNIST'</span>, train=<span class=\"hljs-literal\">False</span>, download=<span class=\"hljs-literal\">True</span>, transform=transforms.Compose([<br>        transforms.ToTensor(),<br>        transforms.Normalize((<span class=\"hljs-number\">0.1307</span>,), (<span class=\"hljs-number\">0.3081</span>,))<br>    ])),<br>    batch_size=<span class=\"hljs-number\">1</span>, shuffle=<span class=\"hljs-literal\">True</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h4 id=\"推断\">推断</h4>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">teacher_model.<span class=\"hljs-built_in\">eval</span>()<br><span class=\"hljs-keyword\">with</span> torch.no_grad():<br>    data, target = <span class=\"hljs-built_in\">next</span>(<span class=\"hljs-built_in\">iter</span>(test_loader_bs1))<br>    data, target = data.to(<span class=\"hljs-string\">'cuda'</span>), target.to(<span class=\"hljs-string\">'cuda'</span>)<br>    output = teacher_model(data)<br><br>test_x = data.cpu().numpy() <span class=\"hljs-comment\">#放进cpu转换成numpy</span><br>y_out = output.cpu().numpy()<br>y_out = y_out[<span class=\"hljs-number\">0</span>, ::]<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">'Output (NO softmax):'</span>, y_out)<br><br><br><br>plt.subplot(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>)<br>plt.imshow(test_x[<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, ::])<br><br>plt.subplot(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>)<br>plt.bar(<span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">10</span>)), softmax_t(y_out, <span class=\"hljs-number\">1</span>), width=<span class=\"hljs-number\">0.3</span>) <span class=\"hljs-comment\">#直方图</span><br><br>plt.subplot(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">3</span>)<br>plt.bar(<span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">10</span>)), softmax_t(y_out, <span class=\"hljs-number\">10</span>), width=<span class=\"hljs-number\">0.3</span>)<br>plt.show()<br></code></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>Output (NO softmax): [-31.14481   -30.600847   -3.2787514 -20.624037  -31.863455  -37.684086 -35.177486  -22.72263   -16.028662  -26.460657 ]</p>\n</blockquote>\n<p><img src=\"https://picture.mulindya.com/kDistillation-12.png\" alt=\"\"></p>\n<p>可以看到数据更加平滑，并且可以体现出这个数字不仅是2还和8有些类似⛄️。</p>\n<h2 id=\"本质🎈\">本质🎈</h2>\n<p><img src=\"https://picture.mulindya.com/kDistillation-11.png\" alt=\"\"></p>\n<p>在知识蒸馏中，本质上就是使用SOFT Loss来替代正则化项，去拟合teacher的效果。</p>\n<p>L2左边是极大似然，右边是先验知识（人为设置）</p>\n<p>这里用teacher的知识去正则化作为先验知识，嗯！nice！</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>因为项目中要使用到知识蒸馏来训练网络，所以先好好学一下它的原理。在网上找到了李宏毅机器学习的模型压缩中讲到了这个，那，就开始学习叭😉</p>\n</blockquote>\n<h1>知识蒸馏🌌</h1>\n<h2 id=\"概念\">概念</h2>\n<p>先训练一个大的network（teacher），再根据这个network来制造小的network（student），同时student是根据teacher的结构做一些修剪得到的小网络，student network是根据teacher network来学习的哦。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-1.png\" alt=\"\"></p>\n<p>student network是去拟合teacher的结果，可以使用Ensemble的网络作为teacher，这样表现得结果更好。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-2.png\" alt=\"\"></p>\n<p>在使用知识蒸馏时有一个小技巧，可以稍微改一下Softmax的函数，T是一个超参数，可以使得函数点更加平滑。因为student要学习teacher给的结果，并且teacher给的结果要告诉student，哪些类别比较相似，而不是直接给出1，0，0（和真实结果没有差别），所以teacher 的输出不应该过度集中，需要更加平滑。这样分类结果不同，但是student学习更加有意义。同时不一定要用softmax之后的结果去拟合student，完全可以使用之前的，或者类似student的第6层拟合teacher的12层，第3层拟合teacher的第6层，这样结果往往会更好。</p>\n<h2 id=\"实例🌻\">实例🌻</h2>\n<h3 id=\"Intuition\">Intuition</h3>\n<p>通常模型Teacher比模型Student更强，在模型Teacher的帮助下，模型student可以&quot;青出于蓝而胜于蓝&quot;😉,因为从计算资源的角度上庞大的模型部署有很多问题，所以通过知识蒸馏可以训练一个相似的小模型去拟合大模型的训练效果，这样预测和部署会便捷很多。同时使用知识蒸馏的方法可以让小模型学到样本之间的相似关系。</p>\n<p><img src=\"https://picture.mulindya.com/kDistillation-9.png\" alt=\"\"></p>\n<p>这里不仅仅知道西红柿是真实标签，还可以知道这个样本和柿子这个标签很相似，这样可以获取更多信息，这是蒸馏更有价值的地方。</p>\n<h3 id=\"Loss-Function-in-Pytorch\">Loss Function in Pytorch</h3>\n<ul>\n<li><code>Softmax</code>：将一个数值序列映射到概率空间（每个元素分布并且所有和为1）</li>\n<li><code>log_softmax</code>：在softmax的基础上取对数</li>\n<li><code>NLLLoss</code>：对log_softmax与one-hot进行计算</li>\n<li><code>CrossEntropy</code>：衡量两个概率分布的差别（交叉熵）</li>\n</ul>\n<h4 id=\"代码实证\">代码实证</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> torch<br><span class=\"hljs-keyword\">import</span> torch.nn.functional <span class=\"hljs-keyword\">as</span> F<br><span class=\"hljs-string\">&#x27;&#x27;&#x27;</span><br><span class=\"hljs-string\">torch.nn.functional 涉及了所有 torch.nn 需要 类 和 方法 ，torch.nn 构建的模块通常就是调用 torch.nn.functional 里的方法实现的.</span><br><span class=\"hljs-string\">&#x27;&#x27;&#x27;</span><br>torch.manual_seed(<span class=\"hljs-number\">0</span>)<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">output = torch.randn(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>)<br><span class=\"hljs-built_in\">print</span>(output)<br><span class=\"hljs-comment\">#tensor([[ 1.5410, -0.2934, -2.1788],</span><br><span class=\"hljs-comment\">#        [ 0.5684, -1.0845, -1.3986]])</span><br><span class=\"hljs-built_in\">print</span>(F.softmax(output, dim=<span class=\"hljs-number\">1</span>))<br><span class=\"hljs-comment\"># 这里dim的意思是计算Softmax的维度，这里设置dim=1，可以看到每一行的加和为1。0是对列 1 是对行</span><br><span class=\"hljs-comment\">#tensor([[0.8446, 0.1349, 0.0205],</span><br><span class=\"hljs-comment\">#       [0.7511, 0.1438, 0.1051]])</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"What-is-log-softmax\">What is log_softmax</h4>\n<p>这个很好理解，其实就是对<code>softmax</code>处理之后的结果执行一次对数运算。可以理解为 <code>log(softmax(output))</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">print</span>(F.log_softmax(output, dim=<span class=\"hljs-number\">1</span>))<br><span class=\"hljs-built_in\">print</span>(torch.log(F.softmax(output, dim=<span class=\"hljs-number\">1</span>)))<br><span class=\"hljs-comment\"># 输出结果是一致的</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>tensor([[-0.1689, -2.0033, -3.8886],        [-0.2862, -1.9392, -2.2532]]) tensor([[-0.1689, -2.0033, -3.8886],        [-0.2862, -1.9392, -2.2532]])</p>\n</blockquote>\n<h4 id=\"损失函数\">损失函数</h4>\n<h4 id=\"What-is-NLLLoss？\">What is NLLLoss？</h4>\n<p>该函数的全称是<code>negative log likelihood loss</code>. 若$x_i=[q_1, q_2, …, q_N]$ 为神经网络对第i个样本的输出值，$y_i$为真实标签。则：<br>\n$$<br>\nf(x_i,y_i)=-q_{y_i}<br>\n$$<br>\n其中输入：log_softmax(output), target</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">print</span>(F.nll_loss(torch.tensor([[-<span class=\"hljs-number\">1.2</span>, -<span class=\"hljs-number\">2</span>, -<span class=\"hljs-number\">3</span>]]), torch.tensor([<span class=\"hljs-number\">0</span>])))<br><span class=\"hljs-comment\">#结果是tensor(1.2000) 就是取第0个的负数</span><br></code></pre></td></tr></table></figure>\n<p><strong>通常我们结合 log_softmax 和 nll_loss一起用</strong> 👋。</p>\n<h4 id=\"CrossEntropy交叉熵\">CrossEntropy交叉熵</h4>\n<p><strong>在分类问题中，CrossEntropy等价于log_softmax 结合 nll_loss</strong></p>\n<p>$N$分类问题，对于一个特定的样本，已知其真实标签，<code>CrossEntropy</code>的计算公式为：</p>\n<p>$$<br>\ncross_entropy=-\\sum_{k=1}^{N}\\left(p_{k} * \\log q_{k}\\right)<br>\n$$</p>\n<p>其中p表示真实值，在这个公式中是one-hot形式；q是经过<code>softmax</code>计算后的结果， $q_k$为神经网络认为该样本为第$k$类的概率。</p>\n<p>仔细观察可以知道，因为p的元素不是0就是1，而且又是乘法，所以很自然地我们如果知道1所对应的index，那么就不用做其他无意义的运算了。所以在pytorch代码中target不是以one-hot形式表示的，而是直接用scalar表示。若该样本的真实标签为$y$,则交叉熵的公式可变形为：</p>\n<p>$$cross_entropy=-\\sum_{k=1}^{N}\\left(p_{k} * \\log q_{k}\\right)=-log , q_{y}$$</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">output = torch.tensor([[<span class=\"hljs-number\">1.2</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>]])<br>target = torch.tensor([<span class=\"hljs-number\">0</span>])<br><br>log_sm_output = F.log_softmax(output, dim=<span class=\"hljs-number\">1</span>)<br>nll_loss_of_log_sm_output = F.nll_loss(log_sm_output, target)<br><span class=\"hljs-built_in\">print</span>(nll_loss_of_log_sm_output)<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">output = torch.tensor([[<span class=\"hljs-number\">1.2</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>]])<br>target = torch.tensor([<span class=\"hljs-number\">0</span>])<br><br>ce_loss = F.cross_entropy(output, target)<br><span class=\"hljs-built_in\">print</span>(ce_loss)<br><br>F.cross_entropy 《==》 F.log_softmax(output, dim=<span class=\"hljs-number\">1</span>)+F.nll_loss(log_sm_output, target)<br></code></pre></td></tr></table></figure>\n<p>这两者是等价的哦~</p>\n<h4 id=\"T-softmax\">T-softmax</h4>\n<p>T-softmax的目的是平滑分布，不让分布太过于极端。比如可以看下面的实例哈。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">softmax</span>(<span class=\"hljs-params\">x</span>):</span><br>    x_exp = np.exp(x)<br>    <span class=\"hljs-keyword\">return</span> x_exp / np.<span class=\"hljs-built_in\">sum</span>(x_exp)<br><br>output = np.array([<span class=\"hljs-number\">0.1</span>, <span class=\"hljs-number\">1.6</span>, <span class=\"hljs-number\">3.6</span>])<br><span class=\"hljs-built_in\">print</span>(softmax(output))<br><span class=\"hljs-comment\">#[0.02590865 0.11611453 0.85797681]</span><br></code></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">softmax_t</span>(<span class=\"hljs-params\">x, t</span>):</span><br>    x_exp = np.exp(x / t)<br>    <span class=\"hljs-keyword\">return</span> x_exp / np.<span class=\"hljs-built_in\">sum</span>(x_exp)<br><br>output = np.array([<span class=\"hljs-number\">0.1</span>, <span class=\"hljs-number\">1.6</span>, <span class=\"hljs-number\">3.6</span>])<br><span class=\"hljs-built_in\">print</span>(softmax_t(output, <span class=\"hljs-number\">5</span>))<br><span class=\"hljs-comment\">#[0.22916797 0.3093444  0.46148762]</span><br></code></pre></td></tr></table></figure>\n<p>设置为5可以看到分布在【0，1】的数更加平滑了哦~</p>\n<h2 id=\"KD训练代码\">KD训练代码</h2>\n<h3 id=\"导入包\">导入包</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> math<br><span class=\"hljs-keyword\">import</span> torch<br><span class=\"hljs-keyword\">import</span> torch.nn <span class=\"hljs-keyword\">as</span> nn<br><span class=\"hljs-keyword\">import</span> torch.nn.functional <span class=\"hljs-keyword\">as</span> F<br><span class=\"hljs-keyword\">from</span> torchvision <span class=\"hljs-keyword\">import</span> datasets, transforms<br><span class=\"hljs-keyword\">import</span> torch.utils.data<br>torch.manual_seed(<span class=\"hljs-number\">0</span>)<br>torch.cuda.manual_seed(<span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\">#设置GPU生成随机数的种子，方便下次复现实验结果。</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"网络架构\">网络架构</h3>\n<h4 id=\"teacher网络\">teacher网络</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TeacherNet</span>(<span class=\"hljs-params\">nn.Module</span>):</span> <span class=\"hljs-comment\">#继承Module</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-built_in\">super</span>(TeacherNet, self).__init__()<br>        self.conv1 = nn.Conv2d(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">32</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>)<br>        self.conv2 = nn.Conv2d(<span class=\"hljs-number\">32</span>, <span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>)<br>        self.dropout1 = nn.Dropout2d(<span class=\"hljs-number\">0.3</span>)<br>        self.dropout2 = nn.Dropout2d(<span class=\"hljs-number\">0.5</span>)<br>        self.fc1 = nn.Linear(<span class=\"hljs-number\">9216</span>, <span class=\"hljs-number\">128</span>)<br>        self.fc2 = nn.Linear(<span class=\"hljs-number\">128</span>, <span class=\"hljs-number\">10</span>)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">forward</span>(<span class=\"hljs-params\">self, x</span>):</span><br>        x = self.conv1(x)<br>        x = F.relu(x)<br>        x = self.conv2(x)<br>        x = F.relu(x)<br>        x = F.max_pool2d(x, <span class=\"hljs-number\">2</span>)<br>        x = self.dropout1(x)<br>        x = torch.flatten(x, <span class=\"hljs-number\">1</span>)<br>        x = self.fc1(x)<br>        x = F.relu(x)<br>        x = self.dropout2(x)<br>        output = self.fc2(x)<br>        <span class=\"hljs-keyword\">return</span> output<br></code></pre></td></tr></table></figure>\n<h4 id=\"student网络\">student网络</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">StudentNet</span>(<span class=\"hljs-params\">nn.Module</span>):</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-built_in\">super</span>(StudentNet, self).__init__()<br>        self.fc1 = nn.Linear(<span class=\"hljs-number\">28</span> * <span class=\"hljs-number\">28</span>, <span class=\"hljs-number\">128</span>)<br>        self.fc2 = nn.Linear(<span class=\"hljs-number\">128</span>, <span class=\"hljs-number\">64</span>)<br>        self.fc3 = nn.Linear(<span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">10</span>)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">forward</span>(<span class=\"hljs-params\">self, x</span>):</span><br>        x = torch.flatten(x, <span class=\"hljs-number\">1</span>)<br>        x = F.relu(self.fc1(x))<br>        x = F.relu(self.fc2(x))<br>        output = F.relu(self.fc3(x))<br>        <span class=\"hljs-keyword\">return</span> output<br></code></pre></td></tr></table></figure>\n<h3 id=\"teacher网络训练\">teacher网络训练</h3>\n<h4 id=\"定义基本函数\">定义基本函数</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">train_teacher</span>(<span class=\"hljs-params\">model, device, train_loader, optimizer, epoch</span>):</span><br>    model.train() <span class=\"hljs-comment\">#train过程model.train()的作用是启用 Batch Normalization 和 Dropout。model.train()是保证BN层能够用到每一批数据的均值和方差</span><br>    trained_samples = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">for</span> batch_idx, (data, target) <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(train_loader):<br>        data, target = data.to(device), target.to(device) <span class=\"hljs-comment\">#放到GPU</span><br>        optimizer.zero_grad() <span class=\"hljs-comment\">#归0</span><br>        output = model(data) <span class=\"hljs-comment\">#得到结果</span><br>        loss = F.cross_entropy(output, target) <span class=\"hljs-comment\">#计算损失 使用交叉熵</span><br>        loss.backward() <span class=\"hljs-comment\">#后向传播更新参数</span><br>        optimizer.step() <span class=\"hljs-comment\">#优化器调整超参数</span><br><br>        trained_samples += <span class=\"hljs-built_in\">len</span>(data)<br>        progress = math.ceil(batch_idx / <span class=\"hljs-built_in\">len</span>(train_loader) * <span class=\"hljs-number\">50</span>)<br>        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;\\rTrain epoch %d: %d/%d, [%-51s] %d%%&quot;</span> %<br>              (epoch, trained_samples, <span class=\"hljs-built_in\">len</span>(train_loader.dataset),<br>               <span class=\"hljs-string\">&#x27;-&#x27;</span> * progress + <span class=\"hljs-string\">&#x27;&gt;&#x27;</span>, progress * <span class=\"hljs-number\">2</span>), end=<span class=\"hljs-string\">&#x27;&#x27;</span>)<br><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">test_teacher</span>(<span class=\"hljs-params\">model, device, test_loader</span>):</span><br>    model.<span class=\"hljs-built_in\">eval</span>() <span class=\"hljs-comment\">#保证BN层能够用全部训练数据的均值和方差</span><br>    test_loss = <span class=\"hljs-number\">0</span><br>    correct = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">with</span> torch.no_grad(): <span class=\"hljs-comment\">#冻结参数</span><br>        <span class=\"hljs-keyword\">for</span> data, target <span class=\"hljs-keyword\">in</span> test_loader:<br>            data, target = data.to(device), target.to(device)<br>            output = model(data) <span class=\"hljs-comment\">#模型得到结果</span><br>            test_loss += F.cross_entropy(output, target, reduction=<span class=\"hljs-string\">&#x27;sum&#x27;</span>).item()  <span class=\"hljs-comment\"># 统计所有的losssum up batch loss</span><br>            pred = output.argmax(dim=<span class=\"hljs-number\">1</span>, keepdim=<span class=\"hljs-literal\">True</span>)  <span class=\"hljs-comment\"># get the index of the max log-probability 得到每一行的最大值下标</span><br>            correct += pred.eq(target.view_as(pred)).<span class=\"hljs-built_in\">sum</span>().item() <span class=\"hljs-comment\">#eq是一个判断函数 view_as是拉成一列</span><br><br>    test_loss /= <span class=\"hljs-built_in\">len</span>(test_loader.dataset) <span class=\"hljs-comment\">#得到平均loss</span><br><br>    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&#x27;\\nTest: average loss: &#123;:.4f&#125;, accuracy: &#123;&#125;/&#123;&#125; (&#123;:.0f&#125;%)&#x27;</span>.<span class=\"hljs-built_in\">format</span>(<br>        test_loss, correct, <span class=\"hljs-built_in\">len</span>(test_loader.dataset),<br>        <span class=\"hljs-number\">100.</span> * correct / <span class=\"hljs-built_in\">len</span>(test_loader.dataset)))<br>    <span class=\"hljs-keyword\">return</span> test_loss, correct / <span class=\"hljs-built_in\">len</span>(test_loader.dataset)<br><br></code></pre></td></tr></table></figure>\n<h4 id=\"训练主函数\">训练主函数</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">teacher_main</span>():</span><br>    epochs = <span class=\"hljs-number\">10</span><br>    batch_size = <span class=\"hljs-number\">64</span><br>    torch.manual_seed(<span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\">#设置CPU生成随机数的种子，方便下次复现实验结果。</span><br><br>    device = torch.device(<span class=\"hljs-string\">&quot;cuda&quot;</span> <span class=\"hljs-keyword\">if</span> torch.cuda.is_available() <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">&quot;cpu&quot;</span>)<br><br>    train_loader = torch.utils.data.DataLoader(<br>        datasets.MNIST(<span class=\"hljs-string\">&#x27;../data/MNIST&#x27;</span>, train=<span class=\"hljs-literal\">True</span>, download=<span class=\"hljs-literal\">True</span>,<br>                       transform=transforms.Compose([<br>                           transforms.ToTensor(),<br>                           transforms.Normalize((<span class=\"hljs-number\">0.1307</span>,), (<span class=\"hljs-number\">0.3081</span>,))<br>                       ])),<br>        batch_size=batch_size, shuffle=<span class=\"hljs-literal\">True</span>)<br>    test_loader = torch.utils.data.DataLoader(<br>        datasets.MNIST(<span class=\"hljs-string\">&#x27;../data/MNIST&#x27;</span>, train=<span class=\"hljs-literal\">False</span>, download=<span class=\"hljs-literal\">True</span>, transform=transforms.Compose([<br>            transforms.ToTensor(),<br>            transforms.Normalize((<span class=\"hljs-number\">0.1307</span>,), (<span class=\"hljs-number\">0.3081</span>,))<br>        ])),<br>        batch_size=<span class=\"hljs-number\">1000</span>, shuffle=<span class=\"hljs-literal\">True</span>)<br><br>    model = TeacherNet().to(device) <span class=\"hljs-comment\">#模型装进GPU中</span><br>    optimizer = torch.optim.Adadelta(model.parameters()) <span class=\"hljs-comment\">#定义优化器 其实需要传入模型参数让优化器知道参数空间</span><br>    <span class=\"hljs-string\">&#x27;&#x27;&#x27;</span><br><span class=\"hljs-string\">    optimzier优化器的作用：优化器就是需要根据网络反向传播的梯度信息来</span><br><span class=\"hljs-string\">    再次更新网络的参数，以起到降低loss函数计算值的作用。</span><br><span class=\"hljs-string\">    &#x27;&#x27;&#x27;</span><br>    <br>    teacher_history = [] <span class=\"hljs-comment\">#保存历史数据</span><br><br>    <span class=\"hljs-keyword\">for</span> epoch <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>, epochs + <span class=\"hljs-number\">1</span>):<br>        train_teacher(model, device, train_loader, optimizer, epoch)<br>        loss, acc = test_teacher(model, device, test_loader) <span class=\"hljs-comment\">#相当于验证集作用 也可以绘图</span><br>        <br>        teacher_history.append((loss, acc))<br><br>    torch.save(model.state_dict(), <span class=\"hljs-string\">&quot;teacher.pt&quot;</span>)<br>    <span class=\"hljs-keyword\">return</span> model, teacher_history<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># 训练教师网络</span><br>teacher_model, teacher_history = teacher_main()<br></code></pre></td></tr></table></figure>\n<h3 id=\"student网络训练（重点）🌸\">student网络训练（重点）🌸</h3>\n<h4 id=\"理论部分\">理论部分</h4>\n<p><img src=\"https://picture.mulindya.com/kDistillation-10.png\" alt=\"\"></p>\n<p>这里的q是经过了<code>softmax</code>之后的分布</p>\n<p>student的loss来源于两个部分，Loss将两个loss相加</p>\n<ul>\n<li>studet的HARD Loss是根据one-hot的真实样本p分布得到（和一般的loss一样）</li>\n<li>student的SOFT loss是来源于teacher的分布q’‘（是将q’蒸馏平滑后的结果）</li>\n</ul>\n<h4 id=\"定义kd的loss\">定义kd的loss</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># 这里定义的是SOFT Loss + 交叉熵（HARD Loss）</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">distillation</span>(<span class=\"hljs-params\">y, labels, teacher_scores, temp, alpha</span>):</span><br>    <span class=\"hljs-keyword\">return</span> nn.KLDivLoss()(F.log_softmax(y / temp, dim=<span class=\"hljs-number\">1</span>), F.softmax(teacher_scores / temp, dim=<span class=\"hljs-number\">1</span>)) * (<br>            temp * temp * <span class=\"hljs-number\">2.0</span> * alpha) + F.cross_entropy(y, labels) * (<span class=\"hljs-number\">1.</span> - alpha) <span class=\"hljs-comment\">#两个分布都是T_softmax来求相对熵</span><br><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>nn.KLDivLoss()(input,target)相对熵损失 通过求散度得到Loss值</p>\n<p>用于衡量两个分布的相似性，越小越相似</p>\n</blockquote>\n\n$$\nl_{n}=y_{n} \\cdot\\left(\\log y_{n}-x_{n}\\right)\n$$\n\n<p>可以指定loss function的reduction参数，来设置每个样本loss的最后得到数据loss计算方式；</p>\n\n$$\n\\ell(x, y)=\\left\\{\\begin{array}{ll}L, & \\text { if reduction }=\\text { 'none' } \\\\ \\operatorname{mean}(L), & \\text { if reduction }=\\text { 'mean' } \\\\ N*\\operatorname {mean}(L), & \\text { if reduction }=\\text { 'batchmean' } \\\\ \\operatorname{sum}(L), & \\text { if reduction }=\\text { 'sum' }\\end{array} \\right.\n$$\n\n<h4 id=\"定义基本函数-2\">定义基本函数</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">train_student_kd</span>(<span class=\"hljs-params\">model, device, train_loader, optimizer, epoch</span>):</span><br>    model.train()<br>    trained_samples = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">for</span> batch_idx, (data, target) <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(train_loader):<br>        data, target = data.to(device), target.to(device)<br>        optimizer.zero_grad()<br>        output = model(data)<br>        teacher_output = teacher_model(data)  <span class=\"hljs-comment\">#得到teacher网络的推断用于后续计算student的loss</span><br>        teacher_output = teacher_output.detach()  <span class=\"hljs-comment\"># 切断老师网络的反向传播</span><br>        loss = distillation(output, target, teacher_output, temp=<span class=\"hljs-number\">5.0</span>, alpha=<span class=\"hljs-number\">0.7</span>)<br>        loss.backward()<br>        optimizer.step()<br><br>        trained_samples += <span class=\"hljs-built_in\">len</span>(data)<br>        progress = math.ceil(batch_idx / <span class=\"hljs-built_in\">len</span>(train_loader) * <span class=\"hljs-number\">50</span>)<br>        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;\\rTrain epoch %d: %d/%d, [%-51s] %d%%&quot;</span> %<br>              (epoch, trained_samples, <span class=\"hljs-built_in\">len</span>(train_loader.dataset),<br>               <span class=\"hljs-string\">&#x27;-&#x27;</span> * progress + <span class=\"hljs-string\">&#x27;&gt;&#x27;</span>, progress * <span class=\"hljs-number\">2</span>), end=<span class=\"hljs-string\">&#x27;&#x27;</span>)<br><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">test_student_kd</span>(<span class=\"hljs-params\">model, device, test_loader</span>):</span><br>    model.<span class=\"hljs-built_in\">eval</span>()<br>    test_loss = <span class=\"hljs-number\">0</span><br>    correct = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">with</span> torch.no_grad():<br>        <span class=\"hljs-keyword\">for</span> data, target <span class=\"hljs-keyword\">in</span> test_loader:<br>            data, target = data.to(device), target.to(device)<br>            output = model(data)<br>            test_loss += F.cross_entropy(output, target, reduction=<span class=\"hljs-string\">&#x27;sum&#x27;</span>).item()  <span class=\"hljs-comment\"># sum up batch loss item()函数可以理解为得到纯粹的数值</span><br>            pred = output.argmax(dim=<span class=\"hljs-number\">1</span>, keepdim=<span class=\"hljs-literal\">True</span>)  <span class=\"hljs-comment\"># get the index of the max log-probability</span><br>            correct += pred.eq(target.view_as(pred)).<span class=\"hljs-built_in\">sum</span>().item()<br><br>    test_loss /= <span class=\"hljs-built_in\">len</span>(test_loader.dataset)<br><br>    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&#x27;\\nTest: average loss: &#123;:.4f&#125;, accuracy: &#123;&#125;/&#123;&#125; (&#123;:.0f&#125;%)&#x27;</span>.<span class=\"hljs-built_in\">format</span>(<br>        test_loss, correct, <span class=\"hljs-built_in\">len</span>(test_loader.dataset),<br>        <span class=\"hljs-number\">100.</span> * correct / <span class=\"hljs-built_in\">len</span>(test_loader.dataset)))<br>    <span class=\"hljs-keyword\">return</span> test_loss, correct / <span class=\"hljs-built_in\">len</span>(test_loader.dataset)<br></code></pre></td></tr></table></figure>\n<h4 id=\"训练主函数-2\">训练主函数</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">student_kd_main</span>():</span><br>    epochs = <span class=\"hljs-number\">10</span><br>    batch_size = <span class=\"hljs-number\">64</span><br>    torch.manual_seed(<span class=\"hljs-number\">0</span>)<br><br>    device = torch.device(<span class=\"hljs-string\">&quot;cuda&quot;</span> <span class=\"hljs-keyword\">if</span> torch.cuda.is_available() <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">&quot;cpu&quot;</span>)<br><br>    train_loader = torch.utils.data.DataLoader(<br>        datasets.MNIST(<span class=\"hljs-string\">&#x27;../data/MNIST&#x27;</span>, train=<span class=\"hljs-literal\">True</span>, download=<span class=\"hljs-literal\">True</span>,<br>                       transform=transforms.Compose([<br>                           transforms.ToTensor(),<br>                           transforms.Normalize((<span class=\"hljs-number\">0.1307</span>,), (<span class=\"hljs-number\">0.3081</span>,))<br>                       ])),<br>        batch_size=batch_size, shuffle=<span class=\"hljs-literal\">True</span>)<br>    test_loader = torch.utils.data.DataLoader(<br>        datasets.MNIST(<span class=\"hljs-string\">&#x27;../data/MNIST&#x27;</span>, train=<span class=\"hljs-literal\">False</span>, download=<span class=\"hljs-literal\">True</span>, transform=transforms.Compose([<br>            transforms.ToTensor(),<br>            transforms.Normalize((<span class=\"hljs-number\">0.1307</span>,), (<span class=\"hljs-number\">0.3081</span>,))<br>        ])),<br>        batch_size=<span class=\"hljs-number\">1000</span>, shuffle=<span class=\"hljs-literal\">True</span>)<br><br>    model = StudentNet().to(device)<br>    optimizer = torch.optim.Adadelta(model.parameters())<br>    <br>    student_history = []<br>    <span class=\"hljs-keyword\">for</span> epoch <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>, epochs + <span class=\"hljs-number\">1</span>):<br>        train_student_kd(model, device, train_loader, optimizer, epoch)<br>        loss, acc = test_student_kd(model, device, test_loader)<br>        student_history.append((loss, acc))<br><br>    torch.save(model.state_dict(), <span class=\"hljs-string\">&quot;student_kd.pt&quot;</span>)<br>    <span class=\"hljs-keyword\">return</span> model, student_history<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">student_kd_model, student_kd_history = student_kd_main()<br></code></pre></td></tr></table></figure>\n<h3 id=\"绘制结果\">绘制结果</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> matplotlib.pyplot <span class=\"hljs-keyword\">as</span> plt<br>epochs = <span class=\"hljs-number\">10</span><br>x = <span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>, epochs+<span class=\"hljs-number\">1</span>))<br><br>plt.subplot(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>)<br>plt.plot(x, [teacher_history[i][<span class=\"hljs-number\">1</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">&#x27;teacher&#x27;</span>)<br>plt.plot(x, [student_kd_history[i][<span class=\"hljs-number\">1</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">&#x27;student with KD&#x27;</span>)<br>plt.plot(x, [student_simple_history[i][<span class=\"hljs-number\">1</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">&#x27;student without KD&#x27;</span>)<br><br>plt.title(<span class=\"hljs-string\">&#x27;Test accuracy&#x27;</span>)<br>plt.legend()<br><br><br>plt.subplot(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>)<br>plt.plot(x, [teacher_history[i][<span class=\"hljs-number\">0</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">&#x27;teacher&#x27;</span>)<br>plt.plot(x, [student_kd_history[i][<span class=\"hljs-number\">0</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">&#x27;student with KD&#x27;</span>)<br>plt.plot(x, [student_simple_history[i][<span class=\"hljs-number\">0</span>] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(epochs)], label=<span class=\"hljs-string\">&#x27;student without KD&#x27;</span>)<br><br>plt.title(<span class=\"hljs-string\">&#x27;Test loss&#x27;</span>)<br>plt.legend()<br></code></pre></td></tr></table></figure>\n<p><img src=\"https://picture.mulindya.com/kDistillation-13.png\" alt=\"\"></p>\n<p>可以看到在teacher的帮助下，student可以学得更好🐱</p>\n<h3 id=\"teacher网络的暗知识🎍\">teacher网络的暗知识🎍</h3>\n<h4 id=\"softmax-t\">softmax_t</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><span class=\"hljs-keyword\">from</span> matplotlib <span class=\"hljs-keyword\">import</span> pyplot <span class=\"hljs-keyword\">as</span> plt<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">softmax_t</span>(<span class=\"hljs-params\">x, t</span>):</span><br>    x_exp = np.exp(x / t)<br>    <span class=\"hljs-keyword\">return</span> x_exp / np.<span class=\"hljs-built_in\">sum</span>(x_exp)<br><br>test_loader_bs1 = torch.utils.data.DataLoader(<br>    datasets.MNIST(<span class=\"hljs-string\">&#x27;../data/MNIST&#x27;</span>, train=<span class=\"hljs-literal\">False</span>, download=<span class=\"hljs-literal\">True</span>, transform=transforms.Compose([<br>        transforms.ToTensor(),<br>        transforms.Normalize((<span class=\"hljs-number\">0.1307</span>,), (<span class=\"hljs-number\">0.3081</span>,))<br>    ])),<br>    batch_size=<span class=\"hljs-number\">1</span>, shuffle=<span class=\"hljs-literal\">True</span>)<br></code></pre></td></tr></table></figure>\n<h4 id=\"推断\">推断</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">teacher_model.<span class=\"hljs-built_in\">eval</span>()<br><span class=\"hljs-keyword\">with</span> torch.no_grad():<br>    data, target = <span class=\"hljs-built_in\">next</span>(<span class=\"hljs-built_in\">iter</span>(test_loader_bs1))<br>    data, target = data.to(<span class=\"hljs-string\">&#x27;cuda&#x27;</span>), target.to(<span class=\"hljs-string\">&#x27;cuda&#x27;</span>)<br>    output = teacher_model(data)<br><br>test_x = data.cpu().numpy() <span class=\"hljs-comment\">#放进cpu转换成numpy</span><br>y_out = output.cpu().numpy()<br>y_out = y_out[<span class=\"hljs-number\">0</span>, ::]<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&#x27;Output (NO softmax):&#x27;</span>, y_out)<br><br><br><br>plt.subplot(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>)<br>plt.imshow(test_x[<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, ::])<br><br>plt.subplot(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>)<br>plt.bar(<span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">10</span>)), softmax_t(y_out, <span class=\"hljs-number\">1</span>), width=<span class=\"hljs-number\">0.3</span>) <span class=\"hljs-comment\">#直方图</span><br><br>plt.subplot(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">3</span>)<br>plt.bar(<span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">10</span>)), softmax_t(y_out, <span class=\"hljs-number\">10</span>), width=<span class=\"hljs-number\">0.3</span>)<br>plt.show()<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>Output (NO softmax): [-31.14481   -30.600847   -3.2787514 -20.624037  -31.863455  -37.684086 -35.177486  -22.72263   -16.028662  -26.460657 ]</p>\n</blockquote>\n<p><img src=\"https://picture.mulindya.com/kDistillation-12.png\" alt=\"\"></p>\n<p>可以看到数据更加平滑，并且可以体现出这个数字不仅是2还和8有些类似⛄️。</p>\n<h2 id=\"本质🎈\">本质🎈</h2>\n<p><img src=\"https://picture.mulindya.com/kDistillation-11.png\" alt=\"\"></p>\n<p>在知识蒸馏中，本质上就是使用SOFT Loss来替代正则化项，去拟合teacher的效果。</p>\n<p>L2左边是极大似然，右边是先验知识（人为设置）</p>\n<p>这里用teacher的知识去正则化作为先验知识，嗯！nice！</p>\n"},{"title":"kaggle比赛介绍--Sartorius - Cell Instance Segmentation","date":"2021-10-21T08:18:08.000Z","math":true,"_content":"\n> 最近参赛Sartorius - Cell Instance Segmentation，对竞赛题目和相关注意点进行梳理记录，以便后续回顾。\n\n## 竞赛说明\n\nSartorius - Cell Instance Segmentation，是一个有关医学图像**实例分割**的竞赛\n\n地址： https://www.kaggle.com/c/sartorius-cell-instance-segmentation/overview\n\n### Description\n\nNeurological disorders, including neurodegenerative diseases such as Alzheimer's and brain tumors, are a leading cause of death and disability across the globe. However, it is hard to quantify how well these deadly disorders respond to treatment. **One accepted method is to review neuronal cells via light microscopy,** which is both accessible and non-invasive. Unfortunately, **segmenting individual neuronal cells** in microscopic images can be challenging and time-intensive. Accurate instance segmentation of these cells—with the help of computer vision—could lead to new and effective drug discoveries to treat the millions of people with these disorders.\n\n![img](https://storage.googleapis.com/kaggle-media/competitions/Sartorius/Sartorius_Competition%20Description%20Image%20350x379.png)\n\nCurrent solutions have limited accuracy for neuronal cells in particular. In internal studies to develop cell instance segmentation models, the neuroblastoma cell line SH-SY5Y consistently exhibits the lowest precision scores out of eight different cancer cell types tested. This could be because neuronal cells have a very **unique, irregular and concave morphology** associated with them, making them challenging to segment with commonly used mask heads.\n\nSartorius is a partner of the life science research and the biopharmaceutical industry. They empower scientists and engineers to simplify and accelerate progress in life science and bioprocessing, enabling the development of new and better therapies and more affordable medicine. They're a magnet and dynamic platform for pioneers and leading experts in the field. They bring creative minds together for a common goal: technological breakthroughs that lead to better health for more people.\n\n<font color=purple > **In this competition, you’ll detect and delineate distinct objects of interest in biological images depicting neuronal cell types commonly used in the study of neurological disorders.** More specifically, you'll use phase contrast microscopy images to train and test your model for instance segmentation of neuronal cells. Successful models will do this with a high level of accuracy.</font>\n\nIf successful, you'll help further research in neurobiology thanks to the collection of robust quantitative data. Researchers may be able to use this to more easily measure the effects of disease and treatment conditions on neuronal cells. As a result, new drugs could be discovered to treat the millions of people with these leading causes of death and disability.\n\n#### 个人理解\n\n也就是说为了量化神经系统类的致命疾病对治疗的反应。一种方法是通过光学显微镜检查神经元细胞，因为这种方法既方便又非侵入性。但是，在显微图像中分割单个神经元细胞可能具有挑战性且耗时。所以需要采取计算机视觉的方法提高精度和效率。由于神经母细胞瘤细胞系（SH-SY5Y）独特，不规则，凹形的形态（unique, irregular and concave morphology），使用常规的分割模型进行分割效果不好。\n\n### Evaluation\n\nThis competition is evaluated on the mean average precision at different intersection over union IUO thresholds. The IoU of a proposed set of object pixels and a set of true object pixels is calculated as:\n\n$$\nIoU(A,B) = \\frac{A \\cap B}{A \\cup B}\n$$\n\nThe metric sweeps over a range of IoU thresholds, at each point calculating an average precision value. The threshold values range from 0.5 to 0.95 with a step size of 0.05: `(0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95)`. In other words, at a threshold of 0.5, a predicted object is considered a \"hit\" if its intersection over union with a ground truth object is greater than 0.5.\n\nAt each threshold value **t**, a precision value is calculated based on the number of true positives **TP**, false negatives **FN**, and false positives **FP** resulting from comparing the predicted object to all ground truth objects:\n\n$$\n\\frac{TP(t)}{TP(t)+FP(t)+FN(t)}\n$$\n\nA true positive is counted when a single predicted object matches a ground truth object with an IoU above the threshold. A false positive indicates a predicted object had no associated ground truth object. A false negative indicates a ground truth object had no associated predicted object. The average precision of a single image is then calculated as the mean of the above precision values at each IoU threshold:\n$$\n\\frac{1}{\\vert thresholds \\vert} \\sum_t \\frac{TP(t)}{TP{t}+FP(t)+FN(t)}\n$$\nLastly, the score returned by the competition metric is the mean taken over the individual average precisions of each image in the test dataset.\n\n#### 个人理解\n\n此处介绍了评估指标，以及最后排名score的度量方式。人为设置prediction和ground truth的IoU的thresholds，这样可以度量TP，FN，FP（正确实例分割object个数，没有检测到的object个数，误检出的object个数），进而得到score。\n\n##### 疑问\n\n- 这里评估指标中没有提到分类，实例分割除了分割前景和背景，不应该还需要评估类别吗？还是说在度量IOU的时候已经包含了对类别的判断。\n- 最后的score中为什么要除以thresholds，意义何在？\n\n## Submission File\n\nIn order to reduce the submission file size, our metric uses run-length encoding on the pixel values. Instead of submitting an exhaustive list of indices for your segmentation, you will submit pairs of values that contain a start position and a run length. E.g. '1 3' implies starting at pixel 1 and running a total of 3 pixels 1,2,3.\n\nThe competition format requires a space delimited list of pairs. **For example, '1 3 10 5' implies pixels 1,2,3,10,11,12,13,14 are to be included in the mask. The pixels are one-indexed**\n**and numbered from top to bottom, then left to right: 1 is pixel 1,1, 2 is pixel 2,1, etc.**\n\nThe metric checks that the pairs are sorted, positive, and the decoded pixel values are not duplicated. <font color=purple>**It also checks that no two predicted masks for the same image are overlapping.**</font>\n\nThe file should contain a header and have the following format. Each row in your submission represents a single predicted nucleus segmentation for the given `ImageId`.\n\n```\nid,predicted  \n0114f484a16c152baa2d82fdd43740880a762c93f436c8988ac461c5c9dbe7d5,1 1  \n0999dab07b11bc85fb8464fc36c947fbd8b5d6ec49817361cb780659ca805eac,1 1  \n0999dab07b11bc85fb8464fc36c947fbd8b5d6ec49817361cb780659ca805eac,2 3 8 9  \netc...\n```\n\nSubmission files may take several minutes to process due to the size.\n\n#### 个人理解\n\n这里说明了提交的文件格式。\n\n- 不同与一般的图像文件，首先需要将图片的像素点从上到下，从左到右标号为1，2，3.....,然后将图片的分割得到的像素点标识为`'起始点1 个数1 起始点2 个数2 .....'`，\n\n- 注意点是提交的预测在同一张图中预测的mask不允许有重合像素。也就是说该竞赛涉及对于不同的细胞系实例分割，并且在一张图上分割的细胞系mask，不能有交点。**训练数据中label是会出现重叠部分的，在预测的结果中需要消除预测重叠部分。**\n  \n    > Note: while predictions are not allowed to overlap, the training labels are provided in full (with overlapping portions included). This is to ensure that models are provided the full data for each object. Removing overlap in predictions is a task for the competitor.\n\n##### attention（待尝试）\n\n在讨论区中有人说mask实际上要 (left -> right, top -> bottom) 标号，不知道后续主办方有没有更换内部测试代码。\n\n##### Mask encoding\n\nIn submission, we have to encoding mask. Evaluation page show the pixels are numbered from top to bottom, then left to right. But, this is not correct. As you know, the training annotations provided are numbered from left to right, then top to bottom, and this is also the case with submission.\nAn LB score with encoded mask (top -> bottom, left -> right) was 0.0000, but a score with (left -> right, top -> bottom) was over 0.22.\nUnfortunately, the evaluation page is just a copy from Data Science Bowl 2018. I hope that the competition hosts will update the evaluation page for this competition.\n[@christoffersartorius](https://www.kaggle.com/christoffersartorius) [@addisonhoward](https://www.kaggle.com/addisonhoward)\n\n#### tips\n\n**后续可参考**\n\n**RLE**相关代码说明（https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278663）\n\nIn this great [EDA notebook](https://www.kaggle.com/ihelon/cell-segmentation-run-length-decoding) created by [@ihelon](https://www.kaggle.com/ihelon), I found Inversion's classical [RLE encoding function](https://www.kaggle.com/ihelon/cell-segmentation-run-length-decoding). The function has definitely stood the test of time and works great here, but I had a bit of difficulty understanding it, so I refactored it to be a bit easier for beginners. Here's the code (with some personal notes):\n\n```python\n# modified from: https://www.kaggle.com/inversion/run-length-decoding-quick-start\ndef rle_decode_refactored(mask_rle, shape, color=1):\n    '''\n    mask_rle: run-length as string formated (start length)\n    shape: (height,width) of array to return \n    Returns numpy array, 1 - mask, 0 - background\n    '''\n    # Split the string by space, then convert it into a integer array\n    s = np.array(mask_rle.split(), dtype=int)\n\n    # Every even value is the start, every odd value is the \"run\" length\n    starts = s[0::2] - 1\n    lengths = s[1::2]\n    ends = starts + lengths\n\n    # The image image is actually flattened since RLE is a 1D \"run\"\n    h, w, d = shape\n    img = np.zeros((h * w, d), dtype=np.float32)\n\n    # The color here is actually just any integer you want!\n    for lo, hi in zip(starts, ends):\n        img[lo : hi] = color\n    # Don't forget to change the image back to the original shape\n    return img.reshape(shape)\n```\n\n### Timeline\n\n12月30号是最终的截止日期，冲冲冲！\n\n- **October 14, 2021** - Start Date.\n- **December 23, 2021** - Entry Deadline. You must accept the competition rules before this date in order to compete.\n- **December 23, 2021** - Team Merger Deadline. This is the last day participants may join or merge teams.\n- **December 30, 2021** - Final Submission Deadline.\n\nAll deadlines are at 11:59 PM UTC on the corresponding day unless otherwise noted. The competition organizers reserve the right to update the contest timeline if they deem it necessary.\n\n## 相关paper\n\n参考 https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278716\n\n**Papers:**\n\n- [Instance Segmentation of Neural Cells](https://www.researchgate.net/publication/329933921_Instance_Segmentation_of_Neural_Cells) - Instance segmentation of neural cells plays an important role in brain study. However, this task is challenging due to the special shapes and behaviors of neural cells. Existing methods are not precise enough to capture their tiny structures, e.g., filopodia and lamellipodia, which are critical to the understanding of cell interaction and behavior. To this end, we propose a novel deep multi-task learning model to jointly detect and segment neural cells instance-wise. Our method is built upon SSD, with ResNet101 as the backbone to achieve both high detection accuracy and fast speed. Furthermore, unlike existing works which tend to produce wavy and inaccurate boundaries, we embed a deconvolution module into SSD to better capture details. Experiments on a dataset of neural cell microscopic images show that our method is able to achieve better performance in terms of accuracy and efficiency, comparing favorably with current state-of-the-art methods.\n- [Mask-RCNN for Cell Instance Segmentation](https://www.researchgate.net/publication/340998089_Rank_6_Mask-RCNN_for_Cell_Instance_Segmentation) - We proposed an automatic nucleus segmentation algorithm of H&E stained tissue microscopy images. Mask-RCNN is a recently proposed state-of-the-art algorithm for object detection and object instance segmentation of natural images. In this paper, we demonstrate that Mask-RCNN can be used to perform highly effective and efficient automatic segmentation of H&E microscopy images for cell nuclei. We propose a novel MASK Non-maximum suppression (NMS) module which can automatically ensemble classifiers results and increase the robustness of model.\n- [IRNet: Instance Relation Network for Overlapping Cervical Cell Segmentation](https://arxiv.org/abs/1908.06623) - Cell instance segmentation in Pap smear image remains challenging due to the wide existence of occlusion among translucent cytoplasm in cell clumps. Conventional methods heavily rely on accurate nuclei detection results and are easily disturbed by miscellaneous objects. In this paper, we propose a novel Instance Relation Network (IRNet) for robust overlapping cell segmentation by exploring instance relation interaction. Specifically, we propose the Instance Relation Module to construct the cell association matrix for transferring information among individual cell-instance features. With the collaboration of different instances, the augmented features gain benefits from contextual information and improve semantic consistency. Meanwhile, we proposed a sparsity constrained Duplicate Removal Module to eliminate the misalignment between classification and localization accuracy for candidates selection. The largest cervical Pap smear (CPS) dataset with more than 8000 cell annotations in Pap smear image was constructed for comprehensive evaluation. Our method outperforms other methods by a large margin, demonstrating the effectiveness of exploring instance relation.\n- [Weakly Supervised Cell Instance Segmentation by Propagating from Detection Response](https://www.researchgate.net/publication/336392797_Weakly_Supervised_Cell_Instance_Segmentation_by_Propagating_from_Detection_Response) - Cell shape analysis is important in biomedical research. Deep learning methods may perform to segment individual cells if they use sufficient training data that the boundary of each cell is annotated. However, it is very time-consuming for preparing such detailed annotation for many cell culture conditions. In this paper, we propose a weakly supervised method that can segment individual cell regions who touch each other with unclear boundaries in dense conditions without the training data for cell regions. We demonstrated the efficacy of our method using several data-set including multiple cell types captured by several types of microscopy. Our method achieved the highest accuracy compared with several conventional methods. In addition, we demonstrated that our method can perform without any annotation by using fluorescence images that cell nuclear were stained as training data.\n- [Deep Semi-supervised Knowledge Distillation for Overlapping Cervical Cell Instance Segmentation](https://arxiv.org/abs/2007.10787) - Deep learning methods show promising results for overlapping cervical cell instance segmentation. However, in order to train a model with good generalization ability, voluminous pixel-level annotations are demanded which is quite expensive and time-consuming for acquisition. In this paper, we propose to leverage both labeled and unlabeled data for instance segmentation with improved accuracy by knowledge distillation. We propose a novel Mask-guided Mean Teacher framework with Perturbation-sensitive Sample Mining (MMT-PSM), which consists of a teacher and a student network during training. Two networks are encouraged to be consistent both in feature and semantic level under small perturbations. The teacher’s self-ensemble predictions from K-time augmented samples are used to construct the reliable pseudolabels for optimizing the student. We design a novel strategy to estimate the sensitivity to perturbations for each proposal and select informative samples from massive cases to facilitate fast and effective semantic distillation. In addition, to eliminate the unavoidable noise from the background region, we propose to use the predicted segmentation mask as guidance to enforce the feature distillation in the foreground region. Experiments show that the proposed method improves the performance significantly compared with the supervised method learned from labeled data only, and outperforms state-of-the-art semi-supervised methods.\n- [Attentive neural cell instance segmentation](https://www.sciencedirect.com/science/article/pii/S1361841518308442) - Neural cell instance segmentation, which aims at joint detection and segmentation of every neural cell in a microscopic image, is essential to many neuroscience applications. The challenge of this task in- volves cell adhesion, cell distortion, unclear cell contours, low-contrast cell protrusion structures, and background impurities. Consequently, current instance segmentation methods generally fall short of pre- cision. In this paper, we propose an attentive instance segmentation method that accurately predicts the bounding box of each cell as well as its segmentation mask simultaneously. In particular, our method builds on a joint network that combines a single shot multi-box detector (SSD) and a U-net. Furthermore, we employ the attention mechanism in both detection and segmentation modules to focus the model on the useful features. The proposed method is validated on a dataset of neural cell microscopic images. Experimental results demonstrate that our approach can accurately detect and segment neural cell in- stances at a fast speed, comparing favorably with the state-of-the-art methods.\n\n📌 [U-net with Pytorch](https://github.com/milesial/Pytorch-UNet)\n📌 [Using U-net for a Kaggle competition (AutoEncoder)](https://github.com/Fpiotro/MOLECULAR-TRANSLATION)\n\n#### attention\n\n**主办方有关LIVECell的论文**\n\nEdlund, C., Jackson, T.R., Khalid, N. et al.\nLIVECell-A large-scale dataset for label-free live cell segmentation.\nNat Methods 18, 1038 -1045 (2021).\nAvailable at: https://doi.org/10.1038/s41592-021-01249-6\n\nTheir paper is not just a dataset paper, **it evaluates the performance of both recent anchor-free and anchor-based models for each cell type under four task conditions**, which I think is very informative.\nWithin their paper, it is shown that <font color=purple>**the results are better when other cell types not included in the test data are also included in the training**</font>. This may be because using even unrelated cell types in the training data allows the model to learn morphology and other factors.\n\nTherefore, in addition to the dataset provided in Kaggle, transfer learning using other cell types in LIVECell, the predecessor of the data, will be important for this competition.\n\nIf you want to use the model trained by LIVECell for transfer learning, this page on GitHub may be useful.\n👉 https://github.com/sartorius-research/LIVECell/tree/main/model\n\nThe models are based on PyTorch, but are from FIAR's Dectron 2 library.\nDectron2: https://github.com/facebookresearch/detectron2\n\n","source":"_posts/kaggle/kaggle-intro.md","raw":"---\ntitle: kaggle比赛介绍--Sartorius - Cell Instance Segmentation\ntags: kaggle\ncategories: kaggle\ndate: 2021-10-21 16:18:08\nmath: True\n---\n\n> 最近参赛Sartorius - Cell Instance Segmentation，对竞赛题目和相关注意点进行梳理记录，以便后续回顾。\n\n## 竞赛说明\n\nSartorius - Cell Instance Segmentation，是一个有关医学图像**实例分割**的竞赛\n\n地址： https://www.kaggle.com/c/sartorius-cell-instance-segmentation/overview\n\n### Description\n\nNeurological disorders, including neurodegenerative diseases such as Alzheimer's and brain tumors, are a leading cause of death and disability across the globe. However, it is hard to quantify how well these deadly disorders respond to treatment. **One accepted method is to review neuronal cells via light microscopy,** which is both accessible and non-invasive. Unfortunately, **segmenting individual neuronal cells** in microscopic images can be challenging and time-intensive. Accurate instance segmentation of these cells—with the help of computer vision—could lead to new and effective drug discoveries to treat the millions of people with these disorders.\n\n![img](https://storage.googleapis.com/kaggle-media/competitions/Sartorius/Sartorius_Competition%20Description%20Image%20350x379.png)\n\nCurrent solutions have limited accuracy for neuronal cells in particular. In internal studies to develop cell instance segmentation models, the neuroblastoma cell line SH-SY5Y consistently exhibits the lowest precision scores out of eight different cancer cell types tested. This could be because neuronal cells have a very **unique, irregular and concave morphology** associated with them, making them challenging to segment with commonly used mask heads.\n\nSartorius is a partner of the life science research and the biopharmaceutical industry. They empower scientists and engineers to simplify and accelerate progress in life science and bioprocessing, enabling the development of new and better therapies and more affordable medicine. They're a magnet and dynamic platform for pioneers and leading experts in the field. They bring creative minds together for a common goal: technological breakthroughs that lead to better health for more people.\n\n<font color=purple > **In this competition, you’ll detect and delineate distinct objects of interest in biological images depicting neuronal cell types commonly used in the study of neurological disorders.** More specifically, you'll use phase contrast microscopy images to train and test your model for instance segmentation of neuronal cells. Successful models will do this with a high level of accuracy.</font>\n\nIf successful, you'll help further research in neurobiology thanks to the collection of robust quantitative data. Researchers may be able to use this to more easily measure the effects of disease and treatment conditions on neuronal cells. As a result, new drugs could be discovered to treat the millions of people with these leading causes of death and disability.\n\n#### 个人理解\n\n也就是说为了量化神经系统类的致命疾病对治疗的反应。一种方法是通过光学显微镜检查神经元细胞，因为这种方法既方便又非侵入性。但是，在显微图像中分割单个神经元细胞可能具有挑战性且耗时。所以需要采取计算机视觉的方法提高精度和效率。由于神经母细胞瘤细胞系（SH-SY5Y）独特，不规则，凹形的形态（unique, irregular and concave morphology），使用常规的分割模型进行分割效果不好。\n\n### Evaluation\n\nThis competition is evaluated on the mean average precision at different intersection over union IUO thresholds. The IoU of a proposed set of object pixels and a set of true object pixels is calculated as:\n\n$$\nIoU(A,B) = \\frac{A \\cap B}{A \\cup B}\n$$\n\nThe metric sweeps over a range of IoU thresholds, at each point calculating an average precision value. The threshold values range from 0.5 to 0.95 with a step size of 0.05: `(0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95)`. In other words, at a threshold of 0.5, a predicted object is considered a \"hit\" if its intersection over union with a ground truth object is greater than 0.5.\n\nAt each threshold value **t**, a precision value is calculated based on the number of true positives **TP**, false negatives **FN**, and false positives **FP** resulting from comparing the predicted object to all ground truth objects:\n\n$$\n\\frac{TP(t)}{TP(t)+FP(t)+FN(t)}\n$$\n\nA true positive is counted when a single predicted object matches a ground truth object with an IoU above the threshold. A false positive indicates a predicted object had no associated ground truth object. A false negative indicates a ground truth object had no associated predicted object. The average precision of a single image is then calculated as the mean of the above precision values at each IoU threshold:\n$$\n\\frac{1}{\\vert thresholds \\vert} \\sum_t \\frac{TP(t)}{TP{t}+FP(t)+FN(t)}\n$$\nLastly, the score returned by the competition metric is the mean taken over the individual average precisions of each image in the test dataset.\n\n#### 个人理解\n\n此处介绍了评估指标，以及最后排名score的度量方式。人为设置prediction和ground truth的IoU的thresholds，这样可以度量TP，FN，FP（正确实例分割object个数，没有检测到的object个数，误检出的object个数），进而得到score。\n\n##### 疑问\n\n- 这里评估指标中没有提到分类，实例分割除了分割前景和背景，不应该还需要评估类别吗？还是说在度量IOU的时候已经包含了对类别的判断。\n- 最后的score中为什么要除以thresholds，意义何在？\n\n## Submission File\n\nIn order to reduce the submission file size, our metric uses run-length encoding on the pixel values. Instead of submitting an exhaustive list of indices for your segmentation, you will submit pairs of values that contain a start position and a run length. E.g. '1 3' implies starting at pixel 1 and running a total of 3 pixels 1,2,3.\n\nThe competition format requires a space delimited list of pairs. **For example, '1 3 10 5' implies pixels 1,2,3,10,11,12,13,14 are to be included in the mask. The pixels are one-indexed**\n**and numbered from top to bottom, then left to right: 1 is pixel 1,1, 2 is pixel 2,1, etc.**\n\nThe metric checks that the pairs are sorted, positive, and the decoded pixel values are not duplicated. <font color=purple>**It also checks that no two predicted masks for the same image are overlapping.**</font>\n\nThe file should contain a header and have the following format. Each row in your submission represents a single predicted nucleus segmentation for the given `ImageId`.\n\n```\nid,predicted  \n0114f484a16c152baa2d82fdd43740880a762c93f436c8988ac461c5c9dbe7d5,1 1  \n0999dab07b11bc85fb8464fc36c947fbd8b5d6ec49817361cb780659ca805eac,1 1  \n0999dab07b11bc85fb8464fc36c947fbd8b5d6ec49817361cb780659ca805eac,2 3 8 9  \netc...\n```\n\nSubmission files may take several minutes to process due to the size.\n\n#### 个人理解\n\n这里说明了提交的文件格式。\n\n- 不同与一般的图像文件，首先需要将图片的像素点从上到下，从左到右标号为1，2，3.....,然后将图片的分割得到的像素点标识为`'起始点1 个数1 起始点2 个数2 .....'`，\n\n- 注意点是提交的预测在同一张图中预测的mask不允许有重合像素。也就是说该竞赛涉及对于不同的细胞系实例分割，并且在一张图上分割的细胞系mask，不能有交点。**训练数据中label是会出现重叠部分的，在预测的结果中需要消除预测重叠部分。**\n  \n    > Note: while predictions are not allowed to overlap, the training labels are provided in full (with overlapping portions included). This is to ensure that models are provided the full data for each object. Removing overlap in predictions is a task for the competitor.\n\n##### attention（待尝试）\n\n在讨论区中有人说mask实际上要 (left -> right, top -> bottom) 标号，不知道后续主办方有没有更换内部测试代码。\n\n##### Mask encoding\n\nIn submission, we have to encoding mask. Evaluation page show the pixels are numbered from top to bottom, then left to right. But, this is not correct. As you know, the training annotations provided are numbered from left to right, then top to bottom, and this is also the case with submission.\nAn LB score with encoded mask (top -> bottom, left -> right) was 0.0000, but a score with (left -> right, top -> bottom) was over 0.22.\nUnfortunately, the evaluation page is just a copy from Data Science Bowl 2018. I hope that the competition hosts will update the evaluation page for this competition.\n[@christoffersartorius](https://www.kaggle.com/christoffersartorius) [@addisonhoward](https://www.kaggle.com/addisonhoward)\n\n#### tips\n\n**后续可参考**\n\n**RLE**相关代码说明（https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278663）\n\nIn this great [EDA notebook](https://www.kaggle.com/ihelon/cell-segmentation-run-length-decoding) created by [@ihelon](https://www.kaggle.com/ihelon), I found Inversion's classical [RLE encoding function](https://www.kaggle.com/ihelon/cell-segmentation-run-length-decoding). The function has definitely stood the test of time and works great here, but I had a bit of difficulty understanding it, so I refactored it to be a bit easier for beginners. Here's the code (with some personal notes):\n\n```python\n# modified from: https://www.kaggle.com/inversion/run-length-decoding-quick-start\ndef rle_decode_refactored(mask_rle, shape, color=1):\n    '''\n    mask_rle: run-length as string formated (start length)\n    shape: (height,width) of array to return \n    Returns numpy array, 1 - mask, 0 - background\n    '''\n    # Split the string by space, then convert it into a integer array\n    s = np.array(mask_rle.split(), dtype=int)\n\n    # Every even value is the start, every odd value is the \"run\" length\n    starts = s[0::2] - 1\n    lengths = s[1::2]\n    ends = starts + lengths\n\n    # The image image is actually flattened since RLE is a 1D \"run\"\n    h, w, d = shape\n    img = np.zeros((h * w, d), dtype=np.float32)\n\n    # The color here is actually just any integer you want!\n    for lo, hi in zip(starts, ends):\n        img[lo : hi] = color\n    # Don't forget to change the image back to the original shape\n    return img.reshape(shape)\n```\n\n### Timeline\n\n12月30号是最终的截止日期，冲冲冲！\n\n- **October 14, 2021** - Start Date.\n- **December 23, 2021** - Entry Deadline. You must accept the competition rules before this date in order to compete.\n- **December 23, 2021** - Team Merger Deadline. This is the last day participants may join or merge teams.\n- **December 30, 2021** - Final Submission Deadline.\n\nAll deadlines are at 11:59 PM UTC on the corresponding day unless otherwise noted. The competition organizers reserve the right to update the contest timeline if they deem it necessary.\n\n## 相关paper\n\n参考 https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278716\n\n**Papers:**\n\n- [Instance Segmentation of Neural Cells](https://www.researchgate.net/publication/329933921_Instance_Segmentation_of_Neural_Cells) - Instance segmentation of neural cells plays an important role in brain study. However, this task is challenging due to the special shapes and behaviors of neural cells. Existing methods are not precise enough to capture their tiny structures, e.g., filopodia and lamellipodia, which are critical to the understanding of cell interaction and behavior. To this end, we propose a novel deep multi-task learning model to jointly detect and segment neural cells instance-wise. Our method is built upon SSD, with ResNet101 as the backbone to achieve both high detection accuracy and fast speed. Furthermore, unlike existing works which tend to produce wavy and inaccurate boundaries, we embed a deconvolution module into SSD to better capture details. Experiments on a dataset of neural cell microscopic images show that our method is able to achieve better performance in terms of accuracy and efficiency, comparing favorably with current state-of-the-art methods.\n- [Mask-RCNN for Cell Instance Segmentation](https://www.researchgate.net/publication/340998089_Rank_6_Mask-RCNN_for_Cell_Instance_Segmentation) - We proposed an automatic nucleus segmentation algorithm of H&E stained tissue microscopy images. Mask-RCNN is a recently proposed state-of-the-art algorithm for object detection and object instance segmentation of natural images. In this paper, we demonstrate that Mask-RCNN can be used to perform highly effective and efficient automatic segmentation of H&E microscopy images for cell nuclei. We propose a novel MASK Non-maximum suppression (NMS) module which can automatically ensemble classifiers results and increase the robustness of model.\n- [IRNet: Instance Relation Network for Overlapping Cervical Cell Segmentation](https://arxiv.org/abs/1908.06623) - Cell instance segmentation in Pap smear image remains challenging due to the wide existence of occlusion among translucent cytoplasm in cell clumps. Conventional methods heavily rely on accurate nuclei detection results and are easily disturbed by miscellaneous objects. In this paper, we propose a novel Instance Relation Network (IRNet) for robust overlapping cell segmentation by exploring instance relation interaction. Specifically, we propose the Instance Relation Module to construct the cell association matrix for transferring information among individual cell-instance features. With the collaboration of different instances, the augmented features gain benefits from contextual information and improve semantic consistency. Meanwhile, we proposed a sparsity constrained Duplicate Removal Module to eliminate the misalignment between classification and localization accuracy for candidates selection. The largest cervical Pap smear (CPS) dataset with more than 8000 cell annotations in Pap smear image was constructed for comprehensive evaluation. Our method outperforms other methods by a large margin, demonstrating the effectiveness of exploring instance relation.\n- [Weakly Supervised Cell Instance Segmentation by Propagating from Detection Response](https://www.researchgate.net/publication/336392797_Weakly_Supervised_Cell_Instance_Segmentation_by_Propagating_from_Detection_Response) - Cell shape analysis is important in biomedical research. Deep learning methods may perform to segment individual cells if they use sufficient training data that the boundary of each cell is annotated. However, it is very time-consuming for preparing such detailed annotation for many cell culture conditions. In this paper, we propose a weakly supervised method that can segment individual cell regions who touch each other with unclear boundaries in dense conditions without the training data for cell regions. We demonstrated the efficacy of our method using several data-set including multiple cell types captured by several types of microscopy. Our method achieved the highest accuracy compared with several conventional methods. In addition, we demonstrated that our method can perform without any annotation by using fluorescence images that cell nuclear were stained as training data.\n- [Deep Semi-supervised Knowledge Distillation for Overlapping Cervical Cell Instance Segmentation](https://arxiv.org/abs/2007.10787) - Deep learning methods show promising results for overlapping cervical cell instance segmentation. However, in order to train a model with good generalization ability, voluminous pixel-level annotations are demanded which is quite expensive and time-consuming for acquisition. In this paper, we propose to leverage both labeled and unlabeled data for instance segmentation with improved accuracy by knowledge distillation. We propose a novel Mask-guided Mean Teacher framework with Perturbation-sensitive Sample Mining (MMT-PSM), which consists of a teacher and a student network during training. Two networks are encouraged to be consistent both in feature and semantic level under small perturbations. The teacher’s self-ensemble predictions from K-time augmented samples are used to construct the reliable pseudolabels for optimizing the student. We design a novel strategy to estimate the sensitivity to perturbations for each proposal and select informative samples from massive cases to facilitate fast and effective semantic distillation. In addition, to eliminate the unavoidable noise from the background region, we propose to use the predicted segmentation mask as guidance to enforce the feature distillation in the foreground region. Experiments show that the proposed method improves the performance significantly compared with the supervised method learned from labeled data only, and outperforms state-of-the-art semi-supervised methods.\n- [Attentive neural cell instance segmentation](https://www.sciencedirect.com/science/article/pii/S1361841518308442) - Neural cell instance segmentation, which aims at joint detection and segmentation of every neural cell in a microscopic image, is essential to many neuroscience applications. The challenge of this task in- volves cell adhesion, cell distortion, unclear cell contours, low-contrast cell protrusion structures, and background impurities. Consequently, current instance segmentation methods generally fall short of pre- cision. In this paper, we propose an attentive instance segmentation method that accurately predicts the bounding box of each cell as well as its segmentation mask simultaneously. In particular, our method builds on a joint network that combines a single shot multi-box detector (SSD) and a U-net. Furthermore, we employ the attention mechanism in both detection and segmentation modules to focus the model on the useful features. The proposed method is validated on a dataset of neural cell microscopic images. Experimental results demonstrate that our approach can accurately detect and segment neural cell in- stances at a fast speed, comparing favorably with the state-of-the-art methods.\n\n📌 [U-net with Pytorch](https://github.com/milesial/Pytorch-UNet)\n📌 [Using U-net for a Kaggle competition (AutoEncoder)](https://github.com/Fpiotro/MOLECULAR-TRANSLATION)\n\n#### attention\n\n**主办方有关LIVECell的论文**\n\nEdlund, C., Jackson, T.R., Khalid, N. et al.\nLIVECell-A large-scale dataset for label-free live cell segmentation.\nNat Methods 18, 1038 -1045 (2021).\nAvailable at: https://doi.org/10.1038/s41592-021-01249-6\n\nTheir paper is not just a dataset paper, **it evaluates the performance of both recent anchor-free and anchor-based models for each cell type under four task conditions**, which I think is very informative.\nWithin their paper, it is shown that <font color=purple>**the results are better when other cell types not included in the test data are also included in the training**</font>. This may be because using even unrelated cell types in the training data allows the model to learn morphology and other factors.\n\nTherefore, in addition to the dataset provided in Kaggle, transfer learning using other cell types in LIVECell, the predecessor of the data, will be important for this competition.\n\nIf you want to use the model trained by LIVECell for transfer learning, this page on GitHub may be useful.\n👉 https://github.com/sartorius-research/LIVECell/tree/main/model\n\nThe models are based on PyTorch, but are from FIAR's Dectron 2 library.\nDectron2: https://github.com/facebookresearch/detectron2\n\n","slug":"kaggle/kaggle-intro","published":1,"updated":"2022-01-18T08:10:17.059Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0l600nqast9bt5ybo1l","content":"<blockquote>\n<p>最近参赛Sartorius - Cell Instance Segmentation，对竞赛题目和相关注意点进行梳理记录，以便后续回顾。</p>\n</blockquote>\n<h2 id=\"竞赛说明\">竞赛说明</h2>\n<p>Sartorius - Cell Instance Segmentation，是一个有关医学图像<strong>实例分割</strong>的竞赛</p>\n<p>地址： <a href=\"https://www.kaggle.com/c/sartorius-cell-instance-segmentation/overview\">https://www.kaggle.com/c/sartorius-cell-instance-segmentation/overview</a></p>\n<h3 id=\"Description\">Description</h3>\n<p>Neurological disorders, including neurodegenerative diseases such as Alzheimer’s and brain tumors, are a leading cause of death and disability across the globe. However, it is hard to quantify how well these deadly disorders respond to treatment. <strong>One accepted method is to review neuronal cells via light microscopy,</strong> which is both accessible and non-invasive. Unfortunately, <strong>segmenting individual neuronal cells</strong> in microscopic images can be challenging and time-intensive. Accurate instance segmentation of these cells—with the help of computer vision—could lead to new and effective drug discoveries to treat the millions of people with these disorders.</p>\n<p><img src=\"https://storage.googleapis.com/kaggle-media/competitions/Sartorius/Sartorius_Competition%20Description%20Image%20350x379.png\" alt=\"img\"></p>\n<p>Current solutions have limited accuracy for neuronal cells in particular. In internal studies to develop cell instance segmentation models, the neuroblastoma cell line SH-SY5Y consistently exhibits the lowest precision scores out of eight different cancer cell types tested. This could be because neuronal cells have a very <strong>unique, irregular and concave morphology</strong> associated with them, making them challenging to segment with commonly used mask heads.</p>\n<p>Sartorius is a partner of the life science research and the biopharmaceutical industry. They empower scientists and engineers to simplify and accelerate progress in life science and bioprocessing, enabling the development of new and better therapies and more affordable medicine. They’re a magnet and dynamic platform for pioneers and leading experts in the field. They bring creative minds together for a common goal: technological breakthroughs that lead to better health for more people.</p>\n<p><font color=\"purple\"> <strong>In this competition, you’ll detect and delineate distinct objects of interest in biological images depicting neuronal cell types commonly used in the study of neurological disorders.</strong> More specifically, you’ll use phase contrast microscopy images to train and test your model for instance segmentation of neuronal cells. Successful models will do this with a high level of accuracy.</font></p>\n<p>If successful, you’ll help further research in neurobiology thanks to the collection of robust quantitative data. Researchers may be able to use this to more easily measure the effects of disease and treatment conditions on neuronal cells. As a result, new drugs could be discovered to treat the millions of people with these leading causes of death and disability.</p>\n<h4 id=\"个人理解\">个人理解</h4>\n<p>也就是说为了量化神经系统类的致命疾病对治疗的反应。一种方法是通过光学显微镜检查神经元细胞，因为这种方法既方便又非侵入性。但是，在显微图像中分割单个神经元细胞可能具有挑战性且耗时。所以需要采取计算机视觉的方法提高精度和效率。由于神经母细胞瘤细胞系（SH-SY5Y）独特，不规则，凹形的形态（unique, irregular and concave morphology），使用常规的分割模型进行分割效果不好。</p>\n<h3 id=\"Evaluation\">Evaluation</h3>\n<p>This competition is evaluated on the mean average precision at different intersection over union IUO thresholds. The IoU of a proposed set of object pixels and a set of true object pixels is calculated as:</p>\n<p>$$<br>\nIoU(A,B) = \\frac{A \\cap B}{A \\cup B}<br>\n$$</p>\n<p>The metric sweeps over a range of IoU thresholds, at each point calculating an average precision value. The threshold values range from 0.5 to 0.95 with a step size of 0.05: <code>(0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95)</code>. In other words, at a threshold of 0.5, a predicted object is considered a “hit” if its intersection over union with a ground truth object is greater than 0.5.</p>\n<p>At each threshold value <strong>t</strong>, a precision value is calculated based on the number of true positives <strong>TP</strong>, false negatives <strong>FN</strong>, and false positives <strong>FP</strong> resulting from comparing the predicted object to all ground truth objects:</p>\n<p>$$<br>\n\\frac{TP(t)}{TP(t)+FP(t)+FN(t)}<br>\n$$</p>\n<p>A true positive is counted when a single predicted object matches a ground truth object with an IoU above the threshold. A false positive indicates a predicted object had no associated ground truth object. A false negative indicates a ground truth object had no associated predicted object. The average precision of a single image is then calculated as the mean of the above precision values at each IoU threshold:<br>\n$$<br>\n\\frac{1}{\\vert thresholds \\vert} \\sum_t \\frac{TP(t)}{TP{t}+FP(t)+FN(t)}<br>\n$$<br>\nLastly, the score returned by the competition metric is the mean taken over the individual average precisions of each image in the test dataset.</p>\n<h4 id=\"个人理解-2\">个人理解</h4>\n<p>此处介绍了评估指标，以及最后排名score的度量方式。人为设置prediction和ground truth的IoU的thresholds，这样可以度量TP，FN，FP（正确实例分割object个数，没有检测到的object个数，误检出的object个数），进而得到score。</p>\n<h5 id=\"疑问\">疑问</h5>\n<ul>\n<li>这里评估指标中没有提到分类，实例分割除了分割前景和背景，不应该还需要评估类别吗？还是说在度量IOU的时候已经包含了对类别的判断。</li>\n<li>最后的score中为什么要除以thresholds，意义何在？</li>\n</ul>\n<h2 id=\"Submission-File\">Submission File</h2>\n<p>In order to reduce the submission file size, our metric uses run-length encoding on the pixel values. Instead of submitting an exhaustive list of indices for your segmentation, you will submit pairs of values that contain a start position and a run length. E.g. ‘1 3’ implies starting at pixel 1 and running a total of 3 pixels 1,2,3.</p>\n<p>The competition format requires a space delimited list of pairs. <strong>For example, ‘1 3 10 5’ implies pixels 1,2,3,10,11,12,13,14 are to be included in the mask. The pixels are one-indexed</strong><br>\n<strong>and numbered from top to bottom, then left to right: 1 is pixel 1,1, 2 is pixel 2,1, etc.</strong></p>\n<p>The metric checks that the pairs are sorted, positive, and the decoded pixel values are not duplicated. <font color=\"purple\"><strong>It also checks that no two predicted masks for the same image are overlapping.</strong></font></p>\n<p>The file should contain a header and have the following format. Each row in your submission represents a single predicted nucleus segmentation for the given <code>ImageId</code>.</p>\n<figure class=\"highlight apache\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">id</span>,predicted  <br><span class=\"hljs-attribute\">0114f484a16c152baa2d82fdd43740880a762c93f436c8988ac461c5c9dbe7d5</span>,<span class=\"hljs-number\">1</span> <span class=\"hljs-number\">1</span>  <br><span class=\"hljs-attribute\">0999dab07b11bc85fb8464fc36c947fbd8b5d6ec49817361cb780659ca805eac</span>,<span class=\"hljs-number\">1</span> <span class=\"hljs-number\">1</span>  <br><span class=\"hljs-attribute\">0999dab07b11bc85fb8464fc36c947fbd8b5d6ec49817361cb780659ca805eac</span>,<span class=\"hljs-number\">2</span> <span class=\"hljs-number\">3</span> <span class=\"hljs-number\">8</span> <span class=\"hljs-number\">9</span>  <br><span class=\"hljs-attribute\">etc</span>...<br></code></pre></td></tr></tbody></table></figure>\n<p>Submission files may take several minutes to process due to the size.</p>\n<h4 id=\"个人理解-3\">个人理解</h4>\n<p>这里说明了提交的文件格式。</p>\n<ul>\n<li>\n<p>不同与一般的图像文件，首先需要将图片的像素点从上到下，从左到右标号为1，2，3…,然后将图片的分割得到的像素点标识为<code>'起始点1 个数1 起始点2 个数2 .....'</code>，</p>\n</li>\n<li>\n<p>注意点是提交的预测在同一张图中预测的mask不允许有重合像素。也就是说该竞赛涉及对于不同的细胞系实例分割，并且在一张图上分割的细胞系mask，不能有交点。<strong>训练数据中label是会出现重叠部分的，在预测的结果中需要消除预测重叠部分。</strong></p>\n<blockquote>\n<p>Note: while predictions are not allowed to overlap, the training labels are provided in full (with overlapping portions included). This is to ensure that models are provided the full data for each object. Removing overlap in predictions is a task for the competitor.</p>\n</blockquote>\n</li>\n</ul>\n<h5 id=\"attention（待尝试）\">attention（待尝试）</h5>\n<p>在讨论区中有人说mask实际上要 (left -&gt; right, top -&gt; bottom) 标号，不知道后续主办方有没有更换内部测试代码。</p>\n<h5 id=\"Mask-encoding\">Mask encoding</h5>\n<p>In submission, we have to encoding mask. Evaluation page show the pixels are numbered from top to bottom, then left to right. But, this is not correct. As you know, the training annotations provided are numbered from left to right, then top to bottom, and this is also the case with submission.<br>\nAn LB score with encoded mask (top -&gt; bottom, left -&gt; right) was 0.0000, but a score with (left -&gt; right, top -&gt; bottom) was over 0.22.<br>\nUnfortunately, the evaluation page is just a copy from Data Science Bowl 2018. I hope that the competition hosts will update the evaluation page for this competition.<br>\n<a href=\"https://www.kaggle.com/christoffersartorius\">@christoffersartorius</a> <a href=\"https://www.kaggle.com/addisonhoward\">@addisonhoward</a></p>\n<h4 id=\"tips\">tips</h4>\n<p><strong>后续可参考</strong></p>\n<p><strong>RLE</strong>相关代码说明（<a href=\"https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278663%EF%BC%89\">https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278663）</a></p>\n<p>In this great <a href=\"https://www.kaggle.com/ihelon/cell-segmentation-run-length-decoding\">EDA notebook</a> created by <a href=\"https://www.kaggle.com/ihelon\">@ihelon</a>, I found Inversion’s classical <a href=\"https://www.kaggle.com/ihelon/cell-segmentation-run-length-decoding\">RLE encoding function</a>. The function has definitely stood the test of time and works great here, but I had a bit of difficulty understanding it, so I refactored it to be a bit easier for beginners. Here’s the code (with some personal notes):</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># modified from: https://www.kaggle.com/inversion/run-length-decoding-quick-start</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">rle_decode_refactored</span>(<span class=\"hljs-params\">mask_rle, shape, color=<span class=\"hljs-number\">1</span></span>):</span><br>    <span class=\"hljs-string\">'''</span><br><span class=\"hljs-string\">    mask_rle: run-length as string formated (start length)</span><br><span class=\"hljs-string\">    shape: (height,width) of array to return </span><br><span class=\"hljs-string\">    Returns numpy array, 1 - mask, 0 - background</span><br><span class=\"hljs-string\">    '''</span><br>    <span class=\"hljs-comment\"># Split the string by space, then convert it into a integer array</span><br>    s = np.array(mask_rle.split(), dtype=<span class=\"hljs-built_in\">int</span>)<br><br>    <span class=\"hljs-comment\"># Every even value is the start, every odd value is the \"run\" length</span><br>    starts = s[<span class=\"hljs-number\">0</span>::<span class=\"hljs-number\">2</span>] - <span class=\"hljs-number\">1</span><br>    lengths = s[<span class=\"hljs-number\">1</span>::<span class=\"hljs-number\">2</span>]<br>    ends = starts + lengths<br><br>    <span class=\"hljs-comment\"># The image image is actually flattened since RLE is a 1D \"run\"</span><br>    h, w, d = shape<br>    img = np.zeros((h * w, d), dtype=np.float32)<br><br>    <span class=\"hljs-comment\"># The color here is actually just any integer you want!</span><br>    <span class=\"hljs-keyword\">for</span> lo, hi <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">zip</span>(starts, ends):<br>        img[lo : hi] = color<br>    <span class=\"hljs-comment\"># Don't forget to change the image back to the original shape</span><br>    <span class=\"hljs-keyword\">return</span> img.reshape(shape)<br></code></pre></td></tr></tbody></table></figure>\n<h3 id=\"Timeline\">Timeline</h3>\n<p>12月30号是最终的截止日期，冲冲冲！</p>\n<ul>\n<li><strong>October 14, 2021</strong> - Start Date.</li>\n<li><strong>December 23, 2021</strong> - Entry Deadline. You must accept the competition rules before this date in order to compete.</li>\n<li><strong>December 23, 2021</strong> - Team Merger Deadline. This is the last day participants may join or merge teams.</li>\n<li><strong>December 30, 2021</strong> - Final Submission Deadline.</li>\n</ul>\n<p>All deadlines are at 11:59 PM UTC on the corresponding day unless otherwise noted. The competition organizers reserve the right to update the contest timeline if they deem it necessary.</p>\n<h2 id=\"相关paper\">相关paper</h2>\n<p>参考 <a href=\"https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278716\">https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278716</a></p>\n<p><strong>Papers:</strong></p>\n<ul>\n<li><a href=\"https://www.researchgate.net/publication/329933921_Instance_Segmentation_of_Neural_Cells\">Instance Segmentation of Neural Cells</a> - Instance segmentation of neural cells plays an important role in brain study. However, this task is challenging due to the special shapes and behaviors of neural cells. Existing methods are not precise enough to capture their tiny structures, e.g., filopodia and lamellipodia, which are critical to the understanding of cell interaction and behavior. To this end, we propose a novel deep multi-task learning model to jointly detect and segment neural cells instance-wise. Our method is built upon SSD, with ResNet101 as the backbone to achieve both high detection accuracy and fast speed. Furthermore, unlike existing works which tend to produce wavy and inaccurate boundaries, we embed a deconvolution module into SSD to better capture details. Experiments on a dataset of neural cell microscopic images show that our method is able to achieve better performance in terms of accuracy and efficiency, comparing favorably with current state-of-the-art methods.</li>\n<li><a href=\"https://www.researchgate.net/publication/340998089_Rank_6_Mask-RCNN_for_Cell_Instance_Segmentation\">Mask-RCNN for Cell Instance Segmentation</a> - We proposed an automatic nucleus segmentation algorithm of H&amp;E stained tissue microscopy images. Mask-RCNN is a recently proposed state-of-the-art algorithm for object detection and object instance segmentation of natural images. In this paper, we demonstrate that Mask-RCNN can be used to perform highly effective and efficient automatic segmentation of H&amp;E microscopy images for cell nuclei. We propose a novel MASK Non-maximum suppression (NMS) module which can automatically ensemble classifiers results and increase the robustness of model.</li>\n<li><a href=\"https://arxiv.org/abs/1908.06623\">IRNet: Instance Relation Network for Overlapping Cervical Cell Segmentation</a> - Cell instance segmentation in Pap smear image remains challenging due to the wide existence of occlusion among translucent cytoplasm in cell clumps. Conventional methods heavily rely on accurate nuclei detection results and are easily disturbed by miscellaneous objects. In this paper, we propose a novel Instance Relation Network (IRNet) for robust overlapping cell segmentation by exploring instance relation interaction. Specifically, we propose the Instance Relation Module to construct the cell association matrix for transferring information among individual cell-instance features. With the collaboration of different instances, the augmented features gain benefits from contextual information and improve semantic consistency. Meanwhile, we proposed a sparsity constrained Duplicate Removal Module to eliminate the misalignment between classification and localization accuracy for candidates selection. The largest cervical Pap smear (CPS) dataset with more than 8000 cell annotations in Pap smear image was constructed for comprehensive evaluation. Our method outperforms other methods by a large margin, demonstrating the effectiveness of exploring instance relation.</li>\n<li><a href=\"https://www.researchgate.net/publication/336392797_Weakly_Supervised_Cell_Instance_Segmentation_by_Propagating_from_Detection_Response\">Weakly Supervised Cell Instance Segmentation by Propagating from Detection Response</a> - Cell shape analysis is important in biomedical research. Deep learning methods may perform to segment individual cells if they use sufficient training data that the boundary of each cell is annotated. However, it is very time-consuming for preparing such detailed annotation for many cell culture conditions. In this paper, we propose a weakly supervised method that can segment individual cell regions who touch each other with unclear boundaries in dense conditions without the training data for cell regions. We demonstrated the efficacy of our method using several data-set including multiple cell types captured by several types of microscopy. Our method achieved the highest accuracy compared with several conventional methods. In addition, we demonstrated that our method can perform without any annotation by using fluorescence images that cell nuclear were stained as training data.</li>\n<li><a href=\"https://arxiv.org/abs/2007.10787\">Deep Semi-supervised Knowledge Distillation for Overlapping Cervical Cell Instance Segmentation</a> - Deep learning methods show promising results for overlapping cervical cell instance segmentation. However, in order to train a model with good generalization ability, voluminous pixel-level annotations are demanded which is quite expensive and time-consuming for acquisition. In this paper, we propose to leverage both labeled and unlabeled data for instance segmentation with improved accuracy by knowledge distillation. We propose a novel Mask-guided Mean Teacher framework with Perturbation-sensitive Sample Mining (MMT-PSM), which consists of a teacher and a student network during training. Two networks are encouraged to be consistent both in feature and semantic level under small perturbations. The teacher’s self-ensemble predictions from K-time augmented samples are used to construct the reliable pseudolabels for optimizing the student. We design a novel strategy to estimate the sensitivity to perturbations for each proposal and select informative samples from massive cases to facilitate fast and effective semantic distillation. In addition, to eliminate the unavoidable noise from the background region, we propose to use the predicted segmentation mask as guidance to enforce the feature distillation in the foreground region. Experiments show that the proposed method improves the performance significantly compared with the supervised method learned from labeled data only, and outperforms state-of-the-art semi-supervised methods.</li>\n<li><a href=\"https://www.sciencedirect.com/science/article/pii/S1361841518308442\">Attentive neural cell instance segmentation</a> - Neural cell instance segmentation, which aims at joint detection and segmentation of every neural cell in a microscopic image, is essential to many neuroscience applications. The challenge of this task in- volves cell adhesion, cell distortion, unclear cell contours, low-contrast cell protrusion structures, and background impurities. Consequently, current instance segmentation methods generally fall short of pre- cision. In this paper, we propose an attentive instance segmentation method that accurately predicts the bounding box of each cell as well as its segmentation mask simultaneously. In particular, our method builds on a joint network that combines a single shot multi-box detector (SSD) and a U-net. Furthermore, we employ the attention mechanism in both detection and segmentation modules to focus the model on the useful features. The proposed method is validated on a dataset of neural cell microscopic images. Experimental results demonstrate that our approach can accurately detect and segment neural cell in- stances at a fast speed, comparing favorably with the state-of-the-art methods.</li>\n</ul>\n<p>📌 <a href=\"https://github.com/milesial/Pytorch-UNet\">U-net with Pytorch</a><br>\n📌 <a href=\"https://github.com/Fpiotro/MOLECULAR-TRANSLATION\">Using U-net for a Kaggle competition (AutoEncoder)</a></p>\n<h4 id=\"attention\">attention</h4>\n<p><strong>主办方有关LIVECell的论文</strong></p>\n<p>Edlund, C., Jackson, T.R., Khalid, N. et al.<br>\nLIVECell-A large-scale dataset for label-free live cell segmentation.<br>\nNat Methods 18, 1038 -1045 (2021).<br>\nAvailable at: <a href=\"https://doi.org/10.1038/s41592-021-01249-6\">https://doi.org/10.1038/s41592-021-01249-6</a></p>\n<p>Their paper is not just a dataset paper, <strong>it evaluates the performance of both recent anchor-free and anchor-based models for each cell type under four task conditions</strong>, which I think is very informative.<br>\nWithin their paper, it is shown that <font color=\"purple\"><strong>the results are better when other cell types not included in the test data are also included in the training</strong></font>. This may be because using even unrelated cell types in the training data allows the model to learn morphology and other factors.</p>\n<p>Therefore, in addition to the dataset provided in Kaggle, transfer learning using other cell types in LIVECell, the predecessor of the data, will be important for this competition.</p>\n<p>If you want to use the model trained by LIVECell for transfer learning, this page on GitHub may be useful.<br>\n👉 <a href=\"https://github.com/sartorius-research/LIVECell/tree/main/model\">https://github.com/sartorius-research/LIVECell/tree/main/model</a></p>\n<p>The models are based on PyTorch, but are from FIAR’s Dectron 2 library.<br>\nDectron2: <a href=\"https://github.com/facebookresearch/detectron2\">https://github.com/facebookresearch/detectron2</a></p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>最近参赛Sartorius - Cell Instance Segmentation，对竞赛题目和相关注意点进行梳理记录，以便后续回顾。</p>\n</blockquote>\n<h2 id=\"竞赛说明\">竞赛说明</h2>\n<p>Sartorius - Cell Instance Segmentation，是一个有关医学图像<strong>实例分割</strong>的竞赛</p>\n<p>地址： <a href=\"https://www.kaggle.com/c/sartorius-cell-instance-segmentation/overview\">https://www.kaggle.com/c/sartorius-cell-instance-segmentation/overview</a></p>\n<h3 id=\"Description\">Description</h3>\n<p>Neurological disorders, including neurodegenerative diseases such as Alzheimer’s and brain tumors, are a leading cause of death and disability across the globe. However, it is hard to quantify how well these deadly disorders respond to treatment. <strong>One accepted method is to review neuronal cells via light microscopy,</strong> which is both accessible and non-invasive. Unfortunately, <strong>segmenting individual neuronal cells</strong> in microscopic images can be challenging and time-intensive. Accurate instance segmentation of these cells—with the help of computer vision—could lead to new and effective drug discoveries to treat the millions of people with these disorders.</p>\n<p><img src=\"https://storage.googleapis.com/kaggle-media/competitions/Sartorius/Sartorius_Competition%20Description%20Image%20350x379.png\" alt=\"img\"></p>\n<p>Current solutions have limited accuracy for neuronal cells in particular. In internal studies to develop cell instance segmentation models, the neuroblastoma cell line SH-SY5Y consistently exhibits the lowest precision scores out of eight different cancer cell types tested. This could be because neuronal cells have a very <strong>unique, irregular and concave morphology</strong> associated with them, making them challenging to segment with commonly used mask heads.</p>\n<p>Sartorius is a partner of the life science research and the biopharmaceutical industry. They empower scientists and engineers to simplify and accelerate progress in life science and bioprocessing, enabling the development of new and better therapies and more affordable medicine. They’re a magnet and dynamic platform for pioneers and leading experts in the field. They bring creative minds together for a common goal: technological breakthroughs that lead to better health for more people.</p>\n<p><font color=purple > <strong>In this competition, you’ll detect and delineate distinct objects of interest in biological images depicting neuronal cell types commonly used in the study of neurological disorders.</strong> More specifically, you’ll use phase contrast microscopy images to train and test your model for instance segmentation of neuronal cells. Successful models will do this with a high level of accuracy.</font></p>\n<p>If successful, you’ll help further research in neurobiology thanks to the collection of robust quantitative data. Researchers may be able to use this to more easily measure the effects of disease and treatment conditions on neuronal cells. As a result, new drugs could be discovered to treat the millions of people with these leading causes of death and disability.</p>\n<h4 id=\"个人理解\">个人理解</h4>\n<p>也就是说为了量化神经系统类的致命疾病对治疗的反应。一种方法是通过光学显微镜检查神经元细胞，因为这种方法既方便又非侵入性。但是，在显微图像中分割单个神经元细胞可能具有挑战性且耗时。所以需要采取计算机视觉的方法提高精度和效率。由于神经母细胞瘤细胞系（SH-SY5Y）独特，不规则，凹形的形态（unique, irregular and concave morphology），使用常规的分割模型进行分割效果不好。</p>\n<h3 id=\"Evaluation\">Evaluation</h3>\n<p>This competition is evaluated on the mean average precision at different intersection over union IUO thresholds. The IoU of a proposed set of object pixels and a set of true object pixels is calculated as:</p>\n<p>$$<br>\nIoU(A,B) = \\frac{A \\cap B}{A \\cup B}<br>\n$$</p>\n<p>The metric sweeps over a range of IoU thresholds, at each point calculating an average precision value. The threshold values range from 0.5 to 0.95 with a step size of 0.05: <code>(0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95)</code>. In other words, at a threshold of 0.5, a predicted object is considered a “hit” if its intersection over union with a ground truth object is greater than 0.5.</p>\n<p>At each threshold value <strong>t</strong>, a precision value is calculated based on the number of true positives <strong>TP</strong>, false negatives <strong>FN</strong>, and false positives <strong>FP</strong> resulting from comparing the predicted object to all ground truth objects:</p>\n<p>$$<br>\n\\frac{TP(t)}{TP(t)+FP(t)+FN(t)}<br>\n$$</p>\n<p>A true positive is counted when a single predicted object matches a ground truth object with an IoU above the threshold. A false positive indicates a predicted object had no associated ground truth object. A false negative indicates a ground truth object had no associated predicted object. The average precision of a single image is then calculated as the mean of the above precision values at each IoU threshold:<br>\n$$<br>\n\\frac{1}{\\vert thresholds \\vert} \\sum_t \\frac{TP(t)}{TP{t}+FP(t)+FN(t)}<br>\n$$<br>\nLastly, the score returned by the competition metric is the mean taken over the individual average precisions of each image in the test dataset.</p>\n<h4 id=\"个人理解-2\">个人理解</h4>\n<p>此处介绍了评估指标，以及最后排名score的度量方式。人为设置prediction和ground truth的IoU的thresholds，这样可以度量TP，FN，FP（正确实例分割object个数，没有检测到的object个数，误检出的object个数），进而得到score。</p>\n<h5 id=\"疑问\">疑问</h5>\n<ul>\n<li>这里评估指标中没有提到分类，实例分割除了分割前景和背景，不应该还需要评估类别吗？还是说在度量IOU的时候已经包含了对类别的判断。</li>\n<li>最后的score中为什么要除以thresholds，意义何在？</li>\n</ul>\n<h2 id=\"Submission-File\">Submission File</h2>\n<p>In order to reduce the submission file size, our metric uses run-length encoding on the pixel values. Instead of submitting an exhaustive list of indices for your segmentation, you will submit pairs of values that contain a start position and a run length. E.g. ‘1 3’ implies starting at pixel 1 and running a total of 3 pixels 1,2,3.</p>\n<p>The competition format requires a space delimited list of pairs. <strong>For example, ‘1 3 10 5’ implies pixels 1,2,3,10,11,12,13,14 are to be included in the mask. The pixels are one-indexed</strong><br>\n<strong>and numbered from top to bottom, then left to right: 1 is pixel 1,1, 2 is pixel 2,1, etc.</strong></p>\n<p>The metric checks that the pairs are sorted, positive, and the decoded pixel values are not duplicated. <font color=purple><strong>It also checks that no two predicted masks for the same image are overlapping.</strong></font></p>\n<p>The file should contain a header and have the following format. Each row in your submission represents a single predicted nucleus segmentation for the given <code>ImageId</code>.</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">id</span>,predicted  <br><span class=\"hljs-attribute\">0114f484a16c152baa2d82fdd43740880a762c93f436c8988ac461c5c9dbe7d5</span>,<span class=\"hljs-number\">1</span> <span class=\"hljs-number\">1</span>  <br><span class=\"hljs-attribute\">0999dab07b11bc85fb8464fc36c947fbd8b5d6ec49817361cb780659ca805eac</span>,<span class=\"hljs-number\">1</span> <span class=\"hljs-number\">1</span>  <br><span class=\"hljs-attribute\">0999dab07b11bc85fb8464fc36c947fbd8b5d6ec49817361cb780659ca805eac</span>,<span class=\"hljs-number\">2</span> <span class=\"hljs-number\">3</span> <span class=\"hljs-number\">8</span> <span class=\"hljs-number\">9</span>  <br><span class=\"hljs-attribute\">etc</span>...<br></code></pre></td></tr></table></figure>\n<p>Submission files may take several minutes to process due to the size.</p>\n<h4 id=\"个人理解-3\">个人理解</h4>\n<p>这里说明了提交的文件格式。</p>\n<ul>\n<li>\n<p>不同与一般的图像文件，首先需要将图片的像素点从上到下，从左到右标号为1，2，3…,然后将图片的分割得到的像素点标识为<code>'起始点1 个数1 起始点2 个数2 .....'</code>，</p>\n</li>\n<li>\n<p>注意点是提交的预测在同一张图中预测的mask不允许有重合像素。也就是说该竞赛涉及对于不同的细胞系实例分割，并且在一张图上分割的细胞系mask，不能有交点。<strong>训练数据中label是会出现重叠部分的，在预测的结果中需要消除预测重叠部分。</strong></p>\n<blockquote>\n<p>Note: while predictions are not allowed to overlap, the training labels are provided in full (with overlapping portions included). This is to ensure that models are provided the full data for each object. Removing overlap in predictions is a task for the competitor.</p>\n</blockquote>\n</li>\n</ul>\n<h5 id=\"attention（待尝试）\">attention（待尝试）</h5>\n<p>在讨论区中有人说mask实际上要 (left -&gt; right, top -&gt; bottom) 标号，不知道后续主办方有没有更换内部测试代码。</p>\n<h5 id=\"Mask-encoding\">Mask encoding</h5>\n<p>In submission, we have to encoding mask. Evaluation page show the pixels are numbered from top to bottom, then left to right. But, this is not correct. As you know, the training annotations provided are numbered from left to right, then top to bottom, and this is also the case with submission.<br>\nAn LB score with encoded mask (top -&gt; bottom, left -&gt; right) was 0.0000, but a score with (left -&gt; right, top -&gt; bottom) was over 0.22.<br>\nUnfortunately, the evaluation page is just a copy from Data Science Bowl 2018. I hope that the competition hosts will update the evaluation page for this competition.<br>\n<a href=\"https://www.kaggle.com/christoffersartorius\">@christoffersartorius</a> <a href=\"https://www.kaggle.com/addisonhoward\">@addisonhoward</a></p>\n<h4 id=\"tips\">tips</h4>\n<p><strong>后续可参考</strong></p>\n<p><strong>RLE</strong>相关代码说明（<a href=\"https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278663%EF%BC%89\">https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278663）</a></p>\n<p>In this great <a href=\"https://www.kaggle.com/ihelon/cell-segmentation-run-length-decoding\">EDA notebook</a> created by <a href=\"https://www.kaggle.com/ihelon\">@ihelon</a>, I found Inversion’s classical <a href=\"https://www.kaggle.com/ihelon/cell-segmentation-run-length-decoding\">RLE encoding function</a>. The function has definitely stood the test of time and works great here, but I had a bit of difficulty understanding it, so I refactored it to be a bit easier for beginners. Here’s the code (with some personal notes):</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># modified from: https://www.kaggle.com/inversion/run-length-decoding-quick-start</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">rle_decode_refactored</span>(<span class=\"hljs-params\">mask_rle, shape, color=<span class=\"hljs-number\">1</span></span>):</span><br>    <span class=\"hljs-string\">&#x27;&#x27;&#x27;</span><br><span class=\"hljs-string\">    mask_rle: run-length as string formated (start length)</span><br><span class=\"hljs-string\">    shape: (height,width) of array to return </span><br><span class=\"hljs-string\">    Returns numpy array, 1 - mask, 0 - background</span><br><span class=\"hljs-string\">    &#x27;&#x27;&#x27;</span><br>    <span class=\"hljs-comment\"># Split the string by space, then convert it into a integer array</span><br>    s = np.array(mask_rle.split(), dtype=<span class=\"hljs-built_in\">int</span>)<br><br>    <span class=\"hljs-comment\"># Every even value is the start, every odd value is the &quot;run&quot; length</span><br>    starts = s[<span class=\"hljs-number\">0</span>::<span class=\"hljs-number\">2</span>] - <span class=\"hljs-number\">1</span><br>    lengths = s[<span class=\"hljs-number\">1</span>::<span class=\"hljs-number\">2</span>]<br>    ends = starts + lengths<br><br>    <span class=\"hljs-comment\"># The image image is actually flattened since RLE is a 1D &quot;run&quot;</span><br>    h, w, d = shape<br>    img = np.zeros((h * w, d), dtype=np.float32)<br><br>    <span class=\"hljs-comment\"># The color here is actually just any integer you want!</span><br>    <span class=\"hljs-keyword\">for</span> lo, hi <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">zip</span>(starts, ends):<br>        img[lo : hi] = color<br>    <span class=\"hljs-comment\"># Don&#x27;t forget to change the image back to the original shape</span><br>    <span class=\"hljs-keyword\">return</span> img.reshape(shape)<br></code></pre></td></tr></table></figure>\n<h3 id=\"Timeline\">Timeline</h3>\n<p>12月30号是最终的截止日期，冲冲冲！</p>\n<ul>\n<li><strong>October 14, 2021</strong> - Start Date.</li>\n<li><strong>December 23, 2021</strong> - Entry Deadline. You must accept the competition rules before this date in order to compete.</li>\n<li><strong>December 23, 2021</strong> - Team Merger Deadline. This is the last day participants may join or merge teams.</li>\n<li><strong>December 30, 2021</strong> - Final Submission Deadline.</li>\n</ul>\n<p>All deadlines are at 11:59 PM UTC on the corresponding day unless otherwise noted. The competition organizers reserve the right to update the contest timeline if they deem it necessary.</p>\n<h2 id=\"相关paper\">相关paper</h2>\n<p>参考 <a href=\"https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278716\">https://www.kaggle.com/c/sartorius-cell-instance-segmentation/discussion/278716</a></p>\n<p><strong>Papers:</strong></p>\n<ul>\n<li><a href=\"https://www.researchgate.net/publication/329933921_Instance_Segmentation_of_Neural_Cells\">Instance Segmentation of Neural Cells</a> - Instance segmentation of neural cells plays an important role in brain study. However, this task is challenging due to the special shapes and behaviors of neural cells. Existing methods are not precise enough to capture their tiny structures, e.g., filopodia and lamellipodia, which are critical to the understanding of cell interaction and behavior. To this end, we propose a novel deep multi-task learning model to jointly detect and segment neural cells instance-wise. Our method is built upon SSD, with ResNet101 as the backbone to achieve both high detection accuracy and fast speed. Furthermore, unlike existing works which tend to produce wavy and inaccurate boundaries, we embed a deconvolution module into SSD to better capture details. Experiments on a dataset of neural cell microscopic images show that our method is able to achieve better performance in terms of accuracy and efficiency, comparing favorably with current state-of-the-art methods.</li>\n<li><a href=\"https://www.researchgate.net/publication/340998089_Rank_6_Mask-RCNN_for_Cell_Instance_Segmentation\">Mask-RCNN for Cell Instance Segmentation</a> - We proposed an automatic nucleus segmentation algorithm of H&amp;E stained tissue microscopy images. Mask-RCNN is a recently proposed state-of-the-art algorithm for object detection and object instance segmentation of natural images. In this paper, we demonstrate that Mask-RCNN can be used to perform highly effective and efficient automatic segmentation of H&amp;E microscopy images for cell nuclei. We propose a novel MASK Non-maximum suppression (NMS) module which can automatically ensemble classifiers results and increase the robustness of model.</li>\n<li><a href=\"https://arxiv.org/abs/1908.06623\">IRNet: Instance Relation Network for Overlapping Cervical Cell Segmentation</a> - Cell instance segmentation in Pap smear image remains challenging due to the wide existence of occlusion among translucent cytoplasm in cell clumps. Conventional methods heavily rely on accurate nuclei detection results and are easily disturbed by miscellaneous objects. In this paper, we propose a novel Instance Relation Network (IRNet) for robust overlapping cell segmentation by exploring instance relation interaction. Specifically, we propose the Instance Relation Module to construct the cell association matrix for transferring information among individual cell-instance features. With the collaboration of different instances, the augmented features gain benefits from contextual information and improve semantic consistency. Meanwhile, we proposed a sparsity constrained Duplicate Removal Module to eliminate the misalignment between classification and localization accuracy for candidates selection. The largest cervical Pap smear (CPS) dataset with more than 8000 cell annotations in Pap smear image was constructed for comprehensive evaluation. Our method outperforms other methods by a large margin, demonstrating the effectiveness of exploring instance relation.</li>\n<li><a href=\"https://www.researchgate.net/publication/336392797_Weakly_Supervised_Cell_Instance_Segmentation_by_Propagating_from_Detection_Response\">Weakly Supervised Cell Instance Segmentation by Propagating from Detection Response</a> - Cell shape analysis is important in biomedical research. Deep learning methods may perform to segment individual cells if they use sufficient training data that the boundary of each cell is annotated. However, it is very time-consuming for preparing such detailed annotation for many cell culture conditions. In this paper, we propose a weakly supervised method that can segment individual cell regions who touch each other with unclear boundaries in dense conditions without the training data for cell regions. We demonstrated the efficacy of our method using several data-set including multiple cell types captured by several types of microscopy. Our method achieved the highest accuracy compared with several conventional methods. In addition, we demonstrated that our method can perform without any annotation by using fluorescence images that cell nuclear were stained as training data.</li>\n<li><a href=\"https://arxiv.org/abs/2007.10787\">Deep Semi-supervised Knowledge Distillation for Overlapping Cervical Cell Instance Segmentation</a> - Deep learning methods show promising results for overlapping cervical cell instance segmentation. However, in order to train a model with good generalization ability, voluminous pixel-level annotations are demanded which is quite expensive and time-consuming for acquisition. In this paper, we propose to leverage both labeled and unlabeled data for instance segmentation with improved accuracy by knowledge distillation. We propose a novel Mask-guided Mean Teacher framework with Perturbation-sensitive Sample Mining (MMT-PSM), which consists of a teacher and a student network during training. Two networks are encouraged to be consistent both in feature and semantic level under small perturbations. The teacher’s self-ensemble predictions from K-time augmented samples are used to construct the reliable pseudolabels for optimizing the student. We design a novel strategy to estimate the sensitivity to perturbations for each proposal and select informative samples from massive cases to facilitate fast and effective semantic distillation. In addition, to eliminate the unavoidable noise from the background region, we propose to use the predicted segmentation mask as guidance to enforce the feature distillation in the foreground region. Experiments show that the proposed method improves the performance significantly compared with the supervised method learned from labeled data only, and outperforms state-of-the-art semi-supervised methods.</li>\n<li><a href=\"https://www.sciencedirect.com/science/article/pii/S1361841518308442\">Attentive neural cell instance segmentation</a> - Neural cell instance segmentation, which aims at joint detection and segmentation of every neural cell in a microscopic image, is essential to many neuroscience applications. The challenge of this task in- volves cell adhesion, cell distortion, unclear cell contours, low-contrast cell protrusion structures, and background impurities. Consequently, current instance segmentation methods generally fall short of pre- cision. In this paper, we propose an attentive instance segmentation method that accurately predicts the bounding box of each cell as well as its segmentation mask simultaneously. In particular, our method builds on a joint network that combines a single shot multi-box detector (SSD) and a U-net. Furthermore, we employ the attention mechanism in both detection and segmentation modules to focus the model on the useful features. The proposed method is validated on a dataset of neural cell microscopic images. Experimental results demonstrate that our approach can accurately detect and segment neural cell in- stances at a fast speed, comparing favorably with the state-of-the-art methods.</li>\n</ul>\n<p>📌 <a href=\"https://github.com/milesial/Pytorch-UNet\">U-net with Pytorch</a><br>\n📌 <a href=\"https://github.com/Fpiotro/MOLECULAR-TRANSLATION\">Using U-net for a Kaggle competition (AutoEncoder)</a></p>\n<h4 id=\"attention\">attention</h4>\n<p><strong>主办方有关LIVECell的论文</strong></p>\n<p>Edlund, C., Jackson, T.R., Khalid, N. et al.<br>\nLIVECell-A large-scale dataset for label-free live cell segmentation.<br>\nNat Methods 18, 1038 -1045 (2021).<br>\nAvailable at: <a href=\"https://doi.org/10.1038/s41592-021-01249-6\">https://doi.org/10.1038/s41592-021-01249-6</a></p>\n<p>Their paper is not just a dataset paper, <strong>it evaluates the performance of both recent anchor-free and anchor-based models for each cell type under four task conditions</strong>, which I think is very informative.<br>\nWithin their paper, it is shown that <font color=purple><strong>the results are better when other cell types not included in the test data are also included in the training</strong></font>. This may be because using even unrelated cell types in the training data allows the model to learn morphology and other factors.</p>\n<p>Therefore, in addition to the dataset provided in Kaggle, transfer learning using other cell types in LIVECell, the predecessor of the data, will be important for this competition.</p>\n<p>If you want to use the model trained by LIVECell for transfer learning, this page on GitHub may be useful.<br>\n👉 <a href=\"https://github.com/sartorius-research/LIVECell/tree/main/model\">https://github.com/sartorius-research/LIVECell/tree/main/model</a></p>\n<p>The models are based on PyTorch, but are from FIAR’s Dectron 2 library.<br>\nDectron2: <a href=\"https://github.com/facebookresearch/detectron2\">https://github.com/facebookresearch/detectron2</a></p>\n"},{"title":"图像合成视频","date":"2021-10-30T01:50:29.000Z","_content":"\n> 在微生物项目中，需要将视频中的微生物检测识别出来，并且生成视频的格式保存，其中需要将检测的annotation图片合成为视频格式。**大致流程：使用cv库，首先读取图片，resize到指定大小，存储到Video实例中；**\n\n> OpenCV 底层是用 FFMEPG 进行多媒体开发的，所以 OpenCV 它的长项不在于此，它只是提供了这种能力而已，如果要针对多媒体文件做复杂的处理，推荐的还是 FFMEPG 专业库。OpenCV 用来创建视频文件的类是 VideoWriter。首先普及一些视频类相关的知识点。\n\n## 视频有关知识\n\n### 1. 文件后缀名\n\n我们一般都知道视频文件是 .mp4、.3gp、.rmvb 等等格式的，但一个文件取这样的后缀名是为了告诉用户或者操作系统，它的内容是什么格式的。我们也可以将 rmvb 格式的文件取名为 ***.avi。后缀的目的是为了方便用专业的工具或者软件操作它们。\n\n### 2. 文件格式\n\n我们可以将一个视频文件看做一个容器。\n\n简单地说就是可以看做是一个盒子。\n\n**这个盒子里面有视频画面数据、音频数据、字幕数据等等。**\n\n不同的文件格式如 mp4、avi、mkv 等等，它们存放 打包数据的方式不一样，文件内部文件编码方式也可能不一样。\n\n### 3. 编码格式\n\n视频容器中，一般有视频和音频数据，它们采取的编码方式不一样。\n\n视频常见的编码方式通常有： x264、h264、mpeg-4\n\n音频常见的编码方式通常有： mp3、AAC、flac\n\n编码的目的主要是为了高效存储和传输，如果你不采用编码压缩的话，那么视频可以看做是一系列的图片序列，体积会非常大。\n\n### 4. 编码器和解码器\n\n把视频或者音频按照编码格式，编码成特定文件格式需要编码器的参与，不然每次开发重新写代码代价很高。\n\n把特定文件格式解码成特定的编码格式数据，这个过程称为解码，需要解码器的存在。\n\n解码器和编码器都有开源的或者收费的工具库，极大方便了开发者。\n\n### 5. FPS 帧率\n\n我们读初中物理时，大概了解过电影画面一秒钟 24 帧，其实对应的就是 24 fps，frame per second，有些手机有高速摄像的功能，原理就是能够 1 秒钟拍摄 960 张图片，然后用正常的速度放映出来，所以细节比较多。\n\nfps 越高，细节越好，体验也越好，但是文件容量也越高。\n\n## 函数原型 cv2.VideoWriter()\n\n```python\nVideoWriter(filename, fourcc, fps, frameSize[, isColor]) -> <VideoWriter object>\n```\n\n- filename:要保存的文件的路径\n- fourcc: 指定编码器\n- fps: 要保存的视频的帧率\n- frameSize: 要保存的文件的画面尺寸\n- isColor: 指示是黑白画面还是彩色的画面\n\n### fourcc的设置\n\n> fourcc意为四字符代码（Four-Character Codes），顾名思义，该编码由四个字符组成,下面是VideoWriter_fourcc对象一些常用的参数，注意：字符顺序不能弄混。\n\n- cv2.VideoWriter_fourcc('D', 'I', 'V', 'X') 对应格式 mp4\n- cv2.VideoWriter_fourcc('I','4','2','0')---未压缩的YUV颜色编码，4:2:0色度子采样。兼容性好，但文件较大，注意是很大。文件扩展名.avi。\n\n- cv2.VideoWriter_focurcc('P','I','M','1')---MPEG-1编码类型。随机访问，灵活的帧率、可变的图像尺寸、定义了I帧、P帧和B帧、运动补偿可跨越多个帧、半像素精度的运动向量、量化矩阵、GOF结构、slice结构、技术细节、输入视频格式。文件扩展名.avi。\n\n- cv2.VideoWriter_fourcc('X','V','I','D')---MPEG-4编码类型，视频大小为平均值，MPEG4所需要的空间是MPEG1或M-JPEG的1/10，它对运动物体可以保证良好的清晰度，间/时间/画质具有可调性。文件扩展名.avi。\n\n- cv2.VideoWriter_fourcc('T','H','E','O')---OGGVorbis，音频压缩格式，有损压缩，类似于MP3等的音乐格式。兼容性差，文件扩展名为.ogv。\n\n- **cv2.VideoWriter_focurcc('F','L','V','1')---FLV是FLASH VIDEO的简称，FLV流媒体格式是一种新的视频格式。**由于它形成的文件极小、加载速度极快，使得网络观看视频文件成为可能，它的出现有效的解决了视频文件导入Flash后，使导出的SWF文件体积庞大，不能在网络上很好的使用等缺点。文件扩展名为.flv\n\n视频编码方式还有很多，具体可参考http://www.fourcc.org/codecs.php。\n\n## 实现代码\n\n`flv2jpg.py`:切分视频，按照指定帧频率保存图片。\n\n```python\nimport cv2\nimport os\ndef flv2jpg(videopath, mytimeF=1, save_flag = False):\n    \"\"\"\n    将flv格式视频每隔mytimeF个帧保存一张图片\n    :param videopath: 存储flv视频的文件夹\n    :param mytimeF: 间隔帧数\n    :return:\n    \"\"\"\n    save_dir = os.path.join(os.path.dirname(videopath), \"images\")\n    os.makedirs(save_dir, exist_ok=True)\n    num = 1  # 保存图片计数\n    print(videopath)\n    vc = cv2.VideoCapture(videopath)\n    if vc.isOpened():\n        rval, frame = vc.read()\n    else:\n        rval = False\n    timeF = mytimeF  # 每隔mytimeF帧\n    count = 1  # 帧计数\n    while rval:\n        rval, frame = vc.read()\n        if count % timeF == 0 and frame is not None:\n            print(\"current frame count:\", count)\n            print(\"num:\", num)\n\n            if save_flag:\n                save_path = os.path.join(save_dir, str(num) + \"_\" + videopath.split(\"/\")[-1] + \".jpg\")\n                cv2.imwrite(save_path, frame)\n                print(save_path)\n                num += 1\n        count += 1\n    vc.release()\n    return save_dir\n\n\nif __name__ == \"__main__\":\n    test_video = \"./data/lunchong3.flv\"\n    flv2jpg(test_video,save_flag=True)\n\n```\n\n`main.py` ：保存处理后的视频\n\n```python\nfrom flv2jpg import flv2jpg\nimport cv2\nimport os,glob\nfrom detectInfo import Detect_img\ndef makeVideo(Video_img_list,fps,size,save_dir):\n    \"\"\"\n    func:由切分好的视频帧图像得到检测后的视频\n    input: 待合成的图片list，视频的fps，size设置 视频保存路径\n    return: 无返回\n    \"\"\"\n    # video = cv2.VideoWriter(save_dir, cv2.VideoWriter_fourcc('I', '4', '2', '0'), fps, size)\n    video = cv2.VideoWriter(save_dir, cv2.VideoWriter_fourcc(*'mp4v'), fps, size)\n\n    for img in Video_img_list:\n        img = cv2.resize(img, size)  # 将图片转换为1280*720\n        video.write(img)\n\ndef detectVideo(test_video_path,detect_img,fps=24,size=(640,480),sift_thres = 0.5):\n    \"\"\"\n    将输入的视频，切分图像，使用模型检测，返回合成的视频结果\n    Args:\n        test_video_path: 视频路径 \n        detect_img: 模型实例\n        fps: 视频帧\n        size: 视频图像大小\n        sift_thres: 筛选显示的检测阈值\n\n    Returns: None\n\n    \"\"\"\n    img_root = flv2jpg(test_video_path,save_flag=True) #读取路径\n    save_dir_anno = os.path.join(os.path.dirname(test_video_path),\"annotation/\")\n    #获取批量数据的检测信息\n    Video_img_list = detect_img.get_info(source=img_root, save_img=True, save_dir=save_dir_anno,sift_thres=sift_thres)\n    save_dir = os.path.join(os.path.dirname(test_video_path),\"VideoDetect.mp4\")\n    makeVideo(Video_img_list, fps, size, save_dir)\n\n\nif __name__ == \"__main__\":\n    detect_img = Detect_img(weights=\"./weights/best.pt\")\n    test_video_path = \"./data/lunchong3.flv\"\n    detectVideo(test_video_path, detect_img, fps=120, size=(640, 480), sift_thres=0)\n```\n\n## YoLov5中的实现\n\n实际上在yolov5的detect脚本中，包含了处理输入为视频格式文件的检测代码，可以直接使用。\n\n### 相关代码\n\n```python\ndatasets.py\nclass LoadImages:  # for inference\n    def __init__(self, path, img_size=640, stride=32):\n        p = str(Path(path).absolute())  # os-agnostic absolute path\n        if '*' in p:\n            files = sorted(glob.glob(p, recursive=True))  # glob\n        elif os.path.isdir(p):\n            files = sorted(glob.glob(os.path.join(p, '*.*')))  # dir\n        elif os.path.isfile(p):\n            files = [p]  # files\n        else:\n            raise Exception(f'ERROR: {p} does not exist')\n\n        images = [x for x in files if x.split('.')[-1].lower() in img_formats]\n        videos = [x for x in files if x.split('.')[-1].lower() in vid_formats]\n        ni, nv = len(images), len(videos)\n\n        self.img_size = img_size\n        self.stride = stride\n        self.files = images + videos\n        self.nf = ni + nv  # number of files\n        self.video_flag = [False] * ni + [True] * nv\n        self.mode = 'image'\n        if any(videos):\n            self.new_video(videos[0])  # 如果为路径则读取打开视频\n        else:\n            self.cap = None\n        assert self.nf > 0, f'No images or videos found in {p}. ' \\\n                            f'Supported formats are:\\nimages: {img_formats}\\nvideos: {vid_formats}'\n\n    def __iter__(self):\n        self.count = 0\n        return self\n\n    def __next__(self):\n        if self.count == self.nf:\n            raise StopIteration\n        path = self.files[self.count]\n\n        if self.video_flag[self.count]:\n            # Read video\n            self.mode = 'video'\n            ret_val, img0 = self.cap.read() #按帧读取视频，ret,frame是获cap.read()方法的两个返回值。其中ret是布尔值，如果读取帧是正确的则返回True，如果文件读取到结尾，它的返回值就为False。frame就是每一帧的图像，是个三维矩阵。\n            if not ret_val:\n                self.count += 1\n                self.cap.release()\n                if self.count == self.nf:  # last video\n                    raise StopIteration\n                else:\n                    path = self.files[self.count]\n                    self.new_video(path) \n                    ret_val, img0 = self.cap.read()\n\n            self.frame += 1\n            # print(f'video {self.count + 1}/{self.nf} ({self.frame}/{self.frames}) {path}: ', end='')\n\n        else:\n            # Read image\n            self.count += 1\n            img_path_code = np.fromfile(path, dtype=np.uint8)  # 含有中文路径时\n            img0 = cv2.imdecode(img_path_code,1)  # path，，，，BGR\n            assert img0 is not None, 'Image Not Found ' + path\n            # print(f'image {self.count}/{self.nf} {path}: ', end='')\n\n        # Padded resize\n        img = letterbox(img0, self.img_size, stride=self.stride)[0]\n\n        # Convert\n        img = img[:, :, ::-1].transpose(2, 0, 1)  # BGR to RGB and HWC to CHW\n        img = np.ascontiguousarray(img)\n\n        return path, img, img0, self.cap\n\n    def new_video(self, path):\n        self.frame = 0\n        self.cap = cv2.VideoCapture(path) #VideoCapture()中参数是0，表示打开笔记本的内置摄像头，参数是视频文件路径则打开视频\n        self.frames = int(self.cap.get(cv2.CAP_PROP_FRAME_COUNT))\n\n    def __len__(self):\n        return self.nf  # number of files\n```\n\ndetect.py中涉及视频的处理代码：在上述的loaddata中的cap.read()会默认得到的帧图像为640*480，可以使用cap.get()函数得到视频相关属性，使用cap.set()函数设置3，4id的参数值（3，4对应的是宽高属性）\n\n> cv2.VideoCapture().set(propId, value)\n> 功能：设置摄像头\n> 参数：propId：设置的视频参数，\n> 　　　　　　　类型：整数，\n> 　　　　　　　可以参考 ：cv2.VideoCapture().get()中的参数\n> 　　　　　　　value： 设置的参数\n> 返回值：bool值：\n> 　　　　true:不能确保摄像头已接受属性值\n> 　　　　flase:摄像头未接受属性值\n>\n> 举例：\n> cap.set(3, 480)\n> 参数：3：在视频流的帧的宽度\n> 　　　480：高度的数值\n> 功能：把视频流的帧(图片)的宽度调成480\n>\n> cap.set(4, 480)\n> 参数：4：在视频流的帧的高度\n> 　　　480：宽度的数值\n> 功能：把视频流的帧(图片)的高度调成480\n\n| param                    | define                                                       |\n| ------------------------ | ------------------------------------------------------------ |\n| cv2.VideoCapture.get(0)  | CV_CAP_PROP_POS_MSEC 视频文件的当前位置（播放）以毫秒为单位  |\n| cv2.VideoCapture.get(1)  | CV_CAP_PROP_POS_FRAMES 基于以0开始的被捕获或解码的帧索引     |\n| cv2.VideoCapture.get(2)  | CV_CAP_PROP_POS_AVI_RATIO 视频文件的相对位置（播放）：0=电影开始，1=影片的结尾。 |\n| cv2.VideoCapture.get(3)  | CV_CAP_PROP_FRAME_WIDTH 在视频流的帧的宽度                   |\n| cv2.VideoCapture.get(4)  | CV_CAP_PROP_FRAME_HEIGHT 在视频流的帧的高度                  |\n| cv2.VideoCapture.get(5)  | CV_CAP_PROP_FPS 帧速率                                       |\n| cv2.VideoCapture.get(6)  | CV_CAP_PROP_FOURCC 编解码的4字-字符代码                      |\n| cv2.VideoCapture.get(7)  | CV_CAP_PROP_FRAME_COUNT 视频文件中的帧数                     |\n| cv2.VideoCapture.get(8)  | CV_CAP_PROP_FORMAT 返回对象的格式                            |\n| cv2.VideoCapture.get(9)  | CV_CAP_PROP_MODE 返回后端特定的值，该值指示当前捕获模式      |\n| cv2.VideoCapture.get(10) | CV_CAP_PROP_BRIGHTNESS 图像的亮度(仅适用于照相机)            |\n| cv2.VideoCapture.get(11) | CV_CAP_PROP_CONTRAST 图像的对比度(仅适用于照相机)            |\n| cv2.VideoCapture.get(12) | CV_CAP_PROP_SATURATION 图像的饱和度(仅适用于照相机)          |\n| cv2.VideoCapture.get(13) | CV_CAP_PROP_HUE 色调图像(仅适用于照相机)                     |\n| cv2.VideoCapture.get(14) | CV_CAP_PROP_GAIN 图像增益(仅适用于照相机)（Gain在摄影中表示白平衡提升） |\n| cv2.VideoCapture.get(15) | CV_CAP_PROP_EXPOSURE 曝光(仅适用于照相机)                    |\n| cv2.VideoCapture.get(16) | CV_CAP_PROP_CONVERT_RGB 指示是否应将图像转换为RGB布尔标志    |\n| cv2.VideoCapture.get(17) | CV_CAP_PROP_WHITE_BALANCE × 暂时不支持                       |\n| cv2.VideoCapture.get(18) | CV_CAP_PROP_RECTIFICATION 立体摄像机的矫正标注（目前只有DC1394 v.2.x后端支持这个功能） |\n\n| capture.set                                 | 作用                   |\n| ------------------------------------------- | ---------------------- |\n| capture.set(CV_CAP_PROP_FRAME_WIDTH, 1080); | 宽度                   |\n| capture.set(CV_CAP_PROP_FRAME_HEIGHT, 960); | 高度                   |\n| capture.set(CV_CAP_PROP_FPS, 30);           | 帧率 帧/秒             |\n| capture.set(CV_CAP_PROP_BRIGHTNESS, 1);     | 亮度                   |\n| capture.set(CV_CAP_PROP_CONTRAST,40)        | 对比度 40              |\n| capture.set(CV_CAP_PROP_SATURATION, 50);    | 饱和度 50              |\n| capture.set(CV_CAP_PROP_HUE, 50);           | 色调 50                |\n| capture.set(CV_CAP_PROP_EXPOSURE, 50);      | 曝光 50 获取摄像头参数 |\n\n### 具体代码\n\n```python\n        # Set Dataloader\n        vid_path, vid_writer = None, None\n        if webcam:\n            view_img = check_imshow()\n            cudnn.benchmark = True  # set True to speed up constant image size inference\n            dataset = LoadStreams(source, img_size=imgsz, stride=stride)\n        else:\n            dataset = LoadImages(source, img_size=imgsz, stride=stride)\n\n        for path, img, im0s, vid_cap in tqdm(dataset): #一个batch的信息\n            img_path_list.append(path)\n            img = torch.from_numpy(img).to(device)\n            img = img.half() if half else img.float()  # uint8 to fp16/32\n            img /= 255.0  # 0 - 255 to 0.0 - 1.0\n            if img.ndimension() == 3:\n                img = img.unsqueeze(0)\n\n            # Inference\n            t1 = time_synchronized()\n            pred = model(img, augment=augment)[0]\n\n            # Apply NMS\n            pred = non_max_suppression(pred, conf_thres, iou_thres, classes, agnostic_nms, max_det=max_det)\n            t2 = time_synchronized()\n\n            # Process detections\n            # imgbox_list = [] #一张图的box信息\n            Vorticella_list = []\n            Rotifera_list = []\n\n\n            for i, det in enumerate(pred):  # detections per image 一张图信息\n                if webcam:  # batch_size >= 1\n                    p, s, im0, frame = path[i], f'{i}: ', im0s[i].copy(), dataset.count\n                else:\n                    p, s, im0, frame = path, '', im0s.copy(), getattr(dataset, 'frame', 0) \n                s += '%gx%g ' % img.shape[2:]  # print string\n                p = Path(p)  # to Path\n                save_path = save_dir+p.name # img.jpg\n                if len(det):\n                    # Rescale boxes from img_size to im0 size\n                    # 调整预测框的坐标：基于resize+pad的图片的坐标-->基于原size图片的坐标\n                    # 此时坐标格式为xyxy\n                    det[:, :4] = scale_coords(img.shape[2:], det[:, :4], im0.shape).round()\n\n                    # Print results\n                    for c in det[:, -1].unique():\n                        n = (det[:, -1] == c).sum()  # detections per class\n                        s += f\"{n} {names[int(c)]}{'s' * (n > 1)}, \"  # add to string\n                    # [\"Vorticella\", \"Rotifera\"]\n                    # Write results\n                    # for *xyxy, conf, cls in reversed(det):\n                    for *xyxy, conf, cls in det: #置信度从大到小 #图中的所有框信息\n                        xywh_no_norm = xyxy2xywh(torch.tensor(xyxy).view(1, 4)).view(-1).tolist()\n                        box = (cls, xywh_no_norm, conf) #存储类别 xywh 置信度\n                        if(conf<sift_thres):continue #过滤置信度小于0.7的框\n                        if(cls==0):\n                            Vorticella_list.append(box)\n                        elif(cls==1):\n                            Rotifera_list.append(box)\n                        # imgbox_list.append(box)\n                        c = int(cls)  # integer class\n                        label = f'{names[c]} {conf:.2f}'\n                        plot_one_box(xyxy, im0, label=label, color=colors(c, True), line_thickness=3)\n\n                # Save results (image with detections)\n                if save_img:\n                    if dataset.mode == 'image':\n                        cv2.imwrite(save_path, im0)\n                    else:  # 'video' or 'stream'\n                        if vid_path != save_path:  # new video\n                            vid_path = save_path\n                            if isinstance(vid_writer, cv2.VideoWriter):\n                                vid_writer.release()  # release previous video writer\n                            if vid_cap:  # video\n                                fps = vid_cap.get(cv2.CAP_PROP_FPS) #获取原始视频的帧率\n                                # w = int(vid_cap.get(cv2.CAP_PROP_FRAME_WIDTH)) #获取原始视频帧宽\n                                # h = int(vid_cap.get(cv2.CAP_PROP_FRAME_HEIGHT)) #获取原始视频的高\n                                w, h =  im0.shape[1], im0.shape[0] #更新为原始图像的宽高\n                            else:  # stream\n                                fps, w, h = 30, im0.shape[1], im0.shape[0]\n                                # save_path += '.mp4'\n                                save_path += '.flv'\n                            # vid_writer = cv2.VideoWriter(save_path, cv2.VideoWriter_fourcc(*'mp4v'), fps, (w, h))\n\n                            vid_writer = cv2.VideoWriter(save_path, cv2.VideoWriter_fourcc('F', 'L', 'V', '1'), fps, (w, h))\n                        vid_writer.write(im0)\n```\n\n","source":"_posts/python/img/pic2video.md","raw":"---\ntitle: 图像合成视频\ntags: [python,图像]\ncategories: [python,图像]\ndate: 2021-10-30 09:50:29\n---\n\n> 在微生物项目中，需要将视频中的微生物检测识别出来，并且生成视频的格式保存，其中需要将检测的annotation图片合成为视频格式。**大致流程：使用cv库，首先读取图片，resize到指定大小，存储到Video实例中；**\n\n> OpenCV 底层是用 FFMEPG 进行多媒体开发的，所以 OpenCV 它的长项不在于此，它只是提供了这种能力而已，如果要针对多媒体文件做复杂的处理，推荐的还是 FFMEPG 专业库。OpenCV 用来创建视频文件的类是 VideoWriter。首先普及一些视频类相关的知识点。\n\n## 视频有关知识\n\n### 1. 文件后缀名\n\n我们一般都知道视频文件是 .mp4、.3gp、.rmvb 等等格式的，但一个文件取这样的后缀名是为了告诉用户或者操作系统，它的内容是什么格式的。我们也可以将 rmvb 格式的文件取名为 ***.avi。后缀的目的是为了方便用专业的工具或者软件操作它们。\n\n### 2. 文件格式\n\n我们可以将一个视频文件看做一个容器。\n\n简单地说就是可以看做是一个盒子。\n\n**这个盒子里面有视频画面数据、音频数据、字幕数据等等。**\n\n不同的文件格式如 mp4、avi、mkv 等等，它们存放 打包数据的方式不一样，文件内部文件编码方式也可能不一样。\n\n### 3. 编码格式\n\n视频容器中，一般有视频和音频数据，它们采取的编码方式不一样。\n\n视频常见的编码方式通常有： x264、h264、mpeg-4\n\n音频常见的编码方式通常有： mp3、AAC、flac\n\n编码的目的主要是为了高效存储和传输，如果你不采用编码压缩的话，那么视频可以看做是一系列的图片序列，体积会非常大。\n\n### 4. 编码器和解码器\n\n把视频或者音频按照编码格式，编码成特定文件格式需要编码器的参与，不然每次开发重新写代码代价很高。\n\n把特定文件格式解码成特定的编码格式数据，这个过程称为解码，需要解码器的存在。\n\n解码器和编码器都有开源的或者收费的工具库，极大方便了开发者。\n\n### 5. FPS 帧率\n\n我们读初中物理时，大概了解过电影画面一秒钟 24 帧，其实对应的就是 24 fps，frame per second，有些手机有高速摄像的功能，原理就是能够 1 秒钟拍摄 960 张图片，然后用正常的速度放映出来，所以细节比较多。\n\nfps 越高，细节越好，体验也越好，但是文件容量也越高。\n\n## 函数原型 cv2.VideoWriter()\n\n```python\nVideoWriter(filename, fourcc, fps, frameSize[, isColor]) -> <VideoWriter object>\n```\n\n- filename:要保存的文件的路径\n- fourcc: 指定编码器\n- fps: 要保存的视频的帧率\n- frameSize: 要保存的文件的画面尺寸\n- isColor: 指示是黑白画面还是彩色的画面\n\n### fourcc的设置\n\n> fourcc意为四字符代码（Four-Character Codes），顾名思义，该编码由四个字符组成,下面是VideoWriter_fourcc对象一些常用的参数，注意：字符顺序不能弄混。\n\n- cv2.VideoWriter_fourcc('D', 'I', 'V', 'X') 对应格式 mp4\n- cv2.VideoWriter_fourcc('I','4','2','0')---未压缩的YUV颜色编码，4:2:0色度子采样。兼容性好，但文件较大，注意是很大。文件扩展名.avi。\n\n- cv2.VideoWriter_focurcc('P','I','M','1')---MPEG-1编码类型。随机访问，灵活的帧率、可变的图像尺寸、定义了I帧、P帧和B帧、运动补偿可跨越多个帧、半像素精度的运动向量、量化矩阵、GOF结构、slice结构、技术细节、输入视频格式。文件扩展名.avi。\n\n- cv2.VideoWriter_fourcc('X','V','I','D')---MPEG-4编码类型，视频大小为平均值，MPEG4所需要的空间是MPEG1或M-JPEG的1/10，它对运动物体可以保证良好的清晰度，间/时间/画质具有可调性。文件扩展名.avi。\n\n- cv2.VideoWriter_fourcc('T','H','E','O')---OGGVorbis，音频压缩格式，有损压缩，类似于MP3等的音乐格式。兼容性差，文件扩展名为.ogv。\n\n- **cv2.VideoWriter_focurcc('F','L','V','1')---FLV是FLASH VIDEO的简称，FLV流媒体格式是一种新的视频格式。**由于它形成的文件极小、加载速度极快，使得网络观看视频文件成为可能，它的出现有效的解决了视频文件导入Flash后，使导出的SWF文件体积庞大，不能在网络上很好的使用等缺点。文件扩展名为.flv\n\n视频编码方式还有很多，具体可参考http://www.fourcc.org/codecs.php。\n\n## 实现代码\n\n`flv2jpg.py`:切分视频，按照指定帧频率保存图片。\n\n```python\nimport cv2\nimport os\ndef flv2jpg(videopath, mytimeF=1, save_flag = False):\n    \"\"\"\n    将flv格式视频每隔mytimeF个帧保存一张图片\n    :param videopath: 存储flv视频的文件夹\n    :param mytimeF: 间隔帧数\n    :return:\n    \"\"\"\n    save_dir = os.path.join(os.path.dirname(videopath), \"images\")\n    os.makedirs(save_dir, exist_ok=True)\n    num = 1  # 保存图片计数\n    print(videopath)\n    vc = cv2.VideoCapture(videopath)\n    if vc.isOpened():\n        rval, frame = vc.read()\n    else:\n        rval = False\n    timeF = mytimeF  # 每隔mytimeF帧\n    count = 1  # 帧计数\n    while rval:\n        rval, frame = vc.read()\n        if count % timeF == 0 and frame is not None:\n            print(\"current frame count:\", count)\n            print(\"num:\", num)\n\n            if save_flag:\n                save_path = os.path.join(save_dir, str(num) + \"_\" + videopath.split(\"/\")[-1] + \".jpg\")\n                cv2.imwrite(save_path, frame)\n                print(save_path)\n                num += 1\n        count += 1\n    vc.release()\n    return save_dir\n\n\nif __name__ == \"__main__\":\n    test_video = \"./data/lunchong3.flv\"\n    flv2jpg(test_video,save_flag=True)\n\n```\n\n`main.py` ：保存处理后的视频\n\n```python\nfrom flv2jpg import flv2jpg\nimport cv2\nimport os,glob\nfrom detectInfo import Detect_img\ndef makeVideo(Video_img_list,fps,size,save_dir):\n    \"\"\"\n    func:由切分好的视频帧图像得到检测后的视频\n    input: 待合成的图片list，视频的fps，size设置 视频保存路径\n    return: 无返回\n    \"\"\"\n    # video = cv2.VideoWriter(save_dir, cv2.VideoWriter_fourcc('I', '4', '2', '0'), fps, size)\n    video = cv2.VideoWriter(save_dir, cv2.VideoWriter_fourcc(*'mp4v'), fps, size)\n\n    for img in Video_img_list:\n        img = cv2.resize(img, size)  # 将图片转换为1280*720\n        video.write(img)\n\ndef detectVideo(test_video_path,detect_img,fps=24,size=(640,480),sift_thres = 0.5):\n    \"\"\"\n    将输入的视频，切分图像，使用模型检测，返回合成的视频结果\n    Args:\n        test_video_path: 视频路径 \n        detect_img: 模型实例\n        fps: 视频帧\n        size: 视频图像大小\n        sift_thres: 筛选显示的检测阈值\n\n    Returns: None\n\n    \"\"\"\n    img_root = flv2jpg(test_video_path,save_flag=True) #读取路径\n    save_dir_anno = os.path.join(os.path.dirname(test_video_path),\"annotation/\")\n    #获取批量数据的检测信息\n    Video_img_list = detect_img.get_info(source=img_root, save_img=True, save_dir=save_dir_anno,sift_thres=sift_thres)\n    save_dir = os.path.join(os.path.dirname(test_video_path),\"VideoDetect.mp4\")\n    makeVideo(Video_img_list, fps, size, save_dir)\n\n\nif __name__ == \"__main__\":\n    detect_img = Detect_img(weights=\"./weights/best.pt\")\n    test_video_path = \"./data/lunchong3.flv\"\n    detectVideo(test_video_path, detect_img, fps=120, size=(640, 480), sift_thres=0)\n```\n\n## YoLov5中的实现\n\n实际上在yolov5的detect脚本中，包含了处理输入为视频格式文件的检测代码，可以直接使用。\n\n### 相关代码\n\n```python\ndatasets.py\nclass LoadImages:  # for inference\n    def __init__(self, path, img_size=640, stride=32):\n        p = str(Path(path).absolute())  # os-agnostic absolute path\n        if '*' in p:\n            files = sorted(glob.glob(p, recursive=True))  # glob\n        elif os.path.isdir(p):\n            files = sorted(glob.glob(os.path.join(p, '*.*')))  # dir\n        elif os.path.isfile(p):\n            files = [p]  # files\n        else:\n            raise Exception(f'ERROR: {p} does not exist')\n\n        images = [x for x in files if x.split('.')[-1].lower() in img_formats]\n        videos = [x for x in files if x.split('.')[-1].lower() in vid_formats]\n        ni, nv = len(images), len(videos)\n\n        self.img_size = img_size\n        self.stride = stride\n        self.files = images + videos\n        self.nf = ni + nv  # number of files\n        self.video_flag = [False] * ni + [True] * nv\n        self.mode = 'image'\n        if any(videos):\n            self.new_video(videos[0])  # 如果为路径则读取打开视频\n        else:\n            self.cap = None\n        assert self.nf > 0, f'No images or videos found in {p}. ' \\\n                            f'Supported formats are:\\nimages: {img_formats}\\nvideos: {vid_formats}'\n\n    def __iter__(self):\n        self.count = 0\n        return self\n\n    def __next__(self):\n        if self.count == self.nf:\n            raise StopIteration\n        path = self.files[self.count]\n\n        if self.video_flag[self.count]:\n            # Read video\n            self.mode = 'video'\n            ret_val, img0 = self.cap.read() #按帧读取视频，ret,frame是获cap.read()方法的两个返回值。其中ret是布尔值，如果读取帧是正确的则返回True，如果文件读取到结尾，它的返回值就为False。frame就是每一帧的图像，是个三维矩阵。\n            if not ret_val:\n                self.count += 1\n                self.cap.release()\n                if self.count == self.nf:  # last video\n                    raise StopIteration\n                else:\n                    path = self.files[self.count]\n                    self.new_video(path) \n                    ret_val, img0 = self.cap.read()\n\n            self.frame += 1\n            # print(f'video {self.count + 1}/{self.nf} ({self.frame}/{self.frames}) {path}: ', end='')\n\n        else:\n            # Read image\n            self.count += 1\n            img_path_code = np.fromfile(path, dtype=np.uint8)  # 含有中文路径时\n            img0 = cv2.imdecode(img_path_code,1)  # path，，，，BGR\n            assert img0 is not None, 'Image Not Found ' + path\n            # print(f'image {self.count}/{self.nf} {path}: ', end='')\n\n        # Padded resize\n        img = letterbox(img0, self.img_size, stride=self.stride)[0]\n\n        # Convert\n        img = img[:, :, ::-1].transpose(2, 0, 1)  # BGR to RGB and HWC to CHW\n        img = np.ascontiguousarray(img)\n\n        return path, img, img0, self.cap\n\n    def new_video(self, path):\n        self.frame = 0\n        self.cap = cv2.VideoCapture(path) #VideoCapture()中参数是0，表示打开笔记本的内置摄像头，参数是视频文件路径则打开视频\n        self.frames = int(self.cap.get(cv2.CAP_PROP_FRAME_COUNT))\n\n    def __len__(self):\n        return self.nf  # number of files\n```\n\ndetect.py中涉及视频的处理代码：在上述的loaddata中的cap.read()会默认得到的帧图像为640*480，可以使用cap.get()函数得到视频相关属性，使用cap.set()函数设置3，4id的参数值（3，4对应的是宽高属性）\n\n> cv2.VideoCapture().set(propId, value)\n> 功能：设置摄像头\n> 参数：propId：设置的视频参数，\n> 　　　　　　　类型：整数，\n> 　　　　　　　可以参考 ：cv2.VideoCapture().get()中的参数\n> 　　　　　　　value： 设置的参数\n> 返回值：bool值：\n> 　　　　true:不能确保摄像头已接受属性值\n> 　　　　flase:摄像头未接受属性值\n>\n> 举例：\n> cap.set(3, 480)\n> 参数：3：在视频流的帧的宽度\n> 　　　480：高度的数值\n> 功能：把视频流的帧(图片)的宽度调成480\n>\n> cap.set(4, 480)\n> 参数：4：在视频流的帧的高度\n> 　　　480：宽度的数值\n> 功能：把视频流的帧(图片)的高度调成480\n\n| param                    | define                                                       |\n| ------------------------ | ------------------------------------------------------------ |\n| cv2.VideoCapture.get(0)  | CV_CAP_PROP_POS_MSEC 视频文件的当前位置（播放）以毫秒为单位  |\n| cv2.VideoCapture.get(1)  | CV_CAP_PROP_POS_FRAMES 基于以0开始的被捕获或解码的帧索引     |\n| cv2.VideoCapture.get(2)  | CV_CAP_PROP_POS_AVI_RATIO 视频文件的相对位置（播放）：0=电影开始，1=影片的结尾。 |\n| cv2.VideoCapture.get(3)  | CV_CAP_PROP_FRAME_WIDTH 在视频流的帧的宽度                   |\n| cv2.VideoCapture.get(4)  | CV_CAP_PROP_FRAME_HEIGHT 在视频流的帧的高度                  |\n| cv2.VideoCapture.get(5)  | CV_CAP_PROP_FPS 帧速率                                       |\n| cv2.VideoCapture.get(6)  | CV_CAP_PROP_FOURCC 编解码的4字-字符代码                      |\n| cv2.VideoCapture.get(7)  | CV_CAP_PROP_FRAME_COUNT 视频文件中的帧数                     |\n| cv2.VideoCapture.get(8)  | CV_CAP_PROP_FORMAT 返回对象的格式                            |\n| cv2.VideoCapture.get(9)  | CV_CAP_PROP_MODE 返回后端特定的值，该值指示当前捕获模式      |\n| cv2.VideoCapture.get(10) | CV_CAP_PROP_BRIGHTNESS 图像的亮度(仅适用于照相机)            |\n| cv2.VideoCapture.get(11) | CV_CAP_PROP_CONTRAST 图像的对比度(仅适用于照相机)            |\n| cv2.VideoCapture.get(12) | CV_CAP_PROP_SATURATION 图像的饱和度(仅适用于照相机)          |\n| cv2.VideoCapture.get(13) | CV_CAP_PROP_HUE 色调图像(仅适用于照相机)                     |\n| cv2.VideoCapture.get(14) | CV_CAP_PROP_GAIN 图像增益(仅适用于照相机)（Gain在摄影中表示白平衡提升） |\n| cv2.VideoCapture.get(15) | CV_CAP_PROP_EXPOSURE 曝光(仅适用于照相机)                    |\n| cv2.VideoCapture.get(16) | CV_CAP_PROP_CONVERT_RGB 指示是否应将图像转换为RGB布尔标志    |\n| cv2.VideoCapture.get(17) | CV_CAP_PROP_WHITE_BALANCE × 暂时不支持                       |\n| cv2.VideoCapture.get(18) | CV_CAP_PROP_RECTIFICATION 立体摄像机的矫正标注（目前只有DC1394 v.2.x后端支持这个功能） |\n\n| capture.set                                 | 作用                   |\n| ------------------------------------------- | ---------------------- |\n| capture.set(CV_CAP_PROP_FRAME_WIDTH, 1080); | 宽度                   |\n| capture.set(CV_CAP_PROP_FRAME_HEIGHT, 960); | 高度                   |\n| capture.set(CV_CAP_PROP_FPS, 30);           | 帧率 帧/秒             |\n| capture.set(CV_CAP_PROP_BRIGHTNESS, 1);     | 亮度                   |\n| capture.set(CV_CAP_PROP_CONTRAST,40)        | 对比度 40              |\n| capture.set(CV_CAP_PROP_SATURATION, 50);    | 饱和度 50              |\n| capture.set(CV_CAP_PROP_HUE, 50);           | 色调 50                |\n| capture.set(CV_CAP_PROP_EXPOSURE, 50);      | 曝光 50 获取摄像头参数 |\n\n### 具体代码\n\n```python\n        # Set Dataloader\n        vid_path, vid_writer = None, None\n        if webcam:\n            view_img = check_imshow()\n            cudnn.benchmark = True  # set True to speed up constant image size inference\n            dataset = LoadStreams(source, img_size=imgsz, stride=stride)\n        else:\n            dataset = LoadImages(source, img_size=imgsz, stride=stride)\n\n        for path, img, im0s, vid_cap in tqdm(dataset): #一个batch的信息\n            img_path_list.append(path)\n            img = torch.from_numpy(img).to(device)\n            img = img.half() if half else img.float()  # uint8 to fp16/32\n            img /= 255.0  # 0 - 255 to 0.0 - 1.0\n            if img.ndimension() == 3:\n                img = img.unsqueeze(0)\n\n            # Inference\n            t1 = time_synchronized()\n            pred = model(img, augment=augment)[0]\n\n            # Apply NMS\n            pred = non_max_suppression(pred, conf_thres, iou_thres, classes, agnostic_nms, max_det=max_det)\n            t2 = time_synchronized()\n\n            # Process detections\n            # imgbox_list = [] #一张图的box信息\n            Vorticella_list = []\n            Rotifera_list = []\n\n\n            for i, det in enumerate(pred):  # detections per image 一张图信息\n                if webcam:  # batch_size >= 1\n                    p, s, im0, frame = path[i], f'{i}: ', im0s[i].copy(), dataset.count\n                else:\n                    p, s, im0, frame = path, '', im0s.copy(), getattr(dataset, 'frame', 0) \n                s += '%gx%g ' % img.shape[2:]  # print string\n                p = Path(p)  # to Path\n                save_path = save_dir+p.name # img.jpg\n                if len(det):\n                    # Rescale boxes from img_size to im0 size\n                    # 调整预测框的坐标：基于resize+pad的图片的坐标-->基于原size图片的坐标\n                    # 此时坐标格式为xyxy\n                    det[:, :4] = scale_coords(img.shape[2:], det[:, :4], im0.shape).round()\n\n                    # Print results\n                    for c in det[:, -1].unique():\n                        n = (det[:, -1] == c).sum()  # detections per class\n                        s += f\"{n} {names[int(c)]}{'s' * (n > 1)}, \"  # add to string\n                    # [\"Vorticella\", \"Rotifera\"]\n                    # Write results\n                    # for *xyxy, conf, cls in reversed(det):\n                    for *xyxy, conf, cls in det: #置信度从大到小 #图中的所有框信息\n                        xywh_no_norm = xyxy2xywh(torch.tensor(xyxy).view(1, 4)).view(-1).tolist()\n                        box = (cls, xywh_no_norm, conf) #存储类别 xywh 置信度\n                        if(conf<sift_thres):continue #过滤置信度小于0.7的框\n                        if(cls==0):\n                            Vorticella_list.append(box)\n                        elif(cls==1):\n                            Rotifera_list.append(box)\n                        # imgbox_list.append(box)\n                        c = int(cls)  # integer class\n                        label = f'{names[c]} {conf:.2f}'\n                        plot_one_box(xyxy, im0, label=label, color=colors(c, True), line_thickness=3)\n\n                # Save results (image with detections)\n                if save_img:\n                    if dataset.mode == 'image':\n                        cv2.imwrite(save_path, im0)\n                    else:  # 'video' or 'stream'\n                        if vid_path != save_path:  # new video\n                            vid_path = save_path\n                            if isinstance(vid_writer, cv2.VideoWriter):\n                                vid_writer.release()  # release previous video writer\n                            if vid_cap:  # video\n                                fps = vid_cap.get(cv2.CAP_PROP_FPS) #获取原始视频的帧率\n                                # w = int(vid_cap.get(cv2.CAP_PROP_FRAME_WIDTH)) #获取原始视频帧宽\n                                # h = int(vid_cap.get(cv2.CAP_PROP_FRAME_HEIGHT)) #获取原始视频的高\n                                w, h =  im0.shape[1], im0.shape[0] #更新为原始图像的宽高\n                            else:  # stream\n                                fps, w, h = 30, im0.shape[1], im0.shape[0]\n                                # save_path += '.mp4'\n                                save_path += '.flv'\n                            # vid_writer = cv2.VideoWriter(save_path, cv2.VideoWriter_fourcc(*'mp4v'), fps, (w, h))\n\n                            vid_writer = cv2.VideoWriter(save_path, cv2.VideoWriter_fourcc('F', 'L', 'V', '1'), fps, (w, h))\n                        vid_writer.write(im0)\n```\n\n","slug":"python/img/pic2video","published":1,"updated":"2022-01-18T08:10:17.112Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0l800nsast94msahljd","content":"<blockquote>\n<p>在微生物项目中，需要将视频中的微生物检测识别出来，并且生成视频的格式保存，其中需要将检测的annotation图片合成为视频格式。<strong>大致流程：使用cv库，首先读取图片，resize到指定大小，存储到Video实例中；</strong></p>\n</blockquote>\n<blockquote>\n<p>OpenCV 底层是用 FFMEPG 进行多媒体开发的，所以 OpenCV 它的长项不在于此，它只是提供了这种能力而已，如果要针对多媒体文件做复杂的处理，推荐的还是 FFMEPG 专业库。OpenCV 用来创建视频文件的类是 VideoWriter。首先普及一些视频类相关的知识点。</p>\n</blockquote>\n<h2 id=\"视频有关知识\">视频有关知识</h2>\n<h3 id=\"1-文件后缀名\">1. 文件后缀名</h3>\n<p>我们一般都知道视频文件是 .mp4、.3gp、.rmvb 等等格式的，但一个文件取这样的后缀名是为了告诉用户或者操作系统，它的内容是什么格式的。我们也可以将 rmvb 格式的文件取名为 ***.avi。后缀的目的是为了方便用专业的工具或者软件操作它们。</p>\n<h3 id=\"2-文件格式\">2. 文件格式</h3>\n<p>我们可以将一个视频文件看做一个容器。</p>\n<p>简单地说就是可以看做是一个盒子。</p>\n<p><strong>这个盒子里面有视频画面数据、音频数据、字幕数据等等。</strong></p>\n<p>不同的文件格式如 mp4、avi、mkv 等等，它们存放 打包数据的方式不一样，文件内部文件编码方式也可能不一样。</p>\n<h3 id=\"3-编码格式\">3. 编码格式</h3>\n<p>视频容器中，一般有视频和音频数据，它们采取的编码方式不一样。</p>\n<p>视频常见的编码方式通常有： x264、h264、mpeg-4</p>\n<p>音频常见的编码方式通常有： mp3、AAC、flac</p>\n<p>编码的目的主要是为了高效存储和传输，如果你不采用编码压缩的话，那么视频可以看做是一系列的图片序列，体积会非常大。</p>\n<h3 id=\"4-编码器和解码器\">4. 编码器和解码器</h3>\n<p>把视频或者音频按照编码格式，编码成特定文件格式需要编码器的参与，不然每次开发重新写代码代价很高。</p>\n<p>把特定文件格式解码成特定的编码格式数据，这个过程称为解码，需要解码器的存在。</p>\n<p>解码器和编码器都有开源的或者收费的工具库，极大方便了开发者。</p>\n<h3 id=\"5-FPS-帧率\">5. FPS 帧率</h3>\n<p>我们读初中物理时，大概了解过电影画面一秒钟 24 帧，其实对应的就是 24 fps，frame per second，有些手机有高速摄像的功能，原理就是能够 1 秒钟拍摄 960 张图片，然后用正常的速度放映出来，所以细节比较多。</p>\n<p>fps 越高，细节越好，体验也越好，但是文件容量也越高。</p>\n<h2 id=\"函数原型-cv2-VideoWriter\">函数原型 cv2.VideoWriter()</h2>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">VideoWriter(filename, fourcc, fps, frameSize[, isColor]) -&gt; &lt;VideoWriter <span class=\"hljs-built_in\">object</span>&gt;<br></code></pre></td></tr></tbody></table></figure>\n<ul>\n<li>filename:要保存的文件的路径</li>\n<li>fourcc: 指定编码器</li>\n<li>fps: 要保存的视频的帧率</li>\n<li>frameSize: 要保存的文件的画面尺寸</li>\n<li>isColor: 指示是黑白画面还是彩色的画面</li>\n</ul>\n<h3 id=\"fourcc的设置\">fourcc的设置</h3>\n<blockquote>\n<p>fourcc意为四字符代码（Four-Character Codes），顾名思义，该编码由四个字符组成,下面是VideoWriter_fourcc对象一些常用的参数，注意：字符顺序不能弄混。</p>\n</blockquote>\n<ul>\n<li>\n<p>cv2.VideoWriter_fourcc(‘D’, ‘I’, ‘V’, ‘X’) 对应格式 mp4</p>\n</li>\n<li>\n<p>cv2.VideoWriter_fourcc(‘I’,‘4’,‘2’,‘0’)—未压缩的YUV颜色编码，4:2:0色度子采样。兼容性好，但文件较大，注意是很大。文件扩展名.avi。</p>\n</li>\n<li>\n<p>cv2.VideoWriter_focurcc(‘P’,‘I’,‘M’,‘1’)—MPEG-1编码类型。随机访问，灵活的帧率、可变的图像尺寸、定义了I帧、P帧和B帧、运动补偿可跨越多个帧、半像素精度的运动向量、量化矩阵、GOF结构、slice结构、技术细节、输入视频格式。文件扩展名.avi。</p>\n</li>\n<li>\n<p>cv2.VideoWriter_fourcc(‘X’,‘V’,‘I’,‘D’)—MPEG-4编码类型，视频大小为平均值，MPEG4所需要的空间是MPEG1或M-JPEG的1/10，它对运动物体可以保证良好的清晰度，间/时间/画质具有可调性。文件扩展名.avi。</p>\n</li>\n<li>\n<p>cv2.VideoWriter_fourcc(‘T’,‘H’,‘E’,‘O’)—OGGVorbis，音频压缩格式，有损压缩，类似于MP3等的音乐格式。兼容性差，文件扩展名为.ogv。</p>\n</li>\n<li>\n<p>**cv2.VideoWriter_focurcc(‘F’,‘L’,‘V’,‘1’)—FLV是FLASH VIDEO的简称，FLV流媒体格式是一种新的视频格式。**由于它形成的文件极小、加载速度极快，使得网络观看视频文件成为可能，它的出现有效的解决了视频文件导入Flash后，使导出的SWF文件体积庞大，不能在网络上很好的使用等缺点。文件扩展名为.flv</p>\n</li>\n</ul>\n<p>视频编码方式还有很多，具体可参考http://www.fourcc.org/codecs.php。</p>\n<h2 id=\"实现代码\">实现代码</h2>\n<p><code>flv2jpg.py</code>:切分视频，按照指定帧频率保存图片。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> os<br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">flv2jpg</span>(<span class=\"hljs-params\">videopath, mytimeF=<span class=\"hljs-number\">1</span>, save_flag = <span class=\"hljs-literal\">False</span></span>):</span><br>    <span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\">    将flv格式视频每隔mytimeF个帧保存一张图片</span><br><span class=\"hljs-string\">    :param videopath: 存储flv视频的文件夹</span><br><span class=\"hljs-string\">    :param mytimeF: 间隔帧数</span><br><span class=\"hljs-string\">    :return:</span><br><span class=\"hljs-string\">    \"\"\"</span><br>    save_dir = os.path.join(os.path.dirname(videopath), <span class=\"hljs-string\">\"images\"</span>)<br>    os.makedirs(save_dir, exist_ok=<span class=\"hljs-literal\">True</span>)<br>    num = <span class=\"hljs-number\">1</span>  <span class=\"hljs-comment\"># 保存图片计数</span><br>    <span class=\"hljs-built_in\">print</span>(videopath)<br>    vc = cv2.VideoCapture(videopath)<br>    <span class=\"hljs-keyword\">if</span> vc.isOpened():<br>        rval, frame = vc.read()<br>    <span class=\"hljs-keyword\">else</span>:<br>        rval = <span class=\"hljs-literal\">False</span><br>    timeF = mytimeF  <span class=\"hljs-comment\"># 每隔mytimeF帧</span><br>    count = <span class=\"hljs-number\">1</span>  <span class=\"hljs-comment\"># 帧计数</span><br>    <span class=\"hljs-keyword\">while</span> rval:<br>        rval, frame = vc.read()<br>        <span class=\"hljs-keyword\">if</span> count % timeF == <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> frame <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span>:<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"current frame count:\"</span>, count)<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"num:\"</span>, num)<br><br>            <span class=\"hljs-keyword\">if</span> save_flag:<br>                save_path = os.path.join(save_dir, <span class=\"hljs-built_in\">str</span>(num) + <span class=\"hljs-string\">\"_\"</span> + videopath.split(<span class=\"hljs-string\">\"/\"</span>)[-<span class=\"hljs-number\">1</span>] + <span class=\"hljs-string\">\".jpg\"</span>)<br>                cv2.imwrite(save_path, frame)<br>                <span class=\"hljs-built_in\">print</span>(save_path)<br>                num += <span class=\"hljs-number\">1</span><br>        count += <span class=\"hljs-number\">1</span><br>    vc.release()<br>    <span class=\"hljs-keyword\">return</span> save_dir<br><br><br><span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:<br>    test_video = <span class=\"hljs-string\">\"./data/lunchong3.flv\"</span><br>    flv2jpg(test_video,save_flag=<span class=\"hljs-literal\">True</span>)<br><br></code></pre></td></tr></tbody></table></figure>\n<p><code>main.py</code> ：保存处理后的视频</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> flv2jpg <span class=\"hljs-keyword\">import</span> flv2jpg<br><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> os,glob<br><span class=\"hljs-keyword\">from</span> detectInfo <span class=\"hljs-keyword\">import</span> Detect_img<br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">makeVideo</span>(<span class=\"hljs-params\">Video_img_list,fps,size,save_dir</span>):</span><br>    <span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\">    func:由切分好的视频帧图像得到检测后的视频</span><br><span class=\"hljs-string\">    input: 待合成的图片list，视频的fps，size设置 视频保存路径</span><br><span class=\"hljs-string\">    return: 无返回</span><br><span class=\"hljs-string\">    \"\"\"</span><br>    <span class=\"hljs-comment\"># video = cv2.VideoWriter(save_dir, cv2.VideoWriter_fourcc('I', '4', '2', '0'), fps, size)</span><br>    video = cv2.VideoWriter(save_dir, cv2.VideoWriter_fourcc(*<span class=\"hljs-string\">'mp4v'</span>), fps, size)<br><br>    <span class=\"hljs-keyword\">for</span> img <span class=\"hljs-keyword\">in</span> Video_img_list:<br>        img = cv2.resize(img, size)  <span class=\"hljs-comment\"># 将图片转换为1280*720</span><br>        video.write(img)<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">detectVideo</span>(<span class=\"hljs-params\">test_video_path,detect_img,fps=<span class=\"hljs-number\">24</span>,size=(<span class=\"hljs-params\"><span class=\"hljs-number\">640</span>,<span class=\"hljs-number\">480</span></span>),sift_thres = <span class=\"hljs-number\">0.5</span></span>):</span><br>    <span class=\"hljs-string\">\"\"\"</span><br><span class=\"hljs-string\">    将输入的视频，切分图像，使用模型检测，返回合成的视频结果</span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">        test_video_path: 视频路径 </span><br><span class=\"hljs-string\">        detect_img: 模型实例</span><br><span class=\"hljs-string\">        fps: 视频帧</span><br><span class=\"hljs-string\">        size: 视频图像大小</span><br><span class=\"hljs-string\">        sift_thres: 筛选显示的检测阈值</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Returns: None</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    \"\"\"</span><br>    img_root = flv2jpg(test_video_path,save_flag=<span class=\"hljs-literal\">True</span>) <span class=\"hljs-comment\">#读取路径</span><br>    save_dir_anno = os.path.join(os.path.dirname(test_video_path),<span class=\"hljs-string\">\"annotation/\"</span>)<br>    <span class=\"hljs-comment\">#获取批量数据的检测信息</span><br>    Video_img_list = detect_img.get_info(source=img_root, save_img=<span class=\"hljs-literal\">True</span>, save_dir=save_dir_anno,sift_thres=sift_thres)<br>    save_dir = os.path.join(os.path.dirname(test_video_path),<span class=\"hljs-string\">\"VideoDetect.mp4\"</span>)<br>    makeVideo(Video_img_list, fps, size, save_dir)<br><br><br><span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:<br>    detect_img = Detect_img(weights=<span class=\"hljs-string\">\"./weights/best.pt\"</span>)<br>    test_video_path = <span class=\"hljs-string\">\"./data/lunchong3.flv\"</span><br>    detectVideo(test_video_path, detect_img, fps=<span class=\"hljs-number\">120</span>, size=(<span class=\"hljs-number\">640</span>, <span class=\"hljs-number\">480</span>), sift_thres=<span class=\"hljs-number\">0</span>)<br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"YoLov5中的实现\">YoLov5中的实现</h2>\n<p>实际上在yolov5的detect脚本中，包含了处理输入为视频格式文件的检测代码，可以直接使用。</p>\n<h3 id=\"相关代码\">相关代码</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">datasets.py<br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">LoadImages</span>:</span>  <span class=\"hljs-comment\"># for inference</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, path, img_size=<span class=\"hljs-number\">640</span>, stride=<span class=\"hljs-number\">32</span></span>):</span><br>        p = <span class=\"hljs-built_in\">str</span>(Path(path).absolute())  <span class=\"hljs-comment\"># os-agnostic absolute path</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'*'</span> <span class=\"hljs-keyword\">in</span> p:<br>            files = <span class=\"hljs-built_in\">sorted</span>(glob.glob(p, recursive=<span class=\"hljs-literal\">True</span>))  <span class=\"hljs-comment\"># glob</span><br>        <span class=\"hljs-keyword\">elif</span> os.path.isdir(p):<br>            files = <span class=\"hljs-built_in\">sorted</span>(glob.glob(os.path.join(p, <span class=\"hljs-string\">'*.*'</span>)))  <span class=\"hljs-comment\"># dir</span><br>        <span class=\"hljs-keyword\">elif</span> os.path.isfile(p):<br>            files = [p]  <span class=\"hljs-comment\"># files</span><br>        <span class=\"hljs-keyword\">else</span>:<br>            <span class=\"hljs-keyword\">raise</span> Exception(<span class=\"hljs-string\">f'ERROR: <span class=\"hljs-subst\">{p}</span> does not exist'</span>)<br><br>        images = [x <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> files <span class=\"hljs-keyword\">if</span> x.split(<span class=\"hljs-string\">'.'</span>)[-<span class=\"hljs-number\">1</span>].lower() <span class=\"hljs-keyword\">in</span> img_formats]<br>        videos = [x <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> files <span class=\"hljs-keyword\">if</span> x.split(<span class=\"hljs-string\">'.'</span>)[-<span class=\"hljs-number\">1</span>].lower() <span class=\"hljs-keyword\">in</span> vid_formats]<br>        ni, nv = <span class=\"hljs-built_in\">len</span>(images), <span class=\"hljs-built_in\">len</span>(videos)<br><br>        self.img_size = img_size<br>        self.stride = stride<br>        self.files = images + videos<br>        self.nf = ni + nv  <span class=\"hljs-comment\"># number of files</span><br>        self.video_flag = [<span class=\"hljs-literal\">False</span>] * ni + [<span class=\"hljs-literal\">True</span>] * nv<br>        self.mode = <span class=\"hljs-string\">'image'</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">any</span>(videos):<br>            self.new_video(videos[<span class=\"hljs-number\">0</span>])  <span class=\"hljs-comment\"># 如果为路径则读取打开视频</span><br>        <span class=\"hljs-keyword\">else</span>:<br>            self.cap = <span class=\"hljs-literal\">None</span><br>        <span class=\"hljs-keyword\">assert</span> self.nf &gt; <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">f'No images or videos found in <span class=\"hljs-subst\">{p}</span>. '</span> \\<br>                            <span class=\"hljs-string\">f'Supported formats are:\\nimages: <span class=\"hljs-subst\">{img_formats}</span>\\nvideos: <span class=\"hljs-subst\">{vid_formats}</span>'</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__iter__</span>(<span class=\"hljs-params\">self</span>):</span><br>        self.count = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">return</span> self<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__next__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-keyword\">if</span> self.count == self.nf:<br>            <span class=\"hljs-keyword\">raise</span> StopIteration<br>        path = self.files[self.count]<br><br>        <span class=\"hljs-keyword\">if</span> self.video_flag[self.count]:<br>            <span class=\"hljs-comment\"># Read video</span><br>            self.mode = <span class=\"hljs-string\">'video'</span><br>            ret_val, img0 = self.cap.read() <span class=\"hljs-comment\">#按帧读取视频，ret,frame是获cap.read()方法的两个返回值。其中ret是布尔值，如果读取帧是正确的则返回True，如果文件读取到结尾，它的返回值就为False。frame就是每一帧的图像，是个三维矩阵。</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> ret_val:<br>                self.count += <span class=\"hljs-number\">1</span><br>                self.cap.release()<br>                <span class=\"hljs-keyword\">if</span> self.count == self.nf:  <span class=\"hljs-comment\"># last video</span><br>                    <span class=\"hljs-keyword\">raise</span> StopIteration<br>                <span class=\"hljs-keyword\">else</span>:<br>                    path = self.files[self.count]<br>                    self.new_video(path) <br>                    ret_val, img0 = self.cap.read()<br><br>            self.frame += <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-comment\"># print(f'video {self.count + 1}/{self.nf} ({self.frame}/{self.frames}) {path}: ', end='')</span><br><br>        <span class=\"hljs-keyword\">else</span>:<br>            <span class=\"hljs-comment\"># Read image</span><br>            self.count += <span class=\"hljs-number\">1</span><br>            img_path_code = np.fromfile(path, dtype=np.uint8)  <span class=\"hljs-comment\"># 含有中文路径时</span><br>            img0 = cv2.imdecode(img_path_code,<span class=\"hljs-number\">1</span>)  <span class=\"hljs-comment\"># path，，，，BGR</span><br>            <span class=\"hljs-keyword\">assert</span> img0 <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span>, <span class=\"hljs-string\">'Image Not Found '</span> + path<br>            <span class=\"hljs-comment\"># print(f'image {self.count}/{self.nf} {path}: ', end='')</span><br><br>        <span class=\"hljs-comment\"># Padded resize</span><br>        img = letterbox(img0, self.img_size, stride=self.stride)[<span class=\"hljs-number\">0</span>]<br><br>        <span class=\"hljs-comment\"># Convert</span><br>        img = img[:, :, ::-<span class=\"hljs-number\">1</span>].transpose(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>)  <span class=\"hljs-comment\"># BGR to RGB and HWC to CHW</span><br>        img = np.ascontiguousarray(img)<br><br>        <span class=\"hljs-keyword\">return</span> path, img, img0, self.cap<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">new_video</span>(<span class=\"hljs-params\">self, path</span>):</span><br>        self.frame = <span class=\"hljs-number\">0</span><br>        self.cap = cv2.VideoCapture(path) <span class=\"hljs-comment\">#VideoCapture()中参数是0，表示打开笔记本的内置摄像头，参数是视频文件路径则打开视频</span><br>        self.frames = <span class=\"hljs-built_in\">int</span>(self.cap.get(cv2.CAP_PROP_FRAME_COUNT))<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__len__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-keyword\">return</span> self.nf  <span class=\"hljs-comment\"># number of files</span><br></code></pre></td></tr></tbody></table></figure>\n<p>detect.py中涉及视频的处理代码：在上述的loaddata中的cap.read()会默认得到的帧图像为640*480，可以使用cap.get()函数得到视频相关属性，使用cap.set()函数设置3，4id的参数值（3，4对应的是宽高属性）</p>\n<blockquote>\n<p>cv2.VideoCapture().set(propId, value)<br>\n功能：设置摄像头<br>\n参数：propId：设置的视频参数，<br>\n　　　　　　　类型：整数，<br>\n　　　　　　　可以参考 ：cv2.VideoCapture().get()中的参数<br>\n　　　　　　　value： 设置的参数<br>\n返回值：bool值：<br>\n　　　　true:不能确保摄像头已接受属性值<br>\n　　　　flase:摄像头未接受属性值</p>\n<p>举例：<br>\ncap.set(3, 480)<br>\n参数：3：在视频流的帧的宽度<br>\n　　　480：高度的数值<br>\n功能：把视频流的帧(图片)的宽度调成480</p>\n<p>cap.set(4, 480)<br>\n参数：4：在视频流的帧的高度<br>\n　　　480：宽度的数值<br>\n功能：把视频流的帧(图片)的高度调成480</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>param</th>\n<th>define</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>cv2.VideoCapture.get(0)</td>\n<td>CV_CAP_PROP_POS_MSEC 视频文件的当前位置（播放）以毫秒为单位</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(1)</td>\n<td>CV_CAP_PROP_POS_FRAMES 基于以0开始的被捕获或解码的帧索引</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(2)</td>\n<td>CV_CAP_PROP_POS_AVI_RATIO 视频文件的相对位置（播放）：0=电影开始，1=影片的结尾。</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(3)</td>\n<td>CV_CAP_PROP_FRAME_WIDTH 在视频流的帧的宽度</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(4)</td>\n<td>CV_CAP_PROP_FRAME_HEIGHT 在视频流的帧的高度</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(5)</td>\n<td>CV_CAP_PROP_FPS 帧速率</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(6)</td>\n<td>CV_CAP_PROP_FOURCC 编解码的4字-字符代码</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(7)</td>\n<td>CV_CAP_PROP_FRAME_COUNT 视频文件中的帧数</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(8)</td>\n<td>CV_CAP_PROP_FORMAT 返回对象的格式</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(9)</td>\n<td>CV_CAP_PROP_MODE 返回后端特定的值，该值指示当前捕获模式</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(10)</td>\n<td>CV_CAP_PROP_BRIGHTNESS 图像的亮度(仅适用于照相机)</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(11)</td>\n<td>CV_CAP_PROP_CONTRAST 图像的对比度(仅适用于照相机)</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(12)</td>\n<td>CV_CAP_PROP_SATURATION 图像的饱和度(仅适用于照相机)</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(13)</td>\n<td>CV_CAP_PROP_HUE 色调图像(仅适用于照相机)</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(14)</td>\n<td>CV_CAP_PROP_GAIN 图像增益(仅适用于照相机)（Gain在摄影中表示白平衡提升）</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(15)</td>\n<td>CV_CAP_PROP_EXPOSURE 曝光(仅适用于照相机)</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(16)</td>\n<td>CV_CAP_PROP_CONVERT_RGB 指示是否应将图像转换为RGB布尔标志</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(17)</td>\n<td>CV_CAP_PROP_WHITE_BALANCE × 暂时不支持</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(18)</td>\n<td>CV_CAP_PROP_RECTIFICATION 立体摄像机的矫正标注（目前只有DC1394 v.2.x后端支持这个功能）</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>capture.set</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>capture.set(CV_CAP_PROP_FRAME_WIDTH, 1080);</td>\n<td>宽度</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_FRAME_HEIGHT, 960);</td>\n<td>高度</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_FPS, 30);</td>\n<td>帧率 帧/秒</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_BRIGHTNESS, 1);</td>\n<td>亮度</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_CONTRAST,40)</td>\n<td>对比度 40</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_SATURATION, 50);</td>\n<td>饱和度 50</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_HUE, 50);</td>\n<td>色调 50</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_EXPOSURE, 50);</td>\n<td>曝光 50 获取摄像头参数</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"具体代码\">具体代码</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Set Dataloader</span><br>vid_path, vid_writer = <span class=\"hljs-literal\">None</span>, <span class=\"hljs-literal\">None</span><br><span class=\"hljs-keyword\">if</span> webcam:<br>    view_img = check_imshow()<br>    cudnn.benchmark = <span class=\"hljs-literal\">True</span>  <span class=\"hljs-comment\"># set True to speed up constant image size inference</span><br>    dataset = LoadStreams(source, img_size=imgsz, stride=stride)<br><span class=\"hljs-keyword\">else</span>:<br>    dataset = LoadImages(source, img_size=imgsz, stride=stride)<br><br><span class=\"hljs-keyword\">for</span> path, img, im0s, vid_cap <span class=\"hljs-keyword\">in</span> tqdm(dataset): <span class=\"hljs-comment\">#一个batch的信息</span><br>    img_path_list.append(path)<br>    img = torch.from_numpy(img).to(device)<br>    img = img.half() <span class=\"hljs-keyword\">if</span> half <span class=\"hljs-keyword\">else</span> img.<span class=\"hljs-built_in\">float</span>()  <span class=\"hljs-comment\"># uint8 to fp16/32</span><br>    img /= <span class=\"hljs-number\">255.0</span>  <span class=\"hljs-comment\"># 0 - 255 to 0.0 - 1.0</span><br>    <span class=\"hljs-keyword\">if</span> img.ndimension() == <span class=\"hljs-number\">3</span>:<br>        img = img.unsqueeze(<span class=\"hljs-number\">0</span>)<br><br>    <span class=\"hljs-comment\"># Inference</span><br>    t1 = time_synchronized()<br>    pred = model(img, augment=augment)[<span class=\"hljs-number\">0</span>]<br><br>    <span class=\"hljs-comment\"># Apply NMS</span><br>    pred = non_max_suppression(pred, conf_thres, iou_thres, classes, agnostic_nms, max_det=max_det)<br>    t2 = time_synchronized()<br><br>    <span class=\"hljs-comment\"># Process detections</span><br>    <span class=\"hljs-comment\"># imgbox_list = [] #一张图的box信息</span><br>    Vorticella_list = []<br>    Rotifera_list = []<br><br><br>    <span class=\"hljs-keyword\">for</span> i, det <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(pred):  <span class=\"hljs-comment\"># detections per image 一张图信息</span><br>        <span class=\"hljs-keyword\">if</span> webcam:  <span class=\"hljs-comment\"># batch_size &gt;= 1</span><br>            p, s, im0, frame = path[i], <span class=\"hljs-string\">f'<span class=\"hljs-subst\">{i}</span>: '</span>, im0s[i].copy(), dataset.count<br>        <span class=\"hljs-keyword\">else</span>:<br>            p, s, im0, frame = path, <span class=\"hljs-string\">''</span>, im0s.copy(), <span class=\"hljs-built_in\">getattr</span>(dataset, <span class=\"hljs-string\">'frame'</span>, <span class=\"hljs-number\">0</span>) <br>        s += <span class=\"hljs-string\">'%gx%g '</span> % img.shape[<span class=\"hljs-number\">2</span>:]  <span class=\"hljs-comment\"># print string</span><br>        p = Path(p)  <span class=\"hljs-comment\"># to Path</span><br>        save_path = save_dir+p.name <span class=\"hljs-comment\"># img.jpg</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(det):<br>            <span class=\"hljs-comment\"># Rescale boxes from img_size to im0 size</span><br>            <span class=\"hljs-comment\"># 调整预测框的坐标：基于resize+pad的图片的坐标--&gt;基于原size图片的坐标</span><br>            <span class=\"hljs-comment\"># 此时坐标格式为xyxy</span><br>            det[:, :<span class=\"hljs-number\">4</span>] = scale_coords(img.shape[<span class=\"hljs-number\">2</span>:], det[:, :<span class=\"hljs-number\">4</span>], im0.shape).<span class=\"hljs-built_in\">round</span>()<br><br>            <span class=\"hljs-comment\"># Print results</span><br>            <span class=\"hljs-keyword\">for</span> c <span class=\"hljs-keyword\">in</span> det[:, -<span class=\"hljs-number\">1</span>].unique():<br>                n = (det[:, -<span class=\"hljs-number\">1</span>] == c).<span class=\"hljs-built_in\">sum</span>()  <span class=\"hljs-comment\"># detections per class</span><br>                s += <span class=\"hljs-string\">f\"<span class=\"hljs-subst\">{n}</span> <span class=\"hljs-subst\">{names[<span class=\"hljs-built_in\">int</span>(c)]}</span><span class=\"hljs-subst\">{<span class=\"hljs-string\">'s'</span> * (n &gt; <span class=\"hljs-number\">1</span>)}</span>, \"</span>  <span class=\"hljs-comment\"># add to string</span><br>            <span class=\"hljs-comment\"># [\"Vorticella\", \"Rotifera\"]</span><br>            <span class=\"hljs-comment\"># Write results</span><br>            <span class=\"hljs-comment\"># for *xyxy, conf, cls in reversed(det):</span><br>            <span class=\"hljs-keyword\">for</span> *xyxy, conf, cls <span class=\"hljs-keyword\">in</span> det: <span class=\"hljs-comment\">#置信度从大到小 #图中的所有框信息</span><br>                xywh_no_norm = xyxy2xywh(torch.tensor(xyxy).view(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">4</span>)).view(-<span class=\"hljs-number\">1</span>).tolist()<br>                box = (cls, xywh_no_norm, conf) <span class=\"hljs-comment\">#存储类别 xywh 置信度</span><br>                <span class=\"hljs-keyword\">if</span>(conf&lt;sift_thres):<span class=\"hljs-keyword\">continue</span> <span class=\"hljs-comment\">#过滤置信度小于0.7的框</span><br>                <span class=\"hljs-keyword\">if</span>(cls==<span class=\"hljs-number\">0</span>):<br>                    Vorticella_list.append(box)<br>                <span class=\"hljs-keyword\">elif</span>(cls==<span class=\"hljs-number\">1</span>):<br>                    Rotifera_list.append(box)<br>                <span class=\"hljs-comment\"># imgbox_list.append(box)</span><br>                c = <span class=\"hljs-built_in\">int</span>(cls)  <span class=\"hljs-comment\"># integer class</span><br>                label = <span class=\"hljs-string\">f'<span class=\"hljs-subst\">{names[c]}</span> <span class=\"hljs-subst\">{conf:<span class=\"hljs-number\">.2</span>f}</span>'</span><br>                plot_one_box(xyxy, im0, label=label, color=colors(c, <span class=\"hljs-literal\">True</span>), line_thickness=<span class=\"hljs-number\">3</span>)<br><br>        <span class=\"hljs-comment\"># Save results (image with detections)</span><br>        <span class=\"hljs-keyword\">if</span> save_img:<br>            <span class=\"hljs-keyword\">if</span> dataset.mode == <span class=\"hljs-string\">'image'</span>:<br>                cv2.imwrite(save_path, im0)<br>            <span class=\"hljs-keyword\">else</span>:  <span class=\"hljs-comment\"># 'video' or 'stream'</span><br>                <span class=\"hljs-keyword\">if</span> vid_path != save_path:  <span class=\"hljs-comment\"># new video</span><br>                    vid_path = save_path<br>                    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(vid_writer, cv2.VideoWriter):<br>                        vid_writer.release()  <span class=\"hljs-comment\"># release previous video writer</span><br>                    <span class=\"hljs-keyword\">if</span> vid_cap:  <span class=\"hljs-comment\"># video</span><br>                        fps = vid_cap.get(cv2.CAP_PROP_FPS) <span class=\"hljs-comment\">#获取原始视频的帧率</span><br>                        <span class=\"hljs-comment\"># w = int(vid_cap.get(cv2.CAP_PROP_FRAME_WIDTH)) #获取原始视频帧宽</span><br>                        <span class=\"hljs-comment\"># h = int(vid_cap.get(cv2.CAP_PROP_FRAME_HEIGHT)) #获取原始视频的高</span><br>                        w, h =  im0.shape[<span class=\"hljs-number\">1</span>], im0.shape[<span class=\"hljs-number\">0</span>] <span class=\"hljs-comment\">#更新为原始图像的宽高</span><br>                    <span class=\"hljs-keyword\">else</span>:  <span class=\"hljs-comment\"># stream</span><br>                        fps, w, h = <span class=\"hljs-number\">30</span>, im0.shape[<span class=\"hljs-number\">1</span>], im0.shape[<span class=\"hljs-number\">0</span>]<br>                        <span class=\"hljs-comment\"># save_path += '.mp4'</span><br>                        save_path += <span class=\"hljs-string\">'.flv'</span><br>                    <span class=\"hljs-comment\"># vid_writer = cv2.VideoWriter(save_path, cv2.VideoWriter_fourcc(*'mp4v'), fps, (w, h))</span><br><br>                    vid_writer = cv2.VideoWriter(save_path, cv2.VideoWriter_fourcc(<span class=\"hljs-string\">'F'</span>, <span class=\"hljs-string\">'L'</span>, <span class=\"hljs-string\">'V'</span>, <span class=\"hljs-string\">'1'</span>), fps, (w, h))<br>                vid_writer.write(im0)<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>在微生物项目中，需要将视频中的微生物检测识别出来，并且生成视频的格式保存，其中需要将检测的annotation图片合成为视频格式。<strong>大致流程：使用cv库，首先读取图片，resize到指定大小，存储到Video实例中；</strong></p>\n</blockquote>\n<blockquote>\n<p>OpenCV 底层是用 FFMEPG 进行多媒体开发的，所以 OpenCV 它的长项不在于此，它只是提供了这种能力而已，如果要针对多媒体文件做复杂的处理，推荐的还是 FFMEPG 专业库。OpenCV 用来创建视频文件的类是 VideoWriter。首先普及一些视频类相关的知识点。</p>\n</blockquote>\n<h2 id=\"视频有关知识\">视频有关知识</h2>\n<h3 id=\"1-文件后缀名\">1. 文件后缀名</h3>\n<p>我们一般都知道视频文件是 .mp4、.3gp、.rmvb 等等格式的，但一个文件取这样的后缀名是为了告诉用户或者操作系统，它的内容是什么格式的。我们也可以将 rmvb 格式的文件取名为 ***.avi。后缀的目的是为了方便用专业的工具或者软件操作它们。</p>\n<h3 id=\"2-文件格式\">2. 文件格式</h3>\n<p>我们可以将一个视频文件看做一个容器。</p>\n<p>简单地说就是可以看做是一个盒子。</p>\n<p><strong>这个盒子里面有视频画面数据、音频数据、字幕数据等等。</strong></p>\n<p>不同的文件格式如 mp4、avi、mkv 等等，它们存放 打包数据的方式不一样，文件内部文件编码方式也可能不一样。</p>\n<h3 id=\"3-编码格式\">3. 编码格式</h3>\n<p>视频容器中，一般有视频和音频数据，它们采取的编码方式不一样。</p>\n<p>视频常见的编码方式通常有： x264、h264、mpeg-4</p>\n<p>音频常见的编码方式通常有： mp3、AAC、flac</p>\n<p>编码的目的主要是为了高效存储和传输，如果你不采用编码压缩的话，那么视频可以看做是一系列的图片序列，体积会非常大。</p>\n<h3 id=\"4-编码器和解码器\">4. 编码器和解码器</h3>\n<p>把视频或者音频按照编码格式，编码成特定文件格式需要编码器的参与，不然每次开发重新写代码代价很高。</p>\n<p>把特定文件格式解码成特定的编码格式数据，这个过程称为解码，需要解码器的存在。</p>\n<p>解码器和编码器都有开源的或者收费的工具库，极大方便了开发者。</p>\n<h3 id=\"5-FPS-帧率\">5. FPS 帧率</h3>\n<p>我们读初中物理时，大概了解过电影画面一秒钟 24 帧，其实对应的就是 24 fps，frame per second，有些手机有高速摄像的功能，原理就是能够 1 秒钟拍摄 960 张图片，然后用正常的速度放映出来，所以细节比较多。</p>\n<p>fps 越高，细节越好，体验也越好，但是文件容量也越高。</p>\n<h2 id=\"函数原型-cv2-VideoWriter\">函数原型 cv2.VideoWriter()</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">VideoWriter(filename, fourcc, fps, frameSize[, isColor]) -&gt; &lt;VideoWriter <span class=\"hljs-built_in\">object</span>&gt;<br></code></pre></td></tr></table></figure>\n<ul>\n<li>filename:要保存的文件的路径</li>\n<li>fourcc: 指定编码器</li>\n<li>fps: 要保存的视频的帧率</li>\n<li>frameSize: 要保存的文件的画面尺寸</li>\n<li>isColor: 指示是黑白画面还是彩色的画面</li>\n</ul>\n<h3 id=\"fourcc的设置\">fourcc的设置</h3>\n<blockquote>\n<p>fourcc意为四字符代码（Four-Character Codes），顾名思义，该编码由四个字符组成,下面是VideoWriter_fourcc对象一些常用的参数，注意：字符顺序不能弄混。</p>\n</blockquote>\n<ul>\n<li>\n<p>cv2.VideoWriter_fourcc(‘D’, ‘I’, ‘V’, ‘X’) 对应格式 mp4</p>\n</li>\n<li>\n<p>cv2.VideoWriter_fourcc(‘I’,‘4’,‘2’,‘0’)—未压缩的YUV颜色编码，4:2:0色度子采样。兼容性好，但文件较大，注意是很大。文件扩展名.avi。</p>\n</li>\n<li>\n<p>cv2.VideoWriter_focurcc(‘P’,‘I’,‘M’,‘1’)—MPEG-1编码类型。随机访问，灵活的帧率、可变的图像尺寸、定义了I帧、P帧和B帧、运动补偿可跨越多个帧、半像素精度的运动向量、量化矩阵、GOF结构、slice结构、技术细节、输入视频格式。文件扩展名.avi。</p>\n</li>\n<li>\n<p>cv2.VideoWriter_fourcc(‘X’,‘V’,‘I’,‘D’)—MPEG-4编码类型，视频大小为平均值，MPEG4所需要的空间是MPEG1或M-JPEG的1/10，它对运动物体可以保证良好的清晰度，间/时间/画质具有可调性。文件扩展名.avi。</p>\n</li>\n<li>\n<p>cv2.VideoWriter_fourcc(‘T’,‘H’,‘E’,‘O’)—OGGVorbis，音频压缩格式，有损压缩，类似于MP3等的音乐格式。兼容性差，文件扩展名为.ogv。</p>\n</li>\n<li>\n<p>**cv2.VideoWriter_focurcc(‘F’,‘L’,‘V’,‘1’)—FLV是FLASH VIDEO的简称，FLV流媒体格式是一种新的视频格式。**由于它形成的文件极小、加载速度极快，使得网络观看视频文件成为可能，它的出现有效的解决了视频文件导入Flash后，使导出的SWF文件体积庞大，不能在网络上很好的使用等缺点。文件扩展名为.flv</p>\n</li>\n</ul>\n<p>视频编码方式还有很多，具体可参考http://www.fourcc.org/codecs.php。</p>\n<h2 id=\"实现代码\">实现代码</h2>\n<p><code>flv2jpg.py</code>:切分视频，按照指定帧频率保存图片。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> os<br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">flv2jpg</span>(<span class=\"hljs-params\">videopath, mytimeF=<span class=\"hljs-number\">1</span>, save_flag = <span class=\"hljs-literal\">False</span></span>):</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">    将flv格式视频每隔mytimeF个帧保存一张图片</span><br><span class=\"hljs-string\">    :param videopath: 存储flv视频的文件夹</span><br><span class=\"hljs-string\">    :param mytimeF: 间隔帧数</span><br><span class=\"hljs-string\">    :return:</span><br><span class=\"hljs-string\">    &quot;&quot;&quot;</span><br>    save_dir = os.path.join(os.path.dirname(videopath), <span class=\"hljs-string\">&quot;images&quot;</span>)<br>    os.makedirs(save_dir, exist_ok=<span class=\"hljs-literal\">True</span>)<br>    num = <span class=\"hljs-number\">1</span>  <span class=\"hljs-comment\"># 保存图片计数</span><br>    <span class=\"hljs-built_in\">print</span>(videopath)<br>    vc = cv2.VideoCapture(videopath)<br>    <span class=\"hljs-keyword\">if</span> vc.isOpened():<br>        rval, frame = vc.read()<br>    <span class=\"hljs-keyword\">else</span>:<br>        rval = <span class=\"hljs-literal\">False</span><br>    timeF = mytimeF  <span class=\"hljs-comment\"># 每隔mytimeF帧</span><br>    count = <span class=\"hljs-number\">1</span>  <span class=\"hljs-comment\"># 帧计数</span><br>    <span class=\"hljs-keyword\">while</span> rval:<br>        rval, frame = vc.read()<br>        <span class=\"hljs-keyword\">if</span> count % timeF == <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> frame <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span>:<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;current frame count:&quot;</span>, count)<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;num:&quot;</span>, num)<br><br>            <span class=\"hljs-keyword\">if</span> save_flag:<br>                save_path = os.path.join(save_dir, <span class=\"hljs-built_in\">str</span>(num) + <span class=\"hljs-string\">&quot;_&quot;</span> + videopath.split(<span class=\"hljs-string\">&quot;/&quot;</span>)[-<span class=\"hljs-number\">1</span>] + <span class=\"hljs-string\">&quot;.jpg&quot;</span>)<br>                cv2.imwrite(save_path, frame)<br>                <span class=\"hljs-built_in\">print</span>(save_path)<br>                num += <span class=\"hljs-number\">1</span><br>        count += <span class=\"hljs-number\">1</span><br>    vc.release()<br>    <span class=\"hljs-keyword\">return</span> save_dir<br><br><br><span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:<br>    test_video = <span class=\"hljs-string\">&quot;./data/lunchong3.flv&quot;</span><br>    flv2jpg(test_video,save_flag=<span class=\"hljs-literal\">True</span>)<br><br></code></pre></td></tr></table></figure>\n<p><code>main.py</code> ：保存处理后的视频</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> flv2jpg <span class=\"hljs-keyword\">import</span> flv2jpg<br><span class=\"hljs-keyword\">import</span> cv2<br><span class=\"hljs-keyword\">import</span> os,glob<br><span class=\"hljs-keyword\">from</span> detectInfo <span class=\"hljs-keyword\">import</span> Detect_img<br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">makeVideo</span>(<span class=\"hljs-params\">Video_img_list,fps,size,save_dir</span>):</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">    func:由切分好的视频帧图像得到检测后的视频</span><br><span class=\"hljs-string\">    input: 待合成的图片list，视频的fps，size设置 视频保存路径</span><br><span class=\"hljs-string\">    return: 无返回</span><br><span class=\"hljs-string\">    &quot;&quot;&quot;</span><br>    <span class=\"hljs-comment\"># video = cv2.VideoWriter(save_dir, cv2.VideoWriter_fourcc(&#x27;I&#x27;, &#x27;4&#x27;, &#x27;2&#x27;, &#x27;0&#x27;), fps, size)</span><br>    video = cv2.VideoWriter(save_dir, cv2.VideoWriter_fourcc(*<span class=\"hljs-string\">&#x27;mp4v&#x27;</span>), fps, size)<br><br>    <span class=\"hljs-keyword\">for</span> img <span class=\"hljs-keyword\">in</span> Video_img_list:<br>        img = cv2.resize(img, size)  <span class=\"hljs-comment\"># 将图片转换为1280*720</span><br>        video.write(img)<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">detectVideo</span>(<span class=\"hljs-params\">test_video_path,detect_img,fps=<span class=\"hljs-number\">24</span>,size=(<span class=\"hljs-params\"><span class=\"hljs-number\">640</span>,<span class=\"hljs-number\">480</span></span>),sift_thres = <span class=\"hljs-number\">0.5</span></span>):</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">    将输入的视频，切分图像，使用模型检测，返回合成的视频结果</span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">        test_video_path: 视频路径 </span><br><span class=\"hljs-string\">        detect_img: 模型实例</span><br><span class=\"hljs-string\">        fps: 视频帧</span><br><span class=\"hljs-string\">        size: 视频图像大小</span><br><span class=\"hljs-string\">        sift_thres: 筛选显示的检测阈值</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Returns: None</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    &quot;&quot;&quot;</span><br>    img_root = flv2jpg(test_video_path,save_flag=<span class=\"hljs-literal\">True</span>) <span class=\"hljs-comment\">#读取路径</span><br>    save_dir_anno = os.path.join(os.path.dirname(test_video_path),<span class=\"hljs-string\">&quot;annotation/&quot;</span>)<br>    <span class=\"hljs-comment\">#获取批量数据的检测信息</span><br>    Video_img_list = detect_img.get_info(source=img_root, save_img=<span class=\"hljs-literal\">True</span>, save_dir=save_dir_anno,sift_thres=sift_thres)<br>    save_dir = os.path.join(os.path.dirname(test_video_path),<span class=\"hljs-string\">&quot;VideoDetect.mp4&quot;</span>)<br>    makeVideo(Video_img_list, fps, size, save_dir)<br><br><br><span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:<br>    detect_img = Detect_img(weights=<span class=\"hljs-string\">&quot;./weights/best.pt&quot;</span>)<br>    test_video_path = <span class=\"hljs-string\">&quot;./data/lunchong3.flv&quot;</span><br>    detectVideo(test_video_path, detect_img, fps=<span class=\"hljs-number\">120</span>, size=(<span class=\"hljs-number\">640</span>, <span class=\"hljs-number\">480</span>), sift_thres=<span class=\"hljs-number\">0</span>)<br></code></pre></td></tr></table></figure>\n<h2 id=\"YoLov5中的实现\">YoLov5中的实现</h2>\n<p>实际上在yolov5的detect脚本中，包含了处理输入为视频格式文件的检测代码，可以直接使用。</p>\n<h3 id=\"相关代码\">相关代码</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">datasets.py<br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">LoadImages</span>:</span>  <span class=\"hljs-comment\"># for inference</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, path, img_size=<span class=\"hljs-number\">640</span>, stride=<span class=\"hljs-number\">32</span></span>):</span><br>        p = <span class=\"hljs-built_in\">str</span>(Path(path).absolute())  <span class=\"hljs-comment\"># os-agnostic absolute path</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">&#x27;*&#x27;</span> <span class=\"hljs-keyword\">in</span> p:<br>            files = <span class=\"hljs-built_in\">sorted</span>(glob.glob(p, recursive=<span class=\"hljs-literal\">True</span>))  <span class=\"hljs-comment\"># glob</span><br>        <span class=\"hljs-keyword\">elif</span> os.path.isdir(p):<br>            files = <span class=\"hljs-built_in\">sorted</span>(glob.glob(os.path.join(p, <span class=\"hljs-string\">&#x27;*.*&#x27;</span>)))  <span class=\"hljs-comment\"># dir</span><br>        <span class=\"hljs-keyword\">elif</span> os.path.isfile(p):<br>            files = [p]  <span class=\"hljs-comment\"># files</span><br>        <span class=\"hljs-keyword\">else</span>:<br>            <span class=\"hljs-keyword\">raise</span> Exception(<span class=\"hljs-string\">f&#x27;ERROR: <span class=\"hljs-subst\">&#123;p&#125;</span> does not exist&#x27;</span>)<br><br>        images = [x <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> files <span class=\"hljs-keyword\">if</span> x.split(<span class=\"hljs-string\">&#x27;.&#x27;</span>)[-<span class=\"hljs-number\">1</span>].lower() <span class=\"hljs-keyword\">in</span> img_formats]<br>        videos = [x <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> files <span class=\"hljs-keyword\">if</span> x.split(<span class=\"hljs-string\">&#x27;.&#x27;</span>)[-<span class=\"hljs-number\">1</span>].lower() <span class=\"hljs-keyword\">in</span> vid_formats]<br>        ni, nv = <span class=\"hljs-built_in\">len</span>(images), <span class=\"hljs-built_in\">len</span>(videos)<br><br>        self.img_size = img_size<br>        self.stride = stride<br>        self.files = images + videos<br>        self.nf = ni + nv  <span class=\"hljs-comment\"># number of files</span><br>        self.video_flag = [<span class=\"hljs-literal\">False</span>] * ni + [<span class=\"hljs-literal\">True</span>] * nv<br>        self.mode = <span class=\"hljs-string\">&#x27;image&#x27;</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">any</span>(videos):<br>            self.new_video(videos[<span class=\"hljs-number\">0</span>])  <span class=\"hljs-comment\"># 如果为路径则读取打开视频</span><br>        <span class=\"hljs-keyword\">else</span>:<br>            self.cap = <span class=\"hljs-literal\">None</span><br>        <span class=\"hljs-keyword\">assert</span> self.nf &gt; <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">f&#x27;No images or videos found in <span class=\"hljs-subst\">&#123;p&#125;</span>. &#x27;</span> \\<br>                            <span class=\"hljs-string\">f&#x27;Supported formats are:\\nimages: <span class=\"hljs-subst\">&#123;img_formats&#125;</span>\\nvideos: <span class=\"hljs-subst\">&#123;vid_formats&#125;</span>&#x27;</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__iter__</span>(<span class=\"hljs-params\">self</span>):</span><br>        self.count = <span class=\"hljs-number\">0</span><br>        <span class=\"hljs-keyword\">return</span> self<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__next__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-keyword\">if</span> self.count == self.nf:<br>            <span class=\"hljs-keyword\">raise</span> StopIteration<br>        path = self.files[self.count]<br><br>        <span class=\"hljs-keyword\">if</span> self.video_flag[self.count]:<br>            <span class=\"hljs-comment\"># Read video</span><br>            self.mode = <span class=\"hljs-string\">&#x27;video&#x27;</span><br>            ret_val, img0 = self.cap.read() <span class=\"hljs-comment\">#按帧读取视频，ret,frame是获cap.read()方法的两个返回值。其中ret是布尔值，如果读取帧是正确的则返回True，如果文件读取到结尾，它的返回值就为False。frame就是每一帧的图像，是个三维矩阵。</span><br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> ret_val:<br>                self.count += <span class=\"hljs-number\">1</span><br>                self.cap.release()<br>                <span class=\"hljs-keyword\">if</span> self.count == self.nf:  <span class=\"hljs-comment\"># last video</span><br>                    <span class=\"hljs-keyword\">raise</span> StopIteration<br>                <span class=\"hljs-keyword\">else</span>:<br>                    path = self.files[self.count]<br>                    self.new_video(path) <br>                    ret_val, img0 = self.cap.read()<br><br>            self.frame += <span class=\"hljs-number\">1</span><br>            <span class=\"hljs-comment\"># print(f&#x27;video &#123;self.count + 1&#125;/&#123;self.nf&#125; (&#123;self.frame&#125;/&#123;self.frames&#125;) &#123;path&#125;: &#x27;, end=&#x27;&#x27;)</span><br><br>        <span class=\"hljs-keyword\">else</span>:<br>            <span class=\"hljs-comment\"># Read image</span><br>            self.count += <span class=\"hljs-number\">1</span><br>            img_path_code = np.fromfile(path, dtype=np.uint8)  <span class=\"hljs-comment\"># 含有中文路径时</span><br>            img0 = cv2.imdecode(img_path_code,<span class=\"hljs-number\">1</span>)  <span class=\"hljs-comment\"># path，，，，BGR</span><br>            <span class=\"hljs-keyword\">assert</span> img0 <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span>, <span class=\"hljs-string\">&#x27;Image Not Found &#x27;</span> + path<br>            <span class=\"hljs-comment\"># print(f&#x27;image &#123;self.count&#125;/&#123;self.nf&#125; &#123;path&#125;: &#x27;, end=&#x27;&#x27;)</span><br><br>        <span class=\"hljs-comment\"># Padded resize</span><br>        img = letterbox(img0, self.img_size, stride=self.stride)[<span class=\"hljs-number\">0</span>]<br><br>        <span class=\"hljs-comment\"># Convert</span><br>        img = img[:, :, ::-<span class=\"hljs-number\">1</span>].transpose(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>)  <span class=\"hljs-comment\"># BGR to RGB and HWC to CHW</span><br>        img = np.ascontiguousarray(img)<br><br>        <span class=\"hljs-keyword\">return</span> path, img, img0, self.cap<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">new_video</span>(<span class=\"hljs-params\">self, path</span>):</span><br>        self.frame = <span class=\"hljs-number\">0</span><br>        self.cap = cv2.VideoCapture(path) <span class=\"hljs-comment\">#VideoCapture()中参数是0，表示打开笔记本的内置摄像头，参数是视频文件路径则打开视频</span><br>        self.frames = <span class=\"hljs-built_in\">int</span>(self.cap.get(cv2.CAP_PROP_FRAME_COUNT))<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__len__</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-keyword\">return</span> self.nf  <span class=\"hljs-comment\"># number of files</span><br></code></pre></td></tr></table></figure>\n<p>detect.py中涉及视频的处理代码：在上述的loaddata中的cap.read()会默认得到的帧图像为640*480，可以使用cap.get()函数得到视频相关属性，使用cap.set()函数设置3，4id的参数值（3，4对应的是宽高属性）</p>\n<blockquote>\n<p>cv2.VideoCapture().set(propId, value)<br>\n功能：设置摄像头<br>\n参数：propId：设置的视频参数，<br>\n　　　　　　　类型：整数，<br>\n　　　　　　　可以参考 ：cv2.VideoCapture().get()中的参数<br>\n　　　　　　　value： 设置的参数<br>\n返回值：bool值：<br>\n　　　　true:不能确保摄像头已接受属性值<br>\n　　　　flase:摄像头未接受属性值</p>\n<p>举例：<br>\ncap.set(3, 480)<br>\n参数：3：在视频流的帧的宽度<br>\n　　　480：高度的数值<br>\n功能：把视频流的帧(图片)的宽度调成480</p>\n<p>cap.set(4, 480)<br>\n参数：4：在视频流的帧的高度<br>\n　　　480：宽度的数值<br>\n功能：把视频流的帧(图片)的高度调成480</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>param</th>\n<th>define</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>cv2.VideoCapture.get(0)</td>\n<td>CV_CAP_PROP_POS_MSEC 视频文件的当前位置（播放）以毫秒为单位</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(1)</td>\n<td>CV_CAP_PROP_POS_FRAMES 基于以0开始的被捕获或解码的帧索引</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(2)</td>\n<td>CV_CAP_PROP_POS_AVI_RATIO 视频文件的相对位置（播放）：0=电影开始，1=影片的结尾。</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(3)</td>\n<td>CV_CAP_PROP_FRAME_WIDTH 在视频流的帧的宽度</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(4)</td>\n<td>CV_CAP_PROP_FRAME_HEIGHT 在视频流的帧的高度</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(5)</td>\n<td>CV_CAP_PROP_FPS 帧速率</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(6)</td>\n<td>CV_CAP_PROP_FOURCC 编解码的4字-字符代码</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(7)</td>\n<td>CV_CAP_PROP_FRAME_COUNT 视频文件中的帧数</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(8)</td>\n<td>CV_CAP_PROP_FORMAT 返回对象的格式</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(9)</td>\n<td>CV_CAP_PROP_MODE 返回后端特定的值，该值指示当前捕获模式</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(10)</td>\n<td>CV_CAP_PROP_BRIGHTNESS 图像的亮度(仅适用于照相机)</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(11)</td>\n<td>CV_CAP_PROP_CONTRAST 图像的对比度(仅适用于照相机)</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(12)</td>\n<td>CV_CAP_PROP_SATURATION 图像的饱和度(仅适用于照相机)</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(13)</td>\n<td>CV_CAP_PROP_HUE 色调图像(仅适用于照相机)</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(14)</td>\n<td>CV_CAP_PROP_GAIN 图像增益(仅适用于照相机)（Gain在摄影中表示白平衡提升）</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(15)</td>\n<td>CV_CAP_PROP_EXPOSURE 曝光(仅适用于照相机)</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(16)</td>\n<td>CV_CAP_PROP_CONVERT_RGB 指示是否应将图像转换为RGB布尔标志</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(17)</td>\n<td>CV_CAP_PROP_WHITE_BALANCE × 暂时不支持</td>\n</tr>\n<tr>\n<td>cv2.VideoCapture.get(18)</td>\n<td>CV_CAP_PROP_RECTIFICATION 立体摄像机的矫正标注（目前只有DC1394 v.2.x后端支持这个功能）</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>capture.set</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>capture.set(CV_CAP_PROP_FRAME_WIDTH, 1080);</td>\n<td>宽度</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_FRAME_HEIGHT, 960);</td>\n<td>高度</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_FPS, 30);</td>\n<td>帧率 帧/秒</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_BRIGHTNESS, 1);</td>\n<td>亮度</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_CONTRAST,40)</td>\n<td>对比度 40</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_SATURATION, 50);</td>\n<td>饱和度 50</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_HUE, 50);</td>\n<td>色调 50</td>\n</tr>\n<tr>\n<td>capture.set(CV_CAP_PROP_EXPOSURE, 50);</td>\n<td>曝光 50 获取摄像头参数</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"具体代码\">具体代码</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Set Dataloader</span><br>vid_path, vid_writer = <span class=\"hljs-literal\">None</span>, <span class=\"hljs-literal\">None</span><br><span class=\"hljs-keyword\">if</span> webcam:<br>    view_img = check_imshow()<br>    cudnn.benchmark = <span class=\"hljs-literal\">True</span>  <span class=\"hljs-comment\"># set True to speed up constant image size inference</span><br>    dataset = LoadStreams(source, img_size=imgsz, stride=stride)<br><span class=\"hljs-keyword\">else</span>:<br>    dataset = LoadImages(source, img_size=imgsz, stride=stride)<br><br><span class=\"hljs-keyword\">for</span> path, img, im0s, vid_cap <span class=\"hljs-keyword\">in</span> tqdm(dataset): <span class=\"hljs-comment\">#一个batch的信息</span><br>    img_path_list.append(path)<br>    img = torch.from_numpy(img).to(device)<br>    img = img.half() <span class=\"hljs-keyword\">if</span> half <span class=\"hljs-keyword\">else</span> img.<span class=\"hljs-built_in\">float</span>()  <span class=\"hljs-comment\"># uint8 to fp16/32</span><br>    img /= <span class=\"hljs-number\">255.0</span>  <span class=\"hljs-comment\"># 0 - 255 to 0.0 - 1.0</span><br>    <span class=\"hljs-keyword\">if</span> img.ndimension() == <span class=\"hljs-number\">3</span>:<br>        img = img.unsqueeze(<span class=\"hljs-number\">0</span>)<br><br>    <span class=\"hljs-comment\"># Inference</span><br>    t1 = time_synchronized()<br>    pred = model(img, augment=augment)[<span class=\"hljs-number\">0</span>]<br><br>    <span class=\"hljs-comment\"># Apply NMS</span><br>    pred = non_max_suppression(pred, conf_thres, iou_thres, classes, agnostic_nms, max_det=max_det)<br>    t2 = time_synchronized()<br><br>    <span class=\"hljs-comment\"># Process detections</span><br>    <span class=\"hljs-comment\"># imgbox_list = [] #一张图的box信息</span><br>    Vorticella_list = []<br>    Rotifera_list = []<br><br><br>    <span class=\"hljs-keyword\">for</span> i, det <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(pred):  <span class=\"hljs-comment\"># detections per image 一张图信息</span><br>        <span class=\"hljs-keyword\">if</span> webcam:  <span class=\"hljs-comment\"># batch_size &gt;= 1</span><br>            p, s, im0, frame = path[i], <span class=\"hljs-string\">f&#x27;<span class=\"hljs-subst\">&#123;i&#125;</span>: &#x27;</span>, im0s[i].copy(), dataset.count<br>        <span class=\"hljs-keyword\">else</span>:<br>            p, s, im0, frame = path, <span class=\"hljs-string\">&#x27;&#x27;</span>, im0s.copy(), <span class=\"hljs-built_in\">getattr</span>(dataset, <span class=\"hljs-string\">&#x27;frame&#x27;</span>, <span class=\"hljs-number\">0</span>) <br>        s += <span class=\"hljs-string\">&#x27;%gx%g &#x27;</span> % img.shape[<span class=\"hljs-number\">2</span>:]  <span class=\"hljs-comment\"># print string</span><br>        p = Path(p)  <span class=\"hljs-comment\"># to Path</span><br>        save_path = save_dir+p.name <span class=\"hljs-comment\"># img.jpg</span><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(det):<br>            <span class=\"hljs-comment\"># Rescale boxes from img_size to im0 size</span><br>            <span class=\"hljs-comment\"># 调整预测框的坐标：基于resize+pad的图片的坐标--&gt;基于原size图片的坐标</span><br>            <span class=\"hljs-comment\"># 此时坐标格式为xyxy</span><br>            det[:, :<span class=\"hljs-number\">4</span>] = scale_coords(img.shape[<span class=\"hljs-number\">2</span>:], det[:, :<span class=\"hljs-number\">4</span>], im0.shape).<span class=\"hljs-built_in\">round</span>()<br><br>            <span class=\"hljs-comment\"># Print results</span><br>            <span class=\"hljs-keyword\">for</span> c <span class=\"hljs-keyword\">in</span> det[:, -<span class=\"hljs-number\">1</span>].unique():<br>                n = (det[:, -<span class=\"hljs-number\">1</span>] == c).<span class=\"hljs-built_in\">sum</span>()  <span class=\"hljs-comment\"># detections per class</span><br>                s += <span class=\"hljs-string\">f&quot;<span class=\"hljs-subst\">&#123;n&#125;</span> <span class=\"hljs-subst\">&#123;names[<span class=\"hljs-built_in\">int</span>(c)]&#125;</span><span class=\"hljs-subst\">&#123;<span class=\"hljs-string\">&#x27;s&#x27;</span> * (n &gt; <span class=\"hljs-number\">1</span>)&#125;</span>, &quot;</span>  <span class=\"hljs-comment\"># add to string</span><br>            <span class=\"hljs-comment\"># [&quot;Vorticella&quot;, &quot;Rotifera&quot;]</span><br>            <span class=\"hljs-comment\"># Write results</span><br>            <span class=\"hljs-comment\"># for *xyxy, conf, cls in reversed(det):</span><br>            <span class=\"hljs-keyword\">for</span> *xyxy, conf, cls <span class=\"hljs-keyword\">in</span> det: <span class=\"hljs-comment\">#置信度从大到小 #图中的所有框信息</span><br>                xywh_no_norm = xyxy2xywh(torch.tensor(xyxy).view(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">4</span>)).view(-<span class=\"hljs-number\">1</span>).tolist()<br>                box = (cls, xywh_no_norm, conf) <span class=\"hljs-comment\">#存储类别 xywh 置信度</span><br>                <span class=\"hljs-keyword\">if</span>(conf&lt;sift_thres):<span class=\"hljs-keyword\">continue</span> <span class=\"hljs-comment\">#过滤置信度小于0.7的框</span><br>                <span class=\"hljs-keyword\">if</span>(cls==<span class=\"hljs-number\">0</span>):<br>                    Vorticella_list.append(box)<br>                <span class=\"hljs-keyword\">elif</span>(cls==<span class=\"hljs-number\">1</span>):<br>                    Rotifera_list.append(box)<br>                <span class=\"hljs-comment\"># imgbox_list.append(box)</span><br>                c = <span class=\"hljs-built_in\">int</span>(cls)  <span class=\"hljs-comment\"># integer class</span><br>                label = <span class=\"hljs-string\">f&#x27;<span class=\"hljs-subst\">&#123;names[c]&#125;</span> <span class=\"hljs-subst\">&#123;conf:<span class=\"hljs-number\">.2</span>f&#125;</span>&#x27;</span><br>                plot_one_box(xyxy, im0, label=label, color=colors(c, <span class=\"hljs-literal\">True</span>), line_thickness=<span class=\"hljs-number\">3</span>)<br><br>        <span class=\"hljs-comment\"># Save results (image with detections)</span><br>        <span class=\"hljs-keyword\">if</span> save_img:<br>            <span class=\"hljs-keyword\">if</span> dataset.mode == <span class=\"hljs-string\">&#x27;image&#x27;</span>:<br>                cv2.imwrite(save_path, im0)<br>            <span class=\"hljs-keyword\">else</span>:  <span class=\"hljs-comment\"># &#x27;video&#x27; or &#x27;stream&#x27;</span><br>                <span class=\"hljs-keyword\">if</span> vid_path != save_path:  <span class=\"hljs-comment\"># new video</span><br>                    vid_path = save_path<br>                    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(vid_writer, cv2.VideoWriter):<br>                        vid_writer.release()  <span class=\"hljs-comment\"># release previous video writer</span><br>                    <span class=\"hljs-keyword\">if</span> vid_cap:  <span class=\"hljs-comment\"># video</span><br>                        fps = vid_cap.get(cv2.CAP_PROP_FPS) <span class=\"hljs-comment\">#获取原始视频的帧率</span><br>                        <span class=\"hljs-comment\"># w = int(vid_cap.get(cv2.CAP_PROP_FRAME_WIDTH)) #获取原始视频帧宽</span><br>                        <span class=\"hljs-comment\"># h = int(vid_cap.get(cv2.CAP_PROP_FRAME_HEIGHT)) #获取原始视频的高</span><br>                        w, h =  im0.shape[<span class=\"hljs-number\">1</span>], im0.shape[<span class=\"hljs-number\">0</span>] <span class=\"hljs-comment\">#更新为原始图像的宽高</span><br>                    <span class=\"hljs-keyword\">else</span>:  <span class=\"hljs-comment\"># stream</span><br>                        fps, w, h = <span class=\"hljs-number\">30</span>, im0.shape[<span class=\"hljs-number\">1</span>], im0.shape[<span class=\"hljs-number\">0</span>]<br>                        <span class=\"hljs-comment\"># save_path += &#x27;.mp4&#x27;</span><br>                        save_path += <span class=\"hljs-string\">&#x27;.flv&#x27;</span><br>                    <span class=\"hljs-comment\"># vid_writer = cv2.VideoWriter(save_path, cv2.VideoWriter_fourcc(*&#x27;mp4v&#x27;), fps, (w, h))</span><br><br>                    vid_writer = cv2.VideoWriter(save_path, cv2.VideoWriter_fourcc(<span class=\"hljs-string\">&#x27;F&#x27;</span>, <span class=\"hljs-string\">&#x27;L&#x27;</span>, <span class=\"hljs-string\">&#x27;V&#x27;</span>, <span class=\"hljs-string\">&#x27;1&#x27;</span>), fps, (w, h))<br>                vid_writer.write(im0)<br></code></pre></td></tr></table></figure>\n"},{"title":"swin网络","date":"2021-08-25T03:27:25.000Z","_content":"\n> swin_transformer的结构和代码实现部分，在此基础上添加freeze的相关操作，记录如下。\n\n## 论文中的架构\n\n![](https://picture.mulindya.com/swin-pic1.png)\n\n## 论文笔记\n\n<details>\n<summary>Swin Transformer:Hierarchical Vision Transformer using Shifted Windows</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/Swin%20Transformer%20Hierarchical%20Vision%20Transformer%20using%20Shifted%20Windows.pdf' width=100% height=650></iframe>\n</details>\n\n## model架构\n\n``` python\nImageClassifier(\n  (backbone): SwinTransformer(\n    (patch_embed): PatchEmbed(\n      (projection): Conv2d(3, 96, kernel_size=(4, 4), stride=(4, 4))\n      (norm): LayerNorm((96,), eps=1e-05, elementwise_affine=True)\n    )\n    (drop_after_pos): Dropout(p=0.0, inplace=False)\n    (stages): ModuleList(\n      (0): SwinBlockSequence(\n        (blocks): ModuleList(\n          (0): SwinBlock(\n            (norm1): LayerNorm((96,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=96, out_features=288, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=96, out_features=96, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((96,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=96, out_features=384, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=384, out_features=96, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (1): SwinBlock(\n            (norm1): LayerNorm((96,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=96, out_features=288, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=96, out_features=96, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((96,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=96, out_features=384, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=384, out_features=96, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n        )\n        (downsample): PatchMerging(\n          (sampler): Unfold(kernel_size=(2, 2), dilation=(1, 1), padding=(0, 0), stride=(2, 2))\n          (norm): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n          (reduction): Linear(in_features=384, out_features=192, bias=False)\n        )\n      )\n      (1): SwinBlockSequence(\n        (blocks): ModuleList(\n          (0): SwinBlock(\n            (norm1): LayerNorm((192,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=192, out_features=576, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=192, out_features=192, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((192,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=192, out_features=768, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=768, out_features=192, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (1): SwinBlock(\n            (norm1): LayerNorm((192,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=192, out_features=576, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=192, out_features=192, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((192,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=192, out_features=768, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=768, out_features=192, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n        )\n        (downsample): PatchMerging(\n          (sampler): Unfold(kernel_size=(2, 2), dilation=(1, 1), padding=(0, 0), stride=(2, 2))\n          (norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n          (reduction): Linear(in_features=768, out_features=384, bias=False)\n        )\n      )\n      (2): SwinBlockSequence(\n        (blocks): ModuleList(\n          (0): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (1): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (2): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (3): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (4): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (5): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (6): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (7): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (8): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (9): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (10): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (11): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (12): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (13): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (14): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (15): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (16): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (17): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n        )\n        (downsample): PatchMerging(\n          (sampler): Unfold(kernel_size=(2, 2), dilation=(1, 1), padding=(0, 0), stride=(2, 2))\n          (norm): LayerNorm((1536,), eps=1e-05, elementwise_affine=True)\n          (reduction): Linear(in_features=1536, out_features=768, bias=False)\n        )\n      )\n      (3): SwinBlockSequence(\n        (blocks): ModuleList(\n          (0): SwinBlock(\n            (norm1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=768, out_features=2304, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=768, out_features=768, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=768, out_features=3072, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=3072, out_features=768, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (1): SwinBlock(\n            (norm1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=768, out_features=2304, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=768, out_features=768, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=768, out_features=3072, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=3072, out_features=768, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n        )\n      )\n    )\n    (norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n  )\n  (neck): GlobalAveragePooling(\n    (gap): AdaptiveAvgPool1d(output_size=1)\n  )\n  (head): MultiLabelLinearClsHead(\n    (compute_loss): CrossEntropyLoss()\n    (fc): Linear(in_features=768, out_features=11, bias=True)\n  )\n)\n```\n\n## 代码\n\n添加fronzen_stages:\n\n> 该参数表示你想冻结前几个 stages 的权重，swin 结构包括 4 stage内部结构(2,2,18,2)\n>\n> frozen_stages=-1，表示全部可学习\n>\n> frozen_stage=0，表示stem权重固定\n>\n> frozen_stages=1，表示 stem 和第一个 stage 权重固定\n>\n> frozen_stages=2，表示 stem 和前两个 stage 权重固定\n\n```python\nstage = SwinBlockSequence(**_stage_cfg)\n# 冻结某几层frozen_stages\nif(frozen_stages==0 or (i in range(0,frozen_stages))):\n\tstage.eval()\n\tfor param in stage.parameters():\n\t\tparam.requires_grad = False\n```\n\n全部代码\n\n```python\nfrom copy import deepcopy\nfrom typing import Sequence\n\nimport torch\nimport torch.nn as nn\nfrom mmcv.cnn import build_norm_layer\nfrom mmcv.cnn.bricks.transformer import FFN\nfrom mmcv.cnn.utils.weight_init import trunc_normal_\nfrom mmcv.runner.base_module import BaseModule, ModuleList\n\nfrom ..builder import BACKBONES\nfrom ..utils import PatchEmbed, PatchMerging, ShiftWindowMSA\nfrom .base_backbone import BaseBackbone\n\n\nclass SwinBlock(BaseModule):\n    \"\"\"Swin Transformer block.\n\n    Args:\n        embed_dims (int): Number of input channels.\n        input_resolution (Tuple[int, int]): The resolution of the input feature\n            map.\n        num_heads (int): Number of attention heads.\n        window_size (int, optional): The height and width of the window.\n            Defaults to 7.\n        shift (bool, optional): Shift the attention window or not.\n            Defaults to False.\n        ffn_ratio (float, optional): The expansion ratio of feedforward network\n            hidden layer channels. Defaults to 4.\n        drop_path (float, optional): The drop path rate after attention and\n            ffn. Defaults to 0.\n        attn_cfgs (dict, optional): The extra config of Shift Window-MSA.\n            Defaults to empty dict.\n        ffn_cfgs (dict, optional): The extra config of FFN.\n            Defaults to empty dict.\n        norm_cfg (dict, optional): The config of norm layers.\n            Defaults to dict(type='LN').\n        auto_pad (bool, optional): Auto pad the feature map to be divisible by\n            window_size, Defaults to False.\n        init_cfg (dict, optional): The extra config for initialization.\n            Default: None.\n    \"\"\"\n\n    def __init__(self,\n                 embed_dims,\n                 input_resolution,\n                 num_heads,\n                 window_size=7,\n                 shift=False,\n                 ffn_ratio=4.,\n                 drop_path=0.,\n                 attn_cfgs=dict(),\n                 ffn_cfgs=dict(),\n                 norm_cfg=dict(type='LN'),\n                 auto_pad=False,\n                 init_cfg=None):\n\n        super(SwinBlock, self).__init__(init_cfg)\n\n        _attn_cfgs = {\n            'embed_dims': embed_dims,\n            'input_resolution': input_resolution,\n            'num_heads': num_heads,\n            'shift_size': window_size // 2 if shift else 0,\n            'window_size': window_size,\n            'dropout_layer': dict(type='DropPath', drop_prob=drop_path),\n            'auto_pad': auto_pad,\n            **attn_cfgs\n        }\n        self.norm1 = build_norm_layer(norm_cfg, embed_dims)[1]\n        self.attn = ShiftWindowMSA(**_attn_cfgs)\n\n        _ffn_cfgs = {\n            'embed_dims': embed_dims,\n            'feedforward_channels': int(embed_dims * ffn_ratio),\n            'num_fcs': 2,\n            'ffn_drop': 0,\n            'dropout_layer': dict(type='DropPath', drop_prob=drop_path),\n            'act_cfg': dict(type='GELU'),\n            **ffn_cfgs\n        }\n        self.norm2 = build_norm_layer(norm_cfg, embed_dims)[1]\n        self.ffn = FFN(**_ffn_cfgs)\n\n    def forward(self, x):\n        identity = x\n        x = self.norm1(x)\n        x = self.attn(x)\n        x = x + identity\n\n        identity = x\n        x = self.norm2(x)\n        x = self.ffn(x, identity=identity)\n        return x\n\n\nclass SwinBlockSequence(BaseModule):\n    \"\"\"Module with successive Swin Transformer blocks and downsample layer.\n\n    Args:\n        embed_dims (int): Number of input channels.\n        input_resolution (Tuple[int, int]): The resolution of the input feature\n            map.\n        depth (int): Number of successive swin transformer blocks.\n        num_heads (int): Number of attention heads.\n        downsample (bool, optional): Downsample the output of blocks by patch\n            merging. Defaults to False.\n        downsample_cfg (dict, optional): The extra config of the patch merging\n            layer. Defaults to empty dict.\n        drop_paths (Sequence[float] | float, optional): The drop path rate in\n            each block. Defaults to 0.\n        block_cfgs (Sequence[dict] | dict, optional): The extra config of each\n            block. Defaults to empty dicts.\n        auto_pad (bool, optional): Auto pad the feature map to be divisible by\n            window_size, Defaults to False.\n        init_cfg (dict, optional): The extra config for initialization.\n            Default: None.\n    \"\"\"\n\n    def __init__(self,\n                 embed_dims,\n                 input_resolution,\n                 depth,\n                 num_heads,\n                 downsample=False,\n                 downsample_cfg=dict(),\n                 drop_paths=0.,\n                 block_cfgs=dict(),\n                 auto_pad=False,\n                 init_cfg=None):\n        super().__init__(init_cfg)\n\n        if not isinstance(drop_paths, Sequence):\n            drop_paths = [drop_paths] * depth\n\n        if not isinstance(block_cfgs, Sequence):\n            block_cfg = [deepcopy(block_cfgs) for _ in range(depth)]\n\n        self.blocks = ModuleList()\n        for i in range(depth):\n            _block_cfg = {\n                'embed_dims': embed_dims,\n                'input_resolution': input_resolution,\n                'num_heads': num_heads,\n                'shift': False if i % 2 == 0 else True,\n                'drop_path': drop_paths[i],\n                'auto_pad': auto_pad,\n                **block_cfg[i]\n            }\n            block = SwinBlock(**_block_cfg)\n            self.blocks.append(block)\n\n        if downsample:\n            _downsample_cfg = {\n                'input_resolution': input_resolution,\n                'in_channels': embed_dims,\n                'expansion_ratio': 2,\n                'norm_cfg': dict(type='LN'),\n                **downsample_cfg\n            }\n            self.downsample = PatchMerging(**_downsample_cfg)\n        else:\n            self.downsample = None\n\n    def forward(self, x):\n        for block in self.blocks:\n            x = block(x)\n\n        if self.downsample:\n            x = self.downsample(x)\n        return x\n\n\n@BACKBONES.register_module()\nclass SwinTransformer(BaseBackbone):\n    \"\"\" Swin Transformer\n    A PyTorch implement of : `Swin Transformer:\n    Hierarchical Vision Transformer using Shifted Windows`  -\n        https://arxiv.org/abs/2103.14030\n\n    Inspiration from\n    https://github.com/microsoft/Swin-Transformer\n\n    Args:\n        arch (str | dict): Swin Transformer architecture\n            Defaults to 'T'.\n        img_size (int | tuple): The size of input image.\n            Defaults to 224.\n        in_channels (int): The num of input channels.\n            Defaults to 3.\n        drop_rate (float): Dropout rate after embedding.\n            Defaults to 0.\n        drop_path_rate (float): Stochastic depth rate.\n            Defaults to 0.1.\n\n        # add attr\n        frozen_stages: defaults-1 dont freeze,0: all freeze,other: frozen_stages stages to freeze\n\n        use_abs_pos_embed (bool): If True, add absolute position embedding to\n            the patch embedding. Defaults to False.\n        auto_pad (bool): If True, auto pad feature map to fit window_size.\n            Defaults to False.\n        norm_cfg (dict, optional): Config dict for normalization layer at end\n            of backone. Defaults to dict(type='LN')\n        stage_cfgs (Sequence | dict, optional): Extra config dict for each\n            stage. Defaults to empty dict.\n        patch_cfg (dict, optional): Extra config dict for patch embedding.\n            Defaults to empty dict.\n        init_cfg (dict, optional): The Config for initialization.\n            Defaults to None.\n\n    Examples:\n        >>> from mmcls.models import SwinTransformer\n        >>> import torch\n        >>> extra_config = dict(\n        >>>     arch='tiny',\n        >>>     stage_cfgs=dict(downsample_cfg={'kernel_size': 3,\n        >>>                                     'expansion_ratio': 3}),\n        >>>     auto_pad=True)\n        >>> self = SwinTransformer(**extra_config)\n        >>> inputs = torch.rand(1, 3, 224, 224)\n        >>> output = self.forward(inputs)\n        >>> print(output.shape)\n        (1, 2592, 4)\n    \"\"\"\n    arch_zoo = {\n        **dict.fromkeys(['t', 'tiny'],\n                        {'embed_dims': 96,\n                         'depths':     [2, 2,  6,  2],\n                         'num_heads':  [3, 6, 12, 24]}),\n        **dict.fromkeys(['s', 'small'],\n                        {'embed_dims': 96,\n                         'depths':     [2, 2, 18,  2],\n                         'num_heads':  [3, 6, 12, 24]}),\n        **dict.fromkeys(['b', 'base'],\n                        {'embed_dims': 128,\n                         'depths':     [2, 2, 18,  2],\n                         'num_heads':  [4, 8, 16, 32]}),\n        **dict.fromkeys(['l', 'large'],\n                        {'embed_dims': 192,\n                         'depths':     [2,  2, 18,  2],\n                         'num_heads':  [6, 12, 24, 48]}),\n    }  # yapf: disable\n\n    def __init__(self,\n                 arch='T',\n                 img_size=224,\n                 in_channels=3,\n                 drop_rate=0.,\n                 drop_path_rate=0.1,\n                 frozen_stages=-1,\n                 use_abs_pos_embed=False,\n                 auto_pad=False,\n                 norm_cfg=dict(type='LN'),\n                 stage_cfgs=dict(),\n                 patch_cfg=dict(),\n                 init_cfg=None):\n        super(SwinTransformer, self).__init__(init_cfg)\n\n        if isinstance(arch, str):\n            arch = arch.lower()\n            assert arch in set(self.arch_zoo), \\\n                f'Arch {arch} is not in default archs {set(self.arch_zoo)}'\n            self.arch_settings = self.arch_zoo[arch]\n        else:\n            essential_keys = {'embed_dims', 'depths', 'num_head'}\n            assert isinstance(arch, dict) and set(arch) == essential_keys, \\\n                f'Custom arch needs a dict with keys {essential_keys}'\n            self.arch_settings = arch\n\n        self.embed_dims = self.arch_settings['embed_dims']\n        self.depths = self.arch_settings['depths']\n        self.num_heads = self.arch_settings['num_heads']\n        self.num_layers = len(self.depths)\n        self.use_abs_pos_embed = use_abs_pos_embed\n        self.auto_pad = auto_pad\n\n        _patch_cfg = dict(\n            img_size=img_size,\n            in_channels=in_channels,\n            embed_dims=self.embed_dims,\n            conv_cfg=dict(\n                type='Conv2d', kernel_size=4, stride=4, padding=0, dilation=1),\n            norm_cfg=dict(type='LN'),\n            **patch_cfg)\n        self.patch_embed = PatchEmbed(**_patch_cfg)\n        num_patches = self.patch_embed.num_patches\n        patches_resolution = self.patch_embed.patches_resolution\n        self.patches_resolution = patches_resolution\n\n        if self.use_abs_pos_embed:\n            self.absolute_pos_embed = nn.Parameter(\n                torch.zeros(1, num_patches, self.embed_dims))\n\n        self.drop_after_pos = nn.Dropout(p=drop_rate)\n\n        # stochastic depth\n        total_depth = sum(self.depths)\n        dpr = [\n            x.item() for x in torch.linspace(0, drop_path_rate, total_depth)\n        ]  # stochastic depth decay rule\n\n        self.stages = ModuleList()\n        embed_dims = self.embed_dims\n        input_resolution = patches_resolution\n        for i, (depth,\n                num_heads) in enumerate(zip(self.depths, self.num_heads)):\n            if isinstance(stage_cfgs, Sequence):\n                stage_cfg = stage_cfgs[i]\n            else:\n                stage_cfg = deepcopy(stage_cfgs)\n            downsample = True if i < self.num_layers - 1 else False\n            _stage_cfg = {\n                'embed_dims': embed_dims,\n                'depth': depth,\n                'num_heads': num_heads,\n                'downsample': downsample,\n                'input_resolution': input_resolution,\n                'drop_paths': dpr[:depth],\n                'auto_pad': auto_pad,\n                **stage_cfg\n            }\n\n            stage = SwinBlockSequence(**_stage_cfg)\n            # 冻结某几层frozen_stages\n            if(frozen_stages==0 or (i in range(0,frozen_stages))):\n                stage.eval()\n                for param in stage.parameters():\n                    param.requires_grad = False\n            \n            self.stages.append(stage)\n\n            dpr = dpr[depth:]\n            if downsample:\n                embed_dims = stage.downsample.out_channels\n                input_resolution = stage.downsample.output_resolution\n            \n\n        if norm_cfg is not None:\n            self.norm = build_norm_layer(norm_cfg, embed_dims)[1]\n        else:\n            self.norm = None\n\n    def init_weights(self):\n        super(SwinTransformer, self).init_weights()\n\n        if self.use_abs_pos_embed:\n            trunc_normal_(self.absolute_pos_embed, std=0.02)\n\n    def forward(self, x):\n        x = self.patch_embed(x)\n        if self.use_abs_pos_embed:\n            x = x + self.absolute_pos_embed\n        x = self.drop_after_pos(x)\n\n        for stage in self.stages:\n            x = stage(x)\n\n        x = self.norm(x) if self.norm else x\n\n        return x.transpose(1, 2)\n```\n\n","source":"_posts/deep_learning/swin.md","raw":"---\ntitle: swin网络\ntags: [深度学习,swin]\ncategories: [深度学习,网络架构]\ndate: 2021-08-25 11:27:25\n---\n\n> swin_transformer的结构和代码实现部分，在此基础上添加freeze的相关操作，记录如下。\n\n## 论文中的架构\n\n![](https://picture.mulindya.com/swin-pic1.png)\n\n## 论文笔记\n\n<details>\n<summary>Swin Transformer:Hierarchical Vision Transformer using Shifted Windows</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/Swin%20Transformer%20Hierarchical%20Vision%20Transformer%20using%20Shifted%20Windows.pdf' width=100% height=650></iframe>\n</details>\n\n## model架构\n\n``` python\nImageClassifier(\n  (backbone): SwinTransformer(\n    (patch_embed): PatchEmbed(\n      (projection): Conv2d(3, 96, kernel_size=(4, 4), stride=(4, 4))\n      (norm): LayerNorm((96,), eps=1e-05, elementwise_affine=True)\n    )\n    (drop_after_pos): Dropout(p=0.0, inplace=False)\n    (stages): ModuleList(\n      (0): SwinBlockSequence(\n        (blocks): ModuleList(\n          (0): SwinBlock(\n            (norm1): LayerNorm((96,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=96, out_features=288, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=96, out_features=96, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((96,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=96, out_features=384, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=384, out_features=96, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (1): SwinBlock(\n            (norm1): LayerNorm((96,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=96, out_features=288, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=96, out_features=96, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((96,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=96, out_features=384, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=384, out_features=96, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n        )\n        (downsample): PatchMerging(\n          (sampler): Unfold(kernel_size=(2, 2), dilation=(1, 1), padding=(0, 0), stride=(2, 2))\n          (norm): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n          (reduction): Linear(in_features=384, out_features=192, bias=False)\n        )\n      )\n      (1): SwinBlockSequence(\n        (blocks): ModuleList(\n          (0): SwinBlock(\n            (norm1): LayerNorm((192,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=192, out_features=576, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=192, out_features=192, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((192,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=192, out_features=768, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=768, out_features=192, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (1): SwinBlock(\n            (norm1): LayerNorm((192,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=192, out_features=576, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=192, out_features=192, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((192,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=192, out_features=768, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=768, out_features=192, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n        )\n        (downsample): PatchMerging(\n          (sampler): Unfold(kernel_size=(2, 2), dilation=(1, 1), padding=(0, 0), stride=(2, 2))\n          (norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n          (reduction): Linear(in_features=768, out_features=384, bias=False)\n        )\n      )\n      (2): SwinBlockSequence(\n        (blocks): ModuleList(\n          (0): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (1): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (2): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (3): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (4): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (5): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (6): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (7): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (8): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (9): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (10): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (11): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (12): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (13): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (14): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (15): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (16): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (17): SwinBlock(\n            (norm1): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=384, out_features=1152, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=384, out_features=384, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((384,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=384, out_features=1536, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=1536, out_features=384, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n        )\n        (downsample): PatchMerging(\n          (sampler): Unfold(kernel_size=(2, 2), dilation=(1, 1), padding=(0, 0), stride=(2, 2))\n          (norm): LayerNorm((1536,), eps=1e-05, elementwise_affine=True)\n          (reduction): Linear(in_features=1536, out_features=768, bias=False)\n        )\n      )\n      (3): SwinBlockSequence(\n        (blocks): ModuleList(\n          (0): SwinBlock(\n            (norm1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=768, out_features=2304, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=768, out_features=768, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=768, out_features=3072, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=3072, out_features=768, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n          (1): SwinBlock(\n            (norm1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n            (attn): ShiftWindowMSA(\n              (w_msa): WindowMSA(\n                (qkv): Linear(in_features=768, out_features=2304, bias=True)\n                (attn_drop): Dropout(p=0, inplace=False)\n                (proj): Linear(in_features=768, out_features=768, bias=True)\n                (proj_drop): Dropout(p=0, inplace=False)\n                (softmax): Softmax(dim=-1)\n              )\n              (drop): DropPath()\n            )\n            (norm2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n            (ffn): FFN(\n              (activate): GELU()\n              (layers): Sequential(\n                (0): Sequential(\n                  (0): Linear(in_features=768, out_features=3072, bias=True)\n                  (1): GELU()\n                  (2): Dropout(p=0, inplace=False)\n                )\n                (1): Linear(in_features=3072, out_features=768, bias=True)\n                (2): Dropout(p=0, inplace=False)\n              )\n              (dropout_layer): DropPath()\n            )\n          )\n        )\n      )\n    )\n    (norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)\n  )\n  (neck): GlobalAveragePooling(\n    (gap): AdaptiveAvgPool1d(output_size=1)\n  )\n  (head): MultiLabelLinearClsHead(\n    (compute_loss): CrossEntropyLoss()\n    (fc): Linear(in_features=768, out_features=11, bias=True)\n  )\n)\n```\n\n## 代码\n\n添加fronzen_stages:\n\n> 该参数表示你想冻结前几个 stages 的权重，swin 结构包括 4 stage内部结构(2,2,18,2)\n>\n> frozen_stages=-1，表示全部可学习\n>\n> frozen_stage=0，表示stem权重固定\n>\n> frozen_stages=1，表示 stem 和第一个 stage 权重固定\n>\n> frozen_stages=2，表示 stem 和前两个 stage 权重固定\n\n```python\nstage = SwinBlockSequence(**_stage_cfg)\n# 冻结某几层frozen_stages\nif(frozen_stages==0 or (i in range(0,frozen_stages))):\n\tstage.eval()\n\tfor param in stage.parameters():\n\t\tparam.requires_grad = False\n```\n\n全部代码\n\n```python\nfrom copy import deepcopy\nfrom typing import Sequence\n\nimport torch\nimport torch.nn as nn\nfrom mmcv.cnn import build_norm_layer\nfrom mmcv.cnn.bricks.transformer import FFN\nfrom mmcv.cnn.utils.weight_init import trunc_normal_\nfrom mmcv.runner.base_module import BaseModule, ModuleList\n\nfrom ..builder import BACKBONES\nfrom ..utils import PatchEmbed, PatchMerging, ShiftWindowMSA\nfrom .base_backbone import BaseBackbone\n\n\nclass SwinBlock(BaseModule):\n    \"\"\"Swin Transformer block.\n\n    Args:\n        embed_dims (int): Number of input channels.\n        input_resolution (Tuple[int, int]): The resolution of the input feature\n            map.\n        num_heads (int): Number of attention heads.\n        window_size (int, optional): The height and width of the window.\n            Defaults to 7.\n        shift (bool, optional): Shift the attention window or not.\n            Defaults to False.\n        ffn_ratio (float, optional): The expansion ratio of feedforward network\n            hidden layer channels. Defaults to 4.\n        drop_path (float, optional): The drop path rate after attention and\n            ffn. Defaults to 0.\n        attn_cfgs (dict, optional): The extra config of Shift Window-MSA.\n            Defaults to empty dict.\n        ffn_cfgs (dict, optional): The extra config of FFN.\n            Defaults to empty dict.\n        norm_cfg (dict, optional): The config of norm layers.\n            Defaults to dict(type='LN').\n        auto_pad (bool, optional): Auto pad the feature map to be divisible by\n            window_size, Defaults to False.\n        init_cfg (dict, optional): The extra config for initialization.\n            Default: None.\n    \"\"\"\n\n    def __init__(self,\n                 embed_dims,\n                 input_resolution,\n                 num_heads,\n                 window_size=7,\n                 shift=False,\n                 ffn_ratio=4.,\n                 drop_path=0.,\n                 attn_cfgs=dict(),\n                 ffn_cfgs=dict(),\n                 norm_cfg=dict(type='LN'),\n                 auto_pad=False,\n                 init_cfg=None):\n\n        super(SwinBlock, self).__init__(init_cfg)\n\n        _attn_cfgs = {\n            'embed_dims': embed_dims,\n            'input_resolution': input_resolution,\n            'num_heads': num_heads,\n            'shift_size': window_size // 2 if shift else 0,\n            'window_size': window_size,\n            'dropout_layer': dict(type='DropPath', drop_prob=drop_path),\n            'auto_pad': auto_pad,\n            **attn_cfgs\n        }\n        self.norm1 = build_norm_layer(norm_cfg, embed_dims)[1]\n        self.attn = ShiftWindowMSA(**_attn_cfgs)\n\n        _ffn_cfgs = {\n            'embed_dims': embed_dims,\n            'feedforward_channels': int(embed_dims * ffn_ratio),\n            'num_fcs': 2,\n            'ffn_drop': 0,\n            'dropout_layer': dict(type='DropPath', drop_prob=drop_path),\n            'act_cfg': dict(type='GELU'),\n            **ffn_cfgs\n        }\n        self.norm2 = build_norm_layer(norm_cfg, embed_dims)[1]\n        self.ffn = FFN(**_ffn_cfgs)\n\n    def forward(self, x):\n        identity = x\n        x = self.norm1(x)\n        x = self.attn(x)\n        x = x + identity\n\n        identity = x\n        x = self.norm2(x)\n        x = self.ffn(x, identity=identity)\n        return x\n\n\nclass SwinBlockSequence(BaseModule):\n    \"\"\"Module with successive Swin Transformer blocks and downsample layer.\n\n    Args:\n        embed_dims (int): Number of input channels.\n        input_resolution (Tuple[int, int]): The resolution of the input feature\n            map.\n        depth (int): Number of successive swin transformer blocks.\n        num_heads (int): Number of attention heads.\n        downsample (bool, optional): Downsample the output of blocks by patch\n            merging. Defaults to False.\n        downsample_cfg (dict, optional): The extra config of the patch merging\n            layer. Defaults to empty dict.\n        drop_paths (Sequence[float] | float, optional): The drop path rate in\n            each block. Defaults to 0.\n        block_cfgs (Sequence[dict] | dict, optional): The extra config of each\n            block. Defaults to empty dicts.\n        auto_pad (bool, optional): Auto pad the feature map to be divisible by\n            window_size, Defaults to False.\n        init_cfg (dict, optional): The extra config for initialization.\n            Default: None.\n    \"\"\"\n\n    def __init__(self,\n                 embed_dims,\n                 input_resolution,\n                 depth,\n                 num_heads,\n                 downsample=False,\n                 downsample_cfg=dict(),\n                 drop_paths=0.,\n                 block_cfgs=dict(),\n                 auto_pad=False,\n                 init_cfg=None):\n        super().__init__(init_cfg)\n\n        if not isinstance(drop_paths, Sequence):\n            drop_paths = [drop_paths] * depth\n\n        if not isinstance(block_cfgs, Sequence):\n            block_cfg = [deepcopy(block_cfgs) for _ in range(depth)]\n\n        self.blocks = ModuleList()\n        for i in range(depth):\n            _block_cfg = {\n                'embed_dims': embed_dims,\n                'input_resolution': input_resolution,\n                'num_heads': num_heads,\n                'shift': False if i % 2 == 0 else True,\n                'drop_path': drop_paths[i],\n                'auto_pad': auto_pad,\n                **block_cfg[i]\n            }\n            block = SwinBlock(**_block_cfg)\n            self.blocks.append(block)\n\n        if downsample:\n            _downsample_cfg = {\n                'input_resolution': input_resolution,\n                'in_channels': embed_dims,\n                'expansion_ratio': 2,\n                'norm_cfg': dict(type='LN'),\n                **downsample_cfg\n            }\n            self.downsample = PatchMerging(**_downsample_cfg)\n        else:\n            self.downsample = None\n\n    def forward(self, x):\n        for block in self.blocks:\n            x = block(x)\n\n        if self.downsample:\n            x = self.downsample(x)\n        return x\n\n\n@BACKBONES.register_module()\nclass SwinTransformer(BaseBackbone):\n    \"\"\" Swin Transformer\n    A PyTorch implement of : `Swin Transformer:\n    Hierarchical Vision Transformer using Shifted Windows`  -\n        https://arxiv.org/abs/2103.14030\n\n    Inspiration from\n    https://github.com/microsoft/Swin-Transformer\n\n    Args:\n        arch (str | dict): Swin Transformer architecture\n            Defaults to 'T'.\n        img_size (int | tuple): The size of input image.\n            Defaults to 224.\n        in_channels (int): The num of input channels.\n            Defaults to 3.\n        drop_rate (float): Dropout rate after embedding.\n            Defaults to 0.\n        drop_path_rate (float): Stochastic depth rate.\n            Defaults to 0.1.\n\n        # add attr\n        frozen_stages: defaults-1 dont freeze,0: all freeze,other: frozen_stages stages to freeze\n\n        use_abs_pos_embed (bool): If True, add absolute position embedding to\n            the patch embedding. Defaults to False.\n        auto_pad (bool): If True, auto pad feature map to fit window_size.\n            Defaults to False.\n        norm_cfg (dict, optional): Config dict for normalization layer at end\n            of backone. Defaults to dict(type='LN')\n        stage_cfgs (Sequence | dict, optional): Extra config dict for each\n            stage. Defaults to empty dict.\n        patch_cfg (dict, optional): Extra config dict for patch embedding.\n            Defaults to empty dict.\n        init_cfg (dict, optional): The Config for initialization.\n            Defaults to None.\n\n    Examples:\n        >>> from mmcls.models import SwinTransformer\n        >>> import torch\n        >>> extra_config = dict(\n        >>>     arch='tiny',\n        >>>     stage_cfgs=dict(downsample_cfg={'kernel_size': 3,\n        >>>                                     'expansion_ratio': 3}),\n        >>>     auto_pad=True)\n        >>> self = SwinTransformer(**extra_config)\n        >>> inputs = torch.rand(1, 3, 224, 224)\n        >>> output = self.forward(inputs)\n        >>> print(output.shape)\n        (1, 2592, 4)\n    \"\"\"\n    arch_zoo = {\n        **dict.fromkeys(['t', 'tiny'],\n                        {'embed_dims': 96,\n                         'depths':     [2, 2,  6,  2],\n                         'num_heads':  [3, 6, 12, 24]}),\n        **dict.fromkeys(['s', 'small'],\n                        {'embed_dims': 96,\n                         'depths':     [2, 2, 18,  2],\n                         'num_heads':  [3, 6, 12, 24]}),\n        **dict.fromkeys(['b', 'base'],\n                        {'embed_dims': 128,\n                         'depths':     [2, 2, 18,  2],\n                         'num_heads':  [4, 8, 16, 32]}),\n        **dict.fromkeys(['l', 'large'],\n                        {'embed_dims': 192,\n                         'depths':     [2,  2, 18,  2],\n                         'num_heads':  [6, 12, 24, 48]}),\n    }  # yapf: disable\n\n    def __init__(self,\n                 arch='T',\n                 img_size=224,\n                 in_channels=3,\n                 drop_rate=0.,\n                 drop_path_rate=0.1,\n                 frozen_stages=-1,\n                 use_abs_pos_embed=False,\n                 auto_pad=False,\n                 norm_cfg=dict(type='LN'),\n                 stage_cfgs=dict(),\n                 patch_cfg=dict(),\n                 init_cfg=None):\n        super(SwinTransformer, self).__init__(init_cfg)\n\n        if isinstance(arch, str):\n            arch = arch.lower()\n            assert arch in set(self.arch_zoo), \\\n                f'Arch {arch} is not in default archs {set(self.arch_zoo)}'\n            self.arch_settings = self.arch_zoo[arch]\n        else:\n            essential_keys = {'embed_dims', 'depths', 'num_head'}\n            assert isinstance(arch, dict) and set(arch) == essential_keys, \\\n                f'Custom arch needs a dict with keys {essential_keys}'\n            self.arch_settings = arch\n\n        self.embed_dims = self.arch_settings['embed_dims']\n        self.depths = self.arch_settings['depths']\n        self.num_heads = self.arch_settings['num_heads']\n        self.num_layers = len(self.depths)\n        self.use_abs_pos_embed = use_abs_pos_embed\n        self.auto_pad = auto_pad\n\n        _patch_cfg = dict(\n            img_size=img_size,\n            in_channels=in_channels,\n            embed_dims=self.embed_dims,\n            conv_cfg=dict(\n                type='Conv2d', kernel_size=4, stride=4, padding=0, dilation=1),\n            norm_cfg=dict(type='LN'),\n            **patch_cfg)\n        self.patch_embed = PatchEmbed(**_patch_cfg)\n        num_patches = self.patch_embed.num_patches\n        patches_resolution = self.patch_embed.patches_resolution\n        self.patches_resolution = patches_resolution\n\n        if self.use_abs_pos_embed:\n            self.absolute_pos_embed = nn.Parameter(\n                torch.zeros(1, num_patches, self.embed_dims))\n\n        self.drop_after_pos = nn.Dropout(p=drop_rate)\n\n        # stochastic depth\n        total_depth = sum(self.depths)\n        dpr = [\n            x.item() for x in torch.linspace(0, drop_path_rate, total_depth)\n        ]  # stochastic depth decay rule\n\n        self.stages = ModuleList()\n        embed_dims = self.embed_dims\n        input_resolution = patches_resolution\n        for i, (depth,\n                num_heads) in enumerate(zip(self.depths, self.num_heads)):\n            if isinstance(stage_cfgs, Sequence):\n                stage_cfg = stage_cfgs[i]\n            else:\n                stage_cfg = deepcopy(stage_cfgs)\n            downsample = True if i < self.num_layers - 1 else False\n            _stage_cfg = {\n                'embed_dims': embed_dims,\n                'depth': depth,\n                'num_heads': num_heads,\n                'downsample': downsample,\n                'input_resolution': input_resolution,\n                'drop_paths': dpr[:depth],\n                'auto_pad': auto_pad,\n                **stage_cfg\n            }\n\n            stage = SwinBlockSequence(**_stage_cfg)\n            # 冻结某几层frozen_stages\n            if(frozen_stages==0 or (i in range(0,frozen_stages))):\n                stage.eval()\n                for param in stage.parameters():\n                    param.requires_grad = False\n            \n            self.stages.append(stage)\n\n            dpr = dpr[depth:]\n            if downsample:\n                embed_dims = stage.downsample.out_channels\n                input_resolution = stage.downsample.output_resolution\n            \n\n        if norm_cfg is not None:\n            self.norm = build_norm_layer(norm_cfg, embed_dims)[1]\n        else:\n            self.norm = None\n\n    def init_weights(self):\n        super(SwinTransformer, self).init_weights()\n\n        if self.use_abs_pos_embed:\n            trunc_normal_(self.absolute_pos_embed, std=0.02)\n\n    def forward(self, x):\n        x = self.patch_embed(x)\n        if self.use_abs_pos_embed:\n            x = x + self.absolute_pos_embed\n        x = self.drop_after_pos(x)\n\n        for stage in self.stages:\n            x = stage(x)\n\n        x = self.norm(x) if self.norm else x\n\n        return x.transpose(1, 2)\n```\n\n","slug":"deep_learning/swin","published":1,"updated":"2022-01-18T08:10:17.051Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0ld00o5ast91rm9cy0z","content":"<blockquote>\n<p>swin_transformer的结构和代码实现部分，在此基础上添加freeze的相关操作，记录如下。</p>\n</blockquote>\n<h2 id=\"论文中的架构\">论文中的架构</h2>\n<p><img src=\"https://picture.mulindya.com/swin-pic1.png\" alt=\"\"></p>\n<h2 id=\"论文笔记\">论文笔记</h2>\n<details>\n<summary>Swin Transformer:Hierarchical Vision Transformer using Shifted Windows</summary>\n<iframe src=\"/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/Swin%20Transformer%20Hierarchical%20Vision%20Transformer%20using%20Shifted%20Windows.pdf\" width=\"100%\" height=\"650\"></iframe>\n</details>\n<h2 id=\"model架构\">model架构</h2>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">ImageClassifier(<br>  (backbone): SwinTransformer(<br>    (patch_embed): PatchEmbed(<br>      (projection): Conv2d(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">96</span>, kernel_size=(<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">4</span>), stride=(<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">4</span>))<br>      (norm): LayerNorm((<span class=\"hljs-number\">96</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>    )<br>    (drop_after_pos): Dropout(p=<span class=\"hljs-number\">0.0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>    (stages): ModuleList(<br>      (<span class=\"hljs-number\">0</span>): SwinBlockSequence(<br>        (blocks): ModuleList(<br>          (<span class=\"hljs-number\">0</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">96</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">288</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">96</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">96</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">96</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">1</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">96</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">288</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">96</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">96</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">96</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>        )<br>        (downsample): PatchMerging(<br>          (sampler): Unfold(kernel_size=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>), dilation=(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>), padding=(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>), stride=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>))<br>          (norm): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>          (reduction): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">192</span>, bias=<span class=\"hljs-literal\">False</span>)<br>        )<br>      )<br>      (<span class=\"hljs-number\">1</span>): SwinBlockSequence(<br>        (blocks): ModuleList(<br>          (<span class=\"hljs-number\">0</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">192</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">576</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">192</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">192</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">192</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">1</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">192</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">576</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">192</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">192</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">192</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>        )<br>        (downsample): PatchMerging(<br>          (sampler): Unfold(kernel_size=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>), dilation=(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>), padding=(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>), stride=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>))<br>          (norm): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>          (reduction): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">False</span>)<br>        )<br>      )<br>      (<span class=\"hljs-number\">2</span>): SwinBlockSequence(<br>        (blocks): ModuleList(<br>          (<span class=\"hljs-number\">0</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">1</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">2</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">3</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">4</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">5</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">6</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">7</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">8</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">9</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">10</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">11</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">12</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">13</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">14</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">15</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">16</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">17</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>        )<br>        (downsample): PatchMerging(<br>          (sampler): Unfold(kernel_size=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>), dilation=(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>), padding=(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>), stride=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>))<br>          (norm): LayerNorm((<span class=\"hljs-number\">1536</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>          (reduction): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">False</span>)<br>        )<br>      )<br>      (<span class=\"hljs-number\">3</span>): SwinBlockSequence(<br>        (blocks): ModuleList(<br>          (<span class=\"hljs-number\">0</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">2304</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">3072</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">3072</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">1</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">2304</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">3072</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">3072</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>        )<br>      )<br>    )<br>    (norm): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>  )<br>  (neck): GlobalAveragePooling(<br>    (gap): AdaptiveAvgPool1d(output_size=<span class=\"hljs-number\">1</span>)<br>  )<br>  (head): MultiLabelLinearClsHead(<br>    (compute_loss): CrossEntropyLoss()<br>    (fc): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">11</span>, bias=<span class=\"hljs-literal\">True</span>)<br>  )<br>)<br></code></pre></td></tr></tbody></table></figure>\n<h2 id=\"代码\">代码</h2>\n<p>添加fronzen_stages:</p>\n<blockquote>\n<p>该参数表示你想冻结前几个 stages 的权重，swin 结构包括 4 stage内部结构(2,2,18,2)</p>\n<p>frozen_stages=-1，表示全部可学习</p>\n<p>frozen_stage=0，表示stem权重固定</p>\n<p>frozen_stages=1，表示 stem 和第一个 stage 权重固定</p>\n<p>frozen_stages=2，表示 stem 和前两个 stage 权重固定</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">stage = SwinBlockSequence(**_stage_cfg)<br><span class=\"hljs-comment\"># 冻结某几层frozen_stages</span><br><span class=\"hljs-keyword\">if</span>(frozen_stages==<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">or</span> (i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>,frozen_stages))):<br>\tstage.<span class=\"hljs-built_in\">eval</span>()<br>\t<span class=\"hljs-keyword\">for</span> param <span class=\"hljs-keyword\">in</span> stage.parameters():<br>\t\tparam.requires_grad = <span class=\"hljs-literal\">False</span><br></code></pre></td></tr></tbody></table></figure>\n<p>全部代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> copy <span class=\"hljs-keyword\">import</span> deepcopy<br><span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">Sequence</span><br><br><span class=\"hljs-keyword\">import</span> torch<br><span class=\"hljs-keyword\">import</span> torch.nn <span class=\"hljs-keyword\">as</span> nn<br><span class=\"hljs-keyword\">from</span> mmcv.cnn <span class=\"hljs-keyword\">import</span> build_norm_layer<br><span class=\"hljs-keyword\">from</span> mmcv.cnn.bricks.transformer <span class=\"hljs-keyword\">import</span> FFN<br><span class=\"hljs-keyword\">from</span> mmcv.cnn.utils.weight_init <span class=\"hljs-keyword\">import</span> trunc_normal_<br><span class=\"hljs-keyword\">from</span> mmcv.runner.base_module <span class=\"hljs-keyword\">import</span> BaseModule, ModuleList<br><br><span class=\"hljs-keyword\">from</span> ..builder <span class=\"hljs-keyword\">import</span> BACKBONES<br><span class=\"hljs-keyword\">from</span> ..utils <span class=\"hljs-keyword\">import</span> PatchEmbed, PatchMerging, ShiftWindowMSA<br><span class=\"hljs-keyword\">from</span> .base_backbone <span class=\"hljs-keyword\">import</span> BaseBackbone<br><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SwinBlock</span>(<span class=\"hljs-params\">BaseModule</span>):</span><br>    <span class=\"hljs-string\">\"\"\"Swin Transformer block.</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">        embed_dims (int): Number of input channels.</span><br><span class=\"hljs-string\">        input_resolution (Tuple[int, int]): The resolution of the input feature</span><br><span class=\"hljs-string\">            map.</span><br><span class=\"hljs-string\">        num_heads (int): Number of attention heads.</span><br><span class=\"hljs-string\">        window_size (int, optional): The height and width of the window.</span><br><span class=\"hljs-string\">            Defaults to 7.</span><br><span class=\"hljs-string\">        shift (bool, optional): Shift the attention window or not.</span><br><span class=\"hljs-string\">            Defaults to False.</span><br><span class=\"hljs-string\">        ffn_ratio (float, optional): The expansion ratio of feedforward network</span><br><span class=\"hljs-string\">            hidden layer channels. Defaults to 4.</span><br><span class=\"hljs-string\">        drop_path (float, optional): The drop path rate after attention and</span><br><span class=\"hljs-string\">            ffn. Defaults to 0.</span><br><span class=\"hljs-string\">        attn_cfgs (dict, optional): The extra config of Shift Window-MSA.</span><br><span class=\"hljs-string\">            Defaults to empty dict.</span><br><span class=\"hljs-string\">        ffn_cfgs (dict, optional): The extra config of FFN.</span><br><span class=\"hljs-string\">            Defaults to empty dict.</span><br><span class=\"hljs-string\">        norm_cfg (dict, optional): The config of norm layers.</span><br><span class=\"hljs-string\">            Defaults to dict(type='LN').</span><br><span class=\"hljs-string\">        auto_pad (bool, optional): Auto pad the feature map to be divisible by</span><br><span class=\"hljs-string\">            window_size, Defaults to False.</span><br><span class=\"hljs-string\">        init_cfg (dict, optional): The extra config for initialization.</span><br><span class=\"hljs-string\">            Default: None.</span><br><span class=\"hljs-string\">    \"\"\"</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 embed_dims,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 input_resolution,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 num_heads,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 window_size=<span class=\"hljs-number\">7</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 shift=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 ffn_ratio=<span class=\"hljs-number\">4.</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 drop_path=<span class=\"hljs-number\">0.</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 attn_cfgs=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 ffn_cfgs=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 norm_cfg=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">'LN'</span></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 auto_pad=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 init_cfg=<span class=\"hljs-literal\">None</span></span>):</span><br><br>        <span class=\"hljs-built_in\">super</span>(SwinBlock, self).__init__(init_cfg)<br><br>        _attn_cfgs = {<br>            <span class=\"hljs-string\">'embed_dims'</span>: embed_dims,<br>            <span class=\"hljs-string\">'input_resolution'</span>: input_resolution,<br>            <span class=\"hljs-string\">'num_heads'</span>: num_heads,<br>            <span class=\"hljs-string\">'shift_size'</span>: window_size // <span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">if</span> shift <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span>,<br>            <span class=\"hljs-string\">'window_size'</span>: window_size,<br>            <span class=\"hljs-string\">'dropout_layer'</span>: <span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">'DropPath'</span>, drop_prob=drop_path),<br>            <span class=\"hljs-string\">'auto_pad'</span>: auto_pad,<br>            **attn_cfgs<br>        }<br>        self.norm1 = build_norm_layer(norm_cfg, embed_dims)[<span class=\"hljs-number\">1</span>]<br>        self.attn = ShiftWindowMSA(**_attn_cfgs)<br><br>        _ffn_cfgs = {<br>            <span class=\"hljs-string\">'embed_dims'</span>: embed_dims,<br>            <span class=\"hljs-string\">'feedforward_channels'</span>: <span class=\"hljs-built_in\">int</span>(embed_dims * ffn_ratio),<br>            <span class=\"hljs-string\">'num_fcs'</span>: <span class=\"hljs-number\">2</span>,<br>            <span class=\"hljs-string\">'ffn_drop'</span>: <span class=\"hljs-number\">0</span>,<br>            <span class=\"hljs-string\">'dropout_layer'</span>: <span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">'DropPath'</span>, drop_prob=drop_path),<br>            <span class=\"hljs-string\">'act_cfg'</span>: <span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">'GELU'</span>),<br>            **ffn_cfgs<br>        }<br>        self.norm2 = build_norm_layer(norm_cfg, embed_dims)[<span class=\"hljs-number\">1</span>]<br>        self.ffn = FFN(**_ffn_cfgs)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">forward</span>(<span class=\"hljs-params\">self, x</span>):</span><br>        identity = x<br>        x = self.norm1(x)<br>        x = self.attn(x)<br>        x = x + identity<br><br>        identity = x<br>        x = self.norm2(x)<br>        x = self.ffn(x, identity=identity)<br>        <span class=\"hljs-keyword\">return</span> x<br><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SwinBlockSequence</span>(<span class=\"hljs-params\">BaseModule</span>):</span><br>    <span class=\"hljs-string\">\"\"\"Module with successive Swin Transformer blocks and downsample layer.</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">        embed_dims (int): Number of input channels.</span><br><span class=\"hljs-string\">        input_resolution (Tuple[int, int]): The resolution of the input feature</span><br><span class=\"hljs-string\">            map.</span><br><span class=\"hljs-string\">        depth (int): Number of successive swin transformer blocks.</span><br><span class=\"hljs-string\">        num_heads (int): Number of attention heads.</span><br><span class=\"hljs-string\">        downsample (bool, optional): Downsample the output of blocks by patch</span><br><span class=\"hljs-string\">            merging. Defaults to False.</span><br><span class=\"hljs-string\">        downsample_cfg (dict, optional): The extra config of the patch merging</span><br><span class=\"hljs-string\">            layer. Defaults to empty dict.</span><br><span class=\"hljs-string\">        drop_paths (Sequence[float] | float, optional): The drop path rate in</span><br><span class=\"hljs-string\">            each block. Defaults to 0.</span><br><span class=\"hljs-string\">        block_cfgs (Sequence[dict] | dict, optional): The extra config of each</span><br><span class=\"hljs-string\">            block. Defaults to empty dicts.</span><br><span class=\"hljs-string\">        auto_pad (bool, optional): Auto pad the feature map to be divisible by</span><br><span class=\"hljs-string\">            window_size, Defaults to False.</span><br><span class=\"hljs-string\">        init_cfg (dict, optional): The extra config for initialization.</span><br><span class=\"hljs-string\">            Default: None.</span><br><span class=\"hljs-string\">    \"\"\"</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 embed_dims,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 input_resolution,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 depth,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 num_heads,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 downsample=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 downsample_cfg=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 drop_paths=<span class=\"hljs-number\">0.</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 block_cfgs=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 auto_pad=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 init_cfg=<span class=\"hljs-literal\">None</span></span>):</span><br>        <span class=\"hljs-built_in\">super</span>().__init__(init_cfg)<br><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">isinstance</span>(drop_paths, <span class=\"hljs-type\">Sequence</span>):<br>            drop_paths = [drop_paths] * depth<br><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">isinstance</span>(block_cfgs, <span class=\"hljs-type\">Sequence</span>):<br>            block_cfg = [deepcopy(block_cfgs) <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(depth)]<br><br>        self.blocks = ModuleList()<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(depth):<br>            _block_cfg = {<br>                <span class=\"hljs-string\">'embed_dims'</span>: embed_dims,<br>                <span class=\"hljs-string\">'input_resolution'</span>: input_resolution,<br>                <span class=\"hljs-string\">'num_heads'</span>: num_heads,<br>                <span class=\"hljs-string\">'shift'</span>: <span class=\"hljs-literal\">False</span> <span class=\"hljs-keyword\">if</span> i % <span class=\"hljs-number\">2</span> == <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">True</span>,<br>                <span class=\"hljs-string\">'drop_path'</span>: drop_paths[i],<br>                <span class=\"hljs-string\">'auto_pad'</span>: auto_pad,<br>                **block_cfg[i]<br>            }<br>            block = SwinBlock(**_block_cfg)<br>            self.blocks.append(block)<br><br>        <span class=\"hljs-keyword\">if</span> downsample:<br>            _downsample_cfg = {<br>                <span class=\"hljs-string\">'input_resolution'</span>: input_resolution,<br>                <span class=\"hljs-string\">'in_channels'</span>: embed_dims,<br>                <span class=\"hljs-string\">'expansion_ratio'</span>: <span class=\"hljs-number\">2</span>,<br>                <span class=\"hljs-string\">'norm_cfg'</span>: <span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">'LN'</span>),<br>                **downsample_cfg<br>            }<br>            self.downsample = PatchMerging(**_downsample_cfg)<br>        <span class=\"hljs-keyword\">else</span>:<br>            self.downsample = <span class=\"hljs-literal\">None</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">forward</span>(<span class=\"hljs-params\">self, x</span>):</span><br>        <span class=\"hljs-keyword\">for</span> block <span class=\"hljs-keyword\">in</span> self.blocks:<br>            x = block(x)<br><br>        <span class=\"hljs-keyword\">if</span> self.downsample:<br>            x = self.downsample(x)<br>        <span class=\"hljs-keyword\">return</span> x<br><br><br><span class=\"hljs-meta\">@BACKBONES.register_module()</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SwinTransformer</span>(<span class=\"hljs-params\">BaseBackbone</span>):</span><br>    <span class=\"hljs-string\">\"\"\" Swin Transformer</span><br><span class=\"hljs-string\">    A PyTorch implement of : `Swin Transformer:</span><br><span class=\"hljs-string\">    Hierarchical Vision Transformer using Shifted Windows`  -</span><br><span class=\"hljs-string\">        https://arxiv.org/abs/2103.14030</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Inspiration from</span><br><span class=\"hljs-string\">    https://github.com/microsoft/Swin-Transformer</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">        arch (str | dict): Swin Transformer architecture</span><br><span class=\"hljs-string\">            Defaults to 'T'.</span><br><span class=\"hljs-string\">        img_size (int | tuple): The size of input image.</span><br><span class=\"hljs-string\">            Defaults to 224.</span><br><span class=\"hljs-string\">        in_channels (int): The num of input channels.</span><br><span class=\"hljs-string\">            Defaults to 3.</span><br><span class=\"hljs-string\">        drop_rate (float): Dropout rate after embedding.</span><br><span class=\"hljs-string\">            Defaults to 0.</span><br><span class=\"hljs-string\">        drop_path_rate (float): Stochastic depth rate.</span><br><span class=\"hljs-string\">            Defaults to 0.1.</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">        # add attr</span><br><span class=\"hljs-string\">        frozen_stages: defaults-1 dont freeze,0: all freeze,other: frozen_stages stages to freeze</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">        use_abs_pos_embed (bool): If True, add absolute position embedding to</span><br><span class=\"hljs-string\">            the patch embedding. Defaults to False.</span><br><span class=\"hljs-string\">        auto_pad (bool): If True, auto pad feature map to fit window_size.</span><br><span class=\"hljs-string\">            Defaults to False.</span><br><span class=\"hljs-string\">        norm_cfg (dict, optional): Config dict for normalization layer at end</span><br><span class=\"hljs-string\">            of backone. Defaults to dict(type='LN')</span><br><span class=\"hljs-string\">        stage_cfgs (Sequence | dict, optional): Extra config dict for each</span><br><span class=\"hljs-string\">            stage. Defaults to empty dict.</span><br><span class=\"hljs-string\">        patch_cfg (dict, optional): Extra config dict for patch embedding.</span><br><span class=\"hljs-string\">            Defaults to empty dict.</span><br><span class=\"hljs-string\">        init_cfg (dict, optional): The Config for initialization.</span><br><span class=\"hljs-string\">            Defaults to None.</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Examples:</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; from mmcls.models import SwinTransformer</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; import torch</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; extra_config = dict(</span><br><span class=\"hljs-string\">        &gt;&gt;&gt;     arch='tiny',</span><br><span class=\"hljs-string\">        &gt;&gt;&gt;     stage_cfgs=dict(downsample_cfg={'kernel_size': 3,</span><br><span class=\"hljs-string\">        &gt;&gt;&gt;                                     'expansion_ratio': 3}),</span><br><span class=\"hljs-string\">        &gt;&gt;&gt;     auto_pad=True)</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; self = SwinTransformer(**extra_config)</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; inputs = torch.rand(1, 3, 224, 224)</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; output = self.forward(inputs)</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; print(output.shape)</span><br><span class=\"hljs-string\">        (1, 2592, 4)</span><br><span class=\"hljs-string\">    \"\"\"</span><br>    arch_zoo = {<br>        **<span class=\"hljs-built_in\">dict</span>.fromkeys([<span class=\"hljs-string\">'t'</span>, <span class=\"hljs-string\">'tiny'</span>],<br>                        {<span class=\"hljs-string\">'embed_dims'</span>: <span class=\"hljs-number\">96</span>,<br>                         <span class=\"hljs-string\">'depths'</span>:     [<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>,  <span class=\"hljs-number\">6</span>,  <span class=\"hljs-number\">2</span>],<br>                         <span class=\"hljs-string\">'num_heads'</span>:  [<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">24</span>]}),<br>        **<span class=\"hljs-built_in\">dict</span>.fromkeys([<span class=\"hljs-string\">'s'</span>, <span class=\"hljs-string\">'small'</span>],<br>                        {<span class=\"hljs-string\">'embed_dims'</span>: <span class=\"hljs-number\">96</span>,<br>                         <span class=\"hljs-string\">'depths'</span>:     [<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">18</span>,  <span class=\"hljs-number\">2</span>],<br>                         <span class=\"hljs-string\">'num_heads'</span>:  [<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">24</span>]}),<br>        **<span class=\"hljs-built_in\">dict</span>.fromkeys([<span class=\"hljs-string\">'b'</span>, <span class=\"hljs-string\">'base'</span>],<br>                        {<span class=\"hljs-string\">'embed_dims'</span>: <span class=\"hljs-number\">128</span>,<br>                         <span class=\"hljs-string\">'depths'</span>:     [<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">18</span>,  <span class=\"hljs-number\">2</span>],<br>                         <span class=\"hljs-string\">'num_heads'</span>:  [<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">32</span>]}),<br>        **<span class=\"hljs-built_in\">dict</span>.fromkeys([<span class=\"hljs-string\">'l'</span>, <span class=\"hljs-string\">'large'</span>],<br>                        {<span class=\"hljs-string\">'embed_dims'</span>: <span class=\"hljs-number\">192</span>,<br>                         <span class=\"hljs-string\">'depths'</span>:     [<span class=\"hljs-number\">2</span>,  <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">18</span>,  <span class=\"hljs-number\">2</span>],<br>                         <span class=\"hljs-string\">'num_heads'</span>:  [<span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">24</span>, <span class=\"hljs-number\">48</span>]}),<br>    }  <span class=\"hljs-comment\"># yapf: disable</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 arch=<span class=\"hljs-string\">'T'</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 img_size=<span class=\"hljs-number\">224</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 in_channels=<span class=\"hljs-number\">3</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 drop_rate=<span class=\"hljs-number\">0.</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 drop_path_rate=<span class=\"hljs-number\">0.1</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 frozen_stages=-<span class=\"hljs-number\">1</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 use_abs_pos_embed=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 auto_pad=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 norm_cfg=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">'LN'</span></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 stage_cfgs=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 patch_cfg=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 init_cfg=<span class=\"hljs-literal\">None</span></span>):</span><br>        <span class=\"hljs-built_in\">super</span>(SwinTransformer, self).__init__(init_cfg)<br><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(arch, <span class=\"hljs-built_in\">str</span>):<br>            arch = arch.lower()<br>            <span class=\"hljs-keyword\">assert</span> arch <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span>(self.arch_zoo), \\<br>                <span class=\"hljs-string\">f'Arch <span class=\"hljs-subst\">{arch}</span> is not in default archs <span class=\"hljs-subst\">{<span class=\"hljs-built_in\">set</span>(self.arch_zoo)}</span>'</span><br>            self.arch_settings = self.arch_zoo[arch]<br>        <span class=\"hljs-keyword\">else</span>:<br>            essential_keys = {<span class=\"hljs-string\">'embed_dims'</span>, <span class=\"hljs-string\">'depths'</span>, <span class=\"hljs-string\">'num_head'</span>}<br>            <span class=\"hljs-keyword\">assert</span> <span class=\"hljs-built_in\">isinstance</span>(arch, <span class=\"hljs-built_in\">dict</span>) <span class=\"hljs-keyword\">and</span> <span class=\"hljs-built_in\">set</span>(arch) == essential_keys, \\<br>                <span class=\"hljs-string\">f'Custom arch needs a dict with keys <span class=\"hljs-subst\">{essential_keys}</span>'</span><br>            self.arch_settings = arch<br><br>        self.embed_dims = self.arch_settings[<span class=\"hljs-string\">'embed_dims'</span>]<br>        self.depths = self.arch_settings[<span class=\"hljs-string\">'depths'</span>]<br>        self.num_heads = self.arch_settings[<span class=\"hljs-string\">'num_heads'</span>]<br>        self.num_layers = <span class=\"hljs-built_in\">len</span>(self.depths)<br>        self.use_abs_pos_embed = use_abs_pos_embed<br>        self.auto_pad = auto_pad<br><br>        _patch_cfg = <span class=\"hljs-built_in\">dict</span>(<br>            img_size=img_size,<br>            in_channels=in_channels,<br>            embed_dims=self.embed_dims,<br>            conv_cfg=<span class=\"hljs-built_in\">dict</span>(<br>                <span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">'Conv2d'</span>, kernel_size=<span class=\"hljs-number\">4</span>, stride=<span class=\"hljs-number\">4</span>, padding=<span class=\"hljs-number\">0</span>, dilation=<span class=\"hljs-number\">1</span>),<br>            norm_cfg=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">'LN'</span>),<br>            **patch_cfg)<br>        self.patch_embed = PatchEmbed(**_patch_cfg)<br>        num_patches = self.patch_embed.num_patches<br>        patches_resolution = self.patch_embed.patches_resolution<br>        self.patches_resolution = patches_resolution<br><br>        <span class=\"hljs-keyword\">if</span> self.use_abs_pos_embed:<br>            self.absolute_pos_embed = nn.Parameter(<br>                torch.zeros(<span class=\"hljs-number\">1</span>, num_patches, self.embed_dims))<br><br>        self.drop_after_pos = nn.Dropout(p=drop_rate)<br><br>        <span class=\"hljs-comment\"># stochastic depth</span><br>        total_depth = <span class=\"hljs-built_in\">sum</span>(self.depths)<br>        dpr = [<br>            x.item() <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> torch.linspace(<span class=\"hljs-number\">0</span>, drop_path_rate, total_depth)<br>        ]  <span class=\"hljs-comment\"># stochastic depth decay rule</span><br><br>        self.stages = ModuleList()<br>        embed_dims = self.embed_dims<br>        input_resolution = patches_resolution<br>        <span class=\"hljs-keyword\">for</span> i, (depth,<br>                num_heads) <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(<span class=\"hljs-built_in\">zip</span>(self.depths, self.num_heads)):<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(stage_cfgs, <span class=\"hljs-type\">Sequence</span>):<br>                stage_cfg = stage_cfgs[i]<br>            <span class=\"hljs-keyword\">else</span>:<br>                stage_cfg = deepcopy(stage_cfgs)<br>            downsample = <span class=\"hljs-literal\">True</span> <span class=\"hljs-keyword\">if</span> i &lt; self.num_layers - <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">False</span><br>            _stage_cfg = {<br>                <span class=\"hljs-string\">'embed_dims'</span>: embed_dims,<br>                <span class=\"hljs-string\">'depth'</span>: depth,<br>                <span class=\"hljs-string\">'num_heads'</span>: num_heads,<br>                <span class=\"hljs-string\">'downsample'</span>: downsample,<br>                <span class=\"hljs-string\">'input_resolution'</span>: input_resolution,<br>                <span class=\"hljs-string\">'drop_paths'</span>: dpr[:depth],<br>                <span class=\"hljs-string\">'auto_pad'</span>: auto_pad,<br>                **stage_cfg<br>            }<br><br>            stage = SwinBlockSequence(**_stage_cfg)<br>            <span class=\"hljs-comment\"># 冻结某几层frozen_stages</span><br>            <span class=\"hljs-keyword\">if</span>(frozen_stages==<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">or</span> (i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>,frozen_stages))):<br>                stage.<span class=\"hljs-built_in\">eval</span>()<br>                <span class=\"hljs-keyword\">for</span> param <span class=\"hljs-keyword\">in</span> stage.parameters():<br>                    param.requires_grad = <span class=\"hljs-literal\">False</span><br>            <br>            self.stages.append(stage)<br><br>            dpr = dpr[depth:]<br>            <span class=\"hljs-keyword\">if</span> downsample:<br>                embed_dims = stage.downsample.out_channels<br>                input_resolution = stage.downsample.output_resolution<br>            <br><br>        <span class=\"hljs-keyword\">if</span> norm_cfg <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span>:<br>            self.norm = build_norm_layer(norm_cfg, embed_dims)[<span class=\"hljs-number\">1</span>]<br>        <span class=\"hljs-keyword\">else</span>:<br>            self.norm = <span class=\"hljs-literal\">None</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">init_weights</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-built_in\">super</span>(SwinTransformer, self).init_weights()<br><br>        <span class=\"hljs-keyword\">if</span> self.use_abs_pos_embed:<br>            trunc_normal_(self.absolute_pos_embed, std=<span class=\"hljs-number\">0.02</span>)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">forward</span>(<span class=\"hljs-params\">self, x</span>):</span><br>        x = self.patch_embed(x)<br>        <span class=\"hljs-keyword\">if</span> self.use_abs_pos_embed:<br>            x = x + self.absolute_pos_embed<br>        x = self.drop_after_pos(x)<br><br>        <span class=\"hljs-keyword\">for</span> stage <span class=\"hljs-keyword\">in</span> self.stages:<br>            x = stage(x)<br><br>        x = self.norm(x) <span class=\"hljs-keyword\">if</span> self.norm <span class=\"hljs-keyword\">else</span> x<br><br>        <span class=\"hljs-keyword\">return</span> x.transpose(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>)<br></code></pre></td></tr></tbody></table></figure>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>swin_transformer的结构和代码实现部分，在此基础上添加freeze的相关操作，记录如下。</p>\n</blockquote>\n<h2 id=\"论文中的架构\">论文中的架构</h2>\n<p><img src=\"https://picture.mulindya.com/swin-pic1.png\" alt=\"\"></p>\n<h2 id=\"论文笔记\">论文笔记</h2>\n<details>\n<summary>Swin Transformer:Hierarchical Vision Transformer using Shifted Windows</summary>\n<iframe src='/js/pdfjs_old/web/viewer.html?file=https://paper.mulindya.com/Swin%20Transformer%20Hierarchical%20Vision%20Transformer%20using%20Shifted%20Windows.pdf' width=100% height=650></iframe>\n</details>\n<h2 id=\"model架构\">model架构</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">ImageClassifier(<br>  (backbone): SwinTransformer(<br>    (patch_embed): PatchEmbed(<br>      (projection): Conv2d(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">96</span>, kernel_size=(<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">4</span>), stride=(<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">4</span>))<br>      (norm): LayerNorm((<span class=\"hljs-number\">96</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>    )<br>    (drop_after_pos): Dropout(p=<span class=\"hljs-number\">0.0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>    (stages): ModuleList(<br>      (<span class=\"hljs-number\">0</span>): SwinBlockSequence(<br>        (blocks): ModuleList(<br>          (<span class=\"hljs-number\">0</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">96</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">288</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">96</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">96</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">96</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">1</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">96</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">288</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">96</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">96</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">96</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">96</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>        )<br>        (downsample): PatchMerging(<br>          (sampler): Unfold(kernel_size=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>), dilation=(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>), padding=(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>), stride=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>))<br>          (norm): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>          (reduction): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">192</span>, bias=<span class=\"hljs-literal\">False</span>)<br>        )<br>      )<br>      (<span class=\"hljs-number\">1</span>): SwinBlockSequence(<br>        (blocks): ModuleList(<br>          (<span class=\"hljs-number\">0</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">192</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">576</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">192</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">192</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">192</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">1</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">192</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">576</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">192</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">192</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">192</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">192</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>        )<br>        (downsample): PatchMerging(<br>          (sampler): Unfold(kernel_size=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>), dilation=(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>), padding=(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>), stride=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>))<br>          (norm): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>          (reduction): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">False</span>)<br>        )<br>      )<br>      (<span class=\"hljs-number\">2</span>): SwinBlockSequence(<br>        (blocks): ModuleList(<br>          (<span class=\"hljs-number\">0</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">1</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">2</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">3</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">4</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">5</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">6</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">7</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">8</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">9</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">10</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">11</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">12</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">13</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">14</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">15</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">16</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">17</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1152</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">384</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">384</span>, out_features=<span class=\"hljs-number\">1536</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">384</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>        )<br>        (downsample): PatchMerging(<br>          (sampler): Unfold(kernel_size=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>), dilation=(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>), padding=(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>), stride=(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>))<br>          (norm): LayerNorm((<span class=\"hljs-number\">1536</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>          (reduction): Linear(in_features=<span class=\"hljs-number\">1536</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">False</span>)<br>        )<br>      )<br>      (<span class=\"hljs-number\">3</span>): SwinBlockSequence(<br>        (blocks): ModuleList(<br>          (<span class=\"hljs-number\">0</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">2304</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">3072</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">3072</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>          (<span class=\"hljs-number\">1</span>): SwinBlock(<br>            (norm1): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (attn): ShiftWindowMSA(<br>              (w_msa): WindowMSA(<br>                (qkv): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">2304</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (attn_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (proj): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (proj_drop): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                (softmax): Softmax(dim=-<span class=\"hljs-number\">1</span>)<br>              )<br>              (drop): DropPath()<br>            )<br>            (norm2): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>            (ffn): FFN(<br>              (activate): GELU()<br>              (layers): Sequential(<br>                (<span class=\"hljs-number\">0</span>): Sequential(<br>                  (<span class=\"hljs-number\">0</span>): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">3072</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                  (<span class=\"hljs-number\">1</span>): GELU()<br>                  (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>                )<br>                (<span class=\"hljs-number\">1</span>): Linear(in_features=<span class=\"hljs-number\">3072</span>, out_features=<span class=\"hljs-number\">768</span>, bias=<span class=\"hljs-literal\">True</span>)<br>                (<span class=\"hljs-number\">2</span>): Dropout(p=<span class=\"hljs-number\">0</span>, inplace=<span class=\"hljs-literal\">False</span>)<br>              )<br>              (dropout_layer): DropPath()<br>            )<br>          )<br>        )<br>      )<br>    )<br>    (norm): LayerNorm((<span class=\"hljs-number\">768</span>,), eps=<span class=\"hljs-number\">1e-05</span>, elementwise_affine=<span class=\"hljs-literal\">True</span>)<br>  )<br>  (neck): GlobalAveragePooling(<br>    (gap): AdaptiveAvgPool1d(output_size=<span class=\"hljs-number\">1</span>)<br>  )<br>  (head): MultiLabelLinearClsHead(<br>    (compute_loss): CrossEntropyLoss()<br>    (fc): Linear(in_features=<span class=\"hljs-number\">768</span>, out_features=<span class=\"hljs-number\">11</span>, bias=<span class=\"hljs-literal\">True</span>)<br>  )<br>)<br></code></pre></td></tr></table></figure>\n<h2 id=\"代码\">代码</h2>\n<p>添加fronzen_stages:</p>\n<blockquote>\n<p>该参数表示你想冻结前几个 stages 的权重，swin 结构包括 4 stage内部结构(2,2,18,2)</p>\n<p>frozen_stages=-1，表示全部可学习</p>\n<p>frozen_stage=0，表示stem权重固定</p>\n<p>frozen_stages=1，表示 stem 和第一个 stage 权重固定</p>\n<p>frozen_stages=2，表示 stem 和前两个 stage 权重固定</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\">stage = SwinBlockSequence(**_stage_cfg)<br><span class=\"hljs-comment\"># 冻结某几层frozen_stages</span><br><span class=\"hljs-keyword\">if</span>(frozen_stages==<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">or</span> (i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>,frozen_stages))):<br>\tstage.<span class=\"hljs-built_in\">eval</span>()<br>\t<span class=\"hljs-keyword\">for</span> param <span class=\"hljs-keyword\">in</span> stage.parameters():<br>\t\tparam.requires_grad = <span class=\"hljs-literal\">False</span><br></code></pre></td></tr></table></figure>\n<p>全部代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> copy <span class=\"hljs-keyword\">import</span> deepcopy<br><span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">Sequence</span><br><br><span class=\"hljs-keyword\">import</span> torch<br><span class=\"hljs-keyword\">import</span> torch.nn <span class=\"hljs-keyword\">as</span> nn<br><span class=\"hljs-keyword\">from</span> mmcv.cnn <span class=\"hljs-keyword\">import</span> build_norm_layer<br><span class=\"hljs-keyword\">from</span> mmcv.cnn.bricks.transformer <span class=\"hljs-keyword\">import</span> FFN<br><span class=\"hljs-keyword\">from</span> mmcv.cnn.utils.weight_init <span class=\"hljs-keyword\">import</span> trunc_normal_<br><span class=\"hljs-keyword\">from</span> mmcv.runner.base_module <span class=\"hljs-keyword\">import</span> BaseModule, ModuleList<br><br><span class=\"hljs-keyword\">from</span> ..builder <span class=\"hljs-keyword\">import</span> BACKBONES<br><span class=\"hljs-keyword\">from</span> ..utils <span class=\"hljs-keyword\">import</span> PatchEmbed, PatchMerging, ShiftWindowMSA<br><span class=\"hljs-keyword\">from</span> .base_backbone <span class=\"hljs-keyword\">import</span> BaseBackbone<br><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SwinBlock</span>(<span class=\"hljs-params\">BaseModule</span>):</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;Swin Transformer block.</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">        embed_dims (int): Number of input channels.</span><br><span class=\"hljs-string\">        input_resolution (Tuple[int, int]): The resolution of the input feature</span><br><span class=\"hljs-string\">            map.</span><br><span class=\"hljs-string\">        num_heads (int): Number of attention heads.</span><br><span class=\"hljs-string\">        window_size (int, optional): The height and width of the window.</span><br><span class=\"hljs-string\">            Defaults to 7.</span><br><span class=\"hljs-string\">        shift (bool, optional): Shift the attention window or not.</span><br><span class=\"hljs-string\">            Defaults to False.</span><br><span class=\"hljs-string\">        ffn_ratio (float, optional): The expansion ratio of feedforward network</span><br><span class=\"hljs-string\">            hidden layer channels. Defaults to 4.</span><br><span class=\"hljs-string\">        drop_path (float, optional): The drop path rate after attention and</span><br><span class=\"hljs-string\">            ffn. Defaults to 0.</span><br><span class=\"hljs-string\">        attn_cfgs (dict, optional): The extra config of Shift Window-MSA.</span><br><span class=\"hljs-string\">            Defaults to empty dict.</span><br><span class=\"hljs-string\">        ffn_cfgs (dict, optional): The extra config of FFN.</span><br><span class=\"hljs-string\">            Defaults to empty dict.</span><br><span class=\"hljs-string\">        norm_cfg (dict, optional): The config of norm layers.</span><br><span class=\"hljs-string\">            Defaults to dict(type=&#x27;LN&#x27;).</span><br><span class=\"hljs-string\">        auto_pad (bool, optional): Auto pad the feature map to be divisible by</span><br><span class=\"hljs-string\">            window_size, Defaults to False.</span><br><span class=\"hljs-string\">        init_cfg (dict, optional): The extra config for initialization.</span><br><span class=\"hljs-string\">            Default: None.</span><br><span class=\"hljs-string\">    &quot;&quot;&quot;</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 embed_dims,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 input_resolution,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 num_heads,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 window_size=<span class=\"hljs-number\">7</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 shift=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 ffn_ratio=<span class=\"hljs-number\">4.</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 drop_path=<span class=\"hljs-number\">0.</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 attn_cfgs=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 ffn_cfgs=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 norm_cfg=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">&#x27;LN&#x27;</span></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 auto_pad=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 init_cfg=<span class=\"hljs-literal\">None</span></span>):</span><br><br>        <span class=\"hljs-built_in\">super</span>(SwinBlock, self).__init__(init_cfg)<br><br>        _attn_cfgs = &#123;<br>            <span class=\"hljs-string\">&#x27;embed_dims&#x27;</span>: embed_dims,<br>            <span class=\"hljs-string\">&#x27;input_resolution&#x27;</span>: input_resolution,<br>            <span class=\"hljs-string\">&#x27;num_heads&#x27;</span>: num_heads,<br>            <span class=\"hljs-string\">&#x27;shift_size&#x27;</span>: window_size // <span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">if</span> shift <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">0</span>,<br>            <span class=\"hljs-string\">&#x27;window_size&#x27;</span>: window_size,<br>            <span class=\"hljs-string\">&#x27;dropout_layer&#x27;</span>: <span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">&#x27;DropPath&#x27;</span>, drop_prob=drop_path),<br>            <span class=\"hljs-string\">&#x27;auto_pad&#x27;</span>: auto_pad,<br>            **attn_cfgs<br>        &#125;<br>        self.norm1 = build_norm_layer(norm_cfg, embed_dims)[<span class=\"hljs-number\">1</span>]<br>        self.attn = ShiftWindowMSA(**_attn_cfgs)<br><br>        _ffn_cfgs = &#123;<br>            <span class=\"hljs-string\">&#x27;embed_dims&#x27;</span>: embed_dims,<br>            <span class=\"hljs-string\">&#x27;feedforward_channels&#x27;</span>: <span class=\"hljs-built_in\">int</span>(embed_dims * ffn_ratio),<br>            <span class=\"hljs-string\">&#x27;num_fcs&#x27;</span>: <span class=\"hljs-number\">2</span>,<br>            <span class=\"hljs-string\">&#x27;ffn_drop&#x27;</span>: <span class=\"hljs-number\">0</span>,<br>            <span class=\"hljs-string\">&#x27;dropout_layer&#x27;</span>: <span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">&#x27;DropPath&#x27;</span>, drop_prob=drop_path),<br>            <span class=\"hljs-string\">&#x27;act_cfg&#x27;</span>: <span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">&#x27;GELU&#x27;</span>),<br>            **ffn_cfgs<br>        &#125;<br>        self.norm2 = build_norm_layer(norm_cfg, embed_dims)[<span class=\"hljs-number\">1</span>]<br>        self.ffn = FFN(**_ffn_cfgs)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">forward</span>(<span class=\"hljs-params\">self, x</span>):</span><br>        identity = x<br>        x = self.norm1(x)<br>        x = self.attn(x)<br>        x = x + identity<br><br>        identity = x<br>        x = self.norm2(x)<br>        x = self.ffn(x, identity=identity)<br>        <span class=\"hljs-keyword\">return</span> x<br><br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SwinBlockSequence</span>(<span class=\"hljs-params\">BaseModule</span>):</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;Module with successive Swin Transformer blocks and downsample layer.</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">        embed_dims (int): Number of input channels.</span><br><span class=\"hljs-string\">        input_resolution (Tuple[int, int]): The resolution of the input feature</span><br><span class=\"hljs-string\">            map.</span><br><span class=\"hljs-string\">        depth (int): Number of successive swin transformer blocks.</span><br><span class=\"hljs-string\">        num_heads (int): Number of attention heads.</span><br><span class=\"hljs-string\">        downsample (bool, optional): Downsample the output of blocks by patch</span><br><span class=\"hljs-string\">            merging. Defaults to False.</span><br><span class=\"hljs-string\">        downsample_cfg (dict, optional): The extra config of the patch merging</span><br><span class=\"hljs-string\">            layer. Defaults to empty dict.</span><br><span class=\"hljs-string\">        drop_paths (Sequence[float] | float, optional): The drop path rate in</span><br><span class=\"hljs-string\">            each block. Defaults to 0.</span><br><span class=\"hljs-string\">        block_cfgs (Sequence[dict] | dict, optional): The extra config of each</span><br><span class=\"hljs-string\">            block. Defaults to empty dicts.</span><br><span class=\"hljs-string\">        auto_pad (bool, optional): Auto pad the feature map to be divisible by</span><br><span class=\"hljs-string\">            window_size, Defaults to False.</span><br><span class=\"hljs-string\">        init_cfg (dict, optional): The extra config for initialization.</span><br><span class=\"hljs-string\">            Default: None.</span><br><span class=\"hljs-string\">    &quot;&quot;&quot;</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 embed_dims,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 input_resolution,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 depth,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 num_heads,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 downsample=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 downsample_cfg=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 drop_paths=<span class=\"hljs-number\">0.</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 block_cfgs=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 auto_pad=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 init_cfg=<span class=\"hljs-literal\">None</span></span>):</span><br>        <span class=\"hljs-built_in\">super</span>().__init__(init_cfg)<br><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">isinstance</span>(drop_paths, <span class=\"hljs-type\">Sequence</span>):<br>            drop_paths = [drop_paths] * depth<br><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">isinstance</span>(block_cfgs, <span class=\"hljs-type\">Sequence</span>):<br>            block_cfg = [deepcopy(block_cfgs) <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(depth)]<br><br>        self.blocks = ModuleList()<br>        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(depth):<br>            _block_cfg = &#123;<br>                <span class=\"hljs-string\">&#x27;embed_dims&#x27;</span>: embed_dims,<br>                <span class=\"hljs-string\">&#x27;input_resolution&#x27;</span>: input_resolution,<br>                <span class=\"hljs-string\">&#x27;num_heads&#x27;</span>: num_heads,<br>                <span class=\"hljs-string\">&#x27;shift&#x27;</span>: <span class=\"hljs-literal\">False</span> <span class=\"hljs-keyword\">if</span> i % <span class=\"hljs-number\">2</span> == <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">True</span>,<br>                <span class=\"hljs-string\">&#x27;drop_path&#x27;</span>: drop_paths[i],<br>                <span class=\"hljs-string\">&#x27;auto_pad&#x27;</span>: auto_pad,<br>                **block_cfg[i]<br>            &#125;<br>            block = SwinBlock(**_block_cfg)<br>            self.blocks.append(block)<br><br>        <span class=\"hljs-keyword\">if</span> downsample:<br>            _downsample_cfg = &#123;<br>                <span class=\"hljs-string\">&#x27;input_resolution&#x27;</span>: input_resolution,<br>                <span class=\"hljs-string\">&#x27;in_channels&#x27;</span>: embed_dims,<br>                <span class=\"hljs-string\">&#x27;expansion_ratio&#x27;</span>: <span class=\"hljs-number\">2</span>,<br>                <span class=\"hljs-string\">&#x27;norm_cfg&#x27;</span>: <span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">&#x27;LN&#x27;</span>),<br>                **downsample_cfg<br>            &#125;<br>            self.downsample = PatchMerging(**_downsample_cfg)<br>        <span class=\"hljs-keyword\">else</span>:<br>            self.downsample = <span class=\"hljs-literal\">None</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">forward</span>(<span class=\"hljs-params\">self, x</span>):</span><br>        <span class=\"hljs-keyword\">for</span> block <span class=\"hljs-keyword\">in</span> self.blocks:<br>            x = block(x)<br><br>        <span class=\"hljs-keyword\">if</span> self.downsample:<br>            x = self.downsample(x)<br>        <span class=\"hljs-keyword\">return</span> x<br><br><br><span class=\"hljs-meta\">@BACKBONES.register_module()</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SwinTransformer</span>(<span class=\"hljs-params\">BaseBackbone</span>):</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot; Swin Transformer</span><br><span class=\"hljs-string\">    A PyTorch implement of : `Swin Transformer:</span><br><span class=\"hljs-string\">    Hierarchical Vision Transformer using Shifted Windows`  -</span><br><span class=\"hljs-string\">        https://arxiv.org/abs/2103.14030</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Inspiration from</span><br><span class=\"hljs-string\">    https://github.com/microsoft/Swin-Transformer</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">        arch (str | dict): Swin Transformer architecture</span><br><span class=\"hljs-string\">            Defaults to &#x27;T&#x27;.</span><br><span class=\"hljs-string\">        img_size (int | tuple): The size of input image.</span><br><span class=\"hljs-string\">            Defaults to 224.</span><br><span class=\"hljs-string\">        in_channels (int): The num of input channels.</span><br><span class=\"hljs-string\">            Defaults to 3.</span><br><span class=\"hljs-string\">        drop_rate (float): Dropout rate after embedding.</span><br><span class=\"hljs-string\">            Defaults to 0.</span><br><span class=\"hljs-string\">        drop_path_rate (float): Stochastic depth rate.</span><br><span class=\"hljs-string\">            Defaults to 0.1.</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">        # add attr</span><br><span class=\"hljs-string\">        frozen_stages: defaults-1 dont freeze,0: all freeze,other: frozen_stages stages to freeze</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">        use_abs_pos_embed (bool): If True, add absolute position embedding to</span><br><span class=\"hljs-string\">            the patch embedding. Defaults to False.</span><br><span class=\"hljs-string\">        auto_pad (bool): If True, auto pad feature map to fit window_size.</span><br><span class=\"hljs-string\">            Defaults to False.</span><br><span class=\"hljs-string\">        norm_cfg (dict, optional): Config dict for normalization layer at end</span><br><span class=\"hljs-string\">            of backone. Defaults to dict(type=&#x27;LN&#x27;)</span><br><span class=\"hljs-string\">        stage_cfgs (Sequence | dict, optional): Extra config dict for each</span><br><span class=\"hljs-string\">            stage. Defaults to empty dict.</span><br><span class=\"hljs-string\">        patch_cfg (dict, optional): Extra config dict for patch embedding.</span><br><span class=\"hljs-string\">            Defaults to empty dict.</span><br><span class=\"hljs-string\">        init_cfg (dict, optional): The Config for initialization.</span><br><span class=\"hljs-string\">            Defaults to None.</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">    Examples:</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; from mmcls.models import SwinTransformer</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; import torch</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; extra_config = dict(</span><br><span class=\"hljs-string\">        &gt;&gt;&gt;     arch=&#x27;tiny&#x27;,</span><br><span class=\"hljs-string\">        &gt;&gt;&gt;     stage_cfgs=dict(downsample_cfg=&#123;&#x27;kernel_size&#x27;: 3,</span><br><span class=\"hljs-string\">        &gt;&gt;&gt;                                     &#x27;expansion_ratio&#x27;: 3&#125;),</span><br><span class=\"hljs-string\">        &gt;&gt;&gt;     auto_pad=True)</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; self = SwinTransformer(**extra_config)</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; inputs = torch.rand(1, 3, 224, 224)</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; output = self.forward(inputs)</span><br><span class=\"hljs-string\">        &gt;&gt;&gt; print(output.shape)</span><br><span class=\"hljs-string\">        (1, 2592, 4)</span><br><span class=\"hljs-string\">    &quot;&quot;&quot;</span><br>    arch_zoo = &#123;<br>        **<span class=\"hljs-built_in\">dict</span>.fromkeys([<span class=\"hljs-string\">&#x27;t&#x27;</span>, <span class=\"hljs-string\">&#x27;tiny&#x27;</span>],<br>                        &#123;<span class=\"hljs-string\">&#x27;embed_dims&#x27;</span>: <span class=\"hljs-number\">96</span>,<br>                         <span class=\"hljs-string\">&#x27;depths&#x27;</span>:     [<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>,  <span class=\"hljs-number\">6</span>,  <span class=\"hljs-number\">2</span>],<br>                         <span class=\"hljs-string\">&#x27;num_heads&#x27;</span>:  [<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">24</span>]&#125;),<br>        **<span class=\"hljs-built_in\">dict</span>.fromkeys([<span class=\"hljs-string\">&#x27;s&#x27;</span>, <span class=\"hljs-string\">&#x27;small&#x27;</span>],<br>                        &#123;<span class=\"hljs-string\">&#x27;embed_dims&#x27;</span>: <span class=\"hljs-number\">96</span>,<br>                         <span class=\"hljs-string\">&#x27;depths&#x27;</span>:     [<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">18</span>,  <span class=\"hljs-number\">2</span>],<br>                         <span class=\"hljs-string\">&#x27;num_heads&#x27;</span>:  [<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">24</span>]&#125;),<br>        **<span class=\"hljs-built_in\">dict</span>.fromkeys([<span class=\"hljs-string\">&#x27;b&#x27;</span>, <span class=\"hljs-string\">&#x27;base&#x27;</span>],<br>                        &#123;<span class=\"hljs-string\">&#x27;embed_dims&#x27;</span>: <span class=\"hljs-number\">128</span>,<br>                         <span class=\"hljs-string\">&#x27;depths&#x27;</span>:     [<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">18</span>,  <span class=\"hljs-number\">2</span>],<br>                         <span class=\"hljs-string\">&#x27;num_heads&#x27;</span>:  [<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">32</span>]&#125;),<br>        **<span class=\"hljs-built_in\">dict</span>.fromkeys([<span class=\"hljs-string\">&#x27;l&#x27;</span>, <span class=\"hljs-string\">&#x27;large&#x27;</span>],<br>                        &#123;<span class=\"hljs-string\">&#x27;embed_dims&#x27;</span>: <span class=\"hljs-number\">192</span>,<br>                         <span class=\"hljs-string\">&#x27;depths&#x27;</span>:     [<span class=\"hljs-number\">2</span>,  <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">18</span>,  <span class=\"hljs-number\">2</span>],<br>                         <span class=\"hljs-string\">&#x27;num_heads&#x27;</span>:  [<span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">24</span>, <span class=\"hljs-number\">48</span>]&#125;),<br>    &#125;  <span class=\"hljs-comment\"># yapf: disable</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 arch=<span class=\"hljs-string\">&#x27;T&#x27;</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 img_size=<span class=\"hljs-number\">224</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 in_channels=<span class=\"hljs-number\">3</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 drop_rate=<span class=\"hljs-number\">0.</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 drop_path_rate=<span class=\"hljs-number\">0.1</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 frozen_stages=-<span class=\"hljs-number\">1</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 use_abs_pos_embed=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 auto_pad=<span class=\"hljs-literal\">False</span>,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 norm_cfg=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">&#x27;LN&#x27;</span></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 stage_cfgs=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 patch_cfg=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-params\"></span>),</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">                 init_cfg=<span class=\"hljs-literal\">None</span></span>):</span><br>        <span class=\"hljs-built_in\">super</span>(SwinTransformer, self).__init__(init_cfg)<br><br>        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(arch, <span class=\"hljs-built_in\">str</span>):<br>            arch = arch.lower()<br>            <span class=\"hljs-keyword\">assert</span> arch <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span>(self.arch_zoo), \\<br>                <span class=\"hljs-string\">f&#x27;Arch <span class=\"hljs-subst\">&#123;arch&#125;</span> is not in default archs <span class=\"hljs-subst\">&#123;<span class=\"hljs-built_in\">set</span>(self.arch_zoo)&#125;</span>&#x27;</span><br>            self.arch_settings = self.arch_zoo[arch]<br>        <span class=\"hljs-keyword\">else</span>:<br>            essential_keys = &#123;<span class=\"hljs-string\">&#x27;embed_dims&#x27;</span>, <span class=\"hljs-string\">&#x27;depths&#x27;</span>, <span class=\"hljs-string\">&#x27;num_head&#x27;</span>&#125;<br>            <span class=\"hljs-keyword\">assert</span> <span class=\"hljs-built_in\">isinstance</span>(arch, <span class=\"hljs-built_in\">dict</span>) <span class=\"hljs-keyword\">and</span> <span class=\"hljs-built_in\">set</span>(arch) == essential_keys, \\<br>                <span class=\"hljs-string\">f&#x27;Custom arch needs a dict with keys <span class=\"hljs-subst\">&#123;essential_keys&#125;</span>&#x27;</span><br>            self.arch_settings = arch<br><br>        self.embed_dims = self.arch_settings[<span class=\"hljs-string\">&#x27;embed_dims&#x27;</span>]<br>        self.depths = self.arch_settings[<span class=\"hljs-string\">&#x27;depths&#x27;</span>]<br>        self.num_heads = self.arch_settings[<span class=\"hljs-string\">&#x27;num_heads&#x27;</span>]<br>        self.num_layers = <span class=\"hljs-built_in\">len</span>(self.depths)<br>        self.use_abs_pos_embed = use_abs_pos_embed<br>        self.auto_pad = auto_pad<br><br>        _patch_cfg = <span class=\"hljs-built_in\">dict</span>(<br>            img_size=img_size,<br>            in_channels=in_channels,<br>            embed_dims=self.embed_dims,<br>            conv_cfg=<span class=\"hljs-built_in\">dict</span>(<br>                <span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">&#x27;Conv2d&#x27;</span>, kernel_size=<span class=\"hljs-number\">4</span>, stride=<span class=\"hljs-number\">4</span>, padding=<span class=\"hljs-number\">0</span>, dilation=<span class=\"hljs-number\">1</span>),<br>            norm_cfg=<span class=\"hljs-built_in\">dict</span>(<span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">&#x27;LN&#x27;</span>),<br>            **patch_cfg)<br>        self.patch_embed = PatchEmbed(**_patch_cfg)<br>        num_patches = self.patch_embed.num_patches<br>        patches_resolution = self.patch_embed.patches_resolution<br>        self.patches_resolution = patches_resolution<br><br>        <span class=\"hljs-keyword\">if</span> self.use_abs_pos_embed:<br>            self.absolute_pos_embed = nn.Parameter(<br>                torch.zeros(<span class=\"hljs-number\">1</span>, num_patches, self.embed_dims))<br><br>        self.drop_after_pos = nn.Dropout(p=drop_rate)<br><br>        <span class=\"hljs-comment\"># stochastic depth</span><br>        total_depth = <span class=\"hljs-built_in\">sum</span>(self.depths)<br>        dpr = [<br>            x.item() <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> torch.linspace(<span class=\"hljs-number\">0</span>, drop_path_rate, total_depth)<br>        ]  <span class=\"hljs-comment\"># stochastic depth decay rule</span><br><br>        self.stages = ModuleList()<br>        embed_dims = self.embed_dims<br>        input_resolution = patches_resolution<br>        <span class=\"hljs-keyword\">for</span> i, (depth,<br>                num_heads) <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(<span class=\"hljs-built_in\">zip</span>(self.depths, self.num_heads)):<br>            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(stage_cfgs, <span class=\"hljs-type\">Sequence</span>):<br>                stage_cfg = stage_cfgs[i]<br>            <span class=\"hljs-keyword\">else</span>:<br>                stage_cfg = deepcopy(stage_cfgs)<br>            downsample = <span class=\"hljs-literal\">True</span> <span class=\"hljs-keyword\">if</span> i &lt; self.num_layers - <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">False</span><br>            _stage_cfg = &#123;<br>                <span class=\"hljs-string\">&#x27;embed_dims&#x27;</span>: embed_dims,<br>                <span class=\"hljs-string\">&#x27;depth&#x27;</span>: depth,<br>                <span class=\"hljs-string\">&#x27;num_heads&#x27;</span>: num_heads,<br>                <span class=\"hljs-string\">&#x27;downsample&#x27;</span>: downsample,<br>                <span class=\"hljs-string\">&#x27;input_resolution&#x27;</span>: input_resolution,<br>                <span class=\"hljs-string\">&#x27;drop_paths&#x27;</span>: dpr[:depth],<br>                <span class=\"hljs-string\">&#x27;auto_pad&#x27;</span>: auto_pad,<br>                **stage_cfg<br>            &#125;<br><br>            stage = SwinBlockSequence(**_stage_cfg)<br>            <span class=\"hljs-comment\"># 冻结某几层frozen_stages</span><br>            <span class=\"hljs-keyword\">if</span>(frozen_stages==<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">or</span> (i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>,frozen_stages))):<br>                stage.<span class=\"hljs-built_in\">eval</span>()<br>                <span class=\"hljs-keyword\">for</span> param <span class=\"hljs-keyword\">in</span> stage.parameters():<br>                    param.requires_grad = <span class=\"hljs-literal\">False</span><br>            <br>            self.stages.append(stage)<br><br>            dpr = dpr[depth:]<br>            <span class=\"hljs-keyword\">if</span> downsample:<br>                embed_dims = stage.downsample.out_channels<br>                input_resolution = stage.downsample.output_resolution<br>            <br><br>        <span class=\"hljs-keyword\">if</span> norm_cfg <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span>:<br>            self.norm = build_norm_layer(norm_cfg, embed_dims)[<span class=\"hljs-number\">1</span>]<br>        <span class=\"hljs-keyword\">else</span>:<br>            self.norm = <span class=\"hljs-literal\">None</span><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">init_weights</span>(<span class=\"hljs-params\">self</span>):</span><br>        <span class=\"hljs-built_in\">super</span>(SwinTransformer, self).init_weights()<br><br>        <span class=\"hljs-keyword\">if</span> self.use_abs_pos_embed:<br>            trunc_normal_(self.absolute_pos_embed, std=<span class=\"hljs-number\">0.02</span>)<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">forward</span>(<span class=\"hljs-params\">self, x</span>):</span><br>        x = self.patch_embed(x)<br>        <span class=\"hljs-keyword\">if</span> self.use_abs_pos_embed:<br>            x = x + self.absolute_pos_embed<br>        x = self.drop_after_pos(x)<br><br>        <span class=\"hljs-keyword\">for</span> stage <span class=\"hljs-keyword\">in</span> self.stages:<br>            x = stage(x)<br><br>        x = self.norm(x) <span class=\"hljs-keyword\">if</span> self.norm <span class=\"hljs-keyword\">else</span> x<br><br>        <span class=\"hljs-keyword\">return</span> x.transpose(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>)<br></code></pre></td></tr></table></figure>\n"},{"title":"论文总结<Anatomical-guided attention enhances unsupervised PET image denoising performance>","date":"2021-11-03T05:04:40.000Z","math":true,"_content":"\n> 2021年2月投稿的一篇论文《Anatomical-guided attention enhances unsupervised PET image denoising performance》提出使用Anatomical-guided的注意力加强非监督的PET图像降噪性能。\n\n\n\n## ABSTRACT\n\n> Although supervised convolutional neural networks (CNNs) often outperform conventional alternatives for denoising positron emission tomography (PET) images, they require many low- and high-quality reference PET image pairs. Herein, we propose an unsupervised 3D PET image denoising method based on an anatomical information-guided attention mechanism. The proposed magnetic resonance-guided deep decoder (MR-GDD) utilizes the spatial details and semantic features of MR-guidance image more effectively by introducing encoder-decoder and deep decoder subnetworks. Moreover, the specific shapes and patterns of the guidance image do not affect the denoised PET image, because the guidance image is input to the network through an attention gate. In a Monte Carlo simulation of [18F]fluoro-2-deoxy-D-glucose (FDG), the proposed method achieved the highest peak signal-to-noise ratio and structural similarity (27.92 ± 0.44 dB/0.886 ± 0.007), as compared with Gaussian filtering (26.68 ± 0.10 dB/0.807 ± 0.004), image guided filtering (27.40 ± 0.11 dB/0.849 ± 0.003), deep image prior (DIP) (24.22 ± 0.43 dB/0.737 ± 0.017), and MR-DIP (27.65 ± 0.42 dB/0.879 ± 0.007). Furthermore, we experimentally visualized the behavior of the optimization process, which is often unknown in unsupervised CNN-based restoration problems. For preclinical (using [18F]FDG and [11C]raclopride) and clinical (using [18F]florbetapir) studies, the proposed method demonstrates state-of-the-art denoising performance while retaining spatial resolution and quantitative accuracy, despite using a common network architecture for various noisy PET images with 1/10th of the full counts. These results suggest that the proposed MR-GDD can reduce PET scan times and PET tracer doses considerably without impacting patients.\n>\n\n##### 总结\n\n使用监督训练CNN网络比传统的方法在PET降噪处理上效果表现的更好，但是需要 low- and high-quality reference PET image pairs作为label。因此基于解剖学信息指引的注意力机制提出了无监督的3D的PET图像的重建。\n\n- 此网络（MR-GDD）引入了两个子网络（encoder-decoder and deep decoder subnetworks）更效率地利用MR（核磁共振）图像的空间信息和语义特征。\n- 同时，由于guidance image通过attention gate后再输入网络，特定的guidance image的shapes和patterns不会影响降噪的PET图像。\n-  并且，我们通过实验可视化了优化过程的行为。这在无监督卷积图像重建通常是无法表示的。\n\n\n\n##  Introduction\n\n> Positron emission tomography (PET) is a functional imaging modality that observes the molecular-level activity in tissues caused by radioactive tracers. It offers excellent diagnostic accuracy both for observing normal tissues and for detecting specific diseases such as cancer and neurodegenerative disorders (Phelps, 2012). In response to the increased demand for more accurate dementia diagnosis in recent years, brain-dedicated PET scanners with enhanced sensitivity that are capable of acquiring high-resolution brain images have been developed (Tashima et al., 2019; Watanabe et al., 2017). The acquisition of high-quality diagnostic PET images requires the administration of high dose or a long scan time. However, massive radiation exposure to PET tracers may induce genetic damage and cancerous growths, thereby raising health risk concerns (ICRP, 2017). Therefore, to mitigate the radiation exposure-related risk, it is desirable to administer low-dose PET tracers. Unfortunately, this increases the statistical noise, thus degrading the quality of PET images and potentially affecting the diagnostic accuracy. Thus, improved noise suppression methods for PET images are essential.\n\n##### 逻辑\n\n为了治疗疾病 --->  需要获取高像素的脑PET图像 --->  需要高剂量&长时间的扫描时间 ---> 引发健康风险 ---> 只能使用低剂量的PET示踪剂 ---> 改进用于 PET 图像的噪声抑制方法是必不可少的。\n\n> Conventionally, Gaussian filtering (GF) is applied as a basic post-denoising method, despite compromising the spatial resolution and, thus, the quantitative accuracy of PET images. To avoid such compromises, various denoising algorithms, such as bilateral filtering ([Hoifheinz et al., 2011](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0018)), non-local means filtering ([Arabi and Zaidi, 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0001)), image-guided filtering (IGF) ([He et al., 2013](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0017); [Hashimoto et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0016)), and block-matching filtering ([Ote et al., 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0027)) have been developed and applied to PET images. These post-denoising algorithms provide a better denoising performance than GF while retaining spatial resolution and quantitative accuracy.\n\n##### 传统降噪方法\n\n高斯滤波 (GF) 被用作基本的后去噪方法，尽管会影响空间分辨率，从而影响 PET 图像的定量精度。后来使用双边滤波、非局部均值滤波、图像引导过滤（IGF）和块匹配过滤的去噪方法。这些去噪算法提供了比 GF 更好的去噪性能，同时保留了空间分辨率和定量精度。\n\n> Aside from the above mentioned conventional [filtering algorithms](https://www.sciencedirect.com/topics/engineering/filtering-algorithm), methods based on deep learning (DL) have been applied in various medical fields ([Litjens et al., 2017](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0023)), and the use of [convolutional neural networks](https://www.sciencedirect.com/topics/engineering/convolutional-neural-networks) (CNNs) has been reported to improve the quality of PET images ([Gong et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010)a; [Häggström et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0012); [Liu and Qi, 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0024); [Sanaat et al., 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0030); [Sphuler et al., 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0034); [Zhou et al., 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0047)). However, the general CNN-based denoising methods typically require a pair of large reference datasets comprising high-quality images. This is a major problem in clinical usage owing to the difficulty of preparing huge sets of low-noise PET data without unduly burdening patients. In addition, the huge volume of novel PET tracers being developed, makes it difficult to collect large amounts of training data for each domain. The interpretation of denoised PET images may suffer inherent biases if unknown cases are excluded from the [training dataset](https://www.sciencedirect.com/topics/computer-science/training-dataset). Despite these challenges, DL algorithms often outperform conventional denoising algorithms. Therefore, there is a need for technology that can be uniformly adapted to various domains without using high-quality PET data.\n\n##### 深度学习方法的难题\n\n除了上述传统过滤算法之外，基于深度学习 (DL) 的方法已应用于各个医学领域，使用卷积神经网络 (CNN) 可以提高PET 图像质量。而深度学习的去噪方法需要高质量图像的大型参考数据集。但是在不给患者造成过度负担的情况下准备大量的低噪声 PET 数据是一个难题，因此目标是需要能够在不使用高质量 PET 数据的情况下，统一适应各种情况的方法。\n\n> In recent years, unsupervised or self-supervised DL approaches such as Noise2Noise and deep image prior (DIP) have demonstrated the potential to overcome these challenges ([Lehtinen et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0021); [Ulyanov et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040)). In particular, the DIP algorithm is a powerful noise suppression method that does not require the preparation of a prior training dataset ([Hashimoto et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0015), [2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014); [Lin and Huang, 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0022)). Furthermore, PET reconstruction and denoising methods in which [computed tomography](https://www.sciencedirect.com/topics/engineering/computed-tomography) (CT) and magnetic resonance (MR) images serve as the prior images input to the DIP framework have been developed ([Cui et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008); [Gong et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0011)b). Compared to PET alone, the denoising performance has been improved by using multi-modal data combined with anatomical information. However, while this method shows potential for adapting various PET image denoising approaches, the [network architecture](https://www.sciencedirect.com/topics/computer-science/network-architecture) does not fully utilize the [semantic features](https://www.sciencedirect.com/topics/computer-science/semantic-feature) or image details of anatomical-guidance images. Furthermore, the process of converting the guidance image to the PET image can result in the shape and pattern of the guidance image remaining in the output PET image, with the extent to which the features of the guidance image affect PET image denoising is yet to be elucidated. Moreover, the process by which the DIP algorithm optimizes the denoising remains unclear. Therefore, these issues must be clarified for future development.\n\n##### 深度学习改进方法：Noise2Noise；DIP；\n\n##### DIP的优点：\n\n- 一种强大的噪声抑制方法，不需要准备先验训练数据集；\n- 其中计算机断层扫描 (CT) 和磁共振 (MR) 图像作为输入到 DIP 框架的先验图像；\n- 与单独的 PET 相比，通过使用多模态数据结合解剖信息，去噪性能得到了提高。\n\n##### DIP的问题：\n\n- 网络架构并没有充分利用解剖指导图像的语义特征或图像细节；\n- 引导图像转换为PET图像的过程会导致输出PET图像中保留引导图像的形状和图案；\n- 引导图像的特征对PET图像去噪的影响程度尚待确定且阐明；\n- DIP算法优化去噪的过程仍不清楚。\n\n> In this study, we propose an unsupervised 3D PET image denoising method that incorporates anatomical information into the DIP architecture via an attention mechanism. The attention gates ([Fukui et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0009); [Schlemper et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0032)) used in the proposed network help optimize a noisy PET image using multi-scale semantic features extracted from the guidance image. As such, this method can prevent the leakage of guidance image features. The guidance of multi-scale features can lead to an effective regularizer for PET image denoising. The main contributions of this study are as follows:\n>\n> - We propose a new PET image denoising method guided by anatomical information using an unsupervised [DL method](https://www.sciencedirect.com/topics/computer-science/deep-learning-method).\n> - We demonstrate that the proposed network has the flexibility to handle the different PET tracer domains used to show the distribution of various tissues in the brains of human and non-human primates.\n> - The behavior of the optimization process is visualized experimentally, thereby providing useful insights that were unresolved in unsupervised CNN-based restoration problems.\n\n##### 本文的方法：\n\n使用了无监督的3D的PET图像降噪方法，该方法通过**注意机制将解剖信息整合到 DIP 架构中**，使用从引导图像中提取的多尺度语义特征来优化嘈杂的 PET 图像。多尺度特征的引导可以为 PET 图像去噪提供有效的正则化器。\n\n##### 贡献：\n\n- 我们提出了一种新的 PET 图像去噪方法，该方法使用无监督的 DL 方法**以解剖信息为指导**；\n\n- 具有处理不同PET 示踪域的**灵活性**，可以用于显示人类和非人类灵长类动物大脑中各种组织的分布；\n\n-  优化过程的行为通过实验进行**可视化**，从而提供在基于 CNN 的无监督重建问题中未解决问题的相关见解。\n\n  \n\n## 2. Related work\n\n> The [PET](https://www.sciencedirect.com/topics/engineering/positron-emission-tomography) image restoration process is further complicated by the limited availability of information that can be extracted from noisy PET data. Another approach adopted for PET image denoising is to use anatomical prior extracted from the [CT](https://www.sciencedirect.com/topics/engineering/computed-tomography) or MR images of the patient for [regularization](https://www.sciencedirect.com/topics/engineering/regularization). Because multi-modal images have become easier to obtain owing to the increasing availability of PET/CT and PET/MR scanners, various [hybrid methods](https://www.sciencedirect.com/topics/engineering/hybrid-method) using anatomical priors have been developed to facilitate PET image denoising.\n\n PET 图像去噪采用的另一种方法是**使用从患者的 CT 或 MR 图像中提取的解剖先验**进行正则化。由于 PET/CT 和 PET/MR 扫描仪的可用性不断提高，多模态图像变得更容易获得，因此开发了各种使用解剖学先验的混合方法来促进 PET 图像去噪。\n\n### 2.1. Classical approach\n\n> Conventionally, hybrid denoising methods using anatomical priors have been adopted for PET image reconstruction and post-filtering. For example, [maximum a posteriori](https://www.sciencedirect.com/topics/engineering/maximum-a-posteriori) image reconstruction has been incorporated alongside anatomical priors ([Comtat et al., 2002](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0007); [Vunckx et al., 2012](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0041)). In addition, [Sudarshan et al. (2020)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0035) proposed joint PET and MR image reconstruction using a patch-based joint-dictionary prior. [Bland et al. (2018)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0003) introduced MR-derived kernels to the kernel expectation maximization reconstruction. Although advanced image reconstruction algorithms can provide better denoising performance, they require significant computational resources and it is often difficult to set optimal parameters. Therefore, anatomically-guided post-denoising is often performed separately from the image reconstruction process. [Chan et al. (2014)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0004) proposed incorporating CT information and applying median non-local mean filtering to achieve PET denoising. Alternatively, [Yan et al. (2015)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0045) proposed MR-guided PET filtering by adapting a local linear model. In addition, the authors performed partial volume correction without MR image [parcellation](https://www.sciencedirect.com/topics/engineering/parcellation) by incorporating [partial volume effects](https://www.sciencedirect.com/topics/engineering/partial-volume-effect) into the model.\n\n##### 经典方法：\n\n将解剖先验的混合去噪方法应用于PET图像重建和后滤波处理，将最大后验图像重建与解剖先验结合在一起。基于a patch-based joint-dictionary prior联合PET和MR图像重建\n\n### 2.2. Supervised DL approach\n\nThe supervised DL approach has recently demonstrated state-of-the-art performance in PET image denoising. When large amounts of training and label PET data pairs are available, the general [CNN](https://www.sciencedirect.com/topics/engineering/convolutional-neural-networks) can be trained according to the following operation:\n\n{% raw %}\n$$\nθ^*=argmin_θ \\frac{1}{N_t}∑_{i∈D_t}∥x_{ref}^i−f_θ(x_0^i)∥\n$$\n{% endraw %}\n\nwhere ∥·∥ is the L2 norm, f represents the CNN, θ denotes the trainable parameters contained in the weights and biases, Dt is a mini-batch sample of size Nt, x0i is the *i*th element in the training data (noisy PET images), and xrefi is the *i*th element in the label data (clean PET images). Regarding supervised PET image denoising using anatomical information, in separate studies, [Liu and Qi et al. (2019)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0024), [Schramm et al. (2021)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0033), and [Chen et al. (2019)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0005) trained CNNs to map multi-modal images, including noisy PET and MR images, to obtain clean PET images. In accordance with these methods, the mapping function, fθ(x0i), in [Eq. (1)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0001) is represented by fθ(x0i,gi) using anatomical-guidance images, g. The supervised DL approach requires a vast number of low-dose (or short-time scan), high-dose (or long-time scan), and guidance image pairs.\n\n### 2.3. Unsupervised DL approach\n\nUnsupervised DL approaches such as DIP do not require label data for PET image denoising. The DIP training process is optimized as follows ([Ulyanov et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040)):\n\n{% raw %}\n$$\nθ^*=argmin_θ∥x_0−f_θ(z)∥,x^*=f_{θ^*}(z)\n$$\n{% endraw %}\n\nwhere x0 is a [noisy image](https://www.sciencedirect.com/topics/engineering/noisy-image), x* is the final [denoised image](https://www.sciencedirect.com/topics/engineering/denoised-image) output, and the network input z is random noise. The DIP algorithm uses a CNN to map a [degraded image](https://www.sciencedirect.com/topics/engineering/degraded-image), x0, and obtains the optimal denoised image by regularization of the architecture via moderate iteration. This is based purely on the prior information included in the CNN structure. [Hashimoto et al. (2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0015)), ([2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014)) proposed dynamic PET image denoising by directly inputting static PET images into 3D and 4D DIP as prior information. In contrast, [Cui et al. (2019)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008) and [Gong et al. (2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010)a) both proposed PET denoising methods that rely on inputting anatomical-guidance images, g (e.g., CT and MR images), instead of the DIP input, z. In these methods, the mapping function, fθ(z), in [Eq. (2)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0002) is represented by fθ(g).\n\nThe unsupervised DL approach can bridge the technical gap between the classical and supervised DL approaches for PET image denoising based on anatomical information. Nevertheless, previous methods often fail to clarify how the [semantic features](https://www.sciencedirect.com/topics/computer-science/semantic-feature) of the guidance image affect PET image denoising.\n\n## 3. Methodology\n\n### 3.1. MR-guided deep decoder\n\nTo explicitly utilize the [semantic features](https://www.sciencedirect.com/topics/computer-science/semantic-feature) of anatomical-guidance image for [PET](https://www.sciencedirect.com/topics/engineering/positron-emission-tomography) image denoising, we propose a method for unsupervised 3D PET image denoising based on anatomical information that uses an MR-guided deep decoder (MR-GDD), which is inspired by [Uezato et al. (2020)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0039). [Fig. 1](https://www.sciencedirect.com/science/article/pii/S1361841521002711#fig0001) shows the [network structure](https://www.sciencedirect.com/topics/computer-science/network-structure) of the proposed MR-GDD, which comprises two [subnetworks](https://www.sciencedirect.com/topics/engineering/subnetwork): an encoder-decoder subnetwork with a skip connection and a deep decoder subnetwork. The two subnetworks are connected by an upsampling refinement unit (URU) and a feature refinement unit (FRU), which incorporate an attention gate to weight the multi-scale features extracted from the MR image to the deep decoder subnetwork. This combined network performs end-to-end learning from scratch.\n\n![](https://picture.mulindya.com/MR-guided-deep-decoder.jpg)\n\nFig. 1. Overview of the proposed MR-GDD used for unsupervised 3D [PET](https://www.sciencedirect.com/topics/engineering/positron-emission-tomography) image denoising. This architecture consists of two [subnetworks](https://www.sciencedirect.com/topics/engineering/subnetwork) connected by attention gates: an encoder-decoder subnetwork with a skip connection (top) and a deep decoder subnetwork (bottom). This combined architecture is optimized using end-to-end learning. The attention gates in the upsampling refinement unit (URU) and the feature refinement unit (FRU) guide the optimization of noisy PET image using the multi-scale [semantic features](https://www.sciencedirect.com/topics/computer-science/semantic-feature) extracted from the MR image. This architecture can prevent the semantic features of the MR image from leaking.\n\n#### 3.1.1. Encoder-decoder subnetwork\n\nThe encoder-decoder subnetwork is designed to extract low-scale to high-scale hierarchical semantic features from the MR image. It is based on the 3D U-Net architecture ([Çiçek et al., 2016](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0006)) and consists of encoding and decoding paths. In the encoding path, the combination of a 3 × 3 × 3 3D [convolution layer](https://www.sciencedirect.com/topics/computer-science/convolution-layer) with [batch normalization](https://www.sciencedirect.com/topics/computer-science/batch-normalization) (BN) and a leaky rectified linear unit (LReLU) is repeated twice, before being constructed by a 3 × 3 × 3 3D convolution layer with two strides for downsampling, followed by the BN and LReLU. At each downsampling step, the size of the feature maps is halved. In the decoding path, the outputs of the upsampling layer and the skip connection supplied from the encoding path are added, before the combination of the 3 × 3 × 3 3D convolution layer with the BN and LReLU is repeated twice. At each upsampling step, the size of the feature maps is doubled.\n\n#### 3.1.2. Deep decoder subnetwork\n\nThe deep decoder subnetwork reconstructs the denoised PET image from the network input filled with uniform noise. Each step in the deep decoder subnetwork is upsampled first by the URU, then by a 3 × 3 × 3 3D convolution layer, and finally by the BN, LReLU, and FRU. Owing to the presence the attention gates, the URU and FRU can generate conditional weights using the MR image features via a 1 × 1 × 1 3D convolution layer, LReLU, and [sigmoid function](https://www.sciencedirect.com/topics/engineering/sigmoid-function), and then weights the features obtained from the pre-layer in the deep decoder. The URU promotes the [spatial locality](https://www.sciencedirect.com/topics/computer-science/spatial-locality) of MR image features, whereas the FRU promotes similar semantic alignment. Finally, a 1 × 1 × 1 3D convolution layer outputs a denoised PET image.\n\n### 3.2. Loss function and optimization\n\nTo denoise the PET image, the training process of the proposed MR-GDD, which utilizes [unsupervised learning](https://www.sciencedirect.com/topics/computer-science/unsupervised-learning) that does not require PET reference data, is optimized as follows:\n\n{% raw %}\n$$\nθ^*=argmin_θ∥x_0−f_θ(z,g)∥,x^*=f_{θ^*}(z,g)\n$$\n{% endraw %}\n\nwhere ∥·∥ is the L2 norm, f represents the proposed MR-GDD network, the training label x0 represents the noisy PET image, and the network inputs z and g are the random noise and the MR-guidance image, respectively. The input noise was generated by adding a fixed uniform random noise and [Gaussian noise](https://www.sciencedirect.com/topics/engineering/gaussian-white-noise) with different seed for each epoch. The attention gates used in the proposed architecture help optimize the noisy PET image by using the multi-scale semantic features extracted from a [guidance image](https://www.sciencedirect.com/topics/medicine-and-dentistry/image-guided-intervention) g. If the *k*-th scale feature of the encoder path in the encoder-decoder subnetwork is defined as Γk and the *k*-th scale features of the decoder path are defined as Ξk, the influence on the mapping function, f, can be expressed as follows:\n\n{% raw %}\n$$\nf=f_θ(z|Γ1,⋯Γk,Ξ1,⋯Ξk).\n$$\n{% endraw %}\n\nIn this method, the limited memory BFGS (L-BFGS) algorithm ([Zhu et al., 1997](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0048)), which is a quasi-Newtonian method, is introduced to solve the nonlinear [least squares problem](https://www.sciencedirect.com/topics/engineering/least-square-problem) described by [Eq. (3)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0003). By considering the approximate [Hessian matrix](https://www.sciencedirect.com/topics/engineering/hessian-matrix) based on the second-order gradient, the L2 norm converges more stably and quickly than first-order [gradient descent](https://www.sciencedirect.com/topics/engineering/gradient-descent) algorithms, such as the stochastic gradient descent algorithm or Adam. In addition, because a small amount of data is generated as a result of using the unsupervised architecture, which does not require a prior [training dataset](https://www.sciencedirect.com/topics/computer-science/training-dataset), the MR-GDD can reduce the computational complexity and load required to performed denoising. We used the L-BFGS algorithm at a learning rate of 0.01 without line search to minimize the processing time. The proposed architecture was processed using PyTorch 1.6.0 on Ubuntu 16.04 with acceleration by a [graphics processing unit](https://www.sciencedirect.com/topics/engineering/graphics-processing-unit) (NVIDIA Quadro RTX8000 with 48 GB memory).\n\n## 4. Experimental setup\n\nA simulation study using [18F]fluoro-2-deoxy-D-glucose (FDG), a preclinical study using [18F]FDG and [11C]raclopride, and a clinical study using [18F]florbetapir ([Wong et al., 2010](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0043)) were performed to verify the effectiveness of the proposed [PET](https://www.sciencedirect.com/topics/engineering/positron-emission-tomography) image denoising method. In addition, the denoising performance of the proposed MR-GDD was compared against four other unsupervised algorithms under the same conditions as the proposed MR-GDD;\n\n- *Gaussian filtering (GF).* GF is a basic post-denoising method for suppressing noise in PET images. We used a 3D [Gaussian kernel](https://www.sciencedirect.com/topics/engineering/gaussian-kernel).\n- *Image guided filtering (IGF).* IGF performs PET image denoising by adapting a local linear model using a [guidance image](https://www.sciencedirect.com/topics/medicine-and-dentistry/image-guided-intervention) ([Hashimoto et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0016); [He et al., 2013](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0017)). We used the MR image as the guidance image.\n- *Deep image prior (DIP).* The general DIP algorithm uses random noise as the network input ([Ulyanov et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040)). We used the encoder-decoder network in the proposed MR-GDD as the DIP architecture.\n- *MR-DIP.* MR-DIP uses an MR prior as a direct input in the DIP architecture ([Cui et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008); [Gong et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010)a). We used the same architecture as in the DIP algorithm.\n\nAs a pre-processing step for all the data, voxel intensity normalization was performed on each of the MR and PET images. The MR image intensity was normalized in the [0, 1] range using a min-max normalization technique. Furthermore, the 99.95th [percentile](https://www.sciencedirect.com/topics/engineering/percentile) was defined for PET image intensity, which was also normalized in the [0, 1] range using a min-max normalization technique.\n\n### 4.1. Simulation study\n\nWe performed a [Monte Carlo simulation](https://www.sciencedirect.com/topics/medicine-and-dentistry/monte-carlo-method) using the 3D brain phantom from BrainWeb ([Aubert-Broche et al., 2006](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0002)). The Monte Carlo simulation modeled the geometry of a brain-dedicated PET scanner (HITS-655000 ([Watanabe et al., 2017](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0042)), [Hamamatsu Photonics](https://www.sciencedirect.com/topics/computer-science/hamamatsu-photonics) K.K., Japan). The scanner consists of 32 detector blocks with [cerium](https://www.sciencedirect.com/topics/engineering/cerium) doped [lutetium](https://www.sciencedirect.com/topics/engineering/lutetium) [yttrium](https://www.sciencedirect.com/topics/engineering/yttrium) [orthosilicate](https://www.sciencedirect.com/topics/engineering/orthosilicates) crystals per ring, with 5 of these blocks aligned to the scanner axis. To ensure a mismatch between the MR and PET images, two hot spheres (with radii of 10 and 12 mm, respectively) were inserted exclusively into the PET image to present tumor regions. Then, we simulated a static [18F]FDG scan equivalent to 150 M counts, including attenuation and scattering effects. An attenuation map was created from the segmented MR image, and the attenuation effects of water and bone were considered. The gray matter:white matter:cerebrospinal fluid:left tumor:right tumor activity ratio was set to 1:0.25:0.05:2:2 based on the [18F]FDG contrast. We also simulated low-activity tumor data (left tumor:right tumor activity ratio was set to 1.5:1.2) for some low-grade tumors or pathology linked to [neurodegenerative disease](https://www.sciencedirect.com/topics/medicine-and-dentistry/degenerative-disease). To generate the reference PET image, the simulated list-mode data were reconstructed using a 3D list-mode dynamic row-action maximum-likelihood algorithm (DRAMA) ([Tanaka and Kudo, 2010](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0037)) with two iterations and 40 subsets. The reconstructed image measured 128 × 128 × 83 voxels (2.6 × 2.6 × 2.4 mm/voxel). The reference image was reconstructed using all the list-mode data. The noisy PET image was obtained by periodically downsampling to 1/30th of the reference list-mode data (see Supplementary Material 0.1) and reconstructing the low-count image (5 M counts). The corresponding T1-weighted MR image was used as the guidance image.\n\n### 4.2. Preclinical study\n\nA preclinical study was conducted using monkeys and was approved by the Animal Ethics Committees of the Central [Research Laboratory](https://www.sciencedirect.com/topics/engineering/research-laboratories), Hamamatsu Photonics K.K. PET scans using [18F]FDG and [11C]raclopride imaged the brains of conscious [rhesus monkeys](https://www.sciencedirect.com/topics/engineering/rhesus-monkey), whose bodies and heads were fixed using an animal PET scanner (SHR-38000 ([Hamamatsu 2021](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0013)), Hamamatsu Photonics K.K., Japan). After a 30 min transmission scan using a 68Ge-68Ga source, doses of [18F]FDG (113 MBq) and [11C]raclopride (282 MBq) were injected into each monkey, before dynamic PET scans were performed for 120 and 90 min, respectively. We performed image reconstruction using 3D DRAMA with two iterations and 60 subsets that incorporated attenuation correction via transmission scan data. The reconstructed images measured 256 × 256 × 103 voxels (0.65 × 0.65 × 1.0167 mm/voxel) and were cropped [to 192](https://www.sciencedirect.com/topics/medicine-and-dentistry/pamicogrel) × 192 × 64 voxels to reduce the demand on the [GPU](https://www.sciencedirect.com/topics/engineering/graphics-processing-unit) memory. The reference images were reconstructed using all the list-mode data for [18F]FDG and the list mode data for the 60 min period between 30 and 90 min of the scan such that the contrast created by the distribution of [11C]raclopride in the striatum to be observed clearly. Each noisy PET image was obtained by periodically downsampling to 1/10th of the reference list-mode data. The corresponding T1-weighted MR images were taken on another day and registered manually by two radiological [technologists](https://www.sciencedirect.com/topics/engineering/technologist).\n\n### 4.3. Clinical study\n\nAn amyloid scan using [18F]florbetapir was conducted on the human brain of a cognitive normal subject using a Biograph mMR scanner (Siemens Healthineers, Germany) as part of the “Insight 46″ sub-study of the MRC National Survey of Health and Development ([Lane et al., 2017](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0020); [Markiewicz et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0025)a). The PET data were acquired dynamically for 60 min using a [18F]florbetapir dose of 409 MBq. During PET image reconstruction, attenuation correction was performed via a pseudo-CT image, which was synthesized using T1- and T2-weighted MR images that were acquired simultaneously, and enabled an μ-map to be was calculated. Image reconstruction was performed using an ordered subset expectation maximization (OS-EM) algorithm involving four iterations and 14 subsets using the NiftyPET package ([Markiewicz et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0026)b). The reconstructed images comprised 334 × 334 × 127 voxels (2 × 2 × 2 mm/voxel), which were cropped to 128 × 128 × 83 voxels to reduce the demand on the GPU memory. The reference image was reconstructed using the list-mode data for the period from 30 to 60 min to observe the contrast between gray and white matter clearly. The noisy PET image was obtained by periodically downsampling to 1/10th of the reference list-mode data.\n\n### 4.4. Evaluation metrics\n\nTo quantitatively evaluate the performance of different denoising methods, for the simulation study, we calculated the peak signal-to-noise ratio (PSNR) and structural similarity (SSIM) of the target image, x, and the reference image, xref, which are defined as\n\n{% raw %}\n$$\nPSNR=10log_{10}(\\frac{max(x^{ref})^2}{\\frac{1}{N_R}∑_{j∈R}(x_j−x_j^{ref})^2})\n$$\n\n{% endraw %}\n\nand\n\n{% raw %}\n$$\nSSIM=\\frac{1}{N_R}∑_{j∈R}\\frac{(2μ_{jx}μ_{jx^{ref}}+c_1)(2σ_{jxx^{ref}}+c_2)}{(μ_{jx}^2+μ_{jx^{ref}}^2+c_1)(σ_{jx}^2+σ_{jx^{ref}}^2+c^2)}\n$$\n\n{% endraw %}\n\nrespectively. Here, R and NR represent the brain region in the PET image and the number of voxels, respectively, μ and σ are the mean and standard deviation of the square window corresponding to the *j*-th voxel, respectively, and σjxxref is the covariance between x and xref. Furthermore, c1=(0.01L)2 and c2=(0.03L)2 where L represents the dynamic range of the reference. The contrast-to-noise ratio (CNR) between gray matter and white matter was calculated as(7)CNR=|Sg¯−Sw¯|σg2+σw2,where Sg¯, Sw¯ and σg, σw are the mean activity and standard deviation corresponding to the regions of interest (ROIs) in the gray and white matter, respectively. The ROIs were constructed in the gray matter regions on the left and right brains of different slices, whereas the white matter regions were selected within the centrum semiovale ([Paxinos et al., 2000](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0028)). In the [11C]raclopride calculation, the ROIs were set on the [putamen](https://www.sciencedirect.com/topics/medicine-and-dentistry/putamen) instead of the gray matter. A Wilcoxon signed-rank test was performed on the PSNR, SSIM, and CNR to compare the performance of different denoising methods. As the noisy PET data were generated by downsampling the reference list-mode data, we generated multiple independent noisy samples (10 samples) to examine the uncertainty and test the statistical significance.\n\nWe also evaluated the tradeoffs between noise and quantitative information of the [denoised images](https://www.sciencedirect.com/topics/engineering/denoised-image) when FWHM (GF), ε (IGF), and epochs (CNNs) are changed. For the simulation study, we calculated the tradeoff between the mean squared bias and the variance in the ROI:(8)Bias2=∑j∈R(xj−xjref)2∑j∈R(xjref)2,(7)Variance=∑j∈R(xj−x¯)2∑j∈R(xjref)2,where R denotes the tumor regions, x¯ is the average pixel value inside the ROI. For preclinical study, we calculated the tradeoff between the mean uptake (putamen and caudate and striatum) and the standard deviation (white matter). Each ROI used for the evaluation was set manually to include any partial volume voxels on the MR image and was calculated via superimposition on the co-registered PET image.\n\nThus far, the optimization process for the DIP algorithm has only been reported as a conceptual diagram ([Hashimoto et al., 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014); [Ulyanov et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040)), with several aspects such as the actual behavior remaining unclarified. To elucidate the DIP optimization process, we visualized it by performing nonlinear dimensionally reduction using the locally linear embedding (LLE) algorithm ([Saul and Roweis, 2003](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0031)), which implements manifold learning. We projected the PET data used for optimization under different training conditions onto a three-dimensional manifold, considering a neighborhood of 15 for each point.","source":"_posts/学习笔记/paper/brain-pet-paper1.md","raw":"---\ntitle: 论文总结<Anatomical-guided attention enhances unsupervised PET image denoising performance>\ntags: paper\ncategories: [文献,pet]\ndate: 2021-11-03 13:04:40\nmath: true\n---\n\n> 2021年2月投稿的一篇论文《Anatomical-guided attention enhances unsupervised PET image denoising performance》提出使用Anatomical-guided的注意力加强非监督的PET图像降噪性能。\n\n\n\n## ABSTRACT\n\n> Although supervised convolutional neural networks (CNNs) often outperform conventional alternatives for denoising positron emission tomography (PET) images, they require many low- and high-quality reference PET image pairs. Herein, we propose an unsupervised 3D PET image denoising method based on an anatomical information-guided attention mechanism. The proposed magnetic resonance-guided deep decoder (MR-GDD) utilizes the spatial details and semantic features of MR-guidance image more effectively by introducing encoder-decoder and deep decoder subnetworks. Moreover, the specific shapes and patterns of the guidance image do not affect the denoised PET image, because the guidance image is input to the network through an attention gate. In a Monte Carlo simulation of [18F]fluoro-2-deoxy-D-glucose (FDG), the proposed method achieved the highest peak signal-to-noise ratio and structural similarity (27.92 ± 0.44 dB/0.886 ± 0.007), as compared with Gaussian filtering (26.68 ± 0.10 dB/0.807 ± 0.004), image guided filtering (27.40 ± 0.11 dB/0.849 ± 0.003), deep image prior (DIP) (24.22 ± 0.43 dB/0.737 ± 0.017), and MR-DIP (27.65 ± 0.42 dB/0.879 ± 0.007). Furthermore, we experimentally visualized the behavior of the optimization process, which is often unknown in unsupervised CNN-based restoration problems. For preclinical (using [18F]FDG and [11C]raclopride) and clinical (using [18F]florbetapir) studies, the proposed method demonstrates state-of-the-art denoising performance while retaining spatial resolution and quantitative accuracy, despite using a common network architecture for various noisy PET images with 1/10th of the full counts. These results suggest that the proposed MR-GDD can reduce PET scan times and PET tracer doses considerably without impacting patients.\n>\n\n##### 总结\n\n使用监督训练CNN网络比传统的方法在PET降噪处理上效果表现的更好，但是需要 low- and high-quality reference PET image pairs作为label。因此基于解剖学信息指引的注意力机制提出了无监督的3D的PET图像的重建。\n\n- 此网络（MR-GDD）引入了两个子网络（encoder-decoder and deep decoder subnetworks）更效率地利用MR（核磁共振）图像的空间信息和语义特征。\n- 同时，由于guidance image通过attention gate后再输入网络，特定的guidance image的shapes和patterns不会影响降噪的PET图像。\n-  并且，我们通过实验可视化了优化过程的行为。这在无监督卷积图像重建通常是无法表示的。\n\n\n\n##  Introduction\n\n> Positron emission tomography (PET) is a functional imaging modality that observes the molecular-level activity in tissues caused by radioactive tracers. It offers excellent diagnostic accuracy both for observing normal tissues and for detecting specific diseases such as cancer and neurodegenerative disorders (Phelps, 2012). In response to the increased demand for more accurate dementia diagnosis in recent years, brain-dedicated PET scanners with enhanced sensitivity that are capable of acquiring high-resolution brain images have been developed (Tashima et al., 2019; Watanabe et al., 2017). The acquisition of high-quality diagnostic PET images requires the administration of high dose or a long scan time. However, massive radiation exposure to PET tracers may induce genetic damage and cancerous growths, thereby raising health risk concerns (ICRP, 2017). Therefore, to mitigate the radiation exposure-related risk, it is desirable to administer low-dose PET tracers. Unfortunately, this increases the statistical noise, thus degrading the quality of PET images and potentially affecting the diagnostic accuracy. Thus, improved noise suppression methods for PET images are essential.\n\n##### 逻辑\n\n为了治疗疾病 --->  需要获取高像素的脑PET图像 --->  需要高剂量&长时间的扫描时间 ---> 引发健康风险 ---> 只能使用低剂量的PET示踪剂 ---> 改进用于 PET 图像的噪声抑制方法是必不可少的。\n\n> Conventionally, Gaussian filtering (GF) is applied as a basic post-denoising method, despite compromising the spatial resolution and, thus, the quantitative accuracy of PET images. To avoid such compromises, various denoising algorithms, such as bilateral filtering ([Hoifheinz et al., 2011](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0018)), non-local means filtering ([Arabi and Zaidi, 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0001)), image-guided filtering (IGF) ([He et al., 2013](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0017); [Hashimoto et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0016)), and block-matching filtering ([Ote et al., 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0027)) have been developed and applied to PET images. These post-denoising algorithms provide a better denoising performance than GF while retaining spatial resolution and quantitative accuracy.\n\n##### 传统降噪方法\n\n高斯滤波 (GF) 被用作基本的后去噪方法，尽管会影响空间分辨率，从而影响 PET 图像的定量精度。后来使用双边滤波、非局部均值滤波、图像引导过滤（IGF）和块匹配过滤的去噪方法。这些去噪算法提供了比 GF 更好的去噪性能，同时保留了空间分辨率和定量精度。\n\n> Aside from the above mentioned conventional [filtering algorithms](https://www.sciencedirect.com/topics/engineering/filtering-algorithm), methods based on deep learning (DL) have been applied in various medical fields ([Litjens et al., 2017](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0023)), and the use of [convolutional neural networks](https://www.sciencedirect.com/topics/engineering/convolutional-neural-networks) (CNNs) has been reported to improve the quality of PET images ([Gong et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010)a; [Häggström et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0012); [Liu and Qi, 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0024); [Sanaat et al., 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0030); [Sphuler et al., 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0034); [Zhou et al., 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0047)). However, the general CNN-based denoising methods typically require a pair of large reference datasets comprising high-quality images. This is a major problem in clinical usage owing to the difficulty of preparing huge sets of low-noise PET data without unduly burdening patients. In addition, the huge volume of novel PET tracers being developed, makes it difficult to collect large amounts of training data for each domain. The interpretation of denoised PET images may suffer inherent biases if unknown cases are excluded from the [training dataset](https://www.sciencedirect.com/topics/computer-science/training-dataset). Despite these challenges, DL algorithms often outperform conventional denoising algorithms. Therefore, there is a need for technology that can be uniformly adapted to various domains without using high-quality PET data.\n\n##### 深度学习方法的难题\n\n除了上述传统过滤算法之外，基于深度学习 (DL) 的方法已应用于各个医学领域，使用卷积神经网络 (CNN) 可以提高PET 图像质量。而深度学习的去噪方法需要高质量图像的大型参考数据集。但是在不给患者造成过度负担的情况下准备大量的低噪声 PET 数据是一个难题，因此目标是需要能够在不使用高质量 PET 数据的情况下，统一适应各种情况的方法。\n\n> In recent years, unsupervised or self-supervised DL approaches such as Noise2Noise and deep image prior (DIP) have demonstrated the potential to overcome these challenges ([Lehtinen et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0021); [Ulyanov et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040)). In particular, the DIP algorithm is a powerful noise suppression method that does not require the preparation of a prior training dataset ([Hashimoto et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0015), [2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014); [Lin and Huang, 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0022)). Furthermore, PET reconstruction and denoising methods in which [computed tomography](https://www.sciencedirect.com/topics/engineering/computed-tomography) (CT) and magnetic resonance (MR) images serve as the prior images input to the DIP framework have been developed ([Cui et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008); [Gong et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0011)b). Compared to PET alone, the denoising performance has been improved by using multi-modal data combined with anatomical information. However, while this method shows potential for adapting various PET image denoising approaches, the [network architecture](https://www.sciencedirect.com/topics/computer-science/network-architecture) does not fully utilize the [semantic features](https://www.sciencedirect.com/topics/computer-science/semantic-feature) or image details of anatomical-guidance images. Furthermore, the process of converting the guidance image to the PET image can result in the shape and pattern of the guidance image remaining in the output PET image, with the extent to which the features of the guidance image affect PET image denoising is yet to be elucidated. Moreover, the process by which the DIP algorithm optimizes the denoising remains unclear. Therefore, these issues must be clarified for future development.\n\n##### 深度学习改进方法：Noise2Noise；DIP；\n\n##### DIP的优点：\n\n- 一种强大的噪声抑制方法，不需要准备先验训练数据集；\n- 其中计算机断层扫描 (CT) 和磁共振 (MR) 图像作为输入到 DIP 框架的先验图像；\n- 与单独的 PET 相比，通过使用多模态数据结合解剖信息，去噪性能得到了提高。\n\n##### DIP的问题：\n\n- 网络架构并没有充分利用解剖指导图像的语义特征或图像细节；\n- 引导图像转换为PET图像的过程会导致输出PET图像中保留引导图像的形状和图案；\n- 引导图像的特征对PET图像去噪的影响程度尚待确定且阐明；\n- DIP算法优化去噪的过程仍不清楚。\n\n> In this study, we propose an unsupervised 3D PET image denoising method that incorporates anatomical information into the DIP architecture via an attention mechanism. The attention gates ([Fukui et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0009); [Schlemper et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0032)) used in the proposed network help optimize a noisy PET image using multi-scale semantic features extracted from the guidance image. As such, this method can prevent the leakage of guidance image features. The guidance of multi-scale features can lead to an effective regularizer for PET image denoising. The main contributions of this study are as follows:\n>\n> - We propose a new PET image denoising method guided by anatomical information using an unsupervised [DL method](https://www.sciencedirect.com/topics/computer-science/deep-learning-method).\n> - We demonstrate that the proposed network has the flexibility to handle the different PET tracer domains used to show the distribution of various tissues in the brains of human and non-human primates.\n> - The behavior of the optimization process is visualized experimentally, thereby providing useful insights that were unresolved in unsupervised CNN-based restoration problems.\n\n##### 本文的方法：\n\n使用了无监督的3D的PET图像降噪方法，该方法通过**注意机制将解剖信息整合到 DIP 架构中**，使用从引导图像中提取的多尺度语义特征来优化嘈杂的 PET 图像。多尺度特征的引导可以为 PET 图像去噪提供有效的正则化器。\n\n##### 贡献：\n\n- 我们提出了一种新的 PET 图像去噪方法，该方法使用无监督的 DL 方法**以解剖信息为指导**；\n\n- 具有处理不同PET 示踪域的**灵活性**，可以用于显示人类和非人类灵长类动物大脑中各种组织的分布；\n\n-  优化过程的行为通过实验进行**可视化**，从而提供在基于 CNN 的无监督重建问题中未解决问题的相关见解。\n\n  \n\n## 2. Related work\n\n> The [PET](https://www.sciencedirect.com/topics/engineering/positron-emission-tomography) image restoration process is further complicated by the limited availability of information that can be extracted from noisy PET data. Another approach adopted for PET image denoising is to use anatomical prior extracted from the [CT](https://www.sciencedirect.com/topics/engineering/computed-tomography) or MR images of the patient for [regularization](https://www.sciencedirect.com/topics/engineering/regularization). Because multi-modal images have become easier to obtain owing to the increasing availability of PET/CT and PET/MR scanners, various [hybrid methods](https://www.sciencedirect.com/topics/engineering/hybrid-method) using anatomical priors have been developed to facilitate PET image denoising.\n\n PET 图像去噪采用的另一种方法是**使用从患者的 CT 或 MR 图像中提取的解剖先验**进行正则化。由于 PET/CT 和 PET/MR 扫描仪的可用性不断提高，多模态图像变得更容易获得，因此开发了各种使用解剖学先验的混合方法来促进 PET 图像去噪。\n\n### 2.1. Classical approach\n\n> Conventionally, hybrid denoising methods using anatomical priors have been adopted for PET image reconstruction and post-filtering. For example, [maximum a posteriori](https://www.sciencedirect.com/topics/engineering/maximum-a-posteriori) image reconstruction has been incorporated alongside anatomical priors ([Comtat et al., 2002](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0007); [Vunckx et al., 2012](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0041)). In addition, [Sudarshan et al. (2020)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0035) proposed joint PET and MR image reconstruction using a patch-based joint-dictionary prior. [Bland et al. (2018)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0003) introduced MR-derived kernels to the kernel expectation maximization reconstruction. Although advanced image reconstruction algorithms can provide better denoising performance, they require significant computational resources and it is often difficult to set optimal parameters. Therefore, anatomically-guided post-denoising is often performed separately from the image reconstruction process. [Chan et al. (2014)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0004) proposed incorporating CT information and applying median non-local mean filtering to achieve PET denoising. Alternatively, [Yan et al. (2015)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0045) proposed MR-guided PET filtering by adapting a local linear model. In addition, the authors performed partial volume correction without MR image [parcellation](https://www.sciencedirect.com/topics/engineering/parcellation) by incorporating [partial volume effects](https://www.sciencedirect.com/topics/engineering/partial-volume-effect) into the model.\n\n##### 经典方法：\n\n将解剖先验的混合去噪方法应用于PET图像重建和后滤波处理，将最大后验图像重建与解剖先验结合在一起。基于a patch-based joint-dictionary prior联合PET和MR图像重建\n\n### 2.2. Supervised DL approach\n\nThe supervised DL approach has recently demonstrated state-of-the-art performance in PET image denoising. When large amounts of training and label PET data pairs are available, the general [CNN](https://www.sciencedirect.com/topics/engineering/convolutional-neural-networks) can be trained according to the following operation:\n\n{% raw %}\n$$\nθ^*=argmin_θ \\frac{1}{N_t}∑_{i∈D_t}∥x_{ref}^i−f_θ(x_0^i)∥\n$$\n{% endraw %}\n\nwhere ∥·∥ is the L2 norm, f represents the CNN, θ denotes the trainable parameters contained in the weights and biases, Dt is a mini-batch sample of size Nt, x0i is the *i*th element in the training data (noisy PET images), and xrefi is the *i*th element in the label data (clean PET images). Regarding supervised PET image denoising using anatomical information, in separate studies, [Liu and Qi et al. (2019)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0024), [Schramm et al. (2021)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0033), and [Chen et al. (2019)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0005) trained CNNs to map multi-modal images, including noisy PET and MR images, to obtain clean PET images. In accordance with these methods, the mapping function, fθ(x0i), in [Eq. (1)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0001) is represented by fθ(x0i,gi) using anatomical-guidance images, g. The supervised DL approach requires a vast number of low-dose (or short-time scan), high-dose (or long-time scan), and guidance image pairs.\n\n### 2.3. Unsupervised DL approach\n\nUnsupervised DL approaches such as DIP do not require label data for PET image denoising. The DIP training process is optimized as follows ([Ulyanov et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040)):\n\n{% raw %}\n$$\nθ^*=argmin_θ∥x_0−f_θ(z)∥,x^*=f_{θ^*}(z)\n$$\n{% endraw %}\n\nwhere x0 is a [noisy image](https://www.sciencedirect.com/topics/engineering/noisy-image), x* is the final [denoised image](https://www.sciencedirect.com/topics/engineering/denoised-image) output, and the network input z is random noise. The DIP algorithm uses a CNN to map a [degraded image](https://www.sciencedirect.com/topics/engineering/degraded-image), x0, and obtains the optimal denoised image by regularization of the architecture via moderate iteration. This is based purely on the prior information included in the CNN structure. [Hashimoto et al. (2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0015)), ([2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014)) proposed dynamic PET image denoising by directly inputting static PET images into 3D and 4D DIP as prior information. In contrast, [Cui et al. (2019)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008) and [Gong et al. (2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010)a) both proposed PET denoising methods that rely on inputting anatomical-guidance images, g (e.g., CT and MR images), instead of the DIP input, z. In these methods, the mapping function, fθ(z), in [Eq. (2)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0002) is represented by fθ(g).\n\nThe unsupervised DL approach can bridge the technical gap between the classical and supervised DL approaches for PET image denoising based on anatomical information. Nevertheless, previous methods often fail to clarify how the [semantic features](https://www.sciencedirect.com/topics/computer-science/semantic-feature) of the guidance image affect PET image denoising.\n\n## 3. Methodology\n\n### 3.1. MR-guided deep decoder\n\nTo explicitly utilize the [semantic features](https://www.sciencedirect.com/topics/computer-science/semantic-feature) of anatomical-guidance image for [PET](https://www.sciencedirect.com/topics/engineering/positron-emission-tomography) image denoising, we propose a method for unsupervised 3D PET image denoising based on anatomical information that uses an MR-guided deep decoder (MR-GDD), which is inspired by [Uezato et al. (2020)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0039). [Fig. 1](https://www.sciencedirect.com/science/article/pii/S1361841521002711#fig0001) shows the [network structure](https://www.sciencedirect.com/topics/computer-science/network-structure) of the proposed MR-GDD, which comprises two [subnetworks](https://www.sciencedirect.com/topics/engineering/subnetwork): an encoder-decoder subnetwork with a skip connection and a deep decoder subnetwork. The two subnetworks are connected by an upsampling refinement unit (URU) and a feature refinement unit (FRU), which incorporate an attention gate to weight the multi-scale features extracted from the MR image to the deep decoder subnetwork. This combined network performs end-to-end learning from scratch.\n\n![](https://picture.mulindya.com/MR-guided-deep-decoder.jpg)\n\nFig. 1. Overview of the proposed MR-GDD used for unsupervised 3D [PET](https://www.sciencedirect.com/topics/engineering/positron-emission-tomography) image denoising. This architecture consists of two [subnetworks](https://www.sciencedirect.com/topics/engineering/subnetwork) connected by attention gates: an encoder-decoder subnetwork with a skip connection (top) and a deep decoder subnetwork (bottom). This combined architecture is optimized using end-to-end learning. The attention gates in the upsampling refinement unit (URU) and the feature refinement unit (FRU) guide the optimization of noisy PET image using the multi-scale [semantic features](https://www.sciencedirect.com/topics/computer-science/semantic-feature) extracted from the MR image. This architecture can prevent the semantic features of the MR image from leaking.\n\n#### 3.1.1. Encoder-decoder subnetwork\n\nThe encoder-decoder subnetwork is designed to extract low-scale to high-scale hierarchical semantic features from the MR image. It is based on the 3D U-Net architecture ([Çiçek et al., 2016](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0006)) and consists of encoding and decoding paths. In the encoding path, the combination of a 3 × 3 × 3 3D [convolution layer](https://www.sciencedirect.com/topics/computer-science/convolution-layer) with [batch normalization](https://www.sciencedirect.com/topics/computer-science/batch-normalization) (BN) and a leaky rectified linear unit (LReLU) is repeated twice, before being constructed by a 3 × 3 × 3 3D convolution layer with two strides for downsampling, followed by the BN and LReLU. At each downsampling step, the size of the feature maps is halved. In the decoding path, the outputs of the upsampling layer and the skip connection supplied from the encoding path are added, before the combination of the 3 × 3 × 3 3D convolution layer with the BN and LReLU is repeated twice. At each upsampling step, the size of the feature maps is doubled.\n\n#### 3.1.2. Deep decoder subnetwork\n\nThe deep decoder subnetwork reconstructs the denoised PET image from the network input filled with uniform noise. Each step in the deep decoder subnetwork is upsampled first by the URU, then by a 3 × 3 × 3 3D convolution layer, and finally by the BN, LReLU, and FRU. Owing to the presence the attention gates, the URU and FRU can generate conditional weights using the MR image features via a 1 × 1 × 1 3D convolution layer, LReLU, and [sigmoid function](https://www.sciencedirect.com/topics/engineering/sigmoid-function), and then weights the features obtained from the pre-layer in the deep decoder. The URU promotes the [spatial locality](https://www.sciencedirect.com/topics/computer-science/spatial-locality) of MR image features, whereas the FRU promotes similar semantic alignment. Finally, a 1 × 1 × 1 3D convolution layer outputs a denoised PET image.\n\n### 3.2. Loss function and optimization\n\nTo denoise the PET image, the training process of the proposed MR-GDD, which utilizes [unsupervised learning](https://www.sciencedirect.com/topics/computer-science/unsupervised-learning) that does not require PET reference data, is optimized as follows:\n\n{% raw %}\n$$\nθ^*=argmin_θ∥x_0−f_θ(z,g)∥,x^*=f_{θ^*}(z,g)\n$$\n{% endraw %}\n\nwhere ∥·∥ is the L2 norm, f represents the proposed MR-GDD network, the training label x0 represents the noisy PET image, and the network inputs z and g are the random noise and the MR-guidance image, respectively. The input noise was generated by adding a fixed uniform random noise and [Gaussian noise](https://www.sciencedirect.com/topics/engineering/gaussian-white-noise) with different seed for each epoch. The attention gates used in the proposed architecture help optimize the noisy PET image by using the multi-scale semantic features extracted from a [guidance image](https://www.sciencedirect.com/topics/medicine-and-dentistry/image-guided-intervention) g. If the *k*-th scale feature of the encoder path in the encoder-decoder subnetwork is defined as Γk and the *k*-th scale features of the decoder path are defined as Ξk, the influence on the mapping function, f, can be expressed as follows:\n\n{% raw %}\n$$\nf=f_θ(z|Γ1,⋯Γk,Ξ1,⋯Ξk).\n$$\n{% endraw %}\n\nIn this method, the limited memory BFGS (L-BFGS) algorithm ([Zhu et al., 1997](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0048)), which is a quasi-Newtonian method, is introduced to solve the nonlinear [least squares problem](https://www.sciencedirect.com/topics/engineering/least-square-problem) described by [Eq. (3)](https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0003). By considering the approximate [Hessian matrix](https://www.sciencedirect.com/topics/engineering/hessian-matrix) based on the second-order gradient, the L2 norm converges more stably and quickly than first-order [gradient descent](https://www.sciencedirect.com/topics/engineering/gradient-descent) algorithms, such as the stochastic gradient descent algorithm or Adam. In addition, because a small amount of data is generated as a result of using the unsupervised architecture, which does not require a prior [training dataset](https://www.sciencedirect.com/topics/computer-science/training-dataset), the MR-GDD can reduce the computational complexity and load required to performed denoising. We used the L-BFGS algorithm at a learning rate of 0.01 without line search to minimize the processing time. The proposed architecture was processed using PyTorch 1.6.0 on Ubuntu 16.04 with acceleration by a [graphics processing unit](https://www.sciencedirect.com/topics/engineering/graphics-processing-unit) (NVIDIA Quadro RTX8000 with 48 GB memory).\n\n## 4. Experimental setup\n\nA simulation study using [18F]fluoro-2-deoxy-D-glucose (FDG), a preclinical study using [18F]FDG and [11C]raclopride, and a clinical study using [18F]florbetapir ([Wong et al., 2010](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0043)) were performed to verify the effectiveness of the proposed [PET](https://www.sciencedirect.com/topics/engineering/positron-emission-tomography) image denoising method. In addition, the denoising performance of the proposed MR-GDD was compared against four other unsupervised algorithms under the same conditions as the proposed MR-GDD;\n\n- *Gaussian filtering (GF).* GF is a basic post-denoising method for suppressing noise in PET images. We used a 3D [Gaussian kernel](https://www.sciencedirect.com/topics/engineering/gaussian-kernel).\n- *Image guided filtering (IGF).* IGF performs PET image denoising by adapting a local linear model using a [guidance image](https://www.sciencedirect.com/topics/medicine-and-dentistry/image-guided-intervention) ([Hashimoto et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0016); [He et al., 2013](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0017)). We used the MR image as the guidance image.\n- *Deep image prior (DIP).* The general DIP algorithm uses random noise as the network input ([Ulyanov et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040)). We used the encoder-decoder network in the proposed MR-GDD as the DIP architecture.\n- *MR-DIP.* MR-DIP uses an MR prior as a direct input in the DIP architecture ([Cui et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008); [Gong et al., 2019](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010)a). We used the same architecture as in the DIP algorithm.\n\nAs a pre-processing step for all the data, voxel intensity normalization was performed on each of the MR and PET images. The MR image intensity was normalized in the [0, 1] range using a min-max normalization technique. Furthermore, the 99.95th [percentile](https://www.sciencedirect.com/topics/engineering/percentile) was defined for PET image intensity, which was also normalized in the [0, 1] range using a min-max normalization technique.\n\n### 4.1. Simulation study\n\nWe performed a [Monte Carlo simulation](https://www.sciencedirect.com/topics/medicine-and-dentistry/monte-carlo-method) using the 3D brain phantom from BrainWeb ([Aubert-Broche et al., 2006](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0002)). The Monte Carlo simulation modeled the geometry of a brain-dedicated PET scanner (HITS-655000 ([Watanabe et al., 2017](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0042)), [Hamamatsu Photonics](https://www.sciencedirect.com/topics/computer-science/hamamatsu-photonics) K.K., Japan). The scanner consists of 32 detector blocks with [cerium](https://www.sciencedirect.com/topics/engineering/cerium) doped [lutetium](https://www.sciencedirect.com/topics/engineering/lutetium) [yttrium](https://www.sciencedirect.com/topics/engineering/yttrium) [orthosilicate](https://www.sciencedirect.com/topics/engineering/orthosilicates) crystals per ring, with 5 of these blocks aligned to the scanner axis. To ensure a mismatch between the MR and PET images, two hot spheres (with radii of 10 and 12 mm, respectively) were inserted exclusively into the PET image to present tumor regions. Then, we simulated a static [18F]FDG scan equivalent to 150 M counts, including attenuation and scattering effects. An attenuation map was created from the segmented MR image, and the attenuation effects of water and bone were considered. The gray matter:white matter:cerebrospinal fluid:left tumor:right tumor activity ratio was set to 1:0.25:0.05:2:2 based on the [18F]FDG contrast. We also simulated low-activity tumor data (left tumor:right tumor activity ratio was set to 1.5:1.2) for some low-grade tumors or pathology linked to [neurodegenerative disease](https://www.sciencedirect.com/topics/medicine-and-dentistry/degenerative-disease). To generate the reference PET image, the simulated list-mode data were reconstructed using a 3D list-mode dynamic row-action maximum-likelihood algorithm (DRAMA) ([Tanaka and Kudo, 2010](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0037)) with two iterations and 40 subsets. The reconstructed image measured 128 × 128 × 83 voxels (2.6 × 2.6 × 2.4 mm/voxel). The reference image was reconstructed using all the list-mode data. The noisy PET image was obtained by periodically downsampling to 1/30th of the reference list-mode data (see Supplementary Material 0.1) and reconstructing the low-count image (5 M counts). The corresponding T1-weighted MR image was used as the guidance image.\n\n### 4.2. Preclinical study\n\nA preclinical study was conducted using monkeys and was approved by the Animal Ethics Committees of the Central [Research Laboratory](https://www.sciencedirect.com/topics/engineering/research-laboratories), Hamamatsu Photonics K.K. PET scans using [18F]FDG and [11C]raclopride imaged the brains of conscious [rhesus monkeys](https://www.sciencedirect.com/topics/engineering/rhesus-monkey), whose bodies and heads were fixed using an animal PET scanner (SHR-38000 ([Hamamatsu 2021](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0013)), Hamamatsu Photonics K.K., Japan). After a 30 min transmission scan using a 68Ge-68Ga source, doses of [18F]FDG (113 MBq) and [11C]raclopride (282 MBq) were injected into each monkey, before dynamic PET scans were performed for 120 and 90 min, respectively. We performed image reconstruction using 3D DRAMA with two iterations and 60 subsets that incorporated attenuation correction via transmission scan data. The reconstructed images measured 256 × 256 × 103 voxels (0.65 × 0.65 × 1.0167 mm/voxel) and were cropped [to 192](https://www.sciencedirect.com/topics/medicine-and-dentistry/pamicogrel) × 192 × 64 voxels to reduce the demand on the [GPU](https://www.sciencedirect.com/topics/engineering/graphics-processing-unit) memory. The reference images were reconstructed using all the list-mode data for [18F]FDG and the list mode data for the 60 min period between 30 and 90 min of the scan such that the contrast created by the distribution of [11C]raclopride in the striatum to be observed clearly. Each noisy PET image was obtained by periodically downsampling to 1/10th of the reference list-mode data. The corresponding T1-weighted MR images were taken on another day and registered manually by two radiological [technologists](https://www.sciencedirect.com/topics/engineering/technologist).\n\n### 4.3. Clinical study\n\nAn amyloid scan using [18F]florbetapir was conducted on the human brain of a cognitive normal subject using a Biograph mMR scanner (Siemens Healthineers, Germany) as part of the “Insight 46″ sub-study of the MRC National Survey of Health and Development ([Lane et al., 2017](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0020); [Markiewicz et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0025)a). The PET data were acquired dynamically for 60 min using a [18F]florbetapir dose of 409 MBq. During PET image reconstruction, attenuation correction was performed via a pseudo-CT image, which was synthesized using T1- and T2-weighted MR images that were acquired simultaneously, and enabled an μ-map to be was calculated. Image reconstruction was performed using an ordered subset expectation maximization (OS-EM) algorithm involving four iterations and 14 subsets using the NiftyPET package ([Markiewicz et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0026)b). The reconstructed images comprised 334 × 334 × 127 voxels (2 × 2 × 2 mm/voxel), which were cropped to 128 × 128 × 83 voxels to reduce the demand on the GPU memory. The reference image was reconstructed using the list-mode data for the period from 30 to 60 min to observe the contrast between gray and white matter clearly. The noisy PET image was obtained by periodically downsampling to 1/10th of the reference list-mode data.\n\n### 4.4. Evaluation metrics\n\nTo quantitatively evaluate the performance of different denoising methods, for the simulation study, we calculated the peak signal-to-noise ratio (PSNR) and structural similarity (SSIM) of the target image, x, and the reference image, xref, which are defined as\n\n{% raw %}\n$$\nPSNR=10log_{10}(\\frac{max(x^{ref})^2}{\\frac{1}{N_R}∑_{j∈R}(x_j−x_j^{ref})^2})\n$$\n\n{% endraw %}\n\nand\n\n{% raw %}\n$$\nSSIM=\\frac{1}{N_R}∑_{j∈R}\\frac{(2μ_{jx}μ_{jx^{ref}}+c_1)(2σ_{jxx^{ref}}+c_2)}{(μ_{jx}^2+μ_{jx^{ref}}^2+c_1)(σ_{jx}^2+σ_{jx^{ref}}^2+c^2)}\n$$\n\n{% endraw %}\n\nrespectively. Here, R and NR represent the brain region in the PET image and the number of voxels, respectively, μ and σ are the mean and standard deviation of the square window corresponding to the *j*-th voxel, respectively, and σjxxref is the covariance between x and xref. Furthermore, c1=(0.01L)2 and c2=(0.03L)2 where L represents the dynamic range of the reference. The contrast-to-noise ratio (CNR) between gray matter and white matter was calculated as(7)CNR=|Sg¯−Sw¯|σg2+σw2,where Sg¯, Sw¯ and σg, σw are the mean activity and standard deviation corresponding to the regions of interest (ROIs) in the gray and white matter, respectively. The ROIs were constructed in the gray matter regions on the left and right brains of different slices, whereas the white matter regions were selected within the centrum semiovale ([Paxinos et al., 2000](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0028)). In the [11C]raclopride calculation, the ROIs were set on the [putamen](https://www.sciencedirect.com/topics/medicine-and-dentistry/putamen) instead of the gray matter. A Wilcoxon signed-rank test was performed on the PSNR, SSIM, and CNR to compare the performance of different denoising methods. As the noisy PET data were generated by downsampling the reference list-mode data, we generated multiple independent noisy samples (10 samples) to examine the uncertainty and test the statistical significance.\n\nWe also evaluated the tradeoffs between noise and quantitative information of the [denoised images](https://www.sciencedirect.com/topics/engineering/denoised-image) when FWHM (GF), ε (IGF), and epochs (CNNs) are changed. For the simulation study, we calculated the tradeoff between the mean squared bias and the variance in the ROI:(8)Bias2=∑j∈R(xj−xjref)2∑j∈R(xjref)2,(7)Variance=∑j∈R(xj−x¯)2∑j∈R(xjref)2,where R denotes the tumor regions, x¯ is the average pixel value inside the ROI. For preclinical study, we calculated the tradeoff between the mean uptake (putamen and caudate and striatum) and the standard deviation (white matter). Each ROI used for the evaluation was set manually to include any partial volume voxels on the MR image and was calculated via superimposition on the co-registered PET image.\n\nThus far, the optimization process for the DIP algorithm has only been reported as a conceptual diagram ([Hashimoto et al., 2020](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014); [Ulyanov et al., 2018](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040)), with several aspects such as the actual behavior remaining unclarified. To elucidate the DIP optimization process, we visualized it by performing nonlinear dimensionally reduction using the locally linear embedding (LLE) algorithm ([Saul and Roweis, 2003](https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0031)), which implements manifold learning. We projected the PET data used for optimization under different training conditions onto a three-dimensional manifold, considering a neighborhood of 15 for each point.","slug":"学习笔记/paper/brain-pet-paper1","published":1,"updated":"2022-01-18T08:10:17.115Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckyk1p0le00o6ast98tw3aef9","content":"<blockquote>\n<p>2021年2月投稿的一篇论文《Anatomical-guided attention enhances unsupervised PET image denoising performance》提出使用Anatomical-guided的注意力加强非监督的PET图像降噪性能。</p>\n</blockquote>\n<h2 id=\"ABSTRACT\">ABSTRACT</h2>\n<blockquote>\n<p>Although supervised convolutional neural networks (CNNs) often outperform conventional alternatives for denoising positron emission tomography (PET) images, they require many low- and high-quality reference PET image pairs. Herein, we propose an unsupervised 3D PET image denoising method based on an anatomical information-guided attention mechanism. The proposed magnetic resonance-guided deep decoder (MR-GDD) utilizes the spatial details and semantic features of MR-guidance image more effectively by introducing encoder-decoder and deep decoder subnetworks. Moreover, the specific shapes and patterns of the guidance image do not affect the denoised PET image, because the guidance image is input to the network through an attention gate. In a Monte Carlo simulation of [18F]fluoro-2-deoxy-D-glucose (FDG), the proposed method achieved the highest peak signal-to-noise ratio and structural similarity (27.92 ± 0.44 dB/0.886 ± 0.007), as compared with Gaussian filtering (26.68 ± 0.10 dB/0.807 ± 0.004), image guided filtering (27.40 ± 0.11 dB/0.849 ± 0.003), deep image prior (DIP) (24.22 ± 0.43 dB/0.737 ± 0.017), and MR-DIP (27.65 ± 0.42 dB/0.879 ± 0.007). Furthermore, we experimentally visualized the behavior of the optimization process, which is often unknown in unsupervised CNN-based restoration problems. For preclinical (using [18F]FDG and [11C]raclopride) and clinical (using [18F]florbetapir) studies, the proposed method demonstrates state-of-the-art denoising performance while retaining spatial resolution and quantitative accuracy, despite using a common network architecture for various noisy PET images with 1/10th of the full counts. These results suggest that the proposed MR-GDD can reduce PET scan times and PET tracer doses considerably without impacting patients.</p>\n</blockquote>\n<h5 id=\"总结\">总结</h5>\n<p>使用监督训练CNN网络比传统的方法在PET降噪处理上效果表现的更好，但是需要 low- and high-quality reference PET image pairs作为label。因此基于解剖学信息指引的注意力机制提出了无监督的3D的PET图像的重建。</p>\n<ul>\n<li>此网络（MR-GDD）引入了两个子网络（encoder-decoder and deep decoder subnetworks）更效率地利用MR（核磁共振）图像的空间信息和语义特征。</li>\n<li>同时，由于guidance image通过attention gate后再输入网络，特定的guidance image的shapes和patterns不会影响降噪的PET图像。</li>\n<li>并且，我们通过实验可视化了优化过程的行为。这在无监督卷积图像重建通常是无法表示的。</li>\n</ul>\n<h2 id=\"Introduction\">Introduction</h2>\n<blockquote>\n<p>Positron emission tomography (PET) is a functional imaging modality that observes the molecular-level activity in tissues caused by radioactive tracers. It offers excellent diagnostic accuracy both for observing normal tissues and for detecting specific diseases such as cancer and neurodegenerative disorders (Phelps, 2012). In response to the increased demand for more accurate dementia diagnosis in recent years, brain-dedicated PET scanners with enhanced sensitivity that are capable of acquiring high-resolution brain images have been developed (Tashima et al., 2019; Watanabe et al., 2017). The acquisition of high-quality diagnostic PET images requires the administration of high dose or a long scan time. However, massive radiation exposure to PET tracers may induce genetic damage and cancerous growths, thereby raising health risk concerns (ICRP, 2017). Therefore, to mitigate the radiation exposure-related risk, it is desirable to administer low-dose PET tracers. Unfortunately, this increases the statistical noise, thus degrading the quality of PET images and potentially affecting the diagnostic accuracy. Thus, improved noise suppression methods for PET images are essential.</p>\n</blockquote>\n<h5 id=\"逻辑\">逻辑</h5>\n<p>为了治疗疾病 —&gt;  需要获取高像素的脑PET图像 —&gt;  需要高剂量&amp;长时间的扫描时间 —&gt; 引发健康风险 —&gt; 只能使用低剂量的PET示踪剂 —&gt; 改进用于 PET 图像的噪声抑制方法是必不可少的。</p>\n<blockquote>\n<p>Conventionally, Gaussian filtering (GF) is applied as a basic post-denoising method, despite compromising the spatial resolution and, thus, the quantitative accuracy of PET images. To avoid such compromises, various denoising algorithms, such as bilateral filtering (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0018\">Hoifheinz et al., 2011</a>), non-local means filtering (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0001\">Arabi and Zaidi, 2020</a>), image-guided filtering (IGF) (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0017\">He et al., 2013</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0016\">Hashimoto et al., 2018</a>), and block-matching filtering (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0027\">Ote et al., 2020</a>) have been developed and applied to PET images. These post-denoising algorithms provide a better denoising performance than GF while retaining spatial resolution and quantitative accuracy.</p>\n</blockquote>\n<h5 id=\"传统降噪方法\">传统降噪方法</h5>\n<p>高斯滤波 (GF) 被用作基本的后去噪方法，尽管会影响空间分辨率，从而影响 PET 图像的定量精度。后来使用双边滤波、非局部均值滤波、图像引导过滤（IGF）和块匹配过滤的去噪方法。这些去噪算法提供了比 GF 更好的去噪性能，同时保留了空间分辨率和定量精度。</p>\n<blockquote>\n<p>Aside from the above mentioned conventional <a href=\"https://www.sciencedirect.com/topics/engineering/filtering-algorithm\">filtering algorithms</a>, methods based on deep learning (DL) have been applied in various medical fields (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0023\">Litjens et al., 2017</a>), and the use of <a href=\"https://www.sciencedirect.com/topics/engineering/convolutional-neural-networks\">convolutional neural networks</a> (CNNs) has been reported to improve the quality of PET images (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010\">Gong et al., 2019</a>a; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0012\">Häggström et al., 2019</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0024\">Liu and Qi, 2019</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0030\">Sanaat et al., 2020</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0034\">Sphuler et al., 2020</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0047\">Zhou et al., 2020</a>). However, the general CNN-based denoising methods typically require a pair of large reference datasets comprising high-quality images. This is a major problem in clinical usage owing to the difficulty of preparing huge sets of low-noise PET data without unduly burdening patients. In addition, the huge volume of novel PET tracers being developed, makes it difficult to collect large amounts of training data for each domain. The interpretation of denoised PET images may suffer inherent biases if unknown cases are excluded from the <a href=\"https://www.sciencedirect.com/topics/computer-science/training-dataset\">training dataset</a>. Despite these challenges, DL algorithms often outperform conventional denoising algorithms. Therefore, there is a need for technology that can be uniformly adapted to various domains without using high-quality PET data.</p>\n</blockquote>\n<h5 id=\"深度学习方法的难题\">深度学习方法的难题</h5>\n<p>除了上述传统过滤算法之外，基于深度学习 (DL) 的方法已应用于各个医学领域，使用卷积神经网络 (CNN) 可以提高PET 图像质量。而深度学习的去噪方法需要高质量图像的大型参考数据集。但是在不给患者造成过度负担的情况下准备大量的低噪声 PET 数据是一个难题，因此目标是需要能够在不使用高质量 PET 数据的情况下，统一适应各种情况的方法。</p>\n<blockquote>\n<p>In recent years, unsupervised or self-supervised DL approaches such as Noise2Noise and deep image prior (DIP) have demonstrated the potential to overcome these challenges (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0021\">Lehtinen et al., 2018</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040\">Ulyanov et al., 2018</a>). In particular, the DIP algorithm is a powerful noise suppression method that does not require the preparation of a prior training dataset (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0015\">Hashimoto et al., 2019</a>, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014\">2020</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0022\">Lin and Huang, 2020</a>). Furthermore, PET reconstruction and denoising methods in which <a href=\"https://www.sciencedirect.com/topics/engineering/computed-tomography\">computed tomography</a> (CT) and magnetic resonance (MR) images serve as the prior images input to the DIP framework have been developed (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008\">Cui et al., 2019</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0011\">Gong et al., 2019</a>b). Compared to PET alone, the denoising performance has been improved by using multi-modal data combined with anatomical information. However, while this method shows potential for adapting various PET image denoising approaches, the <a href=\"https://www.sciencedirect.com/topics/computer-science/network-architecture\">network architecture</a> does not fully utilize the <a href=\"https://www.sciencedirect.com/topics/computer-science/semantic-feature\">semantic features</a> or image details of anatomical-guidance images. Furthermore, the process of converting the guidance image to the PET image can result in the shape and pattern of the guidance image remaining in the output PET image, with the extent to which the features of the guidance image affect PET image denoising is yet to be elucidated. Moreover, the process by which the DIP algorithm optimizes the denoising remains unclear. Therefore, these issues must be clarified for future development.</p>\n</blockquote>\n<h5 id=\"深度学习改进方法：Noise2Noise；DIP；\">深度学习改进方法：Noise2Noise；DIP；</h5>\n<h5 id=\"DIP的优点：\">DIP的优点：</h5>\n<ul>\n<li>一种强大的噪声抑制方法，不需要准备先验训练数据集；</li>\n<li>其中计算机断层扫描 (CT) 和磁共振 (MR) 图像作为输入到 DIP 框架的先验图像；</li>\n<li>与单独的 PET 相比，通过使用多模态数据结合解剖信息，去噪性能得到了提高。</li>\n</ul>\n<h5 id=\"DIP的问题：\">DIP的问题：</h5>\n<ul>\n<li>网络架构并没有充分利用解剖指导图像的语义特征或图像细节；</li>\n<li>引导图像转换为PET图像的过程会导致输出PET图像中保留引导图像的形状和图案；</li>\n<li>引导图像的特征对PET图像去噪的影响程度尚待确定且阐明；</li>\n<li>DIP算法优化去噪的过程仍不清楚。</li>\n</ul>\n<blockquote>\n<p>In this study, we propose an unsupervised 3D PET image denoising method that incorporates anatomical information into the DIP architecture via an attention mechanism. The attention gates (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0009\">Fukui et al., 2019</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0032\">Schlemper et al., 2019</a>) used in the proposed network help optimize a noisy PET image using multi-scale semantic features extracted from the guidance image. As such, this method can prevent the leakage of guidance image features. The guidance of multi-scale features can lead to an effective regularizer for PET image denoising. The main contributions of this study are as follows:</p>\n<ul>\n<li>We propose a new PET image denoising method guided by anatomical information using an unsupervised <a href=\"https://www.sciencedirect.com/topics/computer-science/deep-learning-method\">DL method</a>.</li>\n<li>We demonstrate that the proposed network has the flexibility to handle the different PET tracer domains used to show the distribution of various tissues in the brains of human and non-human primates.</li>\n<li>The behavior of the optimization process is visualized experimentally, thereby providing useful insights that were unresolved in unsupervised CNN-based restoration problems.</li>\n</ul>\n</blockquote>\n<h5 id=\"本文的方法：\">本文的方法：</h5>\n<p>使用了无监督的3D的PET图像降噪方法，该方法通过<strong>注意机制将解剖信息整合到 DIP 架构中</strong>，使用从引导图像中提取的多尺度语义特征来优化嘈杂的 PET 图像。多尺度特征的引导可以为 PET 图像去噪提供有效的正则化器。</p>\n<h5 id=\"贡献：\">贡献：</h5>\n<ul>\n<li>\n<p>我们提出了一种新的 PET 图像去噪方法，该方法使用无监督的 DL 方法<strong>以解剖信息为指导</strong>；</p>\n</li>\n<li>\n<p>具有处理不同PET 示踪域的<strong>灵活性</strong>，可以用于显示人类和非人类灵长类动物大脑中各种组织的分布；</p>\n</li>\n<li>\n<p>优化过程的行为通过实验进行<strong>可视化</strong>，从而提供在基于 CNN 的无监督重建问题中未解决问题的相关见解。</p>\n</li>\n</ul>\n<h2 id=\"2-Related-work\">2. Related work</h2>\n<blockquote>\n<p>The <a href=\"https://www.sciencedirect.com/topics/engineering/positron-emission-tomography\">PET</a> image restoration process is further complicated by the limited availability of information that can be extracted from noisy PET data. Another approach adopted for PET image denoising is to use anatomical prior extracted from the <a href=\"https://www.sciencedirect.com/topics/engineering/computed-tomography\">CT</a> or MR images of the patient for <a href=\"https://www.sciencedirect.com/topics/engineering/regularization\">regularization</a>. Because multi-modal images have become easier to obtain owing to the increasing availability of PET/CT and PET/MR scanners, various <a href=\"https://www.sciencedirect.com/topics/engineering/hybrid-method\">hybrid methods</a> using anatomical priors have been developed to facilitate PET image denoising.</p>\n</blockquote>\n<p>PET 图像去噪采用的另一种方法是<strong>使用从患者的 CT 或 MR 图像中提取的解剖先验</strong>进行正则化。由于 PET/CT 和 PET/MR 扫描仪的可用性不断提高，多模态图像变得更容易获得，因此开发了各种使用解剖学先验的混合方法来促进 PET 图像去噪。</p>\n<h3 id=\"2-1-Classical-approach\">2.1. Classical approach</h3>\n<blockquote>\n<p>Conventionally, hybrid denoising methods using anatomical priors have been adopted for PET image reconstruction and post-filtering. For example, <a href=\"https://www.sciencedirect.com/topics/engineering/maximum-a-posteriori\">maximum a posteriori</a> image reconstruction has been incorporated alongside anatomical priors (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0007\">Comtat et al., 2002</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0041\">Vunckx et al., 2012</a>). In addition, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0035\">Sudarshan et al. (2020)</a> proposed joint PET and MR image reconstruction using a patch-based joint-dictionary prior. <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0003\">Bland et al. (2018)</a> introduced MR-derived kernels to the kernel expectation maximization reconstruction. Although advanced image reconstruction algorithms can provide better denoising performance, they require significant computational resources and it is often difficult to set optimal parameters. Therefore, anatomically-guided post-denoising is often performed separately from the image reconstruction process. <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0004\">Chan et al. (2014)</a> proposed incorporating CT information and applying median non-local mean filtering to achieve PET denoising. Alternatively, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0045\">Yan et al. (2015)</a> proposed MR-guided PET filtering by adapting a local linear model. In addition, the authors performed partial volume correction without MR image <a href=\"https://www.sciencedirect.com/topics/engineering/parcellation\">parcellation</a> by incorporating <a href=\"https://www.sciencedirect.com/topics/engineering/partial-volume-effect\">partial volume effects</a> into the model.</p>\n</blockquote>\n<h5 id=\"经典方法：\">经典方法：</h5>\n<p>将解剖先验的混合去噪方法应用于PET图像重建和后滤波处理，将最大后验图像重建与解剖先验结合在一起。基于a patch-based joint-dictionary prior联合PET和MR图像重建</p>\n<h3 id=\"2-2-Supervised-DL-approach\">2.2. Supervised DL approach</h3>\n<p>The supervised DL approach has recently demonstrated state-of-the-art performance in PET image denoising. When large amounts of training and label PET data pairs are available, the general <a href=\"https://www.sciencedirect.com/topics/engineering/convolutional-neural-networks\">CNN</a> can be trained according to the following operation:</p>\n\n$$\nθ^*=argmin_θ \\frac{1}{N_t}∑_{i∈D_t}∥x_{ref}^i−f_θ(x_0^i)∥\n$$\n\n<p>where ∥·∥ is the L2 norm, f represents the CNN, θ denotes the trainable parameters contained in the weights and biases, Dt is a mini-batch sample of size Nt, x0i is the <em>i</em>th element in the training data (noisy PET images), and xrefi is the <em>i</em>th element in the label data (clean PET images). Regarding supervised PET image denoising using anatomical information, in separate studies, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0024\">Liu and Qi et al. (2019)</a>, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0033\">Schramm et al. (2021)</a>, and <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0005\">Chen et al. (2019)</a> trained CNNs to map multi-modal images, including noisy PET and MR images, to obtain clean PET images. In accordance with these methods, the mapping function, fθ(x0i), in <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0001\">Eq. (1)</a> is represented by fθ(x0i,gi) using anatomical-guidance images, g. The supervised DL approach requires a vast number of low-dose (or short-time scan), high-dose (or long-time scan), and guidance image pairs.</p>\n<h3 id=\"2-3-Unsupervised-DL-approach\">2.3. Unsupervised DL approach</h3>\n<p>Unsupervised DL approaches such as DIP do not require label data for PET image denoising. The DIP training process is optimized as follows (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040\">Ulyanov et al., 2018</a>):</p>\n\n$$\nθ^*=argmin_θ∥x_0−f_θ(z)∥,x^*=f_{θ^*}(z)\n$$\n\n<p>where x0 is a <a href=\"https://www.sciencedirect.com/topics/engineering/noisy-image\">noisy image</a>, x* is the final <a href=\"https://www.sciencedirect.com/topics/engineering/denoised-image\">denoised image</a> output, and the network input z is random noise. The DIP algorithm uses a CNN to map a <a href=\"https://www.sciencedirect.com/topics/engineering/degraded-image\">degraded image</a>, x0, and obtains the optimal denoised image by regularization of the architecture via moderate iteration. This is based purely on the prior information included in the CNN structure. <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0015\">Hashimoto et al. (2019</a>), (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014\">2020</a>) proposed dynamic PET image denoising by directly inputting static PET images into 3D and 4D DIP as prior information. In contrast, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008\">Cui et al. (2019)</a> and <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010\">Gong et al. (2019</a>a) both proposed PET denoising methods that rely on inputting anatomical-guidance images, g (e.g., CT and MR images), instead of the DIP input, z. In these methods, the mapping function, fθ(z), in <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0002\">Eq. (2)</a> is represented by fθ(g).</p>\n<p>The unsupervised DL approach can bridge the technical gap between the classical and supervised DL approaches for PET image denoising based on anatomical information. Nevertheless, previous methods often fail to clarify how the <a href=\"https://www.sciencedirect.com/topics/computer-science/semantic-feature\">semantic features</a> of the guidance image affect PET image denoising.</p>\n<h2 id=\"3-Methodology\">3. Methodology</h2>\n<h3 id=\"3-1-MR-guided-deep-decoder\">3.1. MR-guided deep decoder</h3>\n<p>To explicitly utilize the <a href=\"https://www.sciencedirect.com/topics/computer-science/semantic-feature\">semantic features</a> of anatomical-guidance image for <a href=\"https://www.sciencedirect.com/topics/engineering/positron-emission-tomography\">PET</a> image denoising, we propose a method for unsupervised 3D PET image denoising based on anatomical information that uses an MR-guided deep decoder (MR-GDD), which is inspired by <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0039\">Uezato et al. (2020)</a>. <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#fig0001\">Fig. 1</a> shows the <a href=\"https://www.sciencedirect.com/topics/computer-science/network-structure\">network structure</a> of the proposed MR-GDD, which comprises two <a href=\"https://www.sciencedirect.com/topics/engineering/subnetwork\">subnetworks</a>: an encoder-decoder subnetwork with a skip connection and a deep decoder subnetwork. The two subnetworks are connected by an upsampling refinement unit (URU) and a feature refinement unit (FRU), which incorporate an attention gate to weight the multi-scale features extracted from the MR image to the deep decoder subnetwork. This combined network performs end-to-end learning from scratch.</p>\n<p><img src=\"https://picture.mulindya.com/MR-guided-deep-decoder.jpg\" alt=\"\"></p>\n<p>Fig. 1. Overview of the proposed MR-GDD used for unsupervised 3D <a href=\"https://www.sciencedirect.com/topics/engineering/positron-emission-tomography\">PET</a> image denoising. This architecture consists of two <a href=\"https://www.sciencedirect.com/topics/engineering/subnetwork\">subnetworks</a> connected by attention gates: an encoder-decoder subnetwork with a skip connection (top) and a deep decoder subnetwork (bottom). This combined architecture is optimized using end-to-end learning. The attention gates in the upsampling refinement unit (URU) and the feature refinement unit (FRU) guide the optimization of noisy PET image using the multi-scale <a href=\"https://www.sciencedirect.com/topics/computer-science/semantic-feature\">semantic features</a> extracted from the MR image. This architecture can prevent the semantic features of the MR image from leaking.</p>\n<h4 id=\"3-1-1-Encoder-decoder-subnetwork\">3.1.1. Encoder-decoder subnetwork</h4>\n<p>The encoder-decoder subnetwork is designed to extract low-scale to high-scale hierarchical semantic features from the MR image. It is based on the 3D U-Net architecture (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0006\">Çiçek et al., 2016</a>) and consists of encoding and decoding paths. In the encoding path, the combination of a 3 × 3 × 3 3D <a href=\"https://www.sciencedirect.com/topics/computer-science/convolution-layer\">convolution layer</a> with <a href=\"https://www.sciencedirect.com/topics/computer-science/batch-normalization\">batch normalization</a> (BN) and a leaky rectified linear unit (LReLU) is repeated twice, before being constructed by a 3 × 3 × 3 3D convolution layer with two strides for downsampling, followed by the BN and LReLU. At each downsampling step, the size of the feature maps is halved. In the decoding path, the outputs of the upsampling layer and the skip connection supplied from the encoding path are added, before the combination of the 3 × 3 × 3 3D convolution layer with the BN and LReLU is repeated twice. At each upsampling step, the size of the feature maps is doubled.</p>\n<h4 id=\"3-1-2-Deep-decoder-subnetwork\">3.1.2. Deep decoder subnetwork</h4>\n<p>The deep decoder subnetwork reconstructs the denoised PET image from the network input filled with uniform noise. Each step in the deep decoder subnetwork is upsampled first by the URU, then by a 3 × 3 × 3 3D convolution layer, and finally by the BN, LReLU, and FRU. Owing to the presence the attention gates, the URU and FRU can generate conditional weights using the MR image features via a 1 × 1 × 1 3D convolution layer, LReLU, and <a href=\"https://www.sciencedirect.com/topics/engineering/sigmoid-function\">sigmoid function</a>, and then weights the features obtained from the pre-layer in the deep decoder. The URU promotes the <a href=\"https://www.sciencedirect.com/topics/computer-science/spatial-locality\">spatial locality</a> of MR image features, whereas the FRU promotes similar semantic alignment. Finally, a 1 × 1 × 1 3D convolution layer outputs a denoised PET image.</p>\n<h3 id=\"3-2-Loss-function-and-optimization\">3.2. Loss function and optimization</h3>\n<p>To denoise the PET image, the training process of the proposed MR-GDD, which utilizes <a href=\"https://www.sciencedirect.com/topics/computer-science/unsupervised-learning\">unsupervised learning</a> that does not require PET reference data, is optimized as follows:</p>\n\n$$\nθ^*=argmin_θ∥x_0−f_θ(z,g)∥,x^*=f_{θ^*}(z,g)\n$$\n\n<p>where ∥·∥ is the L2 norm, f represents the proposed MR-GDD network, the training label x0 represents the noisy PET image, and the network inputs z and g are the random noise and the MR-guidance image, respectively. The input noise was generated by adding a fixed uniform random noise and <a href=\"https://www.sciencedirect.com/topics/engineering/gaussian-white-noise\">Gaussian noise</a> with different seed for each epoch. The attention gates used in the proposed architecture help optimize the noisy PET image by using the multi-scale semantic features extracted from a <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/image-guided-intervention\">guidance image</a> g. If the <em>k</em>-th scale feature of the encoder path in the encoder-decoder subnetwork is defined as Γk and the <em>k</em>-th scale features of the decoder path are defined as Ξk, the influence on the mapping function, f, can be expressed as follows:</p>\n\n$$\nf=f_θ(z|Γ1,⋯Γk,Ξ1,⋯Ξk).\n$$\n\n<p>In this method, the limited memory BFGS (L-BFGS) algorithm (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0048\">Zhu et al., 1997</a>), which is a quasi-Newtonian method, is introduced to solve the nonlinear <a href=\"https://www.sciencedirect.com/topics/engineering/least-square-problem\">least squares problem</a> described by <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0003\">Eq. (3)</a>. By considering the approximate <a href=\"https://www.sciencedirect.com/topics/engineering/hessian-matrix\">Hessian matrix</a> based on the second-order gradient, the L2 norm converges more stably and quickly than first-order <a href=\"https://www.sciencedirect.com/topics/engineering/gradient-descent\">gradient descent</a> algorithms, such as the stochastic gradient descent algorithm or Adam. In addition, because a small amount of data is generated as a result of using the unsupervised architecture, which does not require a prior <a href=\"https://www.sciencedirect.com/topics/computer-science/training-dataset\">training dataset</a>, the MR-GDD can reduce the computational complexity and load required to performed denoising. We used the L-BFGS algorithm at a learning rate of 0.01 without line search to minimize the processing time. The proposed architecture was processed using PyTorch 1.6.0 on Ubuntu 16.04 with acceleration by a <a href=\"https://www.sciencedirect.com/topics/engineering/graphics-processing-unit\">graphics processing unit</a> (NVIDIA Quadro RTX8000 with 48 GB memory).</p>\n<h2 id=\"4-Experimental-setup\">4. Experimental setup</h2>\n<p>A simulation study using [18F]fluoro-2-deoxy-D-glucose (FDG), a preclinical study using [18F]FDG and [11C]raclopride, and a clinical study using [18F]florbetapir (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0043\">Wong et al., 2010</a>) were performed to verify the effectiveness of the proposed <a href=\"https://www.sciencedirect.com/topics/engineering/positron-emission-tomography\">PET</a> image denoising method. In addition, the denoising performance of the proposed MR-GDD was compared against four other unsupervised algorithms under the same conditions as the proposed MR-GDD;</p>\n<ul>\n<li><em>Gaussian filtering (GF).</em> GF is a basic post-denoising method for suppressing noise in PET images. We used a 3D <a href=\"https://www.sciencedirect.com/topics/engineering/gaussian-kernel\">Gaussian kernel</a>.</li>\n<li><em>Image guided filtering (IGF).</em> IGF performs PET image denoising by adapting a local linear model using a <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/image-guided-intervention\">guidance image</a> (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0016\">Hashimoto et al., 2018</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0017\">He et al., 2013</a>). We used the MR image as the guidance image.</li>\n<li><em>Deep image prior (DIP).</em> The general DIP algorithm uses random noise as the network input (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040\">Ulyanov et al., 2018</a>). We used the encoder-decoder network in the proposed MR-GDD as the DIP architecture.</li>\n<li><em>MR-DIP.</em> MR-DIP uses an MR prior as a direct input in the DIP architecture (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008\">Cui et al., 2019</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010\">Gong et al., 2019</a>a). We used the same architecture as in the DIP algorithm.</li>\n</ul>\n<p>As a pre-processing step for all the data, voxel intensity normalization was performed on each of the MR and PET images. The MR image intensity was normalized in the [0, 1] range using a min-max normalization technique. Furthermore, the 99.95th <a href=\"https://www.sciencedirect.com/topics/engineering/percentile\">percentile</a> was defined for PET image intensity, which was also normalized in the [0, 1] range using a min-max normalization technique.</p>\n<h3 id=\"4-1-Simulation-study\">4.1. Simulation study</h3>\n<p>We performed a <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/monte-carlo-method\">Monte Carlo simulation</a> using the 3D brain phantom from BrainWeb (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0002\">Aubert-Broche et al., 2006</a>). The Monte Carlo simulation modeled the geometry of a brain-dedicated PET scanner (HITS-655000 (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0042\">Watanabe et al., 2017</a>), <a href=\"https://www.sciencedirect.com/topics/computer-science/hamamatsu-photonics\">Hamamatsu Photonics</a> K.K., Japan). The scanner consists of 32 detector blocks with <a href=\"https://www.sciencedirect.com/topics/engineering/cerium\">cerium</a> doped <a href=\"https://www.sciencedirect.com/topics/engineering/lutetium\">lutetium</a> <a href=\"https://www.sciencedirect.com/topics/engineering/yttrium\">yttrium</a> <a href=\"https://www.sciencedirect.com/topics/engineering/orthosilicates\">orthosilicate</a> crystals per ring, with 5 of these blocks aligned to the scanner axis. To ensure a mismatch between the MR and PET images, two hot spheres (with radii of 10 and 12 mm, respectively) were inserted exclusively into the PET image to present tumor regions. Then, we simulated a static [18F]FDG scan equivalent to 150 M counts, including attenuation and scattering effects. An attenuation map was created from the segmented MR image, and the attenuation effects of water and bone were considered. The gray matter:white matter:cerebrospinal fluid:left tumor:right tumor activity ratio was set to 1:0.25:0.05:2:2 based on the [18F]FDG contrast. We also simulated low-activity tumor data (left tumor:right tumor activity ratio was set to 1.5:1.2) for some low-grade tumors or pathology linked to <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/degenerative-disease\">neurodegenerative disease</a>. To generate the reference PET image, the simulated list-mode data were reconstructed using a 3D list-mode dynamic row-action maximum-likelihood algorithm (DRAMA) (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0037\">Tanaka and Kudo, 2010</a>) with two iterations and 40 subsets. The reconstructed image measured 128 × 128 × 83 voxels (2.6 × 2.6 × 2.4 mm/voxel). The reference image was reconstructed using all the list-mode data. The noisy PET image was obtained by periodically downsampling to 1/30th of the reference list-mode data (see Supplementary Material 0.1) and reconstructing the low-count image (5 M counts). The corresponding T1-weighted MR image was used as the guidance image.</p>\n<h3 id=\"4-2-Preclinical-study\">4.2. Preclinical study</h3>\n<p>A preclinical study was conducted using monkeys and was approved by the Animal Ethics Committees of the Central <a href=\"https://www.sciencedirect.com/topics/engineering/research-laboratories\">Research Laboratory</a>, Hamamatsu Photonics K.K. PET scans using [18F]FDG and [11C]raclopride imaged the brains of conscious <a href=\"https://www.sciencedirect.com/topics/engineering/rhesus-monkey\">rhesus monkeys</a>, whose bodies and heads were fixed using an animal PET scanner (SHR-38000 (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0013\">Hamamatsu 2021</a>), Hamamatsu Photonics K.K., Japan). After a 30 min transmission scan using a 68Ge-68Ga source, doses of [18F]FDG (113 MBq) and [11C]raclopride (282 MBq) were injected into each monkey, before dynamic PET scans were performed for 120 and 90 min, respectively. We performed image reconstruction using 3D DRAMA with two iterations and 60 subsets that incorporated attenuation correction via transmission scan data. The reconstructed images measured 256 × 256 × 103 voxels (0.65 × 0.65 × 1.0167 mm/voxel) and were cropped <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/pamicogrel\">to 192</a> × 192 × 64 voxels to reduce the demand on the <a href=\"https://www.sciencedirect.com/topics/engineering/graphics-processing-unit\">GPU</a> memory. The reference images were reconstructed using all the list-mode data for [18F]FDG and the list mode data for the 60 min period between 30 and 90 min of the scan such that the contrast created by the distribution of [11C]raclopride in the striatum to be observed clearly. Each noisy PET image was obtained by periodically downsampling to 1/10th of the reference list-mode data. The corresponding T1-weighted MR images were taken on another day and registered manually by two radiological <a href=\"https://www.sciencedirect.com/topics/engineering/technologist\">technologists</a>.</p>\n<h3 id=\"4-3-Clinical-study\">4.3. Clinical study</h3>\n<p>An amyloid scan using [18F]florbetapir was conducted on the human brain of a cognitive normal subject using a Biograph mMR scanner (Siemens Healthineers, Germany) as part of the “Insight 46″ sub-study of the MRC National Survey of Health and Development (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0020\">Lane et al., 2017</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0025\">Markiewicz et al., 2018</a>a). The PET data were acquired dynamically for 60 min using a [18F]florbetapir dose of 409 MBq. During PET image reconstruction, attenuation correction was performed via a pseudo-CT image, which was synthesized using T1- and T2-weighted MR images that were acquired simultaneously, and enabled an μ-map to be was calculated. Image reconstruction was performed using an ordered subset expectation maximization (OS-EM) algorithm involving four iterations and 14 subsets using the NiftyPET package (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0026\">Markiewicz et al., 2018</a>b). The reconstructed images comprised 334 × 334 × 127 voxels (2 × 2 × 2 mm/voxel), which were cropped to 128 × 128 × 83 voxels to reduce the demand on the GPU memory. The reference image was reconstructed using the list-mode data for the period from 30 to 60 min to observe the contrast between gray and white matter clearly. The noisy PET image was obtained by periodically downsampling to 1/10th of the reference list-mode data.</p>\n<h3 id=\"4-4-Evaluation-metrics\">4.4. Evaluation metrics</h3>\n<p>To quantitatively evaluate the performance of different denoising methods, for the simulation study, we calculated the peak signal-to-noise ratio (PSNR) and structural similarity (SSIM) of the target image, x, and the reference image, xref, which are defined as</p>\n\n$$\nPSNR=10log_{10}(\\frac{max(x^{ref})^2}{\\frac{1}{N_R}∑_{j∈R}(x_j−x_j^{ref})^2})\n$$\n\n\n<p>and</p>\n\n$$\nSSIM=\\frac{1}{N_R}∑_{j∈R}\\frac{(2μ_{jx}μ_{jx^{ref}}+c_1)(2σ_{jxx^{ref}}+c_2)}{(μ_{jx}^2+μ_{jx^{ref}}^2+c_1)(σ_{jx}^2+σ_{jx^{ref}}^2+c^2)}\n$$\n\n\n<p>respectively. Here, R and NR represent the brain region in the PET image and the number of voxels, respectively, μ and σ are the mean and standard deviation of the square window corresponding to the <em>j</em>-th voxel, respectively, and σjxxref is the covariance between x and xref. Furthermore, c1=(0.01L)2 and c2=(0.03L)2 where L represents the dynamic range of the reference. The contrast-to-noise ratio (CNR) between gray matter and white matter was calculated as(7)CNR=|Sg¯−Sw¯|σg2+σw2,where Sg¯, Sw¯ and σg, σw are the mean activity and standard deviation corresponding to the regions of interest (ROIs) in the gray and white matter, respectively. The ROIs were constructed in the gray matter regions on the left and right brains of different slices, whereas the white matter regions were selected within the centrum semiovale (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0028\">Paxinos et al., 2000</a>). In the [11C]raclopride calculation, the ROIs were set on the <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/putamen\">putamen</a> instead of the gray matter. A Wilcoxon signed-rank test was performed on the PSNR, SSIM, and CNR to compare the performance of different denoising methods. As the noisy PET data were generated by downsampling the reference list-mode data, we generated multiple independent noisy samples (10 samples) to examine the uncertainty and test the statistical significance.</p>\n<p>We also evaluated the tradeoffs between noise and quantitative information of the <a href=\"https://www.sciencedirect.com/topics/engineering/denoised-image\">denoised images</a> when FWHM (GF), ε (IGF), and epochs (CNNs) are changed. For the simulation study, we calculated the tradeoff between the mean squared bias and the variance in the ROI:(8)Bias2=∑j∈R(xj−xjref)2∑j∈R(xjref)2,(7)Variance=∑j∈R(xj−x¯)2∑j∈R(xjref)2,where R denotes the tumor regions, x¯ is the average pixel value inside the ROI. For preclinical study, we calculated the tradeoff between the mean uptake (putamen and caudate and striatum) and the standard deviation (white matter). Each ROI used for the evaluation was set manually to include any partial volume voxels on the MR image and was calculated via superimposition on the co-registered PET image.</p>\n<p>Thus far, the optimization process for the DIP algorithm has only been reported as a conceptual diagram (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014\">Hashimoto et al., 2020</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040\">Ulyanov et al., 2018</a>), with several aspects such as the actual behavior remaining unclarified. To elucidate the DIP optimization process, we visualized it by performing nonlinear dimensionally reduction using the locally linear embedding (LLE) algorithm (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0031\">Saul and Roweis, 2003</a>), which implements manifold learning. We projected the PET data used for optimization under different training conditions onto a three-dimensional manifold, considering a neighborhood of 15 for each point.</p>\n","site":{"data":{"friends":[{"avatar":"http://image.luokangyuan.com/1_qq_27922023.jpg","name":"码酱","introduction":"我不是大佬，只是在追寻大佬的脚步","url":"http://luokangyuan.com/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/4027734.jpeg","name":"闪烁之狐","introduction":"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬","url":"https://blinkfox.github.io/","title":"前去学习"},{"avatar":"http://image.luokangyuan.com/avatar.jpg","name":"ja_rome","introduction":"平凡的脚步也可以走出伟大的行程","url":"https://me.csdn.net/jlh912008548","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>2021年2月投稿的一篇论文《Anatomical-guided attention enhances unsupervised PET image denoising performance》提出使用Anatomical-guided的注意力加强非监督的PET图像降噪性能。</p>\n</blockquote>\n<h2 id=\"ABSTRACT\">ABSTRACT</h2>\n<blockquote>\n<p>Although supervised convolutional neural networks (CNNs) often outperform conventional alternatives for denoising positron emission tomography (PET) images, they require many low- and high-quality reference PET image pairs. Herein, we propose an unsupervised 3D PET image denoising method based on an anatomical information-guided attention mechanism. The proposed magnetic resonance-guided deep decoder (MR-GDD) utilizes the spatial details and semantic features of MR-guidance image more effectively by introducing encoder-decoder and deep decoder subnetworks. Moreover, the specific shapes and patterns of the guidance image do not affect the denoised PET image, because the guidance image is input to the network through an attention gate. In a Monte Carlo simulation of [18F]fluoro-2-deoxy-D-glucose (FDG), the proposed method achieved the highest peak signal-to-noise ratio and structural similarity (27.92 ± 0.44 dB/0.886 ± 0.007), as compared with Gaussian filtering (26.68 ± 0.10 dB/0.807 ± 0.004), image guided filtering (27.40 ± 0.11 dB/0.849 ± 0.003), deep image prior (DIP) (24.22 ± 0.43 dB/0.737 ± 0.017), and MR-DIP (27.65 ± 0.42 dB/0.879 ± 0.007). Furthermore, we experimentally visualized the behavior of the optimization process, which is often unknown in unsupervised CNN-based restoration problems. For preclinical (using [18F]FDG and [11C]raclopride) and clinical (using [18F]florbetapir) studies, the proposed method demonstrates state-of-the-art denoising performance while retaining spatial resolution and quantitative accuracy, despite using a common network architecture for various noisy PET images with 1/10th of the full counts. These results suggest that the proposed MR-GDD can reduce PET scan times and PET tracer doses considerably without impacting patients.</p>\n</blockquote>\n<h5 id=\"总结\">总结</h5>\n<p>使用监督训练CNN网络比传统的方法在PET降噪处理上效果表现的更好，但是需要 low- and high-quality reference PET image pairs作为label。因此基于解剖学信息指引的注意力机制提出了无监督的3D的PET图像的重建。</p>\n<ul>\n<li>此网络（MR-GDD）引入了两个子网络（encoder-decoder and deep decoder subnetworks）更效率地利用MR（核磁共振）图像的空间信息和语义特征。</li>\n<li>同时，由于guidance image通过attention gate后再输入网络，特定的guidance image的shapes和patterns不会影响降噪的PET图像。</li>\n<li>并且，我们通过实验可视化了优化过程的行为。这在无监督卷积图像重建通常是无法表示的。</li>\n</ul>\n<h2 id=\"Introduction\">Introduction</h2>\n<blockquote>\n<p>Positron emission tomography (PET) is a functional imaging modality that observes the molecular-level activity in tissues caused by radioactive tracers. It offers excellent diagnostic accuracy both for observing normal tissues and for detecting specific diseases such as cancer and neurodegenerative disorders (Phelps, 2012). In response to the increased demand for more accurate dementia diagnosis in recent years, brain-dedicated PET scanners with enhanced sensitivity that are capable of acquiring high-resolution brain images have been developed (Tashima et al., 2019; Watanabe et al., 2017). The acquisition of high-quality diagnostic PET images requires the administration of high dose or a long scan time. However, massive radiation exposure to PET tracers may induce genetic damage and cancerous growths, thereby raising health risk concerns (ICRP, 2017). Therefore, to mitigate the radiation exposure-related risk, it is desirable to administer low-dose PET tracers. Unfortunately, this increases the statistical noise, thus degrading the quality of PET images and potentially affecting the diagnostic accuracy. Thus, improved noise suppression methods for PET images are essential.</p>\n</blockquote>\n<h5 id=\"逻辑\">逻辑</h5>\n<p>为了治疗疾病 —&gt;  需要获取高像素的脑PET图像 —&gt;  需要高剂量&amp;长时间的扫描时间 —&gt; 引发健康风险 —&gt; 只能使用低剂量的PET示踪剂 —&gt; 改进用于 PET 图像的噪声抑制方法是必不可少的。</p>\n<blockquote>\n<p>Conventionally, Gaussian filtering (GF) is applied as a basic post-denoising method, despite compromising the spatial resolution and, thus, the quantitative accuracy of PET images. To avoid such compromises, various denoising algorithms, such as bilateral filtering (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0018\">Hoifheinz et al., 2011</a>), non-local means filtering (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0001\">Arabi and Zaidi, 2020</a>), image-guided filtering (IGF) (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0017\">He et al., 2013</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0016\">Hashimoto et al., 2018</a>), and block-matching filtering (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0027\">Ote et al., 2020</a>) have been developed and applied to PET images. These post-denoising algorithms provide a better denoising performance than GF while retaining spatial resolution and quantitative accuracy.</p>\n</blockquote>\n<h5 id=\"传统降噪方法\">传统降噪方法</h5>\n<p>高斯滤波 (GF) 被用作基本的后去噪方法，尽管会影响空间分辨率，从而影响 PET 图像的定量精度。后来使用双边滤波、非局部均值滤波、图像引导过滤（IGF）和块匹配过滤的去噪方法。这些去噪算法提供了比 GF 更好的去噪性能，同时保留了空间分辨率和定量精度。</p>\n<blockquote>\n<p>Aside from the above mentioned conventional <a href=\"https://www.sciencedirect.com/topics/engineering/filtering-algorithm\">filtering algorithms</a>, methods based on deep learning (DL) have been applied in various medical fields (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0023\">Litjens et al., 2017</a>), and the use of <a href=\"https://www.sciencedirect.com/topics/engineering/convolutional-neural-networks\">convolutional neural networks</a> (CNNs) has been reported to improve the quality of PET images (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010\">Gong et al., 2019</a>a; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0012\">Häggström et al., 2019</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0024\">Liu and Qi, 2019</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0030\">Sanaat et al., 2020</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0034\">Sphuler et al., 2020</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0047\">Zhou et al., 2020</a>). However, the general CNN-based denoising methods typically require a pair of large reference datasets comprising high-quality images. This is a major problem in clinical usage owing to the difficulty of preparing huge sets of low-noise PET data without unduly burdening patients. In addition, the huge volume of novel PET tracers being developed, makes it difficult to collect large amounts of training data for each domain. The interpretation of denoised PET images may suffer inherent biases if unknown cases are excluded from the <a href=\"https://www.sciencedirect.com/topics/computer-science/training-dataset\">training dataset</a>. Despite these challenges, DL algorithms often outperform conventional denoising algorithms. Therefore, there is a need for technology that can be uniformly adapted to various domains without using high-quality PET data.</p>\n</blockquote>\n<h5 id=\"深度学习方法的难题\">深度学习方法的难题</h5>\n<p>除了上述传统过滤算法之外，基于深度学习 (DL) 的方法已应用于各个医学领域，使用卷积神经网络 (CNN) 可以提高PET 图像质量。而深度学习的去噪方法需要高质量图像的大型参考数据集。但是在不给患者造成过度负担的情况下准备大量的低噪声 PET 数据是一个难题，因此目标是需要能够在不使用高质量 PET 数据的情况下，统一适应各种情况的方法。</p>\n<blockquote>\n<p>In recent years, unsupervised or self-supervised DL approaches such as Noise2Noise and deep image prior (DIP) have demonstrated the potential to overcome these challenges (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0021\">Lehtinen et al., 2018</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040\">Ulyanov et al., 2018</a>). In particular, the DIP algorithm is a powerful noise suppression method that does not require the preparation of a prior training dataset (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0015\">Hashimoto et al., 2019</a>, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014\">2020</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0022\">Lin and Huang, 2020</a>). Furthermore, PET reconstruction and denoising methods in which <a href=\"https://www.sciencedirect.com/topics/engineering/computed-tomography\">computed tomography</a> (CT) and magnetic resonance (MR) images serve as the prior images input to the DIP framework have been developed (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008\">Cui et al., 2019</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0011\">Gong et al., 2019</a>b). Compared to PET alone, the denoising performance has been improved by using multi-modal data combined with anatomical information. However, while this method shows potential for adapting various PET image denoising approaches, the <a href=\"https://www.sciencedirect.com/topics/computer-science/network-architecture\">network architecture</a> does not fully utilize the <a href=\"https://www.sciencedirect.com/topics/computer-science/semantic-feature\">semantic features</a> or image details of anatomical-guidance images. Furthermore, the process of converting the guidance image to the PET image can result in the shape and pattern of the guidance image remaining in the output PET image, with the extent to which the features of the guidance image affect PET image denoising is yet to be elucidated. Moreover, the process by which the DIP algorithm optimizes the denoising remains unclear. Therefore, these issues must be clarified for future development.</p>\n</blockquote>\n<h5 id=\"深度学习改进方法：Noise2Noise；DIP；\">深度学习改进方法：Noise2Noise；DIP；</h5>\n<h5 id=\"DIP的优点：\">DIP的优点：</h5>\n<ul>\n<li>一种强大的噪声抑制方法，不需要准备先验训练数据集；</li>\n<li>其中计算机断层扫描 (CT) 和磁共振 (MR) 图像作为输入到 DIP 框架的先验图像；</li>\n<li>与单独的 PET 相比，通过使用多模态数据结合解剖信息，去噪性能得到了提高。</li>\n</ul>\n<h5 id=\"DIP的问题：\">DIP的问题：</h5>\n<ul>\n<li>网络架构并没有充分利用解剖指导图像的语义特征或图像细节；</li>\n<li>引导图像转换为PET图像的过程会导致输出PET图像中保留引导图像的形状和图案；</li>\n<li>引导图像的特征对PET图像去噪的影响程度尚待确定且阐明；</li>\n<li>DIP算法优化去噪的过程仍不清楚。</li>\n</ul>\n<blockquote>\n<p>In this study, we propose an unsupervised 3D PET image denoising method that incorporates anatomical information into the DIP architecture via an attention mechanism. The attention gates (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0009\">Fukui et al., 2019</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0032\">Schlemper et al., 2019</a>) used in the proposed network help optimize a noisy PET image using multi-scale semantic features extracted from the guidance image. As such, this method can prevent the leakage of guidance image features. The guidance of multi-scale features can lead to an effective regularizer for PET image denoising. The main contributions of this study are as follows:</p>\n<ul>\n<li>We propose a new PET image denoising method guided by anatomical information using an unsupervised <a href=\"https://www.sciencedirect.com/topics/computer-science/deep-learning-method\">DL method</a>.</li>\n<li>We demonstrate that the proposed network has the flexibility to handle the different PET tracer domains used to show the distribution of various tissues in the brains of human and non-human primates.</li>\n<li>The behavior of the optimization process is visualized experimentally, thereby providing useful insights that were unresolved in unsupervised CNN-based restoration problems.</li>\n</ul>\n</blockquote>\n<h5 id=\"本文的方法：\">本文的方法：</h5>\n<p>使用了无监督的3D的PET图像降噪方法，该方法通过<strong>注意机制将解剖信息整合到 DIP 架构中</strong>，使用从引导图像中提取的多尺度语义特征来优化嘈杂的 PET 图像。多尺度特征的引导可以为 PET 图像去噪提供有效的正则化器。</p>\n<h5 id=\"贡献：\">贡献：</h5>\n<ul>\n<li>\n<p>我们提出了一种新的 PET 图像去噪方法，该方法使用无监督的 DL 方法<strong>以解剖信息为指导</strong>；</p>\n</li>\n<li>\n<p>具有处理不同PET 示踪域的<strong>灵活性</strong>，可以用于显示人类和非人类灵长类动物大脑中各种组织的分布；</p>\n</li>\n<li>\n<p>优化过程的行为通过实验进行<strong>可视化</strong>，从而提供在基于 CNN 的无监督重建问题中未解决问题的相关见解。</p>\n</li>\n</ul>\n<h2 id=\"2-Related-work\">2. Related work</h2>\n<blockquote>\n<p>The <a href=\"https://www.sciencedirect.com/topics/engineering/positron-emission-tomography\">PET</a> image restoration process is further complicated by the limited availability of information that can be extracted from noisy PET data. Another approach adopted for PET image denoising is to use anatomical prior extracted from the <a href=\"https://www.sciencedirect.com/topics/engineering/computed-tomography\">CT</a> or MR images of the patient for <a href=\"https://www.sciencedirect.com/topics/engineering/regularization\">regularization</a>. Because multi-modal images have become easier to obtain owing to the increasing availability of PET/CT and PET/MR scanners, various <a href=\"https://www.sciencedirect.com/topics/engineering/hybrid-method\">hybrid methods</a> using anatomical priors have been developed to facilitate PET image denoising.</p>\n</blockquote>\n<p>PET 图像去噪采用的另一种方法是<strong>使用从患者的 CT 或 MR 图像中提取的解剖先验</strong>进行正则化。由于 PET/CT 和 PET/MR 扫描仪的可用性不断提高，多模态图像变得更容易获得，因此开发了各种使用解剖学先验的混合方法来促进 PET 图像去噪。</p>\n<h3 id=\"2-1-Classical-approach\">2.1. Classical approach</h3>\n<blockquote>\n<p>Conventionally, hybrid denoising methods using anatomical priors have been adopted for PET image reconstruction and post-filtering. For example, <a href=\"https://www.sciencedirect.com/topics/engineering/maximum-a-posteriori\">maximum a posteriori</a> image reconstruction has been incorporated alongside anatomical priors (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0007\">Comtat et al., 2002</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0041\">Vunckx et al., 2012</a>). In addition, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0035\">Sudarshan et al. (2020)</a> proposed joint PET and MR image reconstruction using a patch-based joint-dictionary prior. <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0003\">Bland et al. (2018)</a> introduced MR-derived kernels to the kernel expectation maximization reconstruction. Although advanced image reconstruction algorithms can provide better denoising performance, they require significant computational resources and it is often difficult to set optimal parameters. Therefore, anatomically-guided post-denoising is often performed separately from the image reconstruction process. <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0004\">Chan et al. (2014)</a> proposed incorporating CT information and applying median non-local mean filtering to achieve PET denoising. Alternatively, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0045\">Yan et al. (2015)</a> proposed MR-guided PET filtering by adapting a local linear model. In addition, the authors performed partial volume correction without MR image <a href=\"https://www.sciencedirect.com/topics/engineering/parcellation\">parcellation</a> by incorporating <a href=\"https://www.sciencedirect.com/topics/engineering/partial-volume-effect\">partial volume effects</a> into the model.</p>\n</blockquote>\n<h5 id=\"经典方法：\">经典方法：</h5>\n<p>将解剖先验的混合去噪方法应用于PET图像重建和后滤波处理，将最大后验图像重建与解剖先验结合在一起。基于a patch-based joint-dictionary prior联合PET和MR图像重建</p>\n<h3 id=\"2-2-Supervised-DL-approach\">2.2. Supervised DL approach</h3>\n<p>The supervised DL approach has recently demonstrated state-of-the-art performance in PET image denoising. When large amounts of training and label PET data pairs are available, the general <a href=\"https://www.sciencedirect.com/topics/engineering/convolutional-neural-networks\">CNN</a> can be trained according to the following operation:</p>\n\n$$\nθ^*=argmin_θ \\frac{1}{N_t}∑_{i∈D_t}∥x_{ref}^i−f_θ(x_0^i)∥\n$$\n\n<p>where ∥·∥ is the L2 norm, f represents the CNN, θ denotes the trainable parameters contained in the weights and biases, Dt is a mini-batch sample of size Nt, x0i is the <em>i</em>th element in the training data (noisy PET images), and xrefi is the <em>i</em>th element in the label data (clean PET images). Regarding supervised PET image denoising using anatomical information, in separate studies, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0024\">Liu and Qi et al. (2019)</a>, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0033\">Schramm et al. (2021)</a>, and <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0005\">Chen et al. (2019)</a> trained CNNs to map multi-modal images, including noisy PET and MR images, to obtain clean PET images. In accordance with these methods, the mapping function, fθ(x0i), in <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0001\">Eq. (1)</a> is represented by fθ(x0i,gi) using anatomical-guidance images, g. The supervised DL approach requires a vast number of low-dose (or short-time scan), high-dose (or long-time scan), and guidance image pairs.</p>\n<h3 id=\"2-3-Unsupervised-DL-approach\">2.3. Unsupervised DL approach</h3>\n<p>Unsupervised DL approaches such as DIP do not require label data for PET image denoising. The DIP training process is optimized as follows (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040\">Ulyanov et al., 2018</a>):</p>\n\n$$\nθ^*=argmin_θ∥x_0−f_θ(z)∥,x^*=f_{θ^*}(z)\n$$\n\n<p>where x0 is a <a href=\"https://www.sciencedirect.com/topics/engineering/noisy-image\">noisy image</a>, x* is the final <a href=\"https://www.sciencedirect.com/topics/engineering/denoised-image\">denoised image</a> output, and the network input z is random noise. The DIP algorithm uses a CNN to map a <a href=\"https://www.sciencedirect.com/topics/engineering/degraded-image\">degraded image</a>, x0, and obtains the optimal denoised image by regularization of the architecture via moderate iteration. This is based purely on the prior information included in the CNN structure. <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0015\">Hashimoto et al. (2019</a>), (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014\">2020</a>) proposed dynamic PET image denoising by directly inputting static PET images into 3D and 4D DIP as prior information. In contrast, <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008\">Cui et al. (2019)</a> and <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010\">Gong et al. (2019</a>a) both proposed PET denoising methods that rely on inputting anatomical-guidance images, g (e.g., CT and MR images), instead of the DIP input, z. In these methods, the mapping function, fθ(z), in <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0002\">Eq. (2)</a> is represented by fθ(g).</p>\n<p>The unsupervised DL approach can bridge the technical gap between the classical and supervised DL approaches for PET image denoising based on anatomical information. Nevertheless, previous methods often fail to clarify how the <a href=\"https://www.sciencedirect.com/topics/computer-science/semantic-feature\">semantic features</a> of the guidance image affect PET image denoising.</p>\n<h2 id=\"3-Methodology\">3. Methodology</h2>\n<h3 id=\"3-1-MR-guided-deep-decoder\">3.1. MR-guided deep decoder</h3>\n<p>To explicitly utilize the <a href=\"https://www.sciencedirect.com/topics/computer-science/semantic-feature\">semantic features</a> of anatomical-guidance image for <a href=\"https://www.sciencedirect.com/topics/engineering/positron-emission-tomography\">PET</a> image denoising, we propose a method for unsupervised 3D PET image denoising based on anatomical information that uses an MR-guided deep decoder (MR-GDD), which is inspired by <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0039\">Uezato et al. (2020)</a>. <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#fig0001\">Fig. 1</a> shows the <a href=\"https://www.sciencedirect.com/topics/computer-science/network-structure\">network structure</a> of the proposed MR-GDD, which comprises two <a href=\"https://www.sciencedirect.com/topics/engineering/subnetwork\">subnetworks</a>: an encoder-decoder subnetwork with a skip connection and a deep decoder subnetwork. The two subnetworks are connected by an upsampling refinement unit (URU) and a feature refinement unit (FRU), which incorporate an attention gate to weight the multi-scale features extracted from the MR image to the deep decoder subnetwork. This combined network performs end-to-end learning from scratch.</p>\n<p><img src=\"https://picture.mulindya.com/MR-guided-deep-decoder.jpg\" alt=\"\"></p>\n<p>Fig. 1. Overview of the proposed MR-GDD used for unsupervised 3D <a href=\"https://www.sciencedirect.com/topics/engineering/positron-emission-tomography\">PET</a> image denoising. This architecture consists of two <a href=\"https://www.sciencedirect.com/topics/engineering/subnetwork\">subnetworks</a> connected by attention gates: an encoder-decoder subnetwork with a skip connection (top) and a deep decoder subnetwork (bottom). This combined architecture is optimized using end-to-end learning. The attention gates in the upsampling refinement unit (URU) and the feature refinement unit (FRU) guide the optimization of noisy PET image using the multi-scale <a href=\"https://www.sciencedirect.com/topics/computer-science/semantic-feature\">semantic features</a> extracted from the MR image. This architecture can prevent the semantic features of the MR image from leaking.</p>\n<h4 id=\"3-1-1-Encoder-decoder-subnetwork\">3.1.1. Encoder-decoder subnetwork</h4>\n<p>The encoder-decoder subnetwork is designed to extract low-scale to high-scale hierarchical semantic features from the MR image. It is based on the 3D U-Net architecture (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0006\">Çiçek et al., 2016</a>) and consists of encoding and decoding paths. In the encoding path, the combination of a 3 × 3 × 3 3D <a href=\"https://www.sciencedirect.com/topics/computer-science/convolution-layer\">convolution layer</a> with <a href=\"https://www.sciencedirect.com/topics/computer-science/batch-normalization\">batch normalization</a> (BN) and a leaky rectified linear unit (LReLU) is repeated twice, before being constructed by a 3 × 3 × 3 3D convolution layer with two strides for downsampling, followed by the BN and LReLU. At each downsampling step, the size of the feature maps is halved. In the decoding path, the outputs of the upsampling layer and the skip connection supplied from the encoding path are added, before the combination of the 3 × 3 × 3 3D convolution layer with the BN and LReLU is repeated twice. At each upsampling step, the size of the feature maps is doubled.</p>\n<h4 id=\"3-1-2-Deep-decoder-subnetwork\">3.1.2. Deep decoder subnetwork</h4>\n<p>The deep decoder subnetwork reconstructs the denoised PET image from the network input filled with uniform noise. Each step in the deep decoder subnetwork is upsampled first by the URU, then by a 3 × 3 × 3 3D convolution layer, and finally by the BN, LReLU, and FRU. Owing to the presence the attention gates, the URU and FRU can generate conditional weights using the MR image features via a 1 × 1 × 1 3D convolution layer, LReLU, and <a href=\"https://www.sciencedirect.com/topics/engineering/sigmoid-function\">sigmoid function</a>, and then weights the features obtained from the pre-layer in the deep decoder. The URU promotes the <a href=\"https://www.sciencedirect.com/topics/computer-science/spatial-locality\">spatial locality</a> of MR image features, whereas the FRU promotes similar semantic alignment. Finally, a 1 × 1 × 1 3D convolution layer outputs a denoised PET image.</p>\n<h3 id=\"3-2-Loss-function-and-optimization\">3.2. Loss function and optimization</h3>\n<p>To denoise the PET image, the training process of the proposed MR-GDD, which utilizes <a href=\"https://www.sciencedirect.com/topics/computer-science/unsupervised-learning\">unsupervised learning</a> that does not require PET reference data, is optimized as follows:</p>\n\n$$\nθ^*=argmin_θ∥x_0−f_θ(z,g)∥,x^*=f_{θ^*}(z,g)\n$$\n\n<p>where ∥·∥ is the L2 norm, f represents the proposed MR-GDD network, the training label x0 represents the noisy PET image, and the network inputs z and g are the random noise and the MR-guidance image, respectively. The input noise was generated by adding a fixed uniform random noise and <a href=\"https://www.sciencedirect.com/topics/engineering/gaussian-white-noise\">Gaussian noise</a> with different seed for each epoch. The attention gates used in the proposed architecture help optimize the noisy PET image by using the multi-scale semantic features extracted from a <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/image-guided-intervention\">guidance image</a> g. If the <em>k</em>-th scale feature of the encoder path in the encoder-decoder subnetwork is defined as Γk and the <em>k</em>-th scale features of the decoder path are defined as Ξk, the influence on the mapping function, f, can be expressed as follows:</p>\n\n$$\nf=f_θ(z|Γ1,⋯Γk,Ξ1,⋯Ξk).\n$$\n\n<p>In this method, the limited memory BFGS (L-BFGS) algorithm (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0048\">Zhu et al., 1997</a>), which is a quasi-Newtonian method, is introduced to solve the nonlinear <a href=\"https://www.sciencedirect.com/topics/engineering/least-square-problem\">least squares problem</a> described by <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#eqn0003\">Eq. (3)</a>. By considering the approximate <a href=\"https://www.sciencedirect.com/topics/engineering/hessian-matrix\">Hessian matrix</a> based on the second-order gradient, the L2 norm converges more stably and quickly than first-order <a href=\"https://www.sciencedirect.com/topics/engineering/gradient-descent\">gradient descent</a> algorithms, such as the stochastic gradient descent algorithm or Adam. In addition, because a small amount of data is generated as a result of using the unsupervised architecture, which does not require a prior <a href=\"https://www.sciencedirect.com/topics/computer-science/training-dataset\">training dataset</a>, the MR-GDD can reduce the computational complexity and load required to performed denoising. We used the L-BFGS algorithm at a learning rate of 0.01 without line search to minimize the processing time. The proposed architecture was processed using PyTorch 1.6.0 on Ubuntu 16.04 with acceleration by a <a href=\"https://www.sciencedirect.com/topics/engineering/graphics-processing-unit\">graphics processing unit</a> (NVIDIA Quadro RTX8000 with 48 GB memory).</p>\n<h2 id=\"4-Experimental-setup\">4. Experimental setup</h2>\n<p>A simulation study using [18F]fluoro-2-deoxy-D-glucose (FDG), a preclinical study using [18F]FDG and [11C]raclopride, and a clinical study using [18F]florbetapir (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0043\">Wong et al., 2010</a>) were performed to verify the effectiveness of the proposed <a href=\"https://www.sciencedirect.com/topics/engineering/positron-emission-tomography\">PET</a> image denoising method. In addition, the denoising performance of the proposed MR-GDD was compared against four other unsupervised algorithms under the same conditions as the proposed MR-GDD;</p>\n<ul>\n<li><em>Gaussian filtering (GF).</em> GF is a basic post-denoising method for suppressing noise in PET images. We used a 3D <a href=\"https://www.sciencedirect.com/topics/engineering/gaussian-kernel\">Gaussian kernel</a>.</li>\n<li><em>Image guided filtering (IGF).</em> IGF performs PET image denoising by adapting a local linear model using a <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/image-guided-intervention\">guidance image</a> (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0016\">Hashimoto et al., 2018</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0017\">He et al., 2013</a>). We used the MR image as the guidance image.</li>\n<li><em>Deep image prior (DIP).</em> The general DIP algorithm uses random noise as the network input (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040\">Ulyanov et al., 2018</a>). We used the encoder-decoder network in the proposed MR-GDD as the DIP architecture.</li>\n<li><em>MR-DIP.</em> MR-DIP uses an MR prior as a direct input in the DIP architecture (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0008\">Cui et al., 2019</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0010\">Gong et al., 2019</a>a). We used the same architecture as in the DIP algorithm.</li>\n</ul>\n<p>As a pre-processing step for all the data, voxel intensity normalization was performed on each of the MR and PET images. The MR image intensity was normalized in the [0, 1] range using a min-max normalization technique. Furthermore, the 99.95th <a href=\"https://www.sciencedirect.com/topics/engineering/percentile\">percentile</a> was defined for PET image intensity, which was also normalized in the [0, 1] range using a min-max normalization technique.</p>\n<h3 id=\"4-1-Simulation-study\">4.1. Simulation study</h3>\n<p>We performed a <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/monte-carlo-method\">Monte Carlo simulation</a> using the 3D brain phantom from BrainWeb (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0002\">Aubert-Broche et al., 2006</a>). The Monte Carlo simulation modeled the geometry of a brain-dedicated PET scanner (HITS-655000 (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0042\">Watanabe et al., 2017</a>), <a href=\"https://www.sciencedirect.com/topics/computer-science/hamamatsu-photonics\">Hamamatsu Photonics</a> K.K., Japan). The scanner consists of 32 detector blocks with <a href=\"https://www.sciencedirect.com/topics/engineering/cerium\">cerium</a> doped <a href=\"https://www.sciencedirect.com/topics/engineering/lutetium\">lutetium</a> <a href=\"https://www.sciencedirect.com/topics/engineering/yttrium\">yttrium</a> <a href=\"https://www.sciencedirect.com/topics/engineering/orthosilicates\">orthosilicate</a> crystals per ring, with 5 of these blocks aligned to the scanner axis. To ensure a mismatch between the MR and PET images, two hot spheres (with radii of 10 and 12 mm, respectively) were inserted exclusively into the PET image to present tumor regions. Then, we simulated a static [18F]FDG scan equivalent to 150 M counts, including attenuation and scattering effects. An attenuation map was created from the segmented MR image, and the attenuation effects of water and bone were considered. The gray matter:white matter:cerebrospinal fluid:left tumor:right tumor activity ratio was set to 1:0.25:0.05:2:2 based on the [18F]FDG contrast. We also simulated low-activity tumor data (left tumor:right tumor activity ratio was set to 1.5:1.2) for some low-grade tumors or pathology linked to <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/degenerative-disease\">neurodegenerative disease</a>. To generate the reference PET image, the simulated list-mode data were reconstructed using a 3D list-mode dynamic row-action maximum-likelihood algorithm (DRAMA) (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0037\">Tanaka and Kudo, 2010</a>) with two iterations and 40 subsets. The reconstructed image measured 128 × 128 × 83 voxels (2.6 × 2.6 × 2.4 mm/voxel). The reference image was reconstructed using all the list-mode data. The noisy PET image was obtained by periodically downsampling to 1/30th of the reference list-mode data (see Supplementary Material 0.1) and reconstructing the low-count image (5 M counts). The corresponding T1-weighted MR image was used as the guidance image.</p>\n<h3 id=\"4-2-Preclinical-study\">4.2. Preclinical study</h3>\n<p>A preclinical study was conducted using monkeys and was approved by the Animal Ethics Committees of the Central <a href=\"https://www.sciencedirect.com/topics/engineering/research-laboratories\">Research Laboratory</a>, Hamamatsu Photonics K.K. PET scans using [18F]FDG and [11C]raclopride imaged the brains of conscious <a href=\"https://www.sciencedirect.com/topics/engineering/rhesus-monkey\">rhesus monkeys</a>, whose bodies and heads were fixed using an animal PET scanner (SHR-38000 (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0013\">Hamamatsu 2021</a>), Hamamatsu Photonics K.K., Japan). After a 30 min transmission scan using a 68Ge-68Ga source, doses of [18F]FDG (113 MBq) and [11C]raclopride (282 MBq) were injected into each monkey, before dynamic PET scans were performed for 120 and 90 min, respectively. We performed image reconstruction using 3D DRAMA with two iterations and 60 subsets that incorporated attenuation correction via transmission scan data. The reconstructed images measured 256 × 256 × 103 voxels (0.65 × 0.65 × 1.0167 mm/voxel) and were cropped <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/pamicogrel\">to 192</a> × 192 × 64 voxels to reduce the demand on the <a href=\"https://www.sciencedirect.com/topics/engineering/graphics-processing-unit\">GPU</a> memory. The reference images were reconstructed using all the list-mode data for [18F]FDG and the list mode data for the 60 min period between 30 and 90 min of the scan such that the contrast created by the distribution of [11C]raclopride in the striatum to be observed clearly. Each noisy PET image was obtained by periodically downsampling to 1/10th of the reference list-mode data. The corresponding T1-weighted MR images were taken on another day and registered manually by two radiological <a href=\"https://www.sciencedirect.com/topics/engineering/technologist\">technologists</a>.</p>\n<h3 id=\"4-3-Clinical-study\">4.3. Clinical study</h3>\n<p>An amyloid scan using [18F]florbetapir was conducted on the human brain of a cognitive normal subject using a Biograph mMR scanner (Siemens Healthineers, Germany) as part of the “Insight 46″ sub-study of the MRC National Survey of Health and Development (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0020\">Lane et al., 2017</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0025\">Markiewicz et al., 2018</a>a). The PET data were acquired dynamically for 60 min using a [18F]florbetapir dose of 409 MBq. During PET image reconstruction, attenuation correction was performed via a pseudo-CT image, which was synthesized using T1- and T2-weighted MR images that were acquired simultaneously, and enabled an μ-map to be was calculated. Image reconstruction was performed using an ordered subset expectation maximization (OS-EM) algorithm involving four iterations and 14 subsets using the NiftyPET package (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0026\">Markiewicz et al., 2018</a>b). The reconstructed images comprised 334 × 334 × 127 voxels (2 × 2 × 2 mm/voxel), which were cropped to 128 × 128 × 83 voxels to reduce the demand on the GPU memory. The reference image was reconstructed using the list-mode data for the period from 30 to 60 min to observe the contrast between gray and white matter clearly. The noisy PET image was obtained by periodically downsampling to 1/10th of the reference list-mode data.</p>\n<h3 id=\"4-4-Evaluation-metrics\">4.4. Evaluation metrics</h3>\n<p>To quantitatively evaluate the performance of different denoising methods, for the simulation study, we calculated the peak signal-to-noise ratio (PSNR) and structural similarity (SSIM) of the target image, x, and the reference image, xref, which are defined as</p>\n\n$$\nPSNR=10log_{10}(\\frac{max(x^{ref})^2}{\\frac{1}{N_R}∑_{j∈R}(x_j−x_j^{ref})^2})\n$$\n\n\n<p>and</p>\n\n$$\nSSIM=\\frac{1}{N_R}∑_{j∈R}\\frac{(2μ_{jx}μ_{jx^{ref}}+c_1)(2σ_{jxx^{ref}}+c_2)}{(μ_{jx}^2+μ_{jx^{ref}}^2+c_1)(σ_{jx}^2+σ_{jx^{ref}}^2+c^2)}\n$$\n\n\n<p>respectively. Here, R and NR represent the brain region in the PET image and the number of voxels, respectively, μ and σ are the mean and standard deviation of the square window corresponding to the <em>j</em>-th voxel, respectively, and σjxxref is the covariance between x and xref. Furthermore, c1=(0.01L)2 and c2=(0.03L)2 where L represents the dynamic range of the reference. The contrast-to-noise ratio (CNR) between gray matter and white matter was calculated as(7)CNR=|Sg¯−Sw¯|σg2+σw2,where Sg¯, Sw¯ and σg, σw are the mean activity and standard deviation corresponding to the regions of interest (ROIs) in the gray and white matter, respectively. The ROIs were constructed in the gray matter regions on the left and right brains of different slices, whereas the white matter regions were selected within the centrum semiovale (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0028\">Paxinos et al., 2000</a>). In the [11C]raclopride calculation, the ROIs were set on the <a href=\"https://www.sciencedirect.com/topics/medicine-and-dentistry/putamen\">putamen</a> instead of the gray matter. A Wilcoxon signed-rank test was performed on the PSNR, SSIM, and CNR to compare the performance of different denoising methods. As the noisy PET data were generated by downsampling the reference list-mode data, we generated multiple independent noisy samples (10 samples) to examine the uncertainty and test the statistical significance.</p>\n<p>We also evaluated the tradeoffs between noise and quantitative information of the <a href=\"https://www.sciencedirect.com/topics/engineering/denoised-image\">denoised images</a> when FWHM (GF), ε (IGF), and epochs (CNNs) are changed. For the simulation study, we calculated the tradeoff between the mean squared bias and the variance in the ROI:(8)Bias2=∑j∈R(xj−xjref)2∑j∈R(xjref)2,(7)Variance=∑j∈R(xj−x¯)2∑j∈R(xjref)2,where R denotes the tumor regions, x¯ is the average pixel value inside the ROI. For preclinical study, we calculated the tradeoff between the mean uptake (putamen and caudate and striatum) and the standard deviation (white matter). Each ROI used for the evaluation was set manually to include any partial volume voxels on the MR image and was calculated via superimposition on the co-registered PET image.</p>\n<p>Thus far, the optimization process for the DIP algorithm has only been reported as a conceptual diagram (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0014\">Hashimoto et al., 2020</a>; <a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0040\">Ulyanov et al., 2018</a>), with several aspects such as the actual behavior remaining unclarified. To elucidate the DIP optimization process, we visualized it by performing nonlinear dimensionally reduction using the locally linear embedding (LLE) algorithm (<a href=\"https://www.sciencedirect.com/science/article/pii/S1361841521002711#bib0031\">Saul and Roweis, 2003</a>), which implements manifold learning. We projected the PET data used for optimization under different training conditions onto a three-dimensional manifold, considering a neighborhood of 15 for each point.</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"ckyk1p05v0006ast99rmbh8yi","category_id":"ckyk1p0600009ast9hin55zzn","_id":"ckyk1p06c000jast9ca7x4a1z"},{"post_id":"ckyk1p065000cast93xeu4bda","category_id":"ckyk1p068000east9b15ke2bv","_id":"ckyk1p07e000xast966nxd8xg"},{"post_id":"ckyk1p067000dast96wy6gwqe","category_id":"ckyk1p078000sast935nn0ud0","_id":"ckyk1p07m0015ast96b9w5kzm"},{"post_id":"ckyk1p069000hast90e7r9ws8","category_id":"ckyk1p078000sast935nn0ud0","_id":"ckyk1p07s001aast9c0qo0q25"},{"post_id":"ckyk1p05y0008ast905bx0ybk","category_id":"ckyk1p068000east9b15ke2bv","_id":"ckyk1p080001gast9fejt7fh6"},{"post_id":"ckyk1p05y0008ast905bx0ybk","category_id":"ckyk1p07l0014ast99jnmcilm","_id":"ckyk1p084001last9bpay6514"},{"post_id":"ckyk1p06n000mast97b69h4c3","category_id":"ckyk1p07s001bast98h7n8hny","_id":"ckyk1p08f001uast9ewd8aq45"},{"post_id":"ckyk1p063000bast945zr4pvf","category_id":"ckyk1p068000east9b15ke2bv","_id":"ckyk1p08k0020ast9cyea7f8v"},{"post_id":"ckyk1p063000bast945zr4pvf","category_id":"ckyk1p07l0014ast99jnmcilm","_id":"ckyk1p08n0023ast92jvf6f43"},{"post_id":"ckyk1p06u000nast95daobae4","category_id":"ckyk1p07s001bast98h7n8hny","_id":"ckyk1p08p0026ast94h4khipd"},{"post_id":"ckyk1p073000qast91ei68ays","category_id":"ckyk1p07s001bast98h7n8hny","_id":"ckyk1p08t002cast997use684"},{"post_id":"ckyk1p076000rast92hbf7wrn","category_id":"ckyk1p07s001bast98h7n8hny","_id":"ckyk1p08x002jast97jv6d50q"},{"post_id":"ckyk1p07c000wast96lfp7xll","category_id":"ckyk1p08x002iast9fi7h2oxv","_id":"ckyk1p096002uast9cuuhfkw8"},{"post_id":"ckyk1p07j0013ast95a01fsvr","category_id":"ckyk1p096002tast9aktrdtq8","_id":"ckyk1p09d0033ast98mxjdaom"},{"post_id":"ckyk1p07m0017ast9081z3rdw","category_id":"ckyk1p099002zast99trjaqr0","_id":"ckyk1p09i003bast935ws6ja2"},{"post_id":"ckyk1p07q0019ast9829h3f9y","category_id":"ckyk1p099002zast99trjaqr0","_id":"ckyk1p09l003gast97ql55gbe"},{"post_id":"ckyk1p07t001cast96hid04z9","category_id":"ckyk1p09h003aast925fv19fk","_id":"ckyk1p09p003nast9fsiodcgt"},{"post_id":"ckyk1p06b000iast9ghy2d78o","category_id":"ckyk1p07s001bast98h7n8hny","_id":"ckyk1p0a2003yast90m44444o"},{"post_id":"ckyk1p06b000iast9ghy2d78o","category_id":"ckyk1p09q003oast9fldi8yg9","_id":"ckyk1p0a40041ast97b8p9xm7"},{"post_id":"ckyk1p09z003vast982u1fnx1","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0a80047ast91vsweonc"},{"post_id":"ckyk1p0ab004cast9e8bp7q3r","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0ag004jast92wd3ca39"},{"post_id":"ckyk1p08q0027ast93c58awk1","category_id":"ckyk1p099002zast99trjaqr0","_id":"ckyk1p0b7005fast9b6ba7qt2"},{"post_id":"ckyk1p0ba005iast9go5b6bf1","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0bf005sast9c8j943m3"},{"post_id":"ckyk1p079000uast99g0ufuoa","category_id":"ckyk1p07s001bast98h7n8hny","_id":"ckyk1p0bh005wast90zmtcdi6"},{"post_id":"ckyk1p079000uast99g0ufuoa","category_id":"ckyk1p0bb005kast9ehhj7i8l","_id":"ckyk1p0bj005yast9cs6t306b"},{"post_id":"ckyk1p07f0010ast98rwj58mf","category_id":"ckyk1p07s001bast98h7n8hny","_id":"ckyk1p0bz006nast9fze90n1f"},{"post_id":"ckyk1p07f0010ast98rwj58mf","category_id":"ckyk1p0bb005kast9ehhj7i8l","_id":"ckyk1p0c1006qast927or6j59"},{"post_id":"ckyk1p0bz006past95fowbnwo","category_id":"ckyk1p068000east9b15ke2bv","_id":"ckyk1p0c5006xast9e4scd81s"},{"post_id":"ckyk1p09n003kast9fyzp5hpo","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0cz0083ast92thp26o1"},{"post_id":"ckyk1p09n003kast9fyzp5hpo","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0d00086ast92apl6umn"},{"post_id":"ckyk1p07x001east96z2ndmp1","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0d10088ast96k00gd6x"},{"post_id":"ckyk1p07x001east96z2ndmp1","category_id":"ckyk1p0cz0081ast90si08enu","_id":"ckyk1p0d2008cast937nseijl"},{"post_id":"ckyk1p09p003mast9bu10d12t","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0d2008east9ep2x7ynq"},{"post_id":"ckyk1p09p003mast9bu10d12t","category_id":"ckyk1p0d00084ast92vd17iex","_id":"ckyk1p0d3008hast99p138jjs"},{"post_id":"ckyk1p09q003past97upfcl8g","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0d5008kast9azgc9ovz"},{"post_id":"ckyk1p09q003past97upfcl8g","category_id":"ckyk1p0d1008aast9h00fdp0y","_id":"ckyk1p0d6008last9eerh9nkt"},{"post_id":"ckyk1p09s003rast95vl5a85w","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0d7008oast9etig15b0"},{"post_id":"ckyk1p09s003rast95vl5a85w","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0d8008qast9hpgp6yb6"},{"post_id":"ckyk1p09t003tast92g1p1a8o","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0d9008uast93qdzb9zo"},{"post_id":"ckyk1p09t003tast92g1p1a8o","category_id":"ckyk1p0d00084ast92vd17iex","_id":"ckyk1p0da008wast9h33jbr2g"},{"post_id":"ckyk1p080001hast9901oek34","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0db0090ast97lf76ocv"},{"post_id":"ckyk1p080001hast9901oek34","category_id":"ckyk1p0d1008aast9h00fdp0y","_id":"ckyk1p0dc0091ast9cbf3ffm6"},{"post_id":"ckyk1p0a2003zast90iz90bfo","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0dd0094ast964sw0bgd"},{"post_id":"ckyk1p0a2003zast90iz90bfo","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0de0096ast96zww157m"},{"post_id":"ckyk1p084001mast93pib4j1t","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0df0099ast99i5r32n6"},{"post_id":"ckyk1p084001mast93pib4j1t","category_id":"ckyk1p0d1008aast9h00fdp0y","_id":"ckyk1p0dg009cast9fmuvdqza"},{"post_id":"ckyk1p0a50043ast9516p81om","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0dh009gast9ew0j26pu"},{"post_id":"ckyk1p0a50043ast9516p81om","category_id":"ckyk1p0dc0093ast9emub1xah","_id":"ckyk1p0di009hast94biq5mak"},{"post_id":"ckyk1p0a70046ast9cbwpbs8n","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0di009jast9faqk4830"},{"post_id":"ckyk1p0a70046ast9cbwpbs8n","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0dk009last92xmbc0el"},{"post_id":"ckyk1p087001nast95usq1qqb","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0do009oast9cwlm80sj"},{"post_id":"ckyk1p087001nast95usq1qqb","category_id":"ckyk1p0dh009fast9924dghsh","_id":"ckyk1p0dp009qast9d25o7xhr"},{"post_id":"ckyk1p0a9004aast93yci29qz","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0dq009uast9gvw082t1"},{"post_id":"ckyk1p0a9004aast93yci29qz","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0dr009wast9fyk2adkh"},{"post_id":"ckyk1p08a001qast93mb188e3","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0dt009zast95lh12ekt"},{"post_id":"ckyk1p08a001qast93mb188e3","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0dt00a0ast96fqsdrqv"},{"post_id":"ckyk1p0ac004east9cp87d49v","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0dx00a3ast9ex6f5g2q"},{"post_id":"ckyk1p0ac004east9cp87d49v","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0dy00a5ast9bb0lgekh"},{"post_id":"ckyk1p0ae004gast9cir94ikc","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0e300a8ast905rk30ok"},{"post_id":"ckyk1p0ae004gast9cir94ikc","category_id":"ckyk1p0d1008aast9h00fdp0y","_id":"ckyk1p0e400abast91pnn7ise"},{"post_id":"ckyk1p08d001sast9611378tv","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0e600adast99kzqdkgl"},{"post_id":"ckyk1p08d001sast9611378tv","category_id":"ckyk1p0dx00a2ast9beg18el7","_id":"ckyk1p0e700afast9hsfz6sul"},{"post_id":"ckyk1p0af004iast95l96h2x7","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0e900aiast995w00nk5"},{"post_id":"ckyk1p0af004iast95l96h2x7","category_id":"ckyk1p0e300a9ast936xu46jx","_id":"ckyk1p0ed00alast9gqub3hjp"},{"post_id":"ckyk1p0ah004mast9h79t6azb","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0eg00apast93kvy3han"},{"post_id":"ckyk1p0ah004mast9h79t6azb","category_id":"ckyk1p0e600aeast94n4039hm","_id":"ckyk1p0eg00arast904ludyni"},{"post_id":"ckyk1p08h001xast9bur41oci","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0ei00atast9g1lh6hrl"},{"post_id":"ckyk1p08h001xast9bur41oci","category_id":"ckyk1p0d00084ast92vd17iex","_id":"ckyk1p0ej00axast970e638zn"},{"post_id":"ckyk1p0aj004oast91465gvc0","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0ek00ayast98vcd3f9a"},{"post_id":"ckyk1p0aj004oast91465gvc0","category_id":"ckyk1p0ef00aoast9dw6m4ndh","_id":"ckyk1p0el00b1ast94t5wg6sp"},{"post_id":"ckyk1p0al004sast9a3db1lab","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0en00b4ast9he0w48qw"},{"post_id":"ckyk1p0al004sast9a3db1lab","category_id":"ckyk1p0ei00auast9eodv7360","_id":"ckyk1p0eo00b7ast9azt27wdd"},{"post_id":"ckyk1p08j001yast90cpe7zuu","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0ep00b9ast9dcmrasoe"},{"post_id":"ckyk1p08j001yast90cpe7zuu","category_id":"ckyk1p0ei00auast9eodv7360","_id":"ckyk1p0ep00bbast9e3093acd"},{"post_id":"ckyk1p0am004uast91q9e0aty","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0eq00bcast9d615bqyy"},{"post_id":"ckyk1p0am004uast91q9e0aty","category_id":"ckyk1p0cz0081ast90si08enu","_id":"ckyk1p0er00bfast94db03wjw"},{"post_id":"ckyk1p0ao004xast95cyo39wd","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0et00biast94dmh365w"},{"post_id":"ckyk1p0ao004xast95cyo39wd","category_id":"ckyk1p0eo00b8ast95o5df7qk","_id":"ckyk1p0eu00blast9c6v1a835"},{"post_id":"ckyk1p08m0022ast93dj1hwib","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0ev00boast9aapv31ph"},{"post_id":"ckyk1p08m0022ast93dj1hwib","category_id":"ckyk1p0ei00auast9eodv7360","_id":"ckyk1p0ew00bqast9cbt6cahk"},{"post_id":"ckyk1p0ar004zast9cn5rek00","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0ey00btast9ct7s1r3u"},{"post_id":"ckyk1p0ar004zast9cn5rek00","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0ez00bwast9bipzgazp"},{"post_id":"ckyk1p0au0052ast9dh0obd5v","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0f000byast9awlv2d3j"},{"post_id":"ckyk1p0au0052ast9dh0obd5v","category_id":"ckyk1p0d1008aast9h00fdp0y","_id":"ckyk1p0f100c0ast90szcd095"},{"post_id":"ckyk1p08o0024ast9fo36gkyh","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0f200c3ast998p9c6f2"},{"post_id":"ckyk1p08o0024ast9fo36gkyh","category_id":"ckyk1p0d1008aast9h00fdp0y","_id":"ckyk1p0f300c6ast905o0fkgm"},{"post_id":"ckyk1p0aw0054ast93tm4226o","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0f500c8ast96glu0ek3"},{"post_id":"ckyk1p0aw0054ast93tm4226o","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0f500caast958dr0ajk"},{"post_id":"ckyk1p0b00057ast9cb6ldzfr","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0f600ccast9ajkdbpn1"},{"post_id":"ckyk1p0b00057ast9cb6ldzfr","category_id":"ckyk1p0d1008aast9h00fdp0y","_id":"ckyk1p0f800cgast96pcwcxpr"},{"post_id":"ckyk1p0b20059ast9hcmif6nl","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0f900chast921ke4yce"},{"post_id":"ckyk1p0b20059ast9hcmif6nl","category_id":"ckyk1p0f400c7ast94yfzc05w","_id":"ckyk1p0fd00ckast9a3thdtqo"},{"post_id":"ckyk1p0b4005bast929fldv7b","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0fd00clast94q9tdvq5"},{"post_id":"ckyk1p0b4005bast929fldv7b","category_id":"ckyk1p0f600cdast9c8d1cii6","_id":"ckyk1p0ff00coast93u390lt5"},{"post_id":"ckyk1p08s002aast984fdc8mb","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0fg00csast9cj6i3ldt"},{"post_id":"ckyk1p08s002aast984fdc8mb","category_id":"ckyk1p0fa00ciast9ad8o3pg9","_id":"ckyk1p0fh00cvast92qvh4t7c"},{"post_id":"ckyk1p0b5005dast90s3l7hh6","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0fi00cxast93nr6ewd8"},{"post_id":"ckyk1p0b5005dast90s3l7hh6","category_id":"ckyk1p0f600cdast9c8d1cii6","_id":"ckyk1p0fj00czast96ga6cfiy"},{"post_id":"ckyk1p0b8005gast9hnzidd7g","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0fk00d1ast93pzl5v88"},{"post_id":"ckyk1p0b8005gast9hnzidd7g","category_id":"ckyk1p0dh009fast9924dghsh","_id":"ckyk1p0fm00d3ast985khckme"},{"post_id":"ckyk1p08u002east9heit0sbb","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0fm00d6ast98kpo6l3r"},{"post_id":"ckyk1p08u002east9heit0sbb","category_id":"ckyk1p0fa00ciast9ad8o3pg9","_id":"ckyk1p0fo00d9ast97kajfhqn"},{"post_id":"ckyk1p0bb005last9hrf63s7t","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0fp00dcast97zg2c7ta"},{"post_id":"ckyk1p0bb005last9hrf63s7t","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0fq00deast9fbg2g640"},{"post_id":"ckyk1p0bd005oast9bawsgs6e","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0fr00dgast9e6hjerp1"},{"post_id":"ckyk1p0bd005oast9bawsgs6e","category_id":"ckyk1p0d00084ast92vd17iex","_id":"ckyk1p0fs00dkast962sy1mll"},{"post_id":"ckyk1p08w002hast97okbc4sw","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0fx00dsast9b7x5brsr"},{"post_id":"ckyk1p08w002hast97okbc4sw","category_id":"ckyk1p0ei00auast9eodv7360","_id":"ckyk1p0fy00dvast907yyetbx"},{"post_id":"ckyk1p0bk0060ast9b5f392f9","category_id":"ckyk1p0fw00drast98q84b6iv","_id":"ckyk1p0g100e1ast94gz427r3"},{"post_id":"ckyk1p08y002kast9h7b77z2r","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0g300e6ast9633vbfyr"},{"post_id":"ckyk1p08y002kast9h7b77z2r","category_id":"ckyk1p0ei00auast9eodv7360","_id":"ckyk1p0g400e7ast9ac703b37"},{"post_id":"ckyk1p0bn0066ast98rp12by6","category_id":"ckyk1p0g300e5ast94rx55bye","_id":"ckyk1p0g700ebast96ogz8a4k"},{"post_id":"ckyk1p090002mast9bx7dccec","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0g800egast99fkp98y6"},{"post_id":"ckyk1p090002mast9bx7dccec","category_id":"ckyk1p0g500e9ast991xtfgwq","_id":"ckyk1p0g900ejast9eivbdoqf"},{"post_id":"ckyk1p0bp0069ast9132u3qej","category_id":"ckyk1p0g700ecast94fqjekkc","_id":"ckyk1p0gb00enast9291q7vyb"},{"post_id":"ckyk1p092002past9dpuqa6ub","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0gf00euast99qlx97kk"},{"post_id":"ckyk1p092002past9dpuqa6ub","category_id":"ckyk1p0gb00emast98nkre4av","_id":"ckyk1p0gg00exast9hhv3bkkw"},{"post_id":"ckyk1p0bu006east90zv33c6f","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0gk00f2ast97wxyhxe0"},{"post_id":"ckyk1p095002sast91nsmhf6l","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0gq00fcast98tg5ap02"},{"post_id":"ckyk1p095002sast91nsmhf6l","category_id":"ckyk1p0ei00auast9eodv7360","_id":"ckyk1p0gr00feast9hafe76ry"},{"post_id":"ckyk1p097002wast9ejr11lmx","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0gu00flast9g13oh3y2"},{"post_id":"ckyk1p097002wast9ejr11lmx","category_id":"ckyk1p0gq00fbast9c8eze7vh","_id":"ckyk1p0gw00fnast9cqefhny7"},{"post_id":"ckyk1p0c3006uast9huzg0n8s","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0gw00fpast988jfahw0"},{"post_id":"ckyk1p098002yast97x437raz","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0h000fwast99623eqwh"},{"post_id":"ckyk1p098002yast97x437raz","category_id":"ckyk1p0dx00a2ast9beg18el7","_id":"ckyk1p0h200fyast9asbz28k6"},{"post_id":"ckyk1p09a0030ast9aig0cpen","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0h600g7ast9c80xhxff"},{"post_id":"ckyk1p09a0030ast9aig0cpen","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0h800gaast978978yo6"},{"post_id":"ckyk1p09c0032ast9gwx0emj4","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0hd00gjast9351c99xc"},{"post_id":"ckyk1p09c0032ast9gwx0emj4","category_id":"ckyk1p0h800gbast9f88j622v","_id":"ckyk1p0he00glast9diz0g4u2"},{"post_id":"ckyk1p09d0036ast9b9prdk8c","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0hl00gtast9d6mqcxaa"},{"post_id":"ckyk1p09d0036ast9b9prdk8c","category_id":"ckyk1p0d1008aast9h00fdp0y","_id":"ckyk1p0hm00gvast95t2a6n2m"},{"post_id":"ckyk1p0cf007fast9hloy111a","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0hm00gyast9dbo5ekxy"},{"post_id":"ckyk1p09f0038ast90e5a0xxt","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0hp00h4ast917axhhe2"},{"post_id":"ckyk1p09f0038ast90e5a0xxt","category_id":"ckyk1p0dx00a2ast9beg18el7","_id":"ckyk1p0hq00h8ast9ebrvaxxa"},{"post_id":"ckyk1p0ck007last90wrv47lx","category_id":"ckyk1p0hp00h5ast96gbh8p54","_id":"ckyk1p0ht00hdast92afk7unh"},{"post_id":"ckyk1p09i003dast9c6sp3gdm","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0hv00hhast92ap80huv"},{"post_id":"ckyk1p09i003dast9c6sp3gdm","category_id":"ckyk1p0dx00a2ast9beg18el7","_id":"ckyk1p0hx00hjast9hu5755ao"},{"post_id":"ckyk1p09j003east94ilp3mh1","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0i100hsast98mr90pf2"},{"post_id":"ckyk1p09j003east94ilp3mh1","category_id":"ckyk1p0dx00a2ast9beg18el7","_id":"ckyk1p0i300hvast95i07hu9x"},{"post_id":"ckyk1p09l003iast9bgbobs4z","category_id":"ckyk1p09m003jast9hcprfhm3","_id":"ckyk1p0i700i2ast9ffz7htil"},{"post_id":"ckyk1p09l003iast9bgbobs4z","category_id":"ckyk1p0cx007xast9do8q9r3y","_id":"ckyk1p0i800i5ast9epq5b6ok"},{"post_id":"ckyk1p0cx007zast916k1bln1","category_id":"ckyk1p0i600hzast987tydhiz","_id":"ckyk1p0ia00i7ast9cka93q8b"},{"post_id":"ckyk1p0be005rast91fbm7je6","category_id":"ckyk1p0fp00dbast9akjxb5ka","_id":"ckyk1p0ic00ibast9hufqcg71"},{"post_id":"ckyk1p0be005rast91fbm7je6","category_id":"ckyk1p0i700i3ast99goq7ffr","_id":"ckyk1p0ie00ieast90mgz6v5y"},{"post_id":"ckyk1p0bg005uast975so7lzp","category_id":"ckyk1p0fp00dbast9akjxb5ka","_id":"ckyk1p0if00iiast95yyi521p"},{"post_id":"ckyk1p0bg005uast975so7lzp","category_id":"ckyk1p0ia00i8ast91ppqbxcm","_id":"ckyk1p0ig00ikast91xe1gqai"},{"post_id":"ckyk1p0bi005xast9bva3aig2","category_id":"ckyk1p0fp00dbast9akjxb5ka","_id":"ckyk1p0ih00imast9bz9rhr7a"},{"post_id":"ckyk1p0bi005xast9bva3aig2","category_id":"ckyk1p0ia00i8ast91ppqbxcm","_id":"ckyk1p0il00ipast93sbw1zqo"},{"post_id":"ckyk1p0bm0063ast9awon0tgq","category_id":"ckyk1p0fp00dbast9akjxb5ka","_id":"ckyk1p0im00irast9alrz1ly5"},{"post_id":"ckyk1p0bm0063ast9awon0tgq","category_id":"ckyk1p0i700i3ast99goq7ffr","_id":"ckyk1p0io00iuast9ebs9aixa"},{"post_id":"ckyk1p0bq006aast9250aeur4","category_id":"ckyk1p0g700ecast94fqjekkc","_id":"ckyk1p0ip00ixast9bi6h02sf"},{"post_id":"ckyk1p0bq006aast9250aeur4","category_id":"ckyk1p0ih00ilast9dz4gfubh","_id":"ckyk1p0iq00izast96gv0cg43"},{"post_id":"ckyk1p0bs006dast96it4ao11","category_id":"ckyk1p0g700ecast94fqjekkc","_id":"ckyk1p0is00j3ast94lq37l06"},{"post_id":"ckyk1p0bs006dast96it4ao11","category_id":"ckyk1p0ih00ilast9dz4gfubh","_id":"ckyk1p0it00j4ast9fi1ebf8q"},{"post_id":"ckyk1p0bw006iast92g285gct","category_id":"ckyk1p0g700ecast94fqjekkc","_id":"ckyk1p0iu00j6ast98khr7ef5"},{"post_id":"ckyk1p0bw006iast92g285gct","category_id":"ckyk1p0ih00ilast9dz4gfubh","_id":"ckyk1p0iw00j9ast95bbf8kbt"},{"post_id":"ckyk1p0by006kast91uae2erx","category_id":"ckyk1p0g700ecast94fqjekkc","_id":"ckyk1p0ix00jcast91769clh5"},{"post_id":"ckyk1p0by006kast91uae2erx","category_id":"ckyk1p0ir00j2ast9epwjey7p","_id":"ckyk1p0iy00jfast965we2wjv"},{"post_id":"ckyk1p0c1006rast99d6dcewy","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0j000jjast99kylg376"},{"post_id":"ckyk1p0c1006rast99d6dcewy","category_id":"ckyk1p0iv00j7ast9a878bf55","_id":"ckyk1p0j100jlast9dn8xa2ll"},{"post_id":"ckyk1p0c4006wast9d05e7j6l","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0j200jpast9aukve4l5"},{"post_id":"ckyk1p0c4006wast9d05e7j6l","category_id":"ckyk1p0iv00j7ast9a878bf55","_id":"ckyk1p0j400jrast9ez250k09"},{"post_id":"ckyk1p0c60071ast98p98ev6t","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0j500juast928rf4n4u"},{"post_id":"ckyk1p0c60071ast98p98ev6t","category_id":"ckyk1p0iv00j7ast9a878bf55","_id":"ckyk1p0j700jxast9cb5z0fm6"},{"post_id":"ckyk1p0c70072ast97dgba8ug","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0j900k1ast93d7odabw"},{"post_id":"ckyk1p0c70072ast97dgba8ug","category_id":"ckyk1p0j200joast93ffz8ztp","_id":"ckyk1p0j900k3ast9300sgxnp"},{"post_id":"ckyk1p0c90075ast96072gtdi","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0jb00k7ast9ae1f8bet"},{"post_id":"ckyk1p0c90075ast96072gtdi","category_id":"ckyk1p0j200joast93ffz8ztp","_id":"ckyk1p0jc00k9ast93ghrf4cm"},{"post_id":"ckyk1p0cb0077ast9da9uf6rk","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0jd00kdast9f7sr65vv"},{"post_id":"ckyk1p0cb0077ast9da9uf6rk","category_id":"ckyk1p0j200joast93ffz8ztp","_id":"ckyk1p0jd00keast9hl2eeytx"},{"post_id":"ckyk1p0cd007bast9ambi5f72","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0je00kfast9hir4e0a1"},{"post_id":"ckyk1p0cd007bast9ambi5f72","category_id":"ckyk1p0j200joast93ffz8ztp","_id":"ckyk1p0jf00kjast9cmom8df0"},{"post_id":"ckyk1p0ce007cast9054u1ppo","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0jh00kmast9dhlx52pg"},{"post_id":"ckyk1p0ce007cast9054u1ppo","category_id":"ckyk1p0jd00kcast969qe2490","_id":"ckyk1p0jh00koast9899u7jlz"},{"post_id":"ckyk1p0ch007gast9bvx946ak","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0ji00kqast9c00jdsh5"},{"post_id":"ckyk1p0ch007gast9bvx946ak","category_id":"ckyk1p0je00khast9b5dwdk7e","_id":"ckyk1p0jj00ktast9h9f99qrl"},{"post_id":"ckyk1p0cj007jast91puhezvb","category_id":"ckyk1p0hn00h1ast9gznyeytz","_id":"ckyk1p0jk00kwast93pr6baxw"},{"post_id":"ckyk1p0cj007jast91puhezvb","category_id":"ckyk1p0jh00knast9hq6v0ub0","_id":"ckyk1p0jl00kzast95s9z5ntp"},{"post_id":"ckyk1p0cq007past94nyqhw48","category_id":"ckyk1p0hn00h1ast9gznyeytz","_id":"ckyk1p0jn00l2ast9h31gejs1"},{"post_id":"ckyk1p0cq007past94nyqhw48","category_id":"ckyk1p0jj00krast95dcgalgo","_id":"ckyk1p0jo00l4ast96s0kete1"},{"post_id":"ckyk1p0cs007rast99s04gtis","category_id":"ckyk1p0hn00h1ast9gznyeytz","_id":"ckyk1p0jp00l7ast92r2sdf18"},{"post_id":"ckyk1p0cs007rast99s04gtis","category_id":"ckyk1p0jj00krast95dcgalgo","_id":"ckyk1p0jq00l8ast9cy017ub1"},{"post_id":"ckyk1p0ct007tast9c0c23e7b","category_id":"ckyk1p0hn00h1ast9gznyeytz","_id":"ckyk1p0jr00laast9cl7y5lrw"},{"post_id":"ckyk1p0ct007tast9c0c23e7b","category_id":"ckyk1p0jj00krast95dcgalgo","_id":"ckyk1p0js00lcast9a0dcfv1k"},{"post_id":"ckyk1p0cw007wast91j661h52","category_id":"ckyk1p0hn00h1ast9gznyeytz","_id":"ckyk1p0js00least9cd6d5zb8"},{"post_id":"ckyk1p0cw007wast91j661h52","category_id":"ckyk1p0jj00krast95dcgalgo","_id":"ckyk1p0jt00lhast997zr7qkv"},{"post_id":"ckyk1p0l600nqast9bt5ybo1l","category_id":"ckyk1p09h003aast925fv19fk","_id":"ckyk1p0lb00nwast96b88bxm4"},{"post_id":"ckyk1p0l800nsast94msahljd","category_id":"ckyk1p0gf00etast962qifrco","_id":"ckyk1p0lc00nzast9hhg6adhd"},{"post_id":"ckyk1p0l800nsast94msahljd","category_id":"ckyk1p0j200joast93ffz8ztp","_id":"ckyk1p0lc00o0ast97kou172d"},{"post_id":"ckyk1p0l500npast9hruc5j0u","category_id":"ckyk1p0hn00h1ast9gznyeytz","_id":"ckyk1p0lc00o2ast9h7651ps1"},{"post_id":"ckyk1p0l500npast9hruc5j0u","category_id":"ckyk1p0l900ntast96r44bzn9","_id":"ckyk1p0lc00o4ast95e4m80ro"},{"post_id":"ckyk1p0ld00o5ast91rm9cy0z","category_id":"ckyk1p07s001bast98h7n8hny","_id":"ckyk1p0li00odast9df0g8w2r"},{"post_id":"ckyk1p0ld00o5ast91rm9cy0z","category_id":"ckyk1p0lg00o8ast9bzlseldv","_id":"ckyk1p0li00oeast9dvd656qi"},{"post_id":"ckyk1p0le00o6ast98tw3aef9","category_id":"ckyk1p0hp00h5ast96gbh8p54","_id":"ckyk1p0li00ofast93sle5xs6"},{"post_id":"ckyk1p0le00o6ast98tw3aef9","category_id":"ckyk1p0lh00oaast9djo0bdwp","_id":"ckyk1p0li00ogast99sh95p1a"}],"PostTag":[{"post_id":"ckyk1p05v0006ast99rmbh8yi","tag_id":"ckyk1p063000aast92fy591jo","_id":"ckyk1p069000gast97hxlcsu7"},{"post_id":"ckyk1p05y0008ast905bx0ybk","tag_id":"ckyk1p068000fast9cqzw9w6s","_id":"ckyk1p07b000vast9f2imfhvo"},{"post_id":"ckyk1p05y0008ast905bx0ybk","tag_id":"ckyk1p06d000last98r0bfakz","_id":"ckyk1p07e000zast96guadqe5"},{"post_id":"ckyk1p05y0008ast905bx0ybk","tag_id":"ckyk1p06x000past99pmufwyu","_id":"ckyk1p07i0012ast95nwvdmkv"},{"post_id":"ckyk1p063000bast945zr4pvf","tag_id":"ckyk1p078000tast9brei8jgj","_id":"ckyk1p07m0016ast9fgi71b07"},{"post_id":"ckyk1p065000cast93xeu4bda","tag_id":"ckyk1p06x000past99pmufwyu","_id":"ckyk1p07z001fast96r3ie4g4"},{"post_id":"ckyk1p065000cast93xeu4bda","tag_id":"ckyk1p07o0018ast986bv4cun","_id":"ckyk1p082001jast9gcxe5o17"},{"post_id":"ckyk1p067000dast96wy6gwqe","tag_id":"ckyk1p07v001dast9fqht60m5","_id":"ckyk1p08c001rast93n9sfkhz"},{"post_id":"ckyk1p067000dast96wy6gwqe","tag_id":"ckyk1p083001kast98lgrbc56","_id":"ckyk1p08g001vast94xqudl6j"},{"post_id":"ckyk1p069000hast90e7r9ws8","tag_id":"ckyk1p07v001dast9fqht60m5","_id":"ckyk1p08s0029ast95sdk359n"},{"post_id":"ckyk1p069000hast90e7r9ws8","tag_id":"ckyk1p083001kast98lgrbc56","_id":"ckyk1p08u002dast9a6lw9b5m"},{"post_id":"ckyk1p069000hast90e7r9ws8","tag_id":"ckyk1p08l0021ast9f4beh5uo","_id":"ckyk1p08w002gast986gbbiwo"},{"post_id":"ckyk1p06b000iast9ghy2d78o","tag_id":"ckyk1p08r0028ast9gr2rc1el","_id":"ckyk1p092002oast94ad1cyzv"},{"post_id":"ckyk1p06b000iast9ghy2d78o","tag_id":"ckyk1p08v002fast949usckms","_id":"ckyk1p094002qast9cyr28y6e"},{"post_id":"ckyk1p06n000mast97b69h4c3","tag_id":"ckyk1p08r0028ast9gr2rc1el","_id":"ckyk1p096002vast9eybngpkc"},{"post_id":"ckyk1p06u000nast95daobae4","tag_id":"ckyk1p08r0028ast9gr2rc1el","_id":"ckyk1p09d0034ast941ifbxby"},{"post_id":"ckyk1p06u000nast95daobae4","tag_id":"ckyk1p098002xast91a02elzv","_id":"ckyk1p09f0037ast96ydbdyk9"},{"post_id":"ckyk1p073000qast91ei68ays","tag_id":"ckyk1p09b0031ast9cvnae91t","_id":"ckyk1p09i003cast99psta36z"},{"post_id":"ckyk1p076000rast92hbf7wrn","tag_id":"ckyk1p08r0028ast9gr2rc1el","_id":"ckyk1p09l003hast991y92zzm"},{"post_id":"ckyk1p079000uast99g0ufuoa","tag_id":"ckyk1p08r0028ast9gr2rc1el","_id":"ckyk1p0a2003wast98pd952d3"},{"post_id":"ckyk1p079000uast99g0ufuoa","tag_id":"ckyk1p09n003last98idpef0k","_id":"ckyk1p0a40040ast99wzbb2ps"},{"post_id":"ckyk1p079000uast99g0ufuoa","tag_id":"ckyk1p09r003qast968qz7dvz","_id":"ckyk1p0a60044ast9dmf2er53"},{"post_id":"ckyk1p07c000wast96lfp7xll","tag_id":"ckyk1p09z003uast9honn5eut","_id":"ckyk1p0a80048ast9dq1a25cm"},{"post_id":"ckyk1p07f0010ast98rwj58mf","tag_id":"ckyk1p08r0028ast9gr2rc1el","_id":"ckyk1p0ah004last98uz722xa"},{"post_id":"ckyk1p07f0010ast98rwj58mf","tag_id":"ckyk1p09n003last98idpef0k","_id":"ckyk1p0ai004nast9gkof7mz3"},{"post_id":"ckyk1p07f0010ast98rwj58mf","tag_id":"ckyk1p09r003qast968qz7dvz","_id":"ckyk1p0ak004rast903uc9mlp"},{"post_id":"ckyk1p07j0013ast95a01fsvr","tag_id":"ckyk1p0af004hast9c4uahb24","_id":"ckyk1p0am004tast9506d5fss"},{"post_id":"ckyk1p07m0017ast9081z3rdw","tag_id":"ckyk1p0aj004past90ijt55e3","_id":"ckyk1p0ar004yast92w350wxb"},{"post_id":"ckyk1p07q0019ast9829h3f9y","tag_id":"ckyk1p0an004vast9h5zy9fce","_id":"ckyk1p0aw0053ast9dn1k0qo9"},{"post_id":"ckyk1p07t001cast96hid04z9","tag_id":"ckyk1p0at0051ast954og3gc1","_id":"ckyk1p0b20058ast9d0in02c4"},{"post_id":"ckyk1p07x001east96z2ndmp1","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0bb005jast916cj0jh9"},{"post_id":"ckyk1p07x001east96z2ndmp1","tag_id":"ckyk1p0b5005cast98jdq3wio","_id":"ckyk1p0bc005mast9bcx44msx"},{"post_id":"ckyk1p0ba005iast9go5b6bf1","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0be005past9crmoaym3"},{"post_id":"ckyk1p080001hast9901oek34","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0bl0061ast93r2516jk"},{"post_id":"ckyk1p080001hast9901oek34","tag_id":"ckyk1p0bc005nast96kaxbhmx","_id":"ckyk1p0bn0064ast93on7f3on"},{"post_id":"ckyk1p080001hast9901oek34","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0bp0067ast9ff9c5a59"},{"post_id":"ckyk1p084001mast93pib4j1t","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0bw006hast98f2xavfa"},{"post_id":"ckyk1p084001mast93pib4j1t","tag_id":"ckyk1p0bn0065ast9fkrl48fo","_id":"ckyk1p0by006jast9835fezz6"},{"post_id":"ckyk1p084001mast93pib4j1t","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0bz006oast95gf4h9sl"},{"post_id":"ckyk1p087001nast95usq1qqb","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0c4006vast9cn6c5ra3"},{"post_id":"ckyk1p087001nast95usq1qqb","tag_id":"ckyk1p0bz006last9gvsaasm6","_id":"ckyk1p0c5006yast91hqt99ny"},{"post_id":"ckyk1p08a001qast93mb188e3","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0cb0076ast9bmit5dt3"},{"post_id":"ckyk1p08a001qast93mb188e3","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0cc0078ast98svybrxo"},{"post_id":"ckyk1p08d001sast9611378tv","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0ck007kast94v6hct5y"},{"post_id":"ckyk1p08d001sast9611378tv","tag_id":"ckyk1p0cc0079ast98o8rbxqy","_id":"ckyk1p0cl007mast99rz98jkr"},{"post_id":"ckyk1p08d001sast9611378tv","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0cs007qast97anm50hx"},{"post_id":"ckyk1p08h001xast9bur41oci","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0cv007vast93s2yee1w"},{"post_id":"ckyk1p08h001xast9bur41oci","tag_id":"ckyk1p0cm007oast9gm2r0srq","_id":"ckyk1p0cx007yast9045m2c50"},{"post_id":"ckyk1p08j001yast90cpe7zuu","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0d10087ast9des48ibc"},{"post_id":"ckyk1p08j001yast90cpe7zuu","tag_id":"ckyk1p0cy0080ast930wsaojz","_id":"ckyk1p0d10089ast965m7hb5u"},{"post_id":"ckyk1p08j001yast90cpe7zuu","tag_id":"ckyk1p0cz0082ast9clxh79es","_id":"ckyk1p0d2008dast94qz979w2"},{"post_id":"ckyk1p08m0022ast93dj1hwib","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0d8008past99d3daffi"},{"post_id":"ckyk1p08m0022ast93dj1hwib","tag_id":"ckyk1p0cy0080ast930wsaojz","_id":"ckyk1p0d8008rast90tkofwl9"},{"post_id":"ckyk1p08m0022ast93dj1hwib","tag_id":"ckyk1p0cz0082ast9clxh79es","_id":"ckyk1p0da008vast910mucrya"},{"post_id":"ckyk1p08m0022ast93dj1hwib","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0da008xast95md0hqr2"},{"post_id":"ckyk1p08o0024ast9fo36gkyh","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0de0095ast97enb342g"},{"post_id":"ckyk1p08o0024ast9fo36gkyh","tag_id":"ckyk1p0bc005nast96kaxbhmx","_id":"ckyk1p0de0097ast9dpe84u0o"},{"post_id":"ckyk1p08o0024ast9fo36gkyh","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0dg009bast94ml07c30"},{"post_id":"ckyk1p08q0027ast93c58awk1","tag_id":"ckyk1p0aj004past90ijt55e3","_id":"ckyk1p0dg009dast9b39581ox"},{"post_id":"ckyk1p08s002aast984fdc8mb","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0dp009past920q94w6l"},{"post_id":"ckyk1p08s002aast984fdc8mb","tag_id":"ckyk1p0dh009east993yuc3ta","_id":"ckyk1p0dp009rast9bd9j7v3i"},{"post_id":"ckyk1p08s002aast984fdc8mb","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0dr009vast92k1sa5mk"},{"post_id":"ckyk1p08u002east9heit0sbb","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0dy00a4ast9f6blhsh2"},{"post_id":"ckyk1p08u002east9heit0sbb","tag_id":"ckyk1p0dh009east993yuc3ta","_id":"ckyk1p0dy00a6ast9b5yr1nt9"},{"post_id":"ckyk1p08u002east9heit0sbb","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0e400aaast9bpbpgs6s"},{"post_id":"ckyk1p08w002hast97okbc4sw","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0e900ahast9282oerh6"},{"post_id":"ckyk1p08w002hast97okbc4sw","tag_id":"ckyk1p0cz0082ast9clxh79es","_id":"ckyk1p0ed00akast9adgr63ya"},{"post_id":"ckyk1p08w002hast97okbc4sw","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0ee00anast9h5ds1rpt"},{"post_id":"ckyk1p08y002kast9h7b77z2r","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0ei00asast95w4575ds"},{"post_id":"ckyk1p08y002kast9h7b77z2r","tag_id":"ckyk1p0cz0082ast9clxh79es","_id":"ckyk1p0ej00avast966cnf9wg"},{"post_id":"ckyk1p090002mast9bx7dccec","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0em00b2ast9c1cp5ic4"},{"post_id":"ckyk1p090002mast9bx7dccec","tag_id":"ckyk1p0ej00awast92e7f2n8c","_id":"ckyk1p0en00b5ast96b2qbono"},{"post_id":"ckyk1p092002past9dpuqa6ub","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0es00bgast9g0wv5ztw"},{"post_id":"ckyk1p092002past9dpuqa6ub","tag_id":"ckyk1p0en00b6ast9etla57dj","_id":"ckyk1p0et00bjast9d2fo0234"},{"post_id":"ckyk1p092002past9dpuqa6ub","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0eu00bmast9a91z3mvs"},{"post_id":"ckyk1p095002sast91nsmhf6l","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0ex00brast9dord4gzv"},{"post_id":"ckyk1p095002sast91nsmhf6l","tag_id":"ckyk1p0cz0082ast9clxh79es","_id":"ckyk1p0ey00buast9cc597m39"},{"post_id":"ckyk1p097002wast9ejr11lmx","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0f200c1ast958c82w56"},{"post_id":"ckyk1p097002wast9ejr11lmx","tag_id":"ckyk1p0ey00bvast99k1vf3jf","_id":"ckyk1p0f300c4ast936si6fvv"},{"post_id":"ckyk1p098002yast97x437raz","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0f600cbast9ccpi0whf"},{"post_id":"ckyk1p098002yast97x437raz","tag_id":"ckyk1p0cc0079ast98o8rbxqy","_id":"ckyk1p0f800ceast96hy7e0qh"},{"post_id":"ckyk1p09a0030ast9aig0cpen","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0ff00cpast9hdxrglir"},{"post_id":"ckyk1p09a0030ast9aig0cpen","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0fg00cqast925qu7vgk"},{"post_id":"ckyk1p09a0030ast9aig0cpen","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0fh00cuast9aolbhtpv"},{"post_id":"ckyk1p09c0032ast9gwx0emj4","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0fm00d4ast91keoctqm"},{"post_id":"ckyk1p09c0032ast9gwx0emj4","tag_id":"ckyk1p0fg00ctast90i3w1wgr","_id":"ckyk1p0fn00d7ast93rktdy68"},{"post_id":"ckyk1p09c0032ast9gwx0emj4","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0fo00daast962l34r77"},{"post_id":"ckyk1p09d0036ast9b9prdk8c","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0fq00dfast9hsqteerl"},{"post_id":"ckyk1p09d0036ast9b9prdk8c","tag_id":"ckyk1p0bc005nast96kaxbhmx","_id":"ckyk1p0fr00dhast9hmfc46el"},{"post_id":"ckyk1p09f0038ast90e5a0xxt","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0fu00dnast91lqp22f8"},{"post_id":"ckyk1p09f0038ast90e5a0xxt","tag_id":"ckyk1p0cc0079ast98o8rbxqy","_id":"ckyk1p0fu00doast9gowm3wlc"},{"post_id":"ckyk1p09i003dast9c6sp3gdm","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0fy00duast9dep06af4"},{"post_id":"ckyk1p09i003dast9c6sp3gdm","tag_id":"ckyk1p0cc0079ast98o8rbxqy","_id":"ckyk1p0fy00dwast946s27wsz"},{"post_id":"ckyk1p09j003east94ilp3mh1","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0g200e2ast9hwdt46c5"},{"post_id":"ckyk1p09j003east94ilp3mh1","tag_id":"ckyk1p0cc0079ast98o8rbxqy","_id":"ckyk1p0g200e3ast98c580og1"},{"post_id":"ckyk1p09l003iast9bgbobs4z","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0g700edast977f2bsla"},{"post_id":"ckyk1p09l003iast9bgbobs4z","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0g700eeast94ap51nxm"},{"post_id":"ckyk1p09l003iast9bgbobs4z","tag_id":"ckyk1p0bf005tast9gmbhbavf","_id":"ckyk1p0g800ehast9dum8hzug"},{"post_id":"ckyk1p09n003kast9fyzp5hpo","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0ga00elast97wo65xpr"},{"post_id":"ckyk1p09n003kast9fyzp5hpo","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0gb00eoast9btgbas72"},{"post_id":"ckyk1p09p003mast9bu10d12t","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0gf00esast95nvzhnjw"},{"post_id":"ckyk1p09p003mast9bu10d12t","tag_id":"ckyk1p0cm007oast9gm2r0srq","_id":"ckyk1p0gg00evast9agqm16gs"},{"post_id":"ckyk1p09q003past97upfcl8g","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0gk00f0ast92fm19v7q"},{"post_id":"ckyk1p09q003past97upfcl8g","tag_id":"ckyk1p0bc005nast96kaxbhmx","_id":"ckyk1p0gl00f3ast90l2mgqw6"},{"post_id":"ckyk1p09s003rast95vl5a85w","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0go00f7ast9hia0cv1s"},{"post_id":"ckyk1p09s003rast95vl5a85w","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0go00f9ast9h2l1f1sx"},{"post_id":"ckyk1p09t003tast92g1p1a8o","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0gs00ffast94hee910r"},{"post_id":"ckyk1p09t003tast92g1p1a8o","tag_id":"ckyk1p0cm007oast9gm2r0srq","_id":"ckyk1p0gs00fhast96iwnbl8y"},{"post_id":"ckyk1p09z003vast982u1fnx1","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0gu00fjast92qc6b7ms"},{"post_id":"ckyk1p0a2003zast90iz90bfo","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0gy00frast9hp0eb0hl"},{"post_id":"ckyk1p0a2003zast90iz90bfo","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0gy00ftast93dcfh5gx"},{"post_id":"ckyk1p0a50043ast9516p81om","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0h200fzast98ijb2m6n"},{"post_id":"ckyk1p0a50043ast9516p81om","tag_id":"ckyk1p0gz00fuast937wve0kp","_id":"ckyk1p0h300g1ast970pkg9x1"},{"post_id":"ckyk1p0a70046ast9cbwpbs8n","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0h600g5ast903zs91n4"},{"post_id":"ckyk1p0a70046ast9cbwpbs8n","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0h700g8ast9guq62s9g"},{"post_id":"ckyk1p0a9004aast93yci29qz","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0ha00gdast9goyafi1s"},{"post_id":"ckyk1p0a9004aast93yci29qz","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0ha00gfast972x6azmm"},{"post_id":"ckyk1p0ab004cast9e8bp7q3r","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0hc00ghast92lb16v5e"},{"post_id":"ckyk1p0ac004east9cp87d49v","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0hi00goast95o3s8wy0"},{"post_id":"ckyk1p0ac004east9cp87d49v","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0hi00gqast95qpm3fo0"},{"post_id":"ckyk1p0ae004gast9cir94ikc","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0hm00gwast92kbphv94"},{"post_id":"ckyk1p0ae004gast9cir94ikc","tag_id":"ckyk1p0bc005nast96kaxbhmx","_id":"ckyk1p0hm00gzast9d9mn5n8f"},{"post_id":"ckyk1p0af004iast95l96h2x7","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0ho00h3ast96s4w7rav"},{"post_id":"ckyk1p0af004iast95l96h2x7","tag_id":"ckyk1p0hn00h0ast9fo2o5vv3","_id":"ckyk1p0hp00h6ast9a1x56pt3"},{"post_id":"ckyk1p0ah004mast9h79t6azb","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0hs00hbast96v3l2qbh"},{"post_id":"ckyk1p0ah004mast9h79t6azb","tag_id":"ckyk1p0hq00h7ast98v9y2zen","_id":"ckyk1p0ht00heast9bh3o5htn"},{"post_id":"ckyk1p0aj004oast91465gvc0","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0hx00hkast99yor9rfs"},{"post_id":"ckyk1p0aj004oast91465gvc0","tag_id":"ckyk1p0ht00hfast965plc5o5","_id":"ckyk1p0hy00hmast911jm176i"},{"post_id":"ckyk1p0al004sast9a3db1lab","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0i100hqast9h70u48qr"},{"post_id":"ckyk1p0al004sast9a3db1lab","tag_id":"ckyk1p0cz0082ast9clxh79es","_id":"ckyk1p0i200htast9g9fe4nz9"},{"post_id":"ckyk1p0am004uast91q9e0aty","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0i500hyast953loa0r2"},{"post_id":"ckyk1p0am004uast91q9e0aty","tag_id":"ckyk1p0b5005cast98jdq3wio","_id":"ckyk1p0i600i0ast95eyd3k74"},{"post_id":"ckyk1p0ao004xast95cyo39wd","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0i900i6ast9dz15e3az"},{"post_id":"ckyk1p0ao004xast95cyo39wd","tag_id":"ckyk1p0i600i1ast97kx82cgx","_id":"ckyk1p0ia00i9ast9gic2d8uo"},{"post_id":"ckyk1p0ar004zast9cn5rek00","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0ie00ifast9712mfdlo"},{"post_id":"ckyk1p0ar004zast9cn5rek00","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0ie00igast97ogdbw8s"},{"post_id":"ckyk1p0au0052ast9dh0obd5v","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0il00ioast95fcbak28"},{"post_id":"ckyk1p0au0052ast9dh0obd5v","tag_id":"ckyk1p0bc005nast96kaxbhmx","_id":"ckyk1p0im00iqast9avj4gf53"},{"post_id":"ckyk1p0aw0054ast93tm4226o","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0iq00iyast94s5l0hdu"},{"post_id":"ckyk1p0aw0054ast93tm4226o","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0ir00j0ast99dmj2kh2"},{"post_id":"ckyk1p0b00057ast9cb6ldzfr","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0iv00j8ast9fzu96pwt"},{"post_id":"ckyk1p0b00057ast9cb6ldzfr","tag_id":"ckyk1p0bc005nast96kaxbhmx","_id":"ckyk1p0iw00jaast92eqralyw"},{"post_id":"ckyk1p0b20059ast9hcmif6nl","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0iy00jeast99z5b2mdk"},{"post_id":"ckyk1p0b20059ast9hcmif6nl","tag_id":"ckyk1p0it00j5ast9cfcmdqrp","_id":"ckyk1p0iy00jgast95wbu4tw9"},{"post_id":"ckyk1p0b4005bast929fldv7b","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0j100jkast98l2g7d5q"},{"post_id":"ckyk1p0b4005bast929fldv7b","tag_id":"ckyk1p0iw00jbast9cjcq7rbh","_id":"ckyk1p0j200jmast9dtadcs4b"},{"post_id":"ckyk1p0b5005dast90s3l7hh6","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0j300jqast901syf9gd"},{"post_id":"ckyk1p0b5005dast90s3l7hh6","tag_id":"ckyk1p0iw00jbast9cjcq7rbh","_id":"ckyk1p0j400jsast9go3wbc1d"},{"post_id":"ckyk1p0b8005gast9hnzidd7g","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0j600jwast9f6m95jh3"},{"post_id":"ckyk1p0b8005gast9hnzidd7g","tag_id":"ckyk1p0bz006last9gvsaasm6","_id":"ckyk1p0j700jyast9cjdvhbj3"},{"post_id":"ckyk1p0bb005last9hrf63s7t","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0j900k2ast92hzkbnn4"},{"post_id":"ckyk1p0bb005last9hrf63s7t","tag_id":"ckyk1p0c5006zast9dm6v74s0","_id":"ckyk1p0j900k4ast9elj97nwc"},{"post_id":"ckyk1p0bd005oast9bawsgs6e","tag_id":"ckyk1p0az0056ast9ezjk8izf","_id":"ckyk1p0jb00k8ast9c7k557q4"},{"post_id":"ckyk1p0bd005oast9bawsgs6e","tag_id":"ckyk1p0cm007oast9gm2r0srq","_id":"ckyk1p0jc00kaast9eqbtbdcg"},{"post_id":"ckyk1p0be005rast91fbm7je6","tag_id":"ckyk1p0ja00k5ast9bmdr6kp4","_id":"ckyk1p0jf00kiast91jh3fe39"},{"post_id":"ckyk1p0be005rast91fbm7je6","tag_id":"ckyk1p0jc00kbast98f6mdaen","_id":"ckyk1p0jg00kkast9f738ev2k"},{"post_id":"ckyk1p0bg005uast975so7lzp","tag_id":"ckyk1p0ja00k5ast9bmdr6kp4","_id":"ckyk1p0jj00ksast9cnuv97jf"},{"post_id":"ckyk1p0bg005uast975so7lzp","tag_id":"ckyk1p0jg00klast9ejcq2ek7","_id":"ckyk1p0jj00kuast94gagb1sp"},{"post_id":"ckyk1p0bi005xast9bva3aig2","tag_id":"ckyk1p0ji00kpast91qjncjy8","_id":"ckyk1p0jl00kyast9fmmg4j6d"},{"post_id":"ckyk1p0bk0060ast9b5f392f9","tag_id":"ckyk1p0jk00kvast9hl6ue99r","_id":"ckyk1p0jo00l3ast95vvu78ke"},{"post_id":"ckyk1p0bm0063ast9awon0tgq","tag_id":"ckyk1p0ja00k5ast9bmdr6kp4","_id":"ckyk1p0js00lbast922yy2oo3"},{"post_id":"ckyk1p0bm0063ast9awon0tgq","tag_id":"ckyk1p0jc00kbast98f6mdaen","_id":"ckyk1p0js00ldast92evc4obv"},{"post_id":"ckyk1p0bn0066ast98rp12by6","tag_id":"ckyk1p0jr00l9ast90pnng83w","_id":"ckyk1p0jt00lgast92n8d3eem"},{"post_id":"ckyk1p0bp0069ast9132u3qej","tag_id":"ckyk1p0js00lfast9adghf006","_id":"ckyk1p0ju00ljast9cfypg6ux"},{"post_id":"ckyk1p0bq006aast9250aeur4","tag_id":"ckyk1p0js00lfast9adghf006","_id":"ckyk1p0jv00llast9evl7cunu"},{"post_id":"ckyk1p0bs006dast96it4ao11","tag_id":"ckyk1p0js00lfast9adghf006","_id":"ckyk1p0jw00lnast9emqj2mjd"},{"post_id":"ckyk1p0bu006east90zv33c6f","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0jx00lpast9d6587yzq"},{"post_id":"ckyk1p0bw006iast92g285gct","tag_id":"ckyk1p0js00lfast9adghf006","_id":"ckyk1p0jy00lrast96zc7httx"},{"post_id":"ckyk1p0by006kast91uae2erx","tag_id":"ckyk1p0js00lfast9adghf006","_id":"ckyk1p0jz00ltast946jwarbk"},{"post_id":"ckyk1p0bz006past95fowbnwo","tag_id":"ckyk1p0jz00lsast9h7nt6z7u","_id":"ckyk1p0k000lvast9acpq6kt4"},{"post_id":"ckyk1p0c1006rast99d6dcewy","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0k200lyast9990dhofy"},{"post_id":"ckyk1p0c1006rast99d6dcewy","tag_id":"ckyk1p0k000lwast9aqcw1zau","_id":"ckyk1p0k200lzast9erosb0p0"},{"post_id":"ckyk1p0c3006uast9huzg0n8s","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0k300m1ast96rdvbsqt"},{"post_id":"ckyk1p0c4006wast9d05e7j6l","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0k500m4ast93lryalcd"},{"post_id":"ckyk1p0c4006wast9d05e7j6l","tag_id":"ckyk1p0k000lwast9aqcw1zau","_id":"ckyk1p0k500m5ast96dkb8ir9"},{"post_id":"ckyk1p0c60071ast98p98ev6t","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0k800m8ast95lk11nd9"},{"post_id":"ckyk1p0c60071ast98p98ev6t","tag_id":"ckyk1p0k000lwast9aqcw1zau","_id":"ckyk1p0k900m9ast9hwyw5mxr"},{"post_id":"ckyk1p0c70072ast97dgba8ug","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0ka00mcast96f5d6tmu"},{"post_id":"ckyk1p0c70072ast97dgba8ug","tag_id":"ckyk1p0k900maast9bm6v2ec8","_id":"ckyk1p0ka00mdast90wt51gie"},{"post_id":"ckyk1p0c90075ast96072gtdi","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0kc00mgast98iyx96mp"},{"post_id":"ckyk1p0c90075ast96072gtdi","tag_id":"ckyk1p0k900maast9bm6v2ec8","_id":"ckyk1p0kd00mhast9f4awb644"},{"post_id":"ckyk1p0cb0077ast9da9uf6rk","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0kf00mkast96hijav7c"},{"post_id":"ckyk1p0cb0077ast9da9uf6rk","tag_id":"ckyk1p0k900maast9bm6v2ec8","_id":"ckyk1p0kf00mlast94v7tfxke"},{"post_id":"ckyk1p0cd007bast9ambi5f72","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0kh00moast99k8jhnw9"},{"post_id":"ckyk1p0cd007bast9ambi5f72","tag_id":"ckyk1p0k900maast9bm6v2ec8","_id":"ckyk1p0kh00mpast9fq1uhude"},{"post_id":"ckyk1p0ce007cast9054u1ppo","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0kj00msast92jdv87uq"},{"post_id":"ckyk1p0ce007cast9054u1ppo","tag_id":"ckyk1p0kh00mqast98kqpdshw","_id":"ckyk1p0kj00mtast95v27gjvk"},{"post_id":"ckyk1p0cf007fast9hloy111a","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0kk00mvast924ccd1lu"},{"post_id":"ckyk1p0ch007gast9bvx946ak","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0km00myast9fg18d8p7"},{"post_id":"ckyk1p0ch007gast9bvx946ak","tag_id":"ckyk1p0kk00mwast99nc2edf3","_id":"ckyk1p0km00mzast92o1ndzop"},{"post_id":"ckyk1p0cj007jast91puhezvb","tag_id":"ckyk1p0kl00mxast90wlt3j5m","_id":"ckyk1p0kn00n2ast9bygthra1"},{"post_id":"ckyk1p0cj007jast91puhezvb","tag_id":"ckyk1p0km00n0ast9fxju1dj0","_id":"ckyk1p0kn00n3ast9cm379ghk"},{"post_id":"ckyk1p0ck007last90wrv47lx","tag_id":"ckyk1p0kn00n1ast98p0vghz9","_id":"ckyk1p0ko00n5ast990l12lwk"},{"post_id":"ckyk1p0cq007past94nyqhw48","tag_id":"ckyk1p0ko00n4ast9emceboi5","_id":"ckyk1p0kr00n8ast96636au5x"},{"post_id":"ckyk1p0cq007past94nyqhw48","tag_id":"ckyk1p0kp00n6ast9hyks5trf","_id":"ckyk1p0kr00n9ast91atnfdq6"},{"post_id":"ckyk1p0cs007rast99s04gtis","tag_id":"ckyk1p0ko00n4ast9emceboi5","_id":"ckyk1p0kt00ncast9fkwz094d"},{"post_id":"ckyk1p0cs007rast99s04gtis","tag_id":"ckyk1p0kp00n6ast9hyks5trf","_id":"ckyk1p0kt00ndast93icjhgrc"},{"post_id":"ckyk1p0ct007tast9c0c23e7b","tag_id":"ckyk1p0ko00n4ast9emceboi5","_id":"ckyk1p0kv00ngast96zjf1bdr"},{"post_id":"ckyk1p0ct007tast9c0c23e7b","tag_id":"ckyk1p0kp00n6ast9hyks5trf","_id":"ckyk1p0kv00nhast90co15m7s"},{"post_id":"ckyk1p0cw007wast91j661h52","tag_id":"ckyk1p0ko00n4ast9emceboi5","_id":"ckyk1p0kx00nkast97s6q3hwq"},{"post_id":"ckyk1p0cw007wast91j661h52","tag_id":"ckyk1p0kp00n6ast9hyks5trf","_id":"ckyk1p0ky00nlast90uk4geg7"},{"post_id":"ckyk1p0cx007zast916k1bln1","tag_id":"ckyk1p0ko00n4ast9emceboi5","_id":"ckyk1p0kz00nnast9dxwgdwge"},{"post_id":"ckyk1p0cx007zast916k1bln1","tag_id":"ckyk1p0kp00n6ast9hyks5trf","_id":"ckyk1p0kz00noast99cco0qh8"},{"post_id":"ckyk1p0l600nqast9bt5ybo1l","tag_id":"ckyk1p0at0051ast954og3gc1","_id":"ckyk1p0la00nuast99ng035us"},{"post_id":"ckyk1p0l800nsast94msahljd","tag_id":"ckyk1p0jw00lmast999dd7kpu","_id":"ckyk1p0lb00nvast93wcj57xb"},{"post_id":"ckyk1p0l800nsast94msahljd","tag_id":"ckyk1p0k900maast9bm6v2ec8","_id":"ckyk1p0lc00nyast92duhbvmc"},{"post_id":"ckyk1p0l500npast9hruc5j0u","tag_id":"ckyk1p0l800nrast94vmuh4p0","_id":"ckyk1p0lc00o1ast96nt1ayz7"},{"post_id":"ckyk1p0l500npast9hruc5j0u","tag_id":"ckyk1p0lb00nxast9cb08215d","_id":"ckyk1p0lc00o3ast99acj7abh"},{"post_id":"ckyk1p0le00o6ast98tw3aef9","tag_id":"ckyk1p0km00n0ast9fxju1dj0","_id":"ckyk1p0lh00o9ast92ww7hcnl"},{"post_id":"ckyk1p0ld00o5ast91rm9cy0z","tag_id":"ckyk1p08r0028ast9gr2rc1el","_id":"ckyk1p0lh00obast92nut4amj"},{"post_id":"ckyk1p0ld00o5ast91rm9cy0z","tag_id":"ckyk1p0lf00o7ast90b3385u5","_id":"ckyk1p0li00ocast92oymbhv1"}],"Tag":[{"name":"git","_id":"ckyk1p063000aast92fy591jo"},{"name":"hexo","_id":"ckyk1p068000fast9cqzw9w6s"},{"name":"fluid","_id":"ckyk1p06d000last98r0bfakz"},{"name":"配置","_id":"ckyk1p06x000past99pmufwyu"},{"name":"emoji","_id":"ckyk1p078000tast9brei8jgj"},{"name":"pdf","_id":"ckyk1p07o0018ast986bv4cun"},{"name":"docker","_id":"ckyk1p07v001dast9fqht60m5"},{"name":"远程配置","_id":"ckyk1p083001kast98lgrbc56"},{"name":"ssh","_id":"ckyk1p08l0021ast9f4beh5uo"},{"name":"深度学习","_id":"ckyk1p08r0028ast9gr2rc1el"},{"name":"MobileNet","_id":"ckyk1p08v002fast949usckms"},{"name":"微调","_id":"ckyk1p098002xast91a02elzv"},{"name":"深度学习，梯度","_id":"ckyk1p09b0031ast9cvnae91t"},{"name":"目标检测","_id":"ckyk1p09n003last98idpef0k"},{"name":"yolo","_id":"ckyk1p09r003qast968qz7dvz"},{"name":"dvc","_id":"ckyk1p09z003uast9honn5eut"},{"name":"英语","_id":"ckyk1p0af004hast9c4uahb24"},{"name":"图像处理","_id":"ckyk1p0aj004past90ijt55e3"},{"name":"图像处理，角度","_id":"ckyk1p0an004vast9h5zy9fce"},{"name":"kaggle","_id":"ckyk1p0at0051ast954og3gc1"},{"name":"剑指","_id":"ckyk1p0az0056ast9ezjk8izf"},{"name":"排序","_id":"ckyk1p0b5005cast98jdq3wio"},{"name":"数组","_id":"ckyk1p0bc005nast96kaxbhmx"},{"name":"idea","_id":"ckyk1p0bf005tast9gmbhbavf"},{"name":"数组查找","_id":"ckyk1p0bn0065ast9fkrl48fo"},{"name":"字符串","_id":"ckyk1p0bz006last9gvsaasm6"},{"name":"树","_id":"ckyk1p0c5006zast9dm6v74s0"},{"name":"链表","_id":"ckyk1p0cc0079ast98o8rbxqy"},{"name":"栈","_id":"ckyk1p0cm007oast9gm2r0srq"},{"name":"斐波那契","_id":"ckyk1p0cy0080ast930wsaojz"},{"name":"动态规划","_id":"ckyk1p0cz0082ast9clxh79es"},{"name":"DFS","_id":"ckyk1p0dh009east993yuc3ta"},{"name":"变量","_id":"ckyk1p0ej00awast92e7f2n8c"},{"name":"快速幂","_id":"ckyk1p0en00b6ast9etla57dj"},{"name":"大数","_id":"ckyk1p0ey00bvast99k1vf3jf"},{"name":"有限状态机","_id":"ckyk1p0fg00ctast90i3w1wgr"},{"name":"队列","_id":"ckyk1p0gz00fuast937wve0kp"},{"name":"递归","_id":"ckyk1p0hn00h0ast9fo2o5vv3"},{"name":"字典","_id":"ckyk1p0hq00h7ast98v9y2zen"},{"name":"快速排序","_id":"ckyk1p0ht00hfast965plc5o5"},{"name":"哈希表","_id":"ckyk1p0i600i1ast97kx82cgx"},{"name":"滑动窗口","_id":"ckyk1p0it00j5ast9cfcmdqrp"},{"name":"双指针","_id":"ckyk1p0iw00jbast9cjcq7rbh"},{"name":"math","_id":"ckyk1p0ja00k5ast9bmdr6kp4"},{"name":"线性代数","_id":"ckyk1p0jc00kbast98f6mdaen"},{"name":"概率论","_id":"ckyk1p0jg00klast9ejcq2ek7"},{"name":"马氏距离","_id":"ckyk1p0ji00kpast91qjncjy8"},{"name":"numpy","_id":"ckyk1p0jk00kvast9hl6ue99r"},{"name":"项目","_id":"ckyk1p0jr00l9ast90pnng83w"},{"name":"项目打包","_id":"ckyk1p0js00lfast9adghf006"},{"name":"python","_id":"ckyk1p0jw00lmast999dd7kpu"},{"name":"Latex","_id":"ckyk1p0jz00lsast9h7nt6z7u"},{"name":"文件","_id":"ckyk1p0k000lwast9aqcw1zau"},{"name":"图像","_id":"ckyk1p0k900maast9bm6v2ec8"},{"name":"pyqt","_id":"ckyk1p0kh00mqast98kqpdshw"},{"name":"re","_id":"ckyk1p0kk00mwast99nc2edf3"},{"name":"学习笔记","_id":"ckyk1p0kl00mxast90wlt3j5m"},{"name":"paper","_id":"ckyk1p0km00n0ast9fxju1dj0"},{"name":"文献","_id":"ckyk1p0kn00n1ast98p0vghz9"},{"name":"李沐","_id":"ckyk1p0ko00n4ast9emceboi5"},{"name":"机器学习","_id":"ckyk1p0kp00n6ast9hyks5trf"},{"name":"李宏毅","_id":"ckyk1p0l800nrast94vmuh4p0"},{"name":"知识蒸馏","_id":"ckyk1p0lb00nxast9cb08215d"},{"name":"swin","_id":"ckyk1p0lf00o7ast90b3385u5"}]}}